;/*FB_PKG_DELIM*/

__d("ArmadilloReceiveWriteDbFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5720"),s=o("FalcoLoggerInternal").create("armadillo_receive_write_db_failure",e),u=s;l.default=u}),98);
__d("ArmadilloReceiveWriteDbSuccessFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5721"),s=o("FalcoLoggerInternal").create("armadillo_receive_write_db_success",e),u=s;l.default=u}),98);
__d("ArmadilloTaskHandlers",["JSResourceForInteraction"],(function(t,n,r,o,a,i,l){"use strict";var e,s={add:(e=r("JSResourceForInteraction"))("AddTaskHandler").__setRef("ArmadilloTaskHandlers"),get_messenger_db_dump_attachments_for_bug_reporting:e("GetMessengerDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),maw_get_devices:e("MAWGetDevicesTaskHandler").__setRef("ArmadilloTaskHandlers"),preload_messenger_db_dump_attachments_for_bug_reporting:e("PreloadDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),test:e("TestNativeTaskHandler").__setRef("ArmadilloTaskHandlers"),zenon_send_chatd_mws_message:e("MAWZenonSendMultiwayMsgChatdTaskHandler").__setRef("ArmadilloTaskHandlers")};l.TASK_HANDLERS_RESOURCES=s}),98);
__d("OpfsSyncApi",["WAResultOrError","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e="blobs";async function s(t){var n,a=t.blob,i=t.fileName;if(((n=navigator)==null||(n=n.storage)==null?void 0:n.getDirectory)==null)return o("WAResultOrError").makeError("opfs-not-supported");var l=await navigator.storage.getDirectory(),s=await l.getDirectoryHandle(e,{create:!0});try{return await s.getFileHandle(i,{create:!1}),o("WAResultOrError").makeResult("file-exists")}catch(e){var u=r("getErrorSafe")(e);if(u.name==="NotFoundError"){var c=await s.getFileHandle(i,{create:!0}),d=await c.createSyncAccessHandle(),m=new DataView(a);return d.write(m,{at:0}),d.close(),o("WAResultOrError").makeResult("file-written")}return o("WAResultOrError").makeError("file-read-error")}}async function u(t){var n,a=t.fileName;if(((n=navigator)==null||(n=n.storage)==null?void 0:n.getDirectory)==null)return o("WAResultOrError").makeError("opfs-not-supported");var i=await navigator.storage.getDirectory(),l=await i.getDirectoryHandle(e,{create:!0});try{var s=await l.getFileHandle(a,{create:!1}),u=await s.createSyncAccessHandle(),c=u.getSize(),d=new ArrayBuffer(c),m=new DataView(d);return await u.read(m,{at:0}),u.close(),o("WAResultOrError").makeResult(d)}catch(e){var p=r("getErrorSafe")(e);return p.name==="NotFoundError"?o("WAResultOrError").makeResult():o("WAResultOrError").makeError("file-read-error")}}async function c(){var t;if(((t=navigator)==null||(t=t.storage)==null?void 0:t.getDirectory)==null)return o("WAResultOrError").makeError("opfs-not-supported");var n=await navigator.storage.getDirectory();return n.removeEntry(e,{recursive:!0}).then(function(){return o("WAResultOrError").makeResult()}).catch(function(e){var t=r("getErrorSafe")(e);return t.name==="NotFoundError"?o("WAResultOrError").makeResult():o("WAResultOrError").makeError("directory-clear-error")})}l.maybeWriteToOpfs=s,l.readFromOpfs=u,l.cleanupFolder=c}),98);
__d("BlobStorageApi",["OpfsSyncApi"],(function(t,n,r,o,a,i,l){"use strict";var e={writeIfNotExist:function(t){var e=t.blob,n=t.fileName;return o("OpfsSyncApi").maybeWriteToOpfs({fileName:n,blob:e})},read:function(t){var e=t.fileName;return o("OpfsSyncApi").readFromOpfs({fileName:e})},clear:function(){return o("OpfsSyncApi").cleanupFolder()}};l.default=e}),98);
__d("BlobStorageTypes",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}i.toBlobFileName=e}),66);
__d("BroadcastChannelClientServerHandshake",["FBLogger","Promise","Random","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){e.addEventListener("message",function(t){var n;((n=t.data)==null?void 0:n.type)==="BroadcastChannelHandshake-syn"&&e.postMessage({nonce:t.data.nonce,type:"BroadcastChannelHandshake-syn-ack"})})}function u(t,a){var i=o("Random").random(),l=0;return new(e||(e=n("Promise")))(function(e,n){var o=!1,s=function(){if(l===6){o=!0,t.removeEventListener("message",u);try{throw r("FBLogger")("messenger_web").mustfixThrow("[LS] BC handshake failed, failing, likely worker failure%s",a!=null?" for"+a:"")}catch(e){n(e)}return}o||(t.postMessage({nonce:i,type:"BroadcastChannelHandshake-syn"}),r("setTimeout")(s,100*Math.pow(2,l++)))},u=function(r){var n,a;((n=r.data)==null?void 0:n.type)==="BroadcastChannelHandshake-syn-ack"&&((a=r.data)==null?void 0:a.nonce)===i&&(e(),o=!0,t.removeEventListener("message",u))};t.addEventListener("message",u),s()})}l.listen=s,l.checkAlive=u}),98);
__d("CometTaskFrameworkTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["UNKNOWN","BACKGROUND","CURRENT_THREAD","LS_WORKER","MAW_WORKER","TEST"]),l="comet_task_framework";i.ExecutionContext=e,i.TASK_FRAMEWORK_PREFIX=l}),66);
__d("InstamadilloTaskHandlers",["JSResourceForInteraction"],(function(t,n,r,o,a,i,l){"use strict";var e,s={33:(e=r("JSResourceForInteraction"))("IGDUnsendMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),46:e("IGDSendMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_edit_message:e("IGDEditMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_react_message:e("IGDSendRemoveReactionTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_send_media_message:e("IGDSendMediaMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_send_xma_receiver_fetch:e("IGDSendXmaReceiverFetchTaskHandler").__setRef("InstamadilloTaskHandlers")};l.TASK_HANDLERS_RESOURCES=s}),98);
__d("CometTaskHandlers",["ArmadilloTaskHandlers","InstamadilloTaskHandlers"],(function(t,n,r,o,a,i,l){"use strict";var e=babelHelpers.extends({},o("ArmadilloTaskHandlers").TASK_HANDLERS_RESOURCES,o("InstamadilloTaskHandlers").TASK_HANDLERS_RESOURCES);l.TASK_HANDLERS_RESOURCES=e}),98);
__d("EBConsoleUtils",["EBDeps","FBLogger","ReQL"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=new TextDecoder,n=t.decode(e),o=parseInt(n,10);if(isNaN(o))throw r("FBLogger")("encrypted_backups").mustfixThrow('Invalid integer string in buffer: "%s"',n);return o}function s(t){return t.sort(function(t,n){var r=e(t.epochAnonIdBlob),o=e(n.epochAnonIdBlob);return r-o})}function u(e){for(var t="",n=e.byteLength,r=0;r<n;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function c(e){return u(new Uint8Array(e))}async function d(){var t=await o("EBDeps").getDeps().getLSDB(),n=await t.runInTransaction(function(e){return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.secure_encrypted_backups_epochs))},"readwrite"),r=s(n);return r.map(function(t){return babelHelpers.extends({},t,{anonId:e(t.epochAnonIdBlob),epochAnonIdBlobBase64:c(t.epochAnonIdBlob),epochHeadBase64:t.epochHead!=null?c(t.epochHead):null,epochRootKeyBlobBase64:c(t.epochRootKeyBlob)})})}async function m(e){var t=await o("EBDeps").getDeps().getLSDB();await t.runInTransaction(async function(t){for(var n=await o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.secure_encrypted_backups_epochs)),r=s(n),a=0;a<r.length;a++)a<r.length-e&&await t.secure_encrypted_backups_epochs.delete(r[a].epochId)},"readwrite")}l.blobToInt32=e,l.sortEpochsByAnonId=s,l.uint8ArrayToBase64=u,l.arrayBufferToBase64=c,l.getAllEpochsSorted=d,l.deleteEpochsExceptLastN=m}),98);
__d("EBDBMetricsConsistencyOperationEnum",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({Upload:0});i.EBConsistencyOperation=e}),66);
__d("EBEnqueueMessagesForUpload",["EBAPIQPLPoints","EBMessageProbe","EBMinosDisableLabyrinth10Uploads","EncryptedBackupsUploadQueueV3","FBLogger","MWEBODSEntityName.enum","MWEBODSUtils","QPLFlow","WAHashStringToNumber","WAStanzaUtils","getErrorSafe","getSafeQplErrorMessage","justknobx","qpl","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=new Map;if(e.length===0||o("EBMinosDisableLabyrinth10Uploads").disableLabyrinth10Uploads())return Promise.resolve();o("MWEBODSUtils").markODSForEB(r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.receive.process",e.length);var n=[],a=r("qpl")._(521477113,"2698");return e.forEach(function(e){var i=o("WAHashStringToNumber").hashStringToNumber(r("uuidv4")()),l=o("WAStanzaUtils").toStanzaId(e.message.messageId);t.set(l,o("QPLFlow").startQPLFlow(a,{instanceKey:i,timeoutInMs:r("justknobx")._("308")})),o("EBMessageProbe").getEBMessageProbeInstance().addMarkerToItem(e.message.messageId,"mps_upload_enqueue_start");try{var s,u=o("EncryptedBackupsUploadQueueV3").uploadEntityFromIncomingPayload(e);n.push(u),(s=t.get(l))==null||s.addPoint(o("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_PAYLOAD_CREATED)}catch(e){var c,d=r("getErrorSafe")(e);(c=t.get(l))==null||c.endFail(o("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_PAYLOAD_CREATION_FAILURE,{string:{errorDescription:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(d)}})}}),o("MWEBODSUtils").markODSForEB(r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.receive.enqueue",n.length),s(n,t)}async function s(e,t){try{await o("EncryptedBackupsUploadQueueV3").getUploadQueue().add(e),e.forEach(function(e){var n;(n=t.get(o("WAStanzaUtils").toStanzaId(e.messageId)))==null||n.endSuccess()})}catch(a){var n=r("getErrorSafe")(a);throw e.forEach(function(e){var n;(n=t.get(o("WAStanzaUtils").toStanzaId(e.messageId)))==null||n.endFail(o("EBAPIQPLPoints").EBUploadQueueQPLPoints.ENQUEUE_FAILURE)}),r("FBLogger")("wmi").catching(n).mustfixThrow("Failed to enqueue entities")}}l.default=e}),98);
__d("EBGraphQLQueryModule",["EBCreateGraphQLFetchFnUnified"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t){var n=await o("EBCreateGraphQLFetchFnUnified").createGraphQlFetchFnUnified();return n(e,t)}l.ebGraphQLQueryModule=e}),98);
__d("EBGraphQLTypeUtils",["err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(/^\d+$/.test(e)===!1)throw r("err")("threadId is not a number");return Number(e)}function s(e){return e.toString()}l.threadIdToThreadIdInt=e,l.timestampMsToTimestampMsString=s}),98);
__d("EBLSResignCdnUrlDeferred",["gkx","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("EBLSResignCdnUrl").__setRef("EBLSResignCdnUrlDeferred");function s(t){return e.load().then(function(e){return r("gkx")("12896")?e.resignCdnUrlUsingEbdb(t):e.DEPRECATED_eblsResignCdnUrlWithGraphQL(t)})}l.eblsResignCdnUrlWithGraphQL=s}),98);
__d("EBMessageRangeQueryForThreadsQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="24862964906707992"}),null);
__d("EBMessageRangeQueryForThreadsQuery.graphql",["EBMessageRangeQueryForThreadsQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e={defaultValue:null,kind:"LocalArgument",name:"app_id"},t={defaultValue:!1,kind:"LocalArgument",name:"minos_gk_enabled"},r={defaultValue:null,kind:"LocalArgument",name:"restore_payload_strings"},o={defaultValue:null,kind:"LocalArgument",name:"restore_type"},a=[{kind:"Variable",name:"app_id",variableName:"app_id"},{kind:"Variable",name:"restore_payload_strings",variableName:"restore_payload_strings"},{kind:"Variable",name:"restore_type",variableName:"restore_type"}],i={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"supplemental_otid",storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"actor_token",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"mek_fbid",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"mek_id",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp",storageKey:null},C={alias:null,args:null,kind:"ScalarField",name:"transport_sender_signing_pk",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"transport_sender_message_signature",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"franking_tag",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"reporting_tag",storageKey:null},R={alias:null,args:null,kind:"ScalarField",name:"message_encryption_version",storageKey:null},L={alias:null,args:null,kind:"ScalarField",name:"message_metadata_version",storageKey:null},E=[l,s],k={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[e,t,r,o],kind:"Fragment",metadata:null,name:"EBMessageRangeQueryForThreadsQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:a,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_from_selected_threads",plural:!0,selections:[{args:[{kind:"Variable",name:"minos_gk_enabled",variableName:"minos_gk_enabled"}],kind:"FragmentSpread",name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages"}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[r,o,e,t],kind:"Operation",name:"EBMessageRangeQueryForThreadsQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:a,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_from_selected_threads",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},i,l,s,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"message_tags",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[u,i,l,s,c,d],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[u,i,l,s,c,d,m,p],storageKey:null},{alias:null,args:null,concreteType:"XFBUnencryptedProtobufStanza",kind:"LinkedField",name:"top_level_protobuf_unencrypted",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"unencrypted_protobuf",storageKey:null},c],storageKey:null},{condition:"minos_gk_enabled",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"XFBMinosProtobufStanza",kind:"LinkedField",name:"top_level_protobuf_v2",plural:!1,selections:[_,f,g,h,y,C,b,v,S,R,L],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs_v2",plural:!0,selections:[_,f,y,g,h,m,p,C,b,v,S,R,L],storageKey:null}]}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"thread_not_found",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:E,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:E,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null},{condition:"minos_gk_enabled",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"XFBMinosDecryptionKeyMap",kind:"LinkedField",name:"minos_decryption_keys",plural:!0,selections:[k,{alias:null,args:null,concreteType:"XFBMinosDecryptionKeys",kind:"LinkedField",name:"keys",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBMinosMekInfo",kind:"LinkedField",name:"mek_info",plural:!1,selections:[h,{alias:null,args:null,kind:"ScalarField",name:"roster_hash",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_mek",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mek_creation_timestamp",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mek_encryption_version",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosRecipientInfo",kind:"LinkedField",name:"recipient_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"epoch_fbid",storageKey:null},l,{alias:null,args:null,kind:"ScalarField",name:"epoch_head",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBMekCreatorInfo",kind:"LinkedField",name:"mek_creator_info",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBMinosEncryptionKeys",kind:"LinkedField",name:"minos_keys",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"sender_auth_pk",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sender_epoch_head",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosTransportKeys",kind:"LinkedField",name:"transport_keys",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ephm_hpke_pk",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ephm_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mek_creator_transport_signing_pk",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]}],storageKey:null}],storageKey:null},k],storageKey:null}],storageKey:null}]},params:{id:n("EBMessageRangeQueryForThreadsQuery_facebookRelayOperation"),metadata:{},name:"EBMessageRangeQueryForThreadsQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("EBSourceTypes",["LSMEBTaskCreationSource"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e){case"media_gallery_restore":return r("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE;case"file_gallery_restore":return r("LSMEBTaskCreationSource").FILE_GALLERY_RESTORE;case"messenger_dyi":return r("LSMEBTaskCreationSource").MSGR_DYI;case"message_probe":return r("LSMEBTaskCreationSource").UNKNOWN;case"unknown":return r("LSMEBTaskCreationSource").UNKNOWN;default:return r("LSMEBTaskCreationSource").UNKNOWN}}l.castTaskCreationSourceToLSTaskSource=e}),98);
__d("LSEncryptedBackupsMessagesRangeQueryDirection",[],(function(t,n,r,o,a,i){var e=Object.freeze({BEFORE:1,AFTER:2});i.default=e}),66);
__d("EBMessageRangeQueryForThreadsQueryVariables",["Base64Utils","EBGraphQLTypeUtils","EBMessageRangeQueryUtils","EBSourceTypes","LSEncryptedBackupsMessagesRangeQueryDirection","WAJids","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a,i,l,s,u,c){var d=e.map(function(e){var t=e.direction,n=e.from,c=n[0],d=e.chatJid,m=e.numMessages,p=t==="before"?r("LSEncryptedBackupsMessagesRangeQueryDirection").BEFORE:r("LSEncryptedBackupsMessagesRangeQueryDirection").AFTER,_=o("WAJids").threadIdForChatJid(d);return JSON.stringify({restore_context:{act_thread_id:_,site:"www",source:o("EBSourceTypes").castTaskCreationSourceToLSTaskSource(u),tam_thread_subtype:0},success:{device_context:{device_id:a,locally_available_epochs:i,raw_tokens:{mailbox_root_key:o("Base64Utils").fromArrayBuffer(l),ocmf_client_state_blob:o("Base64Utils").fromArrayBuffer(s)}},direction:p,query_num_messages:m!=null?m:void 0,reference_timestamp:o("EBMessageRangeQueryUtils").safeTimestampMsString(c),server_thread_key:o("EBGraphQLTypeUtils").threadIdToThreadIdInt(_),source:o("EBSourceTypes").castTaskCreationSourceToLSTaskSource(u)}})});return{app_id:n,minos_gk_enabled:(r("gkx")("20911")||u==="messenger_dyi")&&c,restore_payload_strings:d,restore_type:t==="initial"?"INITIAL_RESTORE":"RANGE_QUERY_RESTORE"}}l.messageRangeQueryForThreadsQueryVariables=e}),98);
__d("EBMessageRangeQueryForThreads",["EBAPIConvertNativeToLS","EBAPIDecryptionModule","EBAPIQPLPoints","EBAPISharedTypes","EBDedupeLabyrinthMessages","EBDeriveAndStoreEpochs","EBGetClientState","EBGraphQLQueryModule","EBMessageRangeQueryForThreadsQuery.graphql","EBMessageRangeQueryForThreadsQueryVariables","EBMinosCheckWasmFeatureSupport","EBMinosInterfaceTypes","I64","LSVec","MAWCurrentUser","MAWEncryptedBackupUtils","MAWHandleEBRestoreWithHIM","MAWJobDefinitions","MAWMpsXMAValidationPreprocessor","MpsTypes","QPLFlow","WAHashStringToNumber","WAJids","WAResultOrError","err","getSafeQplErrorMessage","gkx","handleRestoreMessagesGraphQLResponse","justknobx","qpl","requireDeferred","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("requireDeferred")("EBDedupeEncryptedLabyrinthMessages").__setRef("EBMessageRangeQueryForThreads"),c=r("requireDeferred")("EBMinosDecryptAndValidateMessages").__setRef("EBMessageRangeQueryForThreads"),d=e!==void 0?e:e=n("EBMessageRangeQueryForThreadsQuery.graphql");async function m(e){var t=e.instanceKey,n=e.restoreType,a=e.source,i=e.storage,l=e.threads,m=await o("EBMinosCheckWasmFeatureSupport").checkWasmFeatureSupport(),p=o("WAHashStringToNumber").hashStringToNumber(t!=null?t:r("uuidv4")()),_=r("qpl")._(521473850,"2910"),f=o("QPLFlow").startQPLFlow(_,{annotations:{bool:{is_wasm_serializer_on:r("gkx")("18428"),minos_rollout_enabled:r("gkx")("20911"),occam_only_mailbox_users:r("gkx")("16674")},int:{batchSize:l.length,messagesRequested:l.reduce(function(e,t){var n;return e+((n=t.numMessages)!=null?n:0)},0)},string:{source:a!=null?a:"unknown"}},instanceKey:p,timeoutInMs:r("justknobx")._("2950")});try{var g,h,y;if(l.length===0)throw f.endFail(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_PARAMETERS),r("err")("invalid parameters");var C=await o("EBGetClientState").getClientState(i);if(f.addPoint(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CLIENT_STATE_RETRIEVED,{string:{device_id:(g=C==null?void 0:C.deviceId)!=null?g:(s||(s=o("I64"))).to_string((s||(s=o("I64"))).zero)}}),C==null)throw f.endFail(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{string:{error_description:o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE}}),r("err")("no client state");var b=C.backupId,v=C.deviceId,S=C.locally_available_epochs,R=C.mailboxRootKey,L=C.ocmfClientStateBlob;if(b==null||v==null||R==null||L==null)throw f.endFail(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{bool:{hasBackupId:b!=null,hasDeviceId:v!=null,hasMailboxRootKey:R!=null,hasOcmfClientStateBlob:L!=null},string:{error_description:o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE}}),r("err")("invalid client state");var E=o("EBMessageRangeQueryForThreadsQueryVariables").messageRangeQueryForThreadsQueryVariables(l,n,(h=o("MAWCurrentUser").getAppID())!=null?h:"0",v,S,R,L,a,m);f.addPoint(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START);var k=await o("EBGraphQLQueryModule").ebGraphQLQueryModule(d,E);f.addPoint(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END);var I=k==null||(y=k.viewer)==null||(y=y.encrypted_backup)==null||(y=y.mailbox)==null?void 0:y.messages_from_selected_threads;if(I==null)throw f.endFail(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{string:{error_description:o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}}),r("err")("invalid graphql response");var T=!1;f.addPoint("decryption_start");var D=await Promise.all(I.map(async function(e,t){try{var n,s=e;if(s==null)return o("WAResultOrError").makeError("invalid-graphql-response");if(T===!0)return o("WAResultOrError").makeError("server-side-exception");var d=s.backup_id,p=s.encrypted_messages,_=s.epoch_derivation_set,g=s.exception_string,h=s.message_range_info,y=s.minos_decryption_keys,C=s.should_delete_mailbox,v=s.thread_not_found;if(g!=null)return f.addAnnotations({string:{serverExceptionString:g}}),v!=null&&v?o("WAResultOrError").makeError("thread-not-found-on-server"):(C===!0&&(T=!0),o("WAResultOrError").makeError("server-side-exception"));await o("EBDeriveAndStoreEpochs").deriveAndStoreEpochsNonLS(i,_);var S=h||{},R=S.has_more_after,L=S.has_more_before,E=S.next_message_timestamp_ms_after,k=S.next_message_timestamp_ms_before;if(L==null||R==null||E==null||k==null)return o("WAResultOrError").makeError("missing-message-range-info");var I=l[t],D=o("WAJids").threadIdForChatJid(I.chatJid),x=o("MpsTypes").toThreadId(I.chatJid),$=r("gkx")("20911")||a==="messenger_dyi",P=$&&m?o("EBMinosInterfaceTypes").processMinosMessages(p):[],N=$&&m?await c.load().then(function(e){return e.minosDecryptAndValidateMessages({encryptedMinosMessages:P,entryPoint:"range_query",minosDecryptionKeys:y,qplFlow:f,source:a,threadId:x,validator:r("gkx")("5782")?o("MAWMpsXMAValidationPreprocessor").xmaValidator():function(){return Promise.resolve(o("WAResultOrError").makeResult())}})}):o("WAResultOrError").makeResult({decryptionResult:new Map,errorMessages:[]}),M=N.success===!0&&N.value.decryptionResult.size>0?N.value.decryptionResult:null,w=N.success===!0?N.value.errorMessages:[(n=N.error)!=null?n:"unknown-error"];f.addAnnotations({bool:{minos_decrypt_success:w.length===0},string_array:{minos_decrypt_errors:w}});var A=$&&M!=null&&m?await u.load().then(function(e){return e.dedupeEncryptedLabyrinthMessages(p,M,f)}):p,F=o("handleRestoreMessagesGraphQLResponse").processMessageArray(A,d!=null?o("EBMinosInterfaceTypes").unsafeCastToBackupFbid(d):b),O=F.encryptedNonLSEchoMessages,B=F.encryptedNonLSProtobufs,W=await o("EBAPIDecryptionModule").decryptUsingNativeJS(i,D,B,O,a,"range_query");if(!W.success){var q,U=W.error,V=U.message,H=o("EBAPISharedTypes").EBAPIRestoreErrorValues.find(function(e){return e===V});return f.endFail("decrypt_labyrinth10_messages_failure",{string:{error_description:U.message,errorStackTrace:(q=U.stack)!=null?q:""}}),H!=null?o("WAResultOrError").makeError(H):o("WAResultOrError").makeError("native-decryption-error")}f.addAnnotations({bool:{labyrinth_10_toplevel_decrypt_success:W.value.decryptedEchoMessages.length===O.length&&W.value.decryptedProtobufs.length===B.length}});var G=W.value.decryptedEchoMessages,z=W.value.decryptedProtobufs,j=(r("gkx")("20911")||a==="messenger_dyi")&&m?o("EBDedupeLabyrinthMessages").dedupeLabyrinthMessages(z,M):z;f.addAnnotations({int:{decryptedEchoMessageCount:G.length,decryptedProtobufCount:j.length}});var K=o("EBAPIConvertNativeToLS").convertNativeDecryptionResponseToDecryptedMessageType(G,j),Q=o("MAWHandleEBRestoreWithHIM").convertEchoMessagesToEBProtobufs(r("LSVec").toArray(K.echo).map(o("MAWJobDefinitions").toEncodedEchoMessage),I.chatJid),X=o("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(K.protobuf),Y=r("gkx")("10800")?[].concat(Q,X):[].concat(X,Q);return o("WAResultOrError").makeResult({args:I,messageRangeInfo:{has_more_after:R,has_more_before:L,next_message_timestamp_ms_after:E,next_message_timestamp_ms_before:k},messages:r("gkx")("10800")?Array.from(new Map(Y.map(function(e){return[e.otid,e]})).values()):Y})}catch(e){return o("WAResultOrError").makeError("runtime-error")}}));f.addPoint("decryption_end");var x=D.reduce(function(e,t){var n=t.success;return n===!1?e+1:e},0),$=I.length;return x>0?f.endFail(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BATCH_RESTORE_AND_DECRYPT_FAILURE,{bool:{allSuccessful:!1},int:{attemptCount:$,errorCount:x},string_array:{decryption_and_validation_errors:D.map(function(e){var t;return e.success?"success":(t=e.error)!=null?t:"unknown-error"})}}):f.endSuccess({bool:{allSuccessful:!0},int:{attemptCount:$,errorCount:0},string_array:{decryption_and_validation_errors:D.map(function(e){var t;return(t=e.error)!=null?t:"success"})}}),D}catch(e){throw f.endFail(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{string:{error:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)}}),e}}l.messageRangeQueryForThreads=m}),98);
__d("IEBAPI",["MAWBridge"],(function(t,n,r,o,a,i,l){"use strict";var e=1;function s(e){var t=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return o("MAWBridge").getBridge().sendAndReceive("backend","ebapi",{args:n,type:e})};return t}function u(e){var t=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return o("MAWBridge").getBridge().sendAndReceive("backend","minosEBAPI",{args:n,type:e})};return t}l.version=e,l.makeBridgedApi=s,l.makeMinosBridgedApi=u}),98);
__d("EBMinosBridgedAPI",["IEBAPI"],(function(t,n,r,o,a,i,l){"use strict";var e={writeMinosKeyChangeAdminMessage:o("IEBAPI").makeMinosBridgedApi("writeMinosKeyChangeAdminMessage"),writeMinosMailboxKeysForRecipientAPI:o("IEBAPI").makeMinosBridgedApi("writeMinosMailboxKeysForRecipientAPI"),writeMinosSecureStorageAlert:o("IEBAPI").makeMinosBridgedApi("writeMinosSecureStorageAlert")},s=e;l.default=s}),98);
__d("EBMinosFetchContactKeysQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="26531892553066563"}),null);
__d("EBMinosFetchContactKeysQuery.graphql",["EBMinosFetchContactKeysQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{kind:"Variable",name:"input",variableName:"input"}],r={kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"XFBMinosFetchMailboxPublicKeysForContact",kind:"LinkedField",name:"contact_id_to_minos_params",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"contact_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMinosFetchMailboxPublicKeysShape",kind:"LinkedField",name:"mailbox_public_keys",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"enc_pk_b64",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id_b64",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_head_b64",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_head_ctime",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"auth_pk_b64",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sign_pk_b64",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"prev_epoch_head_b64",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"self_signature_b64",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"fbid",storageKey:null}],storageKey:null}],storageKey:null}],type:"XFBMinosFetchMailboxPublicKeysResponse",abstractKey:null},o={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"message",storageKey:null}],type:"XFBMinosFetchMailboxPublicKeysError",abstractKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"EBMinosFetchContactKeysQuery",selections:[{alias:null,args:t,concreteType:null,kind:"LinkedField",name:"xfb_minos_fetch_mailbox_public_keys",plural:!1,selections:[r,o],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"EBMinosFetchContactKeysQuery",selections:[{alias:null,args:t,concreteType:null,kind:"LinkedField",name:"xfb_minos_fetch_mailbox_public_keys",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},r,o],storageKey:null}]},params:{id:n("EBMinosFetchContactKeysQuery_facebookRelayOperation"),metadata:{},name:"EBMinosFetchContactKeysQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("EBMinosFetchContactKeys",["EBBase64Decode","EBGraphQLQueryModule","EBMinosFetchContactKeysQuery.graphql","EBMinosTypes","WALongInt","WAResultOrError","WATimeUtils","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e!==void 0?e:e=n("EBMinosFetchContactKeysQuery.graphql");function u(e,t){var n,a,i=new TextDecoder().decode((a=r("EBBase64Decode"))(e.epochAnonIdB64));return{contactFbid:t,epochAnonId:(n=o("EBMinosTypes")).unsafeCastToEpochNumber(o("WALongInt").decimalStringToLongInt(i)),epochHead:n.unsafeCastToEpochHead(a(e.epochHeadB64)),epochHeadCreationTime:n.unsafeCastToEpochCreationTime(o("WATimeUtils").castToUnixTime(e.epochHeadCtime)),mailboxAuthPublicKey:n.unsafeCastToMailboxAuthPK(a(e.authPkB64)),mailboxEncryptionPublicKey:n.unsafeCastToMailboxEncryptionPK(a(e.encPkB64)),mailboxSigningPublicKey:n.unsafeCastToMailboxSigningPK(a(e.signPkB64)),previousEpochHead:e.prevEpochHeadB64!=null?o("EBMinosTypes").unsafeCastToEpochHead(r("EBBase64Decode")(e.prevEpochHeadB64)):null,publicKeyFbid:o("EBMinosTypes").unsafeCastToMailboxFbId(o("WALongInt").decimalStringToLongInt(e.fbid)),selfEpochSignature:o("EBMinosTypes").unsafeCastToEpochSelfSig(r("EBBase64Decode")(e.selfSignatureB64))}}async function c(e){var t=e.contactIds,n=e.useCase,a={input:{contact_ids:t.map(function(e){return String(e)}),request_uuid:r("uuidv4")(),use_case:n}},i=await o("EBGraphQLQueryModule").ebGraphQLQueryModule(s,a),l=i==null?void 0:i.xfb_minos_fetch_mailbox_public_keys;if(l==null)return o("WAResultOrError").makeError("GraphQL response is empty");if(l.code!=null){var c;return o("WAResultOrError").makeError("GraphQL error: "+l.code+" - "+((c=l.message)!=null?c:"Unknown error"))}if(l.contact_id_to_minos_params==null)return o("WAResultOrError").makeError("Missing contact_id_to_minos_params in response");var d=l.contact_id_to_minos_params.map(function(e){var t=e.mailbox_public_keys,n=e.contact_id,r=t==null?void 0:t.enc_pk_b64,a=t==null?void 0:t.epoch_anon_id_b64,i=t==null?void 0:t.epoch_head_b64,l=t==null?void 0:t.epoch_head_ctime,s=t==null?void 0:t.auth_pk_b64,c=t==null?void 0:t.sign_pk_b64,d=t==null?void 0:t.prev_epoch_head_b64,m=t==null?void 0:t.self_signature_b64,p=t==null?void 0:t.fbid;if(n!=null){var _=o("EBMinosTypes").unsafeCastToUserFbId(n);return r==null||a==null||i==null||l==null||s==null||c==null||m==null||p==null?{contactId:_,mailboxPublicKeys:null}:{contactId:_,mailboxPublicKeys:u({authPkB64:s,encPkB64:r,epochAnonIdB64:a,epochHeadB64:i,epochHeadCtime:l,fbid:p,prevEpochHeadB64:d,selfSignatureB64:m,signPkB64:c},_)}}});return o("WAResultOrError").makeResult({contactKeys:d.filter(Boolean)})}l.fetchContactMinosKeys=c}),98);
__d("EBMinosWriteStorageAlertAndAdminMessage",["EBMinosBridgedAPI","EBMinosHasNewerMailboxKeys","EBMinosSecureMailboxKeysForContact","EBMinosWriteKeyChangeAdminMessage","EBMinosWriteSecureStorageAlert","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t,n){var a=await o("EBMinosSecureMailboxKeysForContact").getSecureMailboxKeysForContact(e);o("EBMinosHasNewerMailboxKeys").hasNewerMailboxKeys(a,t,n)&&(r("promiseDone")(o("EBMinosWriteSecureStorageAlert").writeMinosSecureStorageAlert({contactId:e,epochHead:t,epochHeadCreationTime:n})),r("promiseDone")(o("EBMinosWriteKeyChangeAdminMessage").writeMinosKeyChangeAdminMessage({contactId:e,epochHeadCreationTime:n})))}async function s(e,t,n){var a=await o("EBMinosSecureMailboxKeysForContact").getSecureMailboxKeysForContact(e);o("EBMinosHasNewerMailboxKeys").hasNewerMailboxKeys(a,t,n)&&(r("promiseDone")(r("EBMinosBridgedAPI").writeMinosSecureStorageAlert({contactId:e,epochHead:t,epochHeadCreationTime:n})),r("promiseDone")(r("EBMinosBridgedAPI").writeMinosKeyChangeAdminMessage({contactId:e,epochHeadCreationTime:n})))}l.writeStorageAlertAndAdminMessage=e,l.writeStorageAlertAndAdminMessageBridgedAPI=s}),98);
__d("EBSMDBAPI",["EBDB","EBSMProperties","FBLogger","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.hasUserGivenAutoRestoreConsent,n=t?["secure_encrypted_backups_epochs","secure_encrypted_backups_client_state"]:[];n.push("auto_restore_opt_out");var a=Array.from(r("EBSMProperties").persistedTables).filter(function(e){return!n.includes(e)});try{var i=t?[]:["device_state"];if(i=i.concat(a),i.length>0){var l=await o("EBDB").getEBDB();await l.runInTransaction(i,"readwrite",function(e){return Promise.all(i.map(function(t){return e.stores[t].clear()}))},"EBDB - clear on logout")}}catch(e){var s=r("getErrorSafe")(e);r("FBLogger")("wmi_eb").catching(s).mustfix("Error clearing EBIDB non-persisted rows")}}l.clearEBIDBNonPersistedRows=e}),98);
__d("EBSMWorkerThreadAPI",["EBAPIQPLPoints","EBDeps","I64","LSIntEnum","MAWWaitForBackendSetup","MWEncryptedBackupsFirstRestoreUpsellTime","Promise","QPLFlow","WAResultOrError","WebSession","justknobx","qpl","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=(c=r("requireDeferred"))("EBAddDeviceWithKeys").__setRef("EBSMWorkerThreadAPI"),m=c("EBAddDeviceWithRecoveryCode").__setRef("EBSMWorkerThreadAPI"),p=c("EBAddVirtualDevice").__setRef("EBSMWorkerThreadAPI"),_=c("EBDeleteBackupsOnClient").__setRef("EBSMWorkerThreadAPI"),f=c("EBDeleteEncryptedBackup").__setRef("EBSMWorkerThreadAPI"),g=c("EBFetchBackupIds").__setRef("EBSMWorkerThreadAPI"),h=c("EBGenerateRecoveryCode").__setRef("EBSMWorkerThreadAPI"),y=c("EBGetEBState").__setRef("EBSMWorkerThreadAPI"),C=c("EBGetLSVirtualDevices").__setRef("EBSMWorkerThreadAPI"),b=c("EBInitializeBackup").__setRef("EBSMWorkerThreadAPI"),v=c("EBIsEbEnabled").__setRef("EBSMWorkerThreadAPI"),S=c("EBOptOut").__setRef("EBSMWorkerThreadAPI"),R=c("EBOtcAddDevice").__setRef("EBSMWorkerThreadAPI"),L=c("EBRepairEpochs").__setRef("EBSMWorkerThreadAPI"),E=c("EBRevokeVirtualDevice").__setRef("EBSMWorkerThreadAPI"),k=c("EBSyncEpochs").__setRef("EBSMWorkerThreadAPI"),I={addDeviceWithEBKeys:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return d.load().then(function(e){return e.addDeviceWithEBKeys.apply(e,t)})},addDeviceWithRecoveryCode:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];if(t.length===0||t[0]==null)return(u||(u=n("Promise"))).reject("Missing args");var i=o("QPLFlow").startQPLFlow(r("qpl")._(521473756,"2768"),{annotations:{bool:{isBackendSetupOnStart:o("EBDeps").getDeps().isBackendSetupSuccessful(),isEBAddDeviceWithKeys:!1,isInWorker:!0}},timeoutInMs:r("justknobx")._("2444")});return m.load().then(function(e){return e.addDeviceWithRecoveryCode(babelHelpers.extends({},t[0],{qplFlow:i}))})},addVirtualDevice:function(t){var e=t.actionType,a=t.recoveryCodeData,i=o("QPLFlow").startQPLFlow(r("qpl")._(521483240,"615"),{annotations:{int:{actionType:e}},timeoutInMs:r("justknobx")._("4211")});return i.addPoint("add_virtual_device_worker_start"),a==null?(i.endFail("add_virtual_device_fail_no_recovery_code_worker"),(u||(u=n("Promise"))).resolve(o("WAResultOrError").makeError("ADD_VIRTUAL_DEVICE_NULL_RECOVERY_CODE_DATA"))):p.load().then(function(t){return t.addVirtualDevice({actionType:e,qplFlow:i,recoveryCodeData:a})})},deleteBackupsOnClient:function(t){var e=t.reason;return _.load().then(function(t){return t.deleteBackupsOnClient({reason:e})})},deleteEncryptedBackup:function(t){var e=t.reason,n=o("QPLFlow").startQPLFlow(r("qpl")._(521484370,"2995"),{timeoutInMs:r("justknobx")._("4553")});return n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_WORKER_START),f.load().then(function(t){return t.deleteEncryptedBackup({qplFlow:n,reason:e})})},ebOptOut:function(){var e=o("QPLFlow").startQPLFlow(r("qpl")._(521482558,"2558"),{annotations:{string:{ebSessionIdentifier:o("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime(),fetchBackupIdsVersion:"msys",sessionTabId:o("WebSession").getId()}}});return e.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_WORKER_START),S.load().then(function(t){return t.ebOptOut({qplFlow:e})})},fetchBackupIds:function(t){var e=o("QPLFlow").startQPLFlow(r("qpl")._(521471024,"2275"),{annotations:{string:{ebSessionIdentifier:o("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime(),fetchBackupIdsVersion:"msys",sessionTabId:o("WebSession").getId()}}});return e.addPoint("eb_fetch_backup_ids_worker_start"),g.load().then(function(n){return n.fetchBackupIds(t,e)})},generateRecoveryCode:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h.load().then(function(e){return e.generateRecoveryCode.apply(e,t)})},getEBState:function(){return y.load().then(function(e){return e.GetEbState()})},getLSVirtualDevices:function(t){return C.load().then(function(e){return e.getLSVirtualDevices(t)})},initializeBackup:function(a){var t=a.recoveryCodeData,i=a.virtualDeviceType,l=o("QPLFlow").startQPLFlow(r("qpl")._(521478750,"2850"),{annotations:{int:{virtualDeviceType:(e||(e=o("I64"))).to_int32(i)}},timeoutInMs:r("justknobx")._("4211")});l.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_WORKER_START);var c=e.equal(i,(s||(s=o("LSIntEnum"))).ofNumber(16));return t==null&&!c?(l.endFail("recoveryCodeData null for non-Automatic EB"),(u||(u=n("Promise"))).resolve(o("WAResultOrError").makeError("recoveryCodeData null for non-Automatic EB"))):b.load().then(function(e){return e.initializeBackup(l,i,t)})},isEbEnabled:function(){return v.load().then(function(e){return e.isEbEnabledEbSwitch()})},optOutOfBackup:function(){return(u||(u=n("Promise"))).resolve()},otcAddDevice:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=o("QPLFlow").startQPLFlow(r("qpl")._(521473756,"2768"),{annotations:{bool:{isBackendSetupOnStart:o("MAWWaitForBackendSetup").isBackendSetupSuccessful(),isEBAddDeviceWithKeys:!1,isInWorker:!0,isOTC:!0}},timeoutInMs:r("justknobx")._("2444")});return R.load().then(function(e){return e.otcAddDevice(babelHelpers.extends({},t[0],{qplFlow:a}))})},repairEpochs:function(){return L.load().then(function(e){return e.EBRepairEpochs()})},revokeVirtualDevice:function(t){var e=t.virtualDeviceId,n=o("QPLFlow").startQPLFlow(r("qpl")._(521473995,"3294"));return n.addPoint("revoke_virtual_device_worker_start"),E.load().then(function(t){return t.revokeVirtualDevice(e,n)})},syncEpochs:function(){return k.load().then(function(e){return e.EBSyncEpochs()})}},T=I;l.default=T}),98);
__d("EBStateConsistencyMonitor",["EBIsEbEnabled","EBLogger","EBWorkerEBDBApi","MAWEBLSInWorkerSwitch","MAWEBSwitch","MAWODSProxy","QPLFlow","Random","WAOdsEnums","WAShiftTimer","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v=o("EBLogger").EBLogger().tags(["EBStateConsistencyMonitor"]),S=(function(){function t(e){var t=this;this.$3=!1,this.$4=null,this.$5=!0,this.$6=0,this.$1=e,this.$2=new(o("WAShiftTimer")).ShiftTimer(function(){t.$7()})}var n=t.prototype;return n.start=function(){if(this.$3){v.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["EBStateConsistencyMonitor already running"])));return}this.$3=!0,v.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Starting EBStateConsistencyMonitor with interval ","ms"])),this.$1),this.$8(),this.$9()},n.stop=function(){if(!this.$3){v.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["EBStateConsistencyMonitor not running"])));return}this.$3=!1,this.$2.cancel(),v.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Stopped EBStateConsistencyMonitor"])))},n.$7=function(){this.$3&&(this.$8(),this.$9())},n.$9=function(){this.$3&&this.$2.onOrBefore(this.$1)},n.$8=async function(){try{var e=await this.$10();this.$11(e)}catch(e){e instanceof Error?v.catching(e).MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Failed to check EB state consistency"]))):v.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Failed to check EB state consistency: ",""])),String(e))}},n.$10=async function(){var e=Date.now(),t=r("MAWEBLSInWorkerSwitch").isEnabled(),n=await o("EBIsEbEnabled").isEBEnabled(),a=null;try{a=await o("EBWorkerEBDBApi").isEBEnabledEBDB()}catch(e){e instanceof Error?v.catching(e).MUSTFIX(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Failed to read EBDB client state directly"]))):v.DEBUG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Failed to read EBDB client state directly: ",""])),String(e))}return{ebdbDirectState:a,isEBEnabledState:n,timestamp:e,workerSwitchState:t}},n.$11=function(t){var e=t.ebdbDirectState,n=t.isEBEnabledState,a=t.timestamp,i=t.workerSwitchState,l=this.$5,s=this.$6,u=this.$12(t),c=u.length>0,d=l||c;if(l||this.$6++,!d){v.DEBUG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["No state changes detected, skipping ODS metrics"])));return}v.DEBUG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["EB State Snapshot: workerSwitch=",", isEBEnabled=",", ebdbDirect="," at "," shouldLogMetrics=",""])),String(i),String(n),e!=null?String(e):"null",a,d),!l&&u.length>0&&(u.forEach(function(e){o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_consistency.source_change."+e}),v.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["EB Source Change: "," state changed"])),e)}),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_consistency.sources_changed.count_"+u.length})),this.$5=!1,this.$4=t;var m=l?".first_time":".on_change",p=i===n;if(o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_consistency.worker_switch_vs_lightspeed."+(p?"consistent":"inconsistent")+m}),l&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_consistency.worker_switch_vs_lightspeed."+(p?"consistent":"inconsistent")+".first_time_only"}),p||v.WARN(y||(y=babelHelpers.taggedTemplateLiteralLoose(["EB State Inconsistency: WorkerSwitch(",") vs Lightspeed(",")"])),String(i),String(n)),e!=null){var _=i===e,S=n===e;o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_consistency.worker_switch_vs_ebdb."+(_?"consistent":"inconsistent")+m}),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_consistency.lightspeed_vs_ebdb."+(S?"consistent":"inconsistent")+m}),l&&(o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_consistency.worker_switch_vs_ebdb."+(_?"consistent":"inconsistent")+".first_time_only"}),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_consistency.lightspeed_vs_ebdb."+(S?"consistent":"inconsistent")+".first_time_only"})),_||v.WARN(C||(C=babelHelpers.taggedTemplateLiteralLoose(["EB State Inconsistency: WorkerSwitch(",") vs EBDB(",")"])),String(i),String(e)),S||v.WARN(b||(b=babelHelpers.taggedTemplateLiteralLoose(["EB State Inconsistency: Lightspeed(",") vs EBDB(",")"])),String(n),String(e));var R=p&&_&&S;if(o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_consistency.all_three_sources."+(R?"consistent":"inconsistent")+m}),l&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_consistency.all_three_sources."+(R?"consistent":"inconsistent")+".first_time_only"}),I(l)){var L=o("QPLFlow").startQPLFlow(r("qpl")._(521478131,"1562"),{annotations:{bool:{isFirstCheck:l,lightspeedVsEbdb:S,main_thread_state:r("MAWEBSwitch").isEnabled(),switchVsEbdb:_,switchVsLightspeed:p,worker_state:n,worker_switch_state:i},int:{timesChecked:s},string:{source:"consistency_monitor"}}});R?L.endSuccess():L.endFail("inconsistent_state")}}else o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_consistency.ebdb_direct_unavailable"+m}),l&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_consistency.ebdb_direct_unavailable.first_time_only"})},n.$12=function(t){if(this.$4==null)return[];var e=this.$4,n=[];return e.workerSwitchState!==t.workerSwitchState&&n.push("worker_switch"),e.isEBEnabledState!==t.isEBEnabledState&&n.push("lightspeed"),e.ebdbDirectState!==t.ebdbDirectState&&n.push("ebdb_direct"),n},n.isRunning=function(){return this.$3},t})(),R=null;function L(){if(R==null){var e=r("justknobx")._("3206");R=new S(e)}return R}function E(){var e=L();e.start()}function k(){var e=L();e.stop()}function I(e){var t=e?r("justknobx")._("3455"):r("justknobx")._("3679");return o("Random").random()<t/100}l.getEBStateConsistencyMonitor=L,l.startEBStateConsistencyMonitoring=E,l.stopEBStateConsistencyMonitoring=k}),98);
__d("EBSyncMailboxKeysForContacts",["EBMinosFetchContactKeys","EBMinosLogger","EBMinosMailboxKeysCache","EBMinosQplFlow","EBMinosVerifyEpochAndWriteMailboxKey"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(t){var n="SPECIFIC_CONTACTS",r=o("EBMinosQplFlow").startMinosMailboxKeyFetchQpl(),a=t.filter(function(t){var n=o("EBMinosMailboxKeysCache").getCachedMailboxKeys(t);return n==null?(o("EBMinosLogger").minosLogger.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Cached mailbox keys not found for contact ",""])),t),!0):!1});if(a.length===0){r.endSuccess({string:{reason:"cache_hit"}});return}r.addPoint("fetch_keys_start");var i=await o("EBMinosFetchContactKeys").fetchContactMinosKeys({contactIds:a,useCase:n});if(r.addPoint("fetch_keys_end"),i.value==null){r.endSuccess({string:{reason:"server does_not_have_keys"}});return}if(!i.success){r.endFailWithError("fetch_keys_failed",i.error);return}r.addPoint("verify_keys_start");var l=i.value.contactKeys.map(function(e){var t=e.contactId,n=e.mailboxPublicKeys;return n==null?Promise.resolve(!1):o("EBMinosVerifyEpochAndWriteMailboxKey").verifyEpochAndWriteMailboxKeyToMailbox(babelHelpers.extends({entryPoint:"fetch-and-verify-minos-keys",userFbid:t},n),o("EBMinosLogger").minosLogger)});r.addPoint("verify_keys_end"),Promise.all(l).then(function(e){var t=e.every(function(e){return e===!0});t?r.endSuccess():r.endFailWithError("verify_keys_failed","One or more keys failed verification")}).catch(function(e){o("EBMinosLogger").minosLogger.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to verify keys: ",""])),e.message),r.endFailWithError("verify_keys_failed",e.message)})}l.syncMailboxKeysForContacts=u}),98);
__d("EBWorkerGetEBState",["EBLS","I64","LSAuthorityLevel","LSIntEnum","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(){var t;await o("EBLS").init();var n=await o("EBLS").getLSStorage(),a=await(t=o("ReQL")).firstAsync(t.fromTableAscending(n.tables.encrypted_backups)),i=await t.firstAsync(t.fromTableAscending(n.tables.secure_encrypted_backups_client_state));return a==null?2:(e||(e=o("I64"))).equal(a.authorityLevel,(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").OPTIMISTIC))?1:(e||(e=o("I64"))).equal(a.authorityLevel,(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))?d(i,a):-1}var c="-1";function d(t,n){var a=n.backupId;return a==null?2:(e||(e=o("I64"))).to_string(a)===c?-1:t==null||!(e||(e=o("I64"))).equal(t.authorityLevel,(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))||!(e||(e=o("I64"))).equal(t.backupId,a)?4:3}l.getEBWorkerState=u}),98);
__d("EBWorkerOptOut",[],(function(t,n,r,o,a,i){"use strict";async function e(){}i.ebOptOutInWorker=e}),66);
__d("EncryptedBackupsDYIFileUtils",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e="media",s="messages.zip";function u(){if(navigator.storage!=null&&navigator.storage.getDirectory!=null)return navigator.storage.getDirectory();throw r("FBLogger")("wmi_eb").mustfixThrow("Storage management API is not supported. Please try one of the supported browsers.")}async function c(){var t=await u();return t.getDirectoryHandle(e,{create:!0})}async function d(e,t,n){var o=await e.getFileHandle(t,{create:!0});try{var a=await o.createSyncAccessHandle();a.write(n),a.flush(),a.close()}catch(e){if(e instanceof Error){if(e instanceof TypeError)try{var i=await o.createWritable();await i.write(n),await i.close();return}catch(e){throw e instanceof Error?e instanceof TypeError?r("FBLogger")("wmi_eb").mustfixThrow("Write operation is not supported. Please try one of the supported browsers."):r("FBLogger")("wmi_eb").mustfixThrow("Failed to write using writable: %e",e.message):e}throw r("FBLogger")("wmi_eb").mustfixThrow("Failed to write using sync access handle: %s",e.message)}throw e}}async function m(e,t){var n=await e.getFileHandle(t);try{var o=await n.createSyncAccessHandle(),a=new ArrayBuffer(o.getSize());return o.read(a),o.close(),new Blob([a])}catch(e){if(e instanceof Error){if(e instanceof TypeError)return n.getFile();throw r("FBLogger")("wmi_eb").mustfixThrow("Failed to read file %s, %s",t,e.message)}throw e}}l.DyiMediaFolder=e,l.DyiArchiveFilename=s,l.getRootFolderHandle=u,l.getMediaFolderHandle=c,l.writeFile=d,l.readFile=m}),98);
__d("EncryptedBackupsDYIGenerateThreadMetadata",["CurrentUser","EncryptedBackupsDYISingleton","I64","IGDWebUtils","LSMessagingThreadTypeUtil","MAWThreadKeyUtils","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(){return o("IGDWebUtils").isOnInstagramWeb()?(u||(u=o("I64"))).of_string(r("CurrentUser").getEIMU()):(u||(u=o("I64"))).of_string(r("CurrentUser").getAccountID())}function d(e,t){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.threads).getKeyRange(o("MAWThreadKeyUtils").stringThreadKeyToI64(t)))}function m(e,t){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.contacts).getKeyRange(t))}function p(e,t){return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.tables.contacts).filter(function(e){return t.has((u||(u=o("I64"))).to_string(e.id))}))}function _(e,t){var n;return(n=o("ReQL")).toArrayAsync(n.leftJoin(n.fromTableAscending(e.tables.participants,["contactId"]).getKeyRange(t),n.fromTableAscending(e.tables.contacts,["name"])))}function f(e){return o("LSMessagingThreadTypeUtil").isOneToOne(e)||o("LSMessagingThreadTypeUtil").isOpenOneToOne(e)}function g(e,t,n){if(n!=null&&n.trim()!=="")return n+"_"+t;switch(e.length){case 0:return"Thread_"+t;case 1:return e[0]+"_"+t;case 2:return e[0]+"and"+e[1]+"_"+t;case 3:return""+e[0]+e[1]+"and"+e[2]+"_"+t;case 4:return""+e[0]+e[1]+e[2]+"and1other_"+t;default:return""+e[0]+e[1]+e[2]+"and"+(e.length-3)+"others_"+t}}async function h(t,n,r,a,i,l){var s=[],c=[i],p=await d(r,t);if(p!=null)if(f(p.threadType)){var h=n.getThreadIdForThreadKey(t);if(h==null){n.getLogger().WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Cannot find thread id for thread key ",""])),t);return}var y=await m(r,(u||(u=o("I64"))).of_string(h));(y==null?void 0:y.id)!=null&&(y==null?void 0:y.name)!=null&&n.setContactNameForContactId((u||(u=o("I64"))).to_string(y.id),y.name);var C=(y==null?void 0:y.name)||"Unknown User";s.push(C),c.push(C),n.setThreadMetaDataByThreadKey(t,c,g(s,l,p.threadName))}else{var b=await _(r,p.threadKey);b.forEach(function(e){var t=e[0],r=e[1];if((t==null?void 0:t.contactId)!=null&&(r==null?void 0:r.name)!=null&&n.setContactNameForContactId((u||(u=o("I64"))).to_string(t.contactId),r.name),!(u||(u=o("I64"))).equal(t.contactId,a)){var i=(r==null?void 0:r.name)||"Unknown User";s.push(i),c.push(i)}}),n.setThreadMetaDataByThreadKey(t,c,g(s,l,p.threadName))}else n.setThreadMetaDataByThreadKey(t,c,g(s,l))}async function y(e){var t,n,r=o("EncryptedBackupsDYISingleton").getSingleton(),a=r.getLogger(),i=await r.getDB(),l=await m(i,c()),d=(t=l==null?void 0:l.id)!=null?t:(u||(u=o("I64"))).zero,p=(n=l==null?void 0:l.name)!=null?n:"Me";return r.setContactNameForContactId((u||(u=o("I64"))).to_string(d),p),e.reduce(async function(e,t,n){await e;var o=r.getThreadIdForThreadKey(t);return o==null&&a.WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Cannot find thread id for thread key ",""])),t),h(t,r,i,d,p,n)},Promise.resolve())}l.getAllUnmappedContacts=p,l.EncryptedBackupsDYIGenerateThreadMetadata=y}),98);
__d("EncryptedBackupsDYITypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({NotStarted:0,InProgress:1,Completed:2,Failed:3}),l=n("$InternalEnum")({Armadillo:0,Instamadillo:1});i.EncryptedBackupsDYIState=e,i.EncryptedBackupsDYIConfig=l}),66);
/**
 * License: https://www.facebook.com/legal/license/MDzNl_j9yvg/
 */
__d("fflate-0.6.10",[],(function(t,n,r,o,a,i){"use strict";var e={},l={exports:e};function s(){var t,n="";try{t={}.Worker}catch(e){}e.default=t?function(e,r,o,a,i){var l=!1,s=new t(e+n,{eval:!0}).on("error",function(e){return i(e,null)}).on("message",function(e){return i(null,e)}).on("exit",function(e){e&&!l&&i(new Error("exited with code "+e),null)});return s.postMessage(o,a),s.terminate=function(){return l=!0,t.prototype.terminate.call(s)},s}:function(e,t,n,r,o){setImmediate(function(){return o(new Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var a=function(){};return{terminate:a,postMessage:a}}}var u=!1;function c(){return u||(u=!0,s()),l.exports}var d={},m={exports:d};function p(){var e=c(),t=Uint8Array,n=Uint16Array,r=Uint32Array,o=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),i=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=function(e,t){for(var o=new n(31),a=0;a<31;++a)o[a]=t+=1<<e[a-1];for(var i=new r(o[30]),a=1;a<30;++a)for(var l=o[a];l<o[a+1];++l)i[l]=l-o[a]<<5|a;return[o,i]},s=l(o,2),u=s[0],m=s[1];u[28]=258,m[258]=28;for(var p=l(a,0),_=p[0],f=p[1],g=new n(32768),h=0;h<32768;++h){var y=(h&43690)>>>1|(h&21845)<<1;y=(y&52428)>>>2|(y&13107)<<2,y=(y&61680)>>>4|(y&3855)<<4,g[h]=((y&65280)>>>8|(y&255)<<8)>>>1}for(var C=(function(e,t,r){for(var o=e.length,a=0,i=new n(t);a<o;++a)++i[e[a]-1];var l=new n(t);for(a=0;a<t;++a)l[a]=l[a-1]+i[a-1]<<1;var s;if(r){s=new n(1<<t);var u=15-t;for(a=0;a<o;++a)if(e[a])for(var c=a<<4|e[a],d=t-e[a],m=l[e[a]-1]++<<d,p=m|(1<<d)-1;m<=p;++m)s[g[m]>>>u]=c}else for(s=new n(o),a=0;a<o;++a)e[a]&&(s[a]=g[l[e[a]-1]++]>>>15-e[a]);return s}),b=new t(288),h=0;h<144;++h)b[h]=8;for(var h=144;h<256;++h)b[h]=9;for(var h=256;h<280;++h)b[h]=7;for(var h=280;h<288;++h)b[h]=8;for(var v=new t(32),h=0;h<32;++h)v[h]=5;var S=C(b,9,0),R=C(b,9,1),L=C(v,5,0),E=C(v,5,1),k=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},I=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(t&7)&n},T=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)},D=function(e){return(e/8|0)+(e&7&&1)},x=function(e,o,a){(o==null||o<0)&&(o=0),(a==null||a>e.length)&&(a=e.length);var i=new(e instanceof n?n:e instanceof r?r:t)(a-o);return i.set(e.subarray(o,a)),i},$=function(e,n,r){var l=e.length;if(!l||r&&!r.l&&l<5)return n||new t(0);var s=!n||r,c=!r||r.i;r||(r={}),n||(n=new t(l*3));var d=function(e){var r=n.length;if(e>r){var o=new t(Math.max(r*2,e));o.set(n),n=o}},m=r.f||0,p=r.p||0,f=r.b||0,g=r.l,h=r.d,y=r.m,b=r.n,v=l*8;do{if(!g){r.f=m=I(e,p,1);var S=I(e,p+1,3);if(p+=3,S)if(S==1)g=R,h=E,y=9,b=5;else if(S==2){var N=I(e,p,31)+257,M=I(e,p+10,15)+4,w=N+I(e,p+5,31)+1;p+=14;for(var A=new t(w),F=new t(19),O=0;O<M;++O)F[i[O]]=I(e,p+O*3,7);p+=M*3;for(var B=k(F),W=(1<<B)-1,q=C(F,B,1),O=0;O<w;){var U=q[I(e,p,W)];p+=U&15;var L=U>>>4;if(L<16)A[O++]=L;else{var V=0,H=0;for(L==16?(H=3+I(e,p,3),p+=2,V=A[O-1]):L==17?(H=3+I(e,p,7),p+=3):L==18&&(H=11+I(e,p,127),p+=7);H--;)A[O++]=V}}var G=A.subarray(0,N),z=A.subarray(N);y=k(G),b=k(z),g=C(G,y,1),h=C(z,b,1)}else throw"invalid block type";else{var L=D(p)+4,$=e[L-4]|e[L-3]<<8,P=L+$;if(P>l){if(c)throw"unexpected EOF";break}s&&d(f+$),n.set(e.subarray(L,P),f),r.b=f+=$,r.p=p=P*8;continue}if(p>v){if(c)throw"unexpected EOF";break}}s&&d(f+131072);for(var j=(1<<y)-1,K=(1<<b)-1,Q=p;;Q=p){var V=g[T(e,p)&j],X=V>>>4;if(p+=V&15,p>v){if(c)throw"unexpected EOF";break}if(!V)throw"invalid length/literal";if(X<256)n[f++]=X;else if(X==256){Q=p,g=null;break}else{var Y=X-254;if(X>264){var O=X-257,J=o[O];Y=I(e,p,(1<<J)-1)+u[O],p+=J}var Z=h[T(e,p)&K],ee=Z>>>4;if(!Z)throw"invalid distance";p+=Z&15;var z=_[ee];if(ee>3){var J=a[ee];z+=T(e,p)&(1<<J)-1,p+=J}if(p>v){if(c)throw"unexpected EOF";break}s&&d(f+131072);for(var te=f+Y;f<te;f+=4)n[f]=n[f-z],n[f+1]=n[f+1-z],n[f+2]=n[f+2-z],n[f+3]=n[f+3-z];f=te}}r.l=g,r.p=Q,r.b=f,g&&(m=1,r.m=y,r.d=h,r.n=b)}while(!m);return f==n.length?n:x(n,0,f)},P=function(e,t,n){n<<=t&7;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8},N=function(e,t,n){n<<=t&7;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},M=function(e,r){for(var o=[],a=0;a<e.length;++a)e[a]&&o.push({s:a,f:e[a]});var i=o.length,l=o.slice();if(!i)return[q,0];if(i==1){var s=new t(o[0].s+1);return s[o[0].s]=1,[s,1]}o.sort(function(e,t){return e.f-t.f}),o.push({s:-1,f:25001});var u=o[0],c=o[1],d=0,m=1,p=2;for(o[0]={s:-1,f:u.f+c.f,l:u,r:c};m!=i-1;)u=o[o[d].f<o[p].f?d++:p++],c=o[d!=m&&o[d].f<o[p].f?d++:p++],o[m++]={s:-1,f:u.f+c.f,l:u,r:c};for(var _=l[0].s,a=1;a<i;++a)l[a].s>_&&(_=l[a].s);var f=new n(_+1),g=w(o[m-1],f,0);if(g>r){var a=0,h=0,y=g-r,C=1<<y;for(l.sort(function(e,t){return f[t.s]-f[e.s]||e.f-t.f});a<i;++a){var b=l[a].s;if(f[b]>r)h+=C-(1<<g-f[b]),f[b]=r;else break}for(h>>>=y;h>0;){var v=l[a].s;f[v]<r?h-=1<<r-f[v]++-1:++a}for(;a>=0&&h;--a){var S=l[a].s;f[S]==r&&(--f[S],++h)}g=r}return[new t(f),g]},w=function(e,t,n){return e.s==-1?Math.max(w(e.l,t,n+1),w(e.r,t,n+1)):t[e.s]=n},A=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new n(++t),o=0,a=e[0],i=1,l=function(e){r[o++]=e},s=1;s<=t;++s)if(e[s]==a&&s!=t)++i;else{if(!a&&i>2){for(;i>138;i-=138)l(32754);i>2&&(l(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(l(a),--i;i>6;i-=6)l(8304);i>2&&(l(i-3<<5|8208),i=0)}for(;i--;)l(a);i=1,a=e[s]}return[r.subarray(0,o),t]},F=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},O=function(e,t,n){var r=n.length,o=D(t+2);e[o]=r&255,e[o+1]=r>>>8,e[o+2]=e[o]^255,e[o+3]=e[o+1]^255;for(var a=0;a<r;++a)e[o+a+4]=n[a];return(o+4+r)*8},B=function(e,t,r,l,s,u,c,d,m,p,_){P(t,_++,r),++s[256];for(var f=M(s,15),g=f[0],h=f[1],y=M(u,15),R=y[0],E=y[1],k=A(g),I=k[0],T=k[1],D=A(R),x=D[0],$=D[1],w=new n(19),B=0;B<I.length;++B)w[I[B]&31]++;for(var B=0;B<x.length;++B)w[x[B]&31]++;for(var W=M(w,7),q=W[0],U=W[1],V=19;V>4&&!q[i[V-1]];--V);var H=p+5<<3,G=F(s,b)+F(u,v)+c,z=F(s,g)+F(u,R)+c+14+3*V+F(w,q)+(2*w[16]+3*w[17]+7*w[18]);if(H<=G&&H<=z)return O(t,_,e.subarray(m,m+p));var j,K,Q,X;if(P(t,_,1+(z<G)),_+=2,z<G){j=C(g,h,0),K=g,Q=C(R,E,0),X=R;var Y=C(q,U,0);P(t,_,T-257),P(t,_+5,$-1),P(t,_+10,V-4),_+=14;for(var B=0;B<V;++B)P(t,_+3*B,q[i[B]]);_+=3*V;for(var J=[I,x],Z=0;Z<2;++Z)for(var ee=J[Z],B=0;B<ee.length;++B){var te=ee[B]&31;P(t,_,Y[te]),_+=q[te],te>15&&(P(t,_,ee[B]>>>5&127),_+=ee[B]>>>12)}}else j=S,K=b,Q=L,X=v;for(var B=0;B<d;++B)if(l[B]>255){var te=l[B]>>>18&31;N(t,_,j[te+257]),_+=K[te+257],te>7&&(P(t,_,l[B]>>>23&31),_+=o[te]);var ne=l[B]&31;N(t,_,Q[ne]),_+=X[ne],ne>3&&(N(t,_,l[B]>>>5&8191),_+=a[ne])}else N(t,_,j[l[B]]),_+=K[l[B]];return N(t,_,j[256]),_+K[256]},W=new r([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),q=new t(0),U=function(e,i,l,s,u,c){var d=e.length,p=new t(s+d+5*(1+Math.ceil(d/7e3))+u),_=p.subarray(s,p.length-u),g=0;if(!i||d<8)for(var h=0;h<=d;h+=65535){var y=h+65535;y<d?g=O(_,g,e.subarray(h,y)):(_[h]=c,g=O(_,g,e.subarray(h,d)))}else{for(var C=W[i-1],b=C>>>13,v=C&8191,S=(1<<l)-1,R=new n(32768),L=new n(S+1),E=Math.ceil(l/3),k=2*E,I=function(t){return(e[t]^e[t+1]<<E^e[t+2]<<k)&S},T=new r(25e3),$=new n(288),P=new n(32),N=0,M=0,h=0,w=0,A=0,F=0;h<d;++h){var U=I(h),V=h&32767,H=L[U];if(R[V]=H,L[U]=V,A<=h){var G=d-h;if((N>7e3||w>24576)&&G>423){g=B(e,_,0,T,$,P,M,w,F,h-F,g),w=N=M=0,F=h;for(var z=0;z<286;++z)$[z]=0;for(var z=0;z<30;++z)P[z]=0}var j=2,K=0,Q=v,X=V-H&32767;if(G>2&&U==I(h-X))for(var Y=Math.min(b,G)-1,J=Math.min(32767,h),Z=Math.min(258,G);X<=J&&--Q&&V!=H;){if(e[h+j]==e[h+j-X]){for(var ee=0;ee<Z&&e[h+ee]==e[h+ee-X];++ee);if(ee>j){if(j=ee,K=X,ee>Y)break;for(var te=Math.min(X,ee-2),ne=0,z=0;z<te;++z){var re=h-X+z+32768&32767,oe=R[re],ae=re-oe+32768&32767;ae>ne&&(ne=ae,H=re)}}}V=H,H=R[V],X+=V-H+32768&32767}if(K){T[w++]=268435456|m[j]<<18|f[K];var ie=m[j]&31,le=f[K]&31;M+=o[ie]+a[le],++$[257+ie],++P[le],A=h+j,++N}else T[w++]=e[h],++$[e[h]]}}g=B(e,_,c,T,$,P,M,w,F,h-F,g),!c&&g&7&&(g=O(_,g+1,q))}return x(p,0,s+D(g)+u)},V=(function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var n=t,r=9;--r;)n=(n&1&&-306674912)^n>>>1;e[t]=n}return e})(),H=function(){var e=-1;return{p:function(t){for(var n=e,r=0;r<t.length;++r)n=V[n&255^t[r]]^n>>>8;e=n},d:function(){return~e}}},G=function(){var e=1,t=0;return{p:function(n){for(var r=e,o=t,a=n.length,i=0;i!=a;){for(var l=Math.min(i+2655,a);i<l;++i)o+=r+=n[i];r=(r&65535)+15*(r>>16),o=(o&65535)+15*(o>>16)}e=r,t=o},d:function(){return e%=65521,t%=65521,(e&255)<<24|e>>>8<<16|(t&255)<<8|t>>>8}}},z=function(e,t,n,r,o){return U(e,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):12+t.mem,n,r,!o)},j=function(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n},K=function(e,t,n){for(var r=e(),o=e.toString(),a=o.slice(o.indexOf("[")+1,o.lastIndexOf("]")).replace(/ /g,"").split(","),i=0;i<r.length;++i){var l=r[i],s=a[i];if(typeof l=="function"){t+=";"+s+"=";var u=l.toString();if(l.prototype)if(u.indexOf("[native code]")!=-1){var c=u.indexOf(" ",8)+1;t+=u.slice(c,u.indexOf("(",c))}else{t+=u;for(var d in l.prototype)t+=";"+s+".prototype."+d+"="+l.prototype[d].toString()}else t+=u}else n[s]=l}return[t,n]},Q=[],X=function(e){var o=[];for(var a in e)(e[a]instanceof t||e[a]instanceof n||e[a]instanceof r)&&o.push((e[a]=new e[a].constructor(e[a])).buffer);return o},Y=function(t,n,r,o){var a;if(!Q[r]){for(var i="",l={},s=t.length-1,u=0;u<s;++u)a=K(t[u],i,l),i=a[0],l=a[1];Q[r]=K(t[s],i,l)}var c=j({},Q[r][1]);return e.default(Q[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+n.toString()+"}",r,c,X(c),o)},J=function(){return[t,n,r,o,a,i,u,_,R,E,g,C,k,I,T,D,x,$,Ie,oe,ae]},Z=function(){return[t,n,r,o,a,i,m,f,S,b,L,v,g,W,q,C,P,N,M,w,A,F,O,B,D,x,U,z,Re,oe]},ee=function(){return[pe,ge,me,H,V]},te=function(){return[_e,fe]},ne=function(){return[he,me,G]},re=function(){return[ye]},oe=function(e){return postMessage(e,[e.buffer])},ae=function(e){return e&&e.size&&new t(e.size)},ie=function(e,t,n,r,o,a){var i=Y(n,r,o,function(e,t){i.terminate(),a(e,t)});return i.postMessage([e,t],t.consume?[e.buffer]:[]),function(){i.terminate()}},le=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},se=function(e,t,n,r,o){var a,i=Y(e,r,o,function(e,n){e?(i.terminate(),t.ondata.call(t,e)):(n[1]&&i.terminate(),t.ondata.call(t,e,n[0],n[1]))});i.postMessage(n),t.push=function(e,n){if(a)throw"stream finished";if(!t.ondata)throw"no stream handler";i.postMessage([e,a=n],[e.buffer])},t.terminate=function(){i.terminate()}},ue=function(e,t){return e[t]|e[t+1]<<8},ce=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},de=function(e,t){return ce(e,t)+ce(e,t+4)*4294967296},me=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},pe=function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:t.level==9?2:0,e[9]=3,t.mtime!=0&&me(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var r=0;r<=n.length;++r)e[r+10]=n.charCodeAt(r)}},_e=function(e){if(e[0]!=31||e[1]!=139||e[2]!=8)throw"invalid gzip data";var t=e[3],n=10;t&4&&(n+=e[10]|(e[11]<<8)+2);for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(t&2)},fe=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},ge=function(e){return 10+(e.filename&&e.filename.length+1||0)},he=function(e,t){var n=t.level,r=n==0?0:n<6?1:n==9?3:2;e[0]=120,e[1]=r<<6|(r?32-2*r:1)},ye=function(e){if((e[0]&15)!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(e[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Ce(e,t){return!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,e}var be=(function(){function e(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(z(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e})();d.Deflate=be;var ve=(function(){function e(e,t){se([Z,function(){return[le,be]}],this,Ce.call(this,e,t),function(e){var t=new be(e.data);onmessage=le(t)},6)}return e})();d.AsyncDeflate=ve;function Se(e,t,n){if(n||(n=t,t={}),typeof n!="function")throw"no callback";return ie(e,t,[Z],function(e){return oe(Re(e.data[0],e.data[1]))},0,n)}d.deflate=Se;function Re(e,t){return z(e,t||{},0,0)}d.deflateSync=Re;var Le=(function(){function e(e){this.s={},this.p=new t(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var n=this.p.length,r=new t(n+e.length);r.set(this.p),r.set(e,n),this.p=r},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=$(this.p,this.o,this.s);this.ondata(x(n,t,this.s.b),this.d),this.o=x(n,this.s.b-32768),this.s.b=this.o.length,this.p=x(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e})();d.Inflate=Le;var Ee=(function(){function e(e){this.ondata=e,se([J,function(){return[le,Le]}],this,0,function(){var e=new Le;onmessage=le(e)},7)}return e})();d.AsyncInflate=Ee;function ke(e,t,n){if(n||(n=t,t={}),typeof n!="function")throw"no callback";return ie(e,t,[J],function(e){return oe(Ie(e.data[0],ae(e.data[1])))},1,n)}d.inflate=ke;function Ie(e,t){return $(e,t)}d.inflateSync=Ie;var Te=(function(){function e(e,t){this.c=H(),this.l=0,this.v=1,be.call(this,e,t)}return e.prototype.push=function(e,t){be.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=z(e,this.o,this.v&&ge(this.o),t&&8,!t);this.v&&(pe(n,this.o),this.v=0),t&&(me(n,n.length-8,this.c.d()),me(n,n.length-4,this.l)),this.ondata(n,t)},e})();d.Gzip=Te,d.Compress=Te;var De=(function(){function e(e,t){se([Z,ee,function(){return[le,be,Te]}],this,Ce.call(this,e,t),function(e){var t=new Te(e.data);onmessage=le(t)},8)}return e})();d.AsyncGzip=De,d.AsyncCompress=De;function xe(e,t,n){if(n||(n=t,t={}),typeof n!="function")throw"no callback";return ie(e,t,[Z,ee,function(){return[$e]}],function(e){return oe($e(e.data[0],e.data[1]))},2,n)}d.gzip=xe,d.compress=xe;function $e(e,t){t||(t={});var n=H(),r=e.length;n.p(e);var o=z(e,t,ge(t),8),a=o.length;return pe(o,t),me(o,a-8,n.d()),me(o,a-4,r),o}d.gzipSync=$e,d.compressSync=$e;var Pe=(function(){function e(e){this.v=1,Le.call(this,e)}return e.prototype.push=function(e,t){if(Le.prototype.e.call(this,e),this.v){var n=this.p.length>3?_e(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Le.prototype.c.call(this,t)},e})();d.Gunzip=Pe;var Ne=(function(){function e(e){this.ondata=e,se([J,te,function(){return[le,Le,Pe]}],this,0,function(){var e=new Pe;onmessage=le(e)},9)}return e})();d.AsyncGunzip=Ne;function Me(e,t,n){if(n||(n=t,t={}),typeof n!="function")throw"no callback";return ie(e,t,[J,te,function(){return[we]}],function(e){return oe(we(e.data[0]))},3,n)}d.gunzip=Me;function we(e,n){return $(e.subarray(_e(e),-8),n||new t(fe(e)))}d.gunzipSync=we;var Ae=(function(){function e(e,t){this.c=G(),this.v=1,be.call(this,e,t)}return e.prototype.push=function(e,t){be.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var n=z(e,this.o,this.v&&2,t&&4,!t);this.v&&(he(n,this.o),this.v=0),t&&me(n,n.length-4,this.c.d()),this.ondata(n,t)},e})();d.Zlib=Ae;var Fe=(function(){function e(e,t){se([Z,ne,function(){return[le,be,Ae]}],this,Ce.call(this,e,t),function(e){var t=new Ae(e.data);onmessage=le(t)},10)}return e})();d.AsyncZlib=Fe;function Oe(e,t,n){if(n||(n=t,t={}),typeof n!="function")throw"no callback";return ie(e,t,[Z,ne,function(){return[Be]}],function(e){return oe(Be(e.data[0],e.data[1]))},4,n)}d.zlib=Oe;function Be(e,t){t||(t={});var n=G();n.p(e);var r=z(e,t,2,4);return he(r,t),me(r,r.length-4,n.d()),r}d.zlibSync=Be;var We=(function(){function e(e){this.v=1,Le.call(this,e)}return e.prototype.push=function(e,t){if(Le.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Le.prototype.c.call(this,t)},e})();d.Unzlib=We;var qe=(function(){function e(e){this.ondata=e,se([J,re,function(){return[le,Le,We]}],this,0,function(){var e=new We;onmessage=le(e)},11)}return e})();d.AsyncUnzlib=qe;function Ue(e,t,n){if(n||(n=t,t={}),typeof n!="function")throw"no callback";return ie(e,t,[J,re,function(){return[Ve]}],function(e){return oe(Ve(e.data[0],ae(e.data[1])))},5,n)}d.unzlib=Ue;function Ve(e,t){return $((ye(e),e.subarray(2,-4)),t)}d.unzlibSync=Ve;var He=(function(){function e(e){this.G=Pe,this.I=Le,this.Z=We,this.ondata=e}return e.prototype.push=function(e,n){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,n);else{if(this.p&&this.p.length){var r=new t(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var o=this,a=function(){o.ondata.apply(o,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(a):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(a):new this.Z(a),this.s.push(this.p,n),this.p=null}}},e})();d.Decompress=He;var Ge=(function(){function e(e){this.G=Ne,this.I=Ee,this.Z=qe,this.ondata=e}return e.prototype.push=function(e,t){He.prototype.push.call(this,e,t)},e})();d.AsyncDecompress=Ge;function ze(e,t,n){if(n||(n=t,t={}),typeof n!="function")throw"no callback";return e[0]==31&&e[1]==139&&e[2]==8?Me(e,t,n):(e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31?ke(e,t,n):Ue(e,t,n)}d.decompress=ze;function je(e,t){return e[0]==31&&e[1]==139&&e[2]==8?we(e,t):(e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31?Ie(e,t):Ve(e,t)}d.decompressSync=je;var Ke=function(e,n,r,o){for(var a in e){var i=e[a],l=n+a;i instanceof t?r[l]=[i,o]:Array.isArray(i)?r[l]=[i[0],j(o,i[1])]:Ke(i,l+"/",r,o)}},Qe=typeof TextEncoder!="undefined"&&new TextEncoder,Xe=typeof TextDecoder!="undefined"&&new TextDecoder,Ye=0;try{Xe.decode(q,{stream:!0}),Ye=1}catch(e){}var Je=function(e){for(var t="",n=0;;){var r=e[n++],o=(r>127)+(r>223)+(r>239);if(n+o>e.length)return[t,x(e,n-1)];o?o==3?(r=((r&15)<<18|(e[n++]&63)<<12|(e[n++]&63)<<6|e[n++]&63)-65536,t+=String.fromCharCode(55296|r>>10,56320|r&1023)):o&1?t+=String.fromCharCode((r&31)<<6|e[n++]&63):t+=String.fromCharCode((r&15)<<12|(e[n++]&63)<<6|e[n++]&63):t+=String.fromCharCode(r)}},Ze=(function(){function e(e){this.ondata=e,Ye?this.t=new TextDecoder:this.p=q}return e.prototype.push=function(e,n){if(!this.ondata)throw"no callback";if(n=!!n,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),n),n){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var r=new t(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length);var o=Je(r),a=o[0],i=o[1];if(n){if(i.length)throw"invalid utf-8 data";this.p=null}else this.p=i;this.ondata(a,n)},e})();d.DecodeUTF8=Ze;var et=(function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(tt(e),this.d=t||!1)},e})();d.EncodeUTF8=et;function tt(e,n){if(n){for(var r=new t(e.length),o=0;o<e.length;++o)r[o]=e.charCodeAt(o);return r}if(Qe)return Qe.encode(e);for(var a=e.length,i=new t(e.length+(e.length>>1)),l=0,s=function(e){i[l++]=e},o=0;o<a;++o){if(l+5>i.length){var u=new t(l+8+(a-o<<1));u.set(i),i=u}var c=e.charCodeAt(o);c<128||n?s(c):c<2048?(s(192|c>>6),s(128|c&63)):c>55295&&c<57344?(c=65536+(c&1047552)|e.charCodeAt(++o)&1023,s(240|c>>18),s(128|c>>12&63),s(128|c>>6&63),s(128|c&63)):(s(224|c>>12),s(128|c>>6&63),s(128|c&63))}return x(i,0,l)}d.strToU8=tt;function nt(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}else{if(Xe)return Xe.decode(e);var o=Je(e),a=o[0],i=o[1];if(i.length)throw"invalid utf-8 data";return a}}d.strFromU8=nt;var rt=function(e){return e==1?3:e<6?2:e==9?1:0},ot=function(e,t){return t+30+ue(e,t+26)+ue(e,t+28)},at=function(e,t,n){var r=ue(e,t+28),o=nt(e.subarray(t+46,t+46+r),!(ue(e,t+8)&2048)),a=t+46+r,i=ce(e,t+20),l=n&&i==4294967295?it(e,a):[i,ce(e,t+24),ce(e,t+42)],s=l[0],u=l[1],c=l[2];return[ue(e,t+10),s,u,o,a+ue(e,t+30)+ue(e,t+32),c]},it=function(e,t){for(;ue(e,t)!=1;t+=4+ue(e,t+2));return[de(e,t+12),de(e,t+4),de(e,t+20)]},lt=function(e){var t=0;if(e)for(var n in e){var r=e[n].length;if(r>65535)throw"extra field too long";t+=r+4}return t},st=function(e,t,n,r,o,a,i,l){var s=r.length,u=n.extra,c=l&&l.length,d=lt(u);me(e,t,i!=null?33639248:67324752),t+=4,i!=null&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(a==null&&8),e[t++]=o&&8,e[t++]=n.compression&255,e[t++]=n.compression>>8;var m=new Date(n.mtime==null?Date.now():n.mtime),p=m.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(me(e,t,p<<25|m.getMonth()+1<<21|m.getDate()<<16|m.getHours()<<11|m.getMinutes()<<5|m.getSeconds()>>>1),t+=4,a!=null&&(me(e,t,n.crc),me(e,t+4,a),me(e,t+8,n.size)),me(e,t+12,s),me(e,t+14,d),t+=16,i!=null&&(me(e,t,c),me(e,t+6,n.attrs),me(e,t+10,i),t+=14),e.set(r,t),t+=s,d)for(var _ in u){var f=u[_],g=f.length;me(e,t,+_),me(e,t+2,g),e.set(f,t+4),t+=4+g}return c&&(e.set(l,t),t+=c),t},ut=function(e,t,n,r,o){me(e,t,101010256),me(e,t+8,n),me(e,t+10,n),me(e,t+12,r),me(e,t+16,o)},ct=(function(){function e(e){this.filename=e,this.c=H(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e})();d.ZipPassThrough=ct;var dt=(function(){function e(e,t){var n=this;t||(t={}),ct.call(this,e),this.d=new be(t,function(e,t){n.ondata(null,e,t)}),this.compression=8,this.flag=rt(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){ct.prototype.push.call(this,e,t)},e})();d.ZipDeflate=dt;var mt=(function(){function e(e,t){var n=this;t||(t={}),ct.call(this,e),this.d=new ve(t,function(e,t,r){n.ondata(e,t,r)}),this.compression=8,this.flag=rt(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){ct.prototype.push.call(this,e,t)},e})();d.AsyncZipDeflate=mt;var pt=(function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var n=this;if(this.d&2)throw"stream finished";var r=tt(e.filename),o=r.length,a=e.comment,i=a&&tt(a),l=o!=e.filename.length||i&&a.length!=i.length,s=o+lt(e.extra)+30;if(o>65535)throw"filename too long";var u=new t(s);st(u,0,e,r,l);var c=[u],d=function(){for(var e=0,t=c;e<t.length;e++){var r=t[e];n.ondata(null,r,!1)}c=[]},m=this.d;this.d=0;var p=this.u.length,_=j(e,{f:r,u:l,o:i,t:function(){e.terminate&&e.terminate()},r:function(){if(d(),m){var e=n.u[p+1];e?e.r():n.d=1}m=1}}),f=0;e.ondata=function(r,o,a){if(r)n.ondata(r,o,a),n.terminate();else if(f+=o.length,c.push(o),a){var i=new t(16);me(i,0,134695760),me(i,4,e.crc),me(i,8,f),me(i,12,e.size),c.push(i),_.c=f,_.b=s+f+16,_.crc=e.crc,_.size=e.size,m&&_.r(),m=1}else m&&d()},this.u.push(_)},e.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){e.d&1&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,n=0,r=0,o=0,a=this.u;o<a.length;o++){var i=a[o];r+=46+i.f.length+lt(i.extra)+(i.o?i.o.length:0)}for(var l=new t(r+22),s=0,u=this.u;s<u.length;s++){var i=u[s];st(l,e,i,i.f,i.u,i.c,n,i.o),e+=46+i.f.length+lt(i.extra)+(i.o?i.o.length:0),n+=i.b}ut(l,e,this.u.length,r,n),this.ondata(null,l,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},e})();d.Zip=pt;function _t(e,n,r){if(r||(r=n,n={}),typeof r!="function")throw"no callback";var o={};Ke(e,"",o,n);var a=Object.keys(o),i=a.length,l=0,s=0,u=i,c=new Array(i),d=[],m=function(){for(var e=0;e<d.length;++e)d[e]()},p=function(){var e=new t(s+22),n=l,o=s-l;s=0;for(var a=0;a<u;++a){var i=c[a];try{var d=i.c.length;st(e,s,i,i.f,i.u,d);var m=30+i.f.length+lt(i.extra),p=s+m;e.set(i.c,p),st(e,l,i,i.f,i.u,d,s,i.m),l+=16+m+(i.m?i.m.length:0),s=p+d}catch(e){return r(e,null)}}ut(e,l,c.length,o,n),r(null,e)};i||p();for(var _=function(e){var t=a[e],n=o[t],u=n[0],_=n[1],f=H(),g=u.length;f.p(u);var h=tt(t),y=h.length,C=_.comment,b=C&&tt(C),v=b&&b.length,S=lt(_.extra),R=_.level==0?0:8,L=function(n,o){if(n)m(),r(n,null);else{var a=o.length;c[e]=j(_,{size:g,crc:f.d(),c:o,f:h,m:b,u:y!=t.length||b&&C.length!=v,compression:R}),l+=30+y+S+a,s+=76+2*(y+S)+(v||0)+a,--i||p()}};if(y>65535&&L("filename too long",null),!R)L(null,u);else if(g<16e4)try{L(null,Re(u,_))}catch(e){L(e,null)}else d.push(Se(u,_,L))},f=0;f<u;++f)_(f);return m}d.zip=_t;function ft(e,n){n||(n={});var r={},o=[];Ke(e,"",r,n);var a=0,i=0;for(var l in r){var s=r[l],u=s[0],c=s[1],d=c.level==0?0:8,m=tt(l),p=m.length,_=c.comment,f=_&&tt(_),g=f&&f.length,h=lt(c.extra);if(p>65535)throw"filename too long";var y=d?Re(u,c):u,C=y.length,b=H();b.p(u),o.push(j(c,{size:u.length,crc:b.d(),c:y,f:m,m:f,u:p!=l.length||f&&_.length!=g,o:a,compression:d})),a+=30+p+h+C,i+=76+2*(p+h)+(g||0)+C}for(var v=new t(i+22),S=a,R=i-a,L=0;L<o.length;++L){var m=o[L];st(v,m.o,m,m.f,m.u,m.c.length);var E=30+m.f.length+lt(m.extra);v.set(m.c,m.o+E),st(v,a,m,m.f,m.u,m.c.length,m.o,m.m),a+=16+E+(m.m?m.m.length:0)}return ut(v,a,o.length,R,S),v}d.zipSync=ft;var gt=(function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e})();d.UnzipPassThrough=gt;var ht=(function(){function e(){var e=this;this.i=new Le(function(t,n){e.ondata(null,t,n)})}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},e.compression=8,e})();d.UnzipInflate=ht;var yt=(function(){function e(e,t){var n=this;t<32e4?this.i=new Le(function(e,t){n.ondata(null,e,t)}):(this.i=new Ee(function(e,t,r){n.ondata(e,t,r)}),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=x(e,0)),this.i.push(e,t)},e.compression=8,e})();d.AsyncUnzipInflate=yt;var Ct=(function(){function e(e){this.onfile=e,this.k=[],this.o={0:gt},this.p=q}return e.prototype.push=function(e,n){var r=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var o=Math.min(this.c,e.length),a=e.subarray(0,o);if(this.c-=o,this.d?this.d.push(a,!this.c):this.k[0].push(a),e=e.subarray(o),e.length)return this.push(e,n)}else{var i=0,l=0,s=void 0,u=void 0;this.p.length?e.length?(u=new t(this.p.length+e.length),u.set(this.p),u.set(e,this.p.length)):u=this.p:u=e;for(var c=u.length,d=this.c,m=d&&this.d,p=function(){var e,t=ce(u,l);if(t==67324752){i=1,s=l,_.d=null,_.c=0;var n=ue(u,l+6),o=ue(u,l+8),a=n&2048,m=n&8,p=ue(u,l+26),f=ue(u,l+28);if(c>l+30+p+f){var g=[];_.k.unshift(g),i=2;var h=ce(u,l+18),y=ce(u,l+22),C=nt(u.subarray(l+30,l+=30+p),!a);h==4294967295?(e=m?[-2]:it(u,l),h=e[0],y=e[1]):m&&(h=-1),l+=f,_.c=h;var b,v={name:C,compression:o,start:function(){if(!v.ondata)throw"no callback";if(!h)v.ondata(null,q,!0);else{var e=r.o[o];if(!e)throw"unknown compression type "+o;b=h<0?new e(C):new e(C,h,y),b.ondata=function(e,t,n){v.ondata(e,t,n)};for(var t=0,n=g;t<n.length;t++){var a=n[t];b.push(a,!1)}r.k[0]==g&&r.c?r.d=b:b.push(q,!0)}},terminate:function(){b&&b.terminate&&b.terminate()}};h>=0&&(v.size=h,v.originalSize=y),_.onfile(v)}return"break"}else if(d){if(t==134695760)return s=l+=12+(d==-2&&8),i=3,_.c=0,"break";if(t==33639248)return s=l-=4,i=3,_.c=0,"break"}},_=this;l<c-4;++l){var f=p();if(f==="break")break}if(this.p=q,d<0){var g=i?u.subarray(0,s-12-(d==-2&&8)-(ce(u,s-16)==134695760&&4)):u.subarray(0,l);m?m.push(g,!!i):this.k[+(i==2)].push(g)}if(i&2)return this.push(u.subarray(l),n);this.p=u.subarray(l)}if(n){if(this.c)throw"invalid zip file";this.p=null}},e.prototype.register=function(e){this.o[e.compression]=e},e})();d.Unzip=Ct;function bt(e,n){if(typeof n!="function")throw"no callback";for(var r=[],o=function(){for(var e=0;e<r.length;++e)r[e]()},a={},i=e.length-22;ce(e,i)!=101010256;--i)if(!i||e.length-i>65558){n("invalid zip file",null);return}var l=ue(e,i+8);l||n(null,{});var s=l,u=ce(e,i+16),c=u==4294967295;if(c){if(i=ce(e,i-12),ce(e,i)!=101075792){n("invalid zip file",null);return}s=l=ce(e,i+32),u=ce(e,i+48)}for(var d=function(i){var s=at(e,u,c),d=s[0],m=s[1],p=s[2],_=s[3],f=s[4],g=s[5],h=ot(e,g);u=f;var y=function(e,t){e?(o(),n(e,null)):(a[_]=t,--l||n(null,a))};if(!d)y(null,x(e,h,h+m));else if(d==8){var C=e.subarray(h,h+m);if(m<32e4)try{y(null,Ie(C,new t(p)))}catch(e){y(e,null)}else r.push(ke(C,{size:p},y))}else y("unknown compression type "+d,null)},m=0;m<s;++m)d(m);return o}d.unzip=bt;function vt(e){for(var n={},r=e.length-22;ce(e,r)!=101010256;--r)if(!r||e.length-r>65558)throw"invalid zip file";var o=ue(e,r+8);if(!o)return{};var a=ce(e,r+16),i=a==4294967295;if(i){if(r=ce(e,r-12),ce(e,r)!=101075792)throw"invalid zip file";o=ce(e,r+32),a=ce(e,r+48)}for(var l=0;l<o;++l){var s=at(e,a,i),u=s[0],c=s[1],d=s[2],m=s[3],p=s[4],_=s[5],f=ot(e,_);if(a=p,!u)n[m]=x(e,f,f+c);else if(u==8)n[m]=Ie(e.subarray(f,f+c),new t(d));else throw"unknown compression type "+u}return n}d.unzipSync=vt}var _=!1;function f(){return _||(_=!0,p()),m.exports}function g(e){switch(e){case void 0:return f()}}a.exports=g}),null);
__d("fflate",["fflate-0.6.10"],(function(t,n,r,o,a,i){a.exports=n("fflate-0.6.10")()}),null);
__d("EncryptedBackupsDYIZipUtils",["EncryptedBackupsDYIFileUtils","fflate"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m;async function p(t,n,r,a,i,l){var p=await o("EncryptedBackupsDYIFileUtils").getRootFolderHandle(),f=await p.getFileHandle("messages.zip",{create:!0});a("stream_file_start");var g=await f.createWritable({keepExisting:!1,mode:"exclusive"}),h=new(o("fflate")).Zip,y=0;h.ondata=function(t,n,o){if(t){r.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Generic stream error"]))),a("stream_file_error"),l(t);return}y++,y%1e3===0&&r.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Writing chunk #",""])),y),g.write(n).catch(function(e){r.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Error during data event"]))),a("stream_file_error"),l(e)}),o&&(r.LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Finished ZIP file generation. Saving the results"]))),a("stream_file_end"),a("write_file_start"),g.close().then(function(){a("write_file_end"),r.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Closed the writing stream"]))),i()}).catch(function(e){r.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Error during end event"]))),a("write_file_error"),l(e)}))};for(var C of t){var b=C.threadName+".json",v=new(o("fflate")).ZipDeflate(b,{level:9}),S=new TextEncoder().encode(JSON.stringify(C,null,2));h.add(v),v.push(S,!0)}for(var R of n)await _(h,R);h.end()}async function _(e,t){var n=t.split("/").pop(),r=await o("EncryptedBackupsDYIFileUtils").getMediaFolderHandle(),a=await o("EncryptedBackupsDYIFileUtils").readFile(r,n!=null?n:t),i=await a.arrayBuffer(),l=new Uint8Array(i),s=new(o("fflate")).ZipPassThrough(t);e.add(s),s.push(l,!0)}l.generateZipFile=p}),98);
__d("EncryptedBackupsDYISingleton",["EncryptedBackupsDYIFileUtils","EncryptedBackupsDYIGenerateThreadMetadata","EncryptedBackupsDYISingletonFactory","EncryptedBackupsDYITypes","EncryptedBackupsDYIZipUtils","FBLogger","I64","LSIntEnum","MAWBridge","MAWQplProxy","WAHashUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=["senderId"],s,u,c,d,m,p,_,f,g,h,y,C,b,v=null;function S(){try{return WorkerGlobalScope!==void 0&&self instanceof WorkerGlobalScope}catch(e){return!1}}function R(e,t,n){if(v==null)switch(e){case o("EncryptedBackupsDYITypes").EncryptedBackupsDYIConfig.Armadillo:if(S())throw r("FBLogger")("wmi_eb").mustfixThrow("EncryptedBackupsDYISingleton for Armadillo can only be initialised in the main thread");v=o("EncryptedBackupsDYISingletonFactory").getMAWEncryptedBackupsDYISingleton(t,n);break;case o("EncryptedBackupsDYITypes").EncryptedBackupsDYIConfig.Instamadillo:if(!S())throw r("FBLogger")("wmi_eb").mustfixThrow("EncryptedBackupsDYISingleton for Instamadillo can only be initialised in the worker");v=o("EncryptedBackupsDYISingletonFactory").getIGDEncryptedBackupsDYISingleton(t,n);break}}function L(){if(v==null)throw r("FBLogger")("wmi_eb").mustfixThrow("EncryptedBackupsDYISingleton is not initialised. Please call EncryptedBackupsDYISingleton.initSingleton() first.");return v}var E=(function(){function t(e,t,n,r){this.$5=new Map,this.$6=new Set,this.$7=new Set,this.$8=new Map,this.$9=new Map,this.$10=new Map,this.$11=new Map,this.$12=new Map,this.$1=e,this.$2=t,this.$3=n,this.$4=r}var n=t.prototype;return n.getDB=function(){return this.$1()},n.getLogger=function(){return this.$4},n.getAllMediaUrls=function(){return Array.from(this.$5.values())},n.$13=function(t){return this.$5.get(t)},n.setMediaUrlByPlainTextHash=function(t,n){this.$5.has(t)||this.$5.set(t,n)},n.addThreadKeyToThreadsRestoreInProgress=function(t){this.$6.add(t)},n.isThreadRestoreInProgressForThreadKey=function(t){return this.$6.has(t)},n.deleteThreadKeyFromThreadsRestoreInProgress=function(t){this.$6.delete(t),this.$4.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Finished handling message range queries for thread with thread key ",". "," threads left"])),t,this.$6.size),this.$14()&&(this.$4.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["DYI flow complete - generating output"]))),this.$15())},n.isThreadsRestoreComplete=function(){return this.$6.size===0},n.addPlaintextHashToAttachmentDownloadsInProgress=function(t){this.$7.add(t),this.$4.LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Started processing attachment with plaintext hash ","."])),o("WAHashUtils").sanitisePlaintextHash(t))},n.deletePlaintextHashFromAttachmentDownloadsInProgress=function(t){this.$7.delete(t),this.$4.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Finished processing attachment with plaintext hash ",". "," attachments left"])),o("WAHashUtils").sanitisePlaintextHash(t),this.$7.size),this.$7.size<30&&this.$4.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Remaining attachments: ",""])),Array.from(this.$7).map(o("WAHashUtils").sanitisePlaintextHash).join(", ")),this.$14()&&(this.$4.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["DYI flow complete - generating output"]))),this.$15())},n.isAttachmentDownloadInProgressForPlaintextHash=function(t){return this.$7.has(t)},n.isAttachmentDownloadCompleteForPlaintextHash=function(t){return!!this.$5.get(t)},n.isAttachmentDownloadComplete=function(){return this.$7.size===0},n.setMessagesByThreadKey=function(t,n,r){var e=this.getMessagesByThreadKey(t);e.set(n,r)},n.getMessagesByThreadKey=function(t){return this.$16(t)||this.$8.set(t,new Map),this.$8.get(t)},n.$16=function(t){return this.$8.has(t)},n.hasMessage=function(t,n){var e=this.$8.get(t);return e==null?!1:e.has(n)},n.getThreadIdForThreadKey=function(t){return this.$10.get(t)},n.getThreadKeyForThreadId=function(t){return this.$11.get(t)},n.setThreadMapping=function(t,n){this.$10.set(t,n),this.$11.set(n,t)},n.setThreadMetaDataByThreadKey=function(t,n,r){this.$9.set(t,{participants:n,threadName:r})},n.getThreadMetadataMap=function(){return this.$9},n.setContactNameForContactId=function(t,n){this.$12.set(t,n)},n.getContactNameForContactId=function(t){return this.$12.get(t)},n.getContactNameMap=function(){return this.$12},n.getOutput=function(){var t=this;return Array.from(this.getThreadMetadataMap(),function(n){var r=n[0],o=n[1],a=t.$16(r),i=a?Array.from(t.getMessagesByThreadKey(r),function(e){var n=e[0],r=e[1];return babelHelpers.extends({},r,{media:Array.from(r.media,function(e){var n=t.$13(e);return{uri:n!=null?"./"+n:"Failed to download media"}})})}):[];i=i.map(function(n){var r=n.senderId,o=babelHelpers.objectWithoutPropertiesLoose(n,e);if(r!=null&&o.senderName==="Unknown User"){var a=t.getContactNameForContactId(r);if(a!=null)return babelHelpers.extends({},o,{senderName:a})}return n});var l=i.sort(function(e,t){return typeof e.timestamp=="number"&&typeof t.timestamp=="number"?e.timestamp-t.timestamp:0});return babelHelpers.extends({},o,{messages:l})})},n.$14=function(){return this.isAttachmentDownloadComplete()&&this.isThreadsRestoreComplete()},n.$17=function(t){switch(t){case 0:return o("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.InProgress;case 1:return o("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Completed;case 2:return o("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Failed;case-1:default:return o("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.NotStarted}},n.updateDYIStatus=async function(t){var e,n=await this.getDB();await n.runInTransaction(async function(e){await e.encrypted_backups_dyi_backup_restore_status.put({currentStatus:(C||(C=o("LSIntEnum"))).ofNumber(t),pk:(b||(b=o("I64"))).zero})},"readwrite",void 0,void 0,i.id+":521"),o("MAWBridge").getBridge().fireAndForget("event","updateDYIStatus",{qplEvent:this.$2,qplInstanceKeyE2E:(e=this.$3)!=null?e:void 0,status:this.$17(t)})},n.$18=async function(){var e=this,t=new Set;this.getContactNameMap().forEach(function(e,n){e==="Unknown User"&&t.add(n)});var n=await this.getDB(),r=await o("EncryptedBackupsDYIGenerateThreadMetadata").getAllUnmappedContacts(n,t);r.forEach(function(t){var n=(b||(b=o("I64"))).to_string(t.id);e.setContactNameForContactId(n,t.name)}),this.$4.LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Fetched remaining contact names, total of "," contacts"])),this.getContactNameMap().size.toString())},n.$15=async function(){var e=this;this.logDYIQPLPoint("complete_dyi_flow_start"),await this.$18(),this.$4.LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Generating output"])));var t=this.getOutput(),n=Array.from(this.$5.values());this.$4.LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Generating zip file"]))),await o("EncryptedBackupsDYIZipUtils").generateZipFile(t,n,this.$4,function(t,n){e.logDYIQPLPoint(t,n)},async function(){e.logDYIQPLPoint("complete_dyi_flow_end"),await e.updateDYIStatus(1),e.clear()},async function(t){e.$4.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate zip file: ",""])),t),e.logDYIQPLPoint("complete_dyi_flow_error"),await e.updateDYIStatus(2),e.clear()})},n.exitDYIEarly=async function(t,n){n!=null&&this.$4.LOG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["DYI Exiting Early - Found "," instamadillo threads"])),n),this.logDYIQPLPoint("dyi_exit_early",{int:{dyi_threads:n}}),await this.updateDYIStatus(t?2:1),this.clear()},n.clear=async function(){this.$5=new Map,this.$6=new Set,this.$7=new Set,this.$8=new Map,this.$9=new Map;var e=await o("EncryptedBackupsDYIFileUtils").getRootFolderHandle();await e.removeEntry(o("EncryptedBackupsDYIFileUtils").DyiMediaFolder,{recursive:!0})},n.logDYIQPLPoint=function(t,n){this.$3!=null&&o("MAWQplProxy").sendQplPointThroughBridge(this.$2,t,{annotations:n,instanceKey:this.$3})},t})();l.initSingleton=R,l.getSingleton=L,l.EncryptedBackupsDYISingleton=E}),98);
__d("EncryptedBackupsDYISingletonFactory",["EncryptedBackupsDYISingleton","WATagsLogger","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return new(o("EncryptedBackupsDYISingleton")).EncryptedBackupsDYISingleton(e,r("qpl")._(521478596,"1329"),t,o("WATagsLogger").TAGS(["labyrinth_web","labyrinth_dyi",t==null?"":t.toString()]))}function s(e,t){return new(o("EncryptedBackupsDYISingleton")).EncryptedBackupsDYISingleton(e,r("qpl")._(521479842,"2163"),t,o("WATagsLogger").TAGS(["igd_labyrinth_web","igd_dyi",t==null?"":t.toString()]))}l.getMAWEncryptedBackupsDYISingleton=e,l.getIGDEncryptedBackupsDYISingleton=s}),98);
__d("EncryptedBackupsDYIMediaManager",["Promise","WAMediaManager","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s=null,u=new Map,c=new Map;function d(e,t,n){var r=u.get(e);r==null?u.set(e,new Map([[t,n]])):r.set(t,n)}function m(e,t,n){c.set(e,{protocolMsgId:t,sortOrderMs:n})}function p(e){c.delete(e)}function _(){u.clear(),c.clear(),s=null}function f(){return s==null&&(s=o("WAMediaManager").createMediaManager({dbCallbacks:{getMediaEntries:function(r){var t=u.get(r);return t==null?(e||(e=n("Promise"))).resolve(o("WAResultOrError").makeError("no-media-by-plaintext-hash")):(e||(e=n("Promise"))).resolve(o("WAResultOrError").makeResult(t))},getProtocolMsgIdAndSortOrderMs:function(r){return(e||(e=n("Promise"))).resolve(c.get(r))}}})),s}l.addMediaEntry=d,l.addMessage=m,l.deleteMessage=p,l.cleanup=_,l.dyiMediaManager=f}),98);
__d("EncryptedBackupsDYIMediaDownload",["EBLogger","EncryptedBackupsDYIMediaManager","MAWDbMsg","MAWDownloadAndHandleMedia","WAHashUtils","WAResultOrError","WAStartMediaDownloadQplFlow"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.mediaEntry,n=e.plaintextHash,r=e.protocolMsgId,a=e.sortOrderMs,i=o("EncryptedBackupsDYIMediaManager").dyiMediaManager(),l=o("EBLogger").EBLogger().tags(["labyrinth_web","labyrinth_dyi"]),s=o("MAWDbMsg").toMsgId(r.chat+"_"+r.externalId+"_m");if(s==null)return l.mustfix("Failed to construct the msgId from protocolMsgId for media with plaintext hash: %s",o("WAHashUtils").sanitisePlaintextHash(n)),Promise.resolve(o("WAResultOrError").makeError("missing-media-entry"));o("EncryptedBackupsDYIMediaManager").addMediaEntry(n,s,t),o("EncryptedBackupsDYIMediaManager").addMessage(s,r,a);var u="DYIMediaManager",c=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:u,msgType:null,protocolMsgId:null,triggerUIView:null});l.debug("Enqueuing DYI media download for media with plaintext hash: %s",o("WAHashUtils").sanitisePlaintextHash(n));var d=await i.enqueueDownloadFullSize({fullSizePlaintextHash:n,mediaDownloadFlow:c,priority:o("MAWDownloadAndHandleMedia").getPriorityFromDownloadEntry(u)});return d.success?c.endSuccess():c.endFail(d.error),d}l.downloadDYIMedia=e}),98);
__d("EncryptedBackupsDYIMediaDownloadHandlers",["EncryptedBackupsDYIFileUtils","EncryptedBackupsDYISingleton","FBLogger","WAResultOrError","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e=async function(t,n,a,i){var e=await o("EncryptedBackupsDYIFileUtils").getMediaFolderHandle(),l=n.split("/")[1],s=r("uuidv4")()+"."+l;await o("EncryptedBackupsDYIFileUtils").writeFile(e,s,a);var u=o("EncryptedBackupsDYISingleton").getSingleton();return u.setMediaUrlByPlainTextHash(t,o("EncryptedBackupsDYIFileUtils").DyiMediaFolder+"/"+s),u.deletePlaintextHashFromAttachmentDownloadsInProgress(t),o("WAResultOrError").makeResult()},s=function(){return r("FBLogger")("wmi_eb").debug("[DYIMediaPreviewHandler] Skipping previews for DYI"),Promise.resolve(o("WAResultOrError").makeResult())};l.DYIMediaDownloadHandler=e,l.DYIMediaPreviewHandler=s}),98);
__d("EncryptedBackupsDYIMessageProcessingUtils",["EncryptedBackupsDYIMediaDownloadHandlers","EncryptedBackupsDYISingleton","FBLogger","MAWBridge","MAWFrontendMediaUtils","MebWAMediaDownloader","WAHashUtils","WAJids","WALongInt","WAMediaUtils","WAProgressiveJpegGetScanLengths","WAResultOrError","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g;function h(e,t){return{isUnsent:!1,media:new Set,reactions:[],senderName:y(e),text:"",timestamp:t!=null?t:0,type:""}}function y(e){var t=o("EncryptedBackupsDYISingleton").getSingleton(),n="Unknown User";if(e!=null){var r=t.getContactNameForContactId(e);r!=null&&(n=r)}return n}async function C(t,n,a,i){var l=o("EncryptedBackupsDYISingleton").getSingleton(),d=l.getLogger(),m=d.TAGS([o("WAHashUtils").sanitisePlaintextHash(t)]);r("FBLogger")("wmi_eb").tags(["labyrinth_dyi"]).debug("Sending the media download bridge call for plaintext hash: %s",o("WAHashUtils").sanitisePlaintextHash(t));var p=await o("MAWBridge").getBridge().sendAndReceive("backend","dyiDownloadMediaV2",{mediaEntry:i,plaintextHash:t,protocolMsgId:n,sortOrderMs:a});if(r("FBLogger")("wmi_eb").tags(["labyrinth_dyi"]).debug("Received the media download result from the bridge for plaintext hash: %s, success: %s, error: %s",o("WAHashUtils").sanitisePlaintextHash(t),p.success?"true":"false",p.error),p.success){var _=p.value,f=_.unvalidatedMimeType,g=_.validatedResult,h=g.skipValidation?f:g.mimeType,y=await o("EncryptedBackupsDYIMediaDownloadHandlers").DYIMediaDownloadHandler(t,h,g.validatedPlaintext,n);if(!y.success){m.WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to save media: ",", ",""])),y.error,y.payload),d.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to save media: ",", ",""])),y.error,y.payload),l.deletePlaintextHashFromAttachmentDownloadsInProgress(t);return}}else{m.WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media: ",", ",""])),p.error,p.payload),d.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media: ",", ",""])),p.error,p.payload),l.deletePlaintextHashFromAttachmentDownloadsInProgress(t);return}}function b(e,t,n,r,a,i,l,s,u,c,h){var y=o("EncryptedBackupsDYISingleton").getSingleton(),C=y.getLogger(),b=C.TAGS([o("WAHashUtils").sanitisePlaintextHash(u)]),v={author:o("WAJids").toMsgrUserJid(l),chat:o("WAJids").toMsgrUserJid(a),externalId:s},S={hash:u,isUrlRenewed:!1,mediaEntry:r,protocolMsgId:v,sortOrderMs:c},R={onDownloadError:function(){return b.WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media"]))),C.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media"]))),y.deletePlaintextHashFromAttachmentDownloadsInProgress(S.hash),Promise.resolve()},onDownloadSuccess:async function(t){b.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Successfully downloaded media"])));var e=t.mimeType,n=t.plaintext;await o("EncryptedBackupsDYIMediaDownloadHandlers").DYIMediaDownloadHandler(S.hash,e,n,v)},onUrlExpired:function(){return b.LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Media CDN URL has expired and should be renewed"]))),Promise.resolve()}},L=new(o("MebWAMediaDownloader")).MebWAMediaDownloader(S,R,e),E=r.serverMediaType,k=r.objectId;if(E!=null&&k!=null&&typeof c=="number"){var I={backupEntFbid:t,deliveryObjectId:k,hash:u,mediaType:E,messageId:s,productType:n,sortOrder:c,threadId:a,threadKey:i},T={onResignCdnUrlFailure:function(t){return b.WARN(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Failed to resign CDN URL: ",""])),t.message),C.ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Failed to resign CDN URL: ",""])),t.message),y.deletePlaintextHashFromAttachmentDownloadsInProgress(S.hash),Promise.resolve()},onResignCdnUrlSuccess:async function(){}},D=h(I,T);L.setNextHandler(D),D.setNextHandler(new(o("MebWAMediaDownloader")).MebWAMediaDownloader(S,R,e))}L.handle()}function v(e,t,n){var r,a,i,l,s,u,c,d,m,p,_,f=(r=e.integral)==null||(r=r.transport)==null||(r=r.ancillary)==null?void 0:r.mimetype;if(f==null)return o("WAResultOrError").makeError("mime-type-missing");var g=o("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(f,t).serverMediaType;if(g==null)return o("WAResultOrError").makeError("server-media-type-missing");var h=(a=e.integral)==null||(a=a.transport)==null||(a=a.integral)==null?void 0:a.directPath;if(h==null)return o("WAResultOrError").makeError("direct-path-missing");var y=(i=e.integral)==null||(i=i.transport)==null||(i=i.integral)==null?void 0:i.fileSha256;if(y==null)return o("WAResultOrError").makeError("plaintext-hash-missing");var C=o("WALongInt").maybeNumber((l=e.integral)==null||(l=l.transport)==null||(l=l.integral)==null?void 0:l.mediaKeyTimestamp);if(C==null)return o("WAResultOrError").makeError("media-key-timestamp-missing");var b;if(((s=e.ancillary)==null?void 0:s.scanLengths)!=null&&((u=e.ancillary)==null?void 0:u.scansSidecar)!=null){var v=e.ancillary,S=v.scanLengths,R=v.scansSidecar;b={scanLengths:S.map(o("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength),sidecar:R}}var L;if(((c=e.integral)==null||(c=c.transport)==null||(c=c.ancillary)==null||(c=c.thumbnail)==null?void 0:c.downloadableThumbnail)!=null){var E=e.integral.transport.ancillary.thumbnail.downloadableThumbnail,k=E.directPath,I=E.fileEncSha256,T=E.fileSha256,D=E.mediaKey,x=E.mediaKeyTimestamp,$=E.objectId;L={directPath:k,fileEncSha256:I,fileSha256:T,mediaKey:D,mediaKeyTimestamp:o("WALongInt").maybeNumber(x),objectId:$}}var P={directPath:h,downloadableThumbnail:L,fileEncSha256:(d=e.integral)==null||(d=d.transport)==null||(d=d.integral)==null?void 0:d.fileEncSha256,filename:n,fileSha256:y,mediaKey:(m=e.integral)==null||(m=m.transport)==null||(m=m.integral)==null?void 0:m.mediaKey,mediaKeyTimestamp:o("WATimeUtils").castToUnixTime(C),objectId:(p=e.integral)==null||(p=p.transport)==null||(p=p.ancillary)==null?void 0:p.objectId,progressiveJpegDetails:b,serverMediaType:g,size:o("WALongInt").maybeNumber((_=e.integral)==null||(_=_.transport)==null||(_=_.ancillary)==null?void 0:_.fileLength)};return o("WAResultOrError").makeResult(o("WAMediaUtils").rawDataToMediaEntry(P))}l.buildBaseDyiMessage=h,l.getSenderName=y,l.downloadMediaWithMediaManager=C,l.startMediaDownloadChain=b,l.decodeMediaEntryFromAttachmentPayload=v}),98);
__d("IGDAWAdminWriteICDCMsgTxn",["Promise","cr:10743","cr:2327","vulture"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(e=n("cr:2327"))!=null?e:n("cr:10743");function c(e,t,o){return r("vulture")("0u4LdQ5rjWgu0xNHykDuwUn8fhs="),u?u.writeICDCAdminMsg(e,t,o):(s||(s=n("Promise"))).resolve()}l.writeICDCAdminMsg=c}),98);
__d("IGDAWAdminWriteUserDeviceMsgTxn",["Promise","cr:10744","cr:2693"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(e=n("cr:2693"))!=null?e:n("cr:10744");function c(e,t,r,o,a,i){return u?u.writeUserDeviceAdminMsg(e,t,r,o,a,i):(s||(s=n("Promise"))).resolve()}l.writeUserDeviceAdminMsg=c}),98);
__d("IGDAWDbAddDeviceChangeAlertsTxn",[],(function(t,n,r,o,a,i){"use strict";async function e(e,t){await e.e2ee_deviceChangeAlerts.put(t)}i.addDeviceChangeAlertsTxn=e}),66);
__d("IGDAWDbUpdateDeviceChangeAlertsTxn",["I64","MAWUnsafeCoerce"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(e,t){await e.e2ee_deviceChangeAlerts.upsert([t.deviceChangeAlertsId],t)}function u(t){return o("MAWUnsafeCoerce").unsafeCoerce((e||(e=o("I64"))).of_float(t))}l.updateDeviceChangeAlertsTxn=s,l.convertDeviceChangeAlertsId=u}),98);
__d("IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn",["IGDAWDbUpdateDeviceChangeAlertsTxn","ReQL"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t){if(t!=null){var n=await o("ReQL").toArrayAsync(o("ReQL").fromTableDescending(e.e2ee_deviceChangeAlerts.index("deviceJid")).getKeyRange(t).filter(function(e){return!e.loggedOut}));await Promise.all(n.map(function(t){return o("IGDAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn(e,babelHelpers.extends({},t,{loggedOut:!0}))}))}}l.updateDeviceChangeAlertsLogInStatusTxn=e}),98);
__d("IGDDbThreadTxns",["I64","ReQL","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t,n){return new Map(await t.runInTransaction(function(t){return Promise.all(n.map(async function(n){var r,a=o("WAJids").extractUserId(n);return[a,await(r=o("ReQL")).toArrayAsync(r.mergeJoin(r.fromTableAscending(t.participants.index("contactIdThreadKey"),[]).getKeyRange((e||(e=o("I64"))).of_string(a)),o("ReQL").fromTableAscending(t.threads)).map(function(e){var t=e[0],n=e[1];return n}))]}))},"readonly",void 0,void 0,i.id+":24"))}l.getAllThreadsForUsers=s}),98);
__d("IGDHandleICDCErrorInstruction",["IGDAWAdminWriteICDCMsgTxn","MAWODSProxy","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t,n){var r=n.shouldShowAdminMessages,a=n.threads;r&&await e.runInTransaction(async function(e){await Promise.all(a.map(function(n){return o("IGDAWAdminWriteICDCMsgTxn").writeICDCAdminMsg(e,n,t.notificationTs)})),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.ICDC,key:"icdc"})},"readwrite",void 0,void 0,i.id+":30")}l.handleICDCError=e}),98);
__d("IGDHandleIdentityAddedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDAWDbAddDeviceChangeAlertsTxn","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t,n){var r=n.allowSecurityAlertForSelf,a=n.contactId,l=n.isMe,u=n.shouldShowAdminMessages,c=n.threads;await e.runInTransaction(async function(e){var n=s(e,t,l,r),i=n.promise,d=n.showSelfAlerts,m=u?c.map(function(n){return o("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(e,a,l,n,o("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.add,t.notificationTs)}):[];await Promise.all([i].concat(m)),(d||u)&&o("MAWODSProxy").odsBumpEntityKey({entity:l?o("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:o("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:o("MAWDbDeviceChangeAlerts").ADD})},"readwrite",void 0,void 0,i.id+":47")}function s(e,t,n,r){var a=!1,i=Promise.resolve();if(n&&t.model!=null&&t.platform!=null&&t.notificationTs!=null){a=!0;var l=t.instruction==="identityChanged"?o("MAWDbDeviceChangeAlerts").KEY_CHANGE:o("MAWDbDeviceChangeAlerts").ADD;if(t.device==null||t.identity==null)return{promise:i,showSelfAlerts:a};i=o("IGDAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(e,{action:l,deviceJid:t.device,identity:t.identity,isArchived:!r,isConfirmed:!1,isNotified:!1,model:t.model,platform:t.platform,ts:t.notificationTs})}return{promise:i,showSelfAlerts:a}}l.handleIdentityAdded=e,l.addDeviceChangeAlerts=s}),98);
__d("IGDHandleIdentityChangedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDHandleIdentityAddedInstruction","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","WAJids","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t,n){var r=n.allowSecurityAlertForSelf,a=n.isMe,l=n.shouldShowAdminMessages,s=n.threads;await e.runInTransaction(async function(e){var n=o("IGDHandleIdentityAddedInstruction").addDeviceChangeAlerts(e,t,a,r),i=n.promise,u=n.showSelfAlerts,c=l?s.map(function(n){return o("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(e,o("WAJids").extractUserId(t.jid),a,n,o("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.update,t.notificationTs)}):[];await Promise.all([i].concat(c)),(u||l)&&o("MAWODSProxy").odsBumpEntityKey({entity:a?o("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:o("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:o("MAWDbDeviceChangeAlerts").KEY_CHANGE})},"readwrite",void 0,void 0,i.id+":31")}l.handleIdentityChanged=e}),98);
__d("IGDHandleIdentityRemovedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t,n){var r=n.contactId,a=n.isMe,l=n.shouldShowAdminMessages,s=n.threads;await e.runInTransaction(async function(e){var n=a?o("IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn(e,t.device):Promise.resolve(),i=l?s.map(function(n){return o("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(e,r,a,n,o("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.remove,t.notificationTs)}):[];await Promise.all([n].concat(i)),(a||l)&&o("MAWODSProxy").odsBumpEntityKey({entity:a?o("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:o("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:o("MAWDbDeviceChangeAlerts").REMOVE})},"readwrite",void 0,void 0,i.id+":30")}l.handleIdentityRemoved=e}),98);
__d("MAWGetReStoreDBError",[],(function(t,n,r,o,a,i){"use strict";var e=(function(e){function t(t){var n;return n=e.call(this,t)||this,n.message=t,n.name="MAWGetReStoreDBError",n}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error));i.default=e}),66);
__d("MAWReStoreDbSetup",["FBLogger","MAWGetReStoreDBError","cr:10742","cr:2924","cr:3535"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(e=(s=n("cr:3535"))!=null?s:n("cr:10742"))!=null?e:n("cr:2924"),c=u==null?void 0:u.createDB,d;async function m(){var e=await d;e==null||e.closeDb==null||e.closeDb(),d=null}function p(){if(c==null)throw r("FBLogger")("messenger_web").mustfixThrow("Unexpected invocation of OneDB");return d==null&&(d=(async function(){try{var e=await c();return await e.runInTransaction(async function(){},"readwrite",void 0,void 0,i.id+":44"),e}catch(e){throw new(r("MAWGetReStoreDBError"))("Failed to get ReStore DB: "+e)}})()),d}function _(){return c!=null}l.closeDB=m,l.getDB=p,l.shouldUseReStoreDb=_}),98);
__d("MAWReStoreDb",["FBLogger","MAWIndexedDb","MAWReStoreDbSetup","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(){if(r("gkx")("3577"))try{var t=await o("MAWReStoreDbSetup").getDB();return t}catch(e){var n=r("getErrorSafe")(e);throw r("FBLogger")("igd_web").blameToPreviousFrame().catching(n).mustfixThrow("Failed to get ReStore DB: %s",arguments[0])}return e==null&&(o("MAWIndexedDb").willSetupDB()?e=o("MAWIndexedDb").getDB().then(function(){return o("MAWReStoreDbSetup").getDB()}):e=o("MAWReStoreDbSetup").getDB()),e}function u(){return o("MAWReStoreDbSetup").shouldUseReStoreDb()}l.getDB=s,l.shouldUseReStoreDb=u}),98);
__d("IGDAWProtocolQueueInstructions",["FBLogger","IGDDbThreadTxns","IGDHandleICDCErrorInstruction","IGDHandleIdentityAddedInstruction","IGDHandleIdentityChangedInstruction","IGDHandleIdentityRemovedInstruction","MAWDbAppMeta","MAWReStoreDb","WAAssertUnreachable","WAGlobals","WAJids","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=await o("MAWReStoreDb").getDB(i.id+":35"),n=await s(t,e),a=n[0],l=a.allowSecurityAlertForContact,c=a.allowSecurityAlertForSelf,m=n[1],p=[];for(var _ of e){var f,g=_.jid,h=o("WAJids").extractUserId(g),y=g===o("WAGlobals").getMyUserJid(),C=u({allowSecurityAlertForContact:l,isICDCError:_.instruction==="icdcError",isMe:y}),b={allowSecurityAlertForSelf:c,contactId:h,isMe:y,shouldShowAdminMessages:C,threads:(f=m.get(h))!=null?f:[]};try{await d(t,_,b),p.push(_.stanzaQueueId)}catch(e){var v=r("getErrorSafe")(e);r("FBLogger")("igd_web").warn("Failed to handle instruction. The error is %s",v.message)}}return{followUpParams:void 0,toAck:p}}async function s(e,t){var n=new Set(t.map(function(e){return e.jid})),r=await c(e),a=r.allowSecurityAlertForContact&&t.some(function(e){return e.jid!==o("WAGlobals").getMyUserJid()}),i=t.some(function(e){return e.instruction==="icdcError"}),l=a||i,s=l?await o("IGDDbThreadTxns").getAllThreadsForUsers(e,Array.from(n)):new Map;return[r,s]}function u(e){var t=e.allowSecurityAlertForContact,n=e.isICDCError,r=e.isMe;return!r&&(t||n)}async function c(e){var t,n,r=await Promise.all([e.tables.e2ee_appMeta.get(o("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf),e.tables.e2ee_appMeta.get(o("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert)]),a=r[0],i=r[1];return{allowSecurityAlertForContact:(t=i==null?void 0:i.value.allowSecurityAlert)!=null?t:!1,allowSecurityAlertForSelf:(n=a==null?void 0:a.value.allowSecurityAlertForSelf)!=null?n:!0}}function d(e,t,n){switch(t.instruction){case"identityChanged":return o("IGDHandleIdentityChangedInstruction").handleIdentityChanged(e,t,n);case"identityAdded":return o("IGDHandleIdentityAddedInstruction").handleIdentityAdded(e,t,n);case"identityRemoved":return o("IGDHandleIdentityRemovedInstruction").handleIdentityRemoved(e,t,n);case"icdcError":return o("IGDHandleICDCErrorInstruction").handleICDCError(e,t,n);default:throw r("WAAssertUnreachable")(t)}}l.handleInstructions=e,l.getShouldShowAdminMessages=u}),98);
__d("MAWIsQuotaExceededError",[],(function(t,n,r,o,a,i){"use strict";var e=function(t){return t.name==="QuotaExceededError"||t.inner!=null&&t.inner.name==="QuotaExceededError"};i.isQuotaExceededError=e}),66);
__d("MAWSharedCOPLogger",["MWFBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MWFBLogger").MWLogger().tags(["COP"]);l.default=e}),98);
__d("MAWCommonScheduler",["WorkerScheduler"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return e==null&&(e=o("WorkerScheduler").makeScheduler("msgr-common",{concurrency:1,maxTaskLimit:10,maxThrottleMs:5e3})),e}l.mawCommonScheduler=s}),98);
__d("MAWUnstoredQuotedMsgUtils",["FBLogger","MAWMsgType","WAJids","WAMsgType"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(e!=null){var t=e.content,n=e.remoteJid,a;switch(t.type){case o("MAWMsgType").MSG_TYPE.TEXT:a=u(t);break;case o("MAWMsgType").MSG_TYPE.IMAGE:a=c(t);break;case o("MAWMsgType").MSG_TYPE.VIDEO:a=d(t);break;case o("MAWMsgType").MSG_TYPE.PTT:a=m(t);break;case o("MAWMsgType").MSG_TYPE.GIF:a=p(t);break;case o("MAWMsgType").MSG_TYPE.STICKER:a=_(t);break;case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:a=g(t);break;case o("MAWMsgType").MSG_TYPE.UNAVAILABLE:a=h(t);break;case o("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:a=y(t);break;case o("WAMsgType").NOTE_REPLY:a=f(t);break;case o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:a=C(t);break;default:throw t.type,r("FBLogger")("messenger_web").mustfixThrow("For flow")}return{content:a,remoteJid:n}}}function s(e){if(o("WAJids").isAuthorSystem(e.author))throw r("FBLogger")("messenger_web").mustfixThrow("A system message cannot be quoted");return{author:e.author,externalId:e.externalId,ts:e.ts}}function u(e){return babelHelpers.extends({},s(e),{msgContent:e.msgContent,type:o("MAWMsgType").MSG_TYPE.TEXT})}function c(e){return babelHelpers.extends({},s(e),{type:o("MAWMsgType").MSG_TYPE.IMAGE})}function d(e){return babelHelpers.extends({},s(e),{type:o("MAWMsgType").MSG_TYPE.VIDEO})}function m(e){return babelHelpers.extends({},s(e),{type:o("MAWMsgType").MSG_TYPE.PTT})}function p(e){return babelHelpers.extends({},s(e),{type:o("MAWMsgType").MSG_TYPE.GIF})}function _(e){return babelHelpers.extends({},s(e),{type:o("MAWMsgType").MSG_TYPE.STICKER})}function f(e){return babelHelpers.extends({},s(e),{expirationTs:e.expirationTs,msgContent:e.msgContent,type:o("WAMsgType").NOTE_REPLY})}function g(e){return babelHelpers.extends({},s(e),{type:o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE})}function h(e){return babelHelpers.extends({},s(e),{type:o("MAWMsgType").MSG_TYPE.UNAVAILABLE})}function y(e){return babelHelpers.extends({},s(e),{type:o("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL})}function C(e){return babelHelpers.extends({},s(e),{type:o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH})}function b(t){return{quote:e(t.quote)}}l.getWithQuoteMsg=b}),98);
__d("MAWUnstoredTypedMsgUtils",["MAWAdminMsgType","MAWDbMsg","MAWMsgType","MAWRavenUtils","MAWUnstoredQuotedMsgUtils","WAJids"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return{ack:e.ack,author:e.id.author,ebTimestampMs:e.ebTimestampMs,externalId:e.id.externalId,reportingMeta:e.reportingMeta,serverTs:e.serverTs,ts:e.ts}}function s(e){return{forwardingScore:e.forwardingScore,isForwarded:e.isForwarded}}function u(e){return{ephemeralSetting:c(e.ephemeralSetting),messageDeleteTs:e.deleteTs,messageExpirationTs:e.expirationTs}}function c(e){if(e!=null)return{ephemeralExpirationInSec:e.expirationTs,ephemeralLastUpdatedOrSetTimestamp:e.updatedTs}}function d(t,n){var r;return babelHelpers.extends({},e(t),s(t),o("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(t),u(t),{altIndex:void 0,collapsibleId:t.collapsibleId,isCollapsed:t.isCollapsed,msgContent:{commands:n.commands,content:(r=n.sentWithMessage)!=null?r:"",mentionedJids:n.mentionedJids},type:o("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:n.targetType})}function m(t){return babelHelpers.extends({},e(t),s(t),o("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(t),u(t),{altIndex:void 0,editCount:0,msgContent:t.msgContent,specialTextSize:t.specialTextSize,type:o("MAWMsgType").MSG_TYPE.TEXT})}function p(t){var n;return babelHelpers.extends({},e(t),s(t),o("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(t),u(t),{altIndex:void 0,plaintextHash:(n=t.mediaId)!=null?n:void 0,type:o("MAWMsgType").MSG_TYPE.IMAGE})}function _(t){return babelHelpers.extends({},e(t),o("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(t),u(t),{altIndex:void 0,ravenEphemeralMediaState:o("MAWRavenUtils").getEphemeralMediaState(t.ravenEphemeralMediaState),ravenEphemeralType:t.ravenEphemeralType,ravenMediaType:t.ravenMediaType,type:o("MAWMsgType").MSG_TYPE.RAVEN})}function f(t){var n;return babelHelpers.extends({},e(t),s(t),o("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(t),u(t),{altIndex:void 0,plaintextHash:(n=t.mediaId)!=null?n:void 0,type:o("MAWMsgType").MSG_TYPE.VIDEO})}function g(t){return babelHelpers.extends({},e(t),s(t),o("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(t),u(t),{altIndex:void 0,type:o("MAWMsgType").MSG_TYPE.PTT})}function h(e){return{adminMsgContent:e.adminMsgContent,adminType:e.adminType}}function y(t){return babelHelpers.extends({},e(t),{altIndex:void 0,author:o("WAJids").AUTHOR_SYSTEM,msgContent:h(t.msgContent),type:o("MAWMsgType").MSG_TYPE.ADMIN})}function C(t){var n;return babelHelpers.extends({},e(t),s(t),o("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(t),u(t),{altIndex:void 0,plaintextHash:(n=t.mediaId)!=null?n:void 0,type:o("MAWMsgType").MSG_TYPE.GIF})}function b(t){var n;return babelHelpers.extends({},e(t),s(t),o("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(t),u(t),{altIndex:void 0,plaintextHash:(n=t.mediaId)!=null?n:void 0,type:o("MAWMsgType").MSG_TYPE.STICKER})}function v(t){return babelHelpers.extends({},e(t),s(t),o("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(t),u(t),{altIndex:void 0,type:o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE})}function S(t){return babelHelpers.extends({},e(t),{altIndex:o("MAWDbMsg").FUTUREPROOF_ALT_INDEX,msgContent:t.msgContent,type:o("MAWMsgType").MSG_TYPE.FUTUREPROOF})}function R(t){return babelHelpers.extends({},e(t),{altIndex:void 0,ebTimestampMs:t.ebTimestampMs,revokedExternalId:t.revokedExternalId,type:o("MAWMsgType").MSG_TYPE.REVOKED})}function L(e){return{adminMsgContent:e.adminMsgContent,adminType:e.adminType}}function E(t){return babelHelpers.extends({},e(t),{altIndex:void 0,msgContent:L(t.msgContent),type:o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN})}function k(e){return{adminMsgContent:e.adminMsgContent,adminType:e.adminType,screenshotActionType:e.screenshotActionType,version:e.version}}function I(t){return babelHelpers.extends({},e(t),{altIndex:void 0,msgContent:k(t.msgContent),type:o("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION})}function T(e){return{adminType:e.adminType,authorName:e.authorName}}function D(t){return babelHelpers.extends({},e(t),{altIndex:void 0,msgContent:T(t.msgContent),type:o("MAWMsgType").MSG_TYPE.ICDC_ALERT})}function x(t){return babelHelpers.extends({},e(t),o("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(t),u(t),{altIndex:void 0,type:o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE})}function $(t,n){var r=n.receiverFetchId;return babelHelpers.extends({},e(t),s(t),o("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(t),u(t),{altIndex:void 0,receiverFetchId:r,type:o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH})}function P(t,n){var r=t.id.author===o("WAJids").AUTHOR_ME,a=[n.name];r||a.unshift(t.id.author!==o("WAJids").AUTHOR_ME&&t.id.author!==o("WAJids").AUTHOR_SYSTEM?o("WAJids").userIdFromJid(t.id.author):t.id.author);var i=r?o("MAWAdminMsgType").CURRENT_USER_CREATED_POLL:o("MAWAdminMsgType").PARTICIPANT_CREATED_POLL;return babelHelpers.extends({},e(t),{altIndex:void 0,msgContent:{adminMsgContent:a,adminType:i,version:1},type:o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE})}function N(t){return babelHelpers.extends({},e(t),{altIndex:void 0,type:o("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE})}l.getXMAMsg=d,l.getTextMsg=m,l.getImageMsg=p,l.getRavenMsg=_,l.getVideoMsg=f,l.getPttMsg=g,l.getAdminMsg=y,l.getGifMsg=C,l.getStickerMsg=b,l.getDocumentFileMsg=v,l.getFutureproofMsg=S,l.getRevokedMsg=R,l.getEphemeralSettingAdminMsg=E,l.getEphemeralScreenshotActionMsg=I,l.getICDCAlertMsg=D,l.getBumpExistingMessageMsg=x,l.getReceiverFetchMsg=$,l.getGroupPollCreateMsg=P,l.getGroupPollUpdateMsg=N}),98);
__d("MAWUnstoredMsgUtils",["FBLogger","MAWMsgType","MAWUnstoredTypedMsgUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.unstoredMsg,n=e.unstoredReceiverFetchInfo,a=e.unstoredXMA;if(t==null)return null;switch(t.type){case o("MAWMsgType").MSG_TYPE.TEXT:return o("MAWUnstoredTypedMsgUtils").getTextMsg(t);case o("MAWMsgType").MSG_TYPE.IMAGE:return o("MAWUnstoredTypedMsgUtils").getImageMsg(t);case o("MAWMsgType").MSG_TYPE.VIDEO:return o("MAWUnstoredTypedMsgUtils").getVideoMsg(t);case o("MAWMsgType").MSG_TYPE.PTT:return o("MAWUnstoredTypedMsgUtils").getPttMsg(t);case o("MAWMsgType").MSG_TYPE.ADMIN:return o("MAWUnstoredTypedMsgUtils").getAdminMsg(t);case o("MAWMsgType").MSG_TYPE.FUTUREPROOF:return o("MAWUnstoredTypedMsgUtils").getFutureproofMsg(t);case o("MAWMsgType").MSG_TYPE.REVOKED:return o("MAWUnstoredTypedMsgUtils").getRevokedMsg(t);case o("MAWMsgType").MSG_TYPE.GIF:return o("MAWUnstoredTypedMsgUtils").getGifMsg(t);case o("MAWMsgType").MSG_TYPE.STICKER:return o("MAWUnstoredTypedMsgUtils").getStickerMsg(t);case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return o("MAWUnstoredTypedMsgUtils").getDocumentFileMsg(t);case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return o("MAWUnstoredTypedMsgUtils").getEphemeralSettingAdminMsg(t);case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return o("MAWUnstoredTypedMsgUtils").getEphemeralScreenshotActionMsg(t);case o("MAWMsgType").MSG_TYPE.ICDC_ALERT:return o("MAWUnstoredTypedMsgUtils").getICDCAlertMsg(t);case o("MAWMsgType").MSG_TYPE.XMA:{if((a==null?void 0:a.xma)==null)throw r("FBLogger")("messenger_web").mustfixThrow("XMA content cannot be parsed without XMA payload");return o("MAWUnstoredTypedMsgUtils").getXMAMsg(t,a==null?void 0:a.xma)}case o("MAWMsgType").MSG_TYPE.RAVEN:return o("MAWUnstoredTypedMsgUtils").getRavenMsg(t);case o("MAWMsgType").MSG_TYPE.RAVEN_ACTION:case o("MAWMsgType").MSG_TYPE.REACTION:case o("MAWMsgType").MSG_TYPE.EDIT_ACTION:return null;case o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return o("MAWUnstoredTypedMsgUtils").getBumpExistingMessageMsg(t);case o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:{if(n==null)throw r("FBLogger")("messenger_web").mustfixThrow("Receiver Fetch Info cannot be null for Receiver Fetch Msg");return o("MAWUnstoredTypedMsgUtils").getReceiverFetchMsg(t,n)}case o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:throw r("FBLogger")("messenger_web").mustfixThrow("Group polls are not yet supported");case o("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:throw r("FBLogger")("messenger_web").mustfixThrow("Group polls are not yet supported");default:return t.type,null}}function s(e){if(e==null)return null;switch(e.type){case o("MAWMsgType").MSG_TYPE.TEXT:return o("MAWUnstoredTypedMsgUtils").getTextMsg(e);case o("MAWMsgType").MSG_TYPE.GIF:return o("MAWUnstoredTypedMsgUtils").getGifMsg(e);case o("MAWMsgType").MSG_TYPE.STICKER:return o("MAWUnstoredTypedMsgUtils").getStickerMsg(e);default:return null}}function u(e){var t=e.unstoredMsg;if(!t||t.type!==o("MAWMsgType").MSG_TYPE.REACTION)return null;var n=t;return{ack:n.ack,author:n.id.author,externalId:n.id.externalId,groupingKey:n.groupingKey,reaction:n.reaction,reactToAuthor:n.reactToAuthor,reactToExternalId:n.reactToExternalId,senderTimestampMs:n.senderTimestampMs,threadJid:n.id.chat,ts:n.ts}}function c(e){var t=e.unstoredMsg;if(!t||t.type!==o("MAWMsgType").MSG_TYPE.RAVEN_ACTION)return null;var n=t;return{ack:n.ack,actionTimestamp:n.actionTimestamp,actionType:n.actionType,author:n.id.author,externalId:n.id.externalId,ravenActionToMsgExternalId:n.ravenActionToMsgExternalId,ts:n.ts,type:n.type}}function d(e){var t=e.unstoredIncomingGroupInvite;return t?babelHelpers.extends({},t):null}function m(e){return e==null?null:{ack:e.ack,author:e.id.author,editMsgContent:e.editMsgContent,externalId:e.id.externalId,originalMsgExternalId:e.originalMsgExternalId,reportingMeta:e.reportingMeta,serverTs:e.serverTs,specialTextSize:e.specialTextSize,ts:e.ts,type:e.type}}function p(e){var t=e.unstoredReceiverFetchInfo;return t==null?null:babelHelpers.extends({},t,{type:"sticker"})}function _(e){var t=e.unstoredGroupPollCreateInfo;return t==null?null:babelHelpers.extends({},t,{latestSenderTimestampsMs:new Map})}function f(e){var t=e.unstoredGroupPollUpdateInfo;return t==null?null:{encryptedMessage:t.pollUpdateMessage}}l.getUnstoredMsg=e,l.getUnstoredAssociatedMsg=s,l.getUnstoredReaction=u,l.getUnstoredRavenActionMsg=c,l.getGroupInvite=d,l.getUnstoredEditActionMsg=m,l.getUnstoredReceiverFetchInfo=p,l.getUnstoredGroupPollCreateInfo=_,l.getUnstoredDbGroupPollUpdateInfo=f}),98);
__d("MAWUnstoredMediaUtils",["MAWUnstoredMsgUtils","WASortedLists"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e==null?null:{accessibilitySummaryText:e.accessibilitySummaryText,mediaEntry:e.mediaEntry,mediaType:e.mediaType,msgIds:o("WASortedLists").emptySet(),plaintextHash:e.plaintextHash,size:e.size,ts:e.ts,validatedAudioInfo:e.validatedAudioInfo,validatedDocumentFileInfo:e.validatedDocumentFileInfo,validatedImageInfo:e.validatedImageInfo,validatedVideoInfo:e.validatedVideoInfo}}function s(t){var n,r,a,i,l=t.unstoredXMA;if(l!=null){var s=l.unstoredAssociatedMedia,u=l.unstoredAssociatedMsg,c=l.unstoredFavicon,d=l.unstoredHeaderMedia,m=l.unstoredPreviews,p=l.xma;return{unstoredAssociatedMedia:(n=e(s))!=null?n:void 0,unstoredAssociatedMsg:(r=o("MAWUnstoredMsgUtils").getUnstoredAssociatedMsg(u))!=null?r:void 0,unstoredDbXMA:{author:p.author,contentRef:p.contentRef,ctas:p.ctas,defaultCTA:p.defaultCTA,externalId:p.externalId,headerTitle:p.headerTitle,isTombstoned:p.isTombstoned,maxSubtitleNumOfLines:p.maxSubtitleNumOfLines,maxTitleNumOfLines:p.maxTitleNumOfLines,overlayDescription:p.overlayDescription,overlayIconGlyph:p.overlayIconGlyph,overlayTitle:p.overlayTitle,subtitleText:p.subtitleText,targetExpiringAtSec:p.targetExpiringAtSec,targetId:p.targetId,targetType:p.targetType,targetUsername:p.targetUsername,threadJid:p.threadJid,titleText:p.titleText,xmaDataclass:p.xmaDataclass,xmaLayoutType:p.xmaLayoutType},unstoredFavicon:(a=e(c))!=null?a:void 0,unstoredHeaderMedia:(i=e(d))!=null?i:void 0,unstoredPreviews:m?m.map(function(t){return e(t)}).filter(Boolean):void 0}}}l.getUnstoredMedia=e,l.getUnstoredXMA=s}),98);
__d("MAWUnstoredContentToUnstoredDbContentUtils",["MAWUnstoredMediaUtils","MAWUnstoredMsgUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t,n=(t=o("MAWUnstoredMsgUtils")).getUnstoredMsg(e),r=o("MAWUnstoredMediaUtils").getUnstoredMedia(e.unstoredMedia),a=t.getUnstoredReaction(e),i=t.getUnstoredRavenActionMsg(e),l=o("MAWUnstoredMediaUtils").getUnstoredXMA(e),s=t.getGroupInvite(e),u=t.getUnstoredEditActionMsg(e.unstoredEditMsg),c=t.getUnstoredReceiverFetchInfo(e),d=t.getUnstoredGroupPollCreateInfo(e),m=t.getUnstoredDbGroupPollUpdateInfo(e);return s==null?{contentTypeForLogging:e.contentTypeForLogging,unstoredDbEditActionMsg:u,unstoredDbGroupPollCreateInfo:d,unstoredDbGroupPollUpdateInfo:m,unstoredDbMedia:r,unstoredDbMsg:n,unstoredDbRavenActionMsg:i,unstoredDbReaction:a,unstoredDbReceiverFetchInfo:c,unstoredXMA:l,xmaTargetTypeForLogging:e.xmaTargetTypeForLogging}:{contentTypeForLogging:e.contentTypeForLogging,unstoredDbEditActionMsg:u,unstoredDbGroupPollCreateInfo:d,unstoredDbGroupPollUpdateInfo:m,unstoredDbMedia:r,unstoredDbMsg:n,unstoredDbRavenActionMsg:i,unstoredDbReaction:a,unstoredDbReceiverFetchInfo:c,unstoredIncomingDbGroupInvite:s,unstoredXMA:l,xmaTargetTypeForLogging:e.xmaTargetTypeForLogging}}l.unstoredContentToUnstoredDbContent=e}),98);
__d("WACryptoAesGcm",["WABinary","WACryptoDependencies"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t,n,r,a){a===void 0&&(a=16);var i={name:"AES-GCM",iv:c(t),tagLength:a*8};return r!=null&&(i.additionalData=c(r)),o("WACryptoDependencies").getCrypto().subtle.encrypt(i,await u(e),n)}async function s(e,t,n,r,a){a===void 0&&(a=16);var i={name:"AES-GCM",iv:c(t),tagLength:a*8};return r!=null&&(i.additionalData=c(r)),o("WACryptoDependencies").getCrypto().subtle.decrypt(i,await u(e),n)}function u(e){return o("WACryptoDependencies").getCrypto().subtle.importKey("raw",e,"AES-GCM",!1,["encrypt","decrypt"])}function c(e){if(e instanceof Uint8Array)return e;if(typeof e=="string"){var t=new(o("WABinary")).Binary;return t.writeString(e),t.readByteArrayView()}return new Uint8Array(e)}l.gcmEncrypt=e,l.gcmDecrypt=s}),98);
__d("WAUseCaseSecret",["$InternalEnum","WABinary","WACryptoHkdf"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum")({POLL_VOTE:"Poll Vote",ENC_REACTION:"Enc Reaction",ENC_COMMENT:"Enc Comment",REPORT_TOKEN:"Report Token",EVENT_RESPONSE:"Event Response",EVENT_EDIT_ENCRYPTED:"Event Edit",MESSAGE_EDIT:"Message Edit"}),s=32;function u(e){var t=e.messageSecret,n=e.modificationSender,r=e.modificationType,a=e.parentMsgOriginalSender,i=e.stanzaId,l=o("WABinary").Binary.build(i,a,n,r).readBuffer();return o("WACryptoHkdf").extractAndExpand(t instanceof ArrayBuffer?new Uint8Array(t):t,l,s)}l.UseCaseSecretModificationType=e,l.createUseCaseSecret=u}),98);
__d("MAWGroupPollsDualEncryptionUtils",["MAWDbPoll","WABase64","WAConsumerApplication.pb","WACryptoAesGcm","WACryptoSha256","WAResultOrError","WAUseCaseSecret","decodeProtobuf","encodeProtobuf","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t,n){if(e.encIv==null||e.encPayload==null)return o("WAResultOrError").makeError("invalid_poll_enc_value");var a=e.encIv,i=e.encPayload;try{var l=await o("WACryptoAesGcm").gcmDecrypt(t,a,i,n);return o("WAResultOrError").makeResult(l)}catch(e){return o("WAResultOrError").DEPRECATED_makeError("decryption_error",r("getErrorSafe")(e))}}async function s(e,t,n){try{var a=self.crypto.getRandomValues(new Uint8Array(12)),i=await o("WACryptoAesGcm").gcmEncrypt(t,a,e,n);return o("WAResultOrError").makeResult({encIv:a.buffer,encPayload:i})}catch(e){return o("WAResultOrError").DEPRECATED_makeError("encryption_error",r("getErrorSafe")(e))}}function u(e,t){var n=e+"\0"+t;return new TextEncoder().encode(n).buffer}async function c(e,t){var n=t.pollCreationMessageKey,r=t.pollCreationSenderJid,a=t.pollCreationStanzaId,i=t.pollUpdateSenderJid,l=t.pollUpdateStanzaId,c=await o("WAUseCaseSecret").createUseCaseSecret({messageSecret:n,modificationSender:i,modificationType:o("WAUseCaseSecret").UseCaseSecretModificationType.POLL_VOTE,parentMsgOriginalSender:r,stanzaId:a}),d=u(l,i),m=o("encodeProtobuf").encodeProtobuf(o("WAConsumerApplication.pb").ConsumerApplication$PollVoteMessageSpec,e).readBuffer();return s(m,c,d)}async function d(t,n){var a=n.pollCreationMessageKey,i=n.pollCreationSenderJid,l=n.pollCreationStanzaId,s=n.pollUpdateSenderJid,c=n.pollUpdateStanzaId,d=await o("WAUseCaseSecret").createUseCaseSecret({messageSecret:a,modificationSender:s,modificationType:o("WAUseCaseSecret").UseCaseSecretModificationType.POLL_VOTE,parentMsgOriginalSender:i,stanzaId:l}),m=u(c,s),p=await e(t,d,m);if(!p.success)return p;try{return o("WAResultOrError").makeResult(o("decodeProtobuf").decodeProtobuf(o("WAConsumerApplication.pb").ConsumerApplication$PollVoteMessageSpec,p.value))}catch(e){return o("WAResultOrError").DEPRECATED_makeError("protobuf_decode_error",r("getErrorSafe")(e))}}async function m(e,t){var n=t.pollCreationMessageKey,r=t.pollCreationSenderJid,a=t.pollCreationStanzaId,i=t.pollUpdateSenderJid,l=t.pollUpdateStanzaId,c=await o("WAUseCaseSecret").createUseCaseSecret({messageSecret:n,modificationSender:i,modificationType:o("WAUseCaseSecret").UseCaseSecretModificationType.POLL_VOTE,parentMsgOriginalSender:r,stanzaId:a}),d=u(l,i),m=o("encodeProtobuf").encodeProtobuf(o("WAConsumerApplication.pb").ConsumerApplication$PollAddOptionMessageSpec,e).readBuffer();return s(m,c,d)}async function p(t,n){var a=n.pollCreationMessageKey,i=n.pollCreationSenderJid,l=n.pollCreationStanzaId,s=n.pollUpdateSenderJid,c=n.pollUpdateStanzaId,d=await o("WAUseCaseSecret").createUseCaseSecret({messageSecret:a,modificationSender:s,modificationType:o("WAUseCaseSecret").UseCaseSecretModificationType.POLL_VOTE,parentMsgOriginalSender:i,stanzaId:l}),m=u(c,s),p=await e(t,d,m);if(!p.success)return p;try{return o("WAResultOrError").makeResult(o("decodeProtobuf").decodeProtobuf(o("WAConsumerApplication.pb").ConsumerApplication$PollAddOptionMessageSpec,p.value))}catch(e){return o("WAResultOrError").DEPRECATED_makeError("protobuf_decode_error",r("getErrorSafe")(e))}}async function _(e){var t=await o("WACryptoSha256").sha256(new TextEncoder("utf8").encode(e));return f(t)}function f(e){return o("MAWDbPoll").convertStringToOptionHash(o("WABase64").encodeB64(e))}l.encryptGroupPollVote=c,l.decryptGroupPollVote=d,l.encryptGroupPollAddOption=m,l.decryptGroupPollAddOption=p,l.getHashForOptionName=_,l.getBase64EncodedHash=f}),98);
__d("isUseridAnnotationEnabled",["gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("gkx")("24163")}l.default=e}),98);
__d("MAWUserHash",["MAWCurrentUser","WAGlobals","WAJids","isUseridAnnotationEnabled"],(function(t,n,r,o,a,i,l){"use strict";function e(){return o("MAWCurrentUser").isEmployee()&&r("isUseridAnnotationEnabled")()?o("WAJids").extractUserId(o("WAGlobals").getMyUserJid()).slice(-5):null}l.getUserHash=e}),98);
__d("MAWIncomingMsg",["MAWUserHash","MWFBLogger","WAGetPlatformFromStanzaId","WAHashStringToNumber","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MWFBLogger").MWLogger().tags(["ServerRPC","HandleIncomingMsg"]),s=function(t){var e=t.encTypes,n=t.incomingType,r=t.msg,a=t.queueType,i=t.retryCount,l=t.taskSource,s=r.details,u=r.decrypted;return{int:{messageAge:o("WATimeUtils").unixTime()-s.ts,msgId:o("WAHashStringToNumber").hashStringToNumber(s.externalId.toString()),offlineDelivery:s.offline,retryCount:i,taskSource:l},string:{e2eePlatform:o("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(s.externalId),incomingType:n,jid:s.from.chat,msgDecryptedDataType:u.type,msgType:s.type,queueType:a,threadType:s.from.type,userHash:o("MAWUserHash").getUserHash()},string_array:{encTypes:e}}};l.logger=e,l.prepareAnnotationsForIncomingMessage=s}),98);
__d("MAWMessageReceiveReliabilityLogger",["QPLFlow","WAHashStringToNumber","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=r("qpl")._(1056840931,"814"),s=r("qpl")._(521477947,"2395"),u=60*1e3;function c(t){return o("QPLFlow").startQPLFlow(t.incomingType==="ebrestore"?s:e,{annotations:{int:{msgId:o("WAHashStringToNumber").hashStringToNumber(t.stanzaId)},string:{incomingType:t.incomingType,jid:t.jid,msgType:t.type}},instanceKey:o("WAHashStringToNumber").hashStringToNumber(t.stanzaId),timeoutInMs:u})}var d=300*1e3;l.logRRStartForMessage=c,l.RECEIVE_RELIABILITY_TIMEOUT=d}),98);
__d("MAWConstants",[],(function(t,n,r,o,a,i){"use strict";var e=5,l="Facebook user",s="Instagram user",u=3;i.MESSAGE_RETRY_COUNT_LIMIT=e,i.FB_UNKNOWN_USER=l,i.INS_UNKNOWN_USER=s,i.CURRENT_REGISTRATION_VERSION=u}),66);
__d("WAFtsTokenizerBaseNormalizer",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){var t=this,n=[];this.$1=new Map,e.forEach(function(e){var r=e[0],o=e[1];t.$1.set(r,o),n.push(r)}),this.$2=new RegExp(n.join("|"),"g")}var t=e.prototype;return t.normalize=function(t){var e=this;return t===void 0&&(t=""),t.replace(this.$2,function(t){var n=e.$1.get(t);return n!=null?n:t})},e})();i.default=e}),66);
__d("WAFtsTokenizerPostLowercaseNormalizer",["WAFtsTokenizerBaseNormalizer"],(function(t,n,r,o,a,i,l){"use strict";var e=[["\u0131","i"],["\u0629","\u0647"],["\u0640",""],["\u0649","\u064A"],["\u0671","\u0627"],["\u06A4","\u0641"],["\u06A9","\u0643"],["\u06BA","\u0646"],["\u06BE","\u0647"],["\u06C3","\u06C2"],["\u06CC","\u064A"],["\u06D2","\u064A"],["\u06D5","\u0647"],["\u06F0","\u0660"],["\u06F1","\u0661"],["\u06F2","\u0662"],["\u06F3","\u0663"],["\u06F4","\u0664"],["\u06F5","\u0665"],["\u06F6","\u0666"],["\u06F7","\u0667"],["\u06F8","\u0668"],["\u06F9","\u0669"],["\u08BB","\u0641"],["\u08BC","\u0642"],["\u08BD","\u0646"],["\u200C",""],["\u0966","0"],["\u0967","1"],["\u0968","2"],["\u0969","3"],["\u096A","4"],["\u096B","5"],["\u096C","6"],["\u096D","7"],["\u096E","8"],["\u096F","9"],["\u0901","\u0902"],["\u0903",""],["\u093C",""],["\u09E6","0"],["\u09E7","1"],["\u09E8","2"],["\u09E9","3"],["\u09EA","4"],["\u09EB","5"],["\u09EC","6"],["\u09ED","7"],["\u09EE","8"],["\u09EF","9"],["\u0A66","0"],["\u0A67","1"],["\u0A68","2"],["\u0A69","3"],["\u0A6A","4"],["\u0A6B","5"],["\u0A6C","6"],["\u0A6D","7"],["\u0A6E","8"],["\u0A6F","9"],["\u0C66","0"],["\u0C67","1"],["\u0C68","2"],["\u0C69","3"],["\u0C6A","4"],["\u0C6B","5"],["\u0C6C","6"],["\u0C6D","7"],["\u0C6E","8"],["\u0C6F","9"],["\u0AE6","0"],["\u0AE7","1"],["\u0AE8","2"],["\u0AE9","3"],["\u0AEA","4"],["\u0AEB","5"],["\u0AEC","6"],["\u0AED","7"],["\u0AEE","8"],["\u0AEF","9"],["\u0CE6","0"],["\u0CE7","1"],["\u0CE8","2"],["\u0CE9","3"],["\u0CEA","4"],["\u0CEB","5"],["\u0CEC","6"],["\u0CED","7"],["\u0CEE","8"],["\u0CEF","9"],["\u0D66","0"],["\u0D67","1"],["\u0D68","2"],["\u0D69","3"],["\u0D6A","4"],["\u0D6B","5"],["\u0D6C","6"],["\u0D6D","7"],["\u0D6E","8"],["\u0D6F","9"],["\u0142","l"]],s=new(r("WAFtsTokenizerBaseNormalizer"))(e),u=s;l.default=u}),98);
__d("WAFtsTokenizerPreNFKDNormalizer",["WAFtsTokenizerBaseNormalizer"],(function(t,n,r,o,a,i,l){"use strict";var e=[["\u0675","\u0674\u0627"],["\u0676","\u0674\u0648"],["\u0677","\u0674\u06C7"],["\u0678","\u0674\u0649"],["\u0905\u0946","\u0904"],["\u0905\u093E","\u0906"],["\u0930\u094D\u0907","\u0908"],["\u0909\u0941","\u090A"],["\u090F\u0945","\u090D"],["\u090F\u0946","\u090E"],["\u090F\u0947","\u0910"],["\u0905\u0949","\u0911"],["\u0906\u0945","\u0911"],["\u0905\u094A","\u0912"],["\u0906\u0946","\u0912"],["\u0905\u094B","\u0913"],["\u0906\u0947","\u0913"],["\u0905\u094C","\u0914"],["\u0906\u0948","\u0914"],["\u0905\u0945","\u0972"],["\u0905\u093A","\u0973"],["\u0905\u093B","\u0974"],["\u0906\u093A","\u0974"],["\u0905\u094F","\u0975"],["\u0905\u0956","\u0976"],["\u0905\u0957","\u0977"],["\u0985\u09BE","\u0986"],["\u098B\u09C3","\u09E0"],["\u098C\u09E2","\u09E1"],["\u0A05\u0A3E","\u0A06"],["\u0A72\u0A3F","\u0A07"],["\u0A72\u0A40","\u0A08"],["\u0A73\u0A41","\u0A09"],["\u0A73\u0A42","\u0A0A"],["\u0A72\u0A47","\u0A0F"],["\u0A05\u0A48","\u0A10"],["\u0A73\u0A4B","\u0A13"],["\u0A05\u0A4C","\u0A14"],["\u0A85\u0ABE","\u0A86"],["\u0A85\u0AC5","\u0A8D"],["\u0A85\u0AC7","\u0A8F"],["\u0A85\u0AC8","\u0A90"],["\u0A85\u0AC9","\u0A91"],["\u0A85\u0ACB","\u0A93"],["\u0A85\u0ABE\u0AC5","\u0A93"],["\u0A85\u0ACC","\u0A94"],["\u0A85\u0ABE\u0AC8","\u0A94"],["\u0AC5\u0ABE","\u0AC9"],["\u0B05\u0B3E","\u0B06"],["\u0B0F\u0B57","\u0B10"],["\u0B13\u0B57","\u0B14"],["\u0BB8\u0BCD\u0BB0\u0BC0","\u0BB6\u0BCD\u0BB0\u0BC0"],["\u0C12\u0C55","\u0C13"],["\u0C12\u0C4C","\u0C14"],["\u0C3F\u0C55","\u0C40"],["\u0C46\u0C55","\u0C47"],["\u0C4A\u0C55","\u0C4B"],["\u0C89\u0CBE","\u0C8A"],["\u0C92\u0CCC","\u0C94"],["\u0C8B\u0CBE","\u0CE0"],["\u0D07\u0D57","\u0D08"],["\u0D09\u0D57","\u0D0A"],["\u0D0E\u0D46","\u0D10"],["\u0D12\u0D3E","\u0D13"],["\u0D12\u0D57","\u0D14"],["\u0D23\u0D4D\u200D","\u0D7A"],["\u0D28\u0D4D\u200D","\u0D7B"],["\u0D30\u0D4D\u200D","\u0D7C"],["\u0D32\u0D4D\u200D","\u0D7D"],["\u0D33\u0D4D\u200D","\u0D7E"],["\u0D85\u0DCF","\u0D86"],["\u0D85\u0DD0","\u0D87"],["\u0D85\u0DD1","\u0D88"],["\u0D8B\u0DDF","\u0D8C"],["\u0D8D\u0DD8","\u0D8E"],["\u0D8F\u0DDF","\u0D90"],["\u0D91\u0DCA","\u0D92"],["\u0D91\u0DD9","\u0D93"],["\u0D94\u0DDF","\u0D96"]],s=new(r("WAFtsTokenizerBaseNormalizer"))(e),u=s;l.default=u}),98);
__d("WAFtsMultiLangTokenizer",["WAFtsTokenizerPostLowercaseNormalizer","WAFtsTokenizerPreNFKDNormalizer"],(function(t,n,r,o,a,i,l){"use strict";var e={NFC_CHARACTER:/(?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u3005\u3007\u3021-\u3029\u3030\u3038-\u303B\u303D\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u31F0-\u31FF\u3297\u3299\u32D0-\u32FE\u3300-\u3357\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFF66-\uFF6F\uFF71-\uFF9D]|\uD81B[\uDFF0\uDFF1]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6]|[\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/g,NFC_WORD:/((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1100-\u11FF\u302E\u302F\u3131-\u318E\u3200-\u321E\u3260-\u327E\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0E01-\u0E3A\u0E40-\u0E5B])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0F00-\u0F47\u0F49-\u0F6C\u0F71-\u0F97\u0F99-\u0FBC\u0FBE-\u0FCC\u0FCE-\u0FD4\u0FD9\u0FDA])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1000-\u109F\uA9E0-\uA9FE\uAA60-\uAA7F])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1780-\u17DD\u17E0-\u17E9\u17F0-\u17F9\u19E0-\u19FF])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u02EA\u02EB\u3105-\u312F\u31A0-\u31BF])+/g},s=/(?![\u0902\u094D])(?:[\^`\xA8\xAF\xB4\xB7\xB8\u02B0-\u034E\u0350-\u0357\u035D-\u0362\u0374\u0375\u037A\u0384\u0385\u0483-\u0487\u0559\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u064B-\u0652\u0657\u0658\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F5\u0818\u0819\u08E3-\u08FE\u093C\u094D\u0951-\u0954\u0971\u09BC\u09CD\u0A3C\u0A4D\u0ABC\u0ACD\u0AFD-\u0AFF\u0B3C\u0B4D\u0B55\u0BCD\u0C4D\u0CBC\u0CCD\u0D3B\u0D3C\u0D4D\u0DCA\u0E47-\u0E4C\u0E4E\u0EBA\u0EC8-\u0ECC\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F82-\u0F84\u0F86\u0F87\u0FC6\u1037\u1039\u103A\u1063\u1064\u1069-\u106D\u1087-\u108D\u108F\u109A\u109B\u135D-\u135F\u17C9-\u17D3\u17DD\u1939-\u193B\u1A75-\u1A7C\u1A7F\u1AB0-\u1ABD\u1B34\u1B44\u1B6B-\u1B73\u1BAA\u1BAB\u1C36\u1C37\u1C78-\u1C7D\u1CD0-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1D2C-\u1D6A\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2CEF-\u2CF1\u2E2F\u302A-\u302F\u3099-\u309C\u30FC\uA66F\uA67C\uA67D\uA67F\uA69C\uA69D\uA6F0\uA6F1\uA700-\uA721\uA788-\uA78A\uA7F8\uA7F9\uA8C4\uA8E0-\uA8F1\uA92B-\uA92E\uA953\uA9B3\uA9C0\uA9E5\uAA7B-\uAA7D\uAABF-\uAAC2\uAAF6\uAB5B-\uAB5F\uAB69-\uAB6B\uABEC\uABED\uFB1E\uFE20-\uFE2F\uFF3E\uFF40\uFF70\uFF9E\uFF9F\uFFE3]|\uD800\uDEE0|\uD802[\uDEE5\uDEE6]|\uD803[\uDD22-\uDD27\uDF46-\uDF50]|\uD804[\uDCB9\uDCBA\uDD33\uDD34\uDD73\uDDC0\uDDCA-\uDDCC\uDE35\uDE36\uDEE9\uDEEA\uDF3C\uDF4D\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC42\uDC46\uDCC2\uDCC3\uDDBF\uDDC0\uDE3F\uDEB6\uDEB7\uDF2B]|\uD806[\uDC39\uDC3A\uDD3D\uDD3E\uDD43\uDDE0\uDE34\uDE47\uDE99]|\uD807[\uDC3F\uDD42\uDD44\uDD45\uDD97]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF8F-\uDF9F\uDFF0\uDFF1]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD]|\uD838[\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD46\uDD48-\uDD4A])+/g,u=/(?:[!-#%-\/:-@\[-`\{-~\xA1\xA7\xA8\xAB\xAC\xAF\xB1\xB4\xB6-\xB8\xBB\xBF\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u037E\u0384\u0385\u0387\u03F6\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0606-\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u200D\u2010-\u2027\u2030-\u205E\u207A-\u207E\u208A-\u208E\u2118\u2140-\u2144\u214B\u2190-\u2194\u219A\u219B\u21A0\u21A3\u21A6\u21AE\u21CE\u21CF\u21D2\u21D4\u21F4-\u22FF\u2308-\u230B\u2320\u2321\u2329\u232A\u237C\u239B-\u23B3\u23DC-\u23E1\u25B7\u25C1\u25F8-\u25FF\u266F\u2768-\u2775\u27C0-\u27FF\u2900-\u2AFF\u2B30-\u2B44\u2B47-\u2B4C\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u309B\u309C\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA700-\uA716\uA720\uA721\uA789\uA78A\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uAB5B\uAB6A\uAB6B\uABEB\uFB29\uFBB2-\uFBC1\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0F\uFF1A-\uFF20\uFF3B-\uFF40\uFF5B-\uFF65\uFFE2\uFFE3\uFFE9-\uFFEC]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]|\uD83B[\uDEF0\uDEF1]|\uD83C[\uDFFB-\uDFFF])/g,c=/(^|(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]))((?:[0-9A-Z\^`-z\xA8\xAA\xAF\xB2-\xB5\xB7-\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u034E\u0350-\u0357\u035D-\u0362\u0370-\u0377\u037A-\u037D\u037F\u0384-\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u05D0-\u05EA\u05EF-\u05F2\u0620-\u0652\u0657\u0658\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u06EE-\u06FC\u06FF\u0710\u0712-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u0815\u0818-\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08E3-\u08FE\u0904-\u0939\u093C\u093D\u094D\u0950-\u0954\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC\u09BD\u09CD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A4D\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC\u0ABD\u0ACD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0AFD-\u0AFF\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C\u0B3D\u0B4D\u0B55\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BCD\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C4D\u0C58-\u0C5A\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC\u0CBD\u0CCD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3D\u0D4D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E4C\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBA\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECC\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F33\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F82-\u0F84\u0F86-\u0F8C\u0FC6\u1000-\u102A\u1037\u1039\u103A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1063-\u1066\u1069-\u1070\u1075-\u1081\u1087-\u109B\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17C9-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1939-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A75-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B05-\u1B34\u1B44-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B83-\u1BA0\u1BAA\u1BAB\u1BAE-\u1BE5\u1C00-\u1C23\u1C36\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CFA\u1D00-\u1DBF\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA67C\uA67D\uA67F-\uA69D\uA6A0-\uA6F1\uA700-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA92B-\uA92E\uA930-\uA946\uA953\uA960-\uA97C\uA984-\uA9B3\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAABF-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB6B\uAB70-\uABE2\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE20-\uFE2F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3E\uFF40-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE3]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE6\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD27\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF54\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC83-\uDCAF\uDCB9\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD33\uDD34\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD73\uDD76\uDD83-\uDDB2\uDDC0-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE35\uDE36\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEE9\uDEEA\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C\uDF3D\uDF4D\uDF50\uDF5D-\uDF61\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC34\uDC42\uDC46-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC2-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDBF\uDDC0\uDDD8-\uDDDB\uDE00-\uDE2F\uDE3F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB6-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF2B\uDF30-\uDF3B]|\uD806[\uDC00-\uDC2B\uDC39\uDC3A\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3D-\uDD3F\uDD41\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE34\uDE3A\uDE47\uDE50\uDE5C-\uDE89\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC3F\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD42\uDD44-\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD97\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD838[\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCD6\uDD00-\uDD46\uDD48-\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])+)[\"\'\xAB\xBB\u2018-\u201F\u2039\u203A\u2E42\u300C-\u300F\u301D-\u301F\uFE41-\uFE44\uFF02\uFF07\uFF62\uFF63]((?:[0-9A-Z\^`-z\xA8\xAA\xAF\xB2-\xB5\xB7-\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u034E\u0350-\u0357\u035D-\u0362\u0370-\u0377\u037A-\u037D\u037F\u0384-\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u05D0-\u05EA\u05EF-\u05F2\u0620-\u0652\u0657\u0658\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u06EE-\u06FC\u06FF\u0710\u0712-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u0815\u0818-\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08E3-\u08FE\u0904-\u0939\u093C\u093D\u094D\u0950-\u0954\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC\u09BD\u09CD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A4D\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC\u0ABD\u0ACD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0AFD-\u0AFF\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C\u0B3D\u0B4D\u0B55\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BCD\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C4D\u0C58-\u0C5A\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC\u0CBD\u0CCD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3D\u0D4D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E4C\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBA\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECC\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F33\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F82-\u0F84\u0F86-\u0F8C\u0FC6\u1000-\u102A\u1037\u1039\u103A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1063-\u1066\u1069-\u1070\u1075-\u1081\u1087-\u109B\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17C9-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1939-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A75-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B05-\u1B34\u1B44-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B83-\u1BA0\u1BAA\u1BAB\u1BAE-\u1BE5\u1C00-\u1C23\u1C36\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CFA\u1D00-\u1DBF\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA67C\uA67D\uA67F-\uA69D\uA6A0-\uA6F1\uA700-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA92B-\uA92E\uA930-\uA946\uA953\uA960-\uA97C\uA984-\uA9B3\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAABF-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB6B\uAB70-\uABE2\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE20-\uFE2F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3E\uFF40-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE3]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE6\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD27\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF54\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC83-\uDCAF\uDCB9\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD33\uDD34\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD73\uDD76\uDD83-\uDDB2\uDDC0-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE35\uDE36\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEE9\uDEEA\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C\uDF3D\uDF4D\uDF50\uDF5D-\uDF61\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC34\uDC42\uDC46-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC2-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDBF\uDDC0\uDDD8-\uDDDB\uDE00-\uDE2F\uDE3F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB6-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF2B\uDF30-\uDF3B]|\uD806[\uDC00-\uDC2B\uDC39\uDC3A\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3D-\uDD3F\uDD41\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE34\uDE3A\uDE47\uDE50\uDE5C-\uDE89\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC3F\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD42\uDD44-\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD97\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD838[\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCD6\uDD00-\uDD46\uDD48-\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])+)($|(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]))/g,d=/(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F])+/g,m=/(?:[\$\xA2-\xA5\u058F\u060B\u07FE\u07FF\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BF\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]|\uD807[\uDFDD-\uDFE0]|\uD838\uDEFF|\uD83B\uDCB0)+/g;function p(e){return e.replace(c,function(e,t,n,r,o){return" "+n+r+" "+n+" "+r+" "})}function _(e){return e.split(d)}function f(e){return e.replace(u,"")}function g(e){return e.replace(s,"")}function h(t){return t.normalize("NFC").replace(e.NFC_CHARACTER,function(e){return" "+e+" "})}function y(t){return t.normalize("NFC").replace(e.NFC_WORD,function(e){return" "+e+" "})}function C(e){return e.replace(m,function(e){return" "+e+" "})}var b=(function(){function t(){}var n=t.prototype;return n.tokenize=function(n){n===void 0&&(n="");var t=p(n),o=C(h(y(t))),a=_(o),i=a.map(function(t){var n=t;if(n=f(n),n.length)n.match(e.NFC_CHARACTER)||n.match(e.NFC_WORD)?n=n.normalize("NFC"):(n=g(r("WAFtsTokenizerPreNFKDNormalizer").normalize(n).normalize("NFKD")),n=n.toLocaleLowerCase("en-US"),n=r("WAFtsTokenizerPostLowercaseNormalizer").normalize(n));else return n;return n});return new Set(i.filter(function(e){return!!e&&!!e.trim()&&!e.match(d)}))},t})();l.default=b}),98);
__d("MAWFTSIsMessageValidForSearch",["MAWMsgType"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e.ephemeralSetting!=null&&e.ephemeralSetting.ephemeralExpirationInSec>0}function s(t){var n=t.msgContent,r=t.sortOrderMs,a=t.type,i=n==null?void 0:n.content;return i==null||r==null||a!==o("MAWMsgType").MSG_TYPE.TEXT&&a!==o("MAWMsgType").MSG_TYPE.XMA||e(t)?null:{content:i,sortOrderMs:r}}l.verifyMessageValidity=s}),98);
__d("MpsMessageToSearchBridge",["MpsMessageToBridgeWrapper"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t,n=o("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(e.toplevelProtobuf);if(e.expiryTimestampMs==null){var r=(t=n.deserialize().encryptedTransportMessage())==null||(t=t.consumerMessage())==null||(t=t.payload)==null||(t=t.content)==null||(t=t.messageText)==null?void 0:t.text;return r==null?null:{chatJid:n.getChatJid(),externalId:n.getExternalId(),msg:{content:r,sender:n.message.senderId,ts:n.getUnixTs()},sortOrderMs:n.message.timestampMs}}}l.messageToSearchBridge=e}),98);
__d("MAWOptimisticUploadManager",[],(function(t,n,r,o,a,i){"use strict";var e=new Map;function l(){return e}function s(){e.clear()}i.getOptimisticUploadManager=l,i.clearOptimisticUploadManager=s}),66);
__d("MAWGetDownloadableThumbnailForMediaApi",["MAWOptimisticUploadManager","WALogger","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s=async function(n){var t,r=o("MAWOptimisticUploadManager").getOptimisticUploadManager().get(n);if(r==null)return null;var a=r.previewPlaintextHash;if(a==null)return null;var i=o("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a);if(i==null)return null;var l=await((t=i.optimisticUploadPromise)==null?void 0:t.catch(function(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["GetDownloadableThumbnail - previewEntry optimistedPromise rejected with ",""])),t),o("WAResultOrError").makeError("runtime-error")}));if(l==null||l.success!==!0)return null;var s=l.value,u=s.directPath,c=s.fileEncSha256,d=s.fileSha256,m=s.mediaKey,p=s.mediaKeyTimestamp,_=s.objectId;return{directPath:u,fileEncSha256:c,fileSha256:d,mediaKey:m,mediaKeyTimestamp:p,objectId:_}};l.getDownloadableThumbnailForMedia=s}),98);
__d("MAWUploadAndHandleMedia",["MAWMediaManager","MWFBLogger","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("MWFBLogger").MWMediaLogger();async function c(t){var n=t.chatJid,r=t.dbCallbacks,a=t.filename,i=t.hash,l=t.plaintext,c=t.protocolMsgId,d=t.serverMediaType,m=t.size,p=t.uploadMediaMetric,_=await o("MAWMediaManager").getMawMediaManager().enqueueUploadFullSize({chatJid:n,mediaUploadFlow:p,plaintext:l,plaintextHash:i,serverMediaType:d});if(_.success!==!0)return u.WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to enqueue upload full size: ",""])),_.error),p.endFail(_.error),_;p.addPoint("get_downloadable_thumbnail_start");var f=await r.getDownloadableThumbnailForMedia(i).catch(function(e){return u.catching(e).MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["getDownloadableThumbnailForMedia unexpected runtime-erorr: ",""])),e),null});p.addPoint("get_downloadable_thumbnail_end");var g=babelHelpers.extends({},_.value,{downloadableThumbnail:f,filename:a,size:m});return p.endSuccess(),o("WAResultOrError").makeResult(g)}l.uploadAndHandleMedia=c}),98);
__d("WAStartMediaUploadQplFlow",["QPLFlow","WAGetStorageQplAnnotations","WAJids","WAMediaQplHelper","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.chatJid,n=e.fileSize,a=e.isVideoGif,i=e.serverMediaType,l=e.uploadEntry,s=o("QPLFlow").startQPLFlow(r("qpl")._(25313100,"131"),{annotations:{string:{chat_type:o("WAJids").switchOnMsgrChatJidType(t,{group:function(){return"group"},user:function(){return"user"}}),jid:t,media_size:o("WAMediaQplHelper").convertIntegerSizeToStringBucket(n),media_type:a===!0?"gif":i,upload_entry:l},int:{byteLength:n}}});return r("promiseDone")(o("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(e){s.addAnnotations(e)})),s}l.startMediaUploadQplFlow=e}),98);
__d("createInstamadilloAddMessagePayload",["I64","InstamadilloMessageIdUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){return t!=null?{ephemeralityParams:{ephemeralDurationSec:(e||(e=o("I64"))).to_int32(t)}}:{}}function u(t){return t.isForwarded===!0?{forwardingParams:{forwardedThreadId:(e||(e=o("I64"))).to_string(t.threadKey)}}:{}}function c(t){if(t.replySourceId==null&&t.replySourceTimestampMs==null)return{};function n(){return t.replySourceId!=null?{repliedToMessageOtid:o("InstamadilloMessageIdUtils").fromInstamadilloMessageId(t.replySourceId).stanzaId}:{}}function r(){return t.replySourceTimestampMs!=null?{repliedToMessageWaServerTimeSec:(e||(e=o("I64"))).to_string(t.replySourceTimestampMs)}:{}}return{repliedToMessage:babelHelpers.extends({},n(),r())}}function d(e,t){var n={content:{text:{text:t?void 0:e.text}},metadata:babelHelpers.extends({},s(e.ephemeralDurationInSec),u(e),c(e))};return n}function m(e,t){var n={content:{media:t},metadata:babelHelpers.extends({},s(e.ephemeralDurationInSec),u(e),c(e))};return n}function p(e,t){var n={content:{receiverFetchXma:JSON.parse(t)},metadata:babelHelpers.extends({},s(e.ephemeralDurationInSec),u(e),c(e))};return n}l.createInstamadilloAddMessageTextPayload=d,l.createInstamadilloAddMessageMediaPayload=m,l.createInstamadilloAddMessageReceiverFetchXmaPayload=p}),98);
__d("createInstamadilloTransportPayload",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t={add:e};return t}function l(e){var t={supplement:e};return t}function s(e){var t={delete:e};return t}function u(e){var t={franking:e};return t}i.createInstamadilloAddMessageTransportPayload=e,i.createInstamadilloSupplementMessageTransportPayload=l,i.createInstamadilloDeleteMessageTransportPayload=s,i.createInstamadilloFrankingTransportPayload=u}),66);
__d("MWBUtil",[],(function(t,n,r,o,a,i){"use strict";var e=30,l=["impersonation"],s=["ig_user_impersonation"],u=Array.of.apply(Array,l.concat(s));i.SPAM_REPORT_MESSAGE_COUNT=e,i.MSGR_IMPERSONATION_TAGS=l,i.IG_IMPERSONATION_TAGS=s,i.ALL_IMPERSONATION_TAGS=u}),66);
__d("MAWHandleEchoProtobufsRestoreApi",["EBLogger","EchoMessageMediaFieldUtils","EncryptedBackupsDYIMessageProcessingUtils","LSMEBTaskCreationSource","MAWJids","MAWMediaUtils","MAWMsg","MAWMsgType","MAWODSProxy","MAWUnstoredContentToUnstoredDbContentUtils","MessageBackupSupplementalKeyGenerator","WAAckLevel","WAArmadilloApplication.pb","WAArmadilloBackupMessage.pb","WABase64","WAConsumerApplication.pb","WAHashUtils","WAJids","WAMediaTransport.pb","WAMsgApplication.pb","WAMsgType","WAOdsEnums","WAParseMediaTransportProtocol","WAParseMessageApplication","WAStanzaUtils","WATimeUtils","decodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D=o("EBLogger").EBLogger().tags(["ProtobufRestore"]);function x(t){var n=t.isMediaGalleryRestore,a=t.taskSource,i;return n!=null&&n?(o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_RESTORE,key:"is_media_gallery_restore_param"}),D.WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["isMediaGalleryRestore is deprecated. Consider using taskSource insted"]))),i=r("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE):i=a!=null?a:r("LSMEBTaskCreationSource").UNKNOWN,babelHelpers.extends({},t,{isMediaGalleryRestore:void 0,taskSource:i})}function $(e,t,n){var r={author:n,chat:t,externalId:e};return r}function P(e,t,n,r,a,i,l,p,_,f,g,h,y,C,b,v){if(e===o("MAWMsgType").MSG_TYPE.TEXT)if(l==null){D.MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Text content cannot be null for msg type text - unable to restore msg"])));return}else{var S={ack:n===o("WAJids").AUTHOR_ME?o("WAAckLevel").ACK.SENT:o("WAAckLevel").ACK.RECEIVED,forwardingScore:i,id:r,isForwarded:a,msgContent:{content:l,mentionedJids:p!=null?p.map(o("WAJids").validateUserJid).filter(Boolean):void 0},ts:t,type:o("MAWMsgType").MSG_TYPE.TEXT};return S}else if(e===o("MAWMsgType").MSG_TYPE.VIDEO){var R={ack:n===o("WAJids").AUTHOR_ME?o("WAAckLevel").ACK.SENT:o("WAAckLevel").ACK.RECEIVED,forwardingScore:i,id:r,isForwarded:a,mediaId:void 0,ts:t,type:o("MAWMsgType").MSG_TYPE.VIDEO};return R}else if(e===o("MAWMsgType").MSG_TYPE.GIF){var L={ack:n===o("WAJids").AUTHOR_ME?o("WAAckLevel").ACK.SENT:o("WAAckLevel").ACK.RECEIVED,forwardingScore:i,id:r,isForwarded:a,mediaId:void 0,ts:t,type:o("MAWMsgType").MSG_TYPE.GIF};return L}else if(e===o("MAWMsgType").MSG_TYPE.IMAGE){var E={ack:n===o("WAJids").AUTHOR_ME?o("WAAckLevel").ACK.SENT:o("WAAckLevel").ACK.RECEIVED,forwardingScore:i,id:r,isForwarded:a,mediaId:void 0,ts:t,type:o("MAWMsgType").MSG_TYPE.IMAGE};return E}else if(e===o("MAWMsgType").MSG_TYPE.STICKER){var k={ack:n===o("WAJids").AUTHOR_ME?o("WAAckLevel").ACK.SENT:o("WAAckLevel").ACK.RECEIVED,forwardingScore:i,id:r,isForwarded:a,mediaId:void 0,ts:t,type:o("MAWMsgType").MSG_TYPE.STICKER};return k}else if(e===o("MAWMsgType").MSG_TYPE.PTT){var I={ack:n===o("WAJids").AUTHOR_ME?o("WAAckLevel").ACK.SENT:o("WAAckLevel").ACK.RECEIVED,forwardingScore:i,id:r,isForwarded:a,mediaId:void 0,ts:t,type:o("MAWMsgType").MSG_TYPE.PTT};return I}else if(e===o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE){var T={ack:n===o("WAJids").AUTHOR_ME?o("WAAckLevel").ACK.SENT:o("WAAckLevel").ACK.RECEIVED,forwardingScore:i,id:r,isForwarded:a,mediaId:void 0,ts:t,type:o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE};return T}else if(e===o("MAWMsgType").MSG_TYPE.XMA){var x={ack:n===o("WAJids").AUTHOR_ME?o("WAAckLevel").ACK.SENT:o("WAAckLevel").ACK.RECEIVED,forwardingScore:i,id:r,isForwarded:a,ts:t,type:o("MAWMsgType").MSG_TYPE.XMA};return x}else if(e===o("MAWMsgType").MSG_TYPE.REVOKED){if(_==null){D.MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["No revoked msg external id found for revoked msg"])));return}var $={ack:n===o("WAJids").AUTHOR_ME?o("WAAckLevel").ACK.SENT:o("WAAckLevel").ACK.RECEIVED,ebTimestampMs:null,id:r,msgContent:void 0,revokedExternalId:_,ts:t,type:o("MAWMsgType").MSG_TYPE.REVOKED,unsendMsgContentDeleteTs:t};return $}else if(e===o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE){var P={ack:o("WAAckLevel").ACK.SENT,id:r,ts:t,type:o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE};return P}else if(e===o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH){var N={ack:n===o("WAJids").AUTHOR_ME?o("WAAckLevel").ACK.SENT:o("WAAckLevel").ACK.RECEIVED,forwardingScore:i,id:r,isForwarded:a,ts:t,type:o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH};return N}else if(e===o("MAWMsgType").MSG_TYPE.RAVEN){if(f==null){D.MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["No raven msg ephemeral type found for raven msg"])));return}if(g==null){D.MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["No raven msg media type found for raven msg"])));return}var M={ack:n===o("WAJids").AUTHOR_ME?o("WAAckLevel").ACK.SENT:o("WAAckLevel").ACK.RECEIVED,id:r,mediaId:h,ravenEphemeralMediaState:o("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN,ravenEphemeralType:f,ravenMediaType:g,ts:t,type:o("MAWMsgType").MSG_TYPE.RAVEN};return M}else if(e===o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE){if(y==null||C==null||b==null||v==null){D.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] One of the mandatory fields is missing for the group poll creation msg"])));return}var w={ack:n===o("WAJids").AUTHOR_ME?o("WAAckLevel").ACK.SENT:o("WAAckLevel").ACK.RECEIVED,id:r,ts:t,type:o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE};return w}}function N(e,t,n,r,a){var i,l,s,u,c,d,m,C,b=e.metadata,v=e.msgType;if(b==null){D.MUSTFIX(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Missing required metadata, unable to create db msg from protobuf"])));return}if(v==null){D.MUSTFIX(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Missing required msg type, unable to create db msg from protobuf"])));return}var S=b.messageId,R=b.senderId,L=(i=e.decodedPayload)==null?void 0:i.text,E=(l=e.decodedPayload)==null?void 0:l.mentionedJid;if(S==null){D.MUSTFIX(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Missing required message id, unable to create db msg from protobuf"])));return}if(R==null){D.MUSTFIX(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Missing required author, unable to create db msg from protobuf"])));return}var k=o("WATimeUtils").castMilliSecondsToUnixTime(e.sortOrderMs),I=o("MAWJids").toUserJid(R),T=o("WAStanzaUtils").toStanzaId(S),x=I===n?o("WAJids").AUTHOR_ME:I,N=$(T,t,I);if(e.editMsgData.length>0){var M=k;e.editMsgData.forEach(function(e){var t;if(e.ts>M&&((t=e.editMsgContent.message)==null?void 0:t.text)!=null){var n,r;M=e.ts,L=(n=e.editMsgContent.message)==null?void 0:n.text,E=(r=e.editMsgContent.message)==null?void 0:r.mentionedJid}})}var w=P(v,k,x,N,e.isForwarded,e.forwardingScore,L,E,e.revokedMsgExternalId,e.ravenMsgEphemeralType,e.ravenMsgMediaType,(s=e.ravenUnstoredMedia)==null?void 0:s.plaintextHash,(u=e.groupPollInfo)==null?void 0:u.encKey,(c=e.groupPollInfo)==null?void 0:c.name,(d=e.groupPollInfo)==null?void 0:d.options,(m=e.groupPollInfo)==null?void 0:m.selectableOptionsCount);if(w==null){D.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Missing required fields, unable to create db msg from protobuf for thread jid "," and otid ",""])),t,T);return}var A;if(e.xmaData!=null&&((C=e.xmaData)==null?void 0:C.targetType)!=null){var F,O={author:I,externalId:T,targetType:(F=e.xmaData)==null?void 0:F.targetType,threadJid:t};A={unstoredAssociatedMedia:void 0,unstoredAssociatedMsg:void 0,unstoredFavicon:void 0,unstoredHeaderMedia:void 0,unstoredPreviews:void 0,xma:O}}var B={unstoredGroupPollCreateInfo:e.groupPollInfo,unstoredMedia:void 0,unstoredMsg:w,unstoredQuotedMedia:void 0,unstoredReceiverFetchInfo:e.receiverFetchInfo,unstoredXMA:A};w.type===o("MAWMsgType").MSG_TYPE.RAVEN&&e.ravenUnstoredMedia!=null&&(B.unstoredMedia=e.ravenUnstoredMedia);var W=o("MAWUnstoredContentToUnstoredDbContentUtils").unstoredContentToUnstoredDbContent(B);if(W.unstoredDbMsg!=null){var q=W.unstoredDbMsg;q.sortOrderMs=e.sortOrderMs,q.serverTs=o("WATimeUtils").castToUnixTime(e.sortOrderMs/1e3),e.noteReply!=null&&(q.quote={content:e.noteReply,remoteJid:void 0});var U=r.get(S);q.author!=null&&n===q.author&&q.author!==o("WAJids").AUTHOR_SYSTEM&&(q.author=o("WAJids").AUTHOR_ME),U!=null&&(q.quoteExternalId=o("WAStanzaUtils").toStanzaId(U)),v===o("MAWMsgType").MSG_TYPE.TEXT&&(q.editCount=e.editMsgData.length);var V={author:q.author,stanzaId:T,unstoredDbContent:W};return W.unstoredDbMedia!=null&&a!=null&&a.set(T,W.unstoredDbMedia),V}D.MUSTFIX(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Failed to create db msg from protobuf"])))}function M(e){switch(e){case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE:return o("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF:return o("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.GIF;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER:return o("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.STICKER;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO:return o("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_MP4;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO:return o("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_WAV;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.XMA_IMAGE:return o("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG;default:return null}}function w(e){switch(e){case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE:return o("EchoMessageMediaFieldUtils").AttachmentType.IMAGE;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF:return o("EchoMessageMediaFieldUtils").AttachmentType.GIF;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER:return o("EchoMessageMediaFieldUtils").AttachmentType.STICKER;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO:return o("EchoMessageMediaFieldUtils").AttachmentType.VIDEO;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO:return o("EchoMessageMediaFieldUtils").AttachmentType.PTT;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.XMA_IMAGE:return o("EchoMessageMediaFieldUtils").AttachmentType.XMA;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.DOCUMENT:return o("EchoMessageMediaFieldUtils").AttachmentType.DOCUMENT;default:return null}}function A(e){var t;switch(e){case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE:t="image/jpeg";break;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO:t="audio/wav";break;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO:t="video/mp4";break;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF:t="image/gif";break;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER:t="image/webp";break;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.XMA_IMAGE:t="image/jpeg";break;case o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.DOCUMENT:t="application/octet-stream";break;default:D.MUSTFIX(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Unsupported media type, cannot get mimetype for attachment"])))}return t}function F(e,t,n){var r,a,i,l,s,u,c,d,m,p,_=t,f=e.ancillary,g=e.integral,h=g==null||(r=g.transport)==null||(r=r.integral)==null?void 0:r.fileSha256,y=g==null||(a=g.transport)==null||(a=a.integral)==null?void 0:a.fileEncSha256,C=g==null||(i=g.transport)==null||(i=i.integral)==null?void 0:i.mediaKey,S=(g==null||(l=g.transport)==null||(l=l.integral)==null?void 0:l.mediaKeyTimestamp)!=null&&typeof(g==null||(s=g.transport)==null?void 0:s.integral.mediaKeyTimestamp)=="number"?g==null||(u=g.transport)==null?void 0:u.integral.mediaKeyTimestamp:void 0;o("MAWMediaUtils").isTransportLegacyGif(e)&&(_=o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF);var R=g==null||(c=g.transport)==null||(c=c.ancillary)==null||(c=c.thumbnail)==null?void 0:c.thumbnailHeight,L=g==null||(d=g.transport)==null||(d=d.ancillary)==null||(d=d.thumbnail)==null?void 0:d.thumbnailWidth,E=M(_),k=w(_);if(k===null){D.MUSTFIX(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Invalid attachment type, cannot restore attachment"])));return}var I=o("EncryptedBackupsDYIMessageProcessingUtils").decodeMediaEntryFromAttachmentPayload(e,k===o("EchoMessageMediaFieldUtils").AttachmentType.XMA,n);I.success||D.WARN(v||(v=babelHelpers.taggedTemplateLiteralLoose(["Cannot generate media entry data, ",""])),I.error);var T={attachmentObjectId:g==null||(m=g.transport)==null||(m=m.ancillary)==null?void 0:m.objectId,attachmentType:k,directPath:g==null||(p=g.transport)==null||(p=p.integral)==null?void 0:p.directPath,encryptedHash:y!=null?o("WAHashUtils").toPlaintextHash(y):void 0,filename:n,height:f==null?void 0:f.height,mediaEntryData:I.value,mediaKey:C!=null?o("WABase64").encodeB64UrlSafe(C):void 0,mediaKeyTimestamp:S,mediaPlayableDuration:f==null?void 0:f.seconds,plaintextHash:h!=null?o("WAHashUtils").toPlaintextHash(h):void 0,width:f==null?void 0:f.width,xAttachmentType:_,xContentType:"full"},x=A(_);return x!=null&&(T.mediaContentType=x),E!=null&&(T.previewContentType=E,T.previewContentHeight=R,T.previewContentWidth=L),o("EchoMessageMediaFieldUtils").convertMediaMetadataDetailsToMediaMetadata(T,"protobuf")}function O(e,t,n){var r,a=F(e,t,n);if(a==null)return{mediaMetadata:void 0,previewMetadata:null};var i=e.integral,l=null,s=i==null||(r=i.transport)==null||(r=r.ancillary)==null||(r=r.thumbnail)==null?void 0:r.downloadableThumbnail;if(s!=null){var u=s.fileSha256,c=s.fileEncSha256,d=s.mediaKey,m=typeof s.mediaKeyTimestamp=="number"?s.mediaKeyTimestamp:void 0;return l={attachmentObjectId:s.objectId,attachmentType:o("EchoMessageMediaFieldUtils").AttachmentType.IMAGE,directPath:s.directPath,encryptedHash:c!=null?o("WAHashUtils").toPlaintextHash(c):void 0,filename:void 0,height:void 0,mediaKey:d!=null?o("WABase64").encodeB64UrlSafe(d):void 0,mediaKeyTimestamp:m,mediaPlayableDuration:void 0,plaintextHash:u!=null?o("WAHashUtils").toPlaintextHash(u):void 0,width:void 0,xAttachmentType:o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.MESSENGER_PREVIEW,xContentType:"preview"},{mediaMetadata:a,previewMetadata:o("EchoMessageMediaFieldUtils").convertMediaMetadataDetailsToMediaMetadata(l,"protobuf")}}return{mediaMetadata:a,previewMetadata:null}}function B(e,t,n,r,a,i){i===void 0&&(i=null),t!=null&&e!=null&&(n.push({mediaMetadata:t,mediaRestoreType:r,previewMetadata:i}),a.set(o("WAStanzaUtils").toStanzaId(e),n))}function W(e){switch(e){case 0:return o("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE;case 1:return o("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY;case 2:return o("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT;default:return}}function q(e,t,n,r,a,i,l,s,u,c,d){var m,p,_,f,g,h,y,C,b,v,I=V(e,i,l,s),T=I==null||(m=I.obj.payload)==null?void 0:m.content,x={editMsgData:[],externalId:r,forwardingScore:(p=I==null||(_=I.metadata)==null?void 0:_.forwardingScore)!=null?p:0,isForwarded:(f=I==null||(g=I.metadata)==null?void 0:g.isForwarded)!=null?f:!1,metadata:e.metadata,reactionData:[],sortOrderMs:t,unknownFieldCount:e.$$unknownFieldCount},$,P=[];if(T!=null){if(T.messageText!=null)return x.msgType=o("MAWMsgType").MSG_TYPE.TEXT,x.decodedPayload=T.messageText,x;if(T.extendedContentMessage!=null){var N,M,w;if(x.msgType=o("MAWMsgType").MSG_TYPE.XMA,x.xmaData=T.extendedContentMessage,((N=T.extendedContentMessage)==null?void 0:N.headerImage)!=null){var A,q=o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAMediaTransport.pb").ImageTransportSpec,(A=T.extendedContentMessage)==null?void 0:A.headerImage.payload),H=F(q,o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE);B(r,H,P,"xma_header",u)}if(((M=T.extendedContentMessage)==null?void 0:M.favicon)!=null){var G,z=o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAMediaTransport.pb").ImageTransportSpec,(G=T.extendedContentMessage)==null?void 0:G.favicon.payload),j=F(z,o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE);B(r,j,P,"xma_favicon",u)}if(((w=T.extendedContentMessage)==null?void 0:w.previews)!=null){var K;(K=T.extendedContentMessage)==null||K.previews.forEach(function(e){var t=o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAMediaTransport.pb").ImageTransportSpec,e.payload),n=F(t,o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE);x.mediaMetadata=n,B(r,n,P,"xma_preview",u)})}return x}else if(T.audioMessage!=null){var Q,X=o("decodeProtobuf").decodeProtobuf(o("WAMediaTransport.pb").AudioTransportSpec,(Q=T.audioMessage)==null||(Q=Q.audio)==null?void 0:Q.payload);return $=F(X,o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO),x.msgType=o("MAWMsgType").MSG_TYPE.PTT,x.mediaMetadata=$,B(r,$,P,"attachment",u),x}else if(T.videoMessage!=null){var Y,J=o("decodeProtobuf").decodeProtobuf(o("WAMediaTransport.pb").VideoTransportSpec,(Y=T.videoMessage)==null||(Y=Y.video)==null?void 0:Y.payload),Z=O(J,o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO),ee=Z.mediaMetadata,te=Z.previewMetadata;return $=ee,$!=null&&$.xAttachmentType===o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF?x.msgType=o("MAWMsgType").MSG_TYPE.GIF:x.msgType=o("MAWMsgType").MSG_TYPE.VIDEO,x.mediaMetadata=$,B(r,$,P,"attachment",u,te),x}else if(T.imageMessage!=null){var ne,re=o("decodeProtobuf").decodeProtobuf(o("WAMediaTransport.pb").ImageTransportSpec,(ne=T.imageMessage)==null||(ne=ne.image)==null?void 0:ne.payload),oe=O(re,o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE),ae=oe.mediaMetadata,ie=oe.previewMetadata;return $=ae,x.msgType=o("MAWMsgType").MSG_TYPE.IMAGE,x.mediaMetadata=$,B(r,$,P,"attachment",u,ie),x}else if(T.stickerMessage!=null){var le,se,ue=o("decodeProtobuf").decodeProtobuf(o("WAMediaTransport.pb").StickerTransportSpec,(le=T.stickerMessage)==null||(le=le.sticker)==null?void 0:le.payload);if(((se=ue.integral)==null?void 0:se.receiverFetchId)!=null){var ce=o("WAParseMediaTransportProtocol").parseStickerReceiverFetchInfo(ue);return ce==null?(D.MUSTFIX(S||(S=babelHelpers.taggedTemplateLiteralLoose(["[MAWHandleEchoProtobufsRestoreApi] consumerMessage has no sticker receiver fetch info"]))),x):(x.msgType=o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH,x.receiverFetchInfo=ce,x)}return $=F(ue,o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER),x.msgType=o("MAWMsgType").MSG_TYPE.STICKER,x.mediaMetadata=$,B(r,$,P,"attachment",u),x}else if(T.documentMessage!=null){var de,me,pe=o("decodeProtobuf").decodeProtobuf(o("WAMediaTransport.pb").DocumentTransportSpec,(de=T.documentMessage)==null||(de=de.document)==null?void 0:de.payload);return $=F(pe,o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.DOCUMENT,(me=T.documentMessage)==null?void 0:me.fileName),x.msgType=o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE,x.mediaMetadata=$,B(r,$,P,"attachment",u),x}}else if((I==null||(h=I.obj.payload)==null||(h=h.applicationData)==null?void 0:h.revoke)!=null){var _e,fe=I==null||(_e=I.obj.payload)==null||(_e=_e.applicationData)==null||(_e=_e.revoke)==null||(_e=_e.key)==null?void 0:_e.id;if(fe==null)D.MUSTFIX(R||(R=babelHelpers.taggedTemplateLiteralLoose(["Unable to retrieve revoked message external id"])));else return x.revokedMsgExternalId=o("WAStanzaUtils").toStanzaId(fe),x.msgType=o("MAWMsgType").MSG_TYPE.REVOKED,x}if((I==null||(y=I.obj.payload)==null||(y=y.content)==null?void 0:y.bumpExistingMessage)!=null){var ge,he,ye,Ce=I==null||(ge=I.obj.payload)==null||(ge=ge.content)==null?void 0:ge.bumpExistingMessage,be=(he=Ce.key)==null?void 0:he.id;be!=null&&(l.has(be)||i.add(be),s.set(r,be));var ve=(ye=Ce.key)==null?void 0:ye.participant;if(ve==null){var Se;ve=(Se=Ce.key)==null?void 0:Se.remoteJid}if(ve==null)D.MUSTFIX(L||(L=babelHelpers.taggedTemplateLiteralLoose(["No author found for original message that was bumped - unable to restore"])));else{var Re=o("WAJids").unsafeCoerceToUserJid(ve),Le=Re===n?o("WAJids").AUTHOR_ME:Re;return c.set(o("WAStanzaUtils").toStanzaId(r),Le),x.msgType=o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE,x}}if((I==null||(C=I.obj)==null||(C=C.payload)==null||(C=C.content)==null?void 0:C.noteReplyMessage)!=null){var Ee,ke,Ie=I==null||(Ee=I.obj)==null||(Ee=Ee.payload)==null||(Ee=Ee.content)==null?void 0:Ee.noteReplyMessage,Te=Ie.noteTimestampMs,De=Ie.noteText,xe=(ke=e.metadata)==null?void 0:ke.senderId;if(Te!=null&&typeof Te=="number"&&xe!=null&&a!=null){var $e=o("MAWJids").toUserJid(xe),Pe=o("MAWJids").toUserJid(a),Ne=Pe===$e?n:Pe,Me={author:Ne===n?o("WAJids").AUTHOR_ME:Ne,externalId:o("WAStanzaUtils").toStanzaId(r),ts:o("WATimeUtils").castMilliSecondsToUnixTime(Te),type:o("WAMsgType").NOTE_REPLY};if((De==null?void 0:De.text)!=null){var we={content:De==null?void 0:De.text,mentionedJids:De==null?void 0:De.mentionedJid.map(function(e){return o("MAWJids").toUserJid(e)})};Me.msgContent=we}x.noteReply=Me}if(Ie.textContent!=null)return x.msgType=o("MAWMsgType").MSG_TYPE.TEXT,x.decodedPayload=Ie.textContent,x;if(Ie.stickerContent!=null){var Ae=o("decodeProtobuf").decodeProtobuf(o("WAMediaTransport.pb").StickerTransportSpec,Ie.stickerContent.payload);return $=F(Ae,o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER),x.msgType=o("MAWMsgType").MSG_TYPE.STICKER,x.mediaMetadata=$,B(r,$,P,"attachment",u),x}else if(Ie.videoContent!=null){var Fe=o("decodeProtobuf").decodeProtobuf(o("WAMediaTransport.pb").VideoTransportSpec,Ie.videoContent.payload);return $=F(Fe,o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO),$!=null&&$.xAttachmentType===o("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF?x.msgType=o("MAWMsgType").MSG_TYPE.GIF:x.msgType=o("MAWMsgType").MSG_TYPE.VIDEO,x.mediaMetadata=$,B(r,$,P,"attachment",u),x}}if((I==null||(b=I.obj)==null||(b=b.payload)==null||(b=b.content)==null?void 0:b.ravenMessageMsgr)!=null){var Oe,Be,We;if(x.ravenMsgEphemeralType=W(I==null||(Oe=I.obj)==null||(Oe=Oe.payload)==null||(Oe=Oe.content)==null||(Oe=Oe.ravenMessageMsgr)==null?void 0:Oe.ephemeralType),(I==null||(Be=I.obj)==null||(Be=Be.payload)==null||(Be=Be.content)==null||(Be=Be.ravenMessageMsgr)==null?void 0:Be.imageMessage)!=null){if(d==null||!d){var qe;x.ravenUnstoredMedia=o("WAParseMediaTransportProtocol").decodeImageTransport(I==null||(qe=I.obj)==null||(qe=qe.payload)==null||(qe=qe.content)==null||(qe=qe.ravenMessageMsgr)==null||(qe=qe.imageMessage)==null?void 0:qe.payload,o("WATimeUtils").castMilliSecondsToUnixTime(x.sortOrderMs),"image")}x.ravenMsgMediaType=o("MAWMsg").MAWRavenMsgMediaType.IMAGE}else if((I==null||(We=I.obj)==null||(We=We.payload)==null||(We=We.content)==null||(We=We.ravenMessageMsgr)==null?void 0:We.videoMessage)!=null){if(d==null||!d){var Ue,Ve=o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAMediaTransport.pb").VideoTransportSpec,I==null||(Ue=I.obj)==null||(Ue=Ue.payload)==null||(Ue=Ue.content)==null||(Ue=Ue.ravenMessageMsgr)==null||(Ue=Ue.videoMessage)==null?void 0:Ue.payload),He=o("WAParseMediaTransportProtocol").parseVideoMsg(Ve,o("WATimeUtils").castMilliSecondsToUnixTime(x.sortOrderMs),!1);He!=null?x.ravenUnstoredMedia=He:D.MUSTFIX(E||(E=babelHelpers.taggedTemplateLiteralLoose(["Decoded raven video unstored message is null - unable to restore"])))}x.ravenMsgMediaType=o("MAWMsg").MAWRavenMsgMediaType.VIDEO}return x.msgType=o("MAWMsgType").MSG_TYPE.RAVEN,x}else if((I==null||(v=I.obj)==null||(v=v.payload)==null||(v=v.content)==null?void 0:v.pollCreationMessage)!=null){x.msgType=o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE;var Ge=I.obj.payload.content.pollCreationMessage,ze=Ge.encKey,je=Ge.name,Ke=Ge.options,Qe=Ge.selectableOptionsCount;return ze!=null&&je!=null&&Ke!=null&&(x.groupPollInfo={encKey:ze,name:je,options:Ke.map(function(e){var t=e.optionName;return t}).filter(Boolean),selectableOptionsCount:Qe||0}),x}return I!=null&&U(x,I.obj),D.MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Unable to retrieve decoded protobuf from backup message - unsupported message type"]))),x}function U(e,t){var n,r,o,a,i,l,s,u,c,d,m,p,_,f;(t==null||(n=t.payload)==null||(n=n.content)==null?void 0:n.locationMessage)!=null&&(e.futureProofMessageType="locationMessage"),(t==null||(r=t.payload)==null||(r=r.content)==null?void 0:r.liveLocationMessage)!=null&&(e.futureProofMessageType="liveLocationMessage"),(t==null||(o=t.payload)==null||(o=o.content)==null?void 0:o.pollUpdateMessage)!=null&&(e.futureProofMessageType="pollUpdateMessage"),(t==null||(a=t.payload)==null||(a=a.content)==null?void 0:a.viewOnceMessage)!=null&&(e.futureProofMessageType="viewOnceMessage"),(t==null||(i=t.payload)==null||(i=i.content)==null?void 0:i.contactMessage)!=null&&(e.futureProofMessageType="contactMessage"),(t==null||(l=t.payload)==null||(l=l.content)==null?void 0:l.extendedTextMessage)!=null&&(e.futureProofMessageType="extendedTextMessage"),(t==null||(s=t.payload)==null||(s=s.content)==null?void 0:s.groupInviteMessage)!=null&&(e.futureProofMessageType="groupInviteMessage"),(t==null||(u=t.payload)==null||(u=u.content)==null?void 0:u.commonSticker)!=null&&(e.futureProofMessageType="commonSticker"),(t==null||(c=t.payload)==null||(c=c.content)==null?void 0:c.screenshotAction)!=null&&(e.futureProofMessageType="screenshotAction"),(t==null||(d=t.payload)==null||(d=d.content)==null?void 0:d.extendedMessageContentWithSear)!=null&&(e.futureProofMessageType="extendedMessageContentWithSear"),(t==null||(m=t.payload)==null||(m=m.content)==null?void 0:m.imageGalleryMessage)!=null&&(e.futureProofMessageType="imageGalleryMessage"),(t==null||(p=t.payload)==null||(p=p.content)==null?void 0:p.paymentsTransactionMessage)!=null&&(e.futureProofMessageType="paymentsTransactionMessage"),(t==null||(_=t.payload)==null||(_=_.applicationData)==null?void 0:_.metadataSync)!=null&&(e.futureProofMessageType="metadataSync"),(t==null||(f=t.payload)==null||(f=f.applicationData)==null?void 0:f.aiBotResponse)!=null&&(e.futureProofMessageType="aiBotResponse")}function V(e,t,n,r){var a,i=(a=e.metadata)==null?void 0:a.messageId,l=o("decodeProtobuf").decodeProtobuf(o("WAMsgApplication.pb").MessageApplicationSpec,e.encryptedTransportMessage),s=o("WAParseMessageApplication").parseMessageApplication(l);if(s.type==="error"){D.MUSTFIX(I||(I=babelHelpers.taggedTemplateLiteralLoose(["Message contains unparseable message application - unable to restore message"])));return}var u=l.metadata,c=u==null?void 0:u.quotedMessage,d=c==null?void 0:c.stanzaId;if(i!=null&&d!=null&&(n.has(d)||t.add(d),r.set(i,d)),s.subprotocolType==="armadillo"){var m=o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAArmadilloApplication.pb").ArmadilloSpec,s.payload);return{metadata:u,obj:m}}else if(s.subprotocolType==="consumerMessage")return{metadata:u,obj:o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAConsumerApplication.pb").ConsumerApplicationSpec,s.payload)}}function H(e,t,n,r,o,a,i,l,s){return e.map(function(e){return G(e,t,n,r,o,a,i,l,s)})}function G(e,t,n,r,a,i,l,s,u){i===void 0&&(i=new Map);var c=o("decodeProtobuf").decodeProtobuf(o("WAArmadilloBackupMessage.pb").BackupMessageSpec,e.toplevelProtobuf.decryptedProtobuf),d=q(c,e.toplevelProtobuf.protobufTimestampMS,t,e.otid,n,r,a,i,l,s,u),m=e.supplementalProtobufs;for(var p of m){var _=p[0],f=p[1],g=o("MessageBackupSupplementalKeyGenerator").parseIdentifierString(_);o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_EB_DECODE_MESSAGE_PROTOBUF_SUPPLEMENTAL,key:g.type});var h=o("decodeProtobuf").decodeProtobuf(o("WAArmadilloBackupMessage.pb").BackupMessageSpec,f.decryptedProtobuf);if(h.encryptedTransportMessage!=null)switch(g.type){case"raven_action_message":{var y=V(h,r,a,i),C=g.senderJid,b=C===t?o("WAJids").AUTHOR_ME:C;if(y!=null){var v,S,R,L=y.obj,E=(v=L.payload)==null||(v=v.content)==null||(v=v.ravenActionNotifMessage)==null?void 0:v.actionTimestamp,k=(S=L.payload)==null||(S=S.content)==null||(S=S.ravenActionNotifMessage)==null?void 0:S.actionType;if(E!=null&&k!=null&&typeof E=="number"&&((R=L.payload)==null||(R=R.content)==null||(R=R.ravenActionNotifMessage)==null||(R=R.key)==null?void 0:R.id)!=null){var I,x,$,P,N=o("WAStanzaUtils").toStanzaId((I=L.payload)==null||(I=I.content)==null||(I=I.ravenActionNotifMessage)==null||(I=I.key)==null?void 0:I.id);if(((x=h.metadata)==null?void 0:x.timestampMs)!=null&&typeof(($=h.metadata)==null?void 0:$.timestampMs)=="number"&&((P=h.metadata)==null?void 0:P.messageId)!=null){var M,w,A=(M=h.metadata)==null?void 0:M.messageId,F=o("WATimeUtils").castMilliSecondsToUnixTime((w=h.metadata)==null?void 0:w.timestampMs),O=o("WAStanzaUtils").toStanzaId(A),B=k===0?o("MAWMsg").MAWRavenActionNotifType.PLAYED:k===1?o("MAWMsg").MAWRavenActionNotifType.SCREENSHOTTED:o("MAWMsg").MAWRavenActionNotifType.FORCE_DISABLED,W={ack:o("WAAckLevel").ACK.RECEIVED,actionTimestamp:o("WATimeUtils").castMilliSecondsToUnixTime(E),actionType:B,author:b,externalId:O,ravenActionToMsgExternalId:N,ts:F,type:o("MAWMsgType").MSG_TYPE.RAVEN_ACTION};d.ravenActionUnstoredMsg=W}}}break}case"reaction":{var U,H,G=(U=h.metadata)==null?void 0:U.messageId,z=(H=V(h,r,a,i))==null||(H=H.obj.payload)==null||(H=H.content)==null?void 0:H.reactionMessage,j=o("WAJids").extractUserId(g.senderJid);z!=null&&j!=null&&d.reactionData.push({reaction:z,reactionExternalId:G,senderId:j,ts:o("WATimeUtils").castMilliSecondsToUnixTime(f.protobufTimestampMS)});break}case"edit":{var K,Q,X=(K=V(h,r,a,i))==null||(K=K.obj.payload)==null||(K=K.content)==null?void 0:K.editMessage,Y=(Q=h.metadata)==null?void 0:Q.senderId;if(X!=null){var J,Z=(J=X.key)==null?void 0:J.id,ee=X.timestampMs;if(Z!=null&&ee!=null&&Y!=null&&typeof ee=="number"){var te=o("MAWJids").toUserJid(Y),ne=te===t?o("WAJids").AUTHOR_ME:te;d.editMsgData.push({author:ne,editMsgContent:X,externalId:o("WAStanzaUtils").toStanzaId(d.externalId),originalMsgExternalId:o("WAStanzaUtils").toStanzaId(Z),ts:o("WATimeUtils").castMilliSecondsToUnixTime(ee)})}}break}case"poll_update":{var re,oe=V(h,r,a,i);if(oe==null)continue;var ae=(re=oe.obj.payload)==null||(re=re.content)==null?void 0:re.pollUpdateMessage;if(ae!=null){var ie={externalId:o("WAStanzaUtils").toStanzaId(g.rawIdentifierString)};ae.addOption!=null&&(ie.addOption=ae.addOption),ae.vote!=null&&(ie.vote=ae.vote),ae.pollCreationMessageKey!=null&&(ie.pollCreationMessageKey=ae.pollCreationMessageKey),d.groupPollUpdateData!=null?d.groupPollUpdateData.push(ie):d.groupPollUpdateData=[ie]}break}case"unknown":{var le=_.split(":"),se=le[0];D.MUSTFIX(T||(T=babelHelpers.taggedTemplateLiteralLoose(["Unknown supplemental identifier. Identifier prefix: ",". Parts: ",""])),se||"null",le.length);break}default:g.type}}return a.add(e.otid),d}l.removeDeprecatedProtobufRestoreArgs=x,l.createUnstoredDbContentFromProtobufObject=N,l.decodeProtobufArray=H,l.decodeDecryptedMessageProtobuf=G}),98);
__d("MAWStateManagerSyncToMainThread",["FBLogger","MAWBridge","WACommsConnectionState"],(function(t,n,r,o,a,i,l){"use strict";var e={WACommsConnectionState:o("WACommsConnectionState").WACommsConnectionState};function s(){var t=function(n){var t=e[n];d(n,t.get()),t.onSet(function(e){d(n,e)})};for(var n of Object.keys(e))t(n)}function u(t,n){var o=e[t];if(o==null){r("FBLogger")("messenger_e2ee_web").warn("Unable to find GenericStateManager for key %s",t);return}o.set(n)}function c(){for(var t of Object.keys(e)){var n=e[t];d(t,n.get())}}function d(e,t){o("MAWBridge").getBridge().fireAndForget("event","updateStateManagerStateInMainThread",{stateManagerKey:e,value:t})}l.subscribeAndSyncStateManagerValuesToMainThread=s,l.updateStateManagerInMainThreadFromBridgeCall=u,l.resendCurrentValuesToMainThread=c}),98);
__d("WAFrameSocket",["WABinary","WAErrors","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=(function(e){function t(t){var n,r="SocketClosed";return n=e.call(this,t!=null?t:r)||this,n.name=r,n}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.toString=function(){return this.name},t})(babelHelpers.wrapNativeSuper(Error)),m=(function(){function t(t,n){var r=this;this.$3=new(o("WABinary")).Binary,this.closed=!1,this.$4=!1,this.onFrame=null,this.onClose=null,this.$5=function(e){r.$3.writeByteArray(e),r.convertBufferedToFrames()},this.$6=function(){if(r.$3.peek(p)){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed, waiting for pending processing"]))),r.$4=!0;return}r.$9()},this.$7=function(e){},this.$2=n,this.$1=t,t.onData=this.$5,t.onClose=this.$6,t.onError=this.$7}var n=t.prototype;return n.sendFrame=function(t){if(!this.$4){this.throwIfClosed();var e=this.$2,n=t.byteLength;this.$8(n);var r=this.$1.dataToSend;e?(this.$2=null,r.ensureAdditionalCapacity(e.length+3+n),r.writeByteArray(e)):r.ensureAdditionalCapacity(3+n),r.writeUint8(n>>16),r.writeUint16(n&65535),r.write(t),this.$1.requestSend()}},n.$9=function(){if(!this.closed){o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed"]))),this.$4=!1,this.closed=!0;var e=this.onClose;e&&e()}},n.$8=function(t){if(t>=1<<24)throw o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Buffer to send: ",""])),t),new(o("WAErrors")).BufferTooLargeError("Buffer too large: "+t)},n.convertBufferedToFrames=function(){for(var e=this.$3,t=this.onFrame;t&&e.peek(p);){var n=_(e),r=e.readByteArrayView(n);t(r),t=this.onFrame}this.$4&&!e.peek(p)&&this.$9(),t&&e.size()&&o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket: queueing partial frame of "," bytes"])),e.size())},n.throwIfClosed=function(){if(this.closed)throw new d},n.close=function(){this.$1.close()},t})();function p(e){if(e.size()<3)return!1;var t=_(e);return t<=e.size()}function _(e){return e.readUint8()<<16|e.readUint16()}l.SocketClosed=d,l.FrameSocket=m}),98);
__d("WANoiseSocket",["WACryptoDependencies","WALogger","WAPromiseQueue"],(function(t,n,r,o,a,i,l){"use strict";var e,s=Promise.reject("UNINITIALIZED HANDSHAKE"),u=new Uint8Array(0);s.catch(function(){});var c=(function(){function t(t,n,r){var a=this;this.$4=[],this.$5=new(o("WAPromiseQueue")).PromiseQueue,this.$6=new(o("WAPromiseQueue")).PromiseQueue,this.$7=0,this.$8=0,this.$9=!1,this.$14=function(t){a.$1.closed?o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["NoiseSocket socket closed while encrypting frame"]))):a.$1.sendFrame(t)},this.$12=function(e){var t=a.$7++;a.$5.enqueueHandlers(p(a.$2,t,void 0,e),a.$15)},this.$13=function(){a.$9=!0,a.$5.wait().then(function(){a.$9=!1;var e=a.$11;e&&e()})},this.$15=function(e){a.$10?a.$10(e):a.$4.push(e)},this.$1=t,this.$3=n,this.$2=r,t.onFrame=this.$12,this.$1.onClose=this.$13,t.convertBufferedToFrames()}var n=t.prototype;return n.sendFrameAsync=async function(t){var e=await this.sendFrame(t);return e},n.sendFrame=function(t){if(this.$9)return Promise.resolve();this.$1.throwIfClosed();var e=this.$8++;return this.$6.enqueueHandlers(m(this.$3,e,void 0,t),this.$14)},n.setOnFrame=function(t){this.$10=t},n.setOnClose=function(t){this.$11=t},n.close=function(){this.$1.close()},t})();function d(e){var t=new ArrayBuffer(12),n=new DataView(t);return n.setUint32(8,e),new Uint8Array(t)}function m(e,t,n,r){return o("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-GCM",iv:d(t),additionalData:n?new Uint8Array(n):u},e,r)}function p(e,t,n,r){return o("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-GCM",iv:d(t),additionalData:n?new Uint8Array(n):u},e,r)}l.NoiseSocket=c}),98);
__d("MAWDbGetDeviceChangeAlertsTxn",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return e.deviceChangeAlerts.get(t)}i.getDeviceChangeAlertsTxn=e}),66);
__d("WADevToolsDebugFns",["WADevToolsBridge"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t={};for(var n in e){var r=e[n];t[n]={id:n,args:r.serializedArgs,desc:r.desc,title:r.name}}o("WADevToolsBridge").getDevToolBridge().setHandlers("backend",{getDebugFns:function(){return t},callDebugFn:function(n){var t,r=n.args,o=n.id;(t=e[o]).execute.apply(t,r)}})}function s(e,t){return babelHelpers.extends({name:e},t)}l.registerDebugFnsToDevTool=e,l.defineDebugFunction=s}),98);
__d("MAWDebugSendMultipleMsgs",["MAWBridge","MAWExternalId","MAWLoggerUtils","Promise","WADevToolsDebugFns","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("WADevToolsDebugFns").defineDebugFunction("sendMultipleMsgs",{desc:"Sends multiple messages to a thread",execute:function(a,i){return(e||(e=n("Promise"))).all(Array.from(Array(i).keys()).map(function(e){return o("MAWBridge").getBridge().sendAndReceive("backend","sendMsg",{args:{content:e+" message"},chatJid:a,externalId:o("MAWExternalId").generateExternalId(),qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:o("MAWLoggerUtils").getInstanceKey()})}))},serializedArgs:[{desc:"ChatJid of the thread to send messages to",name:"chatJid",placeholder:"1234@msgr",type:"string"},{desc:"Number of messages to send",name:"numberOfMsgs",placeholder:"100",type:"number"}]});l.sendMultipleMsgs=s}),98);
__d("WAIndexDBStorage",["Promise","err"],(function(t,n,r,o,a,i,l){var e,s="idb-storage-testing-db",u="idb-storage-testing-store";function c(){return new(e||(e=n("Promise")))(function(e,t){var n=indexedDB.open(s);n.onerror=function(e){t(e.target.error)},n.onupgradeneeded=function(e){var t=e.target.result;t.createObjectStore(u)},n.onsuccess=function(t){var n=t.target.result;e(n)}})}function d(t){var r=t.fileBuffer,o=t.idb,a=t.key;return new(e||(e=n("Promise")))(function(e,t){var n=o.transaction([u],"readwrite");n.oncomplete=function(){e()},n.onerror=function(e){t(e.target.error)},n.onabort=function(e){t(e.target.error)};var i=n.objectStore(u),l=i.put(r,a);l.onerror=function(e){t(e.target.error)},l.onsuccess=function(){e()}})}function m(t){var o=t.idb,a=t.key;return new(e||(e=n("Promise")))(function(e,t){var n=o.transaction([u],"readonly");n.onerror=function(e){t(e.target.error)},n.onabort=function(e){t(e.target.error)};var i=n.objectStore(u),l=i.get(a);l.onerror=function(e){t(e.target.error)},l.onsuccess=function(){if(!(l.result instanceof ArrayBuffer)){t(r("err")("Result is not an ArrayBuffer"));return}e(l.result)}})}function p(t){var r=t.idb;return new(e||(e=n("Promise")))(function(e,t){var n=r.transaction([u],"readwrite");n.oncomplete=function(){e()},n.onerror=function(e){t(e.target.error)},n.onabort=function(e){t(e.target.error)};var o=n.objectStore(u),a=o.clear();a.onerror=function(e){t(e.target.error)},a.onsuccess=function(){e()}})}function _(e){var t=e.idb;t.close(),indexedDB.deleteDatabase(s)}l.prepareIDB=c,l.writeToIDB=d,l.readFromIDB=m,l.cleanupIDB=p,l.deleteIdb=_}),98);
__d("WAOpfsSyncStorage",[],(function(t,n,r,o,a,i){"use strict";var e="opfs-storage-testing-filesystem";async function l(){var t;if((navigator==null||(t=navigator.storage)==null?void 0:t.getDirectory)==null)return Promise.reject("OPFS is not supported");var n=await navigator.storage.getDirectory(),r=await n.getDirectoryHandle(e,{create:!0});return r}async function s(e){var t=e.directoryHandle,n=e.fileBuffer,r=e.fileName,o=await t.getFileHandle(r,{create:!0}),a=await o.createSyncAccessHandle(),i=new DataView(n);return a.write(i,{at:0}),a.close()}async function u(e){var t=e.directoryHandle,n=e.fileName,r=await t.getFileHandle(n),o=await r.createSyncAccessHandle(),a=o.getSize(),i=new ArrayBuffer(a),l=new DataView(i);return await o.read(l,{at:0}),o.close(),i}async function c(e){var t,n=e.directoryHandle,r=e.fileName;if((navigator==null||(t=navigator.storage)==null?void 0:t.getDirectory)==null)return Promise.reject("OPFS is not supported");await n.removeEntry(r)}async function d(e){var t,n=e.directoryHandle;if((navigator==null||(t=navigator.storage)==null?void 0:t.getDirectory)==null)return Promise.reject("OPFS is not supported");var r=0,o=!1,a=!1,i;try{for(var l=babelHelpers.asyncIterator(n.values()),s;o=!(s=await l.next()).done;o=!1){var u=s.value;r++}}catch(e){a=!0,i=e}finally{try{o&&l.return!=null&&await l.return()}finally{if(a)throw i}}return r}i.prepareFileSystem=l,i.writeToFileSystem=s,i.readFromFileSystem=u,i.cleanupFileSystem=c,i.getFileCount=d}),66);
__d("WATestBenchmark",[],(function(t,n,r,o,a,i){var e=function(){return performance.now()};async function l(t,n,r){var o={},a=[],i=async function(i,l){a.push(i),o[i]=[];for(var r=0;r<t;r++){for(var s=e(),u=0;u<n;u++)await l(r,u);var c=e();o[i].push((c-s)/n)}};return await r(i),a.map(function(e){var t=o[e].sort(function(e,t){return e-t}),n=t.length;return{name:e,min:t[0],p50:t[Math.floor(n/2)],avg:t.reduce(function(e,t){return e+t},0)/n}})}function s(e){if(e<1){var t=Math.round(e*1e4);return t+"\u03BCs"}var n=Math.round(e);return n+"ms"}function u(e,t){t.forEach(function(t){var n=t.avg,r=t.min,o=t.name,a=t.p50;e("["+o+"] min: "+s(r)+", avg: "+s(n)+", p50: "+s(a))})}function c(e,t){var n=`
`;t.forEach(function(e){var t=e.avg,r=e.min,o=e.name,a=e.p50;n+=o+","+Math.round(r)+","+Math.round(t)+","+Math.round(a)+`
`}),e(n)}i.createBenchmark=l,i.printReport=u,i.printAsCSVInMS=c}),66);
__d("WAWebCacheStorage",[],(function(t,n,r,o,a,i){var e="web-cache-storage-testing";function l(){return caches.open(e)}function s(e){var t=e.cache,n=e.fileBuffer,r=e.key,o=new Response(n);return t.put(r,o)}async function u(e){var t=e.cache,n=e.key,r=await t.match(n);return r.arrayBuffer()}function c(){return caches.delete(e).then(function(){})}function d(e){var t=e.cache;return t.keys().then(function(e){return e.length})}i.prepareCache=l,i.writeToCache=s,i.readFromCache=u,i.cleanupCache=c,i.getCacheCount=d}),66);
__d("WARunStorageBenchmark",["WAIndexDBStorage","WAOpfsSyncStorage","WATestBenchmark","WAWebCacheStorage"],(function(t,n,r,o,a,i,l){"use strict";var e=async function(t,n,r,a,i){var e=1024*r,l=new Blob([new Uint8Array(e).fill(255)]),s=await l.arrayBuffer();t("datapoints: "+a+" repetitions: "+i+" blob size: "+r+"KB");var u=await o("WAIndexDBStorage").prepareIDB();await o("WAIndexDBStorage").cleanupIDB({idb:u}),await o("WAWebCacheStorage").cleanupCache();var c=await o("WAWebCacheStorage").prepareCache(),d=await o("WAOpfsSyncStorage").prepareFileSystem();t("start write benchmark...");var m=await o("WATestBenchmark").createBenchmark(a,i,async function(e){await e("IndexedDB write",async function(e,t){await o("WAIndexDBStorage").writeToIDB({idb:u,fileBuffer:await s,key:e+"_"+t})}),await e("Web Cache write",async function(e,t){await o("WAWebCacheStorage").writeToCache({cache:c,fileBuffer:s,key:e+"_"+t})}),await e("OPFS Sync write",async function(e,t){await o("WAOpfsSyncStorage").writeToFileSystem({directoryHandle:d,fileBuffer:s,fileName:e+"_"+t})})});t("end write benchmark..."),n?o("WATestBenchmark").printAsCSVInMS(t,m):o("WATestBenchmark").printReport(t,m),t("start read benchmark...");var p=await o("WATestBenchmark").createBenchmark(a,i,async function(e){var t;await e("IndexedDB read",async function(e,n){t=await o("WAIndexDBStorage").readFromIDB({idb:u,key:e+"_"+n})});var n;await e("Web Cache read",async function(e,t){n=await o("WAWebCacheStorage").readFromCache({cache:c,key:e+"_"+t})});var r;if(await e("OPFS Sync read",async function(e,t){r=await o("WAOpfsSyncStorage").readFromFileSystem({directoryHandle:d,fileName:e+"_"+t}),await o("WAOpfsSyncStorage").cleanupFileSystem({directoryHandle:d,fileName:e+"_"+t})}),!(t instanceof ArrayBuffer&&n instanceof ArrayBuffer&&r instanceof ArrayBuffer))return Promise.reject("read result is not ArrayBuffer")});t("end read benchmark..."),n?o("WATestBenchmark").printAsCSVInMS(t,p):o("WATestBenchmark").printReport(t,p)};l.runStorageBenchmark=e}),98);
__d("WormDbDebuggingUtils",["WAJids","WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";async function e(){var e=await o("WASignalDB").getDbPromise();return e.runInTransaction(["identity"],"readonly",function(e){return e.stores.identity.readAll()},"debug-get-identities")}async function s(){var e=await o("WASignalDB").getDbPromise();return e.runInTransaction(["contacts"],"readonly",function(e){return e.stores.contacts.readAll()},"debug-get-contacts")}async function u(){var e=await o("WASignalDB").getDbPromise();return e.runInTransaction(["session"],"readonly",function(e){return e.stores.session.readAll()},"debug-get-sessions")}async function c(){var e=await o("WASignalDB").getDbPromise();return e.runInTransaction(["senderKeySessions"],"readonly",function(e){return e.stores.senderKeySessions.readAll()},"debug-get-sender-key-sessions")}async function d(){var e=await o("WASignalDB").getDbPromise();return e.runInTransaction(["prekey"],"readonly",function(e){return e.stores.prekey.readAll()},"debug-get-prekeys")}async function m(){var e=await o("WASignalDB").getDbPromise();return e.runInTransaction(["prekeyGeneration"],"readonly",function(e){return e.stores.prekeyGeneration.readAll()},"debug-get-prekey-generations")}async function p(){var e=await o("WASignalDB").getDbPromise();return e.runInTransaction(["signedPrekey"],"readonly",function(e){return e.stores.signedPrekey.readAll()},"debug-get-signed-prekeys")}async function _(){var e=await o("WASignalDB").getDbPromise();return e.runInTransaction(["meta"],"readonly",function(e){return e.stores.meta.readAll()},"debug-get-meta-rows")}function f(t){return e().then(function(e){return e.filter(function(e){return e.userJid===t})})}function g(e){return s().then(function(t){return t.find(function(t){return t.contactJid===e})})}function h(e){return u().then(function(t){return t.filter(function(t){return o("WAJids").extractUserJid(t.id)===e})})}function y(e){return c().then(function(t){return t.filter(function(t){return t.userJid===e})})}l.getIdentities=e,l.getContacts=s,l.getSessions=u,l.getSenderKeySessions=c,l.getPrekeys=d,l.getPrekeyGenerations=m,l.getSignedPrekeys=p,l.getMetaRows=_,l.getIdentitiesForUser=f,l.getContact=g,l.getSessionsForUser=h,l.getSenderKeySessionsForUser=y}),98);
__d("MAWDebug",["BlobStorageApi","EBConsoleUtils","EBDBConsistencyApi","EBDeps","EBLS","EBWorkerEBDBApi","EBWorkerEBSMStateUtils","ExecutionEnvironment","FBLogger","LSMEBTaskCreationSource","MAWAdminWriteCutoverThreadMsgTxn","MAWArmadilloPollTableSchema.pb","MAWBackend","MAWBridge","MAWBulkHandleIncomingMsgApi","MAWCacheServiceDB","MAWConfig","MAWDbAddDeviceChangeAlertsTxn","MAWDbAppDataTxns","MAWDbChunkTxns","MAWDbDeviceChangeAlerts","MAWDbEditMsgHistoryTxns","MAWDbGetDeviceChangeAlertsByOptionsTxn","MAWDbGetDeviceChangeAlertsTxn","MAWDbGetUnArchivedDeviceChangeAlertsCountTxn","MAWDbGroupInfoTxns","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbMsgTypeVersionTxns","MAWDbObjDecode","MAWDbObjEncode","MAWDbParticipantTxns","MAWDbPendingReceiptTxns","MAWDbPoll","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWDbUpdateDeviceChangeAlertsTxn","MAWDbVersion","MAWDbXMATxns","MAWDebugSendMultipleMsgs","MAWDexieTable","MAWEphemeralCleaner","MAWEphemeralSettingsTxns","MAWExternalId","MAWGroupSetMemberAddMode","MAWJobDefinitions","MAWJobManager","MAWKeychainNaClCrypto","MAWLoadMsgsApi","MAWLoggerUtils","MAWMediaUtils","MAWMsgType","MAWRotateDTSG","MAWSendEphemeralSettingMsg","MAWTransactionMode","MAWTransactor","MAWUnsafeCoerce","MAWVault","MpsTypes","OfflineThreadingId","QPLFlow","WAAPI","WAAbPropsInit","WABuildMpsPayload","WADbTransactor","WADevicesState","WAExceededStorageQuota","WAGatherMediaInfo","WAGetPlatformFromStanzaId","WAGlobals","WAGzip","WAHandleFailureUtils","WAJobOrchestratorTypes","WALogger","WAMPSFlushable","WAMediaUtils","WAProtocolQueue","WARotateSignedPreKey","WARunStorageBenchmark","WASignalDB","WASignalOther","WATimeUtils","WebMps","WebStorageEstimator","WormDbDebuggingUtils","emptyFunction","err","gkx","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=["s2sInstanceKey","s2sUserFlowQPLEvent"],s,u,c={addBadProtocolQueueInstruction:function(){var e={instruction:"bad",type:"instruction"};return o("WAProtocolQueue").protocolQueue().addAndCommit([e])},addDeviceChangeAlerts:function(t){return d(p({deviceChangeAlerts:o("MAWTransactionMode").READWRITE})(o("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn)(t))},addGroupParticipants:function(t,n,r){return o("MAWJobManager").getJobManager().waitUntilCompleted(o("MAWJobDefinitions").jobSerializers.addGroupParticipants(t,n,r))},addICDCAlert:function(t){return o("WAGlobals").getWaOneQueue().enqueue(function(){return o("WAMPSFlushable").mpsFlushable.enqueue(o("WABuildMpsPayload").buildMpsIcdcAdminMessage(t,o("WATimeUtils").unixTime(),o("WAGlobals").getDependencies().generateExternalId()),function(){},"maw_debug"),Promise.resolve()},{flush:!0,operationType:"debug_operation"}).then(r("emptyFunction"))},benchmarkStorage:function(t,n,r,a){t===void 0&&(t=!1),n===void 0&&(n=1),r===void 0&&(r=50),a===void 0&&(a=500),o("WARunStorageBenchmark").runStorageBenchmark(function(e){return console.log("[storage benchmark]: "+e)},t,n,r,a)},checkStorageQuota:function(){return o("WAExceededStorageQuota").checkStorageQuota()},clearBlobStorage:function(){return r("BlobStorageApi").clear().then(function(e){if(e.success)r("FBLogger")("BlobStorage").info("Blob storage cleared");else throw r("err")("Failed to clear blob storage")})},createGroup:function(t,n,r){return o("MAWJobManager").getJobManager().waitUntilCompleted(o("MAWJobDefinitions").createStartJobInfo("createGroup",{extras:{clientThreadKey:r,platform:"msgr"},key:r,s2sInstanceKey:o("MAWLoggerUtils").getInstanceKey(),subject:t,users:n}))},createOrUpdateThread:function(t){return o("MAWBridge").getBridge().sendAndReceive("backend","createOrUpdateThread",{contactFbid:t,description:"MAWDebug",threadKey:o("OfflineThreadingId").createOfflineThreadingID()})},createTestPoll:function(t){p({poll:o("MAWTransactionMode").READWRITE})(function(e){return e.poll.put({chatJid:t,encKey:new ArrayBuffer(0),latestSenderTimestampsMs:new Map([["@me",o("WATimeUtils").millisTime()]]),pollAuthor:"@me",pollOptions:new Map([[o("MAWDbPoll").convertStringToOptionHash("option1Hash"),{optionText:"option1",voteAuthors:new Set(["@me"])}]]),pollParticipantCount:2,pollStanzaId:o("MAWExternalId").generateExternalId(),pollState:o("MAWArmadilloPollTableSchema.pb").POLL_STATE.OPEN,selectableOptionsCount:0,title:"Test Poll"})})(t)},decodeEAR:function(t,n){return o("MAWDbObjDecode").decodeDbObj(t,n)},deflate:function(t){var e=o("WAGzip").createDeflate();return e.push(t,!0),e.result()},deleteGroupInvitesByThreadAndInvitedParticipant:function(t,n){return d(p({groupInvites:o("MAWTransactionMode").READWRITE})(o("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant)(t,n))},demoteGroupParticipants:function(t,n){return o("MAWJobManager").getJobManager().waitUntilCompleted(o("MAWJobDefinitions").jobSerializers.demoteGroupParticipants(t,n))},deregisterPhone:function(){r("promiseDone")(o("WAHandleFailureUtils").deregisterPhone())},dropExpiredMessagesFromDB:function(){var e=o("MAWEphemeralCleaner").getEphemeralCleaner_FOR_TESTING_ONLY();if(e)e.purgeDeletions.update(o("WATimeUtils").futureUnixTime(5));else throw r("err")("Cannot delete expired msgs as cleaner is not initialized!")},dropExpiredMessagesFromUI:function(){var e=o("MAWEphemeralCleaner").getEphemeralCleaner_FOR_TESTING_ONLY();if(e)e.expiry.update(o("WATimeUtils").futureUnixTime(5));else throw r("err")("Cannot delete expired msgs as cleaner is not initialized!")},encodeEAR:function(t,n){return o("MAWDbObjEncode").encodeDbObj(t,n)},encryptEARTweetNaCl:function(t,n,r){return o("MAWKeychainNaClCrypto").encryptTweetNaCl(t,n,r)},estimateStorage:async function(){var e=await o("WebStorageEstimator").estimateStorage();return e},executeQuery:function(t){var e=Object.keys(o("MAWDbVersion").CURRENT_MAW_STORES).filter(function(e){return o("MAWDbVersion").CURRENT_MAW_STORES[e]!=null}).reduce(function(e,t){var n;return babelHelpers.extends({},e,(n={},n[t+""]=o("MAWTransactionMode").READWRITE,n))},{});return p(e)(t)()},fetchMessagesForSpamReport:async function(t,n){var e=await o("WebMps").mps().spamReportLoadMessages({numMessages:n!=null?n:30,threadId:t});return e},forwardMsg:function(t,n){return o("MAWBridge").getBridge().sendAndReceive("backend","forwardMsg",{args:{args:{},chatJid:t,externalId:o("MAWExternalId").generateExternalId(),protocolMsgId:n},qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:o("MAWLoggerUtils").getInstanceKey()})},fromUnixTime:function(t){return o("WATimeUtils").toDate(t)},gatherMediaInfo:function(){r("promiseDone")(o("WAGatherMediaInfo").gatherMediaInfo())},generateAndUploadPreKeys:function(){return r("WAAPI").generateAndUploadPreKeys({reason:"test"})},generateAndUploadPreKeysMultipleCalls:function(){return Promise.all([r("WAAPI").generateAndUploadPreKeys({reason:"test"}),r("WAAPI").generateAndUploadPreKeys({reason:"test"}),r("WAAPI").generateAndUploadPreKeys({reason:"test"})])},generateCipherTextMessagesForChat:function(t,n){return Promise.all(Array.from({length:n}).map(function(e,n){var r=o("WATimeUtils").castMilliSecondsToUnixTime(Date.now()),a=o("MAWExternalId").generateExternalId(),i={ack:2,altIndex:void 0,author:"@me",externalId:a,msgContent:{content:"Stub message #"+n},msgId:o("MAWDbMsg").craftMsgIdV2(1,1,{externalId:a}),serverTs:r,threadJid:t,ts:r,type:o("MAWMsgType").MSG_TYPE.CIPHERTEXT};return p({messages:o("MAWTransactionMode").READWRITE})(function(e){return e.messages.add(i)})(i)}))},generateDuplicateMessagesForChat:function(t,n){return c.generateMessagesForChat(t,n).then(function(e){var t=e.msgResults.values().map(function(e){var t;return(t=e.value)==null?void 0:t.protocolMsgId.externalId}).filter(Boolean),n=t[0];return p({messages:o("MAWTransactionMode").READWRITE})(function(e){return o("MAWDexieTable").dexieAll(t.map(function(t){return e.messages.get({externalId:t}).then(function(t){if(t!=null)return e.messages.put(babelHelpers.extends({},t,{externalId:n,protocolMsgId:void 0}))})})).then(r("emptyFunction"))})(t)})},generateMessagesForChat:function(t,n){return o("MAWBulkHandleIncomingMsgApi").bulkHandleIncomingMsgs(Array.from({length:n}).map(function(e,n){var r=o("WATimeUtils").castMilliSecondsToUnixTime(Date.now()),a=o("MAWExternalId").generateExternalId(),i={ack:2,altIndex:void 0,author:"@me",externalId:a,msgContent:{content:"Stub message #"+n},serverTs:r,ts:r,type:"Text"};return{msgData:{folder:null,id:{author:"@me",chat:t,externalId:a},msg:{encoded:new Uint8Array(0),version:"v2"},recipientsCount:null,reportingMeta:null,ts:r,type:"IncomingMsg"},receiveFlow:o("QPLFlow").startNoopQPLFlow(),stanzaSource:"wa-incoming",unstoredContent:{unstoredDbMedia:null,unstoredDbMsg:i,unstoredDbReaction:null,unstoredDbReceiverFetchInfo:null}}}),r("LSMEBTaskCreationSource").TEST_ONLY)},getAbProp:function(t){return o("WAAbPropsInit").getAbProp(t)},getAbProps:function(){return o("WAAbPropsInit").getAbProps()},getAppDatas:function(t){return d(p({appData:o("MAWTransactionMode").READONLY})(o("MAWDbAppDataTxns").bulkGetAppData)(t))},getAppMetaByKey:function(t){return d(p({appMeta:o("MAWTransactionMode").READONLY})(o("MAWDbMsgTypeVersionTxns").getAppMetaValue)(t))},getChunksByChunkId:function(t){return d(p({chunk:o("MAWTransactionMode").READONLY})(o("MAWDbChunkTxns").bulkGetChunks)(t))},getClockSkew:function(){return o("WATimeUtils").getClockSkew()},getConfig:function(){return Object.fromEntries(Object.entries(o("MAWConfig").getConfig()).map(function(e){var t=e[0],n=e[1],r=n;try{r=n()}catch(e){r=n}return[t,r]}))},getCurrentUserDeviceList:function(){return r("WAAPI").getCurrentUserDeviceList()},getDeviceChangeAlerts:function(t){return d(p({deviceChangeAlerts:o("MAWTransactionMode").READWRITE})(o("MAWDbGetDeviceChangeAlertsTxn").getDeviceChangeAlertsTxn)(t))},getDeviceChangeAlertsByOptions:function(t){return d(p({deviceChangeAlerts:o("MAWTransactionMode").READWRITE})(o("MAWDbGetDeviceChangeAlertsByOptionsTxn").getDeviceChangeAlertsByOptionsTxn)(t))},getDeviceChangeAlertsByOptionsLLA:function(t){return o("MAWBridge").getBridge().sendAndReceive("backend","getDeviceChangeAlertsByOptions",{options:t})},getDevices:function(t,n){return r("WAAPI").getDevices({ignoreDhash:n,reason:"debug",users:new Set(t)})},getDevicesState:function(){return o("WADevicesState").getDevicesState()},getEBDBClientState:function(){return o("EBWorkerEBDBApi").getSecureEBClientState()},getEBDeps:function(){return o("EBDeps").getDeps()},getEBEpochs:function(){return o("EBConsoleUtils").getAllEpochsSorted()},getEBSMConsistency:async function(){return o("EBDBConsistencyApi").checkRegistrationConsistency((await o("EBLS").genLSClient()).db)},getEBSMWorkerState:function(){return(u||(u=r("ExecutionEnvironment"))).isInWorker?o("EBWorkerEBSMStateUtils").getEBSMWorkerState():o("MAWBridge").getBridge().sendAndReceive("backend","getEBSMWorkerState")},getEditMsgHistoryByEditMsgHistoryId:function(t){return d(p({editMsgHistory:o("MAWTransactionMode").READONLY})(o("MAWDbEditMsgHistoryTxns").bulkGetEditMsgHistorys)(t))},getEditMsgHistoryByProtocolMsgId:function(t){return d(p({editMsgHistory:o("MAWTransactionMode").READONLY})(o("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId)(t))},getGroupInfosByGroupJid:function(t){return d(p({groupInfo:o("MAWTransactionMode").READONLY})(o("MAWDbGroupInfoTxns").getGroupInfos)(t))},getGroupInvite:function(t,n){return d(p({groupInvites:o("MAWTransactionMode").READONLY})(o("MAWDbGroupInviteTxns").maybeGetGroupInvite)(t,n))},getGroupInvitesByThreadAndInvitedParticipant:function(t,n){return d(p({groupInvites:o("MAWTransactionMode").READONLY})(o("MAWDbGroupInviteTxns").getGroupInvitesByThreadAndInvitedParticipant)(t,n))},getHmacKeyFromGlobals:function(){return o("WAGlobals").getHMACKey()},getKeyTransparencyVerificationStatus:function(t){return o("MAWBridge").getBridge().sendAndReceive("kt","keyVerificationStatus",{userJid:t})},getMediaBackupForObjectId:function(t){return d(p({mediaBackup:o("MAWTransactionMode").READONLY})(o("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId)(t))},getMediaByIdWithDecodedMediaEntries:async function(t){var e=await p({media:o("MAWTransactionMode").READONLY})(o("MAWDbMediaTxns").bulkGetMedias)(t);return e.forEach(function(e){e!=null&&e.mediaEntries&&(e.mediaEntries=new Map(Array.from(e.mediaEntries,function(e){var t=e[0],n=e[1];return[t,o("WAMediaUtils").decodeMediaEntryData(n)]})))}),d(Promise.resolve(e))},getMediaByMediaId:function(t){return d(p({media:o("MAWTransactionMode").READONLY})(o("MAWDbMediaTxns").bulkGetMedias)(t))},getMediaByPlaintextHash:function(t){return d(p({media:o("MAWTransactionMode").READONLY})(o("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash)(t))},getMessagesByMsgIds:function(t){return d(p({messages:o("MAWTransactionMode").READONLY})(function(e){return e.messages.where("msgId").anyOf(t).toArray().then(function(e){return e.filter(Boolean)})})(t))},getMsgsByChat:function(t){return d(p({messages:o("MAWTransactionMode").READONLY})(function(e){return e.messages.where("threadJid").equals(t).toArray()})())},getMsgsByMsgId:function(t){return d(p({messages:o("MAWTransactionMode").READONLY})(o("MAWDbMsgTxns").getMsgsByMsgIds)(t))},getMsgsByProtocolMsgId:function(t){return d(p({messages:o("MAWTransactionMode").READONLY})(o("MAWDbMsgTxns").getMsgsByProtocolMsgId)(t))},getNewDTSG:async function(){return(await o("MAWRotateDTSG").getNewDTSG()).token},getParticipantsByParticipantKeys:function(t){return d(p({participants:o("MAWTransactionMode").READONLY})(o("MAWDbParticipantTxns").bulkGetParticipants)(t))},getPendingReceipts:function(t){return d(p({pendingReceipts:o("MAWTransactionMode").READONLY})(o("MAWDbPendingReceiptTxns").getPendingReceipts)(t))},getPlatform:function(t){return o("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(t)},getProtocolMsgId:function(t){return o("MAWBridge").getBridge().sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:t})},getReactionByReactToExternalId:function(t){return d(p({reactions:o("MAWTransactionMode").READONLY})(function(e){return e.reactions.where("reactToExternalId").anyOf(t).toArray()})(t))},getReactionByReactToMsgId:function(t){return d(p({messages:o("MAWTransactionMode").READONLY,reactions:o("MAWTransactionMode").READONLY})(function(e){return e.messages.where("msgId").anyOf(t).toArray().then(function(t){return o("MAWDbReactionsTxns").getReactionsFromMessages(e,t)})})(t))},getReceiptByWAMsgId:function(t){return d(_({receipts:o("MAWTransactionMode").READONLY})(function(e,t){return e.receipts.get({waMsgId:t})})(t))},getThreadsByChatJids:function(t){return d(p({threads:o("MAWTransactionMode").READONLY})(o("MAWDbThreadTxns").getThreads)(t))},getUnArchivedDeviceChangeAlertsCount:function(){return d(p({deviceChangeAlerts:o("MAWTransactionMode").READWRITE})(o("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn)())},getUnrenderedMsgsByMsgId:function(t){return d(p({unrenderedMessages:o("MAWTransactionMode").READONLY})(o("MAWDbUnrenderedMsgTxns").getUnrenderedMsgsByMsgIds)(t))},getXMAByXMAId:function(t){return d(p({xma:o("MAWTransactionMode").READONLY})(o("MAWDbXMATxns").bulkGetXMAs)(t))},hmacPlaintextHash:function(t){return o("MAWMediaUtils").genHMACPlaintextHash(t)},inflate:function(t){return o("WAGzip").inflate(t)},leaveGroups:function(t){return o("MAWJobManager").getJobManager().waitUntilCompleted(o("MAWJobDefinitions").jobSerializers.leaveGroups(t))},loadMsgs:async function(t){var e,n=await o("MAWLoadMsgsApi").loadMsgsFromTs(t.chatJid,(e=t.numMsgs)!=null?e:10,t.direction,t.sortOrderMs,t.loadOriginalMsg,t.msgId,{admin:!0,editMsgHistory:!0,media:!0,polls:!0,reactions:!0,receiverFetch:!0,xma:!0});return babelHelpers.extends({},n,{msgs:n.msgs.map(function(e){return babelHelpers.extends({},e,{content:e.content!=null?o("MAWVault").unvault(e.content):""})})})},makeError:function(t){throw r("FBLogger")("messenger_web_devx").mustfixThrow(t)},makeWAError:function(t){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",""])),t)},markThreadAsRead:function(t,n){return o("MAWJobManager").getJobManager().waitUntilCompleted(o("MAWJobDefinitions").jobSerializers.markThreadAsRead(t,null,!1,!1,n,{priority:o("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}))},maybeGetXMAFromProtocolMsgId:function(t){return d(p({xma:o("MAWTransactionMode").READONLY})(o("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId)(t))},mpsLoadLatestMsg:function(t){return o("WebMps").mps().loadMessages({debug:{purpose:"getLatestTimestampForDebug"},direction:"desc",from:[o("MpsTypes").toTimestamp(Number.MAX_SAFE_INTEGER),void 0],numMessages:1,threadId:o("MpsTypes").toThreadId(t)})},notifyDeviceChange:function(t){return r("WAAPI").notifyDeviceChange({users:t})},overrideAbProp:function(t,n){o("WAAbPropsInit").overrideAbProp(t,n)},promoteGroupParticipants:function(t,n){return o("MAWJobManager").getJobManager().waitUntilCompleted(o("MAWJobDefinitions").jobSerializers.promoteGroupParticipants(t,n))},protocolQueue:function(){return o("WAProtocolQueue").protocolQueue()},putGroupInvite:function(t){return d(p({groupInvites:o("MAWTransactionMode").READWRITE})(o("MAWDbGroupInviteTxns").putGroupInvite)(t))},readCacheStore:function(t){return o("MAWCacheServiceDB").getOrSetupMAWCacheDB().then(function(e){return e.runInTransaction([t],"readonly",function(e){return e.stores[t].readAll()},"Debug - read "+t,i.id+":1128")})},readProtocolQueue:function(){return o("WAProtocolQueue").protocolQueue().read()},readWormStore:function(t){return o("WASignalDB").getDb().runInTransaction([t],"readonly",function(e){return e.stores[t].readAll()},"Debug - read "+t,i.id+":1143")},removeDevice:function(t,n){return r("WAAPI").removeDevice({deviceId:t,identity:n})},removeGroupParticipants:function(t,n){return o("MAWJobManager").getJobManager().waitUntilCompleted(o("MAWJobDefinitions").jobSerializers.removeGroupParticipants(t,n))},reportUserSpam:function(t,n){return o("MAWJobManager").getJobManager().waitUntilCompleted(o("MAWJobDefinitions").jobSerializers.reportUserSpam(t,"frx",n,!1,["harassment"],"fake debug context"))},reregisterPhone:function(){return o("WAHandleFailureUtils").reregisterPhone()},rotateSignedPreKey:function(){return o("WARotateSignedPreKey").rotateSignedPreKey()},runKeyTransparencyVerification:function(t){return o("MAWBridge").getBridge().sendAndReceive("kt","runKeyVerification",{userJid:t})},sendAppData:function(t,n){return o("MAWJobManager").getJobManager().waitUntilCompleted(o("MAWJobDefinitions").jobSerializers.sendAppData({contents:t,deviceJids:n}))},sendEditMsg:function(t,n){return o("MAWBridge").getBridge().sendAndReceive("backend","sendEditMsg",{args:{editMsgContent:{content:t.editMsgContent.content,mentionedJids:[]},originalProtocolMsgId:t.originalProtocolMsgId},chatJid:t.originalProtocolMsgId.chat,externalId:n,qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:o("MAWLoggerUtils").getInstanceKey()})},sendEphemeralSettingMsg:function(t,n){return o("MAWSendEphemeralSettingMsg").sendEphemeralSettingMsgFn({args:n,chatJid:t,externalId:o("MAWExternalId").generateExternalId(),qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:o("MAWLoggerUtils").getInstanceKey()})},sendMessageTooAllExistingGroups:async function(){var e=await p({groupInfo:o("MAWTransactionMode").READONLY})(function(e){return e.groupInfo.toArray()})(),t=[];for(var n of e)t.push(c.sendMsg(n.groupJid,{content:"message to "+n.groupJid+" at "+new Date().getTime(),s2sInstanceKey:o("MAWLoggerUtils").getInstanceKey()}));return t},sendMsg:function(n,a){var t=a.s2sInstanceKey,i=a.s2sUserFlowQPLEvent,l=babelHelpers.objectWithoutPropertiesLoose(a,e);return o("MAWBridge").getBridge().sendAndReceive("backend","sendMsg",{args:l,chatJid:n,externalId:o("MAWExternalId").generateExternalId(),qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:t})},sendMultipleMsgs:o("MAWDebugSendMultipleMsgs").sendMultipleMsgs.execute,sendReaction:function(t,n,a,i){return o("MAWBridge").getBridge().sendAndReceive("backend","sendReactionMsg",{args:{groupingKey:"",reaction:i,reactToAuthor:a,reactToProtocolMsgId:n},chatJid:t,externalId:n.externalId,qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:o("MAWLoggerUtils").getInstanceKey()})},setEphemeralSettingWithoutUpdate:function(t,n,r,a){var e=r==null?o("WATimeUtils").unixTime():o("WATimeUtils").futureUnixTime(r);return d(p({ephemeralSettings:o("MAWTransactionMode").READWRITE,groupInfo:o("MAWTransactionMode").READONLY,messages:o("MAWTransactionMode").READWRITE,threads:o("MAWTransactionMode").READWRITE})(o("MAWEphemeralSettingsTxns").handleAndWriteOutgoingUserEphemeralSettingChange)(t,n,e,a))},setGroupSubject:function(t,n){return o("MAWJobManager").getJobManager().waitUntilCompleted(o("MAWJobDefinitions").jobSerializers.setGroupSubject(t,n))},setMemberAddMode:function(t,n){return o("MAWGroupSetMemberAddMode").setMemberAddModeFn({groupJid:t,memberAddMode:n})},startComms:function(){var e;(e=o("MAWBackend").getWaComms())==null||e.startComms()},stopComms:function(){var e;(e=o("MAWBackend").getWaComms())==null||e.stopComms()},syncAbProps:function(t){var e=t!==!0;return r("WAAPI").syncAbProps({sendHash:e})},triggerSecureStorageKeyChangeAlert:function(){var e={action:o("MAWDbDeviceChangeAlerts").KEY_CHANGE,deviceJid:o("WAGlobals").getMyDeviceJid(),identity:o("MAWUnsafeCoerce").unsafeCoerce(o("WASignalOther").makeBytes(33)),isArchived:!1,model:"secure_storage",platform:"Meta",ts:o("WATimeUtils").unixTime()};return d(p({deviceChangeAlerts:o("MAWTransactionMode").READWRITE})(o("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn)(e))},updateDeviceChangeAlerts:function(t){return d(p({deviceChangeAlerts:o("MAWTransactionMode").READWRITE})(o("MAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn)(t))},updateDeviceChangeAlertsLLA:function(t){return o("MAWBridge").getBridge().sendAndReceive("backend","updateDeviceChangeAlerts",{alert:t})},updateDeviceChangeAlertsLogInStatus:function(t){return d(p({deviceChangeAlerts:o("MAWTransactionMode").READWRITE})(o("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn)(t))},wormGetContact:function(t){return o("WormDbDebuggingUtils").getContact(t)},wormGetContacts:function(){return o("WormDbDebuggingUtils").getContacts()},wormGetIdentities:function(){return o("WormDbDebuggingUtils").getIdentities()},wormGetIdentitiesForUser:function(t){return o("WormDbDebuggingUtils").getIdentitiesForUser(t)},wormGetMetaRows:function(){return o("WormDbDebuggingUtils").getMetaRows()},wormGetPrekeyGenerations:function(){return o("WormDbDebuggingUtils").getPrekeyGenerations()},wormGetPrekeys:function(){return o("WormDbDebuggingUtils").getPrekeys()},wormGetSenderKeySessions:function(){return o("WormDbDebuggingUtils").getSenderKeySessions()},wormGetSenderKeySessionsForUser:function(t){return o("WormDbDebuggingUtils").getSenderKeySessionsForUser(t)},wormGetSessions:function(){return o("WormDbDebuggingUtils").getSessions()},wormGetSessionsForUser:function(t){return o("WormDbDebuggingUtils").getSessionsForUser(t)},wormGetSignedPrekeys:function(){return o("WormDbDebuggingUtils").getSignedPrekeys()},writeCutoverThreadAdminMsg:function(t,n){var e;return d(p({chunk:(e=o("MAWTransactionMode")).READONLY,ftsBackloggedMessages:e.READWRITE,groupInfo:e.READONLY,media:e.READONLY,messages:e.READWRITE,threads:e.READWRITE})(o("MAWAdminWriteCutoverThreadMsgTxn").writeCutoverThreadAdminMsg)(t,n))},writeRollbackCutoverThreadAdminMsg:function(t){var e=p({threads:o("MAWTransactionMode").READONLY})(o("MAWDbThreadTxns").getThread)(t);return e.then(function(e){if(!e.success)return Promise.resolve();var t=e.value;return d(p({chunk:o("MAWTransactionMode").READONLY,ftsBackloggedMessages:o("MAWTransactionMode").READWRITE,groupInfo:o("MAWTransactionMode").READONLY,media:o("MAWTransactionMode").READONLY,messages:o("MAWTransactionMode").READWRITE,threads:o("MAWTransactionMode").READWRITE})(o("MAWAdminWriteCutoverThreadMsgTxn").writeRollbackCutoverAdminMsg)(t))})}};function d(e){return e.then(function(e){return e})}if(r("gkx")("23903")){var m=o("MAWUnsafeCoerce").unsafeCoerce(self);m.Debug=c,m.WAAPI=r("WAAPI")}function p(e){return function(t){return o("MAWTransactor").makeMsgrTransactor(e,"debug",function(e){return(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.apply(void 0,[e].concat(r))})})}}function _(e){return function(t){return o("WADbTransactor").makeSignalTransactor(e,"debug",function(e){return(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.apply(void 0,[e].concat(r))})})}}l.MAWDebugFuncs=c}),98);
__d("XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder",["jsRouteBuilder"],(function(t,n,r,o,a,i,l){var e=r("jsRouteBuilder")("/api/v1/direct_v2/restoration_cdn_url/",Object.freeze({}),void 0),s=e;l.default=s}),98);
__d("endpoints",["CSRFGuard","PolarisConfig","Promise","XHRRequest","XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder","getAsyncParams"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){return new(e||(e=n("Promise")))(function(e,n){var a=r("getAsyncParams")("POST"),i=new(r("XHRRequest"))(r("XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder").buildURL({}));i.setMethod("POST").setRequestHeader("X-IG-App-ID",o("PolarisConfig").getIGAppID()).setData(babelHelpers.extends({},a,{payload:t})).setResponseHandler(function(t){try{var r=t.trim();o("CSRFGuard").exists(r)&&(r=o("CSRFGuard").clean(r));var a=JSON.parse(r);e(a.payload.restoration_cdn_url)}catch(e){n(e)}}).setErrorHandler(function(e){n(e)}).send()})}l.fetchEBRestoreCDNUrl=s}),98);
__d("IGDAWDebug",["I64","IGDAWProtocolQueueInstructions","MAWDebug","MAWReStoreDb","MAWUnsafeCoerce","WAJids","WAProtocolQueue","WASignalKeys","cr:7711","endpoints"],(function(t,n,r,o,a,i,l){"use strict";var e,s={UNSAFE_triggerICDCErrorForIGD:async function(t){var e=o("WAJids").toMsgrUserJid(t),n=o("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),r=o("MAWUnsafeCoerce").unsafeCoerce(42),a={instruction:"icdcError",jid:e,notificationTs:n,priority:o("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:r,type:"instruction"};await o("IGDAWProtocolQueueInstructions").handleInstructions([a])},UNSAFE_triggerIdentityAddedForIGD:async function(t,n){var e=o("WAJids").toMsgrUserJid(t),r=o("WAJids").toMsgrDeviceJid(e,n),a=o("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),i=o("MAWUnsafeCoerce").unsafeCoerce(42),l={device:r,identity:o("WASignalKeys").makeSerializedKeyPair().serializedPubKey,instruction:"identityAdded",jid:e,model:"Chrome",notificationTs:a,platform:"Instagram",priority:o("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:i,type:"instruction"};await o("IGDAWProtocolQueueInstructions").handleInstructions([l])},UNSAFE_triggerIdentityChangedForIGD:async function(t,n){var e=o("WAJids").toMsgrUserJid(t),r=o("WAJids").toMsgrDeviceJid(e,n),a=o("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),i=o("MAWUnsafeCoerce").unsafeCoerce(42),l={device:r,identity:o("WASignalKeys").makeSerializedKeyPair().serializedPubKey,instruction:"identityChanged",jid:e,model:"Chrome",notificationTs:a,platform:"Instagram",priority:o("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:i,type:"instruction"};await o("IGDAWProtocolQueueInstructions").handleInstructions([l])},UNSAFE_triggerIdentityRemovedForIGD:async function(t,n){var e=o("WAJids").toMsgrUserJid(t),r=o("WAJids").toMsgrDeviceJid(e,n),a=o("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),i=o("MAWUnsafeCoerce").unsafeCoerce(42),l={device:r,instruction:"identityRemoved",jid:e,notificationTs:a,priority:o("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:i,type:"instruction"};await o("IGDAWProtocolQueueInstructions").handleInstructions([l])},fetchEBRestoreCDNUrl:async function(t){try{var e=await o("endpoints").fetchEBRestoreCDNUrl(t)}catch(e){}},fetchInstamadilloMessage:async function(r,a,l){try{var t=await o("MAWReStoreDb").getDB(i.id+":144");await(n("cr:7711")==null?void 0:n("cr:7711")(t,(e||(e=o("I64"))).of_float(r),a,l))}catch(e){}}};Object.assign(o("MAWDebug").MAWDebugFuncs,s)}),34);
__d("MAWParseXMAIGConfig",["WAArmadilloXMA.pb"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new Set([(e=o("WAArmadilloXMA.pb")).EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE,e.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE,e.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE,e.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE,e.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE,e.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE,e.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE,e.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY,e.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION,e.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION,e.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION]);l.IGD_SUPPORTED_TARGET_TYPES=s}),98);
__d("IGDAWMainWebWorkerConfig",["MAWGK","MAWParseXMAIGConfig","WADbDeviceRegistration","WorkerUtils","getOrchestratorVersion","gkx","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s=1,u={armadilloWebProcessFutureproof:function(){return r("MAWGK").armadillo_web_process_futureproof},getSignalFutureMessagesMax:function(){return r("justknobx")._("847")},icdcAlertTriggerFailureCounter:function(){return r("justknobx")._("1970")},icdcCooldownIntervalInMinutes:function(){return 1e4},icdcIntervalInMinutes:function(){return r("justknobx")._("1972")},isDocumentReceiveEnabled:function(){return!1},isFrankingDropOnInvalid:function(){return r("gkx")("23973")},isFrankingDropOnMissing:function(){return r("gkx")("23974")},isICDCErrorEnabled:function(){return r("gkx")("23975")},isMetaAiInvocationMessageRenderEnabled:function(){return!1},isPollsEnabled:function(){return!1},isProgressiveJpegSendEnabled:function(){return!0},isSharedWorkerContext:function(){return(e||(e=o("WorkerUtils"))).isSharedWorkerContext()},jpegThumbnailTargetByteSizeKB:function(){return r("justknobx")._("2338")},maxPrekeysToUpload:function(){return 200},maxUsersForNotifyDeviceChange:function(){return o("WADbDeviceRegistration").MAX_USERS_FOR_NOTIFY_DEVICE_CHANGE},newClockSkewCalculation:function(){return!0},orchestratorVersion:function(){return r("getOrchestratorVersion")()},pjpegPreviewAvoidLastScan:function(){return!0},sessionDropIfTooOld:function(){return r("justknobx")._("2240")},skipProcessingGroupInvite:function(){return!0},waDanglingQueue:function(){return!0}},c={productTypeForEBAttachments:"igd",supportedTypesVersion:function(){return r("MAWGK").armadillo_web_process_futureproof?s+1:s},supportedXMATargetTypes:function(){return o("MAWParseXMAIGConfig").IGD_SUPPORTED_TARGET_TYPES}};l.waConfig=u,l.mawConfig=c}),98);
__d("IGDBridgedAPIHandler",["JSResourceForInteraction","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.args,a=t.type;switch(a){case"46":return r("JSResourceForInteraction")("IGDSendMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(e){var t=e.handleTask;return t.apply(void 0,n)});case"33":return r("JSResourceForInteraction")("IGDUnsendMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(e){var t=e.handleTask;return t.apply(void 0,n)});case"sendEditMessage":return r("JSResourceForInteraction")("IGDEditMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(e){var t=e.handleTask;return t.apply(void 0,n)});case"sendMediaMessage":return r("JSResourceForInteraction")("IGDSendMediaMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(e){var t=e.handleTask;return t.apply(void 0,n)});case"sendOrRemoveReaction":return r("JSResourceForInteraction")("IGDSendRemoveReactionTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(e){var t=e.handleTask;return t.apply(void 0,n)});case"sendXmaReceiverFetch":return r("JSResourceForInteraction")("IGDSendXmaReceiverFetchTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(e){var t=e.handleTask;return t.apply(void 0,n)});default:{o("WALogger").DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["igdapi: unsupported api call ",""])),a).devConsole(n);return}}}l.igdapi=s}),98);
__d("IGDEbUploadQueue",["EncryptedBackupsUploadQueue","EncryptedBackupsUtils","FBLogger","IGDUploadEbMessages","IGDUploadEbMessagesViaGraphQL","MAWEBSwitch","WAShiftTimer","WAWaitForUserUnblocked","gkx","isInstamadilloEB","justknobx","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("isInstamadilloEB")()&&r("MAWEBSwitch").isEnabled(),c=o("EncryptedBackupsUploadQueue").logger.TAGS(["IGD","labyrinth-web"]),d=new(o("WAShiftTimer")).ShiftTimer(m);function m(){r("isInstamadilloEB")()&&u&&(r("gkx")("7807")?r("IGDUploadEbMessagesViaGraphQL")().catch(function(t){c.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose([""," cannot process EB upload over GraphQL"])),t),d.onOrAfter(r("justknobx")._("2366"))}):r("IGDUploadEbMessages")().catch(function(e){c.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose([""," cannot process EB upload"])),e),d.onOrAfter(r("justknobx")._("2366"))}))}async function p(){try{var e=o("EncryptedBackupsUploadQueue").ebUploadQueue(),t=[],n=await e.read({filter:function(n){var e=n.instamadilloItemId,r=n.queueId,a=n.sortOrderMs,i=e!=null?e:a;return i==null||o("EncryptedBackupsUtils").entryOlderThan30Days(i)?(t.push(r),!1):!0},limit:r("justknobx")._("2368"),order:"desc"});return await e.delete(t),n}catch(e){return e instanceof Error?r("FBLogger")("wmi_eb").catching(e).mustfix("Cannot read from EB upload queue to runtime error"):r("FBLogger")("wmi_eb").warn("Cannot read from EB upload queue"),[]}}async function _(){await o("WAWaitForUserUnblocked").waitForUserUnblocked(),d.onOrBefore(r("justknobx")._("2367"))}function f(){r("promiseDone")(_());var e=o("EncryptedBackupsUploadQueue").ebUploadQueue();e.subscribe(function(e){e.type==="flush"&&r("promiseDone")(_())})}l.uploadQueueTimer=d,l.getFilteredEbUploadQueueEntries=p,l.scheduleNextRun=_,l.listenForEbUploadQueueFlush=f}),98);
__d("IGDUploadEbMessages",["EncryptedBackupsUploadQueue","EncryptedBackupsWriteToMPSTables","FBLogger","IGDEbUploadQueue","MAWReStoreDb","WAJids","justknobx","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("EncryptedBackupsUploadQueue").logger.TAGS(["labyrinth-web"]);async function c(){var t=await o("IGDEbUploadQueue").getFilteredEbUploadQueueEntries();if(t.length!==0){u.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["upload queue uploading "," messages"])),t.length);var n=await o("MAWReStoreDb").getDB(i.id+":44"),a=[];await n.runInTransaction(async function(e){var n=!1,r=!1,o;try{for(var i=babelHelpers.asyncIterator(t),l;n=!(l=await i.next()).done;n=!1){var c=l.value;try{await d(e,c),a.push(c.queueId)}catch(e){u.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to create backup directive and upload message: ",""])),e)}}}catch(e){r=!0,o=e}finally{try{n&&i.return!=null&&await i.return()}finally{if(r)throw o}}},"readwrite",void 0,void 0,i.id+":48"),a.length>0&&await o("EncryptedBackupsUploadQueue").ebUploadQueue().ack(a),r("promiseDone")(o("IGDEbUploadQueue").scheduleNextRun())}}async function d(e,t){var n=t.backupActionType,a=t.instamadilloItemId,i=t.isOpenEB,l=t.msgId,s=t.originalMsgProtocolId,u=t.protobuf,c=t.senderId,d=t.serverTs,m=t.sortOrderMs,p=t.supplementalKey,_=t.tags,f={backupActionType:n,instamadilloItemId:a,isOpenEB:i,msgId:l,originalMsgProtocolId:s,protobuf:u,senderId:c,serverTs:d,sortOrderMs:m,supplementalKey:p,tags:_},g=o("WAJids").threadIdForChatJid(f.msgId.chat);try{n!==3&&n!==4&&(await o("EncryptedBackupsWriteToMPSTables").writeToMPSTables(e,f,g,!0),n===1&&await o("EncryptedBackupsWriteToMPSTables").writeTagsToMPSTables(e,f,g))}catch(e){e instanceof Error?r("FBLogger")("wmi_eb").catching(e).mustfix("Cannot process EB upload due to runtime error"):r("FBLogger")("wmi_eb").warn("Failed to write message to MPS tables and upload")}o("IGDEbUploadQueue").uploadQueueTimer.onOrBefore(r("justknobx")._("2366"))}l.default=c}),98);
__d("IGDUploadEbMessagesViaGraphQL",["EncryptedBackupsUploadQueue","IGDEbUploadQueue","MAWReStoreDb","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("EncryptedBackupsUploadQueue").logger.TAGS(["labyrinth-web"]);async function u(){var t=await o("IGDEbUploadQueue").getFilteredEbUploadQueueEntries();if(t.length!==0){s.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["upload queue uploading "," messages via GraphQl"])),t.length);var n=await o("MAWReStoreDb").getDB(i.id+":31");await n.runInTransaction(async function(e){await c()},"readwrite",void 0,void 0,i.id+":34")}}function c(){o("IGDEbUploadQueue").uploadQueueTimer.onOrBefore(r("justknobx")._("2366"))}l.default=u}),98);
__d("MediaDownloadMediator",[],(function(t,n,r,o,a,i){"use strict";var e=new Map;function l(t,n){e.set(t,n)}async function s(t,n){var r;await((r=e.get(t))==null?void 0:r.continue(n)),e.delete(t)}function u(t,n){var r;(r=e.get(t))==null||r.handleError(n),e.delete(t)}i.mapDeliveryObjectIdToMediaDownloader=l,i.handleNewCDNUrlFromMI=s,i.handleMIDownloadFailure=u}),66);
__d("IGDHandleContinueMediaDownload",["MediaDownloadMediator"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){return await o("MediaDownloadMediator").handleNewCDNUrlFromMI(e.deliveryObjectId,e.cdnUrl),Promise.resolve()}l.handleContinueMediaDownload=e}),98);
__d("MAWBulkCancelDownloadMediaForUI",["MAWMediaManager"],(function(t,n,r,o,a,i,l){"use strict";function e(e){e.forEach(function(e){o("MAWMediaManager").getMawMediaManager().dequeueDownload(e)})}l.bulkCancelDownloadMediaForUI=e}),98);
__d("MAWLoadMsgsTxns",["MAWIndexedDb","MAWLoadMsgsTxnsV2"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r,a){return r===void 0&&(r=!1),a===void 0&&(a="before"),o("MAWLoadMsgsTxnsV2").loadMoreMsgsAndMediaFromTs(e,t,n,a,null,r,null,{admin:!0,editMsgHistory:!0,media:!0,polls:!0,reactions:!0,receiverFetch:!0,xma:!0}).then(function(e){var t=e.expiringCountdown,n=e.hasMoreAfter,r=e.hasMoreBefore,a=e.medias,i=e.msgs,l=e.quotedMsgs,s=e.receiverFetchInfoPayloads,u=e.xmas;return l!=null&&l.length>0&&o("MAWIndexedDb").afterTransaction({tag:"NewMsgs",value:{msgs:l}}),i.length>0&&o("MAWIndexedDb").afterTransaction({tag:"NewMsgs",value:{msgs:i}}),t.length>0&&o("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:{msgs:t}}),u.forEach(function(e){return o("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:e})}),a.forEach(function(e){return o("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:e})}),s.forEach(function(e){return o("MAWIndexedDb").afterTransaction({tag:"NewReceiverFetchInfo",value:e})}),{hasMoreAfter:n,hasMoreBefore:r}})}l.loadMsgAndMedia_COMPAT=e}),98);
__d("MAWBulkLoadMessagesForThread",["MAWDexieTable","MAWIndexedDb","MAWLoadMsgsTxns","MAWTransactionMode","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWIndexedDb").makeMsgrTransactor({chunk:(e=o("MAWTransactionMode")).READONLY,editMsgHistory:e.READONLY,groupInfo:e.READONLY,media:e.READONLY,messages:e.READONLY,poll:e.READONLY,reactions:e.READONLY,receiverFetchInfo:e.READONLY,threads:e.READONLY,xma:e.READONLY},"bulkLoadMessagesForThread",function(e){return(function(t){var n=t.threads;return o("MAWDexieTable").dexieAll(n.map(function(t){var n=t.jid,r=t.numOfMsgsToLoad;return o("MAWLoadMsgsTxns").loadMsgAndMedia_COMPAT(e,n,r,!0)})).then(r("emptyFunction"))})});l.bulkLoadMessagesForThread=s}),98);
__d("MAWBulkMaybeCreateOrUpdateThreadScheduler",["WorkerScheduler"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return e==null&&(e=o("WorkerScheduler").makeScheduler("bulk-maybe-create-or-update-thread",{maxTaskLimit:1,maxThrottleMs:500,timeoutMs:6e4})),e}l.bulkMaybeCreateOrUpdateThreadScheduler=s}),98);
__d("MAWCreateUpdateThreadUtils",["MAWMICSchema","MAWQplProxy","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a){t.forEach(function(t){return o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(1056836502,"2778"),e,{annotations:n,instanceKey:t})}),a!=null&&o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(25313175,"1551"),"thread_mapping_"+e,{instanceKey:a})}function s(t,n,r,o){n!=null&&e(t,[n],r,o)}function u(e,t,n){t!=null&&o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(1056842055,"807"),e,{instanceKey:t},!1,n)}function c(e,t,n,r){e==="init_sync"&&o("MAWQplProxy").sendQplPointThroughBridge(o("MAWMICSchema").EVENT,t,{annotations:r!=null?r:{}},void 0,{toClientId:n})}function d(e,t,n){e==="init_sync"&&o("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(o("MAWMICSchema").EVENT,t,!0,void 0,{toClientId:n})}l.sendThreadMappingQPLPoints=e,l.sendThreadMappingQPLPoint=s,l.sendBridgeQPLPoint=u,l.maybeSendMICPoint=c,l.maybeSendMICState=d}),98);
__d("MAWBulkMaybeUpsertThreadAndParticipants",["FBLogger","MAWCreateUpdateThreadUtils","MAWDbParticipantTxns","MAWDexieError","MAWDexieTable","MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWODSProxy","MAWTransactionMode","MaybeCreateOrUpdateThreadResultCache","Promise","WAJids","WAOdsEnums","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(r,a){var t=r.threads.filter(function(e){return!o("MaybeCreateOrUpdateThreadResultCache").cache__I_KNOW_WHAT_I_AM_DOING.has(e.chatJid)});return(t.length>0?u(babelHelpers.extends({threads:t},r),a).then(function(e){return e.forEach(function(e){e.status==="fulfilled"&&o("MaybeCreateOrUpdateThreadResultCache").cache__I_KNOW_WHAT_I_AM_DOING.set(e.value.chatJid,e)})}):(e||(e=n("Promise"))).resolve()).then(function(){return r.threads.map(function(e){var t;return(t=o("MaybeCreateOrUpdateThreadResultCache").cache__I_KNOW_WHAT_I_AM_DOING.get(e.chatJid))!=null?t:{jid:e.chatJid,reason:r.reason,status:"rejected"}})})},u=o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READWRITE,participants:o("MAWTransactionMode").READWRITE,threads:o("MAWTransactionMode").READWRITE},"bulkMaybeCreateOrUpdateThread",function(e){return(function(t,n){var a=t.reason,i=t.s2sInstanceKey,l=t.threads,s=function(t){o("MAWCreateUpdateThreadUtils").maybeSendMICState(a,t,n==null?void 0:n.fromClientId)};g(a,n,l.length);var u=Array.from(new Map(l.map(function(e){return[e.authoritativeThreadKey,e]})).values()),m=new Map,y=u.map(function(e){var t=e.chatJid,n=e.instanceKey;return n!=null&&m.set(t,n),n}).filter(Boolean);return o("MAWCreateUpdateThreadUtils").sendThreadMappingQPLPoints("bulk_get_or_create_thread_start",y,void 0,i),o("MAWGetOrCreateThreadTxns").bulkGetOrCreateThread(e,h(u),{logState:s}).then(function(e){return s("threadMapping4BulkGetDone"),e.map(function(e){var t=e.adminMsgParams,n=e.created,r=e.thread,a=m.get(r.jid);return o("MAWCreateUpdateThreadUtils").sendThreadMappingQPLPoint("bulk_get_or_create_thread_end",a,void 0,i),{adminMsgParams:t,created:n,instanceKey:a,thread:r}})}).then(function(t){return t.map(function(t){var n=t.adminMsgParams,r=t.created,a=t.instanceKey,l=t.thread;return o("WAJids").switchOnMsgrChatJidType(l.jid,{group:function(o){return c(e,o,a,i).then(function(e){return _(l,e,r,n)})},user:function(o){return d(e,o,a,i).then(function(e){return p(l,e,r,n)})}})})}).then(function(e){return o("MAWDexieTable").dexieAllSettled(e).then(function(e){f(n,s);var t=[];for(var r of e.entries()){var o=r[0],a=r[1];a.status==="rejected"?t.push(babelHelpers.extends({jid:l[o].chatJid},a)):t.push(a)}return t})}).catch(function(e){throw e.name===o("MAWDexieError").DEXIE_ERROR.BulkError&&e.failures.forEach(function(e){e.name===o("MAWDexieError").DEXIE_ERROR.ConstraintError&&e.message.includes("authoritativeThreadKey")&&r("FBLogger")("maw_threads").warn("[ConstraintError/authoritativeThreadKey] bulk create threads %s",Array.from(new Set(l.map(function(e){return e.authoritativeThreadKey}))).length-Array.from(new Set(l.map(function(e){return e.chatJid}))).length)}),e})})});function c(e,t,n,r){return o("MAWCreateUpdateThreadUtils").sendThreadMappingQPLPoint("get_participants_for_group_start",n,void 0,r),o("MAWDbParticipantTxns").getParticipantsInThreads(e,[t]).then(function(e){return o("MAWCreateUpdateThreadUtils").sendThreadMappingQPLPoint("get_participants_for_group_end",n,{int:{participantsLoaded:e.length}},r),e})}function d(e,t,n,r){return o("MAWCreateUpdateThreadUtils").sendThreadMappingQPLPoint("upsert_participants_in_1_to_1_start",n,void 0,r),o("MAWDbParticipantTxns").bulkRemoveIncorrectAndInsertMissingParticipantsInOneToOneThread(e,t,!1).then(function(e){return o("MAWCreateUpdateThreadUtils").sendThreadMappingQPLPoint("upsert_participants_in_1_to_1_end",n,{int:{participantsLoaded:e.length}},r),e})}function m(e,t,n,r){return{adminMsgParams:r,chatJid:e.jid,clientThreadKey:e.optimisticThreadKey,folder:e.folder,isCreated:n,participants:t.map(function(e){var t=e.type,n=e.userJid;return{type:t,userJid:n}})}}function p(e,t,n,r){return babelHelpers.extends({},m(e,t,n,r),{shouldQueryForGroup:!1})}function _(e,t,n,r){return babelHelpers.extends({},m(e,t,n,r),{shouldQueryForGroup:n||t.length===0||t.some(function(e){return e.addressable!==!0})})}function f(e,t){t("threadMapping5LoadedParticipantsAndMsg"),o("MAWCreateUpdateThreadUtils").sendBridgeQPLPoint("lla_end",e==null?void 0:e.bridgeQPLInstanceKey,{toClientId:e==null?void 0:e.fromClientId})}function g(e,t,n){o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_THREAD_MAPPING,key:"bulk_create_thread_backend."+(e!=null?e:"unknown")});var r=function(r,a){o("MAWCreateUpdateThreadUtils").maybeSendMICPoint(e,r,t==null?void 0:t.fromClientId,a)};o("MAWCreateUpdateThreadUtils").sendBridgeQPLPoint("lla_start",t==null?void 0:t.bridgeQPLInstanceKey,{toClientId:t==null?void 0:t.fromClientId}),r("bulk_create_thread_start",{int:{thread_mapping_unique_threads:n}})}function h(e){return e.map(function(e){return{authoritativeThreadKey:e.authoritativeThreadKey,description:"bulkCreateThread",instanceKey:e.instanceKey,jid:e.chatJid,lastActivityTimestamp:o("WATimeUtils").castToMillisTime(e.lastActivityTimestampMs),lastReadWatermarkTimestamp:o("WATimeUtils").castToMillisTime(e.lastReadWatermarkTimestampMs)}})}l.bulkMaybeCreateOrUpdateThread=s}),98);
__d("MAWCancelDownloadMediaForUI",["MAWMediaManager"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("MAWMediaManager").getMawMediaManager().dequeueDownload(e)}l.cancelDownloadMediaForUI=e}),98);
__d("MAWChangeSecurityAlertSettingApi",["MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({appMeta:o("MAWTransactionMode").READWRITE},"changeSecurityAlertSetting",function(e){return(function(t){return o("MAWDbMsgTypeVersionTxns").updateSecurityAlertValueForContact(e,t)})});l.changeSecurityAlertSetting=e}),98);
__d("MAWChangeSecurityAlertSettingForSelfApi",["MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({appMeta:o("MAWTransactionMode").READWRITE},"changeSecurityAlertSettingForSelf",function(e){return(function(t){return o("MAWDbMsgTypeVersionTxns").updateSecurityAlertValueForSelf(e,t)})});l.changeSecurityAlertSettingForSelf=e}),98);
__d("MAWCompleteUndoThreadCutoverApi",["MAWAdminWriteCutoverThreadMsgTxn","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("MAWIndexedDb").makeMsgrTransactor({chunk:(s=o("MAWTransactionMode")).READONLY,ftsBackloggedMessages:s.READWRITE,groupInfo:s.READONLY,media:s.READONLY,messages:s.READWRITE,threads:s.READWRITE},"completeUndoThreadCutover",function(t){return(function(n){var r=n.threadJid;return o("MAWDbThreadTxns").getThread(t,r).then(function(n){if(!n.success){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["UpdateAdminMessageAfterUndoCutover failed to get the thread"])));return}var r=n.value;if(r.isMigratedLocally===!0)return o("MAWDbThreadTxns").markCutoverThreadAsNotMigratedLocally(t,r).then(function(e){return o("MAWAdminWriteCutoverThreadMsgTxn").revertCutoverThreadAdminMsg(t,e).then(function(){return o("MAWAdminWriteCutoverThreadMsgTxn").writeRollbackCutoverAdminMsg(t,e)})})})})});l.completeUndoThreadCutover=u}),98);
__d("MAWCacheServiceBase",["MAWCacheServiceDB","MAWUICacheServicesBase"],(function(t,n,r,o,a,i,l){"use strict";var e=["id"],s=(function(){function t(e){this.$1=new Map,this.namespace=e}var n=t.prototype;return n.$2=function(t){var e;return(e=this.$1.get(t))!=null?e:null},n.updateInMemoryCache=function(t,n){this.$1.set(t,n)},n.updateInMemoryCacheBulk=function(t){var e=this;t.forEach(function(t){var n=t[0],r=t[1];e.updateInMemoryCache(n,r)})},n.getValueFromCache=async function(n){var t=this,r=this.$2(n);if(r!=null)return r;var a=await o("MAWCacheServiceDB").getOrSetupMAWCacheDB(),i=await a.runInTransaction([this.namespace],"readonly",function(e){return e.stores[t.namespace].getByIndex("key",[o("MAWUICacheServicesBase").adjustCacheKey(n)])},"read_from_persisted_"+this.namespace);if(i==null)return null;var l=i.id,s=babelHelpers.objectWithoutPropertiesLoose(i,e);return this.updateInMemoryCache(n,s),s},t})();l.default=s}),98);
__d("MpsSnippetsCacheService",["FBLogger","MAWCacheServiceBase","MAWDbMsg","MAWDbReaction","MAWGetThreadUpdateType","MAWJids","MAWMsg","MAWMsgType","MAWThreadNewestMsgOrReactionUtils","MAWThreadSnippet","MAWThreadSnippetBuildTxns","MAWThreadSnippetUtils","MAWUserJidWrapper","MAWVault","MpsEditToBridge","MpsMessageToBridge","MpsMessageToBridgeWrapper","MpsRavenToBridge","MpsReactionToBridge","MpsToBridgeMessageId","MpsTypes","WAJids","WALongInt","WebMps","WorkerScheduler","getErrorSafe","justknobx","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e="[MpsSnippetsCacheService][Worker]",s=(function(t){function n(){return t.call(this,"snippets")||this}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.$MpsSnippetsCacheService$p_1=async function(t){var e,n=o("WAJids").unsafeCoerceToChatJid(t.threadId),r=await this.$MpsSnippetsCacheService$p_2(t);if(r==null){u({chatJid:n,dropReason:"no-corresponding-message-in-reverb",messageId:t.messageId});return}var a=(e=o("MpsMessageToBridge").mpsFullMessagetoBridge(r))!=null?e:{},i=a.supplementals,l=a.topLevel;if((l==null?void 0:l.kind)==="bridgeMsg"){var s=l.value,c=o("MAWThreadNewestMsgOrReactionUtils").filterForSnippet(o("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg({adminType:s.adminType,author:s.isAuthorMe?o("WAJids").AUTHOR_ME:o("MAWJids").toUserJid(s.sender),msgType:s.type_,xmaMessageType:s.xmaMessageType}),!1);if(c){var d=await this.getValueFromCache(n);if(d==null){u({chatJid:n,dropReason:"no-value-calculated-from-scratch",messageId:t.messageId});return}if(d.timestamp>t.timestampMs){u({chatJid:n,dropReason:"older-than-last-snippet-value",messageId:t.messageId});return}var m=await this.$MpsSnippetsCacheService$p_3(n,s,i);return Promise.resolve([n,m])}}},a.$MpsSnippetsCacheService$p_2=async function(t){var e=o("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(t);if(o("MpsRavenToBridge").isRavenMsg(e)){var n=await o("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!0,strategy:"local-only"},debug:{purpose:"snippet-new-message-fetch-local"},messageId:t.messageId,threadId:t.threadId}),r=n.value;return r}return{expiryTimestampMs:null,supplementalProtobufs:new Map,tags:[],toplevelProtobuf:t}},a.$MpsSnippetsCacheService$p_4=async function(t,n){var e,r=o("WAJids").unsafeCoerceToChatJid(t.threadId),a=await this.getValueFromCache(r);if(a==null){u({chatJid:r,dropReason:"no-value-calculated-from-scratch",messageId:n});return}if(a.timestamp>t.timestampMs){u({chatJid:r,dropReason:"older-than-last-snippet-value",messageId:n});return}var i=(e=o("MpsReactionToBridge").reactionMessageToBridgeMsg(o("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(t)))==null?void 0:e.value;if(i!=null){var l=await this.$MpsSnippetsCacheService$p_5(t,n,i);if(l!=null)return l}var s=await this.$MpsSnippetsCacheService$p_6(t,n,r);if(s!=null)return s},a.$MpsSnippetsCacheService$p_5=function(t,n,r){var e=this,a=o("WAJids").unsafeCoerceToChatJid(t.threadId),i=async function(i){var r,l=await o("WebMps").mps().loadMessage({config:{strategy:"local-only"},debug:{purpose:"snippet-new-message-fetch-local"},messageId:n,threadId:t.threadId}),s=l.value;if(s==null){u({chatJid:a,dropReason:"no-corresponding-message-in-reverb",messageId:n});return}var c=(r=o("MpsMessageToBridge").mpsFullMessagetoBridge(s))!=null?r:{},d=c.topLevel;if((d==null?void 0:d.kind)==="bridgeMsg"){var m=d.value,p=o("WAJids").userIdFromJid(o("MAWUserJidWrapper").getMyUserJid())===i.actorId,_=o("WAJids").userIdFromJid(o("MAWUserJidWrapper").getMyUserJid())===m.sender,f=o("MAWDbReaction").isIncomingReaction({author:p?o("WAJids").AUTHOR_ME:o("MAWJids").toUserJid(i.actorId),reaction:i.reaction,reactToAuthor:_?o("WAJids").AUTHOR_ME:o("MAWJids").toUserJid(m.sender)});if(!f)return Promise.resolve();var g=e.$MpsSnippetsCacheService$p_7(a,i);return Promise.resolve([a,g])}},l=async function(){var t=await e.$MpsSnippetsCacheService$p_8({isLowPriority:!1,threadChatJids:[a]}),n=t[0];return n};return(function(e){if((typeof e=="object"&&e!==null||typeof e=="function")&&e.type==="upsert"&&"reaction"in e){var t=e.reaction;return i(t)}if((typeof e=="object"&&e!==null||typeof e=="function")&&e.type==="delete")return l();throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})(r)},a.$MpsSnippetsCacheService$p_6=function(t,n,r){var e=o("MpsEditToBridge").editMessageToBridgeMsg(o("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(t));if((e==null?void 0:e.kind)!=="bridgeEditHistoryMsg")return Promise.resolve();var a=e.value,i=a.author,l=a.editTs,s=a.msgContent,u=s.content,c=s.mentionedJids,d=a.specialTextSize,m={author:i,chatJid:r,content:u,mentionedJids:c,msgType:o("MAWMsgType").MSG_TYPE.TEXT,specialTextSize:d},p=this.$MpsSnippetsCacheService$p_9({snippetMsgId:o("MpsToBridgeMessageId").mpsToBridgeMsgId(t.threadId,n),threadChatJid:r,threadSnippetBuilder:m,timestamp:l*1e3});return Promise.resolve([r,p])},a.$MpsSnippetsCacheService$p_10=async function(t){var e=o("WAJids").unsafeCoerceToChatJid(t.threadId),n=await this.getValueFromCache(e);if(!(n!=null&&n.timestamp>t.timestampMs)){var r=await this.$MpsSnippetsCacheService$p_8({isLowPriority:!1,threadChatJids:[e]}),a=r[0];return a}},a.$MpsSnippetsCacheService$p_11=function(t){var e=r("nullthrows")(t.directive);switch(e.actionType){case o("MpsTypes").ActionType.Unknown:case o("MpsTypes").ActionType.Noop:case o("MpsTypes").ActionType.Preprocess:case o("MpsTypes").ActionType.DeleteThread:case o("MpsTypes").ActionType.DeleteSupplemental:case o("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder:return Promise.resolve();case o("MpsTypes").ActionType.UpsertTopLevel:return this.$MpsSnippetsCacheService$p_1(t.message);case o("MpsTypes").ActionType.UpsertSupplemental:return this.$MpsSnippetsCacheService$p_4(t.message,e.targetMessageId);case o("MpsTypes").ActionType.DeleteTopLevel:return this.$MpsSnippetsCacheService$p_10(t.message)}},a.$MpsSnippetsCacheService$p_12=function(t){var e=new Map;for(var n of t){var r=o("WAJids").unsafeCoerceToChatJid(n.message.threadId),a=e.get(r);(a==null||a.message.timestampMs<n.message.timestampMs)&&e.set(r,n)}return Array.from(e.values())},a.calculateDelta=function(t){var e=this,n=this.$MpsSnippetsCacheService$p_12(t);return Promise.all(n.map(function(t){return e.$MpsSnippetsCacheService$p_11(t)})).then(function(e){return e.filter(Boolean)})},a.$MpsSnippetsCacheService$p_7=function(t,n){var e,r=o("MAWThreadSnippetBuildTxns").buildReactionThreadSnippet(o("MAWJids").toUserJid(n.actorId),n.reaction,t),a=(e=o("WALongInt").maybeNumber(n.ts*1e3))!=null?e:0,i=n.messageId;return this.$MpsSnippetsCacheService$p_13({snippet:r,snippetReactionId:i,threadChatJid:t,timestamp:a})},a.$MpsSnippetsCacheService$p_9=function(t){var e=t.snippetMsgId,n=t.threadChatJid,r=t.threadSnippetBuilder,a=t.timestamp,i=o("MAWThreadSnippet").buildThreadSnippet(r);return this.$MpsSnippetsCacheService$p_13({snippet:i,snippetMsgId:e,threadChatJid:n,timestamp:a})},a.$MpsSnippetsCacheService$p_13=function(t){var e=t.snippet,n=t.snippetMsgId,r=t.snippetReactionId,a=t.threadChatJid,i=t.timestamp,l=babelHelpers.extends({},e.snippetParams,{strings:e.snippetParams.strings.map(function(e){return o("MAWVault").unvault(e)})});return{key:a,timestamp:i,value:{snippet:babelHelpers.extends({},e,{snippetParams:l}),snippetMsgId:n,snippetReactionId:r}}},a.$MpsSnippetsCacheService$p_3=async function(t,n,r){var e=n.mentionedJids?Array.from(n.mentionedJids):void 0,a=o("MAWJids").toUserJid(n.sender),i,l,s=n.replyContent;if(n.type_===o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE&&(s==null?void 0:s.replyToMsgId)!=null){var u=await o("WebMps").mps().loadMessage({config:{strategy:"local-only"},debug:{purpose:"snippet-reply-fetch-local"},messageId:o("MpsToBridgeMessageId").bridgeMsgIdToMps(s.replyToMsgId).messageId,threadId:o("MpsTypes").toThreadId(t)}),c=u.value;if(c!=null){var d,m=(d=o("MpsMessageToBridge").mpsFullMessagetoBridge(c))==null?void 0:d.topLevel;m!=null&&m.kind==="bridgeMsg"&&(i=m.value.isAuthorMe?o("WAJids").AUTHOR_ME:o("MAWJids").toUserJid(m.value.sender),l=m.value.type_)}}var p,_=r==null?void 0:r.find(function(e){return e.kind==="bridgeMedia"});n.type_===o("MAWMsgType").MSG_TYPE.RAVEN&&_!=null&&(_.value.mediaType===o("MAWMsgType").MSG_TYPE.IMAGE?p=o("MAWMsg").MAWRavenMsgMediaType.IMAGE:_.value.mediaType===o("MAWMsgType").MSG_TYPE.VIDEO&&(p=o("MAWMsg").MAWRavenMsgMediaType.VIDEO));var f=n.content,g=e,h=r==null?void 0:r.find(function(e){return e.kind==="bridgeEditHistoryMsg"});if(h!=null){var y,C;f=(y=h.value.msgContent)==null?void 0:y.content,g=(C=h.value.msgContent)==null?void 0:C.mentionedJids}var b={adminMsgContent:n.adminContent,adminType:n.adminType,author:n.isAuthorMe?o("WAJids").AUTHOR_ME:a,chatJid:t,content:f,gifPlayback:_==null?void 0:_.value.gifPlayback,mentionedJids:g,msgType:n.type_,ravenMediaType:p,replyAuthor:i,replyType:l,specialTextSize:n.specialTextSize,unsupportedType:n.unsupportedType,xmaMessageType:n.xmaMessageType};return this.$MpsSnippetsCacheService$p_9({snippetMsgId:n.msgId,threadChatJid:t,threadSnippetBuilder:b,timestamp:o("MAWDbMsg").getSortOrderWithFallback(n)})},a.$MpsSnippetsCacheService$p_8=async function(t){var e=this,n=t.isLowPriority,a=t.qplFlow,i=t.threadChatJids;a==null||a.addPoint("fetching_from_db_from_scratch_start");var l=await o("WebMps").mps().batchLoadMessages({config:{priority:n?o("WorkerScheduler").BACKGROUND_PRIORITY:o("WorkerScheduler").BLOCKING_PRIORITY,shouldFetchSupplementals:!0,strategy:"local-only"},debug:{purpose:"update_snippet_from_scratch"},ranges:i.map(function(e){return{direction:"desc",from:[o("MpsTypes").toTimestamp(Number.MAX_SAFE_INTEGER),null],numMessages:r("justknobx")._("1786"),threadId:o("MpsTypes").toThreadId(e)}})});return a==null||a.addPoint("fetching_from_db_from_scratch_end"),l.success===!1?Promise.resolve([]):Promise.all(l.value.map(async function(t,n){var r=t.messages,i=t.threadId,l=o("WAJids").unsafeCoerceToChatJid(i),s=await e.$MpsSnippetsCacheService$p_14(r,l,n,a);if(s==null){var u=e.$MpsSnippetsCacheService$p_13({snippet:o("MAWThreadSnippetUtils").EMPTY_SNIPPET_DATA,threadChatJid:l,timestamp:Number.MIN_SAFE_INTEGER});return[i,u]}return[i,s]}))},a.$MpsSnippetsCacheService$p_14=function(n,a,i,l){var t;l==null||l.addPoint("full_message_to_bridge_"+i+"_start");var s=n.map(function(e){try{return o("MpsMessageToBridge").mpsFullMessagetoBridge(e)}catch(e){r("FBLogger")("mps").catching(r("getErrorSafe")(e)).warn("calculateSnippetFromScratchImpl failed to create a bridge object");return}}).filter(Boolean);l==null||l.addPoint("full_message_to_bridge_"+i+"_end"),l==null||l.addPoint("locating_most_recent_message_"+i+"_start");var u=(t=s.find(function(e){var t=e.topLevel;if((t==null?void 0:t.kind)!=="bridgeMsg")return!1;var n=t.value;return o("MAWThreadNewestMsgOrReactionUtils").filterForSnippet(o("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg({adminType:n.adminType,author:n.isAuthorMe?o("WAJids").AUTHOR_ME:o("MAWJids").toUserJid(n.sender),msgType:n.type_,xmaMessageType:n.xmaMessageType}),!1)}))!=null?t:{},c=u.supplementals,d=u.topLevel;if(l==null||l.addPoint("locating_most_recent_message_"+i+"_end"),(d==null?void 0:d.kind)!=="bridgeMsg")return Promise.resolve();l==null||l.addPoint("locating_most_recent_reaction_"+i+"_start");var m=s.flatMap(function(e,t){var n=e.supplementals,r=e.topLevel;return n==null?void 0:n.map(function(e){return{msgIndex:t,supplemental:e,topLevel:r}})}).filter(Boolean).map(function(e){var t=e.msgIndex,n=e.supplemental,r=e.topLevel;if(n.kind==="bridgeReactionAction"&&n.value.type==="upsert"&&(r==null?void 0:r.kind)==="bridgeMsg")return{msgIndex:t,reaction:n.value.reaction,reactToAuthor:r.value.isAuthorMe?o("WAJids").AUTHOR_ME:o("MAWJids").toUserJid(r.value.sender)}}).filter(Boolean).filter(function(e){var t=e.reaction,n=e.reactToAuthor,r=o("WAJids").userIdFromJid(o("MAWUserJidWrapper").getMyUserJid())===t.actorId;return o("MAWDbReaction").isIncomingReaction({author:r?o("WAJids").AUTHOR_ME:o("MAWJids").toUserJid(t.actorId),reaction:t.reaction,reactToAuthor:n})}),p=m.length===0?null:m.sort(function(e,t){return t.reaction.ts-e.reaction.ts})[0];return l==null||l.addPoint("locating_most_recent_reaction_"+i+"_end"),p!=null&&p.reaction.ts>(d.value!=null?o("MAWDbMsg").getCanonicalTsFromMsg(d.value):0)?(r("FBLogger")("mps").info(e+" Reaction more recent than top message: index %s of %s total messages",p.msgIndex,s.length),Promise.resolve(this.$MpsSnippetsCacheService$p_7(a,p.reaction))):d.value!=null?this.$MpsSnippetsCacheService$p_3(a,d.value,c):Promise.resolve()},a.computeCachePayloadFromScratch=function(t,n,r){r===void 0&&(r=!1);var e=t.map(o("WAJids").unsafeCoerceToChatJid);return this.$MpsSnippetsCacheService$p_8({isLowPriority:r,qplFlow:n,threadChatJids:e}).then(function(e){return e.filter(function(e){return e!=null})})},a.shouldDropDelta=function(t){return Promise.resolve(!1)},n})(r("MAWCacheServiceBase"));function u(t){var n=t.chatJid,o=t.dropReason,a=t.messageId;r("FBLogger")("wmi").info(e+" Drop update for msg, reason: %s, chatJid: %s, messageId: %s",o,n,a)}var c=new s,d=function(){return c};l.MpsSnippetsCacheService=s,l.getMpsSnippetsCacheService=d}),98);
__d("MpsWorkerCacheServices",["FBLogger","MAWBridge","MAWCacheServiceDB","MAWCacheServiceQPL","MAWCacheServiceUtils","MAWLoggerUtils","MpsSnippetsCacheService","WorkerScheduler","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){this.$1=o("MAWCacheServiceUtils").getMAWCacheServiceBroadcastChannel(),this.$2=o("MpsSnippetsCacheService").getMpsSnippetsCacheService(),this.$3=o("WorkerScheduler").makeScheduler("maw-cache-service-snippets",{concurrency:1,maxTaskLimit:1,maxThrottleMs:6e4})}var t=e.prototype;return t.$4=function(t,n,r,a){var e={cache:n,instanceKey:a,namespace:t,source:r};this.$1==null?o("MAWBridge").getBridge().fireAndForget("event","broadcastChannelFallback",{event:{data:e},namespace:o("MAWCacheServiceUtils").MAW_CACHE_SERVICE_BROADCAST_CHANNEL}):this.$1.postMessage(e)},t.$5=async function(t,n,a,i){var e=t.namespace,l=o("MAWCacheServiceUtils").findDuplicates(n,function(e){var t=e[0],n=e[1];return t});if(l.length>0&&(r("FBLogger")("MAWCacheService").mustfix("Found duplicate keys in cache: %s. Original keys: %s, Namespace: %s, Source: %s",l.map(function(e){var t=e[0],n=e[1];return t}).join(", "),n.map(function(e){var t=e[0],n=e[1];return t}).join(", "),e,a),i!=null&&r("MAWCacheServiceQPL").addAnnotationsQPL(i,{bool:{hasDuplicateKeys:!0},string_array:{duplicateKeys:r("MAWCacheServiceQPL").redactKeysForNonEmployee(l.map(function(e){var t=e[0],n=e[1];return t}))}})),n.length===0){i!=null&&(r("MAWCacheServiceQPL").addPointQPL(i,"nothing_to_update_in_cache",a),r("MAWCacheServiceQPL").endSuccessQPL(i));return}i!=null&&r("MAWCacheServiceQPL").addPointQPL(i,"updating_cache_in_persisted_start",a),t.updateInMemoryCacheBulk(n);try{var s=o("MAWCacheServiceDB").convertCacheValueToDBRawValue(n).map(function(e){return babelHelpers.extends({},e,{key:e.key+"_mps_reactive"})}),u=await o("MAWCacheServiceDB").getOrSetupMAWCacheDB();await u.runInTransaction([e],"readwrite",function(t){var n=s.map(function(e){return{item:e,selector:[e.key]}});return t.stores[e].bulkUpsert("key",n)},"update_cache_"+e),i!=null&&r("MAWCacheServiceQPL").addPointQPL(i,"updating_cache_in_persisted_end",a)}catch(e){var c=r("getErrorSafe")(e);i!=null&&(r("MAWCacheServiceQPL").addAnnotationsQPL(i,{string:{error:c.message}}),r("MAWCacheServiceQPL").addPointQPL(i,"updating_cache_in_persisted_failed",a)),r("FBLogger")("MAWCacheService").catching(c).mustfix("Failed to update persisted cache")}i!=null&&r("MAWCacheServiceQPL").addPointQPL(i,"broadcasting_to_ui_start",a),this.$4(e,n,a,i)},t.calculateDelta=function(t){var e=this,n=this.$2,a=n.shouldDropDelta(t);a.then(function(a){if(!a)return e.$3.runTask({fn:function(){return n.calculateDelta(t).then(function(t){var a=t.map(function(e){var t=e[0],n=e[1];return t}),i=o("MAWLoggerUtils").getInstanceKey();return t.length!==0&&(r("MAWCacheServiceQPL").startQPL(i,n.namespace),r("MAWCacheServiceQPL").addAnnotationsQPL(i,{bool:{isRealtimeUpdate:!0},int:{instanceKey:i},string_array:{realtimeUpdatedKeys:a}})),e.$5(n,t,"realtime-update",i)})},name:"maw_calculate_delta",priority:o("WorkerScheduler").REGULAR_PRIORITY})}).catch(function(e){r("FBLogger")("MAWCacheService").catching(r("getErrorSafe")(e)).warn("Failed to calculate delta")})},t.computeCachePayloadFromScratch=function(t,n,a,i){var e=this;a!=null&&r("MAWCacheServiceQPL").registerInstanceKeyInWorker(a),r("MAWCacheServiceQPL").addPointQPL(a,"compute_from_scratch_start",n),r("MAWCacheServiceQPL").addAnnotationsQPL(a,{string_array:{keysReceivedInWorker:r("MAWCacheServiceQPL").redactKeysForNonEmployee(t)}});var l=this.$2;return this.$3.runTask({fn:function(s){var o=s.metric;return l.computeCachePayloadFromScratch(t,o,i).then(function(t){return r("MAWCacheServiceQPL").addPointQPL(a,"compute_from_scratch_end",n),e.$5(l,t,n,a)}).catch(function(e){r("MAWCacheServiceQPL").endFailureQPL(a,"compute_from_scratch_failed",n),r("FBLogger")("MAWCacheService").catching(e).warn("Failed to compute cache payload from scratch")})},name:"maw_compute_cache_payload_"+n+"_"+(i?"low-pri":"regular"),priority:i?o("WorkerScheduler").BACKGROUND_PRIORITY:o("WorkerScheduler").REGULAR_PRIORITY})},e})(),s=null,u=function(){return s==null&&(s=new e),s};l.getMpsWorkerCacheServices=u}),98);
__d("MAWComputeCachePayloadFromScratch",["MpsWorkerCacheServices","WAWaitForUserUnblocked"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.instanceKey,n=e.isLowPriority,r=e.keys,o=e.namespace;return s({instanceKey:t,isLowPriority:n,keys:r,namespace:o})}async function s(e){var t=e.instanceKey,n=e.isLowPriority,r=e.keys,a=e.namespace;return await o("WAWaitForUserUnblocked").waitForUserUnblocked(),o("MpsWorkerCacheServices").getMpsWorkerCacheServices().computeCachePayloadFromScratch(r,n?"cache-invalidation":"from-scratch",t,n)}l.computeCachePayloadFromScratch=e}),98);
__d("MAWConvertEchoMessagesToMsgStanzas",["MAWHandleEBRestoreWithHIM"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return o("MAWHandleEBRestoreWithHIM").convertEchoMessages(e,t)}l.convertEchoMessagesToMsgStanzas=e}),98);
__d("MAWCreateOrUpdateThreadApi",["MAWIndexedDb","MAWJids","MAWThreadManagementTxns","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READWRITE,participants:o("MAWTransactionMode").READWRITE,threads:o("MAWTransactionMode").READWRITE},"createOrUpdateThread",function(e){return(function(t){var n=t.contactFbid,r=t.description,a=t.s2sInstanceKey,i=t.threadKey;return o("MAWThreadManagementTxns").getOrSetupOneToOneThread(e,{description:r,offlineThreadingId:i,skipVerifyThread:!0,userJid:o("MAWJids").toUserJid(n)},a).then(function(e){var t=e.created,n=e.thread;return{clientThreadKey:n.optimisticThreadKey,created:t,folder:n.folder,jid:n.jid}})})});l.createOrUpdateThread=e}),98);
__d("MAWDeleteMediaChunks_FOR_TESTING_ONLY",["MAWIndexedDb","MAWMediaUtils","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({chunk:o("MAWTransactionMode").READWRITE},"deleteMediaChunks_FOR_TESTING_ONLY",function(e){return(function(t){var n=t.map(o("MAWMediaUtils").genHMACPlaintextHash);return e.chunk.where("hashedPlaintextHash").anyOf(n).delete().then(function(){})})});l.deleteMediaChunks_FOR_TESTING_ONLY=e}),98);
__d("MAWDeleteThreadApi",["FBLogger","MAWIndexedDb","MAWThreadManagementTxns","MAWTransactionMode","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("MAWIndexedDb").makeMsgrTransactor({chunk:(s=o("MAWTransactionMode")).READWRITE,deletedMessages:s.READWRITE,groupInfo:s.READWRITE,groupInvites:s.READWRITE,media:s.READWRITE,messages:s.READWRITE,participants:s.READWRITE,pendingStanzas:s.READWRITE,reactions:s.READWRITE,threads:s.READWRITE,unrenderedMessages:s.READWRITE},"deleteThread",function(t){return(function(n){return t.threads.get({jid:n}).then(function(a){if(a==null)throw r("FBLogger")("messenger_web").mustfixThrow("There was no thread to delete in local delete thread");return o("MAWThreadManagementTxns").deleteAllThreadData(t,a).then(function(){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted thread ",""])),n)})})})});l.deleteThread=u}),98);
__d("MAWDownloadMediaForUI",["MAWDownloadAndHandleMedia","MAWMediaDownloadStatus","MAWMediaDownloadStatusForUI","MAWMediaManager","MWFBLogger","WAErrorMessage","WAHashUtils","WAMediaManager","WAPromiseManagement","WAResultOrError","WAStartMediaDownloadQplFlow"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("MWFBLogger").MWMediaLogger().tags(["downloadMediaForUI"]);function d(e){return Promise.all(e.media.map(async function(e){var t=await m(e);return{arg:e,result:t}}))}function m(t){return p(t).catch(function(t){return c.catching(t).MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Runtime error"]))),o("WAResultOrError").makeError("runtime-error")})}var p=o("WAPromiseManagement").cacheWhilePending(function(e){var t;switch(e.type){case"mediaId":return"mediaId-"+e.mediaId.toString()+"-"+((t=e.downloadType)!=null?t:"fullsizeAndPreview");case"xmaId":return"xmaId-"+e.xmaId.toString();default:{var n;return e.type,"plaintextHash-"+e.plaintextHash+"-"+((n=e.downloadType)!=null?n:"fullsizeAndPreview")}}},_);async function _(e){var t=f(e);c.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["start downloadMediaForUILayout. ",""])),t);var n=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:"UILayout",msgType:null,protocolMsgId:null,triggerUIView:e.triggerUIView});if(e.type!=="plaintextHash")return c.MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["downloadMediaForUILayout: args.type is not plaintextHash"]))),o("WAResultOrError").makeError("missing-media");var a=e.plaintextHash;o("MAWDownloadAndHandleMedia").sendUIStatusDownloading(a,"download_and_handle_media"),o("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"download_and_handle_media",hash:a,status:r("MAWMediaDownloadStatus").DOWNLOADING,type:"main"});var i=o("MAWMediaManager").getMawMediaManager().enqueueDownloadFullSizeAndPreview({fullSizePlaintextHash:a,mediaDownloadFlow:n,priority:o("WAMediaManager").MediaTaskPriority.HIGH}),l=i.fullsizePromise,d=i.previewPromise;d.then(function(){o("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"handle_media_download_success",hash:a,status:r("MAWMediaDownloadStatus").SUCCESS,type:"preview"})});var m=await l;return m.success===!1?(n.endFail("handle_media_download_fail",{string:{failReason:m.payload==null?m.error:o("WAErrorMessage").maybeGetMessageFromError(m.payload)}}),o("MAWDownloadAndHandleMedia").sendUIStatusFailure(a,m.error),o("WAResultOrError").makeError("runtime-error")):(n.addPoint("handle_media_download_end"),n.endSuccess(),o("MAWDownloadAndHandleMedia").sendUIStatusSuccess(a,m.value.validatedResult),o("WAResultOrError").makeResult())}function f(e){switch(e.type){case"mediaId":return"mediaId: "+e.mediaId.toString();case"xmaId":return"xmaId: "+e.xmaId.toString();default:return e.type,"plaintextHash: "+o("WAHashUtils").sanitisePlaintextHash(e.plaintextHash)}}l.bulkDownloadMediaForUI=d,l.downloadMediaForUI=m}),98);
__d("MAWEBClientStateLogging",["EBGetClientState","EBLS","MAWODSProxy","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";async function e(){var e=(await o("EBLS").init()).db,t=await o("EBGetClientState").getClientState(e);o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_CLIENT_STATE_CHECK,key:t==null?"null":"present"})}l.logEBClientStateForDebugging=e}),98);
__d("MAWDebugInfoDb",["FBLogger","MAWCurrentUser","MAWIndexedDbMetadata","MAWWormOdsLogger","MessengerWebInitData","WAHex","Worm","WormEAR","WormIDbDriver","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e={initRestore:{indexes:{},primaryKey:"key"}},s=null;async function u(t,n){if(s!=null)return s;var a="maw_debug_info",i=new(o("WormEAR")).WormEAR(e,a,t),l=new(o("WormIDbDriver")).WormIDbDriver(o("MAWIndexedDbMetadata").MAWDebugInfoDBName(o("MAWCurrentUser").getID()),a,e,i,o("MAWWormOdsLogger").wormOdsWorkerLogger,{onBlockingError:function(t){r("FBLogger")("MAWDebugInfoDb").warn("Blocking error: %s",t)},onTransactionError:function(t){r("FBLogger")("MAWDebugInfoDb").warn("Transaction error: %s",t.message)}}),u=new(o("Worm")).WormDatabase(l,n);return s=u,await u.init(),u}function c(){return u(o("WAHex").parseHex(r("MessengerWebInitData").accountKeyV2),r("qpl")._(1056840657,"2716"))}l.getMAWDebugInfoDb=c}),98);
__d("MAWEBInitRestoreLogging",["MAWDebugInfoDb","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e={restoredInSession:!1,restoreMethod:null,restoreTimeMs:null};async function s(t){var n=t.method;e.restoredInSession=!0;var r=o("WATimeUtils").millisTime();e.restoreMethod=n,e.restoreTimeMs=r;var a=await o("MAWDebugInfoDb").getMAWDebugInfoDb();await a.runInTransaction(["initRestore"],"readwrite",async function(e){await e.stores.initRestore.bulkPut([{data:{restoreMethod:n,restoreTimeMs:r},key:"initRestoreDebugInfo"}])},"logInitRestoreMethodForDebugging")}async function u(){var t=await c();return babelHelpers.extends({},e,t)}async function c(){var e=await o("MAWDebugInfoDb").getMAWDebugInfoDb(),t=await e.runInTransaction(["initRestore"],"readonly",function(e){return e.stores.initRestore.get("initRestoreDebugInfo")},"getInitRestoreDebugInfo");return t==null?{}:babelHelpers.extends({},t.data)}l.logInitRestoreMethodForDebugging=s,l.getInitRestoreDebugInfo=u}),98);
__d("MAWFTSEBMessagesDataSync",["FBLogger","I64","MAWBridge","MAWDbFTSManifest","MAWFTSIndexedDb","MAWFTSWorkerFactory","MAWTransactionMode","MAWVault","err","getErrorSafe","isMAWUniversalSearchWithEBEnabled","justknobx","promiseDone","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=(c=r("justknobx"))._("2645"),m=c._("2606")+c._("2646"),p=c._("2647"),_=[],f=new Map,g=[];function h(e){var t,n;_=_.filter(function(t){return t.tabId!==e}),g=g.filter(function(t){return t!==e}),f.has(e)&&(window.clearTimeout((t=f.get(e))==null?void 0:t.aliveTimeout),(n=f.get(e))==null||(n=n.ongoingTask)==null||n.reject(r("err")("Tab is closed")),f.delete(e))}function y(e,t){var n=window.setTimeout(function(){h(e)},p),r=f.get(e);if(t&&v(e),r!=null){window.clearTimeout(r.aliveTimeout),r.aliveTimeout=n;return}f.set(e,{aliveTimeout:n,ongoingTask:null})}var C=function(t){var e=t.hasFocus,n=t.tabId;return y(n,e),Promise.resolve()},b=function(t){var e=t.tabId;return h(e),Promise.resolve()};function v(e){g.length>0&&g[0]===e||(g=[e].concat(g.filter(function(t){return t!==e})))}var S=function(t){var e=t.tabId;return y(e,!0),Promise.resolve()};async function R(e){var t=f.get(e);if(t!=null){var n=new Promise(function(e,n){t.ongoingTask={reject:n,resolve:e}});try{await Promise.race([n,new Promise(function(e,t){window.setTimeout(function(){t(r("err")("Task timeout"))},m)})])}catch(e){var o=r("getErrorSafe")(e);r("FBLogger")("fts_worker").catching(o).mustfix("Failed to restore FTS index for tab %s",o.message)}finally{var a=f.get(e);a!=null&&(a.ongoingTask=null),_=_.filter(function(t){return t.tabId!==e})}}}var L=function(t){var e=t.tabId,n=t.threadJid;return!o("MAWFTSWorkerFactory").isFTSInitiated()||_.length>=d||!g.slice(0,d).includes(e)||_.some(function(e){return e.threadJid===n})?Promise.resolve(!1):(_.push({tabId:e,threadJid:n}),r("promiseDone")(R(e)),Promise.resolve(!0))},E=function(t){var e=t.error,n=t.tabId;if(e==null){var r;(r=f.get(n))==null||(r=r.ongoingTask)==null||r.resolve()}else{var o;(o=f.get(n))==null||(o=o.ongoingTask)==null||o.reject(e)}return Promise.resolve()},k=(s=o("MAWFTSIndexedDb")).makeMsgrFTSTransactor({ftsRestoreStatus:(u=o("MAWTransactionMode")).READWRITE},function(t){return function(n,r){return t.ftsRestoreStatus.get(n).then(function(a){var i,l;if(!(a!=null&&(e||(e=o("I64"))).lt((e||(e=o("I64"))).of_string(a.restoredUntilSortOrderMs),(e||(e=o("I64"))).of_string(r)))){var s=(i=(l=a==null?void 0:a.maxRestoredUntilSortOrderMs)!=null?l:a==null?void 0:a.restoredUntilSortOrderMs)!=null?i:r;return t.ftsRestoreStatus.put({maxRestoredUntilSortOrderMs:s,restoredUntilSortOrderMs:r,threadId:n})}})}}),I=s.makeMsgrFTSTransactor({ftsRestoreStatus:u.READWRITE},function(e){return function(t){return e.ftsRestoreStatus.get(t)}}),T=s.makeMsgrFTSTransactor({ftsRestoreStatus:u.READWRITE},function(e){return function(t){return e.ftsRestoreStatus.delete(t)}}),D=s.makeMsgrFTSTransactor({ftsManifest:u.READWRITE},function(e){return function(){return e.ftsManifest.get(o("MAWDbFTSManifest").ManifestKeys.CURR_VERSION).then(function(t){if(t!=null){if(t.restoreSessionId!=null)return t.restoreSessionId;var n=r("uuidv4")();return e.ftsManifest.update(o("MAWDbFTSManifest").ManifestKeys.CURR_VERSION,{restoreSessionId:n}).then(function(){return n})}return""})}}),x=s.makeMsgrFTSTransactor({ftsRestoreStatus:u.READWRITE},function(e){return function(){return e.ftsRestoreStatus.toCollection().toArray()}}),$=async function(t){var e=t.newSortOrderMs,n=t.threadId,a=t.unvaultedBridgeSearchMessages,i=o("MAWFTSWorkerFactory").getFTSWorker(),l=a.map(function(e){var t,r=(t=e.msg)==null?void 0:t.content;return r==null?null:{chatId:n,id:e.externalId,textFragments:[o("MAWVault").isVaulted(r)?o("MAWVault").unvault(r):r],timestamp:e.sortOrderMs}}).filter(Boolean),s;r("isMAWUniversalSearchWithEBEnabled")()&&(s=await i.getExistingMessageIdsInIndex(a.map(function(e){return e.externalId}))),i.setEphemeralBacklog(l),await i.index({estimatedNumMessages:l.length,type:"EB"}),await k(n,e),o("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"AddMessageSearchResult",value:s!=null?a.filter(function(e){return!s.has(e.externalId)}):a}]})},P=s.makeMsgrFTSTransactor({mediaRestoreStatus:u.READWRITE},function(e){return function(t){return e.mediaRestoreStatus.get(t)}}),N=s.makeMsgrFTSTransactor({mediaRestoreStatus:u.READWRITE},function(t){return function(n,r){return t.mediaRestoreStatus.get(n).then(function(a){var i,l;if(!(a!=null&&(e||(e=o("I64"))).lt((e||(e=o("I64"))).of_string(a.restoredUntilSortOrderMs),(e||(e=o("I64"))).of_string(r)))){var s=(i=(l=a==null?void 0:a.maxRestoredUntilSortOrderMs)!=null?l:a==null?void 0:a.restoredUntilSortOrderMs)!=null?i:r;return t.mediaRestoreStatus.put({maxRestoredUntilSortOrderMs:s,restoredUntilSortOrderMs:r,threadId:n})}})}}),M=function(){return D()},w=async function(t){var e,n=t.threadId,r=await I(n);return(e=r==null?void 0:r.restoredUntilSortOrderMs)!=null?e:null},A=async function(t){var e=t.newSortOrderMs,n=t.threadId;await k(n,e)},F=async function(t){var e=t.threadId,n=await I(e);return n},O=async function(t){var e=t.threadId;await T(e)},B=function(){return x()},W=async function(t){var e=t.threadId,n=await P(e);return n},q=async function(t){var e=t.newSortOrderMs,n=t.threadId;await N(n,e)},U=async function(t){var e,n=t.threadId,r=await P(n);return(e=r==null?void 0:r.restoredUntilSortOrderMs)!=null?e:null};l.searchFTSReportTabAlive=C,l.searchFTSReportTabDestroy=b,l.searchFTSReportTabForeground=S,l.searchFTSRequestRestoreTask=L,l.searchFTSReportTabTaskComplete=E,l.searchIndexUpdate=$,l.searchGetFTSRestoreSessionId=M,l.searchGetFTSNextTimestamp=w,l.searchSetFTSNextTimestamp=A,l.searchFTSGetThreadRestoreStatus=F,l.searchFTSClearThreadRestoreStatus=O,l.searchFTSGetThreadsRestoreStatus=B,l.getThreadMediaRestoreStatus=W,l.setThreadMediaRestoreStatus=q,l.getMediaRestoreNextTimestamp=U}),98);
__d("MAWGetBlobDataUrlByMediaIdApi",["FBLogger","MAWCreateMaybeAddPointForMediaRender","MAWIndexedDb","MAWLegacyMediaDownloadManager","MAWMaybeWithTimeout","MAWMediaManager","MAWTransactionMode","WAAssertUnreachable","WALogger","WAMediaManager","WAResultOrError","WAStartMediaDownloadQplFlow"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=6e4,c=function(n,a,i){var t=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(i);return t("fetch_blob_api_start",{string:{call_site:a,fetch_by:"mediaId"}}),d(n,a).then(function(i){if(i.success===!1)switch(i.error){case"missing_media":throw t("fetch_blob_api_fail_no_media_found",{string:{fetch_blob_api_fail_no_media_found_error:i.error}}),r("FBLogger")("messenger_web_media").mustfixThrow("Failed to getBlobDataUrlByMediaId because media is not in the media db. mediaId is %s, from %s",n,a);default:throw r("WAAssertUnreachable")(i.error)}var l=i.value,s=l.blob,c=l.media;return s!=null?(t("fetch_blob_api_success",{bool:{has_blob:s.size>0}}),s):(t("fetch_blob_api_no_media_blob_found"),o("MAWMaybeWithTimeout").maybeWithTimeout(new Promise(function(e){t("fetch_blob_api_fetch_chunk_start"),o("MAWLegacyMediaDownloadManager").setToMediaDownloadManager(c.mediaId,e)}).then(function(e){return t("fetch_blob_api_fetch_chunk_success"),t("fetch_blob_api_success",{bool:{has_blob:e.size>0}}),e}),u,function(){throw t("fetch_blob_api_fetch_chunk_fail_timeout"),o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getBlobDataUrlByMediaIdDbCall cannot find chunk with mediaId: ",", from ",""])),n,a),r("FBLogger")("messenger_web_media").mustfixThrow("Failed to getBlobDataUrlByMediaId in time. mediaId is %s, from %s",n,a)}))})},d=o("MAWIndexedDb").makeMsgrTransactor({chunk:o("MAWTransactionMode").READONLY,media:o("MAWTransactionMode").READONLY},"getBlobDataUrlByMediaId",function(e){return function(t,n){return e.media.get(t).then(function(r){return r==null?(o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["getBlobDataUrlByMediaIdDbCall cannot find media with mediaId: ",", from ",""])),t,n),o("WAResultOrError").makeError("missing_media")):e.chunk.where("hashedPlaintextHash").equals(r.hashedPlaintextHash).first().then(function(e){return e==null?o("WAResultOrError").makeResult({blob:null,media:r}):o("WAResultOrError").makeResult({blob:new Blob([e.blobData],{type:e.mimetype}),media:r})})})}}),m=function(t,n,r){return p(t,n,r)},p=async function(t,n,a){var e,i=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(a);i("fetch_blob_api_start",{string:{call_site:n,fetch_by:"plaintextHash"}});var l=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:"UILayout",msgType:null,protocolMsgId:null,triggerUIView:null}),s=o("MAWMediaManager").getMawMediaManager(),u=await s.enqueueDownloadFullSizeAndPreview({fullSizePlaintextHash:t,mediaDownloadFlow:l,priority:o("WAMediaManager").MediaTaskPriority.HIGH}).fullsizePromise;if(!u.success)throw l.endFail(u.error),i("fetch_blob_api_fail_no_media_found",{string:{fetch_blob_api_fail_no_media_found_error:u.error}}),r("FBLogger")("messenger_web_media").mustfixThrow("Failed to getBlobDataUrlByPlaintextHash because hash is not in the media db. hash is %s, from %s",t,n);var c=u.value,d=c.unvalidatedMimeType,m=c.validatedResult,p=(e=m.mimeType)!=null?e:d,_=new Blob([m.validatedPlaintext],{type:p});return l.endSuccess(),i("fetch_blob_api_success",{bool:{has_blob:_.size>0}}),_};l.getBlobDataUrlByMediaId=c,l.getBlobDataUrlByHashedPlaintextHash=m,l.getBlobDataUrlByPlaintextHash=p}),98);
__d("MAWGetDeviceChangeAlertsByOptionsApi",["MAWDbGetDeviceChangeAlertsByOptionsTxn","MAWIndexedDb","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({deviceChangeAlerts:o("MAWTransactionMode").READWRITE},"getDeviceChangeAlertsByOptions",function(e){return(function(t){return o("MAWDbGetDeviceChangeAlertsByOptionsTxn").getDeviceChangeAlertsByOptionsTxn(e,t)})});l.getDeviceChangeAlertsByOptions=e}),98);
__d("MAWGetGroupSuperAdminApi",["MAWDbParticipantTxns","MAWIndexedDb","MAWTransactionMode","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({participants:o("MAWTransactionMode").READONLY},"getGroupSuperAdmin",function(e){return function(t){var n=o("MAWDbParticipantTxns").getParticipantsInThread(e,t);return n.then(function(e){var t=e.filter(function(e){return e.type==="superadmin"});if(t.length!==0&&t[0]){var n=t[0];return o("WAJids").extractUserId(n.userJid)}else return null})}});l.getGroupSuperAdmin=e}),98);
__d("MAWGetLatestThreadIdsApi",["MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("MAWIndexedDb").makeMsgrTransactor({threads:o("MAWTransactionMode").READONLY},"getLatestThreadIds",function(t){return(function(n){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] getLatestThreadIds started"])));var r=t.threads.orderBy("threadOrder").reverse().limit(n).toArray();return r.then(function(e){var t=[];return e.forEach(function(e){t.push(e.jid.split("@")[0])}),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] getLatestThreadIds complete, threads count: ",""])),t.length),o("MAWDexieTable").dexieResolve(t)})})});l.getLatestThreadIds=u}),98);
__d("MAWRestoreMsgsUiUpdator",["MAWBridgeEventTransmitter","MAWDbMsg","MAWDbThread","MAWDexieTable","MAWFolderTypes","MAWThreadSnippetBuildTxns","emptyFunction","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a,i,l,c,m,p,_,f){var g=s(e,i,n,a,c,m);return g.then(function(n){if(m==null||l){var r=d(n);return r&&o("MAWBridgeEventTransmitter").updateThreadOutsideTxn(n.cannotReplyReason,o("MAWFolderTypes").FOLDER_ID.INBOX,n.jid),u(e,t,n,p,_,f,m).then(function(){return n})}return n}).then(function(t){return o("MAWThreadSnippetBuildTxns").refreshThreadSnippet(e,t)}).then(r("emptyFunction"))}function s(e,t,n,r,a,i){var l=babelHelpers.extends({},t,{lastReadMsg:a,lastReadMsgTs:r,newestMsgTs:n,oldestMsg:i,threadOrder:o("MAWDbThread").craftThreadOrder(n,t.jid)});return e.threads.put(l).then(function(){return l})}function u(e,t,n,a,i,l,s){var u=t.map(function(e){return e}).reverse(),d=n.jid;if(a!=null){var m=o("MAWDbMsg").toMsgId(a);if(m!=null)return e.messages.get({msgId:m}).then(function(t){if(t!=null){var a=t.sortOrderMs,l;return r("gkx")("23906")?l=o("MAWDexieTable").dexieResolve(0):l=e.messages.where(["threadJid","sortOrderMs"]).between([d,u[0].sortOrderMs],[d,a],!1,!1).count(),l.then(function(e){e===0&&c(u,i,n)})}})}return o("MAWDexieTable").dexieResolve()}function c(e,t,n){var r=t==null?void 0:t.sortOrderMs,o=e[e.length-1],a=o.sortOrderMs;t!=null&&o!=null&&r!=null&&a!=null&&r<a&&e.push(t)}function d(e){return e.archived===!0&&e.cannotReplyReason!=="viewer_not_subscribed"}l.updateThreadAndMessages=e,l.shouldThreadBeUnarchived=d}),98);
__d("MAWRestoreMsgsTxns",["ArmadilloDataTraceType","FBLogger","FtsIndexEntity","LSMEBTaskCreationSource","MAWAdminMsgTypesGrouped","MAWBridgeEventTransmitter","MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWFTSTxns","MAWIndexedDb","MAWJidUtils","MAWLocalizationType","MAWMsgType","MAWQplProxy","MAWRestoreMsgsUiUpdator","MAWTimeUtils","MAWTransactionMode","MAWUseProtocolMsgIdForMsgId","Promise","WAHashStringToNumber","WAJids","WALogger","WATimeUtils","emptyFunction","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d;function m(e,t,n){return n!=null?e.messages.where(["threadJid","sortOrderMs"]).between([t.jid,n.ts],[t.jid,o("MAWDbMsg").MAX_MSG_SORT_ORDER],!1,!0).limit(1).first():o("MAWDexieTable").dexieResolve()}function p(e,t,n){return o("MAWDbMsgTxns").maybeGetMsg(e,n).then(function(n){return n!=null?e.messages.where(["threadJid","sortOrderMs"]).between([t.jid,n.sortOrderMs],[t.jid,o("MAWDbMsg").MAX_MSG_SORT_ORDER],!1,!0).limit(1).first():o("MAWDexieTable").dexieResolve()})}function _(e){return e!=null&&e.type===o("MAWMsgType").MSG_TYPE.ADMIN&&(e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION||e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE||e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_IGD_THREAD_ADMIN_MESSAGE||e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE||o("MAWAdminMsgTypesGrouped").dualThreadCutoverAdminMsgs.includes(e.msgContent.adminType))}function f(e,t){var n=Number(e);for(var a of t)r("FBLogger")("wmi_eb").info("completed point restore of an unavailable msg with instanceKey: %s",n),o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(1056840931,"814"),"eb_point_restore_end",{annotations:{int:{msgId:o("WAHashStringToNumber").hashStringToNumber(a.externalId)},string:{jid:a.threadJid}},instanceKey:n}),o("MAWQplProxy").sendQPLSuccessThroughBridge(r("qpl")._(1056840931,"814"),{int:{msgId:o("WAHashStringToNumber").hashStringToNumber(a.externalId)}},n)}function g(e,t,n,r,a,i,l,s,u){var c=i.isOldestMsgUpdated,d=i.lastReadMsg,m=i.lastReadMsgTs,p=i.newestMsgTs,_=i.oldestMsgId,f=!0;t&&(f=C(p,r));var g=o("MAWDexieTable").dexieResolve();return f&&a.length>0&&(g=o("MAWRestoreMsgsUiUpdator").updateThreadAndMessages(e,a,p,m,n,c,d,_,l,s,u)),g.then(function(){return o("MAWDexieTable").dexieResolve()})}function h(e){var t=e.existingMsgs,n=e.hasMoreBefore,a=e.instanceKey,i=e.isPointRestore,l=e.maybeNewestMsg,s=e.maybeOldestAdminMsg,u=e.maybeOldestMsg,c=e.minMsgId,d=e.newMsgs,m=e.optimisticMsgs,p=e.shouldSkipSyncToUI,_=e.taskSource,f=e.thread,g=_===r("LSMEBTaskCreationSource").EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES,h=new Map,y=[];t.map(function(e){e.type===o("MAWMsgType").MSG_TYPE.UNAVAILABLE||e.type===o("MAWMsgType").MSG_TYPE.CIPHERTEXT?y.push(e):h.set(e.externalId,e)});var C=[];return T(d,t,f.jid,h,l,i,s,u,C,m,a,n,c,g,y,p).then(function(e){return e})}function y(e,t){e.altIndex!==o("MAWDbMsg").SPAM_ALT_INDEX&&e.altIndex!==o("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&o("MAWBridgeEventTransmitter").startTraceOutsideTxn(e,t,o("ArmadilloDataTraceType").armadilloMessageSend)}function C(e,t){return e==null?!0:t.some(function(t){return t.sortOrderMs!=null&&t.sortOrderMs>=e})}var b=(c=o("MAWIndexedDb")).makeMsgrTransactor({messages:(d=o("MAWTransactionMode")).READONLY},"getMsgsByProtocolMsgIds",function(e){return(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return o("MAWDbMsgTxns").getMsgsByProtocolMsgId.apply(void 0,[e].concat(n))})}),v=c.makeMsgrTransactor({messages:d.READONLY},"restoreGetMsg",function(e){return function(t){return o("MAWDbMsgTxns").maybeGetMsg(e,t)}}),S=c.makeMsgrTransactor({messages:d.READONLY},"restoreGetThreadNewestMessage",function(e){return function(t){return o("MAWDbMsgTxns").getThreadNewestMessageBySortOrder(e,t.jid)}}),R=c.makeMsgrTransactor({messages:d.READONLY},"restoreMaybeGetOldestNonAdminMessage",function(e){return function(t){return o("MAWDbMsgTxns").getThreadOldestMessageBySortOrder(e,t.jid).then(function(n){return n==null?o("MAWDexieTable").dexieResolve({maybeOldestAdminMsg:null,maybeOldestMsg:null}):_(n)?m(e,t,n).then(function(e){return{maybeOldestAdminMsg:n,maybeOldestMsg:e}}):{maybeOldestAdminMsg:null,maybeOldestMsg:n}})}});function L(e,t,n,a,i,l,s,u,c){return o("MAWDexieTable").dexieAll(t.map(function(t){return o("MAWDbMsgTxns").maybeGetMsgByExternalId(e,t.externalId,n.jid,t.author).then(function(e){if(e==null){var r=a.get(t.externalId);if(r==null){var d=o("WATimeUtils").castUnixTimeToMillisTime(t.ts);u.newestMsgTs=d>u.newestMsgTs?d:u.newestMsgTs;var m=o("MAWUseProtocolMsgIdForMsgId").shouldUseProtocolMsgIdForMsgId()?o("MAWJidUtils").formatProtocolMsgIdFromMsg(t):o("MAWDbMsg").craftMsgIdV2(n.chatId,u.msgNextInChatMsgId,t);u.msgNextInChatMsgId+=1,(u.oldestMsgId==null||!l&&d<u.oldestMsgTs)&&(u.isOldestMsgUpdated=!0,u.oldestMsgId=s!=null&&o("WATimeUtils").castUnixTimeToMillisTime(s.ts)<d?s.msgId:m,u.oldestMsgTs=s!=null&&o("WATimeUtils").castUnixTimeToMillisTime(s.ts)<d?o("WATimeUtils").castUnixTimeToMillisTime(s.ts):d),(u.newestMsgTs===d||_(i))&&(u.newestMsgId=m),t.author===o("WAJids").AUTHOR_ME&&(u.lastReadMsgTs==null||d>u.lastReadMsgTs)&&(u.lastReadMsg=m,u.lastReadMsgTs=d);var p=babelHelpers.extends({},t,{msgId:m,sortOrderMs:o("MAWDbMsg").getSortOrderWithFallback(t)});c.push(p)}}})})).then(r("emptyFunction"))}function E(e,t){return o("MAWDexieTable").dexieAll([o("MAWDbMsgTxns").getThreadNewestMessageId(e,t.jid),o("MAWDbMsgTxns").getThreadNewestMessageMs(e,t.jid),o("MAWUseProtocolMsgIdForMsgId").shouldUseProtocolMsgIdForMsgId()?o("MAWDexieTable").dexieResolve(0):o("MAWDbMsgTxns").getNextMsgIdNumberForThread(e,t)]).then(function(e){var t=e[0],n=e[1],r=e[2];return{newestMsgId:t,newestMsgTs:n,nextInChatMsgId:r}})}function k(e,t,n,a,i,l,s,u,c,d,m){return L(e,t,n,a,i,l,s,u,c).then(function(t){if(d!=null)for(var i of c){var l=i.externalId,s=d.get(l);s!=null&&(i.ts=o("WATimeUtils").castMilliSecondsToUnixTime(s.ts))}var u=r("justknobx")._("3227")?c.map(function(e){return babelHelpers.extends({},e,{source:m===!0?"media_restore":"eb_restore"})}):c;return o("MAWDexieTable").dexieAll([e.messages.bulkAdd(u,{allKeys:!0}).then(function(e){return e.map(function(e,t){return babelHelpers.extends({},u[t],{rowId:e})})}),m!==!0&&r("justknobx")._("3227")?e.messages.bulkPut(Array.from(a.values()).map(function(e){return babelHelpers.extends({},e,{source:"eb_restore"})})):o("MAWDexieTable").dexieResolve()]).then(function(t){var r=t[0];return e.threads.put(n).then(function(){return r})})})}function I(e,t,n){var r=t.map(function(e){var t=n.find(function(t){return t.externalId===e.externalId});if(t==null)return null;var r=babelHelpers.extends({externalId:t.externalId,msgId:t.msgId,protocolMsgId:t.protocolMsgId,rowId:t.rowId},e);return r}).filter(Boolean);return e.messages.bulkPut(r).then(function(){})}var T=c.makeMsgrTransactor({ftsBackloggedMessages:d.READWRITE,groupInfo:d.READWRITE,messages:d.READWRITE,threads:d.READWRITE},"createRestoredMessagesAndUpdateThread",function(t){return(function(r,a,i,l,c,d,m,p,_,f,h,C,b,v,S,R){return t.threads.get({jid:i}).then(function(h){return h==null?(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Thread with jid "," does not exist for restore"])),i),o("MAWDexieTable").dexieResolve()):E(t,h).then(function(e){var i,v=e.newestMsgId,L=e.newestMsgTs,E=e.nextInChatMsgId,T={isOldestMsgUpdated:!1,lastReadMsg:h.lastReadMsg,lastReadMsgTs:o("MAWTimeUtils").ensureValidMillisTime(h.lastReadMsgTs),msgNextInChatMsgId:E,newestMsgId:v,newestMsgTs:o("MAWTimeUtils").ensureValidMillisTime(L)||o("WATimeUtils").castToMillisTime(0),oldestMsgId:p==null?void 0:p.msgId,oldestMsgTs:o("WATimeUtils").castUnixTimeToMillisTime((i=p==null?void 0:p.ts)!=null?i:o("WATimeUtils").castToUnixTime(0))},D=I(t,r,S);return D.then(function(){return o("MAWDexieTable").dexieAll([k(t,r,h,l,c,d,m,T,_,f,R),o("MAWFTSTxns").dexieIfElse(o("FtsIndexEntity").isFtsIndexQueueExperiment(),function(){return(u||(u=n("Promise"))).resolve()},function(){return o("MAWFTSTxns").maybePutMessagesToBacklog(t,r.map(function(e){return e.externalId}))})]).then(function(e){var n=e[0];if(R!==!0)for(var r of n)y(r,h.jid);var i=a.concat(n),l={existingMsgs:a,newlyAddedMsgs:n,threadJid:h.jid},s=R!==!0?g(t,d,h,i,n,T,b,m,C):o("MAWDexieTable").dexieResolve();return s.then(function(){return l})}).catch(function(e){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to create restored messages and update thread metadata ",""])),e)})})})})})});l.getNextMsgBasedOnSortOrderMs=p,l.isE2eeOrCutoverAdminMsg=_,l.restoreMsgsForThread=h,l.getMsgsByProtocolMsgIds=b,l.getMsg=v,l.maybeGetThreadNewestMessage=S,l.maybeGetOldestNonAdminMessage=R,l.prepareUnstoredMsgArrayAndUpdateKeyVariables=L}),98);
__d("MAWGetMaybeNextNonAdminMsgSortOrderMsApi",["MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWRestoreMsgsTxns","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY,threads:o("MAWTransactionMode").READONLY},"getMaybeNextNonAdminMsgSortOrderMs",function(e){return(function(t,n){return o("MAWDexieTable").dexieAll([o("MAWDbMsgTxns").maybeGetMsg(e,n),o("MAWDbThreadTxns").getThread(e,t)]).then(function(t){var n=t[0],r=t[1],a=0;return o("MAWRestoreMsgsTxns").isE2eeOrCutoverAdminMsg(n)&&r.success&&n!=null?o("MAWRestoreMsgsTxns").getNextMsgBasedOnSortOrderMs(e,r.value,n==null?void 0:n.msgId).then(function(e){return e!=null&&e.sortOrderMs!=null&&(a=e.sortOrderMs),{minMsgTimestampMs:a}}):(n!=null&&n.sortOrderMs!=null&&(a=n.sortOrderMs),{minMsgTimestampMs:a})})})});l.getMaybeNextNonAdminMsgSortOrderMs=e}),98);
__d("MAWGetMediaApi",["MAWDbMediaTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","MWFBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(t){var e=t.media,n=t.xmaMediaType;return e==null?null:{media:e,xmaMediaType:n}},c=o("MAWIndexedDb").makeMsgrTransactor({media:(s=o("MAWTransactionMode")).READONLY},"getMediaByPlaintextHash",function(e){return function(t){return o("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(e,t)}}),d=o("MAWIndexedDb").makeMsgrTransactor({media:s.READONLY},"getMediaByMediaId",function(e){return function(t){return o("MAWDbMediaTxns").maybeGetMediaFromMediaId(e,t)}}),m=o("MAWIndexedDb").makeMsgrTransactor({media:s.READONLY,xma:s.READONLY},"getMediaByXMAId",function(t){return function(n){return t.xma.get(n).then(function(r){return r==null?(o("MWFBLogger").MWMediaLogger().tags(["downloadMediaForUI"]).MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["cannot find xma with xmaId ",""])),n),[]):o("MAWDexieTable").dexieAll([o("MAWDbMediaTxns").maybeGetMediaFromMediaId(t,r.defaultPreviewMediaId).then(function(e){return u({media:e,xmaMediaType:"preview"})}),o("MAWDbMediaTxns").maybeGetMediaFromMediaId(t,r.headerMediaId).then(function(e){return u({media:e,xmaMediaType:"headerImage"})}),o("MAWDbMediaTxns").maybeGetMediaFromMediaId(t,r.faviconMediaId).then(function(e){return u({media:e,xmaMediaType:"favicon"})})])})}});l.getMediaByPlaintextHash=c,l.getMediaByMediaId=d,l.getMediaByXMAId=m}),98);
__d("MAWGetMediaDownloadStatusApi",["MAWCreateMaybeAddPointForMediaRender","MAWDbChunkTxns","MAWDbMedia","MAWGetMediaApi","MAWIndexedDb","MAWLoggerUtils","MAWMediaDownloadStatus","MAWTransactionMode","MWFBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("MWFBLogger").MWMediaLogger().tags([o("MAWLoggerUtils").Tag.MediaDownload,o("MAWLoggerUtils").Tag.MessageReceive]),c=async function(n,a){var t=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(a);t("get_media_download_status_api_start",{string:{fetch_by:"mediaId"}}),t("get_media_download_status_api_get_media_start");var i=await o("MAWGetMediaApi").getMediaByMediaId(n);if(t("get_media_download_status_api_get_media_end",{bool:{has_media:i!=null}}),i==null)return t("get_media_download_status_api_fail",{string:{fail_reason:"media_not_found"}}),u.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getMediaDownloadStatusByMediaId - media not found for mediaId: ",""])),n),{mainMediaStatus:r("MAWMediaDownloadStatus").MISSING_FILE,mainMediaStatusDetails:"get_by_mediaId_missing_media",previewMediaStatus:r("MAWMediaDownloadStatus").MISSING_FILE,previewMediaStatusDetails:"get_by_mediaId_missing_media"};t("get_media_download_status_api_get_status_from_media_start");var l=await m(i);return t("get_media_download_status_api_get_status_from_media_end"),t("get_media_download_status_api_end"),l},d=async function(t,n){var e=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(n);e("get_media_download_status_api_start",{string:{fetch_by:"plaintextHash"}}),e("get_media_download_status_api_get_media_start");var a=await o("MAWGetMediaApi").getMediaByPlaintextHash(t);if(e("get_media_download_status_api_get_media_end",{bool:{has_media:a!=null}}),a==null)return e("get_media_download_status_api_fail",{string:{fail_reason:"media_not_found"}}),u.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["getMediaDownloadStatusByPlaintextHash - media not found for plaintextHash: ",""])),t),{mainMediaStatus:r("MAWMediaDownloadStatus").MISSING_FILE,mainMediaStatusDetails:"get_by_mediaPlaintextHash_missing_media",previewMediaStatus:r("MAWMediaDownloadStatus").MISSING_FILE,previewMediaStatusDetails:"get_by_mediaPlaintextHash_missing_media"};var i=await m(a);return e("get_media_download_status_api_get_status_from_media_end"),e("get_media_download_status_api_end"),i};async function m(e){var t=await p(e),n=t.hasDownloadedMainMedia,o=t.hasDownloadedThumbnail,a=t.hasThumbnail;return{mainMediaStatus:n?r("MAWMediaDownloadStatus").SUCCESS:r("MAWMediaDownloadStatus").MISSING_FILE,mainMediaStatusDetails:"status_from_media",previewMediaStatus:a?o?r("MAWMediaDownloadStatus").SUCCESS:r("MAWMediaDownloadStatus").MISSING_FILE:void 0,previewMediaStatusDetails:"status_from_media"}}var p=o("MAWIndexedDb").makeMsgrTransactor({chunk:o("MAWTransactionMode").READONLY},"checkMediaDownloadStatus",function(e){return function(t){var n=_(t);return o("MAWDbChunkTxns").hasMediaChunk(e,t.hashedPlaintextHash).then(function(e){return{hasDownloadedMainMedia:e,hasDownloadedThumbnail:(n==null?void 0:n.jpegThumbnail)!=null,hasThumbnail:n!=null}})}});function _(e){var t,n;switch(e.mediaType){case o("MAWDbMedia").MEDIA_TYPE.IMAGE:return{jpegThumbnail:(t=e.validatedImageInfo)==null?void 0:t.jpegThumbnail};case o("MAWDbMedia").MEDIA_TYPE.VIDEO:return{jpegThumbnail:(n=e.validatedVideoInfo)==null?void 0:n.jpegThumbnail}}}l.getMediaDownloadStatusByMediaId=c,l.getMediaDownloadStatusByPlaintextHash=d}),98);
__d("MAWGetMediaValidationResultApi",["MAWGetMediaApi","MAWVideoAudioValidationUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.validatedResult;return t==null?null:o("MAWVideoAudioValidationUtils").normalizeValidationResult({audioAvgBitsPerSecond:t.audioAvgBitsPerSecond,audioNumberOfChannels:t.audioNumberOfChannels,audioSamplingRate:t.audioSamplingRate,audioStreamType:t.audioStreamType,validatedMimeType:t.validatedMimeType,videoAvgBitsPerSecond:t.videoAvgBitsPerSecond,videoCalculatedFps:t.videoCalculatedFps,videoDuration:t.videoDuration,videoHeight:t.videoHeight,videoNominalFps:t.videoNominalFps,videoStreamType:t.videoStreamType,videoWidth:t.videoWidth})}var s=async function(n,r){var t=await o("MAWGetMediaApi").getMediaByMediaId(n);return t==null?null:e(t)},u=async function(n,r){var t=await o("MAWGetMediaApi").getMediaByPlaintextHash(n);return t==null?null:e(t)};l.getMediaValidationResultByMediaId=s,l.getMediaValidationResultByPlainTextHash=u}),98);
__d("MAWGetProtocolMsgIdByMediaMsgId",["MAWIndexedDb","MAWTransactionMode","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY,threads:o("MAWTransactionMode").READONLY},"getProtocolMsgIdByMediaMsgId",function(e){return(function(t){return e.messages.get({msgId:t}).then(function(t){return t==null?null:e.threads.get({jid:t.threadJid}).then(function(e){return e==null||o("WAJids").isAuthorSystem(t.author)?null:{author:t.author,chat:e.jid,externalId:t.externalId}})})})});l.getProtocolMsgIdByMediaMsgId=e}),98);
__d("getProtocolMsgIdByMsgIdCommon",["MAWDexieTable","WAJids"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return o("MAWDexieTable").dexieAll([e.messages.get({msgId:t}),e.unrenderedMessages.get({msgId:t}),e.reactions.get({reactionId:t})]).then(function(t){var n=t[0],r=t[1],a=t[2];if(a!=null)return o("WAJids").isAuthorSystem(a.author)?null:{author:a.author,chat:a.threadJid,externalId:a.externalId};var i=n||r;return i==null?null:e.threads.get({jid:i.threadJid}).then(function(e){return e==null||o("WAJids").isAuthorSystem(i.author)?null:{author:i.author,chat:e.jid,externalId:i.externalId}})})}l.getProtocolMsgIdByMsgIdCommon=e}),98);
__d("MAWGetProtocolMsgIdByMsgId",["MAWIndexedDb","MAWTransactionMode","getProtocolMsgIdByMsgIdCommon"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWIndexedDb").makeMsgrTransactor({messages:(e=o("MAWTransactionMode")).READONLY,reactions:e.READONLY,threads:e.READONLY,unrenderedMessages:e.READONLY},"getProtocolMsgByMsgId",function(e){return(function(t){return o("getProtocolMsgIdByMsgIdCommon").getProtocolMsgIdByMsgIdCommon(e,t)})});l.getProtocolMsgIdByMsgId=s}),98);
__d("MAWGetReceiverFetchInfoApi",["MAWDbReceiverFetchTxns","MAWIndexedDb","MAWTransactionMode","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({receiverFetchInfo:o("MAWTransactionMode").READONLY},"MAWGetReceiverFetchInfo",function(e){return(function(t){var n=t.receiverFetchId;return o("MAWDbReceiverFetchTxns").maybeGetReceiverFetchInfoFromReceiverFetchId(e,n).then(function(e){var t;if(!(e==null||e.previewUrl==null||e.previewUrlExpirationTimestampMs==null))return{accessibilitySummaryText:(t=e.accessibilitySummaryText)!=null?t:void 0,previewUrl:e.previewUrl,previewUrlExpirationTimestampMs:o("WATimeUtils").castLongIntToMillisTime(e.previewUrlExpirationTimestampMs)}})})});l.getReceiverFetchInfo=e}),98);
__d("WADbIdentityTxns",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return e.identity.bulkGet(t).then(function(e){return e.map(function(e){if(e!=null)return{id:e.deviceJid,identity:e.identity}}).filter(Boolean)})}i.bulkGetIdentities=e}),66);
__d("WACompareIdentity",["WACryptoUtils","WADbIdentityTxns","WADbSignal","WAJids","WASignalKeys"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=await e.meta.bulkGet([o("WADbSignal").MetaKeysEnum.fbid,o("WADbSignal").MetaKeysEnum.deviceId,o("WADbSignal").MetaKeysEnum.identityKeyPair]),n=t[0],r=t[1],a=t[2],i=n==null?void 0:n.value.fbid,l=r==null?void 0:r.value.deviceId,s=a==null?void 0:a.value.identityKeyPair;if(i!=null&&l!=null){var u=o("WAJids").toDeviceJid(o("WAJids").toMsgrUserJid(i),l),c=await o("WADbIdentityTxns").bulkGetIdentities(e,[u]);if(c.length!==0){var d=c[0];if((s==null?void 0:s.publicKey)==null)return!0;if(!o("WACryptoUtils").serializedPubKeysEqual(d.identity,o("WASignalKeys").serializePubKey(s)))return!1}return!0}return!0}l.compareIdentity=e}),98);
__d("WAGetRegistrationInfoApi",["WACompareIdentity","WADbSignal","WALogger","WASignalDB","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return o("WASignalDB").getDb().runInTransaction(["meta","identity"],"readonly",async function(e){var t,n,r,a,i,l,s,u,c,d,m=await Promise.all([e.stores.meta.bulkGet([(d=o("WADbSignal")).MetaKeysEnum.lastSignedPrekeyId,d.MetaKeysEnum.deviceUUID,d.MetaKeysEnum.lastSessionDeviceWasLinkedTo,d.MetaKeysEnum.regId,d.MetaKeysEnum.identityKeyPair,d.MetaKeysEnum.fbid,d.MetaKeysEnum.deviceId,d.MetaKeysEnum.registrationVersion,d.MetaKeysEnum.deviceRegUnixTime,d.MetaKeysEnum.cat]),o("WACompareIdentity").compareIdentity(e.stores)]),p=m[0],_=p[0],f=p[1],g=p[2],h=p[3],y=p[4],C=p[5],b=p[6],v=p[7],S=p[8],R=p[9],L=m[1],E=_==null||(t=_.value)==null?void 0:t.lastSignedPrekeyId,k=f==null||(n=f.value)==null?void 0:n.deviceUUID,I=g==null||(r=g.value)==null?void 0:r.lastSessionDeviceWasLinkedTo,T=h==null||(a=h.value)==null?void 0:a.regId,D=y==null||(i=y.value)==null?void 0:i.identityKeyPair,x=C==null||(l=C.value)==null?void 0:l.fbid,$=b==null||(s=b.value)==null?void 0:s.deviceId,P=v==null?void 0:v.value.registrationVersion,N=S==null||(u=S.value)==null?void 0:u.deviceRegUnixTime,M=R==null||(c=R.value)==null||(c=c.cat)==null?void 0:c.expiration_time_in_seconds;return{lastSignedPrekeyId:E,deviceUUID:k,lastSessionDeviceWasLinkedTo:I,regId:T,identityKeyPair:D,registrationUnixTime:N,fbid:x,deviceId:$,registrationVersion:P,identityCompareResult:L,catExpiryUnixTime:M!=null?o("WATimeUtils").castToUnixTime(M):void 0}},o("WASignalDB").signalOp("getRegistrationInfo"))}function u(){return o("WASignalDB").getDb().runInTransaction(["plaintextMeta"],"readonly",function(e){return e.stores.plaintextMeta.get(o("WADbSignal").PlainTextMetaKeysEnum.registrationHistory).then(function(e){return e==null?void 0:e.value.registrationHistory})},"getRegistrationHistory")}var c=10;function d(t){return o("WASignalDB").getDb().runInTransaction(["plaintextMeta"],"readwrite",function(n){return n.stores.plaintextMeta.get(o("WADbSignal").PlainTextMetaKeysEnum.registrationHistory).then(function(r){var a=o("WATimeUtils").unixTime(),i=r==null?void 0:r.value.registrationHistory;if(!(i==null&&t==null)){var l;if(t!=null)l=[].concat(i!=null?i:[],[{deviceRegTime:t,lastActivityTime:a}]);else{var s=i;if(s.length===0){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Registration history log unexpectedly empty"])));return}var u=s[s.length-1];l=[].concat(s.slice(0,-1),[babelHelpers.extends({},u,{lastActivityTime:a})])}return n.stores.plaintextMeta.bulkPut([{key:o("WADbSignal").PlainTextMetaKeysEnum.registrationHistory,value:{registrationHistory:l.slice(-c)}}]).then(function(){})}})},"updateRegistrationHistory")}l.getRegistrationInfo=s,l.getRegistrationHistory=u,l.updateRegistrationHistory=d}),98);
__d("MAWGetRedactedRegistrationInfoForBugnub",["WAGetRegistrationInfoApi"],(function(t,n,r,o,a,i,l){"use strict";async function e(){var e=await o("WAGetRegistrationInfoApi").getRegistrationInfo(),t=e.catExpiryUnixTime,n=e.registrationUnixTime;return{catExpiryUnixTime:t,registrationUnixTime:n}}l.getRedactedRegistrationInfoForBugnub=e}),98);
__d("MessengerInfraReport",["gkx"],(function(t,n,r,o,a,i,l){"use strict";var e={},s=function(){for(var t of Object.keys(e))delete e[Number(t)]},u=function(){return r("gkx")("23390")},c=20,d=function(n,r,o){var t=e[n];if(!t){e[n]=new Map([[o,babelHelpers.extends({},r,{latestTimestampMs:Date.now(),startTimestampMs:Date.now()})]]);return}var a=t.get(o);if(a!=null){t.set(o,babelHelpers.extends({},a,r,{latestTimestampMs:Date.now()}));return}if(t.size>=c){e[n]=new Map([[o,babelHelpers.extends({},r,{latestTimestampMs:Date.now(),startTimestampMs:Date.now()})]]);return}t.set(o,babelHelpers.extends({},r,{latestTimestampMs:Date.now(),startTimestampMs:Date.now()}))},m=function(n,r){var t;return(t=e[n])==null?void 0:t.get(r)},p=function(n,r){var t;(t=e[n])==null||t.delete(r)};l.reportedEvents=e,l.clearReportedEvents=s,l.isEPD=u,l.MAX_SIZE=c,l.storeEventData=d,l.getEventData=m,l.deleteEventData=p}),98);
__d("MAWGetReportedQplEvents",["MessengerInfraReport","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(){return(e||(e=n("Promise"))).resolve(o("MessengerInfraReport").reportedEvents)};l.getReportedQplEvents=s}),98);
__d("MAWGetSecureThreadTotalCount",["MAWTransactionMode","MAWTransactor"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWTransactor").makeMsgrTransactor({threads:o("MAWTransactionMode").READONLY},"getSecureThreadTotalCount",function(e){return function(){return e.threads.count()}});l.getSecureThreadTotalCount=e}),98);
__d("MAWGetSecurityAlertSettingApi",["MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({appMeta:o("MAWTransactionMode").READONLY},"getSecurityAlertSetting",function(e){return function(){return o("MAWDbMsgTypeVersionTxns").getSecuritySettingForContact(e)}});l.getSecurityAlertSetting=e}),98);
__d("MAWGetSecurityAlertSettingForSelfAndContactApi",["MAWDbMsgTypeVersionTxns","MAWTransactionMode","MAWTransactor"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWTransactor").makeMsgrTransactor({appMeta:o("MAWTransactionMode").READONLY},"getSecurityAlertSettingForSelfAndContact",function(e){return(function(){return o("MAWDbMsgTypeVersionTxns").maybeBulkGetSecuritySetting(e)})});l.getSecurityAlertSettingForSelfAndContact=e}),98);
__d("MAWGetThreadConsistencyInfo",["MAWDexieTable","MAWGetThreadUpdateType","MAWIndexedDb","MAWThreadSnippetUtils","MAWThreadUpdateType","MAWTransactionMode","err"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY,reactions:o("MAWTransactionMode").READONLY,xma:o("MAWTransactionMode").READONLY},"getThreadConsistencyInfo",function(e){return(function(t){if(t.action==="GET_SNIPPETS_INFO")return o("MAWDexieTable").dexieAll(t.chatJids.map(function(t){return o("MAWThreadSnippetUtils").getThreadSnippetFromScratch(e,t)})).then(function(e){return{snippetsInfo:e}});if(t.action==="MSG_ELIGIBLE_FOR_SNIPPET_RECALCULATION")return e.messages.get({msgId:t.msgId,threadJid:t.chatJid}).then(function(e){var t=null;if(e!=null){var n;t=o("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg({adminType:(n=e.msgContent)==null?void 0:n.adminType,author:e.author,msgType:e.type,xmaMessageType:e.xmaMessageType})}return{isSnippetEligible:t!==o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}});throw r("err")("Invalid params type")})});l.getThreadConsistencyInfo=e}),98);
__d("MAWGetThreadLastMessageTsApi",["MAWDbMsgTxns","MAWIndexedDb","MAWTransactionMode","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY,threads:o("MAWTransactionMode").READONLY},"getThreadLastMessageTs",function(e){return(function(t){return e.threads.get({authoritativeThreadKey:t}).then(function(t){if(t!=null)return o("MAWDbMsgTxns").getThreadNewestMessageBySortOrder(e,t.jid).then(function(e){var t;return e==null?null:o("WATimeUtils").castUnixTimeToMillisTime((t=e.serverTs)!=null?t:o("WATimeUtils").castToUnixTime(0))})})})});l.getThreadLastMessageTs=e}),98);
__d("MAWGetThreadsInfoApi",["MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWIndexedDb").makeMsgrTransactor({threads:o("MAWTransactionMode").READONLY},"getThreadIdByDeduplicationKey",function(t){return(function(n){return o("WALogger").DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getThreadIdByDeduplicationKey ",""])),n),o("MAWDbThreadTxns").getThreadByDeduplicationKey(t,n).then(function(e){return e.success?{jid:e.value.jid}:null})})});l.getThreadIdByDeduplicationKey=s}),98);
__d("MAWGetWAIDevices",["WADevicesState","WAGlobals"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.users;await o("WAGlobals").getWaOneQueue().waitForWAInfraOfflineSyncEnd(),await o("WADevicesState").getDevicesState().waitForUserDevices(t,"getWAIDevices");var n=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var n=e.cryptoManager;return n.storage.bulkLoadIdentities(t)},{afterInit:!0,flush:!1,operationType:"maw_load_identities"}),r=[];if(n.size===0)r=[].concat(t);else for(var a of n){var i=a[0],l=a[1];l.size===0&&r.push(i)}r.length>0&&(await o("WADevicesState").getDevicesState().waitForUserDevices(r,"getWAIDevices",!0),n=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var n=e.cryptoManager;return n.storage.bulkLoadIdentities(t)},{afterInit:!0,flush:!1,operationType:"maw_load_identities"}));var s=new Map;for(var u of n){var c=u[0],d=u[1];s.set(c,Array.from(d.keys()))}return s}l.getWAIDevices=e}),98);
__d("MAWGetWATimeApi",["Promise","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(){return(e||(e=n("Promise"))).resolve({clockSkew:o("WATimeUtils").getClockSkew(),millisTime:o("WATimeUtils").millisTime(),unixTime:o("WATimeUtils").unixTime()})};l.getWATime=s}),98);
__d("MAWGetWorkerHeartbeatApi",["Promise"],(function(t,n,r,o,a,i){"use strict";var e,l=function(){return(e||(e=n("Promise"))).resolve(!0)};i.getWorkerHeartbeat=l}),66);
__d("MAWLowLevelMediaDownloadQplBridgeHandler",["MAWDownloadAndRestoreMedia"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r){var a=o("MAWDownloadAndRestoreMedia").getMediaDownloadFlow(t,r);switch(e){case"success":a.endSuccess();break;case"fail":a.endFail(n,r);break;case"point":a.addPoint(n,r);break}}l.handleBridgeMediaDownloadQPL=e}),98);
__d("MAWHandleMediaRestoreCdnUrlResult",["EncryptedBackupsResignCdnUrl","MAWLowLevelMediaDownloadQplBridgeHandler","MWFBLogger","WADirectPath","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p=o("MWFBLogger").MWMediaLogger().tags(["RestoreCdnUrlThroughSproc"]);function _(t){var n,r,a,i=(n=(r=t.value)==null?void 0:r.rawTraceId)!=null?n:(a=t.error)==null?void 0:a.rawTraceId;if(i==null){var l;p.MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRestoreCdnUrlResult: traceId is null. success: ",", error: ",""])),t.success,t.success?"":(l=t.error.errorMessage)!=null?l:"");return}var _=isNaN(parseInt(i,10))?null:parseInt(i,10);if(_==null){var g;p.MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRestoreCdnUrlResult: traceId is not a number. success: ",", error: ",""])),t.success,t.success?"":(g=t.error.errorMessage)!=null?g:"");return}var h=p.tags([i]),y=o("EncryptedBackupsResignCdnUrl").getRestoredCdnUrlResolvable(_);if(y==null){p.MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRestoreCdnUrlResult: restoredCdnUrlResolvable is null"])));return}if(!t.success){var C;h.MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRestoreCdnUrlResult request error: ",""])),(C=t.error.errorMessage)!=null?C:""),y==null||y.resolve(o("WAResultOrError").makeError("resign-cdn-url-request-error")),y==null&&f(_,t.error.errorMessage);return}var b=o("WADirectPath").validateDirectPath(t.value.rawDirectPath);if(!b.success){h.WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRestoreCdnUrlResult direct path error: ",""])),b.error),y==null||y.resolve(b);return}var v=b.value;p.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRestoreCdnUrlResult success. directPath: ",""])),v),y==null||y.resolve(o("WAResultOrError").makeResult(v))}function f(e,t){o("MAWLowLevelMediaDownloadQplBridgeHandler").handleBridgeMediaDownloadQPL("fail",e,"attachment_restore_failure",{string:{error:t!=null?t:""}})}l.handleMediaRestoreCdnUrlResult=_}),98);
__d("MAWIdentifyCollapsedMessagesByExternalId",["MAWDbMsgTxns","MAWIndexedDb","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.externalIds,n=await o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY},"identifyCollapsedMessagesByExternalId",function(e){return function(){return o("MAWDbMsgTxns").UNSAFE_getMultipleMsgsByExternalId(e,t)}})();return n.filter(function(e){return e.isCollapsed===!0}).map(function(e){return e.externalId})}l.identifyCollapsedMessagesByExternalId=e}),98);
__d("MAWIdentifyXMAWithAssociatedTextByExternalId",["MAWDbXMATxns","MAWIndexedDb","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.externalIds,n=await o("MAWIndexedDb").makeMsgrTransactor({xma:o("MAWTransactionMode").READONLY},"identifyXMAWithAssociatedTextByExternalId",function(e){return function(){return o("MAWDbXMATxns").getMultipleXMAByExternalId(e,t)}})();return n.filter(function(e){return e.associatedMessageId!=null}).map(function(e){return e.externalId})}l.identifyXMAWithAssociatedTextByExternalId=e}),98);
__d("MAWInsertAdminMessageInCutoverThreadsApi",["MAWAdminWriteCutoverThreadMsgTxn","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWIndexedDb").makeMsgrTransactor({chunk:(e=o("MAWTransactionMode")).READONLY,ftsBackloggedMessages:e.READWRITE,groupInfo:e.READONLY,media:e.READONLY,messages:e.READWRITE,threads:e.READWRITE},"insertAdminMessageInCutoverThreads",function(e){return(function(t){var n=t.openThreadId,r=t.threadJid,a=t.traceId;return o("MAWAdminWriteCutoverThreadMsgTxn").writeCutoverThreadAdminMsg(e,r,n,a).then(function(t){var n=t.needsMarkThreadAsMigrated;if(n)return o("MAWDbThreadTxns").markCutoverThreadAsMigratedLocally(e,r)}).then(function(){return!0})})});l.insertAdminMessageInCutoverThreads=s}),98);
__d("MAWLoadMediaApi",["FBLogger","LSThreadMediaGalleryGroup","MAWBridgeMsg","MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsg","MAWDexieTable","MAWIndexedDb","MAWMediaAfterTxns","MAWTransactionMode","WAHashUtils","WALogger","WATimeUtils","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=r("justknobx")._("1132"),m=o("MAWIndexedDb").makeMsgrTransactor({chunk:(c=o("MAWTransactionMode")).READONLY,media:c.READONLY,messages:c.READONLY,threads:c.READONLY},"loadMoreMedia",function(t){return(function(n){var a=n.earliestLoadedMediaMessageId,i=n.earliestLoadedMediaTs,l=n.mediaGalleryGroup,c=n.pageSize,m=n.threadJid,_=0,f=!1,g=0,h=!1,y=c!=null?c:d;return t.threads.get({jid:m}).then(function(n){if(n==null)throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Unable to load media for thread. ThreadJid "," does not exist"])),m);var r=t.messages.where(["threadJid","sortOrderMs"]).between([n.jid,o("MAWDbMsg").MIN_MSG_SORT_ORDER],[n.jid,i],!0,!0);return r.filter(function(e){return p(e,l)}).until(C).reverse().toArray()}).then(function(e){var n,i,c=e.findIndex(function(e){return e.msgId===a}),d=f?c+1:0,p=e.slice(d,d+y+1),_=h,g=p[p.length-1],C=Number.MAX_SAFE_INTEGER,b=(n=g==null?void 0:g.sortOrderMs)!=null?n:C;return o("MAWIndexedDb").afterTransaction({tag:"NewMediaRange",value:{earliestLoadedMediaTs:b,hasMoreBefore:_,lastLoadedMessageId:(i=g==null?void 0:g.msgId)!=null?i:a,mediaGalleryGroup:l,threadJid:m}},!0),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[loadMoreMedia] foundMessages: ",""])),p.map(function(e){return""+e.msgId})),o("MAWDbMediaTxns").getMsgMediaPairFromMsgs(t,p).then(function(e){return o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[loadMoreMedia] msgMediaPairs: ",""])),e.map(function(e){var t=e[0],n=e[1];return"["+t.msgId+", "+o("WAHashUtils").sanitisePlaintextHash(n.plaintextHash)+"]"})),o("MAWDexieTable").dexieAll(e.map(function(e){var n=e[0],a=e[1];return o("MAWDbChunkTxns").hasMediaChunk(t,a.hashedPlaintextHash).then(function(e){return e||r("FBLogger")("messenger_web_media").warn("loadMoreMedia cannot find chunk for mediaId: %s",a.mediaId),o("MAWMediaAfterTxns").handleNewMediaAfterTxn(n,a,e,t,!0,void 0,!0)})})).then(function(){p.forEach(function(e){o("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:o("MAWBridgeMsg").createBridgeMsg(e)},!0)})})})});function C(e){return _++,e.msgId===a?f=!0:(f||i===Number.MAX_SAFE_INTEGER)&&g++,g>y||_>y&&!f&&e.sortOrderMs!==i?(h=!0,!0):!1}})});function p(e,t){var n=o("WATimeUtils").unixTime(),a=!1;switch(t){case r("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS:a=o("MAWDbMsg").isPhotoOrVideoMediaMsg(e);break;case r("LSThreadMediaGalleryGroup").FILES_ONLY:a=o("MAWDbMsg").isDocumentFileMediaMsg(e);break;case r("LSThreadMediaGalleryGroup").LINKS:a=o("MAWDbMsg").isXMAMsg(e);break}var i=e.messageExpirationTs==null||e.messageExpirationTs>n;return a&&i}l.loadMoreMedia=m,l.filterForMediaMessages=p}),98);
__d("WAWaitPromiseUntil",["Promise"],(function(t,n,r,o,a,i){"use strict";var e;function l(t,r){var o=new(e||(e=n("Promise")))(function(e){return void setTimeout(e,r)});return e.race([t.then(function(e){return{result:e}}),o.then(function(){return"timeout"})])}i.waitPromiseUntil=l}),66);
__d("MAWLoadMoreScheduler",["FBLogger","MAWEBLSInWorkerSwitch","MAWLoadMsgsApi","MAWMessagesDirection","MawMpsCop","MpsTypes","WABaseGlobals","WALogger","WAResultOrError","WATimeUtils","WAWaitPromiseUntil","WorkerScheduler","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s=5,u=r("justknobx")._("4600"),c=r("justknobx")._("4703"),d;function m(){return d==null&&(d=o("WorkerScheduler").makeScheduler("load-more",{concurrency:10,defaultSamplingRate:1e3,maxTaskLimit:10,maxThrottleMs:0})),d}function p(e){var t=e.actionType,n=e.chatJid,r=e.config,a=e.direction,i=e.externalId,l=e.includeOriginalMsg,s=e.msgId,u=e.numMsgs,c=e.sortOrderMs;return g({actionType:t,chatJid:n,direction:a,externalId:i,loadFn:function(){return o("MAWLoadMsgsApi").loadMsgsFromTs(n,u,a,c,l,s,r)},numMsgs:u,timestamp:c})}function _(e){return o("WAWaitPromiseUntil").waitPromiseUntil(r("MAWEBLSInWorkerSwitch").waitForEBEnabled(),c).then(function(t){if(t!=="timeout")return m().runTask({customFlags:{runtimeReliability:!0},fn:async function(){await C(e.actionType,e.config.map(function(e){var t=e.chatJid,n=e.direction,r=e.lowerBoundExternalId,a=e.lowerBoundSortOrderMs,i=e.numMsgs;return{chatJid:t,direction:n,messageId:r!=null?o("MpsTypes").toMessageId(r):null,numMsgs:i,timestamp:o("MpsTypes").toTimestamp((a!=null?a:o("WABaseGlobals").newClockSkewCalculation())?o("WATimeUtils").unixTimeMs():Date.now())}}))},name:"loadMessagesByChatJids",priority:o("WorkerScheduler").BLOCKING_PRIORITY})})}function f(e){var t=e.chatJid,n=e.config,r=e.direction,a=e.range;return g({actionType:e.actionType,chatJid:t,direction:r,externalId:a.lowerBoundExternalId,loadFn:function(){return o("MAWLoadMsgsApi").loadMsgsRange(t,n,r,a)},numMsgs:a.numMsgs,timestamp:a.lowerBoundSortOrderMs})}function g(t){return m().runTask({customFlags:{runtimeReliability:!0},fn:function(){try{var n;return b(t.actionType,t.chatJid,t.direction,t.numMsgs,o("MpsTypes").toTimestamp((n=t.timestamp)!=null?n:Date.now()),t.externalId!=null?o("MpsTypes").toMessageId(t.externalId):null,t.loadFn)}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs from COP fails: ",""])),t)}return t.loadFn()},name:"maw_load_msgs",priority:o("WorkerScheduler").BLOCKING_PRIORITY})}function h(e){return e.hasNext===!0&&e.endCursor!=null?{cursor:e.endCursor,hasMore:!0}:{hasMore:!1}}function y(e,t,n){switch(t){case"before":{var r=n.msgs[n.msgs.length-1];return r.sortOrderMs>=e[0]}case"after":{var o=n.msgs[0];return o.sortOrderMs<=e[0]}}}async function C(e,t){await o("MawMpsCop").mpsCop().loadBatchMsgsIntoMaw({debug:{purpose:"cop-load-batch-"+(e!=null?e:"")},ranges:t.map(function(e){var t=e.chatJid,n=e.direction,r=e.messageId,a=e.numMsgs,i=e.timestamp;return{direction:o("MAWMessagesDirection").translateMawDirectionToMwpDirection(n),from:[i,r],numMessages:a+u,threadId:o("MpsTypes").toThreadId(t)}})})}async function b(e,t,n,a,i,l,c){var d=r("FBLogger")("mps").tags(["MAW","loadMore"]);if(a===0)return c();for(var m=[i,l],p=0;p<s;p++){p>1&&r("FBLogger")("mps").warn("MAW MPS Iteration %s Direction %s",p,n);var _=await o("MawMpsCop").mpsCop().loadMoreMsgsIntoMaw({debug:{purpose:"cop-load-more-"+(e!=null?e:"")},direction:o("MAWMessagesDirection").translateMawDirectionToMwpDirection(n),from:m,numMessages:a+u,threadId:o("MpsTypes").toThreadId(t)}).catch(function(e){return d.catching(e).mustfix("Failed to load more messages from MPS"),o("WAResultOrError").makeError("runtime-error")});if(_.success===!1){d.warn("MPS Failed with result: %s",_.error);break}var f=h(_.value.cursorInfo),g=await c();if(f.hasMore===!1)return g;if(m=f.cursor,!(g.msgs.length<a)&&y(f.cursor,n,g)!==!1)return g}return d.warn("Returning best-effort loadMessages from MAW"),c()}l.loadMoreScheduler=m,l.loadMoreMessages=p,l.loadMessagesByChatJidsIntoMaw=_,l.loadMoreMsgsRange=f}),98);
__d("MAWMarkBackupAsCompleted",["EncryptedBackupsUploadQueue"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.queueId,n=o("EncryptedBackupsUploadQueue").ebUploadQueue();return n.ack([t])}l.markBackupAsCompleted=e}),98);
__d("MAWMarkThreadAsUnreadApi",["MAWDbMsgTxns","MAWIndexedDb","MAWThreadUtils","MAWTimeUtils","MAWTransactionMode","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY,threads:o("MAWTransactionMode").READWRITE},"markThreadAsUnread",function(e){return(function(t){return e.threads.get({jid:t}).then(function(n){if(n!=null)return o("MAWDbMsgTxns").getThreadNewestMessageMs(e,n.jid).then(function(n){var r=o("MAWTimeUtils").ensureValidMillisTime(n),a=o("WATimeUtils").castToMillisTime(0);if(!(r==null||n===a)){var i={lastReadMsg:null};return o("MAWThreadUtils").updateThreadWithJid(e,t,i).then(function(){})}})})})});l.markThreadAsUnread=e}),98);
__d("MAWMessageIntegrityDebugInfoFromWorker",["MAWEBInitRestoreLogging"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){return Promise.resolve({initRestore:await o("MAWEBInitRestoreLogging").getInitRestoreDebugInfo()})}l.getWorkerBasedMessageIntegrityDebugInfo=e}),98);
__d("MAWMediaSizeCheck",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e>100*1024}i.isMinSizeForImagePreviewGeneration=e}),66);
__d("MAWOptimisticUploadMedia",["MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWMediaSizeCheck","MAWMediaUtils","MAWOptimisticUploadManager","MAWUploadAndHandleMedia","MWFBLogger","WABlobToArrayBuffer","WAHashUtils","WAMediaCrypto","WAResultOrError","WAStartMediaUploadQplFlow"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h=o("MWFBLogger").MWMediaLogger().tags(["OptimisticUploadMedia"]);async function y(t,n,r){h.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["start uploading type: ",""])),String(r));var a=await o("MAWMediaUtils").hashBlob(t),i=o("WAHashUtils").toPlaintextHash(a),l=o("MAWOptimisticUploadManager").getOptimisticUploadManager(),s=l.get(i);if(s!=null)return o("WAResultOrError").makeError("already_uploading");var u=r.type==="regular"?r.mediaType:"preview",c=await o("WAStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:n,fileSize:t.size,serverMediaType:u,uploadEntry:"optimisticUploadMedia"}),d=o("MAWUploadAndHandleMedia").uploadAndHandleMedia({chatJid:n,dbCallbacks:{getDownloadableThumbnailForMedia:o("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia},filename:u==="document"?t.name:void 0,hash:i,mediaTypeDetails:r,plaintext:await o("WABlobToArrayBuffer").blobToArrayBuffer(t),protocolMsgId:null,serverMediaType:u,size:t.size,uploadMediaMetric:c});return o("WAResultOrError").makeResult({plaintextHash:i,uploadPromise:d})}async function C(e){var t=e.file,n=e.jid,r=e.thumbnail,a=o("MAWOptimisticUploadManager").getOptimisticUploadManager(),i=o("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(t.type),l=i.serverMediaType;h.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["file uploading"])));var g=await y(t,n,{mediaType:l,type:"regular"});g.success===!0?(h.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["fileUploadResult success"]))),a.set(g.value.plaintextHash,{file:t,optimisticUploadPromise:g.value.uploadPromise,previewPlaintextHash:null})):(g.error,h.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["File is already being uploaded"]))));var C=null;h.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["thumbnail_exists: ",""])),r!=null);var v=new Uint8Array(await o("WABlobToArrayBuffer").blobToArrayBuffer(t));if(r&&b(l,t.size,v)){h.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["preview uploading"])));var S=o("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(l);if(S==null){h.MUSTFIX(p||(p=babelHelpers.taggedTemplateLiteralLoose(["unsupported preview media type ",""])),l);return}var R=await y(r,n,{messageType:S,type:"preview"});R.success===!0&&(h.DEBUG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["previewUploadResult success"]))),C=R.value.plaintextHash,a.set(R.value.plaintextHash,{file:r,optimisticUploadPromise:R.value.uploadPromise}),g.success===!0&&(h.DEBUG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["fileUploadResult success, setting with previewPlaintextHash"]))),a.set(g.value.plaintextHash,{file:t,optimisticUploadPromise:g.value.uploadPromise,previewPlaintextHash:C})))}}function b(e,t,n){switch(e){case"gif":return!1;case"image":return v(t,n);case"video":return!0;default:return h.DEBUG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Skipping preview upload for media type ",""])),e),!1}}function v(e,t){return o("MAWMediaSizeCheck").isMinSizeForImagePreviewGeneration(e),!1}l.optimisticUploadMedia=C,l.shouldUploadPreview=b}),98);
__d("MAWMessageComposingHooks",["MWFBLogger","Promise","WAJids","WAQueryGroupsAndSync"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("MWFBLogger").MWLogger().tags(["MAWMessageComposingHooks"]);function d(e,t){p(e).catch(function(e){c.catching(e).mustfix("Caught while calling maybeGetGroupInfoAheadOfGroupMessageSend hook for chat state composer.")})}var m=new Set;function p(t){return o("WAJids").switchOnMsgrChatJidType(t,{group:function(r){return m.has(r)?(u||(u=n("Promise"))).resolve():(c.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Querying group info ahead of group message send: ",""])),r),m.add(r),o("WAQueryGroupsAndSync").queryGroupsAndSync({groupJids:[r]}).catch(function(e){c.catching(e).MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to query groups"])))}))},user:function(){return(u||(u=n("Promise"))).resolve()}})}l.callMessageComposingHooks=d}),98);
__d("WASmaxOutChatstateInternalTestMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.testConfig,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("test",{config:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeInternalTestMixin=s}),98);
__d("WASmaxOutChatstateComposingMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.hasComposingMediaAudio,n=o("WASmaxJsx").smax("chatstate",null,o("WASmaxJsx").smax("composing",{media:o("WASmaxAttrs").OPTIONAL_LITERAL("audio",t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeComposingMixin=s}),98);
__d("WASmaxOutChatstatePausedMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("chatstate",null,o("WASmaxJsx").smax("paused",null));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergePausedMixin=s}),98);
__d("WASmaxOutChatstateStateTypes",["WASmaxMixinGroupExhaustiveError","WASmaxOutChatstateComposingMixin","WASmaxOutChatstatePausedMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.composing)return o("WASmaxOutChatstateComposingMixin").mergeComposingMixin(e,t.composing);if(t.isPaused)return o("WASmaxOutChatstatePausedMixin").mergePausedMixin(e);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeStateTypes=e}),98);
__d("WASmaxOutChatstateClientNotificationRequest",["WASmaxJsx","WASmaxMixins","WASmaxOutChatstateInternalTestMixin","WASmaxOutChatstateStateTypes","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.chatstateTo,n=e.internalTestMixinArgs,r=e.stateTypesArgs,a=o("WASmaxOutChatstateStateTypes").mergeStateTypes(o("WASmaxMixins").optionalMerge(o("WASmaxOutChatstateInternalTestMixin").mergeInternalTestMixin,o("WASmaxJsx").smax("chatstate",{to:o("WAWap").JID(t)}),n),r);return a}l.makeClientNotificationRequest=e}),98);
__d("WASmaxChatstateClientNotificationRPC",["WAComms","WASmaxOutChatstateClientNotificationRequest"],(function(t,n,r,o,a,i,l){async function e(e){var t=o("WASmaxOutChatstateClientNotificationRequest").makeClientNotificationRequest(e);await o("WAComms").castSmaxStanza(t)}l.sendClientNotificationRPC=e}),98);
__d("WASendChatStateProtocol",["WALogger","WASmaxChatstateClientNotificationRPC"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendChatStateProtocol Sending "," to ",""])),n,t);var r;return n==="idle"?r={isPaused:!0}:r={composing:{hasComposingMediaAudio:n==="recording_audio"}},o("WASmaxChatstateClientNotificationRPC").sendClientNotificationRPC({chatstateTo:t,stateTypesArgs:r})}l.sendChatStateProtocol=s}),98);
__d("MAWSendChatStateFromComposerApi",["FBLogger","MAWMessageComposingHooks","Promise","WASendChatStateProtocol"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a){var t=a.chatJid,i=a.state;return o("WASendChatStateProtocol").sendChatStateProtocol(t,i).catch(function(e){return r("FBLogger")(e).mustfix("Caught while sending chat state from composer.")}),o("MAWMessageComposingHooks").callMessageComposingHooks(t,i),(e||(e=n("Promise"))).resolve()};l.sendChatStateFromComposer=s}),98);
__d("MAWWritePollApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteGroupPollCreateTxns","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({participants:o("MAWTransactionMode").READONLY,poll:o("MAWTransactionMode").READWRITE},"writePoll",function(e){return function(t,n,r,a,i){return o("MAWWriteGroupPollCreateTxns").savePollToDb(e,r,a,o("WAJids").AUTHOR_ME,i).then(function(e){o("MAWWriteGroupPollCreateTxns").sendPollToUI(e,t,n)})}});l.writePoll=e}),98);
__d("MAWSendPoll",["MAWGroupPollsDualEncryptionUtils","MAWMessageSendsCommon","MAWMsgType","MAWWriteOutgoingMsgApi","MAWWritePollApi","WAJids","WAResultOrError","WATimeUtils","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=0;async function s(t){var n=t.args,a=t.chatJid,i=t.externalId,l=t.qplInstanceKey,s=t.ts,u=n.options,c=n.title,d=await Promise.all(u.map(async function(e){var t=await o("MAWGroupPollsDualEncryptionUtils").getHashForOptionName(e);return{optionHash:t,optionText:e}})),m=new Map(d.map(function(e){var t=e.optionHash,n=e.optionText;return[t,{optionText:n,voteAuthors:new Set}]})),p=self.crypto.getRandomValues(new Uint8Array(32)).buffer,_=await o("MAWWriteOutgoingMsgApi").writeOutgoingMsg(i,a,s,n,o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE,r("qpl")._(25313175,"1551"),l);if(_.type==="missing_thread")return o("WAResultOrError").makeError({isRetriable:!1,type:"missing-thread"});if(_.type==="already_sent")return o("WAResultOrError").makeError({isRetriable:!1,type:"already-sent"});var f=_.msgId,g={encKey:p,latestSenderTimestampsMs:new Map,name:c,options:u,optionsHashed:m,selectableOptionsCount:e};return await o("MAWWritePollApi").writePoll(f,o("WATimeUtils").castUnixTimeToMillisTime(s),a,g,i),o("WAResultOrError").makeResult({chatJid:a,externalId:i,messageType:"sendPoll"})}function u(e){var t=e.args,n=e.chatJid,a=e.externalId,i=e.qplInstanceKey;return o("MAWMessageSendsCommon").messageSendObserver(r("qpl")._(25313175,"1551"),i,function(e){return s({args:t,chatJid:n,externalId:a,qplInstanceKey:i,ts:e})},"poll",{author:o("WAJids").AUTHOR_ME,chat:n,externalId:a})}l.sendPoll=u}),98);
__d("MAWSendPollUpdate",["Promise","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return(e||(e=n("Promise"))).resolve(o("WAResultOrError").makeResult({description:"sendPollUpdate",messageType:"fixMe"}))}l.sendPollUpdate=s}),98);
__d("MAWWorkerPersistedDataService",["FBLogger","MAWBridge","MAWCacheServiceUtils"],(function(t,n,r,o,a,i,l){"use strict";var e="maw_persisted_data_service_broadcast",s=function(){return o("MAWCacheServiceUtils").globalScope.BroadcastChannel?new(o("MAWCacheServiceUtils")).globalScope.BroadcastChannel(e):(r("FBLogger")("messenger_e2ee_web").warn("BroadcastChannel is not supported in this browser"),null)},u=(function(){function t(){this.$1=s()}var n=t.prototype;return n.emitBroadcastChannelMessageToUI=function(n,r,a,i){var t={cache:r,instanceKey:i,namespace:n,source:a};this.$1==null?o("MAWBridge").getBridge().fireAndForget("event","broadcastChannelFallback",{event:{data:t},namespace:e}):this.$1.postMessage(t)},t})(),c=null,d=function(){return c==null&&(c=new u),c};l.MAW_PERSISTED_DATA_SERVICE_BROADCAST_CHANNEL=e,l.getMAWPersistedDataServiceBroadcastChannel=s,l.getMAWWorkerPersistedDataService=d}),98);
__d("MAWSendUpdateFromUIPersistedDataServiceApi",["MAWWorkerPersistedDataService"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){var e=t.cache,n=t.instanceKey,r=t.namespace,a=t.source;o("MAWWorkerPersistedDataService").getMAWWorkerPersistedDataService().emitBroadcastChannelMessageToUI(r,e,a,n)};l.sendUpdateFromUIPersistedDataService=e}),98);
__d("MAWSetEphemeralSettingsFromFrontendApi",["FBLogger","MAWEphemeralSettingsTxns","MAWExternalId","MAWIndexedDb","MAWSendEphemeralSettingMsg","MAWTransactionMode","Promise","WAResultOrError","WATimeUtils","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("MAWIndexedDb").makeMsgrTransactor({chunk:(s=o("MAWTransactionMode")).READONLY,ephemeralSettings:s.READWRITE,groupInfo:s.READONLY,media:s.READONLY,messages:s.READWRITE,threads:s.READWRITE},"handleAndWriteOutgoingUserEphemeralSettingChange",function(e){return(function(t,n,r,a){return o("MAWEphemeralSettingsTxns").handleAndWriteOutgoingUserEphemeralSettingChange(e,t,n,r,a)})}),c=function(a){var t=a.chatJid,i=a.ephemeralExpirationInSec,l=a.ephemeralLastUpdatedOrSetTimestamp,s=a.isEphemeralSettingReset,c=a.s2sInstanceKey;if(t==null)return r("FBLogger")("messenger_web").mustfix("Both chatJid and threadId passed to setEphemeralSettingsFromFrontend are null"),(e||(e=n("Promise"))).resolve(o("WAResultOrError").makeError({isRetriable:!1,type:"missing-thread"}));var d=l!=null?l:o("WATimeUtils").unixTime();return u(t,i,d,s).then(function(e){if(e.value.shouldUpdateSetting===!1)return o("WAResultOrError").makeResult({description:"send not needed",messageType:"fixMe"});var n={ephemeralExpirationInSec:i,ephemeralLastUpdatedOrSetTimestamp:d};return o("MAWSendEphemeralSettingMsg").sendEphemeralSettingMsgFn({args:{ephemeralSetting:n,isEphemeralSettingReset:s,isForSyncResponse:!1},chatJid:t,externalId:o("MAWExternalId").generateExternalId(),qplEventType:r("qpl")._(25313175,"1551"),qplInstanceKey:c})})};l.setEphemeralSettingsFromFrontend=c}),98);
__d("MAWSetEphemeralSettingsOfPeerFromMIApi",["MAWDbGroupInfoTxns","MAWDexieTable","MAWEphemeralSettingsTxns","MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWTransactionMode","WAJids","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWIndexedDb").makeMsgrTransactor({ephemeralSettings:(e=o("MAWTransactionMode")).READWRITE,groupInfo:e.READWRITE,messages:e.READWRITE,threads:e.READWRITE},"handleAndWriteIncomingEphemeralSetting",function(e){return(function(t,n,r,a,i,l,s){var u=o("WAJids").interpretAsGroupJid(n),c=o("MAWDexieTable").dexieAll([o("MAWGetOrCreateThreadTxns").getExistingThread(e,n),u!=null?o("MAWDbGroupInfoTxns").getGroupInfo(e,u):o("MAWDexieTable").dexieResolve()]);return c.then(function(t){var r,a=t[0],i=t[1];if(a!=null)return{created:!1,thread:a};var l=i==null||(r=i.value)==null?void 0:r.creationTs;return o("MAWGetOrCreateThreadTxns").getOrCreateThread(e,{createTs:l==null?null:o("WATimeUtils").castUnixTimeToMillisTime(l),description:"handleAndWriteIncomingEphemeralSetting",jid:n})}).then(function(n){var u=n.thread;return o("MAWEphemeralSettingsTxns").handleAndWriteIncomingEphemeralSetting(e,t,r,a,i,u,s,null,l)})})}),u=function(t){var e=t.author,n=t.chatJid,r=t.ephemeralExpirationInSec,o=t.ephemeralLastUpdatedOrSetTimestamp,a=t.fromWAI,i=t.isEphemeralSettingReset,l=t.serverTs;return s(e,n,r,o,i,a,l).then(function(){return{success:!0}})};l.setEphemeralSettingsFromMI=u}),98);
__d("MAWUpdateDeviceChangeAlertsApi",["MAWDbGetUnArchivedDeviceChangeAlertsCountTxn","MAWDbUpdateDeviceChangeAlertsTxn","MAWIndexedDb","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({deviceChangeAlerts:o("MAWTransactionMode").READWRITE},"updateDeviceChangeAlerts",function(e){return(function(t){return o("MAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn(e,t).then(function(t){return o("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(e).then(function(){return t})})})});l.updateDeviceChangeAlerts=e}),98);
__d("MAWUpdateLSThreadFromGroupInfoApi",["MAWBridgeTypesCreators","MAWIndexedDb","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({groupInfo:o("MAWTransactionMode").READONLY},"updateLSThreadFromGroupInfo",function(e){return(function(t){return e.groupInfo.get(t).then(function(e){e!=null&&o("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:o("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(e)})})})});l.updateLSThreadFromGroupInfo=e}),98);
__d("MAWGetMediaByObjectId",["MAWDbMediaTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAMediaUtils","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({media:o("MAWTransactionMode").READONLY,mediaBackup:o("MAWTransactionMode").READONLY},"getMediaByObjectId",function(e){return function(t){return o("MAWDbMediaTxns").maybeGetMediaFromObjectId(e,o("WAMediaUtils").stringToDeliveryObjectId(t)).then(function(e){return e?o("WAResultOrError").makeResult(e):o("WAResultOrError").makeError("media-not-found")})}}),s=o("MAWIndexedDb").makeMsgrTransactor({mediaBackup:o("MAWTransactionMode").READONLY},"getMediaBackupByObjectId",function(e){return function(t){return o("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId(e,o("WAMediaUtils").stringToDeliveryObjectId(t)).then(function(e){return e?o("WAResultOrError").makeResult(e):o("WAResultOrError").makeError("mediaBackup-not-found")})}}),u=function(t){return o("MAWIndexedDb").makeMsgrTransactor({media:o("MAWTransactionMode").READONLY},"getMediaByMessageId",function(e){return function(){return t==null?o("MAWDexieTable").dexieResolve(o("WAResultOrError").makeError("media-not-found")):o("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(e,t).then(function(e){return e?o("WAResultOrError").makeResult(e):o("WAResultOrError").makeError("media-not-found")})}})()};l.getMediaByObjectId=e,l.getMediaBackupByObjectId=s,l.getMediaByHash=u}),98);
__d("MAWUpdateMediaDownloadStatusByObjectIdApi",["MAWGetMediaByObjectId","MAWMediaDownloadStatusForUI","MWFBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s=async function(n,r,a){var t=await o("MAWGetMediaByObjectId").getMediaByObjectId(n),i=t.value;if(i==null||t.success!==!0){o("MWFBLogger").MWMediaLogger().tags(["MediaDownload"]).WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["updateMediaDownloadStatusByObjectId - media not found for objectId: ",""])),n);return}o("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:a,hash:i.plaintextHash,status:r,type:"main"})};l.updateMediaDownloadStatusByObjectId=s}),98);
__d("MAWUpdateReceiverFetchInfoApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteReceiverFetchTxns"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({receiverFetchInfo:o("MAWTransactionMode").READWRITE},"MAWUpdateReceiverFetchInfo",function(e){return(function(t){var n=t.accessibilitySummaryText,r=t.mimetype,a=t.previewHeight,i=t.previewUrl,l=t.previewUrlExpirationTimestampMs,s=t.previewWidth,u=t.receiverFetchId,c=t.type;return o("MAWWriteReceiverFetchTxns").updateReceiverFetchInfoWithPreviewUrl(e,i,l,u,n,r,a,s,c)})});l.updateReceiverFetchInfo=e}),98);
__d("mawAdminWriteDualThreadCutoverMsgTxns",["MAWDbThreadTxns","MAWExternalId","MAWLocalizationUtils","MAWWriteMsgTxns","WALogger","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,r,a,i){return o("MAWDbThreadTxns").getThread(t,n).then(function(n){if(!n.success)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["dualThreadCutover failed to get the thread"]))),{needsMarkThreadAsMigrated:!1};var l=n.value;if(l.didInsertDualThreadCutoverAdminMsg===!0)return{needsMarkThreadAsMigrated:!1};var s=o("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:i!=null?[i]:[],adminType:a,version:1},l.jid,o("MAWExternalId").generateExternalId(),o("WATimeUtils").castMillisTimeToUnixTime(r)),u=babelHelpers.extends({},l,{didInsertDualThreadCutoverAdminMsg:!0});return t.threads.put(u).then(function(){return o("MAWWriteMsgTxns").writeMsg(t,s,u).then(function(){return{needsMarkThreadAsMigrated:!0}})})})}l.default=s}),98);
__d("MAWWriteAdminMessageForDualThreadCutoverApi",["MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","mawAdminWriteDualThreadCutoverMsgTxns"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWIndexedDb").makeMsgrTransactor({chunk:(e=o("MAWTransactionMode")).READONLY,ftsBackloggedMessages:e.READWRITE,groupInfo:e.READONLY,media:e.READONLY,messages:e.READWRITE,threads:e.READWRITE},"writeAdminMessageForDualThreadCutover",function(e){return(function(t){var n=t.chatJid,a=t.cutoverTimestampMs,i=t.localizationType,l=t.otherUserID;return r("mawAdminWriteDualThreadCutoverMsgTxns")(e,n,a,i,l).then(function(t){var r=t.needsMarkThreadAsMigrated;if(r)return o("MAWDbThreadTxns").markCutoverThreadAsMigratedLocally(e,n)})})});l.writeAdminMessageForDualThreadCutover=s}),98);
__d("MAWWriteAdminMessageForEphemeralSettingsChange",["MAWDbGroupInfoTxns","MAWDexieTable","MAWEphemeralAdminMsgBuildTxns","MAWGetOrCreateThreadTxns","MAWHIMLogger","MAWIndexedDb","MAWTransactionMode","WAJids","WAResultOrError","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=6*o("WATimeUtils").HOUR_SECONDS,c=o("MAWIndexedDb").makeMsgrTransactor({chunk:(s=o("MAWTransactionMode")).READONLY,ephemeralSettings:s.READWRITE,ftsBackloggedMessages:s.READWRITE,groupInfo:s.READWRITE,groupInvites:s.READONLY,media:s.READONLY,messages:s.READWRITE,reactions:s.READONLY,threads:s.READWRITE,xma:s.READONLY},"writeAdminMessageForEphemeralSettingsChange",function(t){return(function(n){var a=n.author,i=n.chatJid,l=n.expirationInSec,s=n.externalId,u=n.isEphemeralSettingReset,c=n.isTurningOnEphemeralSetting,d=n.serverTs,m=o("WAJids").interpretAsGroupJid(i),p=o("MAWDexieTable").dexieAll([o("MAWGetOrCreateThreadTxns").getExistingThread(t,i),m!=null?o("MAWDbGroupInfoTxns").getGroupInfo(t,m):o("MAWDexieTable").dexieResolve()]);return p.then(function(e){var n,r=e[0],a=e[1];if(r!=null)return{created:!1,thread:r};var l=a==null||(n=a.value)==null?void 0:n.creationTs;return o("MAWGetOrCreateThreadTxns").getOrCreateThread(t,{createTs:l==null?null:o("WATimeUtils").castUnixTimeToMillisTime(l),description:"writeAdminMessageForEphemeralSettingsChange",jid:i})}).then(function(n){var i=n==null?void 0:n.thread;return i==null?(r("MAWHIMLogger").MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Cannot create a thread for message after missing thread creation attempt"]))),o("WAResultOrError").makeError({type:"no_thread"})):o("MAWEphemeralAdminMsgBuildTxns").writeEphemeralSettingAdminMsg(t,a,l,d,i,c,u,s)}).then(r("emptyFunction"))})});l.REVOKE_CONTENT_EXPIRATION_IN_SEC=u,l.writeAdminMessageForEphemeralSettingsChange=c}),98);
__d("MAWWriteLimitSharingAdminMsgTxns",["MAWLocalizationUtils","MAWWriteLimitSharingAdminMsgContent","MAWWriteMsgTxns","WATimeUtils","emptyFunction","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a,i,l){return e.threads.get({jid:n}).then(function(n){if(n==null)throw r("err")("Invalid chat Id when try to write admin message for limit sharing");var s=o("MAWLocalizationUtils").buildUnstoredDbAdminMsg(o("MAWWriteLimitSharingAdminMsgContent").getAdminMsgContent(t,i),n.jid,a,o("WATimeUtils").castMillisTimeToUnixTime(l),void 0,l);return o("MAWWriteMsgTxns").writeDedupedAdminMessage(e,s,n,l).then(r("emptyFunction"))})}l.writeLimitSharingAdminMsg=e}),98);
__d("MAWWriteAdminMessageForLimitSharingApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteLimitSharingAdminMsgTxns"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWIndexedDb").makeMsgrTransactor({chunk:(e=o("MAWTransactionMode")).READONLY,ftsBackloggedMessages:e.READWRITE,groupInfo:e.READONLY,media:e.READONLY,messages:e.READWRITE,threads:e.READWRITE},"MAWWriteAdminMessageForLimitSharing",function(e){return(function(t){var n=t.actorFbid,r=t.chatJid,a=t.externalId,i=t.isLimitSharingEnabled,l=t.serverAuthoritativeTimestampMs;return o("MAWWriteLimitSharingAdminMsgTxns").writeLimitSharingAdminMsg(e,n,r,a,i,l)})});l.writeAdminMessageForLimitSharing=s}),98);
__d("MAWWritePinMessageAdminMsgTxns",["FBLogger","MAWLocalizationUtils","MAWWriteMsgTxns","MAWWritePinMessageAdminMsgContent","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a,i){return e.threads.get({jid:n}).then(function(n){if(n==null)throw r("FBLogger")("messenger_web").mustfixThrow("Invalid chat Id when try to write admin message for pin message");var l=o("MAWLocalizationUtils").buildUnstoredDbAdminMsg(o("MAWWritePinMessageAdminMsgContent").getAdminMsgContent(t),n.jid,a,o("WATimeUtils").castMillisTimeToUnixTime(i),void 0,i);return o("MAWWriteMsgTxns").writeDedupedAdminMessage(e,l,n,i).then(r("emptyFunction"))})}l.writePinMessageAdminMsg=e}),98);
__d("MAWWriteAdminMessageForPinMessageApi",["MAWIndexedDb","MAWTransactionMode","MAWWritePinMessageAdminMsgTxns"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWIndexedDb").makeMsgrTransactor({chunk:(e=o("MAWTransactionMode")).READONLY,ftsBackloggedMessages:e.READWRITE,groupInfo:e.READONLY,media:e.READONLY,messages:e.READWRITE,threads:e.READWRITE},"MAWWriteAdminMessageForPinMessage",function(e){return(function(t){var n=t.actorFbid,r=t.chatJid,a=t.externalId,i=t.serverAuthoritativeTimestampMs;return o("MAWWritePinMessageAdminMsgTxns").writePinMessageAdminMsg(e,n,r,a,i)})});l.writeAdminMessageForPinMessage=s}),98);
__d("MAWWriteThreadHotlikeCustomizationAdminMsgTxns",["FBLogger","MAWLocalizationUtils","MAWWriteMsgTxns","MAWWriteThreadHotlikeCustomizationAdminMsgContent","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a,i,l){return e.threads.get({jid:a}).then(function(a){if(a==null)throw r("FBLogger")("messenger_web").mustfixThrow("Invalid chat Id when try to write admin message for thread hotlike customization");var s=o("MAWLocalizationUtils").buildUnstoredDbAdminMsg(o("MAWWriteThreadHotlikeCustomizationAdminMsgContent").getAdminMsgContent(t,n),a.jid,i,o("WATimeUtils").castMillisTimeToUnixTime(l),void 0,l);return o("MAWWriteMsgTxns").writeDedupedAdminMessage(e,s,a,l).then(r("emptyFunction"))})}l.writeThreadHotlikeCustomizationAdminMsg=e}),98);
__d("MAWWriteAdminMessageForThreadHotlikeCustomizationApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteThreadHotlikeCustomizationAdminMsgTxns"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWIndexedDb").makeMsgrTransactor({chunk:(e=o("MAWTransactionMode")).READONLY,ftsBackloggedMessages:e.READWRITE,groupInfo:e.READONLY,media:e.READONLY,messages:e.READWRITE,threads:e.READWRITE},"writeAdminMessageForThreadHotlikeCustomization",function(e){return(function(t){var n=t.actorFbid,r=t.chatJid,a=t.externalId,i=t.serverAuthoritativeTimestampMs,l=t.threadIcon;return o("MAWWriteThreadHotlikeCustomizationAdminMsgTxns").writeThreadHotlikeCustomizationAdminMsg(e,n,l,r,a,i)})});l.writeAdminMessageForThreadHotlikeCustomization=s}),98);
__d("MAWWriteThreadNicknameCustomizationAdminMsgTxns",["FBLogger","MAWLocalizationUtils","MAWWriteMsgTxns","MAWWriteThreadNicknameCustomizationAdminMsgContent","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a,i,l,s){return e.threads.get({jid:n}).then(function(n){if(n==null)throw r("FBLogger")("messenger_web").mustfixThrow("Invalid chat Id when try to write admin message for thread nickname customization");var u=o("MAWLocalizationUtils").buildUnstoredDbAdminMsg(o("MAWWriteThreadNicknameCustomizationAdminMsgContent").getAdminMsgContent(t,i,a),n.jid,l,o("WATimeUtils").castMillisTimeToUnixTime(s),void 0,s);return o("MAWWriteMsgTxns").writeDedupedAdminMessage(e,u,n,s).then(r("emptyFunction"))})}l.writeThreadNicknameCustomizationAdminMsg=e}),98);
__d("MAWWriteAdminMessageForThreadNicknameCustomizationApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteThreadNicknameCustomizationAdminMsgTxns"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWIndexedDb").makeMsgrTransactor({chunk:(e=o("MAWTransactionMode")).READONLY,ftsBackloggedMessages:e.READWRITE,groupInfo:e.READONLY,media:e.READONLY,messages:e.READWRITE,threads:e.READWRITE},"writeAdminMessageForThreadNicknameCustomization",function(e){return(function(t){var n=t.actorFbid,r=t.chatJid,a=t.externalId,i=t.nickName,l=t.participantId,s=t.serverAuthoritativeTimestampMs;return o("MAWWriteThreadNicknameCustomizationAdminMsgTxns").writeThreadNicknameCustomizationAdminMsg(e,n,r,i,l,a,s)})});l.writeAdminMessageForThreadNicknameCustomization=s}),98);
__d("MAWWriteThreadPhotoCustomizationAdminMsgTxns",["FBLogger","MAWLocalizationUtils","MAWWriteMsgTxns","MAWWriteThreadPhotoCustomizationAdminMsgContent","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a,i){return e.threads.get({jid:n}).then(function(n){if(n==null)throw r("FBLogger")("messenger_web").mustfixThrow("Invalid chat Id when try to write admin message for thread photo customization");var l=o("MAWLocalizationUtils").buildUnstoredDbAdminMsg(o("MAWWriteThreadPhotoCustomizationAdminMsgContent").getAdminMsgContent(t),n.jid,a,o("WATimeUtils").castMillisTimeToUnixTime(i),void 0,i);return o("MAWWriteMsgTxns").writeDedupedAdminMessage(e,l,n,i).then(r("emptyFunction"))})}l.writeThreadPhotoCustomizationAdminMsg=e}),98);
__d("MAWWriteAdminMessageForThreadPhotoCustomizationApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteThreadPhotoCustomizationAdminMsgTxns"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWIndexedDb").makeMsgrTransactor({chunk:(e=o("MAWTransactionMode")).READONLY,ftsBackloggedMessages:e.READWRITE,groupInfo:e.READONLY,media:e.READONLY,messages:e.READWRITE,threads:e.READWRITE},"writeAdminMessageForThreadPhotoCustomization",function(e){return(function(t){var n=t.actorFbid,r=t.chatJid,a=t.externalId,i=t.serverAuthoritativeTimestampMs;return o("MAWWriteThreadPhotoCustomizationAdminMsgTxns").writeThreadPhotoCustomizationAdminMsg(e,n,r,a,i)})});l.writeAdminMessageForThreadPhotoCustomization=s}),98);
__d("MAWWriteThreadThemeCustomizationAdminMsgTxns",["FBLogger","MAWLocalizationUtils","MAWWriteMsgTxns","MAWWriteThreadThemeCustomizationAdminMsgContent","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a,i,l,s,u){return e.threads.get({jid:i}).then(function(i){if(i==null)throw r("FBLogger")("messenger_web").mustfixThrow("Invalid chat Id when try to write admin message for thread theme customization");var c=o("MAWLocalizationUtils").buildUnstoredDbAdminMsg(o("MAWWriteThreadThemeCustomizationAdminMsgContent").getAdminMsgContent(t,n,a,u),i.jid,l,o("WATimeUtils").castMillisTimeToUnixTime(s),void 0,s);return o("MAWWriteMsgTxns").writeDedupedAdminMessage(e,c,i,s).then(r("emptyFunction"))})}l.writeThreadThemeCustomizationAdminMsg=e}),98);
__d("MAWWriteAdminMessageForThreadThemeCustomizationApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteThreadThemeCustomizationAdminMsgTxns"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWIndexedDb").makeMsgrTransactor({chunk:(e=o("MAWTransactionMode")).READONLY,ftsBackloggedMessages:e.READWRITE,groupInfo:e.READONLY,media:e.READONLY,messages:e.READWRITE,threads:e.READWRITE},"writeAdminMessageForThreadThemeCustomization",function(e){return(function(t){var n=t.actorFbid,r=t.chatJid,a=t.externalId,i=t.serverAuthoritativeTimestampMs,l=t.themeEmoji,s=t.themeNameWithSubtitle,u=t.themeType;return o("MAWWriteThreadThemeCustomizationAdminMsgTxns").writeThreadThemeCustomizationAdminMsg(e,n,l,s,r,a,i,u)})});l.writeAdminMessageForThreadThemeCustomization=s}),98);
__d("MAWWriteUKOSAAdminMsgTxns",["FBLogger","MAWLocalizationUtils","MAWWriteMsgTxns","MAWWriteUKOSAAdminMsgContent","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a,i){return e.threads.get({jid:n}).then(function(n){if(n==null)throw r("FBLogger")("messenger_web").mustfixThrow("Invalid chat Id when try to write admin message for UK OSA");var l=o("MAWLocalizationUtils").buildUnstoredDbAdminMsg(o("MAWWriteUKOSAAdminMsgContent").getAdminMsgContent(t),n.jid,a,o("WATimeUtils").castMillisTimeToUnixTime(i),void 0,i);return o("MAWWriteMsgTxns").writeDedupedAdminMessage(e,l,n,i).then(r("emptyFunction"))})}l.writeUKOSAAdminMsg=e}),98);
__d("MAWWriteAdminMessageForUKOSAApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteUKOSAAdminMsgTxns"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWIndexedDb").makeMsgrTransactor({chunk:(e=o("MAWTransactionMode")).READONLY,ftsBackloggedMessages:e.READWRITE,groupInfo:e.READONLY,media:e.READONLY,messages:e.READWRITE,threads:e.READWRITE},"MAWwriteAdminMessageForUKOSA",function(e){return(function(t){var n=t.actorFbid,r=t.chatJid,a=t.externalId,i=t.serverAuthoritativeTimestampMs;return o("MAWWriteUKOSAAdminMsgTxns").writeUKOSAAdminMsg(e,n,r,a,i)})});l.writeAdminMessageForUKOSA=s}),98);
__d("MAWWriteUnpinMessageAdminMsgTxns",["FBLogger","MAWLocalizationUtils","MAWWriteMsgTxns","MAWWriteUnpinMessageAdminMsgContent","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a,i){return e.threads.get({jid:n}).then(function(n){if(n==null)throw r("FBLogger")("messenger_web").mustfixThrow("Invalid chat Id when try to write admin message for unpin message");var l=o("MAWLocalizationUtils").buildUnstoredDbAdminMsg(o("MAWWriteUnpinMessageAdminMsgContent").getAdminMsgContent(t),n.jid,a,o("WATimeUtils").castMillisTimeToUnixTime(i),void 0,i);return o("MAWWriteMsgTxns").writeDedupedAdminMessage(e,l,n,i).then(r("emptyFunction"))})}l.writeUnpinMessageAdminMsg=e}),98);
__d("MAWWriteAdminMessageForUnpinMessageApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteUnpinMessageAdminMsgTxns"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWIndexedDb").makeMsgrTransactor({chunk:(e=o("MAWTransactionMode")).READONLY,ftsBackloggedMessages:e.READWRITE,groupInfo:e.READONLY,media:e.READONLY,messages:e.READWRITE,threads:e.READWRITE},"MAWWriteAdminMessageForUnpinMessage",function(e){return(function(t){var n=t.actorFbid,r=t.chatJid,a=t.externalId,i=t.serverAuthoritativeTimestampMs;return o("MAWWriteUnpinMessageAdminMsgTxns").writeUnpinMessageAdminMsg(e,n,r,a,i)})});l.writeAdminMessageForUnpinMessage=s}),98);
__d("WAGetRemotePublicIdentity",["WAJids","WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n){return o("WASignalDB").getDb().runInTransaction(["identity"],"readonly",async function(e){var r=o("WAJids").toMsgrUserJid(n),a=o("WAJids").toDeviceJid(r,t),i=await e.stores.identity.get(a);return i==null?void 0:i.identity},o("WASignalDB").signalOp("getRemotePublicIdentityKey"))};l.getRemotePublicIdentity=e}),98);
__d("MAWBridgeHandlers",["EBLS","EBMessageMetadataCache","EBSMDBAPI","EBSyncMailboxKeysForContacts","EBWorkerEBSMStateUtils","EBWorkerGetEBState","EBWorkerOptOut","EncryptedBackupsDYIMediaDownload","FBLogger","IGDHandleContinueMediaDownload","MAWAddGroupParticipants","MAWBulkCancelDownloadMediaForUI","MAWBulkLoadMessagesForThread","MAWBulkMaybeCreateOrUpdateThreadScheduler","MAWBulkMaybeUpsertThreadAndParticipants","MAWCancelDownloadMediaForUI","MAWChangeSecurityAlertSettingApi","MAWChangeSecurityAlertSettingForSelfApi","MAWClearSignalAndTempStores","MAWCompleteUndoThreadCutoverApi","MAWComputeCachePayloadFromScratch","MAWConvertEchoMessagesToMsgStanzas","MAWCreateGroup","MAWCreateOrUpdateThreadApi","MAWDeleteMediaChunks_FOR_TESTING_ONLY","MAWDeleteThreadApi","MAWDownloadMediaForUI","MAWEBClientStateLogging","MAWEBInitRestoreLogging","MAWEBLSInWorkerSwitch","MAWEBUploadTrackingUtils","MAWEncryptedBackupsStateManager","MAWEphemeralSettingsCache","MAWFTSDataSync","MAWFTSEBMessagesDataSync","MAWForwardEBLSEbEnabledStateChangesToMainThread","MAWGetBlobDataUrlByMediaIdApi","MAWGetDeviceChangeAlertsByOptionsApi","MAWGetEphemeralSettingsApi","MAWGetGroupSuperAdminApi","MAWGetLatestChatJids","MAWGetLatestThreadIdsApi","MAWGetMaybeNextNonAdminMsgSortOrderMsApi","MAWGetMediaDownloadStatusApi","MAWGetMediaValidationResultApi","MAWGetProtocolMsgIdByMediaMsgId","MAWGetProtocolMsgIdByMsgId","MAWGetReceiverFetchInfoApi","MAWGetRedactedRegistrationInfoForBugnub","MAWGetReportedQplEvents","MAWGetSecureThreadTotalCount","MAWGetSecurityAlertSettingApi","MAWGetSecurityAlertSettingForSelfAndContactApi","MAWGetThreadConsistencyInfo","MAWGetThreadLastMessageTsApi","MAWGetThreadsInfoApi","MAWGetThumbnailBlobDataUrlByMediaIdApi","MAWGetWAIDevices","MAWGetWATimeApi","MAWGetWorkerHeartbeatApi","MAWGroupSetMemberAddMode","MAWHandleEBRestoreWithHIM","MAWHandleMediaRestoreCdnUrlResult","MAWIdentifyCollapsedMessagesByExternalId","MAWIdentifyXMAWithAssociatedTextByExternalId","MAWInsertAdminMessageInCutoverThreadsApi","MAWLeaveGroups","MAWLoadMediaApi","MAWLoadMoreScheduler","MAWLoadMsgsApi","MAWLoadThreadsTxns","MAWLowLevelMediaDownloadQplBridgeHandler","MAWMarkBackupAsCompleted","MAWMarkThreadAsUnreadApi","MAWMessageIntegrityDebugInfoFromWorker","MAWOptimisticUploadMedia","MAWRemoveGroupParticipants","MAWSendChatStateFromComposerApi","MAWSendPoll","MAWSendPollUpdate","MAWSendUpdateFromUIPersistedDataServiceApi","MAWSetEphemeralSettingsFromFrontendApi","MAWSetEphemeralSettingsOfPeerFromMIApi","MAWSetGroupSubject","MAWStateManagerSyncToMainThread","MAWUpdateDeviceChangeAlertsApi","MAWUpdateLSThreadFromGroupInfoApi","MAWUpdateMediaDownloadStatusByObjectIdApi","MAWUpdateReceiverFetchInfoApi","MAWWriteAdminMessageForDualThreadCutoverApi","MAWWriteAdminMessageForEphemeralSettingsChange","MAWWriteAdminMessageForLimitSharingApi","MAWWriteAdminMessageForPinMessageApi","MAWWriteAdminMessageForThreadHotlikeCustomizationApi","MAWWriteAdminMessageForThreadNicknameCustomizationApi","MAWWriteAdminMessageForThreadPhotoCustomizationApi","MAWWriteAdminMessageForThreadThemeCustomizationApi","MAWWriteAdminMessageForUKOSAApi","MAWWriteAdminMessageForUnpinMessageApi","MawMessageSendService","WAGetCurrentUserDeviceInfoApi","WAGetIdentityKeys","WAGetRemotePublicIdentity","WAGetThreadDevicesInfoApi","WALogger","WorkerScheduler"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m={addDeviceWithKeysInWorker:function(){return Promise.resolve()},addDeviceWithPinInWorker:function(t){},addEbUploadTrackingWorkerQPL:function(t){return o("MAWEBUploadTrackingUtils").handleBridgeEbUploadTrackingQPL(t.qplType,t.qplInstanceKey,t.pointName,t.annotations)},addGroupParticipants:function(t){return o("MAWAddGroupParticipants").addGroupParticipantsFn(t)},addMediaDownloadQpl:function(t){return o("MAWLowLevelMediaDownloadQplBridgeHandler").handleBridgeMediaDownloadQPL(t.qplType,t.qplInstanceKey,t.pointName,t.annotations)},backupWriteCompletionHook:function(){return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[messenger_e2ee_web] Handler not implemented and should not be used outside of Instamadillo"]))),Promise.resolve()},bulkCancelDownloadMediaForUI:function(t){return o("MAWBulkCancelDownloadMediaForUI").bulkCancelDownloadMediaForUI(t.hashes)},bulkDownloadMediaForUI:function(t){return o("MAWDownloadMediaForUI").bulkDownloadMediaForUI(t)},bulkLoadMessagesForThread:function(t){return o("MAWBulkLoadMessagesForThread").bulkLoadMessagesForThread(t)},bulkMaybeCreateOrUpdateThread:function(t,n){return o("MAWBulkMaybeCreateOrUpdateThreadScheduler").bulkMaybeCreateOrUpdateThreadScheduler().runTask({fn:function(){return o("MAWBulkMaybeUpsertThreadAndParticipants").bulkMaybeCreateOrUpdateThread(t,n)},name:"maw_maybe_create_or_update_thread",priority:o("WorkerScheduler").BLOCKING_PRIORITY})},cancelDownloadMediaForUI:function(t){return o("MAWCancelDownloadMediaForUI").cancelDownloadMediaForUI(t.hash)},changeSecurityAlertSetting:function(t){return o("MAWChangeSecurityAlertSettingApi").changeSecurityAlertSetting(t.isEnableAlert)},changeSecurityAlertSettingForSelf:function(t){return o("MAWChangeSecurityAlertSettingForSelfApi").changeSecurityAlertSettingForSelf(t.isEnableSelfAlert)},checkIfGroupParticipant:function(t){return o("MAWLoadThreadsTxns").checkIfGroupParticipant(t)},clearSignalAndTempStores:function(t){return o("MAWClearSignalAndTempStores").clearSignalAndTempStores()},clearWorkerEBSMReStore:function(t){return o("EBLS").clearEBSMStorage()},clearWorkerEBStateDBOnLogout:function(t){return o("EBSMDBAPI").clearEBIDBNonPersistedRows({hasUserGivenAutoRestoreConsent:t.hasUserGivenAutoRestoreConsent})},completeUndoThreadCutover:function(t){return o("MAWCompleteUndoThreadCutoverApi").completeUndoThreadCutover(t)},computeCachePayloadFromScratch:function(t){return o("MAWComputeCachePayloadFromScratch").computeCachePayloadFromScratch(t)},continueMediaDownload:function(t){return o("IGDHandleContinueMediaDownload").handleContinueMediaDownload(t)},convertEchoMessagesToEBProtobufs:function(t){return o("MAWHandleEBRestoreWithHIM").convertEchoMessagesToEBProtobufs(t.encodedEchoMessages,t.chatJid)},convertEchoMessagesToMsgStanzas:function(t){return o("MAWConvertEchoMessagesToMsgStanzas").convertEchoMessagesToMsgStanzas(t.encodedEchoMessages,t.chatJid)},createGroup:function(t){return o("MAWCreateGroup").createGroupFn(t)},createOrUpdateThread:function(t){return o("MAWCreateOrUpdateThreadApi").createOrUpdateThread(t)},deleteMediaChunks_FOR_TESTING_ONLY:function(t){return o("MAWDeleteMediaChunks_FOR_TESTING_ONLY").deleteMediaChunks_FOR_TESTING_ONLY(t.plaintextHashes)},deleteMsgsForMe:function(t){return o("MawMessageSendService").sendDeleteMsgForMe(t)},deleteThread:function(t){return o("MAWDeleteThreadApi").deleteThread(t.chatJid)},downloadMediaForUI:function(t){return o("MAWDownloadMediaForUI").downloadMediaForUI(t)},dyiDownloadMediaV2:function(t){return o("EncryptedBackupsDYIMediaDownload").downloadDYIMedia({mediaEntry:t.mediaEntry,plaintextHash:t.plaintextHash,protocolMsgId:t.protocolMsgId,sortOrderMs:t.sortOrderMs})},dyiGetThreadList:function(){return o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][labyrinth_dyi] Attempted to call the old DYI V1 flow"]))),Promise.resolve()},ebOptOutInWorker:function(t){return o("EBWorkerOptOut").ebOptOutInWorker()},forwardMsg:(d=o("MawMessageSendService")).sendForwardedMsg,getAllThreadsAsJson:function(){return o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][labyrinth_dyi] Attempted to call the old DYI V1 flow"]))),Promise.resolve({})},getBlobDataUrlByHashedPlaintextHash:function(t){return o("MAWGetBlobDataUrlByMediaIdApi").getBlobDataUrlByHashedPlaintextHash(t.plaintextHash,t.description,t.qplInstanceKey)},getBlobDataUrlByMediaId:function(t){return o("MAWGetBlobDataUrlByMediaIdApi").getBlobDataUrlByMediaId(t.mediaId,t.description,t.qplInstanceKey)},getBlobDataUrlByPlaintextHash:function(t){return o("MAWGetBlobDataUrlByMediaIdApi").getBlobDataUrlByPlaintextHash(t.plaintextHash,t.description,t.qplInstanceKey)},getCurrentUserDeviceId:function(){return o("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceId()},getCurrentUserDeviceInfo:function(){return o("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo()},getDeviceChangeAlertsByOptions:function(t){return o("MAWGetDeviceChangeAlertsByOptionsApi").getDeviceChangeAlertsByOptions(t.options)},getEBMetadataCacheDetailsForThread:function(t){return o("EBMessageMetadataCache").getCacheDetailsForThreadForLogging(t)},getEBSMWorkerState:function(){return o("EBWorkerEBSMStateUtils").getEBSMWorkerState()},getEphemeralSettings:function(t){return o("MAWGetEphemeralSettingsApi").getEphemeralSettings(t.threadId)},getGroupSuperAdmin:function(t){return o("MAWGetGroupSuperAdminApi").getGroupSuperAdmin(t.chatJid)},getIdentityKeys:function(t){return o("WAGetIdentityKeys").getIdentityKeysInWorker()},getLatestChatJids:function(t){return o("MAWGetLatestChatJids").getLatestChatJids(t.count)},getLatestThreadIds:function(t){return o("MAWGetLatestThreadIdsApi").getLatestThreadIds(t.numThreads)},getMaybeNextNonAdminMsgSortOrderMs:function(t){return o("MAWGetMaybeNextNonAdminMsgSortOrderMsApi").getMaybeNextNonAdminMsgSortOrderMs(t.chatJid,t.mayBeAdminMsgId)},getMediaDownloadStatusByMediaId:function(t){return o("MAWGetMediaDownloadStatusApi").getMediaDownloadStatusByMediaId(t.mediaId,t.qplInstanceKey)},getMediaDownloadStatusByPlaintextHash:function(t){return o("MAWGetMediaDownloadStatusApi").getMediaDownloadStatusByPlaintextHash(t.plaintextHash,t.qplInstanceKey)},getMediaRestoreNextTimestamp:function(t){return o("MAWFTSEBMessagesDataSync").getMediaRestoreNextTimestamp(t)},getMediaValidationResultByMediaId:function(t){return o("MAWGetMediaValidationResultApi").getMediaValidationResultByMediaId(t.mediaId,t.qplInstanceKey)},getMediaValidationResultByPlainTextHash:function(t){return o("MAWGetMediaValidationResultApi").getMediaValidationResultByPlainTextHash(t.plaintextHash,t.qplInstanceKey)},getProtocolMsgIdByMediaMsgId:function(t){return o("MAWGetProtocolMsgIdByMediaMsgId").getProtocolMsgIdByMediaMsgId(t.msgId)},getProtocolMsgIdByMsgId:function(t){return o("MAWGetProtocolMsgIdByMsgId").getProtocolMsgIdByMsgId(t.msgId)},getReceiverFetchInfo:function(t){return o("MAWGetReceiverFetchInfoApi").getReceiverFetchInfo(t)},getRedactedRegistrationInfoForBugnub:function(t){return o("MAWGetRedactedRegistrationInfoForBugnub").getRedactedRegistrationInfoForBugnub()},getRemotePublicIdentityKey:async function(t){var e=await o("WAGetRemotePublicIdentity").getRemotePublicIdentity(t.deviceId,t.userId);return e==null?null:{remotePublicIdentityKey:e}},getReportedQplEvents:function(t){return o("MAWGetReportedQplEvents").getReportedQplEvents()},getSecureThreadTotalCount:function(t){return o("MAWGetSecureThreadTotalCount").getSecureThreadTotalCount()},getSecurityAlertSetting:function(t){return o("MAWGetSecurityAlertSettingApi").getSecurityAlertSetting()},getSecurityAlertSettingForSelfAndContact:function(t){return o("MAWGetSecurityAlertSettingForSelfAndContactApi").getSecurityAlertSettingForSelfAndContact()},getThreadConsistencyInfo:function(t){return o("MAWGetThreadConsistencyInfo").getThreadConsistencyInfo(t)},getThreadDevicesInfo:function(t){return o("WAGetThreadDevicesInfoApi").getThreadDevicesInfo(t)},getThreadIdByDeduplicationKey:function(t){return o("MAWGetThreadsInfoApi").getThreadIdByDeduplicationKey(t.deduplicationKey)},getThreadLastMessageTs:function(t){return o("MAWGetThreadLastMessageTsApi").getThreadLastMessageTs(t.threadKey)},getThreadMediaRestoreStatus:function(t){return o("MAWFTSEBMessagesDataSync").getThreadMediaRestoreStatus(t)},getThumbnailBlobDataUrlByHashedPlaintextHash:function(t){return o("MAWGetThumbnailBlobDataUrlByMediaIdApi").getThumbnailBlobDataUrlByHashedPlaintextHash(t.plaintextHash,t.description,t.qplInstanceKey)},getThumbnailBlobDataUrlByMediaId:function(t){return o("MAWGetThumbnailBlobDataUrlByMediaIdApi").getThumbnailBlobDataUrlByMediaId(t.mediaId,t.description,t.qplInstanceKey)},getWAIDevices:function(t){return o("MAWGetWAIDevices").getWAIDevices(t)},getWATime:function(){return o("MAWGetWATimeApi").getWATime()},getWorkerBasedMessageIntegrityDebugInfo:function(t){return o("MAWMessageIntegrityDebugInfoFromWorker").getWorkerBasedMessageIntegrityDebugInfo(t)},getWorkerEBState:function(){return o("EBWorkerGetEBState").getEBWorkerState()},getWorkerHeartbeat:function(){return o("MAWGetWorkerHeartbeatApi").getWorkerHeartbeat()},handleInstamadilloDYIRangeQueryRestore:function(){return o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[maw_core_lla] Handler not implemented and should not be used outside Instamadillo"]))),Promise.resolve()},identifyCollapsedMessagesByExternalId:function(t){return o("MAWIdentifyCollapsedMessagesByExternalId").identifyCollapsedMessagesByExternalId(t)},identifyXMAWithAssociatedTextByExternalId:function(t){return o("MAWIdentifyXMAWithAssociatedTextByExternalId").identifyXMAWithAssociatedTextByExternalId(t)},insertAdminMessageInCutoverThreads:function(t){return o("MAWInsertAdminMessageInCutoverThreadsApi").insertAdminMessageInCutoverThreads(t)},leaveGroup:function(t){return o("MAWLeaveGroups").leaveGroupFn(t)},loadMoreMedia:function(t){return o("MAWLoadMediaApi").loadMoreMedia(t)},loadMsgsByExternalId:function(t){return o("MAWLoadMsgsApi").loadMsgsByExternalId(t.externalId,t.config)},logEBClientStateForDebugging:function(t){return o("MAWEBClientStateLogging").logEBClientStateForDebugging()},logInitRestoreMethodForDebugging:function(t){return o("MAWEBInitRestoreLogging").logInitRestoreMethodForDebugging(t)},markBackupAsCompleted:function(t){return o("MAWMarkBackupAsCompleted").markBackupAsCompleted(t)},markThreadAsUnread:function(t){return o("MAWMarkThreadAsUnreadApi").markThreadAsUnread(t.chatJid)},maw_load_msgs:function(t){return o("MAWLoadMoreScheduler").loadMoreMessages(t)},maw_load_msgs_by_chat_jids_into_maw:function(t){return o("MAWLoadMoreScheduler").loadMessagesByChatJidsIntoMaw(t)},maw_load_msgs_range:function(t){return o("MAWLoadMoreScheduler").loadMoreMsgsRange(t)},mediaRestoreCdnUrlResult:function(t){return o("MAWHandleMediaRestoreCdnUrlResult").handleMediaRestoreCdnUrlResult(t)},optimisticUploadMedia:function(t){return o("MAWOptimisticUploadMedia").optimisticUploadMedia(t)},removeGroupParticipants:function(t){return o("MAWRemoveGroupParticipants").removeGroupParticipantsFn(t)},resendEBLSInWorkerEbEnabledState:function(t){return o("MAWForwardEBLSEbEnabledStateChangesToMainThread").sendEBLSEbEnabledStateToMainThread()},resendWorkerStateManagerValuesToMainThread:function(t){return o("MAWStateManagerSyncToMainThread").resendCurrentValuesToMainThread()},search:function(t){return o("MAWFTSDataSync").search(t)},searchFTSClearThreadRestoreStatus:function(t){return o("MAWFTSEBMessagesDataSync").searchFTSClearThreadRestoreStatus(t)},searchFTSGetThreadRestoreStatus:function(t){return o("MAWFTSEBMessagesDataSync").searchFTSGetThreadRestoreStatus(t)},searchFTSGetThreadsRestoreStatus:function(t){return o("MAWFTSEBMessagesDataSync").searchFTSGetThreadsRestoreStatus(t)},searchFTSReportTabAlive:function(t){return o("MAWFTSEBMessagesDataSync").searchFTSReportTabAlive(t)},searchFTSReportTabDestroy:function(t){return o("MAWFTSEBMessagesDataSync").searchFTSReportTabDestroy(t)},searchFTSReportTabForeground:function(t){return o("MAWFTSEBMessagesDataSync").searchFTSReportTabForeground(t)},searchFTSReportTabTaskComplete:function(t){return o("MAWFTSEBMessagesDataSync").searchFTSReportTabTaskComplete(t)},searchFTSRequestRestoreTask:function(t){return o("MAWFTSEBMessagesDataSync").searchFTSRequestRestoreTask(t)},searchGetFTSNextTimestamp:function(t){return o("MAWFTSEBMessagesDataSync").searchGetFTSNextTimestamp(t)},searchGetFTSRestoreSessionId:function(t){return o("MAWFTSEBMessagesDataSync").searchGetFTSRestoreSessionId(t)},searchIndexUpdate:function(t){return o("MAWFTSEBMessagesDataSync").searchIndexUpdate(t)},searchSetFTSNextTimestamp:function(t){return o("MAWFTSEBMessagesDataSync").searchSetFTSNextTimestamp(t)},sendBumpMsg:d.sendBumpMsg,sendChatStateFromComposer:function(t){return o("MAWSendChatStateFromComposerApi").sendChatStateFromComposer(t)},sendEditMsg:d.sendEditMsg,sendGroupInviteMsg:d.sendGroupInviteMsg,sendMediaMsgV2:d.sendMediaMsg,sendMsg:d.sendTextMsg,sendNoteReplyMsg:d.sendNoteReplyMsg,sendPoll:function(t){return r("FBLogger")("wmi").mustfix("sendPoll is deprecated"),o("MAWSendPoll").sendPoll(t)},sendPollUpdate:function(t){return r("FBLogger")("wmi").mustfix("sendPollUpdate is deprecated"),o("MAWSendPollUpdate").sendPollUpdate()},sendReactionMsg:d.sendReactionMsg,sendRevokeMsg:d.sendRevokeMsg,sendUpdateFromUIPersistedDataService:function(t){return o("MAWSendUpdateFromUIPersistedDataServiceApi").sendUpdateFromUIPersistedDataService(t)},sendXMAShareMsg:d.sendXMAShareMsg,setEncryptedBackupsState:function(t){o("MAWEncryptedBackupsStateManager").setEncryptedBackupsState(t.newState)},setEphemeralSettingCache:function(t){return o("MAWEphemeralSettingsCache").setEphemeralSettingCache(t.jid,t.settings)},setEphemeralSettingsFromFrontend:function(t){return o("MAWSetEphemeralSettingsFromFrontendApi").setEphemeralSettingsFromFrontend(t)},setEphemeralSettingsFromMI:function(t){return o("MAWSetEphemeralSettingsOfPeerFromMIApi").setEphemeralSettingsFromMI(t)},setGroupMemberAddMode:function(t){return o("MAWGroupSetMemberAddMode").setMemberAddModeFn(t)},setGroupSubject:function(t){return o("MAWSetGroupSubject").setGroupSubjectFn(t)},setThreadMediaRestoreStatus:function(t){return o("MAWFTSEBMessagesDataSync").setThreadMediaRestoreStatus(t)},syncMailboxKeysForContactsInWorker:function(t){return o("EBSyncMailboxKeysForContacts").syncMailboxKeysForContacts([].concat(t.userFbIds))},updateDeviceChangeAlerts:function(t){return o("MAWUpdateDeviceChangeAlertsApi").updateDeviceChangeAlerts(t.alert)},updateLSThreadFromGroupInfo:function(t){return o("MAWUpdateLSThreadFromGroupInfoApi").updateLSThreadFromGroupInfo(t.groupJid)},updateMediaDownloadStatusByObjectId:function(t){return o("MAWUpdateMediaDownloadStatusByObjectIdApi").updateMediaDownloadStatusByObjectId(t.objectId,t.downloadStatus,t.details)},updateReceiverFetchInfo:function(t){return o("MAWUpdateReceiverFetchInfoApi").updateReceiverFetchInfo(t)},waitForEBLSEbEnabled:function(t){return r("MAWEBLSInWorkerSwitch").waitForEBEnabled()},writeAdminMessageForDualThreadCutover:function(t){return o("MAWWriteAdminMessageForDualThreadCutoverApi").writeAdminMessageForDualThreadCutover(t)},writeAdminMessageForEphemeralSettingsChange:function(t){return o("MAWWriteAdminMessageForEphemeralSettingsChange").writeAdminMessageForEphemeralSettingsChange(t)},writeAdminMessageForLimitSharing:function(t){return o("MAWWriteAdminMessageForLimitSharingApi").writeAdminMessageForLimitSharing(t)},writeAdminMessageForPinMessage:function(t){return o("MAWWriteAdminMessageForPinMessageApi").writeAdminMessageForPinMessage(t)},writeAdminMessageForThreadHotlikeCustomization:function(t){return o("MAWWriteAdminMessageForThreadHotlikeCustomizationApi").writeAdminMessageForThreadHotlikeCustomization(t)},writeAdminMessageForThreadNicknameCustomization:function(t){return o("MAWWriteAdminMessageForThreadNicknameCustomizationApi").writeAdminMessageForThreadNicknameCustomization(t)},writeAdminMessageForThreadPhotoCustomization:function(t){return o("MAWWriteAdminMessageForThreadPhotoCustomizationApi").writeAdminMessageForThreadPhotoCustomization(t)},writeAdminMessageForThreadThemeCustomization:function(t){return o("MAWWriteAdminMessageForThreadThemeCustomizationApi").writeAdminMessageForThreadThemeCustomization(t)},writeAdminMessageForUKOSA:function(t){return o("MAWWriteAdminMessageForUKOSAApi").writeAdminMessageForUKOSA(t)},writeAdminMessageForUnpinMessage:function(t){return o("MAWWriteAdminMessageForUnpinMessageApi").writeAdminMessageForUnpinMessage(t)}};l.bridgeHandlers=m}),98);
__d("IGDLowLevelApiBridgeHandlers",["EncryptedBackupsUploadQueue","IGDEbUploadQueue","MAWBridgeHandlers","WALogger","cr:8399"],(function(t,n,r,o,a,i,l){"use strict";var e,s=babelHelpers.extends({},o("MAWBridgeHandlers").bridgeHandlers,{backupWriteCompletionHook:async function(t){var e=o("EncryptedBackupsUploadQueue").ebUploadQueue();await t.queueIds.map(function(t){return e.ack([t])}),o("IGDEbUploadQueue").scheduleNextRun()},handleInstamadilloDYIRangeQueryRestore:function(r){return n("cr:8399")==null?(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[DYI] Instamadillo DYI is not enabled"]))),Promise.resolve()):n("cr:8399")(r.threadId,r.messages,r.hasMoreBefore,r.nextMessageTimestampMsBefore)}});l.igdBridgeHandlers=s}),98);
__d("IGDBackendBridgeHandlers",["EBBridgedAPIHandler","IGDBridgedAPIHandler","IGDLowLevelApiBridgeHandlers","MAWJobManager","WABridgedAPIHandler","WAMockServerShell","WAWaitForComms","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){return babelHelpers.extends({},o("IGDLowLevelApiBridgeHandlers").igdBridgeHandlers,{ebapi:async function(r){await o("WAWaitForComms").waitForComms();var n=o("EBBridgedAPIHandler").ebapi[r.type];return n==null&&t.TAGS(["EBBridgedAPI"]).ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["handle with type "," not found"])),r.type),n.apply(void 0,r.args)},igdapi:async function(t){return await o("WAWaitForComms").waitForComms(),o("IGDBridgedAPIHandler").igdapi(t)},initMockServer:function(t){return o("WAMockServerShell").getMockServer==null?Promise.reject("Mock server is not available. Make sure you use worker v2"):o("WAMockServerShell").getMockServer().init(t)},minosEBAPI:function(){throw r("err")("not implemented")},runJobFireAndForget:async function(t){return await o("WAWaitForComms").waitForComms(),o("MAWJobManager").getJobManager().fireAndForget(t)},runJobWaitUntilCompleted:async function(t){return await o("WAWaitForComms").waitForComms(),o("MAWJobManager").getJobManager().waitUntilCompleted(t)},runJobWaitUntilPersisted:async function(t){return await o("WAWaitForComms").waitForComms(),o("MAWJobManager").getJobManager().waitUntilPersisted(t)},runMock:function(t){return o("WAMockServerShell").getMockServer==null?Promise.reject("Mock server is not available. Make sure you use worker v2"):o("WAMockServerShell").getMockServer().runMock(t)},setMockVariables:function(t){if(o("WAMockServerShell").getMockServer==null)throw r("err")("Mock server is not available. Make sure you use worker v2");o("WAMockServerShell").getMockServer().setVariables(t.variables)},waapi:async function(n){await o("WAWaitForComms").waitForComms();var e=o("WABridgedAPIHandler").waapi[n.type];return e==null&&t.TAGS(["WABridgedAPI"]).ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["handle with type "," not found"])),n.type),e.apply(void 0,n.args)}})}l.getIGDBridgeHandlers=u}),98);
__d("IGDCOP",["MawCopScheduler","Promise","WAPubSub","WAWaitForUserUnblocked"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(){this.$1=o("WAPubSub").simplePubSub(),this.scheduler=o("MawCopScheduler").copScheduler()}var r=t.prototype;return r.handleThreadMetadata=function(t){},r.onlineProcessing=function(){return(e||(e=n("Promise"))).resolve()},r.loadMoreMsgs=function(r,o){return(e||(e=n("Promise"))).resolve()},r.subscribeToOfflineQueue=function(t,n){var e=this;t.subscribe(function(t){switch(t.type){case"offline-start":break;case"offline-end":{e.$1.publish({success:!0,type:"maw-infra-end"}),o("WAWaitForUserUnblocked").unblockUser();break}default:{t.type;break}}})},r.subscribe=function(t){return this.$1.subscribe(t)},r.TEST_ONLY_setMode=function(t){},r.TEST_ONLY_getMode=function(){return"online"},t})(),u=null;function c(){return u=new s,u}var d=c();l.cop=d}),98);
__d("InstamadilloMediaUpload",["FBLogger","LSIntEnum","MAWFetchXMABlob","MAWFrontendMediaUtils","MAWMediaUtils","MAWOptimisticUploadMedia","MessagingAttachmentType","WABlobToArrayBuffer","WAHashUtils","WAMediaCrypto","WAStartMediaUploadQplFlow","WATagsLogger","WAUploadMediaQuick"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("WATagsLogger").TAGS(["InstamadilloMediaUpload"]);async function u(e,t,n){var r=await o("MAWMediaUtils").hashBlob(t),a=o("WAHashUtils").toPlaintextHash(r),i=n.type==="regular"?n.mediaType:"preview",l=await o("WAStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:e.chat,fileSize:t.size,serverMediaType:i,uploadEntry:"InstamadilloMediaUpload"});return o("WAUploadMediaQuick").uploadMediaQuick({logger:s,mediaUploadFlow:l,plaintext:await o("WABlobToArrayBuffer").blobToArrayBuffer(t),plaintextHash:a,serverMediaType:i})}async function c(t,n,a){if(a.playableUrlMimeType==null)throw r("FBLogger")("igd_web").mustfixThrow("instamadilloUpload: mimeType is null");var i=o("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(a.playableUrlMimeType),l=i.serverMediaType,s=await u(t,n,{mediaType:l,type:"regular"});if(s.success!==!0)throw r("FBLogger")("igd_web").mustfixThrow("instamadilloUpload: Failed to upload media");var c=null,d=(e||(e=o("LSIntEnum"))).unwrapIntEnum(a.attachmentType),m=await o("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"InstamadilloMediaUpload",url:a.previewUrl});if(m!=null){var p=await m.arrayBuffer(),_=d===r("MessagingAttachmentType").IMAGE||d===r("MessagingAttachmentType").VIDEO?o("MAWMediaUtils").convertJpegThumbnailArrayBufferToFile(p):null,f=new Uint8Array(await o("WABlobToArrayBuffer").blobToArrayBuffer(n));if(_&&o("MAWOptimisticUploadMedia").shouldUploadPreview(l,n.size,f)){var g=o("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(l);if(g==null)throw r("FBLogger")("igd_web").mustfixThrow("unsupported preview media type %s",l);var h=await u(t,_,{messageType:g,type:"preview"});if(h.success!==!0)throw r("FBLogger")("igd_web").mustfixThrow("instamadilloUpload: Failed to upload preview media");c=h.value}}return{mediaEntry:s.value,thumbnailMediaEntry:c}}l.instamadilloUpload=c}),98);
__d("createInstamadilloMediaPayload",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.directPath,n=e.duration,o=e.fileEncSha256,a=e.fileLength,i=e.fileSha256,l=e.height,p=e.isAnimated,_=e.isSticker,f=e.mediaId,g=e.mediaKey,h=e.mediaKeyTimestamp,y=e.mediaType,C=e.mimetype,b=e.objectId,v=e.sidecar,S=e.thumbnail,R=e.waveforms,L=e.waveformSamplingFrequencyHz,E=e.width,k={directPath:t,fileEncSha256:o,fileLength:a,fileSha256:i,mediaId:f,mediaKey:g,mediaKeyTimestamp:h,mimetype:C,objectId:b,sidecar:v};switch(y){case"Image":return s(l,E,k,S);case"Video":return u(l,E,k,S);case"Ptt":if(R==null)throw r("FBLogger")("igd_web").mustfixThrow("createInstamadilloMedia: waveforms is null");return c(n,k,R,L);case"Gif":return d(l,E,k,_);case"Sticker":return m(k,p);default:throw r("FBLogger")("igd_web").mustfixThrow("createInstamadilloMedia: mediaType is unsupported")}}function s(e,t,n,r){return{staticPhoto:{height:e,mediaTransport:n,thumbnail:r,width:t}}}function u(e,t,n,r){return{video:{height:e,mediaTransport:n,thumbnail:r,width:t}}}function c(e,t,n,r){return{voice:{duration:e,mediaTransport:t,waveforms:n,waveformSamplingFrequencyHz:r}}}function d(e,t,n,r){return{gif:{height:e,isSticker:r,mediaTransport:n,width:t}}}function m(e,t){return{avatarSticker:{isAnimated:t,mediaTransport:e}}}l.createInstamadilloMediaEncode=e}),98);
__d("InstamadilloSendMediaMessageUtils",["FBLogger","I64","InstamadilloMediaUpload","LSIntEnum","MAWDbMsg","MAWFetchXMABlob","MAWFrontendMediaUtils","MAWMediaUtils","MAWReStoreDb","MessagingAttachmentType","ReQL","WABase64","WABlobToArrayBuffer","WAMediaUtils","WASortedLists","WATimeUtils","createInstamadilloMediaPayload"],(function(t,n,r,o,a,i,l){"use strict";var e=["$$unknownFieldCount"],s=["$$unknownFieldCount"],u,c;async function d(e,t,n){var r=await o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.attachments).getKeyRange(t,n));return r}function m(e){return{validatedAudioInfo:p(e),validatedDocumentFileInfo:null,validatedImageInfo:_(e),validatedVideoInfo:f(e)}}function p(e){return(u||(u=o("I64"))).equal(e==null?void 0:e.attachmentType,(c||(c=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").AUDIO))?{duration:e.playableDurationMs!=null?(u||(u=o("I64"))).to_float(e.playableDurationMs):0,mimetype:e.playableUrlMimeType}:null}function _(e){return(u||(u=o("I64"))).equal(e==null?void 0:e.attachmentType,(c||(c=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE))?{height:e.previewHeight!=null?(u||(u=o("I64"))).to_float(e.previewHeight):0,width:e.previewWidth!=null?(u||(u=o("I64"))).to_float(e.previewWidth):0}:null}function f(e){return(u||(u=o("I64"))).equal(e==null?void 0:e.attachmentType,(c||(c=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO))?{duration:e.playableDurationMs!=null?(u||(u=o("I64"))).to_float(e.playableDurationMs):0,height:e.previewHeight!=null?(u||(u=o("I64"))).to_float(e.previewHeight):0,mimetype:e.playableUrlMimeType,width:e.previewWidth!=null?(u||(u=o("I64"))).to_float(e.previewWidth):0}:null}function g(e){var t=e.directPath,n=e.fbid,r=e.fileEncSha256,a=e.fileSha256,i=e.mediaKey,l=e.mediaKeyTimestamp,s=e.objectId;return{directPath:t!=null?t:void 0,fileEncSha256:o("WABase64").encodeB64(r),fileSha256:o("WABase64").encodeB64(a),mediaId:n!=null?n:void 0,mediaKey:o("WABase64").encodeB64(i),mediaKeyTimestamp:String(l),objectId:s!=null?s:void 0}}async function h(t,n){var a,l=await o("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"InstamadilloSendMediaMessageUtils",url:n.playableUrl});if(l==null)throw r("FBLogger")("igd_web").mustfixThrow("Blob is null");var c=n.playableUrlMimeType;if(c==null)throw r("FBLogger")("igd_web").mustfixThrow("IGDSendMessageTaskHandler: mimeType is null");var d=o("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(c),p=d.mediaType,_=d.serverMediaType;if(p==null)throw r("FBLogger")("igd_web").mustfixThrow("handleInstamadilloMediaSends: mediaType is null");var f=await o("MAWMediaUtils").genBlobHashes(l),h=f[0],y=f[1],C=await o("MAWReStoreDb").getDB(i.id+":193"),b=await C.runInTransaction(async function(e){var r=await e.e2ee_media.index("hashedPlaintextHash").get(y),a=new Map(r==null?void 0:r.mediaEntries),i=m(n),s,u=o("MAWDbMsg").stanzaIdToMsgId(t.externalId);if(r!=null){var d=o("WASortedLists").addToSet(r.msgIds,u);s=babelHelpers.extends({},r,i,{mediaEntries:a,msgIds:d})}else s=babelHelpers.extends({hashedPlaintextHash:y,mediaEntries:a,mediaType:p,msgIds:o("WASortedLists").singleElement(u),plaintextHash:h,size:l.size,ts:o("WATimeUtils").unixTime()},i);await e.e2ee_media.put(s);var _=await o("WABlobToArrayBuffer").blobToArrayBuffer(l),f=await e.e2ee_chunk.index("hashedPlaintextHash").get(y);return f==null&&await e.e2ee_chunk.put({blobData:_,hashedPlaintextHash:y,mimetype:c,plaintextHash:h}),s},"readwrite",void 0,void 0,i.id+":194"),v=new File([l],(a=n.filename)!=null?a:"",{type:c}),S=await o("InstamadilloMediaUpload").instamadilloUpload(t,v,n),R=S.mediaEntry,L=S.thumbnailMediaEntry,E=babelHelpers.extends({},b,{objectId:R.objectId!=null?o("WAMediaUtils").stringToDeliveryObjectId(R.objectId):void 0});await C.runInTransaction(async function(e){await e.e2ee_media.put(E)},"readwrite",void 0,void 0,i.id+":261");var k=g(R),I=k.$$unknownFieldCount,T=babelHelpers.objectWithoutPropertiesLoose(k,e),D=babelHelpers.extends({},T,{duration:n.playableDurationMs!=null?(u||(u=o("I64"))).to_int32(n.playableDurationMs):void 0,fileLength:v.size,height:n.previewHeight!=null?(u||(u=o("I64"))).to_int32(n.previewHeight):void 0,isAnimated:!1,isSticker:!1,mediaType:p,mimetype:c,sidecar:void 0,waveforms:n.waveformData!=null?n.waveformData.split(",").map(Number):void 0,waveformSamplingFrequencyHz:n.samplingFrequencyHz!=null?(u||(u=o("I64"))).to_int32(n.samplingFrequencyHz):void 0,width:n.previewWidth!=null?(u||(u=o("I64"))).to_int32(n.previewWidth):void 0});if(L!=null){var x=g(L),$=x.$$unknownFieldCount,P=babelHelpers.objectWithoutPropertiesLoose(x,s),N={mediaTransport:P};D=babelHelpers.extends({},D,{thumbnail:N})}var M=o("createInstamadilloMediaPayload").createInstamadilloMediaEncode(D);return{media:E,mediaEncode:M,serverMediaType:_}}l.getMediaAttachment=d,l.generateValidatedMediaInfoFromAttachment=m,l.prepareMediaProtobuf=h}),98);
__d("MAWDbChunk",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}function l(e){return e}i.convertNumberToChunkId=e,i.convertToChunkId64=l}),66);
__d("IGDReportUserSpamJob",["FBLogger","I64","InstamadilloSendMediaMessageUtils","LSIntEnum","MAWDbChunk","MAWDbMedia","MAWDbMsg","MAWGetGroupInfoApi","MAWJids","MAWJobManager","MAWReStoreDb","MAWSpamReportUtils","WABase64","WADeprecatedSendIq","WAGlobals","WAJids","WAMediaUtils","WAResultOrError","WAWap","createInstamadilloMediaPayload","err","isStringNullOrEmpty"],(function(t,n,r,o,a,i,l){"use strict";var e=["$$unknownFieldCount"],s,u,c=o("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("reportUserSpam",async function(e){var t=e.chatJid,n=e.context,a=e.frxParams,i=e.frxTags,l=e.msgs,s=e.reportedMessageId,u=e.spamFlow,c=e.userJid,m=null;if(i!=null){if(i.length===0)throw r("err")("spam reasons should not be an empty array");m=o("WAWap").wap("tagset",null,i.map(function(e){return o("WAWap").wap("tag",{value:o("WAWap").CUSTOM_STRING(e)})}))}var p=null;r("isStringNullOrEmpty")(a)||(p=o("WAWap").wap("parameters",null,a));var g=null;n!=null&&(g=o("WAWap").wap("context",null,n));var h=null;(m!=null||g!=null||p!=null)&&(h=o("WAWap").wap("frx",null,m,g,p));var y=await d(l,t,c,s),C=await o("WAJids").switchOnMsgrChatJidType(t,{group:async function(t){var e=o("WAWap").DROP_ATTR,n=o("WAWap").DROP_ATTR,r=await o("MAWGetGroupInfoApi").getGroupInfo(t);return r!=null&&r.subject!=null&&r.subject.content!=null&&(e=o("WAWap").CUSTOM_STRING(r.subject.content)),r!=null&&r.inviter!=null&&(n=o("WAWap").USER_JID(r.inviter)),_(y,t,c,n,e,u,h)},user:function(){return f(y,c,u,h)}});return o("WADeprecatedSendIq").deprecatedCastStanza(C),o("WAResultOrError").makeResult()}).end();function d(e,t,n,r){var a=(e!=null?e:[]).map(async function(e){var a=o("MAWJids").toUserJid((s||(s=o("I64"))).to_string(e.senderId)),i;if(e.transportKey==="Instamadillo"&&(s||(s=o("I64"))).equal(e.displayedContentTypes,(u||(u=o("LSIntEnum"))).ofNumber(2))&&(i=await m(e)),o("WAJids").interpretAsGroupJid(t)!=null)return o("MAWSpamReportUtils").formatLSDbMsgForSpamReport(e,null,o("WAJids").toGroupJid(t),a);var l=(s||(s=o("I64"))).equal(e.senderId,(s||(s=o("I64"))).of_string(o("WAJids").userIdFromJid(o("WAGlobals").getMyUserJid())))?n:o("WAGlobals").getMyUserJid();return o("MAWSpamReportUtils").formatLSDbMsgForSpamReport(e,l,null,a,i,r===e.messageId)});return Promise.all(a)}async function m(t){var n=await o("MAWReStoreDb").getDB(i.id+":244"),a=await n.runInTransaction(async function(e){var n=await o("InstamadilloSendMediaMessageUtils").getMediaAttachment(e,t.threadKey,t.messageId);if(n==null)throw r("FBLogger")("igd_web").warn("IGDReportUserSpam: Tried to send a message with associated attachment");var a=o("MAWDbMedia").convertToMediaId64((s||(s=o("I64"))).of_string(n.attachmentFbid)),i=await e.e2ee_media.get(a);if(i==null)throw r("FBLogger")("igd_web").warn("IGDReportUserSpam: Tried to send an E2EE media message without associated e2ee_media");var l=o("MAWDbChunk").convertToChunkId64(s.of_string(n.attachmentFbid)),u=await e.e2ee_chunk.get(l);if(u==null)throw r("FBLogger")("igd_web").warn("IGDReportUserSpam: Tried to send an E2EE media message without associated e2ee_chunk");return{attachment:n,chunk:u,media:i}},"readonly",void 0,void 0,i.id+":245"),l=a.attachment,u=a.media,c=o("MAWDbMsg").instamadilloMsgIdToMsgId(t.messageId);if(!u.msgIds.includes(c))throw r("FBLogger")("igd_web").warn("IGDReportUserSpam: media is not linked to this message");var d=u.mediaEntries.get(c);if(d==null)throw r("FBLogger")("igd_web").warn("IGDreportUserSpam: media entry not found");var m=o("WAMediaUtils").mediaEntryDataToRawData(u.plaintextHash,d),_=p(m),f=_.$$unknownFieldCount,g=babelHelpers.objectWithoutPropertiesLoose(_,e),h=babelHelpers.extends({},g,{duration:l.playableDurationMs!=null?(s||(s=o("I64"))).to_int32(l.playableDurationMs):void 0,fileLength:u.size!=null?u.size:void 0,height:l.previewHeight!=null?(s||(s=o("I64"))).to_int32(l.previewHeight):void 0,isAnimated:!1,isSticker:!1,mediaType:u.mediaType,mimetype:l.playableUrlMimeType,sidecar:void 0,waveforms:l.waveformData!=null?l.waveformData.split(",").map(Number):void 0,waveformSamplingFrequencyHz:l.samplingFrequencyHz!=null?(s||(s=o("I64"))).to_int32(l.samplingFrequencyHz):void 0,width:l.previewWidth!=null?(s||(s=o("I64"))).to_int32(l.previewWidth):void 0}),y=o("createInstamadilloMediaPayload").createInstamadilloMediaEncode(h);return y}function p(e){var t=e.directPath,n=e.fbid,r=e.fileEncSha256,a=e.fileSha256,i=e.mediaKey,l=e.mediaKeyTimestamp,s=e.objectId;return{directPath:t!=null?t:void 0,fileEncSha256:r!=null?o("WABase64").encodeB64(r):void 0,fileSha256:a!=null?o("WABase64").encodeB64(a):void 0,mediaId:n!=null?n:void 0,mediaKey:i!=null?o("WABase64").encodeB64(i):void 0,mediaKeyTimestamp:String(l),objectId:s!=null?s:void 0}}function _(e,t,n,r,a,i,l){var s;return(s=o("WAWap")).wap("iq",{id:s.generateId(),to:s.S_WHATSAPP_NET,type:"set",xmlns:"spam"},s.wap("spam_list",{jid:s.GROUP_JID(t),reportee:s.USER_JID(n),source:r,spam_flow:s.CUSTOM_STRING(i),subject:a},e),l)}function f(e,t,n,r){var a;return(a=o("WAWap")).wap("iq",{id:a.generateId(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"spam"},a.wap("spam_list",{jid:a.USER_JID(t),reportee:a.USER_JID(t),spam_flow:a.CUSTOM_STRING(n)},e),r)}l.igdReportUserSpam=c}),98);
__d("IGDStartInstamadilloDYIJob",["EncryptedBackupsDYISingleton","EncryptedBackupsDYITypes","MAWJobManager","MAWReStoreDb","cr:1288"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("startInstamadilloDYI",async function(t){var r=t.qplInstanceKey;o("EncryptedBackupsDYISingleton").initSingleton(o("EncryptedBackupsDYITypes").EncryptedBackupsDYIConfig.Instamadillo,o("MAWReStoreDb").getDB,r);var a=o("EncryptedBackupsDYISingleton").getSingleton(),i=a.getLogger();i.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Started job startInstamadilloDYI"]))),a.logDYIQPLPoint("instamadillo_dyi_job_start"),n("cr:1288")!=null?(await n("cr:1288").getInstance().startDYI(),a.logDYIQPLPoint("instamadillo_dyi_started")):i.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Instamadillo DYI not enabled"])))}).end();l.startInstamadilloDYI=u}),98);
__d("IGDJobHandlers",["IGDReportUserSpamJob","IGDStartInstamadilloDYIJob","MAWCreateJobNotImplemented"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e;return{acceptGroupInvite:(e=o("MAWCreateJobNotImplemented")).createNotImplementedJob("acceptGroupInvite"),addGroupParticipants:e.createNotImplementedJob("addGroupParticipants"),createGroup:e.createNotImplementedJob("createGroup"),deleteMsgsForMe:e.createNotImplementedJob("deleteMsgsForMe"),deleteThread:e.createNotImplementedJob("deleteThread"),demoteGroupParticipants:e.createNotImplementedJob("demoteGroupParticipants"),downloadAndHandleMedia:e.createNotImplementedJob("downloadAndHandleMedia"),downloadAndRestoreMedia:e.createNotImplementedJob("downloadAndRestoreMedia"),getSpams:e.createNotImplementedJob("getSpams"),handleFutureproofMsg:e.createNotImplementedJob("handleFutureproofMsg"),handleSpamMsg:e.createNotImplementedJob("handleSpamMsg"),igdReportUserSpam:o("IGDReportUserSpamJob").igdReportUserSpam,leaveGroups:e.createNotImplementedJob("leaveGroups"),markThreadAsRead:e.createNotImplementedJob("markThreadAsRead"),promoteGroupParticipants:e.createNotImplementedJob("promoteGroupParticipants"),removeGroupParticipants:e.createNotImplementedJob("removeGroupParticipants"),reportUserSpam:e.createNotImplementedJob("reportUserSpam"),requestReuploadMedia:e.createNotImplementedJob("requestReuploadMedia"),resendWrittenAppData:e.createNotImplementedJob("resendWrittenAppData"),restoreProtobufsFromEncryptedBackups:e.createNotImplementedJob("restoreProtobufsFromEncryptedBackups"),restoreThreadsFromEncryptedBackups:e.createNotImplementedJob("restoreThreadsFromEncryptedBackups"),reuploadMedia:e.createNotImplementedJob("reuploadMedia"),sendAppData:e.createNotImplementedJob("sendAppData"),sendGroupInviteMsg:e.createNotImplementedJob("sendGroupInviteMsg"),sendWrittenAppData:e.createNotImplementedJob("sendWrittenAppData"),setGroupSubject:e.createNotImplementedJob("setGroupSubject"),startInstamadilloDYI:o("IGDStartInstamadilloDYIJob").startInstamadilloDYI,updateBackupEntFbidForMedia:e.createNotImplementedJob("updateBackupEntFbidForMedia")}}l.getJobHandlers=e}),98);
__d("IGDLoadRecentParticipantsApi",["I64","LSIntEnum","MAWReStoreDb","ReQL","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=async function(n,r){var t=await o("MAWReStoreDb").getDB(i.id+":30"),a=await o("ReQL").toArrayAsync(o("ReQL").fromTableDescending(t.tables.threads.index("lastActivityTimestampMs")).filter(function(t){return(e||(e=o("I64"))).equal(t.threadType,(s||(s=o("LSIntEnum"))).ofNumber(1))}).take(n)),l=[];return a.forEach(function(t){var n=o("WAJids").interpretAsUserJid(o("WAJids").toMsgrUserJid((e||(e=o("I64"))).to_string(t.threadKey)));n!=null&&n!==r&&l.push(n)}),new Set(l)};l.loadRecentParticipants=u}),98);
__d("InstamadilloBackend",["cr:10745","cr:10746","cr:10747","cr:4772","cr:4849","cr:7098","cr:7691","cr:8224","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(e=n("cr:7098"))!=null?e:n("cr:10746"),c=(s=n("cr:4849"))!=null?s:n("cr:10747");function d(e){c!=null&&r("promiseDone")(c.setDeviceJid(e.deviceJid)),n("cr:8224")==null||n("cr:8224").initEbUploadQueue(),n("cr:7691")==null||n("cr:7691").initIGDEbRestoreProcessor(),n("cr:4772")==null||n("cr:4772").listenForEbUploadQueueFlush(),u!=null&&(u.initPendingMessageStanzaQueue(),r("promiseDone")(u.processFutureproofPendingMessageStanzas())),n("cr:10745")==null||n("cr:10745").startIGDDisappearingMsgCleaner()}l.init=d}),98);
__d("MAWDebugDefineFunctions",["MAWDebug","MAWDebugSendMultipleMsgs"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return{desc:e,execute:t,name:e,serializedArgs:[]}}function s(){var t=Object.keys(o("MAWDebug").MAWDebugFuncs).reduce(function(t,n){var r;return Object.assign(t,(r={},r[n]=e(n,o("MAWDebug").MAWDebugFuncs[n]),r))},{});return babelHelpers.extends({},t,{sendMultipleMsgs:o("MAWDebugSendMultipleMsgs").sendMultipleMsgs})}l.getAllDebugFunctions=s}),98);
__d("MAWServerRPC",["MAWHandleAbPropsRefreshNotification","MAWHandleAppdataMessage","MAWHandleChatState","MAWHandleFailure","MAWHandleFbDeviceChangeNotification","MAWHandleFbMultiwayNotification","MAWHandleFbThreadNotification","MAWHandleGroupNotification","MAWHandleGroupReceipt","MAWHandleGroupRetryReceipt","MAWHandleIndividualRetryReceipt","MAWHandleLoginSuccess","MAWHandlePeerAppdataReceipt","MAWHandlePeerAppdataRetryReceipt","MAWHandleRtcE2eeCallEventNotification","MAWHandleSpam","MAWHandleThreadMetadata","Promise","WAHandleErrorStanza","WAHandleIncomingMsg","WAHandleInfoBulletin","WAHandlePrekeyContactIDChangedNotification","WAHandlePrekeyDigestNotification","WAHandlePrekeyLowCountNotification","WAHandleReceipt","WAHandleServerPing","WAHandleStreamError","WALogger","WAServerRPC"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(){var t;return o("WAServerRPC").makeServerRPC({abprops:{handleAbPropsRefreshNotification:o("MAWHandleAbPropsRefreshNotification").handleAbPropsRefreshNotification},accountSync:null,appdataMessage:{handleAppdataMessage:o("MAWHandleAppdataMessage").handleAppdataMessage,handlePeerAppdataReceipt:o("MAWHandlePeerAppdataReceipt").handlePeerAppdataReceipt,handlePeerAppdataRetryReceipt:o("MAWHandlePeerAppdataRetryReceipt").handlePeerAppdataRetryReceipt},broadcast:{handleBroadcastMessage:function(r){var t=r.makeAck;return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Broadcast messages are not supported"]))),(u||(u=n("Promise"))).resolve(t())}},call:{handleRtcE2eeCallEvent:o("MAWHandleRtcE2eeCallEventNotification").handleRtcE2eeCallEventNotification},clientLog:null,comms:{handleEdgeRoutingInfo:o("WAHandleInfoBulletin").handleEdgeRoutingInfo,handleServerPing:o("WAHandleServerPing").handleServerPing},error:{handleErrorStanza:o("WAHandleErrorStanza").handleErrorStanza,handleSmaxErrorStanza:o("WAHandleErrorStanza").handleSmaxErrorStanza},fb:{handleFbDeviceChangeNotification:o("MAWHandleFbDeviceChangeNotification").handleFbDeviceChangeNotification,handleFbMultiwayNotification:o("MAWHandleFbMultiwayNotification").handleFbMultiwayNotification,handleFbThreadNotification:o("MAWHandleFbThreadNotification").handleFbThreadNotification},groupMessage:{handleGroupChatState:o("MAWHandleChatState").handleGroupChatState,handleGroupDirtyBit:null,handleGroupMessage:o("WAHandleIncomingMsg").handleGroupMessage,handleGroupNotification:o("MAWHandleGroupNotification").handleGroupNotification,handleGroupReceipt:o("MAWHandleGroupReceipt").handleGroupReceipt,handleGroupRetryReceipt:o("MAWHandleGroupRetryReceipt").handleGroupRetryReceipt},individualMessage:{handleIndividualChatState:o("MAWHandleChatState").handleIndividualChatState,handleIndividualMessage:o("WAHandleIncomingMsg").handleIncomingIndividualMsg,handleIndividualReceipt:o("WAHandleReceipt").handleIndividualReceipt,handleIndividualRetryReceipt:o("MAWHandleIndividualRetryReceipt").handleIndividualRetryReceipt},login:{handleLoginFailure:o("MAWHandleFailure").handleLoginFailure,handleLoginSuccess:o("MAWHandleLoginSuccess").handleLoginSuccess},md:null,newsletter:null,offline:{handleOfflineEnd:o("WAHandleInfoBulletin").handleOfflineEnd,handleOfflineStart:o("WAHandleInfoBulletin").handleOfflineStart,handleThreadMetadata:o("MAWHandleThreadMetadata").handleThreadMetadata},peerMessage:{handlePeerMessage:function(t){var e=t.makeAck;return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Peer messages are not supported"]))),(u||(u=n("Promise"))).resolve(e())}},prekey:{handlePrekeyContactIDChangedNotification:o("WAHandlePrekeyContactIDChangedNotification").handlePrekeyContactIDChangedNotification,handlePrekeyDigestNotification:o("WAHandlePrekeyDigestNotification").handlePrekeyDigestNotification,handlePrekeyLowCountNotification:o("WAHandlePrekeyLowCountNotification").handlePrekeyLowCountNotification},presence:null,serverProps:null,spam:{handleSpam:o("MAWHandleSpam").handleSpam},status:null,streamError:{handleAckKick:(t=o("WAHandleStreamError")).handleAckKick,handleBadMac:t.handleBadMac,handleConflict:t.handleConflict,handlePingKick:t.handlePingKick,handleStreamErrorCode:t.handleStreamErrorCode,handleXmlNotWellFormed:t.handleXmlNotWellFormed},syncd:null,usync:null})}l.makeServerRPC=c}),98);
__d("WADebugTools",["WADevToolsDebugFns"],(function(t,n,r,o,a,i,l){"use strict";function e(e){self.Debug==null&&(self.Debug={});var t=function(){var t=e[n];self.Debug[t.name]=function(){return t.execute.apply(t,arguments)}};for(var n in e)t();o("WADevToolsDebugFns").registerDebugFnsToDevTool(e)}l.initDebugFunctions=e}),98);
__d("IGDBackend",["IGDAWDebug","IGDAWMainWebWorkerConfig","IGDBackendBridgeHandlers","IGDCOP","IGDJobHandlers","IGDLoadRecentParticipantsApi","InstamadilloBackend","MAWClearSignalAndTempStores","MAWCommsConfig","MAWConfig","MAWCreateGroupApi","MAWCurrentUser","MAWDebugDefineFunctions","MAWDefinePersistedJob","MAWEphemeralConsts","MAWExternalId","MAWExtractMsFromExternalId","MAWFbCat","MAWHandleReachabilityErrorAdminMsgApi","MAWMpsBridgeHandlers","MAWQplProxy","MAWReStoreDb","MAWServerRPC","MAWSharedOfflineQueueMetric","MAWSharedOfflineResumeUINotifier","MAWTaskDefinitions","WAArrayBufferUtils","WADebugTools","WAMessageLoggingPublisher","WAMockServerShell","WAPassiveMode","WAQueryGroupOverChatD","WAService","WATagsLogger","WAWaitForComms","WAWaitForUserUnblocked","isUseridAnnotationEnabled","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("WATagsLogger").TAGS(["backend"]);async function m(t,n,a,i,l){d.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["initWAInfra"]))),d.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["deviceJid: ",""])),t.deviceJid),o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(25310776,"6155"),"igd_backend_setup_start"),o("MAWFbCat").setFbCat(o("WAArrayBufferUtils").stringToArrayBuffer(t.fbCat));var m=o("MAWServerRPC").makeServerRPC(),p=await o("WAService").makeWAService({config:l,dependencies:{clearSignalAndTempStores:o("MAWClearSignalAndTempStores").clearSignalAndTempStores,createGroups:o("MAWCreateGroupApi").createGroups,ephemeralMaxDeletionWindowForUnseenMessage:function(){return o("MAWEphemeralConsts").ephemeralMaxDelectionWindowForUnseenMessage},extractMsFromStanzaId:o("MAWExtractMsFromExternalId").extractMsFromStanzaId,generateExternalId:o("MAWExternalId").generateExternalId,handleReachabilityErrorAdminMsg:o("MAWHandleReachabilityErrorAdminMsgApi").handleReachabilityErrorAdminMsg,isEmployee:o("MAWCurrentUser").isEmployee,isUseridAnnotationEnabled:r("isUseridAnnotationEnabled"),loadRecentParticipants:o("MAWReStoreDb").shouldUseReStoreDb()?o("IGDLoadRecentParticipantsApi").loadRecentParticipants:function(){return Promise.resolve(new Set)},mediaUploadRoot:function(){return"/wa-igd/mms"},queryGroup:o("WAQueryGroupOverChatD").queryGroupOverChatD,recordDeviceChangeHistory:function(){return Promise.resolve()}},getCommsConfig:o("MAWCommsConfig").getCommsConfig,hmacKey:n,newClockSkewCalculation:function(){return!0},qpl:{franking:r("qpl")._(25299246,"150"),messageReceiveReliability:r("qpl")._(25306682,"11176")},regData:t,serverRPC:m}).catch(function(e){throw d.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to init worker (post-startup): ",""])),e),e}),_=o("MAWSharedOfflineQueueMetric").makeOfflineQueueMetric(p.oneQueue,o("WAPassiveMode").passiveModeNotifier,o("WAMessageLoggingPublisher").messageLoggingPublisher);o("MAWConfig").setConfig(o("IGDAWMainWebWorkerConfig").mawConfig),o("IGDCOP").cop.subscribeToOfflineQueue(p.oneQueue,p.protocolQueue),o("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.subscribeToWAEvents(p.oneQueue),o("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.subscribeToMawEvents(o("IGDCOP").cop),o("WAMockServerShell").isMockServerMode||r("promiseDone")(o("WAWaitForComms").waitForComms().then(function(){return o("MAWTaskDefinitions").registerTasks(o("WAWaitForUserUnblocked").waitForUserUnblocked())})),a.setHandlers("backend",o("IGDBackendBridgeHandlers").getIGDBridgeHandlers(d)),a.setHandlers("mps",o("MAWMpsBridgeHandlers").mpsBridgeHandlers),o("InstamadilloBackend").init(t),o("MAWDefinePersistedJob").setMsgrJobImplementations(o("IGDJobHandlers").getJobHandlers()),await p.startComms(),d.LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Worker inited"]))),o("WAWaitForComms").unblockComms(),o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(25310776,"6155"),"igd_backend_setup_end")}l.startIGDBackend=m}),98);
__d("IGDLowLevelApiImpl",["IGDLowLevelApiBridgeHandlers"],(function(t,n,r,o,a,i,l){"use strict";function e(){return{bridgeHandlers:o("IGDLowLevelApiBridgeHandlers").igdBridgeHandlers}}l.makeLowLevelApi=e}),98);
__d("MAWBackendBridgeSetup",["EBSMBridgeHandlers","MAWBridge","MAWBridgeODSLogger","WAAPIBridgeHandlers","WACrossWorkerPortal","WAResultOrError","getErrorSafe","justknobx","pageID"],(function(t,n,r,o,a,i,l){"use strict";function e(e){try{var t=s();return t.setPort(e.getBridgePort()),o("WAResultOrError").makeResult(null)}catch(e){return o("WAResultOrError").makeError(r("getErrorSafe")(e))}}function s(){var e=o("MAWBridge").getBridge();e.setHandlers("waapi",o("WAAPIBridgeHandlers").waapiBridgeHandlers),e.setHandlers("ebsmapi",o("EBSMBridgeHandlers").ebsmapiBridgeHandlers);var t={bridgeBatcherMaxTokens:Number.MAX_SAFE_INTEGER};r("justknobx")._("5256")&&(t=babelHelpers.extends({},t,{onSendAcross:o("MAWBridgeODSLogger").logCrossWorkerPortalODS}));var n=o("WACrossWorkerPortal").attachPortal(e,["event","threadEvent"],function(e,t){var n=e.length>0?e[e.length-1]:null;return n!=null&&n.type==="request"&&n.content.name==="uiUpdate"&&n.content.arg.events&&t.type==="request"&&t.content.name==="uiUpdate"?Array.prototype.push.apply(n.content.arg.events,t.content.arg.events):e.push(t),e},r("pageID"),t);return n}l.initWorkerBridge=e}),98);
__d("MAWCompareWorkerSetupArgs",["BackendInitLoggingUtils","FBLogger","MAWCurrentUser","MessengerWebInitData","WACryptoUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){if(e.prefixAndSuffix!==t.prefixAndSuffix)return!1;var n=e.encryptionKey,a=t.encryptionKey;if(n==null&&a==null)return!0;if(n==null&&a!=null||n!=null&&a==null)return!1;if(n==null||a==null)throw r("FBLogger")("messenger_web").mustfixThrow("encryptionKeyA and encryptionKeyB cannot be null at this point");return o("WACryptoUtils").arrayBuffersEqual(n,a)}function s(t,n){if(r("MessengerWebInitData").sessionId===n.sessionId?o("BackendInitLoggingUtils").MAWInitPoint("setup_args_session_ids_match"):o("BackendInitLoggingUtils").MAWInitPoint("setup_args_session_ids_mismatch"),n.sessionId!==r("MessengerWebInitData").sessionId){var a=!0;if(r("MessengerWebInitData").createdAt!=null&&n.createdAt!=null&&(a=n.createdAt>r("MessengerWebInitData").createdAt),n.createdAt==null&&r("MessengerWebInitData").createdAt!=null&&(a=!1),a)return o("BackendInitLoggingUtils").MAWInitPoint("setup_args_current_session_ids_mismatch"),{hasArgsChanged:!0,reason:"session_id_change"}}var i=o("MAWCurrentUser").getID();return n.fbId!==i?(r("FBLogger")("messenger_web").mustfix("FBID mismatch during worker setup. %s:%s:%s:%s",i==="0",i.length,n.fbId==="0",n.fbId.length),{hasArgsChanged:!0,reason:"fbid_change"}):(o("BackendInitLoggingUtils").MAWInitPoint("setup_args_fb_ids_match"),e(n.vaultMaterials,t.vaultMaterials)?{hasArgsChanged:!1,reason:"args_ok"}:{hasArgsChanged:!0,reason:"vault_materials_change"})}l.didWorkerSetupArgsChange=s}),98);
__d("MAWDeviceRegistrationODSBump",["MAWCurrentUser","MAWODSProxy","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";function e(e){o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.DEVICE_REGISTRATION,key:e}),o("MAWCurrentUser").isEmployee()||o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.DEVICE_REGISTRATION_NON_EMPLOYEE,key:e})}l.default=e}),98);
__d("MAWCryptoAuthTokenWrapper",["MessengerWebInitData"],(function(t,n,r,o,a,i,l){"use strict";function e(){return o("MessengerWebInitData").cryptoAuthToken}l.getCryptoAuthToken=e}),98);
__d("WASignedKeyApi",["WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("WASignalDB").getDb().runInTransaction(["signedPrekey"],"readonly",function(t){return t.stores.signedPrekey.get(e)},o("WASignalDB").signalOp("getSignedKey"))}l.getSignedKey=e}),98);
__d("MAWDeviceRegistrationActions",["MAWLoggerUtils","MAWODSProxy","MWFBLogger","MessengerWebInitData","WADbSignal","WAGetRegistrationInfoApi","WAOdsEnums","WASignedKeyApi"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f="Device registration meta is incomplete: ",g=o("MWFBLogger").MWLogger().tags([o("MAWLoggerUtils").Tag.DeviceRegistration]);function h(t,n,r,a,i){(t!=null||n!=null||r!=null||a!=null||i!=null)&&(t==null&&g.MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),f,o("WADbSignal").MetaKeysEnum.lastSignedPrekeyId),n==null&&g.MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),f,o("WADbSignal").MetaKeysEnum.deviceUUID),r==null&&g.MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),f,o("WADbSignal").MetaKeysEnum.regId),a==null&&g.MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),f,o("WADbSignal").MetaKeysEnum.identityKeyPair),i==null&&g.MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),f,o("WADbSignal").MetaKeysEnum.fbid))}async function y(){var e=await o("WAGetRegistrationInfoApi").getRegistrationInfo(),t=e.deviceId,n=e.deviceUUID,a=e.fbid,i=e.identityCompareResult,l=e.identityKeyPair,s=e.lastSessionDeviceWasLinkedTo,u=e.lastSignedPrekeyId,c=e.regId,d=e.registrationUnixTime,y=e.registrationVersion;if(i||o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.COMPARE_IDENTITY,key:"meta_identity_mismatch"}),u==null||n==null||c==null||l==null||a==null)return h(u,n,c,l,a),null;if(r("MessengerWebInitData").sessionId==null&&g.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["MAWDeviceRegistrationActions: sessionId is null"]))),t!=null&&typeof t!="number")return g.MUSTFIX(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[Device Registration Meta Check] Device Id should be a number"]))),null;var C=await o("WASignedKeyApi").getSignedKey(u);return C==null?(g.MUSTFIX(_||(_=babelHelpers.taggedTemplateLiteralLoose(["",": signedPrekey}"])),f),null):{deviceId:t,deviceUUID:n,identityCompareResult:i,lastSessionDeviceWasLinkedTo:s,lastSignedPrekeyId:u,registrationUnixTime:d,registrationVersion:y!=null?y:void 0,signalRegInfo:{identityKeyPair:l,regId:c,signedPreKey:C}}}l.getRegistrationMetaWorm=y}),98);
__d("XArmadilloWebLinkDeviceToSessionControllerRouteBuilder",["jsRouteBuilder"],(function(t,n,r,o,a,i,l){var e=r("jsRouteBuilder")("/messenger/armadillo/link_device/",Object.freeze({}),void 0),s=e;l.default=s}),98);
__d("MAWDeviceRegistrationSessionUtil",["CSRFGuard","CurrentMessengerUser","DTSG","DTSGUtils","MAWLoggerUtils","MWFBLogger","PHPQuerySerializer","SprinkleConfig","WAAPI","WAWorkerGlobalScope","XArmadilloWebLinkDeviceToSessionControllerRouteBuilder","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("MWFBLogger").MWLogger().tags([o("MAWLoggerUtils").Tag.DeviceRegistration,"LinkDeviceToTheSession"]);async function f(t,n){var a,i,l,f=(a=o("WAWorkerGlobalScope").workerGlobalScope.location)==null?void 0:a.origin;if(!(f==null||f==="")&&!(o("CurrentMessengerUser").isTestUser()&&f.includes("twshared"))){if(t==null){_.MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["DeviceUUID is null"])));return}var g=new URL(f).hostname,h=(i=r("XArmadilloWebLinkDeviceToSessionControllerRouteBuilder").buildUri({}).setDomain(g))==null||(i=i.setProtocol("https"))==null?void 0:i.toString();if(h!=null){var y=o("DTSG").getToken();if(y!=null){var C={device_id:t,fb_dtsg:y};r("SprinkleConfig").param_name&&(C[r("SprinkleConfig").param_name]=r("DTSGUtils").getNumericValue(y));var b=o("WAWorkerGlobalScope").workerGlobalScope.fetch,v;try{v=await b(h,{body:(p||(p=r("PHPQuerySerializer"))).serialize(C),headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",redirect:"error"})}catch(e){_.catching(r("getErrorSafe")(e)).MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Fetch error, fetch defined: ",""])),b!=null);return}if(!v.ok){_.MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Fetch is not 200: ",""])),v.status);return}var S=await v.text();o("CSRFGuard").exists(S)&&(S=o("CSRFGuard").clean(S));var R;try{R=JSON.parse(S)}catch(e){_.catching(r("getErrorSafe")(e)).MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Parse response error"])));return}((l=R)==null?void 0:l.success)===!0?(_.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["LinkDeviceToTheSession success"]))),await r("WAAPI").saveLastSessionDeviceWasLinkedTo({sessionId:n})):_.WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["fetch result is not successful"])))}}}}l.linkDeviceToTheSession=f}),98);
__d("WAIdentityApi",["WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return o("WASignalDB").getDb().runInTransaction(["identity"],"readwrite",function(e){return e.stores.identity.bulkPut([t])},o("WASignalDB").signalOp("saveIdentity")).then(function(){})};l.saveIdentity=e}),98);
__d("WMIRateLimitSchema",[],(function(t,n,r,o,a,i){"use strict";var e={autoIncrement:!0,indexes:{by_key_and_timestamp:{fields:["key","timestamp"],unique:!1},key:{fields:["key"],unique:!1}},primaryKey:"id",secure:!1},l={rateLimitAttempts:e};i.schemaConfig=l}),66);
__d("WMIRateLimitDb",["MAWCurrentUser","MAWIndexedDbMetadata","MAWWormOdsLogger","MessengerWebInitData","WAHex","WMIRateLimitSchema","Worm","WormEAR","WormIDbDriver","memoizeWithArgs","nullthrows","qpl"],(function(t,n,r,o,a,i,l){"use strict";async function e(){var e=o("MAWCurrentUser").getID(),t=o("MAWIndexedDbMetadata").wmiRateLimitDbName(e),n="wmi_rate_limit",a=r("qpl")._(1056840657,"2716"),i=r("nullthrows")(r("MessengerWebInitData").accountKeyV2),l=o("WAHex").parseHex(i),s=new(o("WormEAR")).WormEAR(o("WMIRateLimitSchema").schemaConfig,n,l),u=new(o("WormIDbDriver")).WormIDbDriver(t,n,o("WMIRateLimitSchema").schemaConfig,s,o("MAWWormOdsLogger").wormOdsWorkerLogger),c=new(o("Worm")).WormDatabase(u,a);return await c.init(),c}var s=r("memoizeWithArgs")(function(){return e()},function(){return"cache"});l.getRateLimitDb=s}),98);
__d("WMIRateLimiter",["WATimeUtils","WMIRateLimitDb"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.key,n=e.limit,r=e.windowMs,a=o("WATimeUtils").unixTimeMs(),i=a-r,l=await o("WMIRateLimitDb").getRateLimitDb(),s=await l.runInTransaction(["rateLimitAttempts"],"readwrite",async function(e){var n=await e.stores.rateLimitAttempts.readIndexRange("by_key_and_timestamp",{greaterThanOrEqual:[t,o("WATimeUtils").castMilliSecondsToUnixTime(i)]}),r=await e.stores.rateLimitAttempts.readIndexRange("by_key_and_timestamp",{greaterThanOrEqual:[t,o("WATimeUtils").castMilliSecondsToUnixTime(0)],lessThan:[t,o("WATimeUtils").castMilliSecondsToUnixTime(i)]});if(r.length>0){var a=r.map(function(e){return e.id});await e.stores.rateLimitAttempts.bulkDelete(a)}return n.length},"checkRateLimit"),u=s>=n;return{currentCount:s,limitBreached:u}}async function s(e){var t=await o("WMIRateLimitDb").getRateLimitDb(),n=o("WATimeUtils").castMilliSecondsToUnixTime(o("WATimeUtils").unixTimeMs()),r=await t.runInTransaction(["rateLimitAttempts"],"readwrite",async function(t){var r={key:e,timestamp:n},o=await t.stores.rateLimitAttempts.bulkAdd([r]),a=o[0];return{id:a,key:e,timestamp:n}},"recordAttempt");return r}async function u(t){var n=await e(t);return n.limitBreached||await s(t.key),n}l.queryRateLimitStore=e,l.recordAttempt=s,l.checkAndRecordAttempt=u}),98);
__d("MAWDeviceRegistrationWorker",["IGDWebUtils","MAWClearSignalAndTempStores","MAWCryptoAuthTokenWrapper","MAWCurrentUser","MAWDeviceRegistrationActions","MAWDeviceRegistrationODSBump","MAWDeviceRegistrationSessionUtil","MAWDeviceRegistrationUtilWorker","MAWJids","MAWLoggerUtils","MAWODSProxy","MAWQplProxy","MWFBLogger","MessengerWebInitData","QPLFlow","UserAgentData","WADbDeviceRegistration","WADbMetaTxns","WADbRegistrationApi","WAICDCUtils","WAIdentityApi","WAIdentityUtils","WAJids","WAMockServerShell","WAOdsEnums","WAPreRegistrationCrypto","WASignalKeys","WATimeUtils","WMIRateLimiter","cr:7755","getErrorSafe","getSafeQplErrorMessage","justknobx","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y=r("justknobx")._("3282"),C=r("justknobx")._("3325"),b={key:"device_registration",limit:C,windowMs:3600*1e3},v=o("MWFBLogger").MWLogger().tags([o("MAWLoggerUtils").Tag.DeviceRegistration]),S=function(){return o("IGDWebUtils").isInstagramWebSupportedApp(Number(o("MAWCurrentUser").getAppID()))};function R(e){return e===0x453bf7349370c||e===936619743392459||e===487152425211411||e===0x3ae327b82f808?"instagram.com":e===772021112871879?"messenger.com":e===0x7e36f3fcc43bc?"facebook.com":"unknown"}function L(e,t){return t===void 0&&(t=400),{message:e,registrationState:{type:o("WADbDeviceRegistration").RegistrationStatesEnum.failed},status:t}}async function E(t,n,a){var i,l=T(n,a);v.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Beginning device registration"])));var u=await o("MAWDeviceRegistrationUtilWorker").createNewRegistrationMeta();l.addPoint("registration_created"),n.addAnnotations({string:{unique_device_id:u.deviceUUID}}),await o("WADbRegistrationApi").saveRegistrationMeta(o("MAWCurrentUser").getID(),u),l.addPoint("registration_saved");var c=o("MAWCurrentUser").getID(),d=u.deviceUUID,m=o("WAPreRegistrationCrypto").serializeRegistrationData(u.signalRegInfo),p=null,_=!1,f=(i=_?0x39f22521e351a:o("MAWCurrentUser").getAppID())==null?void 0:i.toString();if(f==null)return L("appId is null, cannot register to WhatsApp");if(c==="0")return L(o("WADbDeviceRegistration").DEVICE_REGISTER_ERROR_ZERO_AS_USER_ID);var g=async function(){try{var e=await o("QPLFlow").QplSubspan.wrapInSubspan(l,"icdc_fetch",function(){return o("MAWDeviceRegistrationUtilWorker").fetchICDC(c,t.encrypted_serialized_cat,f,d)});return o("QPLFlow").QplSubspan.wrapInSubspan(l,"icdc_compute",async function(){var t=[].concat(o("WAICDCUtils").base64DeviceIdentitiesToSerializedPubKeys(e.device_identities));if(e.curr_identity_idx!=null){var n=e.curr_identity_idx;t[n]=o("WASignalKeys").serializeIdentity(m.identityPubKey)}else t.push(o("WASignalKeys").serializeIdentity(m.identityPubKey));var r=o("WAICDCUtils").computeICDCInfoForUpload(u.signalRegInfo.identityKeyPair,e.icdc_seq,t,"registration","registration"),a=await o("WAIdentityUtils").computeIdentitiesHash(t);return{icdc:r,ihash:a}})}catch(e){v.catching(r("getErrorSafe")(e)).MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Cannot process ICDC payload during registration"])))}return{icdc:null,ihash:null}},h=await g(),y=h.icdc,C=h.ihash,b=!1;try{var R,E=await o("MAWDeviceRegistrationUtilWorker").register(c,t.encrypted_serialized_cat,f,d,m.regId,m.identityPubKeyType,m.identityPubKey,m.signedPreKey,y&&C?{ihash:C,seq:y.icdcInfo.seq,signedICDCIdentityList:y.encodedSignedICDC,ts:y.icdcInfo.timestamp}:null);l.addPoint("device_registered");var k=E==null?void 0:E.type;if(k!=null&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.REGISTRATION_TYPE,key:k}),!E||!(E!=null&&E.success)){var I,D;return{message:(I=E==null?void 0:E.message)!=null?I:o("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER,registrationState:{type:o("WADbDeviceRegistration").RegistrationStatesEnum.failed},status:(D=E==null?void 0:E.status)!=null?D:"400"}}p=E.wa_device_id,b=(R=E.icdc_success)!=null?R:!1}catch(e){return L(o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e))}if(p==null)return L(o("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER);var x=o("MAWJids").toUserJid(c);if(!S()){var $=r("MessengerWebInitData").sessionId;$!=null&&r("promiseDone")(o("MAWDeviceRegistrationSessionUtil").linkDeviceToTheSession(d,$))}if(y!=null&&b){var P=y.icdcInfo;await o("WADbRegistrationApi").saveICDC(x,{devices:P.devices,dirty:!0,sequence:P.seq,signingDeviceIndex:P.signingDeviceIndex,timestamp:P.timestamp}),n.addPoint("icdc_saved")}await o("WADbRegistrationApi").saveDeviceId(p),n.addPoint("device_saved");var N={deviceJid:o("WAJids").toDeviceJid(x,p),identity:o("WASignalKeys").serializeIdentity(u.signalRegInfo.identityKeyPair.publicKey),userJid:x};return await o("WAIdentityApi").saveIdentity(N),n.addPoint("identity_saved"),{message:o("WADbDeviceRegistration").DEVICE_SUCCESSFULLY_REGISTERED,registrationState:{registrationTime:u.registrationUnixTime,type:o("WADbDeviceRegistration").RegistrationStatesEnum.finished},status:200}}async function k(e,t){var a=o("MAWQplProxy").startQplUserFlow(r("qpl")._(25307273,"1410"),{string:{browser_name:r("UserAgentData").browserName,device_os:r("UserAgentData").platformName,device_os_version:r("UserAgentData").platformVersion,interface:R(Number(o("MAWCurrentUser").getAppID()))}},{providedTimeoutInMs:2e4}),i=function(t,n){return o("MAWQplProxy").measurePerfInQPL(a,t,n)};try{var l=t!=null?t:o("MAWCryptoAuthTokenWrapper").getCryptoAuthToken();if(l==null||l.encrypted_serialized_cat==="")return v.WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Crypto Auth Token was null or incomplete"]))),a.endFail("empty_cat_token"),L(o("WADbDeviceRegistration").DEVICE_REGISTER_ERROR_EMPTY_CAT_TOKEN,414);if(e!=null&&o("MAWQplProxy").sendQPLAnnotationsThroughBridge(e,{int:{secondsUntilCATExpiration:Math.floor(l.expiration_time_in_seconds-Date.now()/1e3)}}),!o("WATimeUtils").isInFuture(o("WATimeUtils").castToUnixTime(l.expiration_time_in_seconds)))return a.endFail("expired_cat_token"),L(o("WADbDeviceRegistration").DEVICE_REGISTER_ERROR_EXPIRED_CAT_TOKEN,413);if(o("WAMockServerShell").isMockServerMode){var s=await o("MAWDeviceRegistrationUtilWorker").createNewRegistrationMeta();return await Promise.all([o("WADbRegistrationApi").saveRegistrationMeta(o("MAWCurrentUser").getID(),s),o("WADbRegistrationApi").saveDeviceId(o("WAJids").interpretAsDeviceId(1)),o("WADbMetaTxns").saveCAT(l)]),a.addPoint("wa_device_registration_mock_server"),a.endSuccess(),{message:"Skipping registration because of Mock Server",registrationState:{registrationTime:s.registrationUnixTime,type:o("WADbDeviceRegistration").RegistrationStatesEnum.finished},status:200}}n("cr:7755")!=null&&await n("cr:7755").updateRegDataFromLocalStorage();var g=o("MAWDeviceRegistrationActions").getRegistrationMetaWorm(),h=await i("get_registration_data",g);a.addAnnotations({string:{unique_device_id:h==null?void 0:h.deviceUUID}}),e!=null&&o("MAWQplProxy").sendQplPointThroughBridge(e,"device_registration_check",{annotations:{bool:{identityCompareResult:h==null?void 0:h.identityCompareResult},int:{registrationVersion:h==null?void 0:h.registrationVersion}}});var k=(h==null?void 0:h.identityCompareResult)===!1;if(h==null||h.deviceId==null||k){if(a.addAnnotations({bool:{isNewRegistartion:!0}}),e!=null&&o("MAWQplProxy").sendQplPointThroughBridge(e,"device_registration_new_reg_start"),v.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["RATE LIMIT SETTINGS LOG ONLY: "," ENABLED: "," COUNT: ",""])),r("justknobx")._("3587"),y,C),y){var I=await o("WMIRateLimiter").checkAndRecordAttempt(b),T={bool:{rateLimitBreached:I.limitBreached},int:{rateLimitCount:I.currentCount}};if(a.addAnnotations(T),v.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Client rate limiting check complete. ","/"," attempts."])),I.currentCount,b.limit),I.limitBreached)if(r("justknobx")._("3587"))a.addAnnotations({bool:{rateLimitLogOnly:!0}}),v.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Device registration client rate limit exceeded (not skipping). ","/"," attempts."])),I.currentCount,b.limit);else return v.MUSTFIX(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Device registration client rate limit exceeded. ","/"," attempts."])),I.currentCount,b.limit),a.endFail("client_rate_limit_exceeded"),L("client_rate_limit_exceeded",500);v.DEBUG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Device registration rate limit check passed"])))}try{await i("clear_signal_stores",o("MAWClearSignalAndTempStores").clearSignalAndTempStores()),e!=null&&o("MAWQplProxy").sendQplPointThroughBridge(e,"device_registration_signal_temp_stores_cleared"),await i("save_cat",o("WADbMetaTxns").saveCAT(l)),e!=null&&o("MAWQplProxy").sendQplPointThroughBridge(e,"device_registration_cat_saved")}catch(e){return L(o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e))}var D=await i("try_register",E(l,a,e));return D.registrationState.type===o("WADbDeviceRegistration").RegistrationStatesEnum.failed?a.endFail("wa_device_registration_failed",{string:{errorMsg:D.message}}):(a.addPoint("wa_device_registration_successful"),a.endSuccess()),e!=null&&o("MAWQplProxy").sendQplPointThroughBridge(e,"device_registration_new_reg_end"),D}else{a.addAnnotations({bool:{isNewRegistartion:!1}}),e!=null&&o("MAWQplProxy").sendQplPointThroughBridge(e,"device_registration_existing_reg_start"),await i("save_cat",o("WADbMetaTxns").saveCAT(l));var x=r("MessengerWebInitData").sessionId,$=h.lastSessionDeviceWasLinkedTo==null||h.lastSessionDeviceWasLinkedTo!==x;x!=null&&!(h.deviceUUID===x||h.deviceUUID.startsWith(x+"-"))&&$&&!S()&&r("promiseDone")(o("MAWDeviceRegistrationSessionUtil").linkDeviceToTheSession(h.deviceUUID,x)),e!=null&&o("MAWQplProxy").sendQplPointThroughBridge(e,"device_registration_existing_reg_end")}return r("MAWDeviceRegistrationODSBump")("already_registered"),a.addPoint("wa_device_registration_persisted"),a.endSuccess(),v.DEBUG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Skipping device registration"]))),{message:o("WADbDeviceRegistration").DEVICE_ALREADY_REGISTERED,registrationState:{type:o("WADbDeviceRegistration").RegistrationStatesEnum.finished},status:200}}catch(e){var P,N=r("getErrorSafe")(e);throw a.endFail("uncaught_exception",{string:{errorMsg:(P=N.message)!=null?P:"No error message"}}),N}}function I(e){r("MAWDeviceRegistrationODSBump")("fail"),v.MUSTFIX(g||(g=babelHelpers.taggedTemplateLiteralLoose(["",""])),o("WADbDeviceRegistration").FAILED_REGISTRATION_RETRIES);for(var t of e)v.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Device registration failure - ",""])),t)}function T(e,t){return{addAnnotations:function(r){e.addAnnotations(r),t!=null&&o("MAWQplProxy").sendQPLAnnotationsThroughBridge(t,r)},addPoint:function(r,a){e.addPoint(r,a),t!=null&&o("MAWQplProxy").sendQplPointThroughBridge(t,"device_registration_"+r,{annotations:a})},endCancel:function(){},endFail:function(t,n){},endSuccess:function(){},getQPLAttrs:function(){return{instanceKey:0}},isActive:function(){return!0},start:function(){}}}l.handleRegistrationError=L,l.setupDeviceRegistration=k,l.logDeviceRegistrationRetryFailure=I}),98);
__d("MAWDeviceRegistrationInitWorker",["BackendInitLoggingUtils","BrowserLockManager","FBLogger","MAWDeviceRegistrationODSBump","MAWDeviceRegistrationWorker","MAWHMACKey","MAWQplProxy","MAWRotateCAT","MWFBLogger","WADbDeviceRegistration","WADbRegistrationApi","WAGetRegistrationInfoApi","WAPromiseRetryLoop","WARetryUtils","getErrorSafe","justknobx","memoizeOneWithArgs","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y=o("MWFBLogger").MWLogger().tags(["backend","init","deviceRegistration"]);function C(t){return t===void 0&&(t=!0),r("BrowserLockManager")!=null?o("BackendInitLoggingUtils").measureMawInit("request_maw_registration_lock",function(){return new Promise(function(n,o){r("promiseDone")(r("BrowserLockManager").request("maw_registration_lock",async function(){r("FBLogger")("wmi").tags(["backend","init","deviceRegistration"]).DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Running registerDevice with lock"])));try{var a=await b(t);n(a)}catch(e){o(e)}}))})}):(r("FBLogger")("wmi").tags(["backend","init","deviceRegistration"]).DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Running registerDevice without lock"]))),b(t))}var b=r("memoizeOneWithArgs")(async function(e){var t=await o("BackendInitLoggingUtils").measureMawInit("init_device_reg_overall",function(){return v()}),n=t.message,a=t.registrationState;if(a.type===o("WADbDeviceRegistration").RegistrationStatesEnum.failed)throw y.mustfixThrow("registration_failed: "+n);if(!e){y.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Skipping HMAC generation and registration data loading"])));return}r("FBLogger")("wmi").tags(["backend","init","deviceRegistration"]).DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Generating HMAC and loading registration data"])));var i=await Promise.all([o("BackendInitLoggingUtils").measureMawInit("load_reg_in_txn",function(){return o("WADbRegistrationApi").loadAllRegistrationMetaInTransaction()}),o("BackendInitLoggingUtils").measureMawInit("gen_insert_hmac",function(){return o("MAWHMACKey").generateAndInsertHMACKey()})]),l=i[0],s=i[1];return{hmacKey:s,regData:l}});function v(){var e=0,t=new Set,n=0,a=new(o("WAPromiseRetryLoop")).PromiseRetryLoop({code:async function(i){if(e++,e>o("WADbDeviceRegistration").MAX_DEVICE_REGISTRATION_RETRIES){o("MAWDeviceRegistrationWorker").logDeviceRegistrationRetryFailure(t);var a=o("MAWDeviceRegistrationWorker").handleRegistrationError(o("WADbDeviceRegistration").FAILED_REGISTRATION_RETRIES);i(a);return}try{var l=null;switch(n){case 414:case 413:case 418:{y.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration ",". Rotate CAT"])),n),l=await o("MAWRotateCAT").rotateCAT({initiator:"MAWDeviceRegistrationInitWorker::initDeviceRegistration",qplAnnotations:{int:{prevStatusCode:n}}});break}case 400:case 401:{y.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration ",": User should re-login"])),n),r("justknobx")._("3526")&&(l=await o("MAWRotateCAT").rotateCAT({initiator:"MAWDeviceRegistrationInitWorker::initDeviceRegistration",qplAnnotations:{int:{prevStatusCode:n}}}));break}case 415:{y.MUSTFIX(p||(p=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration 415: User should take action to  re-register to WAI"])));break}case 403:{y.MUSTFIX(_||(_=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration 403: User is banned"])));break}case 500:{y.MUSTFIX(f||(f=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration 500: Retry is needed"])));break}}var s=e===1?r("qpl")._(25310776,"6155"):null,u=await o("MAWDeviceRegistrationWorker").setupDeviceRegistration(s,l);n=u.status,r("MAWDeviceRegistrationODSBump")("attempt."+e+".result."+u.registrationState.type),u.registrationState.type===o("WADbDeviceRegistration").RegistrationStatesEnum.finished&&(u.registrationState.registrationTime!=null&&r("MAWDeviceRegistrationODSBump")("success"),y.DEBUG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Registration finished, ending device registration promise retry loop"]))),i(u)),t.add(u.message),o("MAWQplProxy").sendQPLAnnotationsThroughBridge(r("qpl")._(25310776,"6155"),{int:{deviceRegistrationLastAttemptCount:e},string:{deviceRegistrationLastAttemptMessages:Array.from(t).join(", ")}})}catch(n){var c=r("getErrorSafe")(n),C="Uncaught device registration error - "+c.message;y.WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",""])),C),t.add(""+C),o("MAWQplProxy").sendQPLAnnotationsThroughBridge(r("qpl")._(25310776,"6155"),{int:{deviceRegistrationLastAttemptCount:e},string:{deviceRegistrationLastAttemptMessages:Array.from(t).join(", ")}})}},name:"deviceRegistration",timer:o("WARetryUtils").fibonacciBackoff(!0)});return a.start(),a.promise().then(function(e){return e.registrationState.type===o("WADbDeviceRegistration").RegistrationStatesEnum.finished&&r("promiseDone")(o("WAGetRegistrationInfoApi").updateRegistrationHistory(e.registrationState.registrationTime)),e})}l.registerDevice=C,l.performDeviceRegistration=b,l.initDeviceRegistration=v}),98);
__d("MAWDBKeychain",["BrowserLockManager","EARInitType","ExecutionEnvironment","FBLogger","MAWCurrentUser","MAWDexie","MAWIndexedDbMetadata","MWEARKeychainV3","MWSetupDBEncryption"],(function(t,n,r,o,a,i,l){"use strict";var e=["id"],s,u="encryptionMetaV3",c=function(t){t===void 0&&(t=o("MWEARKeychainV3").logMawInitPoint),t("maw_ear_check_mawdb_start");var e=o("MAWCurrentUser").getID(),n=o("MAWIndexedDbMetadata").dbName(e),a=new(r("MAWDexie"))(n,{addons:[]});return a.open().then(function(e){return t("maw_ear_check_mawdb_end"),e}).catch("NoSuchDatabaseError",function(){return t("maw_ear_check_mawdb_no_db"),null}).catch(function(e){throw t("maw_ear_check_mawdb_error"),e})},d=async function(t){t===void 0&&(t=o("MWEARKeychainV3").logMawInitPoint);var e=async function(){var e;try{if(e=await c(t),!e)return r("FBLogger")("messenger_web").info("MAWDB is missing for MAW EAR worker init."),t("maw_ear_new_user"),{isNewUser:!0,reinitEAR:!0,useMawEAR:!0};if(!e.backendDB().objectStoreNames.contains(u))return e.close(),r("FBLogger")("messenger_web").info("MAW EAR is missing for MAW EAR worker init."),t("maw_ear_missing_ear_table"),{reinitEAR:!0,useMawEAR:!0};var n=await p(e.backendDB());n.length===0&&(r("FBLogger")("messenger_web").info("Migrating global EAR to MAW EAR"),t("maw_ear_migrating"),await m(e.backendDB())),o("MWEARKeychainV3").setNamespaceSourceDbWithoutMarkingDbReady("maw_ear",e.backendDB()),t("maw_ear_init_keychain");var a=await o("MWEARKeychainV3").init("maw_ear",r("EARInitType").MAW_INIT,t);if(a.success===!1)throw a.payload!=null?a.payload:r("FBLogger")("messenger_web").mustfixThrow("Failed to init MAW EAR Keychain.");return t("maw_ear_success"),r("FBLogger")("messenger_web").info("MAW EAR worker successfully initialised."),{useMawEAR:!0}}finally{var i;o("MWEARKeychainV3").setNamespaceSourceDbWithoutMarkingDbReady("maw_ear",null),(i=e)==null||i.close()}};return new Promise(function(t,n){return r("BrowserLockManager")!=null?r("BrowserLockManager").request("mawdb_keychain_init_ear",function(){return e().then(t).catch(n)}):e().then(t).catch(n)}).catch(function(e){throw t("maw_ear_failure"),r("FBLogger")("messenger_web").catching(e).mustfixThrow("Failed to init MAW EAR Worker.")})},m=async function(n){var t=await o("MWSetupDBEncryption").init(r("EARInitType").MAW_INIT);if(!t.success)throw t.payload!=null?t.payload:r("FBLogger")("messenger_web").mustfixThrow("Failed to init global EAR.");var a=o("MWEARKeychainV3").getKeychain("global_ear");if(a.databaseEncryptionKeys.size===0)throw r("FBLogger")("messenger_web").mustfixThrow("Global EAR data is missing.");var i=Array.from(a.databaseEncryptionKeys.entries()).map(function(t){var n=t[0],r=t[1].dbEntry,o=r.id,a=babelHelpers.objectWithoutPropertiesLoose(r,e);return a});return new Promise(function(e,t){var r=n.transaction(u,"readwrite");i.forEach(function(e){r.objectStore(u).add(e)}),r.onerror=function(){return t(r.error)},r.oncomplete=function(){return e()}})};function p(e){return new Promise(function(t,n){var r=e.transaction(u,"readonly"),o=r.objectStore(u).getAll();o.onsuccess=function(){return t(o.result)},o.onerror=function(){return n(o.error)}})}function _(e,t){if(e.encryptionMetaV3!=null){var n=o("MWEARKeychainV3").getKeychainInitStatus("maw_ear");if(n==="none"&&t!=null){o("MWEARKeychainV3").logMawInitPoint("maw_ear_populate_unstored_key"),e.encryptionMetaV3.add(t);return}var a=o("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear",i=Array.from(o("MWEARKeychainV3").getKeychain(a).databaseEncryptionKeys).map(function(e){var t=e[0],n=e[1].dbEntry;return n});if(i.length>0)r("FBLogger")("messenger_web").info("DB re-populated after external DB deletion. Namespace: %s. isWorker: %s",a,(s||(s=r("ExecutionEnvironment"))).isInWorker),e.encryptionMetaV3.bulkPut(i),o("MWEARKeychainV3").setNamespaceSourceDbAndMarkAsReady("maw_ear",e.db.backendDB());else throw r("FBLogger")("messenger_web").mustfixThrow("No encryption keys to populate MAWDB. Namespace: %s. HasUnstoredKey: %s. isWorker: %s",a,!!t,(s||(s=r("ExecutionEnvironment"))).isInWorker)}}l.STORENAME=u,l.checkMawDbExists=c,l.initEAR=d,l.getEncryptionKeys=p,l.onDbPopulateMAWKeychain=_}),98);
__d("MAWMpsAppdataEncryptedBackupsSecretsPreprocessor",["FBLogger","MAWHandleEncryptedBackupsSecretsApi","MAWProtobufDeserializers","MpsPreprocessor","MpsTypes","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.backupId,n=e.epoch,a=e.mailboxRootKey,i=e.obliviousValidationToken,l=e.serverDataId,s=e.tempOcmfClientState;if(t==null||n==null||a==null||i==null||l==null||s==null)return r("FBLogger")("mps").warn("Cannot process encrypted backups secrets - mandatory data missing"),Promise.resolve();var u=n.map(function(e){var t=e.anonId,n=e.id,o=e.rootKey,a=e.status;return t==null||n==null||o==null||a==null?(r("FBLogger")("mps").warn("Encountered invalid epoch when processing encrypted backups secrets"),null):{anonId:t,id:n,rootKey:o,status:a}}).filter(Boolean),c={backupId:t,epoch:u,mailboxRootKey:a,obliviousValidationToken:i,serverDataId:l,tempOcmfClientState:s};return o("MAWHandleEncryptedBackupsSecretsApi").handleEncryptedBackupsSecret(c)}async function s(t,n){return await e(n),{directive:{actionType:o("MpsTypes").ActionType.Noop,debugFlags:["WA"],isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:t.message.messageId},insertionSource:t.insertionSource,message:t.message}}var u=o("MpsPreprocessor").preprocessor(async function(e){var t=e.ctx,n=e.payloadList,a=new Map,i=new Array(n.length),l=n.map(function(e,t){var n,l=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(e.message.payload);if(l.payload().kind!=="messageApplication"){i[t]=e;return}var u=(n=l.encryptedTransportMessage())==null||(n=n.armadillo())==null||(n=n.payload)==null||(n=n.signal)==null?void 0:n.encryptedBackupsSecrets;if(u==null){i[t]=e;return}return s(e,u).then(function(e){i[t]=e}).catch(function(t){a.set(e.message.messageId,r("getErrorSafe")(t))})});return l.length>0&&await Promise.all(l),{ctx:t,errors:a,payloadList:i}},"eb_appdata_secret");l.MAWMpsAppdataEncryptedBackupsSecretsPreprocessor=u}),98);
__d("MAWMpsGenerateMessageFromBackupMessage",["FBLogger","MAWProtobufDeserializers","MpsTypes","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){try{var n,a,i=e.decryptedProtobuf,l=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(i),s=l.payload().kind;if(s!=="messageApplication"&&s!=="adminMessage")return r("FBLogger")("mps").warn("Expected messageApplication or adminMessage, got %s",s),null;var u=(n=l.proto.metadata)==null?void 0:n.senderId,c=(a=l.proto.metadata)==null?void 0:a.messageId;return u!=null&&c!=null?{messageId:o("MpsTypes").toMessageId(c),payload:o("MpsTypes").toBytes(i),senderId:u,threadId:t,timestampMs:o("MpsTypes").toTimestamp(e.protobufTimestampMS)}:null}catch(e){var d=r("getErrorSafe")(e);throw r("FBLogger")("mps").catching(d).mustfix("Runtime error performing generateMessage: %s",d.message),d}}l.generateMessage=e}),98);
__d("MAWMpsGenerateSupplementalFromBackupMessage",["FBLogger","MAWProtobufDeserializers","MpsTypes","WALongInt","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";function e(e){try{var t,n,a=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(e);if(a.payload().kind!=="messageApplication")return r("FBLogger")("mps").warn("Expected messageApplication, got %s",a.payload().kind),null;var i=(t=a.proto.metadata)==null?void 0:t.messageId,l=(n=a.proto.metadata)==null?void 0:n.timestampMs;return i!=null&&l!=null?{messageId:o("MpsTypes").toMessageId(i),payload:o("MpsTypes").toBytes(e),timestampMs:o("MpsTypes").toTimestamp(o("WALongInt").numberOrThrowIfTooLarge(l))}:null}catch(e){var s=r("getErrorSafe")(e);throw r("FBLogger")("mps").catching(s).mustfix("Runtime error performing generateSupplemental: %s",s.message),e}}l.generateSupplemental=e}),98);
__d("MAWMpsDecryptedProtobufToFullMessage",["FBLogger","MAWMpsGenerateMessageFromBackupMessage","MAWMpsGenerateSupplementalFromBackupMessage","MpsTypes","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=[];try{return e.forEach(function(e){var r;if(e!=null){var a=o("MAWMpsGenerateMessageFromBackupMessage").generateMessage(e.toplevelProtobuf,t);if(a!=null){var i=new Map;e.supplementalProtobufs.forEach(function(e,t){var n=e.decryptedProtobuf,r=o("MAWMpsGenerateSupplementalFromBackupMessage").generateSupplemental(n);r!=null&&i.set(o("MpsTypes").toSupplementalKey(t),r)});var l={expiryTimestampMs:null,supplementalProtobufs:i,tags:(r=e.tags)!=null?r:[],toplevelProtobuf:a};n.push(l)}}}),n}catch(e){var a=r("getErrorSafe")(e);throw r("FBLogger")("wmi_eb").catching(a).mustfix("Runtime error performing decodeAndParseEbProtobufs for MPS: %s",a.message),a}}l.decryptedProtobufToFullMessage=e}),98);
__d("MAWMpsGenerateDeletionMessage",["FBLogger","MAWExternalId","MAWJids","WABuildMpsPayload","WAConvertAppData","WAJids","WAMsgApplication.pb","WAStanzaUtils","WATimeUtils","encodeProtobuf","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";function e(e){try{var t={actions:[{messageAction:{protocolMsgId:{author:o("MAWJids").toUserJid(e.senderId),chat:o("WAJids").unsafeCoerceToChatJid(e.threadId),externalId:o("WAStanzaUtils").toStanzaId(e.messageId)},type:"delete_for_me"}}],type:"meta_sync"},n=o("WAConvertAppData").convertAppData(t),a=o("encodeProtobuf").encodeProtobuf(o("WAMsgApplication.pb").MessageApplicationSpec,n).readByteArrayView();return o("WABuildMpsPayload").buildMpsMessage({encryptedTransportMessage:a},{externalId:o("MAWExternalId").generateExternalId(),millisServerTs:o("WATimeUtils").castToMillisTime(e.timestampMs),senderJid:o("MAWJids").toUserJid(e.senderId),threadId:o("WAJids").unsafeCoerceToChatJid(e.threadId)})}catch(e){var i=r("getErrorSafe")(e);throw r("FBLogger")("mps").catching(i).mustfix("Runtime error performing generateDeletionMessage for MPS"),e}}l.generateDeletionMessage=e}),98);
__d("MAWMpsMessagePointQuery",["EBMessagePointQuery","WAJids","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.ctx,n=e.messageIds,a=e.threadId;t.metric.addPoint("mps_message_point_query_start",{int:{batchSize:n.length}});var i=o("WAJids").validateChatJid(a),l=r("nullthrows")(i,"invalid threadId passed to validateThreadId: "+a);return o("EBMessagePointQuery").messagePointQuery({chatJid:l,messageIds:n})}l.MAWMpsMessagePointQuery=e}),98);
__d("MAWMpsMessageRangeQuery",["EBLS","EBMessageRangeQueryForThreads","LSMEBTaskCreationSource","MSGDataclassTypes.flow","MpsTypes","QPLFlow","WAJids","first","last","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.args,n=e.messageRangeInfo,a=e.messages,i=[].concat(a).sort(function(e,t){return e.toplevelProtobuf.protobufTimestampMS-t.toplevelProtobuf.protobufTimestampMS}),l=t.direction==="after"?n.has_more_after:n.has_more_before,s=t.direction==="after"?n.has_more_before:n.has_more_after,u=r("first")(i),c=r("last")(i);return{success:!0,value:{cursorInfo:{endCursor:u!=null?[o("MpsTypes").toTimestamp(u.toplevelProtobuf.protobufTimestampMS),o("MpsTypes").toMessageId(u.otid)]:null,hasNext:l,hasPrevious:s,startCursor:c!=null?[o("MpsTypes").toTimestamp(c.toplevelProtobuf.protobufTimestampMS),o("MpsTypes").toMessageId(c.otid)]:null},messages:i}}}function s(e,t){return t!=null&&t===r("LSMEBTaskCreationSource").MSGR_DYI?"messenger_dyi":e==="all"?"unknown":e.size===2&&e.has(o("MSGDataclassTypes.flow").MpsMessageTag.Video)&&e.has(o("MSGDataclassTypes.flow").MpsMessageTag.Photo)?"media_gallery_restore":e.size===1&&e.has(o("MSGDataclassTypes.flow").MpsMessageTag.File)?"file_gallery_restore":"unknown"}function u(e){var t=Date.now()+6e4,n=Math.max(0,Math.min(e[0],t));return[""+n,void 0]}function c(t){var n=t.ctx,a=t.ranges,i=t.source,l=t.tagsFilter;return o("QPLFlow").QplSubspan.wrapInSubspan(n.metric,"mps_message_range_query",async function(){n.metric.addAnnotations({int:{batchSize:a.length}});var t=(await o("EBLS").init()).db,c=s(l,i),d=await o("EBMessageRangeQueryForThreads").messageRangeQueryForThreads({restoreType:"range",source:c,storage:t,threads:a.map(function(e){return{chatJid:r("nullthrows")(o("WAJids").validateChatJid(e.threadId)),direction:e.direction==="asc"?"after":"before",from:u(e.from),numMessages:e.numMessages}})});return d.map(function(t){return t.success===!1?t:e(t.value)})})}l.MAWMpsMessageRangeQuery=c}),98);
__d("MAWMpsMutateMessagePreprocessor",["FBLogger","MAWMpsTypes","MAWProtobufDeserializers","MpsPreprocessor","MpsTypes","WAArmadilloApplication.pb","WAArmadilloBackupMessage.pb","WAJids","WAMsgApplication.pb","WAResultOrError","encodeProtobuf","err","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=[m,c,u];function s(e,t,n){var r={ephemeralType:n},a={payload:{content:{ravenMessage:r}}},i={metadata:t.metadata,payload:{subProtocol:{armadillo:{payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloApplication.pb").ArmadilloSpec,a).readBuffer(),version:1}}}},l=o("encodeProtobuf").encodeProtobuf(o("WAMsgApplication.pb").MessageApplicationSpec,i).readBuffer(),s={encryptedTransportMessage:l,metadata:e.proto.metadata};return o("MpsTypes").toBytes(o("encodeProtobuf").encodeProtobuf(o("WAArmadilloBackupMessage.pb").BackupMessageSpec,s).readBuffer())}function u(e,t){var n,r=e.directive,a=e.insertionSource,i=e.message,l=(n=t.encryptedTransportMessage())==null||(n=n.armadillo())==null||(n=n.payload)==null||(n=n.content)==null?void 0:n.ravenActionNotifMessage;if(l!=null){var s=r.targetMessageId,u={actionType:o("MpsTypes").ActionType.UpsertSupplemental,debugFlags:r.debugFlags,isLocalOnly:!1,isTransportErrorPlaceholder:!1,supplementalKey:r==null?void 0:r.supplementalKey,tags:[],targetMessageId:s},c={actionType:o("MpsTypes").ActionType.DeleteSupplemental,debugFlags:r.debugFlags,isLocalOnly:!0,isTransportErrorPlaceholder:!1,supplementalKey:o("MpsTypes").toSupplementalKey(o("MAWMpsTypes").SupplementalKeyPrefixMps.RAVEN_ORIGINAL_MESSAGE),tags:[],targetMessageId:s},d={messageId:s,payload:i.payload,senderId:i.senderId,threadId:i.threadId,timestampMs:i.timestampMs};return[{directive:u,insertionSource:a,message:i},{directive:c,insertionSource:a,message:d}]}}function c(e,t){var n,r=e.directive,a=e.insertionSource,i=e.message,l=t.encryptedTransportMessage(),u=(n=t.encryptedTransportMessage())==null||(n=n.armadillo())==null||(n=n.payload)==null||(n=n.content)==null||(n=n.ravenMessageMsgr)==null?void 0:n.ephemeralType;if(!(l==null||u==null)){var c=[],d={messageId:i.messageId,payload:s(t,l.proto,u),senderId:i.senderId,threadId:i.threadId,timestampMs:i.timestampMs},m={actionType:o("MpsTypes").ActionType.UpsertTopLevel,debugFlags:r.debugFlags,isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:i.messageId},p={actionType:o("MpsTypes").ActionType.UpsertSupplemental,debugFlags:r.debugFlags,isLocalOnly:!0,isTransportErrorPlaceholder:!1,supplementalKey:o("MpsTypes").toSupplementalKey(o("MAWMpsTypes").SupplementalKeyPrefixMps.RAVEN_ORIGINAL_MESSAGE),tags:[],targetMessageId:i.messageId};return c.push({directive:m,insertionSource:a,message:d},{directive:p,insertionSource:a,message:i}),c}}function d(e){if(e==null)return null;var t=o("WAJids").interpretAndValidateJid(e);return t.jidType==="msgrUser"?t.userJid:t.jidType==="group"?t.groupJid:(t.jidType,null)}function m(e,t){var n,r,o=(n=t.encryptedTransportMessage())==null||(n=n.armadillo())==null||(n=n.payload)==null?void 0:n.applicationData;if(o!=null){var a=[];if(((r=o.metadataSync)==null?void 0:r.actions)!=null){var i;(i=o.metadataSync)==null||i.actions.forEach(function(t){return p(a,e,t)})}return a}}function p(e,t,n){if(n.chatAction!=null)return _(e,t,n.chatAction);if(n.messageAction!=null)return f(e,t,n.messageAction)}function _(e,t,n){var a=t.directive,i=t.insertionSource,l=t.message;if(n.chatId==null){r("FBLogger")("mps").warn("Chat id not defined for appdata chat action");return}if(n.chatDelete!=null&&e.push({directive:{actionType:o("MpsTypes").ActionType.DeleteThread,debugFlags:a.debugFlags,isLocalOnly:!0,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:l.messageId},insertionSource:i,message:babelHelpers.extends({},l,{threadId:o("MpsTypes").toThreadId(n.chatId)})}),n.chatArchive!=null){r("FBLogger")("mps").warn("Chat archive not supported for appdata");return}if(n.chatRead!=null){r("FBLogger")("mps").warn("Chat read not supported for appdata");return}}function f(e,t,n){var a=t.directive,i=t.insertionSource,l=t.message;if(n.key==null){r("FBLogger")("mps").warn("Message key not defined for appdata message");return}var s=n.key.id,u=d(n.key.remoteJid);if(u==null){r("FBLogger")("mps").warn("Message key remoteJid incomplete for appdata message");return}if(s==null){r("FBLogger")("mps").warn("Message key id is incomplete for appdata message");return}n.messageDelete!=null&&e.push({directive:{actionType:o("MpsTypes").ActionType.DeleteTopLevel,debugFlags:a.debugFlags,isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:o("MpsTypes").toMessageId(s)},insertionSource:i,message:babelHelpers.extends({},l,{threadId:o("MpsTypes").toThreadId(u)})})}function g(t){try{for(var n of e){var a=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(t.message.payload),i=n(t,a);if(i!=null)return o("WAResultOrError").makeResult(i)}return r("FBLogger")("mps").warn("mutate preprocessor failed to mutate payload"),o("WAResultOrError").makeResult([t])}catch(e){var l=r("getErrorSafe")(e);return r("FBLogger")("mps").catching(l).mustfix("Preprocess directive handling failed for message"),o("WAResultOrError").DEPRECATED_makeError("runtime-error",l)}}var h=o("MpsPreprocessor").preprocessor(function(e){var t=e.ctx,n=e.payloadList,a=new Map,i=[];for(var l of n){if(l.directive.actionType!==o("MpsTypes").ActionType.Preprocess){i.push(l);continue}var s=g(l);if(s.success)s.value.length===0&&t.messageToQpl.endSuccess(l.message.messageId),i.push.apply(i,s.value);else{var u;a.set(l.message.messageId,(u=s.payload)!=null?u:r("err")("Preprocess directive handler failed - runtime error"))}}return{ctx:t,errors:a,payloadList:i}},"mutate_message");l.MAWMpsMutateMessagePreprocessor=h}),98);
__d("MAWMpsReadSideEffects",["MAWMediaManager","MessageChunksFromMediaEntry","MpsMediaEntryCache","WAMediaManager","WAStartMediaDownloadQplFlow","WmiMediaService","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=o("MAWMediaManager").getMawMediaManager(),a=t.persistToReverb!=="no-persist"&&t.strategy!=="local-only";e.forEach(function(e){if((e==null?void 0:e.toplevelProtobuf)!=null){var t=o("MpsMediaEntryCache").hydrateCache(e.toplevelProtobuf);if(a){var i=o("MessageChunksFromMediaEntry").getMessageChunksFromMediaEntries(t);o("WmiMediaService").mediaService().storeMessageChunks(i),r("gkx")("15810")?o("WmiMediaService").mediaService().enqueueMediaDownload(t.map(function(e){return e.plaintextHash})):t.map(async function(e){var t=await o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:"MpsEBRestore",msgType:null,protocolMsgId:null,triggerUIView:null}),r=await n.enqueueDownloadFullSizeAndPreview({fullSizePlaintextHash:e.plaintextHash,mediaDownloadFlow:t,priority:o("WAMediaManager").MediaTaskPriority.LOW}).fullsizePromise;r.success===!1?t.endFail(r.error):t.endSuccess()})}}})}l.readSideEffects=e}),98);
__d("MawMpsCopPostprocessor",["FBLogger","MawMpsCop","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e={name:"mps_cop",process:async function(t,n){try{await o("MawMpsCop").mpsCop().postProcessMessages({ctx:n,payloadList:t})}catch(e){r("FBLogger")("wmi").catching(r("getErrorSafe")(e)).mustfix("[MawMpsCopPostprocessor] Fail to handle UI posprocessor")}return new Map}};l.MpsCopPostProcessor=e}),98);
__d("MawMpsDeletionPreprocessingUtils",["MpsTypes","WAWaitForUserUnblocked","WebMps","justknobx"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t){var n=r("justknobx")._("4369")?r("justknobx")._("4370")&&o("WAWaitForUserUnblocked").isStillWaitingForUserUnblocked()?"local-only":"local-first":"local-only",a=await o("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!1,shouldFetchTags:!1,strategy:n},debug:{purpose:"preprocess_revoke_fetch_local"},messageId:t,threadId:e});return a.value}async function s(t,n){var r=t.directive,a=t.insertionSource,i=t.message,l=i.timestampMs,s=n.find(function(e){return e.message.messageId===r.targetMessageId&&i.threadId===e.message.threadId});if(s!=null)l=s.message.timestampMs;else{var u=await e(i.threadId,r.targetMessageId);u!=null&&(l=u==null?void 0:u.toplevelProtobuf.timestampMs)}var c={directive:{actionType:o("MpsTypes").ActionType.DeleteTopLevel,debugFlags:["WA"],isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:r.targetMessageId,targetTimestampMs:l},insertionSource:a,message:i},d={directive:r,insertionSource:a,message:babelHelpers.extends({},i,{timestampMs:l})};return[c,d]}l.generateDeletionPayload=s}),98);
__d("MawMpsDeleteTopLevelPreprocessor",["MawMpsDeletionPreprocessingUtils","MpsPreprocessor","MpsTypes","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MpsPreprocessor").preprocessor(async function(e){var t=e.ctx,n=e.payloadList,a=new Map,i=[],l=async function(t,l){try{var e=await o("MawMpsDeletionPreprocessingUtils").generateDeletionPayload(t,n),s=e[0],u=e[1];i[l]=s}catch(e){a.set(t.message.messageId,r("getErrorSafe")(e))}},s=n.map(function(e,t){var n,r=(n=e.directive)==null?void 0:n.actionType;return r===o("MpsTypes").ActionType.DeleteTopLevel?l(e,t):(i[t]=e,null)}).filter(Boolean);return s.length!==0&&await Promise.all(s),{ctx:t,errors:a,payloadList:i.filter(Boolean)}},"delete_top_level");l.MawMpsDeleteTopLevelPreprocessor=e}),98);
__d("MawMpsDeleteTopLevelWithPlaceholderPreprocessor",["MawMpsDeletionPreprocessingUtils","MpsPreprocessor","MpsTypes","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MpsPreprocessor").preprocessor(async function(e){var t=e.ctx,n=e.payloadList,a=new Map,i=[],l=async function(t,l){try{var e=await o("MawMpsDeletionPreprocessingUtils").generateDeletionPayload(t,n),s=e[0],u=e[1];i[l]=[s,u]}catch(e){a.set(t.message.messageId,r("getErrorSafe")(e))}},s=n.map(function(e,t){var n,r=(n=e.directive)==null?void 0:n.actionType;return r===o("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder?l(e,t):(i[t]=[e],null)}).filter(Boolean);return s.length!==0&&await Promise.all(s),{ctx:t,errors:a,payloadList:i.flat().filter(Boolean)}},"delete_top_level_with_placeholder");l.MawMpsDeleteTopLevelWithPlaceholderPreprocessor=e}),98);
__d("MawMpsMinosUploadPostProcessor",["EBEnqueueMinosMessage","FBLogger","MetaConfig","MpsTypes","WAJids","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=[],n=r("MetaConfig")._("271"),a=e.payloadList.filter(function(e){var t=e.directive,r=e.insertionSource,a=e.message,i=o("WAJids").switchOnMsgrChatJidType(o("WAJids").unsafeCoerceToChatJid(a.threadId),{group:function(){return"group"},user:function(){return"one_to_one"}}),l=u(t)&&n;return r===o("MpsTypes").InsertionSource.Send&&i==="one_to_one"&&s(t.actionType)&&(!c(t)||l)}),i=new Map,l=new Map;return a.forEach(function(e){var n=e.directive,r=e.message;n.actionType===o("MpsTypes").ActionType.DeleteTopLevel?i.set(r.messageId,{message:r,updateDirective:n}):n.actionType===o("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder?l.set(n.targetMessageId,{message:r,updateDirective:n}):t.push({message:r,updateDirective:n})}),l.forEach(function(e,n){i.has(n)&&i.delete(n),t.push(e)}),i.forEach(function(e){t.push(e)}),t.length===0?new Map:(await Promise.all(t.map(function(e){var t=e.message,n=e.updateDirective;return o("EBEnqueueMinosMessage").enqueueSentMinosMessageForUpload({message:t,updateDirective:n}).then(function(e){e.success===!1&&r("FBLogger")("wmi").catching(r("getErrorSafe")(e.error)).mustfix("Failed to upload message")}).catch(function(e){r("FBLogger")("wmi").catching(r("getErrorSafe")(e)).mustfix("Failed to upload message")})})),new Map)}function s(e){switch(e){case o("MpsTypes").ActionType.UpsertTopLevel:case o("MpsTypes").ActionType.UpsertSupplemental:case o("MpsTypes").ActionType.DeleteTopLevel:case o("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder:return!0;case o("MpsTypes").ActionType.Noop:case o("MpsTypes").ActionType.Preprocess:case o("MpsTypes").ActionType.DeleteSupplemental:case o("MpsTypes").ActionType.DeleteThread:case o("MpsTypes").ActionType.Unknown:return!1}}function u(e){return e.expiryTimestampMs!=null}function c(e){return e.isLocalOnly}var d={name:"minos-schedule-upload",process:function(n,r){return e({ctx:r,payloadList:n})}};l.enqueueMessageForMinosUpload=e,l.MawMpsMinosUploadPostProcessor=d}),98);
__d("MawMpsPayloadValidatorPreprocessor",["FBLogger","MAWProtobufDeserializers","MpsPreprocessor","MpsTypes","getErrorSafe","justknobx","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e=["directive","message"],s=new Date(2e3,1,1).getTime(),u=new Date(2500,1,1).getTime();function c(e,t){if(!e)throw r("FBLogger")("mps").mustfixThrow(t)}function d(e,t){var n=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(t.payload),a=n.proto.metadata;switch(r("nullthrows")(e.actionType)){case o("MpsTypes").ActionType.UpsertSupplemental:{c(e.supplementalKey!=null,"supplemental key must be set");break}case o("MpsTypes").ActionType.UpsertTopLevel:{c(e.targetMessageId===t.messageId,"messageId mismatch between directive and message");break}case o("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder:case o("MpsTypes").ActionType.DeleteTopLevel:case o("MpsTypes").ActionType.Unknown:case o("MpsTypes").ActionType.Noop:case o("MpsTypes").ActionType.Preprocess:case o("MpsTypes").ActionType.DeleteSupplemental:case o("MpsTypes").ActionType.DeleteThread:break}c(e.expiryTimestampMs==null||e.isLocalOnly,"If expiryTimestampMs is set, isLocalOnly must be true. we do not want to upload ephemeral messages to the server. Action type: "+String(e.actionType)),c(a!=null,"metadata is missing in the protobuf"),c((a==null?void 0:a.senderId)===t.senderId,"senderId mismatch between protobuf metadata and message"),c((a==null?void 0:a.timestampMs)===t.timestampMs||(e==null?void 0:e.actionType)===o("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder,"timestamp mismatch between protobuf metadata and message"),c(!t.senderId.includes("@"),"senderId should just be an FBID, got "+t.senderId+" instead");var i=t.threadId;c(i.includes("@"),"threadId should be a JID, got "+i+" instead"),c(t.timestampMs>s,"timestampMs should be millisecond timestamps, got "+t.timestampMs.toString()+" instead"),c(t.timestampMs<u,"timestampMs should be millisecond timestamps, got "+t.timestampMs.toString()+" instead")}function m(e,t){try{d(e,t)}catch(e){return r("getErrorSafe")(e)}}var p=o("MpsPreprocessor").preprocessor(function(t){var n=t.ctx,o=t.payloadList,a=new Map;if(r("justknobx")._("1008")===!1)return{ctx:n,errors:a,payloadList:o};n.messageToQpl.all().addPoint("payload_validator_execution");var i=[];return o.forEach(function(t){var n=t.directive,r=t.message,o=babelHelpers.objectWithoutPropertiesLoose(t,e),l=m(n,r);l==null?i.push(babelHelpers.extends({directive:n,message:r},o)):a.set(r.messageId,l)}),{ctx:n,errors:a,payloadList:i}},"payload_validator");l.MawMpsPayloadValidatorPreprocessor=p}),98);
__d("MawMpsThreadConsistency",["FBLogger","I64","MAWBridge","MAWJids","MAWProtobufDeserializers","MpsTypes","WABaseGlobals","WAGlobals","WAJids","WATimeUtils","WebMps"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new Map,u={name:"threads_consistency",process:function(t,n){var e=new Set;for(var o of t){var a=c(o);a&&e.add(o.message.threadId)}return e.size>0&&g(e).catch(function(e){r("FBLogger")("wmi").catching(e).mustfix("Cannot apply threads consistency to UI")}),Promise.resolve(new Map)}};function c(e){var t=e.message,n=o("WAJids").userIdFromJid(o("WAGlobals").getMyUserJid()),r=e.message.senderId===n,a=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(t.payload);if(e.insertionSource===o("MpsTypes").InsertionSource.Receive&&r&&a.adminMessage()==null)return!1;var i=t.threadId,l=t.timestampMs,u=m(a,e.insertionSource);e:{if((typeof e.directive=="object"&&e.directive!==null||typeof e.directive=="function")&&"actionType"in e.directive&&e.directive.actionType===o("MpsTypes").ActionType.UpsertTopLevel)return p({activityType:u,isLocalDeviceSend:r,threadId:i,timestampMs:l});if((typeof e.directive=="object"&&e.directive!==null||typeof e.directive=="function")&&"actionType"in e.directive&&e.directive.actionType===o("MpsTypes").ActionType.UpsertSupplemental){var c,_=(c=a.encryptedTransportMessage())==null||(c=c.consumerMessage())==null||(c=c.proto)==null||(c=c.payload)==null||(c=c.content)==null?void 0:c.reactionMessage;return _==null||r||d(_.key,e.message.senderId)!==n?!1:_.text==null||_.text===""?p({activityType:"pending_unbump",isLocalDeviceSend:!1,threadId:i,timestampMs:l}):p({activityType:u,isLocalDeviceSend:!1,threadId:i,timestampMs:l})}if((typeof e.directive=="object"&&e.directive!==null||typeof e.directive=="function")&&"actionType"in e.directive&&e.directive.actionType===o("MpsTypes").ActionType.DeleteSupplemental)return!1;if((typeof e.directive=="object"&&e.directive!==null||typeof e.directive=="function")&&"actionType"in e.directive&&e.directive.actionType===o("MpsTypes").ActionType.DeleteThread){return s.delete(i),!1;break e}if((typeof e.directive=="object"&&e.directive!==null||typeof e.directive=="function")&&"actionType"in e.directive&&e.directive.actionType===o("MpsTypes").ActionType.DeleteTopLevel)return p({activityType:"pending_unbump",isLocalDeviceSend:!1,threadId:i,timestampMs:l});if((typeof e.directive=="object"&&e.directive!==null||typeof e.directive=="function")&&"actionType"in e.directive&&e.directive.actionType===o("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder||(typeof e.directive=="object"&&e.directive!==null||typeof e.directive=="function")&&"actionType"in e.directive&&e.directive.actionType===o("MpsTypes").ActionType.Noop||(typeof e.directive=="object"&&e.directive!==null||typeof e.directive=="function")&&"actionType"in e.directive&&e.directive.actionType===o("MpsTypes").ActionType.Unknown||(typeof e.directive=="object"&&e.directive!==null||typeof e.directive=="function")&&"actionType"in e.directive&&e.directive.actionType===o("MpsTypes").ActionType.Preprocess||e.directive===null||e.directive===void 0)return!1;throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e.directive)}}function d(e,t){if(e==null)return null;if(e.participant!=null){var n=o("WAJids").validateUserJid(e.participant);return n==null?null:o("WAJids").userIdFromJid(n)}var r=e.fromMe;if(r==null)return null;if(r)return t;if(e.remoteJid==null)return null;var a=o("WAJids").validateUserJid(e.remoteJid);return a==null?null:o("WAJids").userIdFromJid(a)}function m(e,t){var n;return((n=e.encryptedTransportEvent())==null?void 0:n.proto.event)!=null||e.adminMessage()!=null?"admin":t===o("MpsTypes").InsertionSource.Send?"outgoing":t===o("MpsTypes").InsertionSource.Receive?"incoming":(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+t)})()}function p(e){var t,n=e.activityType,o=e.isLocalDeviceSend,a=e.threadId,i=e.timestampMs,l=(t=s.get(a))==null?void 0:t.ts;return l!=null&&l>=i&&o===!1?!1:i<=100?(r("FBLogger")("wmi").warn("Timestamp is too small, thread will not be bumped"),!1):(s.set(a,{activityType:n,ts:i}),!0)}function _(t){var n=[],a=[];return t.forEach(function(t){var i=s.get(t);if(i==null){r("FBLogger")("wmi").warn("Thread consistency does not have cache, despite thread update is requested");return}var l=f(i.activityType);if(l==null){n.push(t);return}a.push({bumpTimestampMs:(e||(e=o("I64"))).of_float(i.ts),chatJid:o("MAWJids").threadIdToChatJid(t),source:l})}),o("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:a.map(function(e){return{tag:"UpdateThreadActivity",value:e}})}),{unbumps:n}}function f(e){return e==="outgoing"?"outgoing_msg":e==="incoming"?"incoming_msg":e==="admin"?"inserted_admin_msg":e==="unbump"?"deleted_msg":e==="pending_unbump"?null:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}async function g(e){var t=_(e),n=t.unbumps;if(n.length!==0){var r=(o("WABaseGlobals").newClockSkewCalculation()?o("WATimeUtils").unixTimeMs():Date.now())+6e4,a=await o("WebMps").mps().batchLoadMessages({config:{shouldFetchSupplementals:!1,shouldFetchTags:!1,shouldIgnoreLocalOnly:!0,strategy:"local-only",tagsFilter:"all"},debug:{purpose:"threads-consistency-unbump"},ranges:n.map(function(e){return{direction:"desc",from:[o("MpsTypes").toTimestamp(r),void 0],numMessages:1,threadId:e}})});if(a.success!==!1){var i=a.value.map(function(e){var t=e.messages[0];if(t==null)return null;var n=t.toplevelProtobuf.threadId,r=t.toplevelProtobuf.timestampMs,o=s.get(n);if((o==null?void 0:o.activityType)==="pending_unbump")return s.set(n,{activityType:"unbump",ts:r}),n;if(p({activityType:"unbump",isLocalDeviceSend:!1,threadId:n,timestampMs:r}))return n}).filter(Boolean);_(new Set(i))}}}l.MawThreadsConsistencyPostprocessor=u}),98);
__d("MawMpsUploadMessagesToEBPostprocessor",["EBEnqueueMessagesForUpload","EBMessageProbe","FBLogger","err","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=new Map;try{await r("EBEnqueueMessagesForUpload")(e),e.forEach(function(e){var t=e.message,n=o("EBMessageProbe").getEBMessageProbeInstance();n.addMarkerToItem(t.messageId,"mps_upload_enqueue_success")})}catch(a){var n=r("getErrorSafe")(a);r("FBLogger")("mps").catching(n).mustfix("Failed to enqueue messages to upload queue"),e.forEach(function(e){var n=e.message;t.set(n.messageId,r("err")("runtime-error",a));var i=o("EBMessageProbe").getEBMessageProbeInstance();i.addMarkerToItem(n.messageId,"mps_upload_enqueue_failed")})}return t}var s={name:"eb-schedule-upload",process:function(n){return e(n.filter(function(e){return!e.directive.isLocalOnly})),new Map}};l.MawMpsUploadMessagesToEBPostprocessor=s}),98);
__d("MpsCacheServicesPostProcessors",["MpsWorkerCacheServices","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){return o("MpsWorkerCacheServices").getMpsWorkerCacheServices().calculateDelta(t),(e||(e=n("Promise"))).resolve(new Map)}var u={name:"MpsCacheServicesPostProcessor",process:s};l.MpsCacheServicesPostProcessor=u}),98);
__d("MpsExtensionConfiguration",[],(function(t,n,r,o,a,i){"use strict";var e=function(t){var e=t.postProcessors,n=t.preprocessors,r=t.readSideEffects;this.postProcessors={critical:e.critical,nonCritical:e.nonCritical},this.preprocessors=n,this.readSideEffects=r!=null?r:void 0};i.MpsExtensionConfiguration=e}),66);
__d("MpsFtsPostProcessor",["FtsIndexEntity","MpsMessageToBridgeWrapper","MpsTypes","WAStanzaUtils","getErrorSafe","isWAFTSContentSearchEnabled"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){if(!r("isWAFTSContentSearchEnabled")())return new Map;var t=[];for(var n of e){var a=o("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(n.message),i=o("WAStanzaUtils").toStanzaId(a.getExternalId()),l=a.getChatJid();s(n)&&t.push(o("FtsIndexEntity").toIndexMessageEntity(i)),u(n)&&t.push(o("FtsIndexEntity").toPurgeMessageEntity(i)),c(n)&&t.push(o("FtsIndexEntity").toPurgeThreadEntity(l))}if(t.length===0)return new Map;var d=new Map;return await o("FtsIndexEntity").getFtsIndexQueue().add(t).catch(function(t){for(var n of e)d.set(n.message.messageId,r("getErrorSafe")(t))}),d}function s(e){var t,n=o("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(e.message);return e.directive.actionType===o("MpsTypes").ActionType.UpsertTopLevel&&e.directive.expiryTimestampMs==null&&((t=n.deserialize().encryptedTransportMessage())==null||(t=t.consumerMessage())==null||(t=t.payload)==null||(t=t.content)==null?void 0:t.messageText)!=null}function u(e){return e.directive.actionType===o("MpsTypes").ActionType.DeleteTopLevel}function c(e){return e.directive.actionType===o("MpsTypes").ActionType.DeleteThread}var d={name:"MpsFtsPostProcessor",process:e};l.MpsFtsPostProcessor=d}),98);
__d("MpsMediaDeletionPostProcessor",["MpsTypes","WmiMediaService","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.directive,n=e.message,a=t.actionType===o("MpsTypes").ActionType.DeleteTopLevel?o("WmiMediaService").mediaService().handleMessageDeletion(n.threadId,t.targetMessageId):t.actionType===o("MpsTypes").ActionType.DeleteThread?o("WmiMediaService").mediaService().handleThreadDeletion(n.threadId):null;return a==null?void 0:a.catch(function(e){return r("getErrorSafe")(e)})}var s={name:"MpsMediaDeletionPostProcessor",process:async function(n){var t=new Map,r=n.map(function(n){var r;return(r=e(n))==null?void 0:r.then(function(e){e!=null&&t.set(n.message.messageId,e)})}).filter(Boolean);return r.length>0&&await Promise.all(r),t}};l.MpsMediaDeletionPostProcessor=s}),98);
__d("pipeline-chain",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e,t){this.$1=e,this.$2=t}var t=e.prototype;return t.pipe=function(n){var t=this.$1,r=this.$2,o=function(r,o){var e=t(r,o);return e instanceof Promise?e.then(function(e){return n(e,o)}):n(e,o)};return new e(o,r)},t.run=async function(t){var e=await this.$1(t,this.$2);return e},e})();function l(t,n){return new e(t,n)}function s(e){return e}i.Pipeline=e,i.pipeline=l,i.pipeNoop=s}),66);
__d("MAWMpsSetup",["BackendInitLoggingUtils","EBMessageMetadataCache","EBMessageProbeSamplingPreprocessor","FtsIndexEntity","MAWCurrentUser","MAWEBLSInWorkerSwitch","MAWIndexedDbMetadata","MAWMpsAppdataEncryptedBackupsSecretsPreprocessor","MAWMpsDecryptedProtobufToFullMessage","MAWMpsDirectiveGenerator","MAWMpsGenerateDeletionMessage","MAWMpsMessagePointQuery","MAWMpsMessageRangeQuery","MAWMpsMutateMessagePreprocessor","MAWMpsReadSideEffects","MAWMpsSetExpiryPreprocessor","MAWMpsXMAValidationPreprocessor","MAWODSProxy","MAWQplProxy","MawMpsCopPostprocessor","MawMpsDeleteTopLevelPreprocessor","MawMpsDeleteTopLevelWithPlaceholderPreprocessor","MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor","MawMpsMinosUploadPostProcessor","MawMpsPayloadValidatorPreprocessor","MawMpsThreadConsistency","MawMpsUploadMessagesToEBPostprocessor","MessengerWebInitData","MpsCacheServicesPostProcessors","MpsExtensionConfiguration","MpsFtsPostProcessor","MpsMediaDeletionPostProcessor","WAOdsEnums","WebMps","gkx","justknobx","pipeline-chain","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e=o("pipeline-chain").pipeline(o("MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor").MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor).pipe(o("MAWMpsDirectiveGenerator").MawMpsDirectiveGeneratorPreprocessor).pipe(o("MawMpsDeleteTopLevelWithPlaceholderPreprocessor").MawMpsDeleteTopLevelWithPlaceholderPreprocessor).pipe(o("MAWMpsAppdataEncryptedBackupsSecretsPreprocessor").MAWMpsAppdataEncryptedBackupsSecretsPreprocessor).pipe(o("MAWMpsMutateMessagePreprocessor").MAWMpsMutateMessagePreprocessor).pipe(o("MawMpsDeleteTopLevelPreprocessor").MawMpsDeleteTopLevelPreprocessor).pipe(o("MAWMpsSetExpiryPreprocessor").MAWMpsSetExpiryPreprocessor).pipe(o("MAWMpsXMAValidationPreprocessor").MAWMpsXMAValidationPreprocessor).pipe(o("MawMpsPayloadValidatorPreprocessor").MawMpsPayloadValidatorPreprocessor).pipe(o("EBMessageProbeSamplingPreprocessor").EBMessageProbeSamplingPreprocessor);return new(o("MpsExtensionConfiguration")).MpsExtensionConfiguration({postProcessors:{critical:[o("MawMpsCopPostprocessor").MpsCopPostProcessor,r("gkx")("20911")&&!r("gkx")("8208")?o("MawMpsMinosUploadPostProcessor").MawMpsMinosUploadPostProcessor:null,o("MawMpsUploadMessagesToEBPostprocessor").MawMpsUploadMessagesToEBPostprocessor].filter(Boolean),nonCritical:[o("MpsMediaDeletionPostProcessor").MpsMediaDeletionPostProcessor,o("FtsIndexEntity").isFtsIndexQueueExperiment()?o("MpsFtsPostProcessor").MpsFtsPostProcessor:null,o("MawMpsThreadConsistency").MawThreadsConsistencyPostprocessor,o("MpsCacheServicesPostProcessors").MpsCacheServicesPostProcessor].filter(Boolean)},preprocessors:e,readSideEffects:o("MAWMpsReadSideEffects").readSideEffects})}async function s(){await o("BackendInitLoggingUtils").measureMawInit("make_mps",function(){return o("WebMps").makeMps({db:{blockingErrorThreshold:r("justknobx")._("3218"),name:o("MAWIndexedDbMetadata").webReverDbbName(o("MAWCurrentUser").getID()),onBlockingError:function(t){o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(25310776,"6155"),"database_mps_setup_failed"),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.WORM,key:"reverb.unrecoverable."+t})},qplEvent:r("qpl")._(1056840657,"2716"),strEncKey:r("MessengerWebInitData").accountKeyV2},dependencies:{decryptedProtobufToFullMessage:o("MAWMpsDecryptedProtobufToFullMessage").decryptedProtobufToFullMessage,eb:{getMetadataFromCache:o("EBMessageMetadataCache").getEBMetadataFromCache,isEbEnabled:function(){return r("MAWEBLSInWorkerSwitch").get()},messagePointQuery:o("MAWMpsMessagePointQuery").MAWMpsMessagePointQuery,messageRangeQuery:o("MAWMpsMessageRangeQuery").MAWMpsMessageRangeQuery},generateDeletionMessage:o("MAWMpsGenerateDeletionMessage").generateDeletionMessage},getMpsExtensionConfiguration:e})})}l.getMpsExtensionConfiguration=e,l.mawMpsSetup=s}),98);
__d("MAWPersistedQueuesSetup",["BackendInitLoggingUtils","MAWCurrentUser","MAWIndexedDbMetadata","MAWODSProxy","MessengerWebInitData","PersistedQueueDB","WAOdsEnums","WormPersistedQueueDb","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";async function e(){await o("BackendInitLoggingUtils").measureMawInit("persisted_queues_init",async function(){return await o("PersistedQueueDB").makePersistedQueues({blockingErrorThreshold:r("justknobx")._("3218"),dbName:o("MAWIndexedDbMetadata").persistedQueueDbName(o("MAWCurrentUser").getID()),onBlockingError:function(t){o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.WORM,key:"reverb.unrecoverable."+t})},qplEvent:r("qpl")._(1056840657,"2716"),strEncKey:r("MessengerWebInitData").accountKeyV2}),o("WormPersistedQueueDb").makePersistedQueueDb({blockingErrorThreshold:r("justknobx")._("3218"),dbName:o("MAWIndexedDbMetadata").wormPersistedQueueDbName(o("MAWCurrentUser").getID()),onBlockingError:function(t){o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.WORM,key:"reverb.unrecoverable."+t})},qplEvent:r("qpl")._(1056840657,"2716"),strEncKey:r("MessengerWebInitData").accountKeyV2})})}l.mawPersistedQueuesSetup=e}),98);
__d("MAWDeleteDanglingParticipantsStartupJob",["MAWDbVersion","MAWIndexedDb","MAWODSProxy","MAWQplProxy","MAWTransactionMode","WALogger","WAOdsEnums","gkx","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[Delete Dangling Participants] ",""])),t)}var u=o("MAWIndexedDb").makeMsgrTransactor({participants:o("MAWTransactionMode").READWRITE,threads:o("MAWTransactionMode").READONLY},"deleteDanglingParticipantsStartupJob",function(e){return function(){return e.threads.toArray().then(function(t){return e.participants.where("threadJid").noneOf(t.map(function(e){return e.jid})).delete()})}}),c={run:async function(){if(r("gkx")("24027")){s("Starting job..."),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_DELETE_DANGLING_PARTICIPANTS,key:"start"});var e=await o("MAWDbVersion").getDBVersion();if(e!=null&&e>=85){s(""+(e!=null?e:"null"));var t=await o("MAWQplProxy").measurePerfInQPL_USE_WITH_CARE(r("qpl")._(25310776,"6155"),"startup_job:delete_dangling_participants",function(){return u()});o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_DELETE_DANGLING_PARTICIPANTS,key:t>0?"deleted":"good"}),s("Found and deleted "+t+" dangling participants")}else s("Expected DBVersion >= 85, but got "+(e!=null?e:"null")+" instead"),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_DELETE_DANGLING_PARTICIPANTS,key:"db_version_not_ready"})}}},d=c;l.default=d}),98);
__d("MAWStartupJob",["MAWDeleteDanglingParticipantsStartupJob","MAWQplProxy","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=[r("MAWDeleteDanglingParticipantsStartupJob")];async function s(){o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(25310776,"6155"),"backend_startup_jobs"),await Promise.all(e.map(function(e){return e.run()}))}l.runMAWStartupJobs=s}),98);
__d("MAWSetupAllDatabases",["BackendInitLoggingUtils","EBDB","EBMinosCheckWasmFeatureSupport","EBMinosDb","FBLogger","MAWCacheServiceDB","MAWCurrentUser","MAWDBKeychain","MAWDbInitIndexedDb","MAWEARGenNewKeychainCryptoKey","MAWFTSIndexedDb","MAWIndexedDb","MAWIndexedDbMetadata","MAWJobsIndexedDb","MAWMpsSetup","MAWODSProxy","MAWPersistedQueuesSetup","MAWQplProxy","MAWStartupJob","MAWWormOdsLogger","MWEARKeychainV3","MessengerWebInitData","WAHex","WAOdsEnums","WASignalDB","WmiMediaService","WormGlobalConfig","cr:12175","cr:12176","gkx","justknobx","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";async function e(){var e,t,a=await o("EBMinosCheckWasmFeatureSupport").checkWasmFeatureSupport(),i=r("qpl")._(25310776,"6155");o("WormGlobalConfig").setWormGlobalConfig({}),await o("MAWMpsSetup").mawMpsSetup(),await(t=o("BackendInitLoggingUtils")).measureMawInit("make_jobs_db",o("MAWJobsIndexedDb").makeJobsDb),await t.measureMawInit("make_fts_db",o("MAWFTSIndexedDb").makeFTSDB);var l=await t.measureMawInit("make_maw_ear",o("MAWDBKeychain").initEAR),s=l.isNewUser,u=l.reinitEAR,c=l.useMawEAR;await t.measureMawInit("make_db",async function(){if(!c)return o("MAWDbInitIndexedDb").dbInit({});var e;return s===!0&&(e=babelHelpers.extends({},await r("MAWEARGenNewKeychainCryptoKey")(),{randomisedVersion:o("MWEARKeychainV3").generateNewRandomisedVersionNumber([]),version:1})),o("MAWDbInitIndexedDb").dbInit({onDbPopulate:function(n){o("MAWDBKeychain").onDbPopulateMAWKeychain(n,e)}}).then(async function(){u===!0&&await o("MAWDBKeychain").initEAR(),o("MWEARKeychainV3").setNamespaceSourceDbAndMarkAsReady("maw_ear",(await o("MAWIndexedDb").getDB()).stores.backendDB())})}),await t.measureMawInit("make_signal_db",function(){return o("WASignalDB").makeSignalDb(o("MAWIndexedDbMetadata").signalWorm(o("MAWCurrentUser").getID()),r("MessengerWebInitData").accountKeyV2,r("justknobx")._("3218"),function(e){o("MAWQplProxy").sendQplPointThroughBridge(i,"database_signal_db_setup_failed"),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.WORM,key:"unrecoverable."+e})},o("MAWWormOdsLogger").wormOdsWorkerLogger,r("qpl")._(1056840657,"2716"))}),await o("MAWPersistedQueuesSetup").mawPersistedQueuesSetup(),n("cr:12175")!=null&&await n("cr:12175").mawWormDbMaintenanceDbSetup(),await o("WmiMediaService").wmiMediaServiceSetup({blockingErrorThreshold:r("justknobx")._("3218"),dbName:o("MAWIndexedDbMetadata").wmiMediaServiceName(o("MAWCurrentUser").getID()),onBlockingError:function(t){o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(25310776,"6155"),"database_wmi_media_service_setup_failed"),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.WORM,key:"reverb.unrecoverable."+t})},qplEvent:r("qpl")._(1056840657,"2716"),strEncKey:r("MessengerWebInitData").accountKeyV2});var d=r("MessengerWebInitData").accountKeyV2,m=(e=d==null?void 0:d.length)!=null?e:0;m===0&&r("FBLogger")("messenger_web").mustfix("accountKeyV2 is empty or null when setting up EBDB. This will cause AES key validation to fail."),await o("BackendInitLoggingUtils").measureMawInit("make_ebdb",function(){return o("EBDB").makeEBDB(o("MAWIndexedDbMetadata").ebdbName(o("MAWCurrentUser").getID()),r("qpl")._(1056840657,"2716"),o("WAHex").parseHex(d),o("EBDB").EBDBEnvironment.Worker,o("MAWWormOdsLogger").wormOdsWorkerLogger)}),await o("BackendInitLoggingUtils").measureMawInit("make_cache_service_db",function(){return o("MAWCacheServiceDB").getOrSetupMAWCacheDB()}),(r("gkx")("20911")||r("gkx")("17219"))&&a&&await o("EBMinosDb").makeEBMinosDb(),n("cr:12176")!=null&&r("promiseDone")(n("cr:12176").runAllDbMigrations()),r("promiseDone")(o("MAWStartupJob").runMAWStartupJobs())}l.setupAllDatabases=e}),98);
__d("MAWSetupWorkerMsg",["FBLogger","ifRequired"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){this.setupHash=e,this.currentWorker=t}var t=e.prototype;return t.postAck=function(){this.currentWorker.postMessage({setupHash:this.setupHash,type:"worker-setup-ack"})},t.postSuccess=function(){this.currentWorker.postMessage({setupHash:this.setupHash,status:"success",type:"worker-setup"})},t.postFailure=function(t){this.currentWorker.postMessage({msg:t,setupHash:this.setupHash,status:"failure",type:"worker-setup"})},t.postNoActionRequired=function(){this.currentWorker.postMessage({action:"no-action",setupHash:this.setupHash,status:"already-setup",type:"worker-setup"})},t.postRebootRequired=function(t){this.currentWorker.postMessage({action:"reboot-required",reason:t,setupHash:this.setupHash,status:"already-setup",type:"worker-setup"})},t.postBackendState=function(t){this.currentWorker.postMessage({backendState:t,setupHash:this.setupHash,type:"worker-setup-ack"})},e})();function s(e){r("ifRequired")("CurrentSharedWorkerExperimental",function(t){t.shutdownWorker(e)},function(){}),r("ifRequired")("CurrentSharedWorker",function(t){t.shutdownWorker(e)},function(){throw r("FBLogger")("messenger_web").mustfixThrow("Failed to update shared worker, reason: "+(e!=null?e:""))})}l.WorkerSetupComms=e,l.shutdownSharedWorker=s}),98);
__d("MAWWorkerEBDeps",["EBDeps","EBLS","EBSMWorkerThreadAPI","EBWorkerEBDBApiDeferred","Promise","WAAPI"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){o("EBDeps").setDeps({getEBSMAPI:function(){return(e||(e=n("Promise"))).resolve(r("EBSMWorkerThreadAPI"))},getLSDB:function(){return o("EBLS").init().then(function(e){return e.db})},getMAWIdentityKeys:r("WAAPI").getIdentityKeys,isBackendSetupSuccessful:function(){return!0},trackAddingNewDevice:o("EBWorkerEBDBApiDeferred").addNewDevice},"MAW worker")}l.initEBDeps=s}),98);
__d("MessengerInfraReportUtils",[],(function(t,n,r,o,a,i){"use strict";var e=function(t){return t===2},l=function(t){switch(t){case 1:return"START";case 2:return"SUCCESS";case 3:return"FAIL";case 4:return"CANCEL";case 113:return"TIMEOUT";case 706:return"CANCEL_UNLOAD";case 4158:return"INVALID";case 87:return"ERROR";case 5947:return"SUCCESS_PAST_TIMEOUT";case 160:return"OFFLINE";default:return String(t)}};i.isQplActionSuccessful=e,i.qplStatusStr=l}),66);
__d("MessengerInfraQplReport",["FBLogger","MAWCurrentUser","MWBroadcastChannel","MessengerInfraReport","MessengerInfraReportUtils","QPLEvent","QuickPerformanceLogger","getErrorSafe","memoizeOneWithArgs"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=(e={},e[1056839232]={annotations:{string:["errorDescription","failReason","backendAckState"]},name:"MAW_TTRC",single:!0},e[25310776]={annotations:{string:["errorDescription","failReason"]},name:"MAW_INIT",single:!0},e[25305590]={annotations:{string:["uncaught_error"]},name:"LS_INIT",single:!0},e[25313175]={annotations:{int:["errorCode","applicationError"],string:["errorDescription","thread_type"],string_array:["worker_restart_msgs","worker_restart_reasons"]},name:"MESSAGE_SEND_TO_SENT",single:!1},e[30605380]={annotations:{string:["thread_type","cancelType"]},name:"CHAT_TAB_OPEN",single:!1},e[25303796]={annotations:{string:["eb_failure_reason","range_extension_error","cancel_reason"]},name:"LOAD_MORE_MESSAGES",single:!1},e[1056843758]={annotations:{string:["range_extension_error"],string_array:["message_ranges_source"]},name:"MAW_MLV2_RANGE_EXTENSION",single:!1},e[30605361]={annotations:{string:["cancelType"]},name:"POPOVER_SHOW",single:!1},e[398998698]={annotations:{bool:["isE2eeMandated"],string:["errorDescription"]},name:"E2EE_COMPONENTS_CREATION",single:!1},e[398997251]={annotations:{string:["endCallReason"]},name:"CALL_JOIN",single:!1},e[398989351]={name:"ZENON_SDK",single:!1},e[521476165]={annotations:{string:["type","taskSource","triggerType","querySource","error","exception","thread_state_by_jid"]},name:"RESTORE_END_TO_END",single:!1},e[521471755]={annotations:{string:["error_description","exception","source","restoreType"]},name:"EB_API_MESSAGE_RANGE_QUERY",single:!1},e[25302828]={annotations:{string:["fail_reason"]},name:"MEDIA_RENDER",single:!1},e[1056846543]={annotations:{bool:["is_otid","is_thread_requested"],string:["threadState","description"]},name:"MAW_ON_ACT_THREAD_READY_USAGE",single:!1},e[25302828]={annotations:{string:["fail_reason"]},name:"MEDIA_RENDER",single:!1},e[521474469]={name:"EB_API_MESSAGE_POINT_QUERY",single:!1},e[521473213]={name:"EB_API_MEDIA_RESTORE_PROBE",single:!1},e[521476367]={name:"EB_API_MESSAGE_RANGE_QUERY_SEARCH",single:!1},e[521477507]={name:"EBLSDB_INIT",single:!0},e[1056836502]={annotations:{bool:["isMawThreadCreated","hasMappingRowAlready","hasPlaceholderRowInserted","isResultVerified"],string:["flushReason","trigger"]},name:"THREAD_MAPPING",single:!1},e[521471024]={annotations:{string:["backup_id"]},name:"FETCH_BACKUP_IDS",single:!1},e[25307273]={annotations:{string:["errorMsg"]},name:"MAW_DEVICE_REGISTRATION_ALL",single:!0},e),d=r("memoizeOneWithArgs")(function(e){return o("MWBroadcastChannel").MWBroadcastChannel("msgr_qpl_logger_"+e)}),m="not_started",p=function(){return m},_=function(){try{if(o("MessengerInfraReport").isEPD())return m="epd_blocked",function(){};var e=d(o("MAWCurrentUser").getID()),t=function(t){if(n[t.data[0]]==null)return r("FBLogger")("msgr_web_flytrap").warn("Handler %s is not set for QPL listener",t.data[0]);switch(t.data[0]){case"onMarkerEnd":{n.onMarkerEnd==null||n.onMarkerEnd.apply(n,t.data[1]);break}case"onAnnotation":{n.onAnnotation==null||n.onAnnotation.apply(n,t.data[1]);break}case"onMarkerStart":{n.onMarkerStart==null||n.onMarkerStart.apply(n,t.data[1]);break}case"onMarkerPoint":{n.onMarkerPoint==null||n.onMarkerPoint.apply(n,t.data[1]);break}default:r("FBLogger")("maw_init").mustfix("Must implement QPL forwarding for event name: %s",t.data[0])}};e.addEventListener("message",t);var n={onAnnotation:function(t,n,r,o,a){y(t,n,r,o,a)},onMarkerEnd:function(t,n,r){C(t,n,r)},onMarkerPoint:function(t,n,r,o){b(t,n,r,o)},onMarkerStart:function(t,n){v(t,n)}},a=(u||(u=r("QuickPerformanceLogger"))).addListener(n);return m="started",function(){a.dispose(),e.removeEventListener("message",t)}}catch(e){var i=r("getErrorSafe")(e);return m="error",r("FBLogger")("msgr_web_flytrap").catching(i).mustfix("Failed to initialize QPL logger"),function(){}}},f=function(t){var e,n;return(e=(n=c[t])==null?void 0:n.name)!=null?e:"UNKNOWN_QPL_NAME"},g=function(t){var e=(s||(s=o("QPLEvent"))).getMarkerId(t);return c[e]},h=function(t,n){var e=o("MessengerInfraReport").getEventData(t,n);return e};function y(e,t,n,r,a){var i,l=(s||(s=o("QPLEvent"))).getMarkerId(e),u=c[l];if(u&&(i=u.annotations)!=null&&(i=i[a])!=null&&i.includes(n)){var d=h(l,t);d&&d.status===1&&(d.annotations[n]=r)}}function C(e,t,n){var r=(s||(s=o("QPLEvent"))).getMarkerId(t),a=c[r];if(a){var i=h(r,n);i&&i.status===1&&(a.single&&(i.status=e,i.latestTimestampMs=Date.now()),a.single||(o("MessengerInfraReportUtils").isQplActionSuccessful(e)?o("MessengerInfraReport").deleteEventData(r,n):(i.status=e,i.latestTimestampMs=Date.now())))}}function b(e,t,n,r){var a=(s||(s=o("QPLEvent"))).getMarkerId(e),i=c[a];if(i){var l=h(a,t);if(l&&l.status===1&&(l.lastPoints.push(n),r!=null&&i.annotations!=null)){var u=function(t){var e;if(r[t]==null)return 1;(e=i.annotations)==null||e[t].forEach(function(e){var n,o=(n=r[t])==null?void 0:n[e];o!=null&&(l.annotations[e]=o)})};for(var d of Object.keys(i.annotations))u(d)}}}function v(e,t){var n=(s||(s=o("QPLEvent"))).getMarkerId(e),r=c[n];if(r){var a=h(n,t);a!=null&&a.status!==1||o("MessengerInfraReport").storeEventData(n,{annotations:{},lastPoints:[],single:r.single,status:1},t)}}l.ReportedQPLEvents=c,l.getLoggerTabCommunication=d,l.getQplLoggerInitStatus=p,l.initializeLogger=_,l.getQplName=f,l.getReportedEvent=g,l.getCurrentEventData=h,l.onAnnotationHandler=y,l.onMarkerEndHandler=C,l.onMarkerPointHandler=b,l.onMarkerStartHandler=v}),98);
__d("MessengerInfraQplReportInWorker",["MessengerInfraQplReport","MessengerInfraReport","QuickPerformanceLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(){if(o("MessengerInfraReport").isEPD())return function(){};var t=(e||(e=r("QuickPerformanceLogger"))).addListener({onAnnotation:function(t,n,r,a,i){o("MessengerInfraQplReport").onAnnotationHandler(t,n,r,a,i)},onMarkerEnd:function(t,n,r){o("MessengerInfraQplReport").onMarkerEndHandler(t,n,r)},onMarkerPoint:function(t,n,r,a){o("MessengerInfraQplReport").onMarkerPointHandler(t,n,r,a)},onMarkerStart:function(t,n){o("MessengerInfraQplReport").onMarkerStartHandler(t,n)}});return function(){t.dispose()}};l.initializeWorkerLogger=s}),98);
__d("getBroadcastChannelForExecutionContext",["CometTaskFrameworkTypes","MWBroadcastChannel"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("MWBroadcastChannel").MWBroadcastChannel(o("CometTaskFrameworkTypes").TASK_FRAMEWORK_PREFIX+"_"+String(e))}l.default=e}),98);
__d("loadTaskHandlerResource",["cr:3760"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=n("cr:3760").TASK_HANDLERS_RESOURCES[e];return t==null?null:t.getModuleIfRequired()||t.load()}l.default=e}),98);
__d("registerExecutionContext",["BroadcastChannelClientServerHandshake","FBLogger","getBroadcastChannelForExecutionContext","getErrorSafe","loadTaskHandlerResource","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t){var n=e.context,o=e.name,a=e.payload;try{var i=await r("loadTaskHandlerResource")(o);if(i==null)throw r("FBLogger")("messenger_web").mustfixThrow("No task handler found in context %s",o);var l=await i.handleTask(a,n),s={context:n,result:l,type:"task_success"};t.postMessage(s)}catch(o){var u,c=r("getErrorSafe")(o);r("FBLogger")("messenger_web").catching(c).mustfix("%s executionContext: Failed to execute task %s",String(e.context.executionContext),e.name);var d={context:n,reason:(u=c.message)!=null?u:"",type:"task_failure"};t.postMessage(d)}}function s(t){var n=r("getBroadcastChannelForExecutionContext")(t);o("BroadcastChannelClientServerHandshake").listen(n);var a=new Set;return n.addEventListener("message",function(t){switch(t.data.type){case"execute_task":{var o=t.data,i=o.context.taskID;if(a.has(i))return;a.add(i),r("promiseDone")(e(o,n).finally(function(){a.delete(i)}));break}default:}}),function(){return n.close()}}l.default=s}),98);
__d("registerMAWExecutionContext",["CometTaskFrameworkTypes","registerExecutionContext"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("registerExecutionContext")(o("CometTaskFrameworkTypes").ExecutionContext.MAW_WORKER)}l.default=e}),98);
__d("MAWCommonMainWebWorker",["BackendInitLoggingUtils","BrowserLockManager","EBIsEbEnabled","EBIsEbEnabledSubscriber","EBLS","EBStateConsistencyMonitor","FBLogger","IGDWebUtils","MAWBackendBridgeSetup","MAWBridge","MAWCompareWorkerSetupArgs","MAWDataSyncQueue","MAWDeleteOldLogsFromDisk","MAWDeviceRegistrationInitWorker","MAWEBLSInWorkerSwitch","MAWGetDbVersion","MAWLoggingSwitches","MAWQplProxy","MAWRotateDTSG","MAWSetupAllDatabases","MAWSetupWorkerMsg","MAWVaultMaterials","MAWWebWorkerLogger","MAWWorkerEBDeps","MAWWorkerSetupArgs","MessengerInfraQplReportInWorker","QPLFlow","Random","WACrossWorkerPortal","WADevToolsBridge","WALogger","getSafeQplErrorMessage","gkx","justknobx","pageID","promiseDone","qpl","registerMAWExecutionContext"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("justknobx")._("1495"),c,d,m=!1;o("BackendInitLoggingUtils").initializeBackendLogging();function p(t){if(m){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Worker should not run initWorker() more than once."])));return}var n=t.currentWorker,a=o("MAWBackendBridgeSetup").initWorkerBridge(n);o("MessengerInfraQplReportInWorker").initializeWorkerLogger(),b(n),n.addMessageListener("worker-setup",async function(e){await _(e,t,a)}),o("MAWWorkerEBDeps").initEBDeps(),d=r("BrowserLockManager")!=null&&!u?v():null,n.addMessageListener("force-flush-data",function(){self.dispatchEvent(new CustomEvent("force-flush-logs")),r("promiseDone")(o("MAWDataSyncQueue").forceFlushDataSyncQueue())}),n.addMessageListener("force-flush-logs-only",function(){self.dispatchEvent(new CustomEvent("force-flush-logs"))}),m=!0}async function _(e,t,n){var a=t.config,i=t.currentWorker,l=new(o("MAWSetupWorkerMsg")).WorkerSetupComms(e.setupHash,i);l.postAck(),o("MAWQplProxy").resolveWorkerBridge();var s=o("MAWWorkerSetupArgs").getWorkerSetupArgs();try{s==null?await f(e,t,n,l):await g(s,e,a,l)}catch(e){throw r("gkx")("23986")&&r("promiseDone")(o("MAWWebWorkerLogger").flushLogs()),l.postFailure(o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)),e}}async function f(e,t,n,a){var i;if(!n.success){var l,s;a.postFailure((l=(s=n.payload)==null?void 0:s.message)!=null?l:"bridge_setup_fail");return}var u=t.config,m=t.initBackend,p=t.makeLowLevelApi;o("MAWWorkerSetupArgs").setWorkerSetupArgs(e.content),a.postBackendState("starting_new_setup"),h(e.content.vaultMaterials,a),o("MAWGetDbVersion").setArmadilloDbVersionForTest(e.content.testDbVersion),d=d!=null?d:v(),c=d.then(function(e){var t=e.hmacKey,n=e.regData;return m(n,t,o("MAWBridge").getBridge(),p(n.regInfo),u)}),o("MAWLoggingSwitches").removeLoggingFromBridge&&o("MAWDeleteOldLogsFromDisk").deleteOldLogsOnStartup(),y(e.content.devToolMessageChannelPort2);var _;if(((i=o("MAWWorkerSetupArgs").getWorkerSetupArgs())==null?void 0:i.ebState)!=null&&S()){var f;_=o("QPLFlow").startQPLFlow(r("qpl")._(521478131,"1562"),{annotations:{bool:{main_thread_state:(f=o("MAWWorkerSetupArgs").getWorkerSetupArgs())==null?void 0:f.ebState},string:{source:"worker_startup"}}})}o("EBLS").init().then(async function(e){if(_!=null){var t,n=await o("EBIsEbEnabled").isEbEnabledLS(e.db.tables),a=r("MAWEBLSInWorkerSwitch").isEnabled();_.addAnnotations({bool:{worker_state:n,worker_switch_state:a}}),((t=o("MAWWorkerSetupArgs").getWorkerSetupArgs())==null?void 0:t.ebState)===n?_.endSuccess():_.endFail("inconsistent_state")}o("EBIsEbEnabledSubscriber").initIsEbEnabledPubSub(e.db),o("EBStateConsistencyMonitor").startEBStateConsistencyMonitoring()}).catch(function(){o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(25310776,"6155"),"ebls_init_failed")}),await c,r("registerMAWExecutionContext")(),a.postSuccess()}async function g(e,t,n,a){if(!n.isSharedWorkerContext())throw r("FBLogger")("messenger_web").mustfixThrow("only shared workers can perform re-init!");var i=o("MAWCompareWorkerSetupArgs").didWorkerSetupArgsChange(e,t.content);if(i.hasArgsChanged){if(a.postRebootRequired(i.reason),n.isSharedWorkerContext()){var l="update-required-"+i.reason;o("MAWSetupWorkerMsg").shutdownSharedWorker(l)}else self.close();return}c==null&&a.postFailure("No setup happened"),a.postBackendState("setup_ongoing"),await c,a.postNoActionRequired()}function h(e,t){if(r("gkx")("23909")){if(e==null||e.encryptionKey==null||e.prefixAndSuffix==null)throw t.postFailure("null_vault_materials"),r("FBLogger")("messenger_web").mustfixThrow("Vault materials was null in worker setup");o("MAWVaultMaterials").initializeVaultMaterials(e)}else o("IGDWebUtils").isOnInstagramWeb()||r("FBLogger")("messenger_web").mustfix("[Vaulting] Vaulting GK disabled on worker init")}function y(e){if(r("gkx")("3282"))if(e==null)o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Missing DevTool port. Not able to setup DevTool"])));else{var t=o("WACrossWorkerPortal").attachPortal(o("WADevToolsBridge").getDevToolBridge(),["devtool","mawDbDevTool"],function(e,t){return e.push(t),e},r("pageID"));t.setPort(e)}}function C(e,t){c=e,m=t}function b(e){e.postMessage({status:"worker-ready",type:"worker-setup"})}async function v(){return r("promiseDone")(o("MAWRotateDTSG").tryRotateDTSG()),await o("MAWSetupAllDatabases").setupAllDatabases(),o("BackendInitLoggingUtils").MAWMICPoint("backend_db_ready"),o("MAWDeviceRegistrationInitWorker").registerDevice().then(function(e){return o("BackendInitLoggingUtils").MAWMICPoint("backend_device_ready"),e})}function S(){return o("Random").random()<r("justknobx")._("3951")/100}l.initWorker=p,l.presetBackend_TEST_ONLY=C}),98);
__d("WorkerBridgeAdaptor",["WorkerMessagePort","WorkerSelf"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n){var r;return r=e.call(this,t,n)||this,r.onmessage=null,o("WorkerSelf").init(r),r.$WorkerBridgeAdaptor$p_1=t,r.onUnhandledMessage.add(function(e){r.onmessage&&r.onmessage({data:e})}),r}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.getBridgePort=function(){return this},t})(o("WorkerMessagePort").WorkerSyncedMessagePort);l.default=e}),98);
__d("IGDAWMainWebWorker",["CurrentWorkerMessagePort","FalcoLoggerTransports","IGDAWMainWebWorkerConfig","IGDBackend","IGDLowLevelApiImpl","MAWCommonMainWebWorker","WorkerBridgeAdaptor"],(function(t,n,r,o,a,i,l){"use strict";function e(){self.Env=self.Env||{};var e=new(r("WorkerBridgeAdaptor"))(o("CurrentWorkerMessagePort").getMessagePort(),"IGDAWMainWebWorker");o("MAWCommonMainWebWorker").initWorker({config:o("IGDAWMainWebWorkerConfig").waConfig,currentWorker:e,initBackend:o("IGDBackend").startIGDBackend,makeLowLevelApi:o("IGDLowLevelApiImpl").makeLowLevelApi}),o("FalcoLoggerTransports").attach()}l.default=e}),98);
__d("MAWCatQuery_instagramRelayOperation",[],(function(t,n,r,o,a,i){a.exports="29559957360285299"}),null);
__d("MAWCatQuery.instagram.graphql",["MAWCatQuery_instagramRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{alias:null,args:null,concreteType:"SecureMessageOverWACATGraphResult",kind:"LinkedField",name:"secure_message_over_wa_cat_query",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_serialized_cat",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"expiration_time_in_seconds",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MAWCatQuery",selections:e,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"MAWCatQuery",selections:e},params:{id:n("MAWCatQuery_instagramRelayOperation"),metadata:{},name:"MAWCatQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("ReStoreLocalStorageQuotaExceed",["FBLogger","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e="Failed to execute 'setItem' on 'Storage'",s="ReStoreLocalStorageQuotaExceed";function u(){try{var t=window.localStorage,n=[],o=[];if(t!=null&&t.length!==0){for(var a in t)if(n.length===0&&o.length===0&&a.includes("falco_queue_log")&&o.push(a),!!Object.prototype.hasOwnProperty.call(t,a)){var i=((t[a]||"").length+a.length)*2;i/1024>2e3&&n.push(a)}}return r("FBLogger")("messenger_web").mustfix(e+": QuotaExceeded - trying to clean up %s or %s",n.join(","),o.join(",")),n.length!==0?n:o}catch(e){return r("FBLogger")("messenger_web").mustfix("Error getting local storage big values for cleanup."),[]}}function c(){try{var e=window.localStorage,t=u();t.forEach(function(t){e.removeItem(t)})}catch(e){var n=r("getErrorSafe")(e);r("FBLogger")("maw_db").mustfix("Couldn't remove vals from localStorage",n.message)}}var d=(function(t){function n(n){var r,o=e+": "+n+"; Keys to delete: "+u().join(",");return r=t.call(this,o)||this,r.message=o,r.name=s,r}return babelHelpers.inheritsLoose(n,t),n})(babelHelpers.wrapNativeSuper(Error));l.ERROR_NAME=s,l.getLocalStorageValuesToRemoveOnExceed=u,l.clearLocalStorageBigValues=c,l.ReStoreLocalStorageQuotaExceed=d}),98);