;/*FB_PKG_DELIM*/

__d("ArmadilloSignatures",["WASignalKeys","WASignalOther","WASignalSignatures","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n,r=(n=o("WASignalOther")).ensureSize(o("XPlatReactCrypto").getRandomValues(new Uint8Array(64)),64);return o("WASignalSignatures").makeSignature(o("WASignalKeys").makeKeyPairFromArrayBuffers(n.toBuffer(n.makeBytes(32)),n.toBuffer(e)),t,r)}function s(e,t,n){return o("WASignalSignatures").verifyMsgSignalVariant(o("WASignalSignatures").convertPublicKeyToSerializedPubKey(t),n,e)}l.armadilloSign=e,l.validateArmadilloSignature=s}),98);
__d("ArrayBuffer",["UInt8Array"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.map(function(e){return new Uint8Array(e)});return o("UInt8Array").concatBytes(t).buffer}l.mergeBuffers=e}),98);
__d("CreateEncryptionKeyPair",["CryptoLogger","Promise","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("X25519").__setRef("CreateEncryptionKeyPair");function u(){return s.load().then(function(t){var r=t.generateKeys(t.KeyPurpose.Encryption);return(e||(e=n("Promise"))).resolve([r.sk.buffer,r.pk.buffer])}).catch(function(e){var t=o("CryptoLogger").CryptoLogger("create_encryption_key_pair");throw o("CryptoLogger").captureError(t,e).mustfix("failed to generate an encryption key pair"),e})}l.default=u}),98);
__d("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="25483983211276282"}),null);
__d("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery.graphql",["EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e={defaultValue:null,kind:"LocalArgument",name:"request_uuid"},t={defaultValue:null,kind:"LocalArgument",name:"virtual_device_id"},r={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},a={alias:null,args:null,concreteType:"FetchVirtualDeviceInfoMinosEpochSerializablePayload",kind:"LinkedField",name:"minos_epoch",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"epoch_head",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"self_epoch_signature",storageKey:null}],storageKey:null},i=[{alias:null,args:[{fields:[{kind:"Variable",name:"request_uuid",variableName:"request_uuid"},{kind:"Variable",name:"virtual_device_id",variableName:"virtual_device_id"}],kind:"ObjectValue",name:"request"}],concreteType:"FetchVirtualDeviceInfoResponseWrapper",kind:"LinkedField",name:"fetch_virtual_device_info_for_device_addition_v2",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoError",kind:"LinkedField",name:"error",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"code",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoResponse",kind:"LinkedField",name:"data",plural:!1,selections:[{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoEncryptedSecretValues",kind:"LinkedField",name:"encrypted_secret_values",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_anon_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_root_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_storage_private_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_mailbox_root_key_blob",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_oblivious_validation_token_blob",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_ocmf_client_state",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_orf_client_state_v2",storageKey:null}],storageKey:null},r,{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_epoch_id",storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoSyncEpochsPayload",kind:"LinkedField",name:"sync_epochs",plural:!0,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},o,{alias:null,args:null,kind:"ScalarField",name:"epoch_auth_public_key",storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoEpochDataSerializablePayload",kind:"LinkedField",name:"epoch_data_v2",plural:!1,selections:[o,{alias:null,args:null,kind:"ScalarField",name:"epoch_root_key",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_active_epoch",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_epoch_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"prev_epoch_id",storageKey:null},a],storageKey:null},a],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,t],kind:"Fragment",metadata:null,name:"EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery",selections:i,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[t,e],kind:"Operation",name:"EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery",selections:i},params:{id:n("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery_facebookRelayOperation"),metadata:{},name:"EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("EBGetLSVirtualDevices",["ReQL"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.tables.encrypted_backups_virtual_devices))}l.getLSVirtualDevices=e}),98);
__d("LSCreateAuthKeyPair.nop",["CryptoLogger","Promise","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("X25519").__setRef("LSCreateAuthKeyPair.nop"),u=function(r,a){return s.load().then(function(t){var r=t.generateKeys(t.KeyPurpose.Encryption),o=r.pk,a=r.sk;return(e||(e=n("Promise"))).resolve([a.buffer,o.buffer])}).catch(function(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("create_auth_key_pair"),e).mustfix("failed to generate an auth key pair"),e})};u.__nop_name__="LSCreateAuthKeyPair",l.default=u}),98);
__d("LSCreateDebugToken.nop",["ArrayBuffer","Base64Utils","CryptoLogger","I64","LSCreateDerivedKeys.nop","LSCryptoUtils","LSVec","Promise","RetUtil","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("LSCryptoUtils").strToBuf("debug_token_type_"),c=o("LSCryptoUtils").strToBuf("debug_token_rkid"),d=o("LSCryptoUtils").strToBuf("debug_token_anon"),m=(s||(s=o("I64"))).of_string("32"),p=s.of_string("12");function _(e){return Array.from(e.keys()).reduce(function(t,n){var r=e.get(n);return r!=null&&(t[n]=r),t},{})}function f(e){return new Int32Array([new DataView(new Int32Array([e]).buffer).getInt32(0)]).buffer}function g(e,t){var n=t.length,r=o("ArrayBuffer").mergeBuffers([e,f(n)]);return o("ArrayBuffer").mergeBuffers([r,o("LSCryptoUtils").strToBuf(t)])}function h(e,t){var n=t.keys().sort();return n.reduce(function(e,n){var r=t.get(n);return r!=null?g(g(e,n),r):e},g(u,e))}function y(e,t,n,o,a){return r("LSCreateDerivedKeys.nop")(e,t,n,void 0,o,r("LSVec").ofArray([a])).then(function(e){var t=e[0];if(t!=null){var n=r("LSVec").toArray(t);return n.length===1?n[0]:void 0}})}function C(t,a,i,l,u){return(s||(s=o("I64"))).equal((s||(s=o("I64"))).zero,u)?y(t,a,d,l,m).then(function(e){return y(t,a,i,r("nullthrows")(e),(s||(s=o("I64"))).of_int32(i.byteLength))}):(e||(e=n("Promise"))).resolve(i)}function b(e,t,n,o,a,i,l){return y(e,t,n,o,a).then(function(n){return C(e,t,r("nullthrows")(n),i,l)})}var v=function(a,i,l,u,d,f,g){try{return(e||(e=n("Promise"))).all([y(a,i,h(u,g),l,m).then(function(e){return b(a,i,d,r("nullthrows")(e),p,l,f)}),b(a,i,c,l,p,l,f)]).then(function(e){var t=e[0],n=e[1];return o("RetUtil").getNullableRetResult(o("LSCryptoUtils").strToBuf(JSON.stringify({ctx:(s||(s=o("I64"))).equal((s||(s=o("I64"))).zero,f)?"anon":"auth",rkid:o("Base64Utils").fromArrayBuffer(r("nullthrows")(n)),scopes:_(g),type:u,val:o("Base64Utils").fromArrayBuffer(r("nullthrows")(t))})))})}catch(t){return o("CryptoLogger").CryptoLogger("create_debug_token").warn("getExn Error"),(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult())}};v.__nop_name__="LSCreateDebugToken",l.default=v}),98);
__d("LSCreateEncryptionKeyPair.nop",["CreateEncryptionKeyPair"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n){return r("CreateEncryptionKeyPair")()};e.__nop_name__="LSCreateEncryptionKeyPair",l.default=e}),98);
__d("LSCreateSignatureKeyPair.nop",["CryptoLogger","Promise","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("X25519").__setRef("LSCreateSignatureKeyPair.nop"),u=function(r,a){return s.load().then(function(t){var r=t.generateKeys(t.KeyPurpose.Signing);return(e||(e=n("Promise"))).resolve([r.sk.buffer,r.pk.buffer])}).catch(function(e){var t=o("CryptoLogger").CryptoLogger("create_signature_key_pair");throw o("CryptoLogger").captureError(t,e).mustfix("Failed to create signing key pair keys"),e})};u.__nop_name__="LSCreateSignatureKeyPair",l.default=u}),98);
__d("LSCreateSignatureWithArmadilloKey.nop",["ArmadilloSignatures","EBDeps","LSResult"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,a){return o("EBDeps").getDeps().getMAWIdentityKeys().then(function(e){var t=e.identityPrivateKey;return o("ArmadilloSignatures").armadilloSign(t,new Uint8Array(a))}).then(function(e){return r("LSResult")(e.buffer)})};e.__nop_name__="LSCreateSignatureWithArmadilloKey",l.default=e}),98);
__d("LSCreateSignature_v2.nop",["CryptoLogger","LSResult","Promise","UInt8Array","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("X25519").__setRef("LSCreateSignature_v2.nop");function u(e){return r("LSResult")(e)}function c(e,t){return o("UInt8Array").concatBytes([t,e].map(function(e){return new Uint8Array(e)}))}var d=function(r,a,i,l,d){var t=o("CryptoLogger").CryptoLogger("create_signature_v2");return l.byteLength!==1?(t.mustfix("Bad aad for signing, should be 1 byte"),(e||(e=n("Promise"))).resolve(u(void 0))):s.load().then(function(r){var o=r.secretKeyFromBytes(new Uint8Array(i),r.KeyPurpose.Signing);return o!=null?r.sign(o,c(d,l)).then(function(t){return(e||(e=n("Promise"))).resolve(u(t.buffer))}):(t.mustfix("No Signature Private key"),(e||(e=n("Promise"))).resolve(u(void 0)))})};d.__nop_name__="LSCreateSignature_v2",l.default=d}),98);
__d("LSGetArmadilloPublicKey.nop",["CryptoLogger","EBDeps","Promise","RetUtil"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(r,a){return o("EBDeps").getDeps().getMAWIdentityKeys().then(function(t){return(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult(t.identityPublicKey.buffer))}).catch(function(t){var r=o("CryptoLogger").CryptoLogger("get_armadillo_keys");return r.catching(t).mustfix("Failed to get identity keys."),(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult())})};s.__nop_name__="LSGetArmadilloPublicKey",l.default=s}),98);
__d("LSHandleWrongRecoveryCode",["LSAppendDataTraceAddon","LSIsMobileClient","LSLogMebClientEvent.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] Beginning execution."),e[0]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[0],"dasm_handle_wrong_recovery_code_sproc_start"):t.resolve()},function(r){return e[0]!==void 0&&e[1]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[0],"dasm_handle_wrong_recovery_code_error_message",e[1]):t.resolve()},function(o){return t.sequence([function(r){return e[0]!==void 0?t.storedProcedure(n("LSAppendDataTraceAddon"),e[0],t.i64.cast([0,1415]),t.i64.cast([0,2]),e[1],void 0):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[7]=t[0],t})},function(e){return r[7]?r[8]=!0:r[8]=!1,r[8]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[10]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[10]].join("")),r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[10],r[9],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,3])})},function(o){return e[2]?t.resolve(0):e[1]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ","",e[1]].join("")),r[7]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",e[1],r[7],t.i64.cast([0,3]))):t.resolve()},function(r){return e[0]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[0],"dasm_handle_wrong_recovery_code_sproc_end"):t.resolve()},function(e){return r[1]=t.i64.of_float(Date.now()),r[2]=t.i64.random(),r[4]="Finishing execution. Execution time: ",r[5]=t.i64.to_string(t.i64.sub(r[1],r[0])),r[6]=" ms",r[3]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ",r[3],r[4],r[3],r[5],r[3],r[6]].join("")),t.i64.eq(t.i64.mod_(r[2],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[7]=",",r[8]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",[r[4],r[7],r[5],r[7],r[6]].join(""),r[8],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",e.__tables__=["secure_encrypted_backups_recovery_code_status"],a.exports=e}),null);
__d("LSIsValidEpochAnonIdFlow",[],(function(t,n,r,o,a,i){"use strict";var e=11;function l(t){if(t.byteLength>e)return!1;for(var n=new Int8Array(t),r=0,o=0;o<n.length;o++)r|=+(n[o]<48),r|=+(n[o]>57);return r===0}i.call=l}),66);
__d("LSIsValidEpochAnonId.nop",["LSIsValidEpochAnonIdFlow","LSResult","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i,l){return(e||(e=n("Promise"))).resolve(r("LSResult")(o("LSIsValidEpochAnonIdFlow").call(l)))};s.__nop_name__="LSIsValidEpochAnonId",l.default=s}),98);
__d("ObliviousConsistentMappingFunction",["FBLogger","UInt8Array","nullthrows","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("ristretto255").__setRef("ObliviousConsistentMappingFunction");function s(e){return e.some(function(e){return e!==0})}function u(e){for(;;){var t=e.getRandom();if(s(t))return t}return new Uint8Array(0)}var c=r("nullthrows")(o("UInt8Array").fromHexString("edd3f55c1a631258d69cf7a2def9de1400000000000000000000000000000010"));function d(e){return"ClientState has length "+String(e)+", expected "+String(32)}function m(e){return"ClientState is greater or equal to max: "+e.toString()}var p="ClientState is zero.";function _(e){var t=e.length;if(t!==32)throw r("FBLogger")("wmi_eb").mustfixThrow(d(t));var n=e.reduce(function(e,t){return e?!0:t>0},!1);if(!n)throw r("FBLogger")("wmi_eb").mustfixThrow(p);for(var o=!1,a=31;a>=0;--a)if(!o){var i=e[a],l=c[a];if(i>l)throw r("FBLogger")("wmi_eb").mustfixThrow("ClientState is greater or equal to max: "+e.toString());i<l&&(o=!0)}if(!o)throw r("FBLogger")("wmi_eb").mustfixThrow("ClientState is greater or equal to max: "+e.toString())}function f(t){return _(t),e.load().then(function(e){var n=u(e.scalar),r=e.scalar.mul(t,n),o=e.scalar.invert(n);return{evolveToken:o,newClientState:r}})}l.checkNonZero=s,l.maxState=c,l.buildInputLengthErrorMsg=d,l.buildInputValueErrorMsg=m,l.getInputZeroErrorMsg=p,l.clientEvolve=f}),98);
__d("LSOcmfClientEvolve_v2.nop",["CryptoLogger","ObliviousConsistentMappingFunction"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,r){return o("ObliviousConsistentMappingFunction").clientEvolve(new Uint8Array(r)).then(function(e){return[e.newClientState.buffer,e.evolveToken.buffer]}).catch(function(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("ocmf_client_evolve_v2"),e).mustfix("Failed to evolve client."),e})};e.__nop_name__="LSOcmfClientEvolve_v2",l.default=e}),98);
__d("LSPublicEncryptionCreateDecryptedData.nop",["PublicEncryptionCreateDecryptedData"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,o,a,i,l,s,u){return r("PublicEncryptionCreateDecryptedData")(o,a,i,l,s,u)};e.__nop_name__="LSPublicEncryptionCreateDecryptedData",l.default=e}),98);
__d("LSSymmetricEncryptionCreateDecryptedString.nop",["Base64Utils","CryptoLogger","LSResult","LSSymmetricEncryptionCreateDecryptedData.nop","XPlatReactTextDecoder"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return r("LSResult")(e)}var s=function(n,a,i,l,s){var t=o("CryptoLogger").CryptoLogger("symmetric_encryption_create_decrypted_string"),u=o("Base64Utils").toArrayBuffer(s);return r("LSSymmetricEncryptionCreateDecryptedData.nop")(n,a,i,l,u).then(function(e){var t=e[0];return t}).then(function(t){return t==null?e():e(new(o("XPlatReactTextDecoder")).TextDecoder().decode(t))}).catch(function(n){return o("CryptoLogger").captureError(t,n).mustfix("symmetric string decryption failed"),e()})};s.__nop_name__="LSSymmetricEncryptionCreateDecryptedString",l.default=s}),98);
__d("LSAddDeviceWithVirtualDeviceAndDecryptionKey",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Decode.nop","LSBase64Encode.nop","LSCreateAuthKeyPair.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignatureWithArmadilloKey.nop","LSCreateSignature_v2.nop","LSDeleteBackupOnClient","LSGetArmadilloPublicKey.nop","LSGetBlobFromString.nop","LSHandleWrongRecoveryCode","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIsValidEpochAnonId.nop","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop","LSPublicEncryptionCreateDecryptedData.nop","LSQplAnnotateInt.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop","LSSymmetricEncryptionCreateDecryptedString.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(a){return t.sequence([function(r){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] Beginning execution."),e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_sproc_start"):t.resolve()},function(a){return t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}).next().then(function(a,i){var l=a.done,s=a.value;return l?t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_delete_client_state_start"):t.resolve()},function(e){return t.db.table(168).fetch().next().then(function(e,r){var o=e.done,a=e.value;return o?0:(r=a.item,t.storedProcedure(n("LSDeleteBackupOnClient"),r.backupId,void 0,!1,void 0,"null",!0))})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_delete_client_state_end"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_decrypt_virtual_device_secrets_start"):t.resolve()},function(r){return o[8]=e[3].get("encrypted_ocmf_client_state"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),o[8]).then(function(e){var t;return t=e,o[9]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[9]).then(function(e){var t;return t=e,o[10]=t[0],t})},function(r){return t.blobs.neq(o[10],void 0)?t.resolve(o[11]=o[10]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[8]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[11]=o[41]}])},function(r){return o[12]=e[3].get("encrypted_oblivious_validation_token_blob"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),o[12]).then(function(e){var t;return t=e,o[13]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[13]).then(function(e){var t;return t=e,o[14]=t[0],t})},function(r){return t.blobs.neq(o[14],void 0)?t.resolve(o[15]=o[14]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[12]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[15]=o[41]}])},function(r){return o[16]=e[3].get("encrypted_epoch_anon_id"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),o[16]).then(function(e){var t;return t=e,o[17]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[17]).then(function(e){var t;return t=e,o[18]=t[0],t})},function(r){return t.blobs.neq(o[18],void 0)?t.resolve(o[19]=o[18]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[16]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[19]=o[41]}])},function(e){return t.blobs.neq(o[19],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSIsValidEpochAnonId.nop"),o[19]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return o[20]=o[40]}]):t.resolve(o[20]=!1)},function(r){return o[20]?o[21]=o[19]:o[21]=void 0,o[22]=e[3].get("encrypted_epoch_root_key"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),o[22]).then(function(e){var t;return t=e,o[23]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[23]).then(function(e){var t;return t=e,o[24]=t[0],t})},function(r){return t.blobs.neq(o[24],void 0)?t.resolve(o[25]=o[24]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[22]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[25]=o[41]}])},function(r){return o[26]=e[3].get("encrypted_mailbox_root_key_blob"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),o[26]).then(function(e){var t;return t=e,o[27]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[27]).then(function(e){var t;return t=e,o[28]=t[0],t})},function(r){return t.blobs.neq(o[28],void 0)?t.resolve(o[29]=o[28]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[26]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[29]=o[41]}])},function(r){return o[30]=e[3].get("encrypted_epoch_storage_private_key"),o[30]!==void 0?t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),o[30]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(r){return t.blobs.neq(o[41],void 0)?t.resolve(o[42]=o[41]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[30]).then(function(e){var t;return t=e,o[43]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[43]).then(function(e){var t;return t=e,o[44]=t[0],t})},function(e){return o[42]=o[44]}])},function(e){return o[31]=o[42]}]):t.resolve(o[31]=void 0)},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_decrypt_virtual_device_secrets_end"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_generate_keys_start"):t.resolve()},function(e){return t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,o[32]=t[0],o[33]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,o[34]=t[0],o[35]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[32],t.blob("MA=="),o[35]).then(function(e){var t;return t=e,o[36]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateAuthKeyPair.nop")).then(function(e){var t;return t=e,o[37]=t[0],o[38]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[32],t.blob("MQ=="),o[38]).then(function(e){var t;return t=e,o[39]=t[0],t})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_generate_keys_end"):t.resolve()},function(a){return t.blobs.neq(o[11],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),o[11]).then(function(e){var t;return t=e,o[40]=t[0],o[41]=t[1],t})},function(e){var r;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,o[46]=t[0],o[47]=t[1],t})},function(e){var t;return t=[o[40],o[41],o[46],o[47]],o[42]=t[0],o[43]=t[1],o[44]=t[2],o[45]=t[3],t}]):t.resolve((r=[o[40],o[41],void 0,void 0],o[42]=r[0],o[43]=r[1],o[44]=r[2],o[45]=r[3],r))},function(a){return t.blobs.neq(o[21],void 0)?t.blobs.neq(o[25],void 0)?t.blobs.neq(o[15],void 0)?t.blobs.neq(o[29],void 0)?t.sequence([function(r){return e[12]!==void 0?(o[61]=e[12].get("epoch_head"),o[46]=o[61]):o[46]=void 0,o[47]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,o[48]=t[0],t})},function(e){return o[48]&&(o[61]=(o[47].push(t.i64.cast([0,0])),o[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,o[49]=t[0],t})},function(e){return o[49]&&(o[61]=(o[47].push(t.i64.cast([0,2])),o[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,o[50]=t[0],t})},function(e){return o[50]&&(o[61]=(o[47].push(t.i64.cast([0,3])),o[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,o[51]=t[0],t})},function(e){return o[51]&&(o[61]=(o[47].push(t.i64.cast([0,4])),o[47])),o[52]="",o[53]=t.i64.of_int32(o[47].length),t.i64.gt(o[53],t.i64.cast([0,0]))?t.loopAsync(o[53],function(e){return o[61]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[47],o[61]).then(function(e){var t;return t=e,o[62]=t[0],o[63]=t[1],t})},function(e){return o[52]=[o[52],"_",t.i64.to_string(o[62])].join("")}])}):t.resolve()},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),["supported_versions_",o[52],"revision_version_",t.i64.to_string(t.i64.cast([0,1]))].join("")).then(function(e){var t;return t=e,o[54]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[32],t.blob("Mg=="),o[54]).then(function(e){var t;return t=e,o[55]=t[0],t})},function(e){return t.blobs.neq(o[55],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[55]).then(function(e){var t;return t=e,o[61]=t[0],t})},function(e){return o[56]=o[61]}]):t.resolve(o[56]=void 0)},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_cleanup_state_start"):t.resolve()},function(e){return t.forEach(t.db.table(168).fetch(),function(e){return e.delete()})},function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_cleanup_state_end"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_optimisitc_client_state_start"):t.resolve()},function(n){return t.forEach(t.filter(t.db.table(168).fetch([[[e[1]]]]),function(n){return t.i64.eq(n.backupId,e[1])&&t.i64.lt(n.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(n){return t.db.table(168).add({backupId:e[1],devicePublicKeyBlob:o[33],devicePrivateKeyBlob:o[32],epochStoragePublicKeyBlob:o[35],epochStoragePrivateKeyBlob:o[34],epochAuthPublicKeyBlob:o[38],epochAuthPrivateKeyBlob:o[37],mailboxRootKeyBlob:o[29],ocmfClientStateBlob:o[42],obliviousValidationTokenBlob:o[15],encryptionVersion:t.i64.cast([0,0]),revisionVersion:t.i64.cast([0,1]),authorityLevel:t.i64.cast([0,20]),backupTenancy:e[7]})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_optimisitc_client_state_end"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_epoch_data_start"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_populate_epochs_table_start"):t.resolve()},function(n){return t.forEach(t.filter(t.db.table(169).fetch([[[e[2]]]]),function(n){return t.i64.eq(n.epochId,e[2])&&t.i64.lt(n.authorityLevel,t.i64.cast([0,80]))}),function(e){return e.delete()})},function(n){return t.db.table(169).add({epochId:e[2],authorityLevel:t.i64.cast([0,80]),backupId:e[1],epochAnonIdBlob:o[21],epochRootKeyBlob:o[25],epochStatus:t.i64.cast([0,1]),epochHead:o[46]})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_populate_epochs_table_end"):t.resolve()},function(r){return o[57]=e[5].keys(),o[58]=t.i64.of_int32(o[57].length),e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateInt.nop"),t.i64.cast([0,1021646192]),e[8],"num_epochs",o[58]):t.resolve()},function(a){return t.i64.eq(o[58],t.i64.cast([0,1]))?t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_epoch_derivation_skipped"):t.resolve()},function(r){return o[61]=e[5].has(t.i64.to_string(e[2])),o[61]?t.resolve(0):((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] sync_epochs does not contain base epoch"),o[63]="sync_epochs does not contain base epoch",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[63]].join("")),o[62]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[63],o[62],t.i64.cast([0,3])))}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_epoch_derivation_start"):t.resolve()},function(e){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] Triggering epoch derivation."),o[61]=r("justknobx")._("1310"),t.resolve()},function(r){return o[61]===!1&&(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] Epoch rotation is disabled for the user but received more than one epoch."),t.blobs.neq(o[31],void 0)?t.sequence([function(e){return o[65]="Starting epoch derivation at base epoch of anon id (base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[21]).then(function(e){var t;return t=e,o[62]=t[0],t})},function(e){return o[66]=o[62]==null?"":o[62],o[63]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[63],o[65],o[63],o[66]].join("")),t.resolve()},function(r){return o[64]=e[5].get(t.i64.to_string(e[2])),o[64]!==void 0?t.sequence([function(n){return o[67]=o[64].get("minos_epoch"),o[67]!==void 0?(o[79]=o[67].get("epoch_head"),o[68]=o[79]):o[68]=void 0,o[69]=o[64].get("is_active_epoch"),o[69]?o[70]=t.i64.cast([0,1]):o[70]=t.i64.cast([0,2]),t.forEach(t.db.table(169).fetch([[[e[2]]]]),function(e){var n=e.update,r=e.item;return n({authorityLevel:t.i64.cast([0,80]),epochStatus:o[70],epochHead:o[68]})})},function(r){return o[71]=new t.Map,o[71].set("epoch_id",e[2]),o[71].set("authority_level",t.i64.cast([0,80])),o[71].set("backup_id",e[1]),o[71].set("epoch_anon_id_blob",o[21]),o[71].set("epoch_root_key_blob",o[25]),o[71].set("epoch_status",t.i64.cast([0,1])),o[71].set("epoch_head",o[46]),o[72]=o[71],o[73]=e[5].keys(),o[74]=t.i64.of_int32(o[73].length),t.i64.gt(o[74],t.i64.cast([0,0]))?t.loopAsync(o[74],function(r){return o[79]=r,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[73],o[79]).then(function(e){var t;return t=e,o[80]=t[0],o[81]=t[1],t})},function(r){return o[82]=o[72].get("epoch_id"),o[83]=o[72].get("backup_id"),o[84]=o[72].get("epoch_anon_id_blob"),o[85]=o[72].get("epoch_root_key_blob"),o[86]=o[72].get("epoch_status"),o[87]=o[72].get("authority_level"),o[88]=o[72].get("epoch_head"),o[89]=e[5].get(t.i64.to_string(o[82])),o[89]!==void 0?t.sequence([function(r){return o[98]=o[89].get("next_epoch_id"),t.i64.neq(o[98],void 0)?t.sequence([function(r){return o[106]=e[5].get(t.i64.to_string(o[98])),o[106]!==void 0?t.sequence([function(e){return o[114]=o[106].get("backup_id"),o[115]=o[106].get("is_active_epoch"),o[115]?o[116]=t.i64.cast([0,1]):o[116]=t.i64.cast([0,2]),o[117]=o[106].get("epoch_anon_id"),o[118]=o[106].get("minos_epoch"),o[118]!==void 0?(o[137]=o[118].get("epoch_head"),o[119]=o[137]):o[119]=void 0,o[120]=t.createArray(),o[137]=(o[120].push(t.i64.cast([0,32])),o[120]),o[137]=(o[120].push(t.i64.cast([0,32])),o[120]),o[121]="_",t.nativeOperation(n("LSGetBlobFromString.nop"),["epoch_chaining",o[121],t.blobs.to_string(o[84]),o[121],t.i64.to_string(o[82])].join("")).then(function(e){var t;return t=e,o[122]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),o[122],void 0,o[85],o[120]).then(function(e){var t;return t=e,o[123]=t[0],t})},function(e){return o[123]?o[124]=!1:o[124]=!0,o[124]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key."),o[138]="Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[138]].join("")),o[137]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[138],o[137],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[139]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[140]=t[0],t})},function(e){var t;return t=[o[139],o[140]],o[125]=t[0],o[126]=t[1],t}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[123],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[137]=t[0],o[138]=t[1],t})},function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[123],t.i64.cast([0,1])).then(function(e){var t;return t=e,o[139]=t[0],o[140]=t[1],t})},function(e){var t;return t=[o[137],o[139]],o[125]=t[0],o[126]=t[1],t}])},function(r){return o[127]=o[106].get("encrypted_epoch_key"),t.blobs.neq(o[127],void 0)?t.sequence([function(r){return o[137]=o[106].get("epoch_auth_public_key"),o[138]=o[106].get("epoch_anon_id"),t.nativeOperation(n("LSPublicEncryptionCreateDecryptedData.nop"),e[6],o[31],o[137],o[126],t.blobs.of_string(["epoch_","_",t.blobs.to_string(o[138])].join("")),o[127]).then(function(e){var t;return t=e,o[139]=t[0],t})},function(e){return t.blobs.neq(o[139],void 0)?t.resolve(o[140]=o[139]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] Couldn't decrypt epoch key. Returning null entropy"),o[142]="Couldn't decrypt epoch key. Returning null entropy",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[142]].join("")),o[141]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[142],o[141],t.i64.cast([0,3]))},function(e){return o[140]=void 0}])},function(e){return o[128]=o[140]}]):t.sequence([function(e){return o[140]="encrypted_epoch_key is null. Can't generate epoch entropy. epoch_anon_id(base64) = ",o[137]=o[106].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[137]).then(function(e){var t;return t=e,o[138]=t[0],t})},function(e){return o[141]=o[138]==null?"":o[138],o[139]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[139],o[140],o[139],o[141]].join("")),o[142]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[140],",",o[141]].join(""),o[142],t.i64.cast([0,3]))},function(e){return o[128]=void 0}])},function(e){return t.blobs.neq(o[128],void 0)?t.sequence([function(e){return o[137]=t.createArray(),o[142]=(o[137].push(t.i64.cast([0,32])),o[137]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_root_key").then(function(e){var t;return t=e,o[138]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),o[138],o[125],o[128],o[137]).then(function(e){var t;return t=e,o[139]=t[0],t})},function(e){return o[139]?o[140]=!1:o[140]=!0,o[140]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] Unable to generate epoch root key."),o[143]="Unable to generate epoch root key.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[143]].join("")),o[142]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[143],o[142],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[144]=t[0],t})},function(e){return o[141]=o[144]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[139],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[142]=t[0],o[143]=t[1],t})},function(e){return o[141]=o[142]}])},function(e){return o[129]=o[141]}]):t.sequence([function(e){return o[140]="epoch entropy is null. Can't generate epoch root key. epoch_anon_id(base64) = ",o[137]=o[106].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[137]).then(function(e){var t;return t=e,o[138]=t[0],t})},function(e){return o[141]=o[138]==null?"":o[138],o[139]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[139],o[140],o[139],o[141]].join("")),o[142]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[140],",",o[141]].join(""),o[142],t.i64.cast([0,3]))},function(e){return o[129]=void 0}])},function(e){return t.blobs.neq(o[129],void 0)?t.sequence([function(e){return t.filter(t.db.table(169).fetch([[[o[98]]]]),function(e){return t.i64.eq(e.epochId,o[98])&&t.i64.gt(e.authorityLevel,t.i64.cast([0,80]))}).next().then(function(e){var n=e.done,r=e.value;return n?t.db.table(169).put({epochId:o[98],backupId:o[114],epochAnonIdBlob:o[117],epochRootKeyBlob:o[129],epochStatus:o[116],authorityLevel:t.i64.cast([0,80]),epochHead:o[119]}):0})},function(e){var n;return n=[o[98],o[114],o[117],o[129],o[116],o[119],t.i64.cast([0,80])],o[130]=n[0],o[131]=n[1],o[132]=n[2],o[133]=n[3],o[134]=n[4],o[135]=n[5],o[136]=n[6],n}]):t.sequence([function(e){return o[140]="Epoch root key is null. Can't write the epoch to the table. epoch_anon_id(base64) = ",o[137]=o[106].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[137]).then(function(e){var t;return t=e,o[138]=t[0],t})},function(e){return o[141]=o[138]==null?"":o[138],o[139]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[139],o[140],o[139],o[141]].join("")),o[142]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[140],",",o[141]].join(""),o[142],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[130]=t[0],o[131]=t[1],o[132]=t[2],o[133]=t[3],o[134]=t[4],o[135]=t[5],o[136]=t[6],t}])},function(e){var t;return t=[o[130],o[131],o[132],o[133],o[134],o[135],o[136]],o[107]=t[0],o[108]=t[1],o[109]=t[2],o[110]=t[3],o[111]=t[4],o[112]=t[5],o[113]=t[6],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Unexpected error! New epoch is null even though we have a new_epoch_id value"),o[115]="Unexpected error! New epoch is null even though we have a new_epoch_id value",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ","",o[115]].join("")),o[114]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",o[115],o[114],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[107]=t[0],o[108]=t[1],o[109]=t[2],o[110]=t[3],o[111]=t[4],o[112]=t[5],o[113]=t[6],t}])},function(e){var t;return t=[o[107],o[108],o[109],o[110],o[111],o[112],o[113]],o[99]=t[0],o[100]=t[1],o[101]=t[2],o[102]=t[3],o[103]=t[4],o[104]=t[5],o[105]=t[6],t}]):t.sequence([function(e){return o[108]="New epoch is null. This is expected if epoch_id is the root or last epoch. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[106]=t[0],t})},function(e){return o[109]=o[106]==null?"":o[106],o[110]=" , is_forward = ",o[111]="1",o[107]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[107],o[108],o[107],o[109],o[107],o[110],o[107],o[111]].join("")),t.resolve()},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[99]=t[0],o[100]=t[1],o[101]=t[2],o[102]=t[3],o[103]=t[4],o[104]=t[5],o[105]=t[6],t}])},function(e){var t;return t=[o[99],o[100],o[101],o[102],o[103],o[104],o[105]],o[90]=t[0],o[91]=t[1],o[92]=t[2],o[93]=t[3],o[94]=t[4],o[95]=t[5],o[96]=t[6],t}]):t.sequence([function(e){return o[100]="Unexpected error! server epoch is null even though we have epoch_id. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[98]=t[0],t})},function(e){return o[101]=o[98]==null?"":o[98],o[99]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[99],o[100],o[99],o[101]].join("")),o[102]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[100],",",o[101]].join(""),o[102],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[90]=t[0],o[91]=t[1],o[92]=t[2],o[93]=t[3],o[94]=t[4],o[95]=t[5],o[96]=t[6],t}])},function(e){return o[97]=new t.Map,o[97].set("epoch_id",o[90]),o[97].set("backup_id",o[91]),o[97].set("epoch_anon_id_blob",o[92]),o[97].set("epoch_root_key_blob",o[93]),o[97].set("epoch_status",o[94]),o[97].set("epoch_head",o[95]),o[97].set("authority_level",o[96]),o[72]=o[97]}])}):t.resolve()},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[79]=t[0],t})},function(e){return o[79]?o[80]=!0:o[80]=!1,o[80]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[82]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[82]].join("")),o[81]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[82],o[81],t.i64.cast([0,3]))):t.resolve()}])},function(r){return o[75]=new t.Map,o[75].set("epoch_id",e[2]),o[75].set("authority_level",t.i64.cast([0,80])),o[75].set("backup_id",e[1]),o[75].set("epoch_anon_id_blob",o[21]),o[75].set("epoch_root_key_blob",o[25]),o[75].set("epoch_status",t.i64.cast([0,1])),o[75].set("epoch_head",o[46]),o[76]=o[75],o[77]=e[5].keys(),o[78]=t.i64.of_int32(o[77].length),t.i64.gt(o[78],t.i64.cast([0,0]))?t.loopAsync(o[78],function(r){return o[79]=r,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[77],o[79]).then(function(e){var t;return t=e,o[80]=t[0],o[81]=t[1],t})},function(r){return o[82]=o[76].get("epoch_id"),o[83]=o[76].get("backup_id"),o[84]=o[76].get("epoch_anon_id_blob"),o[85]=o[76].get("epoch_root_key_blob"),o[86]=o[76].get("epoch_status"),o[87]=o[76].get("authority_level"),o[88]=o[76].get("epoch_head"),o[89]=e[5].get(t.i64.to_string(o[82])),o[89]!==void 0?t.sequence([function(r){return o[98]=o[89].get("prev_epoch_id"),t.i64.neq(o[98],void 0)?t.sequence([function(r){return o[106]=e[5].get(t.i64.to_string(o[98])),o[106]!==void 0?t.sequence([function(e){return o[114]=o[106].get("backup_id"),o[115]=o[106].get("is_active_epoch"),o[115]?o[116]=t.i64.cast([0,1]):o[116]=t.i64.cast([0,2]),o[117]=o[89].get("epoch_data_v2"),o[117]!==void 0?t.sequence([function(e){return o[125]=t.createArray(),o[144]=(o[125].push(t.i64.cast([0,32])),o[125]),t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[126]=t[0],t})},function(e){return o[126]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_data_storage","_",o[126]].join("")),void 0,o[85],o[125]).then(function(e){var t;return t=e,o[144]=t[0],t})},function(e){return o[144]?o[145]=!1:o[145]=!0,o[145]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),o[148]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[148]].join("")),o[147]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[148],o[147],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[149]=t[0],t})},function(e){return o[146]=o[149]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[144],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[147]=t[0],o[148]=t[1],t})},function(e){return o[146]=o[147]}])},function(e){return o[127]=o[146]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),o[145]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[145]].join("")),o[144]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[145],o[144],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[146]=t[0],t})},function(e){return o[127]=o[146]}])},function(e){return o[128]=o[117].get("epoch_anon_id"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),o[127],t.blob("ZXBvY2hfZGF0YV9tZXRhZGF0YQ=="),o[128]).then(function(e){var t;return t=e,o[129]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[129]).then(function(e){var t;return t=e,o[130]=t[0],t})},function(e){return t.blobs.neq(o[130],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSIsValidEpochAnonId.nop"),o[130]).then(function(e){var t;return t=e,o[144]=t[0],t})},function(e){return o[131]=o[144]}]):t.resolve(o[131]=!1)},function(e){return o[131]?o[132]=o[130]:o[132]=void 0,o[133]=o[117].get("epoch_root_key"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),o[127],t.blob("ZXBvY2hfZGF0YV9tZXRhZGF0YQ=="),o[133]).then(function(e){var t;return t=e,o[134]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[134]).then(function(e){var t;return t=e,o[135]=t[0],t})},function(e){return t.blobs.neq(o[132],void 0)?t.sequence([function(e){return t.blobs.neq(o[135],void 0)?t.resolve((o[145]=new t.Map,o[145].set("epoch_anon_id",o[132]),o[145].set("epoch_root_key",o[135]),o[144]=o[145])):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Error while decrypting epoch_root_key. Returning null"),o[146]="Error while decrypting epoch_root_key. Returning null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ","",o[146]].join("")),o[145]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",o[146],o[145],t.i64.cast([0,3]))},function(e){return o[144]=void 0}])},function(e){return o[136]=o[144]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Error while decrypting epoch_anon_id. Returning null"),o[145]="Error while decrypting epoch_anon_id. Returning null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ","",o[145]].join("")),o[144]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",o[145],o[144],t.i64.cast([0,3]))},function(e){return o[136]=void 0}])},function(e){return o[136]!==void 0?t.sequence([function(e){return o[144]=o[136].get("epoch_anon_id"),o[145]=o[136].get("epoch_root_key"),o[146]=o[106].get("minos_epoch"),o[146]!==void 0?(o[148]=o[146].get("epoch_head"),o[147]=o[148]):o[147]=void 0,t.filter(t.db.table(169).fetch([[[o[98]]]]),function(e){return t.i64.eq(e.epochId,o[98])&&t.i64.gt(e.authorityLevel,t.i64.cast([0,80]))}).next().then(function(e){var n=e.done,r=e.value;return n?t.db.table(169).put({epochId:o[98],backupId:o[114],epochAnonIdBlob:o[144],epochRootKeyBlob:o[145],epochStatus:o[116],authorityLevel:t.i64.cast([0,80]),epochHead:o[147]}):0})},function(e){var n;return n=[o[98],o[114],o[144],o[145],o[116],o[147],t.i64.cast([0,80])],o[137]=n[0],o[138]=n[1],o[139]=n[2],o[140]=n[3],o[141]=n[4],o[142]=n[5],o[143]=n[6],n}]):t.sequence([function(e){return o[146]="Error while decrypting epoch data of epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[144]=t[0],t})},function(e){return o[147]=o[144]==null?"":o[144],o[145]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[145],o[146],o[145],o[147]].join("")),o[148]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[146],",",o[147]].join(""),o[148],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[137]=t[0],o[138]=t[1],o[139]=t[2],o[140]=t[3],o[141]=t[4],o[142]=t[5],o[143]=t[6],t}])},function(e){var t;return t=[o[137],o[138],o[139],o[140],o[141],o[142],o[143]],o[118]=t[0],o[119]=t[1],o[120]=t[2],o[121]=t[3],o[122]=t[4],o[123]=t[5],o[124]=t[6],t}]):t.sequence([function(e){return o[127]="Error while reading epoch_data_v2. This is expected if this is the root epoch. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[125]=t[0],t})},function(e){return o[128]=o[125]==null?"":o[125],o[126]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[126],o[127],o[126],o[128]].join("")),t.resolve()},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[118]=t[0],o[119]=t[1],o[120]=t[2],o[121]=t[3],o[122]=t[4],o[123]=t[5],o[124]=t[6],t}])},function(e){var t;return t=[o[118],o[119],o[120],o[121],o[122],o[123],o[124]],o[107]=t[0],o[108]=t[1],o[109]=t[2],o[110]=t[3],o[111]=t[4],o[112]=t[5],o[113]=t[6],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Unexpected error! New epoch is null even though we have a new_epoch_id value"),o[115]="Unexpected error! New epoch is null even though we have a new_epoch_id value",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ","",o[115]].join("")),o[114]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",o[115],o[114],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[107]=t[0],o[108]=t[1],o[109]=t[2],o[110]=t[3],o[111]=t[4],o[112]=t[5],o[113]=t[6],t}])},function(e){var t;return t=[o[107],o[108],o[109],o[110],o[111],o[112],o[113]],o[99]=t[0],o[100]=t[1],o[101]=t[2],o[102]=t[3],o[103]=t[4],o[104]=t[5],o[105]=t[6],t}]):t.sequence([function(e){return o[108]="New epoch is null. This is expected if epoch_id is the root or last epoch. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[106]=t[0],t})},function(e){return o[109]=o[106]==null?"":o[106],o[110]=" , is_forward = ",o[111]="0",o[107]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[107],o[108],o[107],o[109],o[107],o[110],o[107],o[111]].join("")),t.resolve()},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[99]=t[0],o[100]=t[1],o[101]=t[2],o[102]=t[3],o[103]=t[4],o[104]=t[5],o[105]=t[6],t}])},function(e){var t;return t=[o[99],o[100],o[101],o[102],o[103],o[104],o[105]],o[90]=t[0],o[91]=t[1],o[92]=t[2],o[93]=t[3],o[94]=t[4],o[95]=t[5],o[96]=t[6],t}]):t.sequence([function(e){return o[100]="Unexpected error! server epoch is null even though we have epoch_id. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[98]=t[0],t})},function(e){return o[101]=o[98]==null?"":o[98],o[99]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[99],o[100],o[99],o[101]].join("")),o[102]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[100],",",o[101]].join(""),o[102],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[90]=t[0],o[91]=t[1],o[92]=t[2],o[93]=t[3],o[94]=t[4],o[95]=t[5],o[96]=t[6],t}])},function(e){return o[97]=new t.Map,o[97].set("epoch_id",o[90]),o[97].set("backup_id",o[91]),o[97].set("epoch_anon_id_blob",o[92]),o[97].set("epoch_root_key_blob",o[93]),o[97].set("epoch_status",o[94]),o[97].set("epoch_head",o[95]),o[97].set("authority_level",o[96]),o[76]=o[97]}])}):t.resolve()},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[79]=t[0],t})},function(e){return o[79]?o[80]=!0:o[80]=!1,o[80]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[82]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[82]].join("")),o[81]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[82],o[81],t.i64.cast([0,3]))):t.resolve()}])}]):((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Unexpected Error. A base epoch exists on client but not found on server"),o[67]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils","Unexpected Error. A base epoch exists on client but not found on server",o[67],t.i64.cast([0,3])))}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: epoch storage private key is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch storage private key is null"),o[63]="epoch storage private key is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[63]].join("")),o[62]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[63],o[62],t.i64.cast([0,3]))}])},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_epoch_derivation_end"):t.resolve()}])},function(r){return t.db.table(169).fetch([[[e[4]]]]).next().then(function(r,a){var i=r.done,l=r.value;return i?t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: No epochs keys found."):t.resolve()},function(e){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] No epochs keys found."),o[59]=void 0}]):(a=l.item,o[61]=new t.Map,o[61].set("epoch_root_key",a.epochRootKeyBlob),o[61].set("epoch_anon_id",a.epochAnonIdBlob),o[61].set("epoch_id",e[4]),o[61].set("epoch_head",a.epochHead),o[59]=o[61])})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_epoch_data_end"):t.resolve()},function(r){return o[59]!==void 0?t.sequence([function(e){return o[61]=o[59].get("epoch_anon_id"),o[62]=o[59].get("epoch_root_key"),o[63]=t.createArray(),o[69]=(o[63].push(t.i64.cast([0,32])),o[63]),t.nativeOperation(n("LSBase64Encode.nop"),o[61]).then(function(e){var t;return t=e,o[64]=t[0],t})},function(e){return o[64]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",o[64]].join("")),void 0,o[62],o[63]).then(function(e){var t;return t=e,o[69]=t[0],t})},function(e){return o[69]?o[70]=!1:o[70]=!0,o[70]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),o[73]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[73]].join("")),o[72]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[73],o[72],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[74]=t[0],t})},function(e){return o[71]=o[74]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[69],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[72]=t[0],o[73]=t[1],t})},function(e){return o[71]=o[72]}])},function(e){return o[65]=o[71]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),o[70]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[70]].join("")),o[69]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[70],o[69],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[71]=t[0],t})},function(e){return o[65]=o[71]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),o[65],o[33]).then(function(e){var t;return t=e,o[66]=t[0],t})},function(e){return o[67]=o[59].get("epoch_root_key"),t.blobs.neq(o[67],void 0)?t.sequence([function(e){return o[69]=t.createArray(),o[75]=(o[69].push(t.i64.cast([0,18])),o[69]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,o[67],o[69]).then(function(e){var t;return t=e,o[70]=t[0],t})},function(e){return o[70]!==void 0?t.sequence([function(e){return o[75]=t.i64.of_int32(o[70].length),t.i64.ge(o[75],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[70],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[77]=t[0],o[78]=t[1],t})},function(e){return o[76]=o[77]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),o[78]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[78]].join("")),o[77]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[78],o[77],t.i64.cast([0,3]))},function(e){return o[76]=void 0}])},function(e){return o[71]=o[76]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),o[76]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[76]].join("")),o[75]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[76],o[75],t.i64.cast([0,3]))},function(e){return o[71]=void 0}])},function(e){return t.blobs.neq(o[71],void 0)?o[72]=!0:o[72]=!1,o[72]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),o[71]).then(function(e){var t;return t=e,o[73]=t[0],t})},function(e){return o[73]!==void 0?o[74]=o[73]:o[74]="encodingfailed",o[68]=o[74]}]):t.resolve(o[68]="null")},function(r){return t.blobs.neq(o[66],void 0)?t.sequence([function(e){return o[69]=o[59].get("epoch_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[33]).then(function(e){var t;return t=e,o[70]=t[0],t})},function(e){return o[88]=o[70]==null?"":o[70],t.nativeOperation(n("LSBase64Encode.nop"),o[66]).then(function(e){var t;return t=e,o[71]=t[0],t})},function(e){return o[87]=o[71]==null?"":o[71],t.nativeOperation(n("LSBase64Encode.nop"),o[35]).then(function(e){var t;return t=e,o[72]=t[0],t})},function(e){return o[89]=o[72]==null?"":o[72],t.nativeOperation(n("LSBase64Encode.nop"),o[36]==null?t.blob("bnVsbA=="):o[36]).then(function(e){var t;return t=e,o[73]=t[0],t})},function(e){return o[90]=o[73]==null?"":o[73],t.nativeOperation(n("LSBase64Encode.nop"),o[38]).then(function(e){var t;return t=e,o[74]=t[0],t})},function(e){return o[91]=o[74]==null?"":o[74],t.nativeOperation(n("LSBase64Encode.nop"),o[39]==null?t.blob("bnVsbA=="):o[39]).then(function(e){var t;return t=e,o[75]=t[0],t})},function(e){return o[92]=o[75]==null?"":o[75],t.nativeOperation(n("LSBase64Encode.nop"),o[43]).then(function(e){var t;return t=e,o[76]=t[0],t})},function(r){return o[93]=o[76]==null?"":o[76],t.nativeOperation(n("LSBase64Encode.nop"),e[10]).then(function(e){var t;return t=e,o[77]=t[0],t})},function(e){return o[94]=o[77]==null?"":o[77],t.blobs.neq(o[29],void 0)?t.sequence([function(e){return o[95]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[29],"private_key",o[32],t.i64.cast([0,1]),o[95]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return t.blobs.neq(o[96],void 0)?o[97]=o[96]:o[97]=void 0,o[78]=o[97]}]):t.resolve(o[78]=void 0)},function(e){return t.blobs.neq(o[78],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[78]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[79]=o[95]}]):t.resolve(o[79]=void 0)},function(e){return t.blobs.neq(o[29],void 0)?t.sequence([function(e){return o[95]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[29],"ocmf_client_state",o[42],t.i64.cast([0,1]),o[95]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return t.blobs.neq(o[96],void 0)?o[97]=o[96]:o[97]=void 0,o[80]=o[97]}]):t.resolve(o[80]=void 0)},function(e){return t.blobs.neq(o[80],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[80]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[81]=o[95]}]):t.resolve(o[81]=void 0)},function(e){return t.blobs.neq(o[29],void 0)?t.sequence([function(e){return o[95]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[29],"epoch_storage_private_key",o[34],t.i64.cast([0,1]),o[95]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return t.blobs.neq(o[96],void 0)?o[97]=o[96]:o[97]=void 0,o[82]=o[97]}]):t.resolve(o[82]=void 0)},function(e){return t.blobs.neq(o[82],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[82]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[83]=o[95]}]):t.resolve(o[83]=void 0)},function(r){return o[84]=new t.Map,o[84].set("supported_encryption_versions",o[47]),o[84].set("client_version",t.i64.cast([0,1])),o[84].set("version_sig",o[56]==null?"":o[56]),e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_issue_add_device_task_start"):t.resolve()},function(r){return t.i64.eq(e[7],t.i64.cast([0,2]))?t.resolve(o[85]=void 0):t.sequence([function(e){return t.nativeOperation(n("LSGetArmadilloPublicKey.nop")).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[85]=o[95]}])},function(e){return t.blobs.neq(o[85],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSCreateSignatureWithArmadilloKey.nop"),o[33]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return t.blobs.neq(o[95],void 0)?t.resolve(o[96]=o[95]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create labyrinth signature"),o[101]="Failed to create labyrinth signature",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoKeySigningUtils] ","",o[101]].join("")),o[100]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils",o[101],o[100],t.i64.cast([0,3]))},function(e){return o[96]=void 0}])},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[32],t.blob("Mw=="),o[85]).then(function(e){var t;return t=e,o[97]=t[0],t})},function(e){return t.blobs.neq(o[97],void 0)?t.resolve(o[98]=o[97]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create armadillo signature"),o[101]="Failed to create armadillo signature",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoKeySigningUtils] ","",o[101]].join("")),o[100]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils",o[101],o[100],t.i64.cast([0,3]))},function(e){return o[98]=void 0}])},function(e){return t.blobs.neq(o[98],void 0)?(t.blobs.neq(o[96],void 0)?(o[101]=new t.Map,o[101].set("armadillo_public_key",o[85]),o[101].set("armadillo_key_signature",o[98]),o[101].set("labyrinth_key_signature",o[96]),o[100]=o[101]):o[100]=void 0,o[99]=o[100]):o[99]=void 0,o[86]=o[99]}]):t.resolve(o[86]=void 0)},function(r){return o[86]!==void 0?t.sequence([function(e){return o[95]=o[86].get("armadillo_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[95]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return o[97]=o[86].get("armadillo_key_signature"),t.nativeOperation(n("LSBase64Encode.nop"),o[97]).then(function(e){var t;return t=e,o[98]=t[0],t})},function(e){return o[99]=o[86].get("labyrinth_key_signature"),t.nativeOperation(n("LSBase64Encode.nop"),o[99]).then(function(e){var t;return t=e,o[100]=t[0],t})},function(r){return o[105]=t.i64.cast([0,1e3]),o[101]=o[105],o[102]=new t.Map,o[102].set("backup_id",e[1]),o[102].set("device_epoch_hmac",o[87]),o[102].set("epoch_root_key_fingerprint",o[68]),o[102].set("device_public_key",o[88]),o[102].set("epoch_storage_pubkey",o[89]),o[102].set("epoch_storage_pubkey_sig",o[90]),o[102].set("epoch_auth_pubkey",o[91]),o[102].set("epoch_auth_pubkey_sig",o[92]),o[102].set("ocmf_rotation_token",o[93]),o[102].set("virtual_device_id",o[94]),o[102].set("device_registration_id",e[11]),o[102].set("base_epoch_id",o[69]),o[102].set("encryption_version_data",o[84]),o[102].set("private_key_debug_token",o[79]),o[102].set("ocmf_client_state_debug_token",o[81]),o[102].set("epoch_storage_pvtkey_debug_token",o[83]),o[102].set("trace_id",e[8]),o[102].set("occam_only_eligible",!0),o[102].set("armadillo_public_key",o[96]==null?"":o[96]),o[102].set("armadillo_key_signature",o[98]==null?"":o[98]),o[102].set("labyrinth_key_signature",o[100]==null?"":o[100]),o[103]=t.toJSON(o[102]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50006]),o[103],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,o[101]).then(function(e){var t;return t=e,o[104]=t[0],t})}]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] failed to get armadillo key and device signatures"),o[99]=t.i64.cast([0,1e3]),o[95]=o[99],o[96]=new t.Map,o[96].set("backup_id",e[1]),o[96].set("device_epoch_hmac",o[87]),o[96].set("epoch_root_key_fingerprint",o[68]),o[96].set("device_public_key",o[88]),o[96].set("epoch_storage_pubkey",o[89]),o[96].set("epoch_storage_pubkey_sig",o[90]),o[96].set("epoch_auth_pubkey",o[91]),o[96].set("epoch_auth_pubkey_sig",o[92]),o[96].set("ocmf_rotation_token",o[93]),o[96].set("virtual_device_id",o[94]),o[96].set("device_registration_id",e[11]),o[96].set("base_epoch_id",o[69]),o[96].set("encryption_version_data",o[84]),o[96].set("private_key_debug_token",o[79]),o[96].set("ocmf_client_state_debug_token",o[81]),o[96].set("epoch_storage_pvtkey_debug_token",o[83]),o[96].set("trace_id",e[8]),o[96].set("occam_only_eligible",!0),o[97]=t.toJSON(o[96]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50006]),o[97],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,o[95]).then(function(e){var t;return t=e,o[98]=t[0],t}))},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_issue_add_device_task_end"):t.resolve()}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: $device_epoch_hmac found to be null"):t.resolve()},function(e){return t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,4])})},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $device_epoch_hmac found to be null"),o[70]="$device_epoch_hmac found to be null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[70]].join("")),o[69]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[70],o[69],t.i64.cast([0,3]))}])}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: $latest_epoch_data is null."):t.resolve()},function(e){return t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,4])})},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $latest_epoch_data is null."),o[62]="$latest_epoch_data is null.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[62]].join("")),o[61]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[62],o[61],t.i64.cast([0,3]))}])}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: $mailbox root key is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $mailbox root key is null"),o[47]="$mailbox root key is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[47]].join("")),o[46]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[47],o[46],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $mailbox root key is null",!1)}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: oblivious validation token is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] oblivious validation token is null"),o[47]="oblivious validation token is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[47]].join("")),o[46]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[47],o[46],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] oblivious validation token is null",!1)}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: epoch root key is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch root key is null"),o[47]="epoch root key is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[47]].join("")),o[46]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[47],o[46],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch root key is null",!1)}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: epoch anon id is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch anon id is null"),o[47]="epoch anon id is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[47]].join("")),o[46]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[47],o[46],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch anon id is null",!1)}])}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: orf client state v1 is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] orf client state v1 is null"),o[41]="orf client state v1 is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[41]].join("")),o[40]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[41],o[40],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] orf client state v1 is null",!1)}])},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_sproc_end"):t.resolve()}]):(i=s.item,t.sequence([function(e){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] An authoritative row already exists, aborting execution of addDeviceFromVirtualDevice"),t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,2])})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_device_already_added"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_sproc_end"):t.resolve()}]))})},function(e){return o[2]=t.i64.of_float(Date.now()),o[3]=t.i64.random(),o[5]="Finishing execution. Execution time: ",o[6]=t.i64.to_string(t.i64.sub(o[2],o[0])),o[7]=" ms",o[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ",o[4],o[5],o[4],o[6],o[4],o[7]].join("")),t.i64.eq(t.i64.mod_(o[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[8]=",",o[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",[o[5],o[8],o[6],o[8],o[7]].join(""),o[9],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_recovery_code_status","secure_encrypted_backups_epochs"];var s=e;l.default=s}),98);
__d("LSAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",["LSAddDeviceWithVirtualDeviceAndDecryptionKey","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSAddDeviceWithVirtualDeviceAndDecryptionKey"),a.taskId,a.backupId,a.epochId,a.encryptedSecretValues,a.lastEpochId,a.syncEpochs,a.epochStoragePublicKey,a.backupTenancy,a.traceId,a.blobDecryptionKey,a.virtualDeviceId,a.deviceRegistrationId,a.minosEpoch);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("GaloisField32",["EBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=o("EBLogger").EBLogger(),s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,5,7,1,3,13,15,9,11,21,23,17,19,29,31,25,27,0,3,6,5,12,15,10,9,24,27,30,29,20,23,18,17,21,22,19,16,25,26,31,28,13,14,11,8,1,2,7,4,0,4,8,12,16,20,24,28,5,1,13,9,21,17,29,25,10,14,2,6,26,30,18,22,15,11,7,3,31,27,23,19,0,5,10,15,20,17,30,27,13,8,7,2,25,28,19,22,26,31,16,21,14,11,4,1,23,18,29,24,3,6,9,12,0,6,12,10,24,30,20,18,21,19,25,31,13,11,1,7,15,9,3,5,23,17,27,29,26,28,22,16,2,4,14,8,0,7,14,9,28,27,18,21,29,26,19,20,1,6,15,8,31,24,17,22,3,4,13,10,2,5,12,11,30,25,16,23,0,8,16,24,5,13,21,29,10,2,26,18,15,7,31,23,20,28,4,12,17,25,1,9,30,22,14,6,27,19,11,3,0,9,18,27,1,8,19,26,2,11,16,25,3,10,17,24,4,13,22,31,5,12,23,30,6,15,20,29,7,14,21,28,0,10,20,30,13,7,25,19,26,16,14,4,23,29,3,9,17,27,5,15,28,22,8,2,11,1,31,21,6,12,18,24,0,11,22,29,9,2,31,20,18,25,4,15,27,16,13,6,1,10,23,28,8,3,30,21,19,24,5,14,26,17,12,7,0,12,24,20,21,25,13,1,15,3,23,27,26,22,2,14,30,18,6,10,11,7,19,31,17,29,9,5,4,8,28,16,0,13,26,23,17,28,11,6,7,10,29,16,22,27,12,1,14,3,20,25,31,18,5,8,9,4,19,30,24,21,2,15,0,14,28,18,29,19,1,15,31,17,3,13,2,12,30,16,27,21,7,9,6,8,26,20,4,10,24,22,25,23,5,11,0,15,30,17,25,22,7,8,23,24,9,6,14,1,16,31,11,4,21,26,18,29,12,3,28,19,2,13,5,10,27,20,0,16,5,21,10,26,15,31,20,4,17,1,30,14,27,11,13,29,8,24,7,23,2,18,25,9,28,12,19,3,22,6,0,17,7,22,14,31,9,24,28,13,27,10,18,3,21,4,29,12,26,11,19,2,20,5,1,16,6,23,15,30,8,25,0,18,1,19,2,16,3,17,4,22,5,23,6,20,7,21,8,26,9,27,10,24,11,25,12,30,13,31,14,28,15,29,0,19,3,16,6,21,5,22,12,31,15,28,10,25,9,26,24,11,27,8,30,13,29,14,20,7,23,4,18,1,17,2,0,20,13,25,26,14,23,3,17,5,28,8,11,31,6,18,7,19,10,30,29,9,16,4,22,2,27,15,12,24,1,21,0,21,15,26,30,11,17,4,25,12,22,3,7,18,8,29,23,2,24,13,9,28,6,19,14,27,1,20,16,5,31,10,0,22,9,31,18,4,27,13,1,23,8,30,19,5,26,12,2,20,11,29,16,6,25,15,3,21,10,28,17,7,24,14,0,23,11,28,22,1,29,10,9,30,2,21,31,8,20,3,18,5,25,14,4,19,15,24,27,12,16,7,13,26,6,17,0,24,21,13,15,23,26,2,30,6,11,19,17,9,4,28,25,1,12,20,22,14,3,27,7,31,18,10,8,16,29,5,0,25,23,14,11,18,28,5,22,15,1,24,29,4,10,19,9,16,30,7,2,27,21,12,31,6,8,17,20,13,3,26,0,26,17,11,7,29,22,12,14,20,31,5,9,19,24,2,28,6,13,23,27,1,10,16,18,8,3,25,21,15,4,30,0,27,19,8,3,24,16,11,6,29,21,14,5,30,22,13,12,23,31,4,15,20,28,7,10,17,25,2,9,18,26,1,0,28,29,1,31,3,2,30,27,7,6,26,4,24,25,5,19,15,14,18,12,16,17,13,8,20,21,9,23,11,10,22,0,29,31,2,27,6,4,25,19,14,12,17,8,21,23,10,3,30,28,1,24,5,7,26,16,13,15,18,11,22,20,9,0,30,25,7,23,9,14,16,11,21,18,12,28,2,5,27,22,8,15,17,1,31,24,6,29,3,4,26,10,20,19,13,0,31,27,4,19,12,8,23,3,28,24,7,16,15,11,20,6,25,29,2,21,10,14,17,5,26,30,1,22,9,13,18],u=[0,1,18,28,9,23,14,12,22,4,25,16,7,15,6,13,11,24,2,29,30,26,8,5,17,10,21,31,3,19,20,27],c="ACDEFHJKLMNPQRSTUVWXYZ0123456789",d=(function(){for(var e={},t=0;t<c.length;t++){var n=f(t);n!=null&&(e[c[t]]=n)}return e})();function m(e,t){return s[e*32+t]}function p(t){for(var n=[],r=0;r<t.length;r++){if(!(t[r]in d))return e.mustfix("gf32: tried to convert invalid string to GF32 matrix: %s",t),null;n[r]=d[t[r]]}return n}function _(e){var t=[];for(var n of e)t.push(c[n]);return t.join("")}function f(e){return e===0||e===1||e===2||e===3||e===4||e===5||e===6||e===7||e===8||e===9||e===10||e===11||e===12||e===13||e===14||e===15||e===16||e===17||e===18||e===19||e===20||e===21||e===22||e===23||e===24||e===25||e===26||e===27||e===28||e===29||e===30||e===31?e:null}function g(t){for(var n=[],r=0;r<t.length;r++){var o=f(t[r]);if(o==null)throw e.mustfixThrow("gf32: tried to convert bad value to GF32 element: %s",t[r]);n.push(o)}return n}function h(t,n){var r=t^n,o=f(r);if(o==null)throw e.mustfixThrow("gf32: xor of gf32 elements returned a non-element (should be impossible): %s ^ %s = %s",t,n,r);return o}function y(e,t,n,r,o){for(var a=0;a<t;a++)e[n*t+a]=h(e[n*t+a],m(e[r*t+a],o))}function C(e,t,n,r){for(var o=0;o<t;o++){var a=e[n*t+o];e[n*t+o]=e[r*t+o],e[r*t+o]=a}}function b(e,t,n,r){for(var o=0;o<t;o++)e[n*t+o]=m(e[n*t+o],r)}function v(t,n){if(n===0)throw e.mustfixThrow("gf32: tried to divide by 0");return m(t,u[n])}function S(e){for(var t=Array(e*e).fill(0),n=0;n<e;n++)t[n*e+n]=1;return t}function R(e,t){for(var n=e.slice(),r=S(t),o=0;o<t;o++){var a=o;if(n[o*t+a]===0){for(var i=!1,l=o+1;l<t;l++)if(n[l*t+a]!==0){C(n,t,o,l),C(r,t,o,l),i=!0;break}if(!i)return null}for(var s=o+1;s<t;s++){var c=v(n[s*t+a],n[o*t+a]);y(n,t,s,o,c),y(r,t,s,o,c)}}for(var d=t-1;d>=0;d--)for(var m=d,p=d-1;p>=0;p--){var _=v(n[p*t+m],n[d*t+m]);y(n,t,p,d,_),y(r,t,p,d,_)}for(var f=0;f<t;f++){var g=n[f*t+f];if(g===0)return null;b(r,t,f,u[g])}return r}var L=0;l.zero=L,l.matrixToSymbols=_,l.symbolsToMatrix=p,l.invert=R,l.xor=h,l.multiply=m,l.asGf32MatExn=g}),98);
__d("GF32RecoveryCodes",["EBLogger","GaloisField32"],(function(t,n,r,o,a,i,l){"use strict";var e=o("EBLogger").EBLogger(),s=34,u=4,c=3,d=s+u,m=o("GaloisField32").asGf32MatExn([18,24,16,12,8,20,2,19,4,22,21,5,28,5,14,21,7,16,15,10,3,9,28,22,11,30,19,6,7,7,9,18,16,2,9,12,18,14,7,6,5,16,9,24,16,28,19,2,14,8,2,4,1,21,26,21,10,27,16,25,18,14,20,17,11,22,21,22,16,20,2,5,0,9,6,7,23,23,23,11,6,5,3,31,29,30,17,28,0,30,28,7,13,5,11,22,12,16,25,3,20,22,26,22,14,29,5,14,5,19,12,19,18,8,25,7,30,7,8,12,0,26,15,10,17,21,2,29,14,4,31,7,29,6,29,1,14,16,17,15,4,16,7,4,7,4,8,26,10,23,24,26]);function p(e,t,n){n===void 0&&(n=1);for(var r=[],o=e;o<t;o+=n)r.push(o);return r}var _={};function f(e,t){function n(e,t,r,o){if(t<=0)return[[]];if(o-r<=t)return[p(r,o)];var a=e|t<<8|r<<16|o<<24,i=_[a];if(i!=null)return i;var l=[];return n(e-1,t-1,r+1,o).forEach(function(e){var t=e.slice();t.splice(0,0,r),l.push(t)}),n(e-1,t,r+1,o).forEach(function(e){l.push(e.slice())}),_[a]=l,l}return n(e,t,0,e)}function g(e,t){for(var n=e.length,r=Array(n*n).fill(0),o=0,a=0;a<u;a++)if(a!==t){for(var i=0;i<n;i++){var l=e[i];r[o*n+i]=m[a*d+l]}o++}return r}function h(e,t){for(var n=0;n<u;n++){var r=g(e,n),a=o("GaloisField32").invert(r,t);if(a!=null)return{excludeRow:n,submatInv:a}}return null}function y(t){for(var n=Array(u).fill(0),r=0;r<u;r++)for(var a=0;a<s;a++)n[r]=o("GaloisField32").xor(n[r],o("GaloisField32").multiply(m[r*d+a],t[a]));for(var i=Array(u*u),l=0;l<u;l++)for(var c=0;c<u;c++)i[l*u+c]=m[l*d+s+c];var p=o("GaloisField32").invert(i,u);if(p==null)throw e.mustfixThrow("gf32: failed to invert error code submatrix (should be impossible): %s",JSON.stringify(i));for(var _=Array(u).fill(0),f=0;f<u;f++)for(var g=0;g<u;g++)_[f]=o("GaloisField32").xor(_[f],o("GaloisField32").multiply(p[f*u+g],n[g]));return _}function C(t){var n=new Set,r=o("GaloisField32").symbolsToMatrix(t);if(r==null)return e.warn("gf32: recovery code %s could not be converted to GF32 matrix",t),[t];for(var a=Array(u).fill(0),i=0;i<u;i++)for(var l=0;l<d;l++)a[i]=o("GaloisField32").xor(a[i],o("GaloisField32").multiply(m[i*d+l],r[l]));var s=f(d,c);for(var p of s){for(var _=a.slice(),g=0;g<u;g++)for(var y of p)_[g]=o("GaloisField32").xor(_[g],o("GaloisField32").multiply(m[g*d+y],r[y]));var C=h(p,c);if(C==null){e.warn("gf32: no submat inverse found for error locs %s",JSON.stringify(p));continue}var b=C.excludeRow,v=C.submatInv,S=Array(c).fill(0),R=_.slice();R.splice(b,1);for(var L=0;L<c;L++)for(var E=0;E<c;E++)S[L]=o("GaloisField32").xor(S[L],o("GaloisField32").multiply(v[L*c+E],R[E]));for(var k=o("GaloisField32").zero,I=0;I<c;I++)k=o("GaloisField32").xor(k,o("GaloisField32").multiply(m[b*d+p[I]],S[I]));if(k===_[b]){for(var T=r.slice(),D=0;D<p.length;D++)T[p[D]]=S[D];n.add(o("GaloisField32").matrixToSymbols(T))}}return Array.from(n)}l.getEccForCode=y,l.getCandidateCodes=C}),98);
__d("checkLSRecoveryCodeMatch",["LSBinaryToHex.nop","LSShape","LSVec","Promise","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,a,i,l,s){var u=r("LSVec").toArray(s).map(function(e){return o("LSShape").toRecord(e)}),c=r("LSBinaryToHex.nop")(t,a,r("nullthrows")(i)),d=function(s,u){return s.then(function(o){if(o[0]!=null)return(e||(e=n("Promise"))).resolve(o);var s=r("LSBinaryToHex.nop")(t,a,u.virtual_device_id);return(e||(e=n("Promise"))).all([c,s]).then(function(t){var r=t[0],o=t[1],a=r.length===o.length&&r.every(function(e,t){return e===o[t]});return a?(e||(e=n("Promise"))).resolve([i,l]):(e||(e=n("Promise"))).resolve([void 0,void 0])})})};return u.reduce(d,(e||(e=n("Promise"))).resolve([void 0,void 0]))}l.default=s}),98);
__d("deriveLSKey",["I64","LSCreateDerivedKeys.nop","LSCryptoUtils","LSVec"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,a,i,l){var s=l==="1"?(e||(e=o("I64"))).of_string("8"):(e||(e=o("I64"))).of_string("16"),u=r("LSVec").ofArray([s,(e||(e=o("I64"))).of_string("32")]);return r("LSCreateDerivedKeys.nop")(t,n,o("LSCryptoUtils").strToBuf(i),void 0,o("LSCryptoUtils").strToBuf(a),u).then(function(e){var t=e[0];if(t==null)return[void 0,void 0];var n=r("LSVec").toArray(t);return n.length===2?[n[0],n[1]]:[void 0,void 0]})}l.default=s}),98);
__d("parseLSRecoveryCode",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){var n=e.substring(0,1);if(!(e.length!==40||n!=="1"&&n!=="2")){var r=n==="1"?35:34,o=e.substring(1,2),a=e.substring(2,r+2),i="BackupRecoveryCode_v"+n+"_"+o+"_"+t;return[a,i,n]}}i.default=e}),66);
__d("LSParseRecoveryCode_v2.nop",["CryptoLogger","GF32RecoveryCodes","Promise","checkLSRecoveryCodeMatch","deriveLSKey","parseLSRecoveryCode"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,a,i,l,s){var u=o("CryptoLogger").CryptoLogger("parse_recovery_code_v2"),c=r("parseLSRecoveryCode")(i,l);return c!=null?r("deriveLSKey")(t,a,c[0],c[1],c[2]):(s&&u.mustfix("could not parse recovery code with uid"),(e||(e=n("Promise"))).resolve([void 0,void 0]))}var u=new Map([["B","8"],["G","C"],["I","1"],["O","0"]]),c=new RegExp("["+Array.from(u.keys()).join("")+"]","g");function d(e){return e.replace(c,function(e){return u.get(e)||e})}var m=function(a,i,l,u,c){if(l.length!==40)return(e||(e=n("Promise"))).resolve([void 0,void 0]);var t=l.substring(0,2),m=d(l.substring(2,40)),p=o("GF32RecoveryCodes").getCandidateCodes(m),_=function(l,d){return l.then(function(o){return o[0]!=null?(e||(e=n("Promise"))).resolve(o):s(a,i,t+d,u,!1).then(function(t){var o=t[0];return o==null?(e||(e=n("Promise"))).resolve([void 0,void 0]):r("checkLSRecoveryCodeMatch")(a,i,o,t[1],c)}).then(function(e){return e[0]==null?[void 0,void 0]:e})})};return p.reduce(_,(e||(e=n("Promise"))).resolve([void 0,void 0])).then(function(r){return r[0]==null?s(a,i,t+m,u,!0):(e||(e=n("Promise"))).resolve(r)})};m.__nop_name__="LSParseRecoveryCode_v2",l.default=m}),98);
__d("MWEncryptedBackupsDeviceRegistrationId",["FBLogger","MessengerWebInitData"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e=r("MessengerWebInitData").sessionId;return e==null?(r("FBLogger")("wmi_eb").mustfix("PAKE: Failed to get registration id from MessengerWebInitData"),""):e}l.getDeviceRegistrationId=e}),98);
__d("EBAddDeviceGraphQL",["CometRelay","EBAPIQPLPoints","EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery.graphql","EBGetLSVirtualDevices","EBMinosCheckWasmFeatureSupport","FBLogger","I64","LSAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure","LSDict","LSEncryptedBackupsBackupTenancy","LSFactory","LSParseRecoveryCode_v2.nop","LSShape","LSVec","MWEncryptedBackupsDeviceRegistrationId","ReQL","WAArrayBufferUtils","WABase64","WAResultOrError","WorkerRelay","WorkerRelayNetwork","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=e!==void 0?e:e=n("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery.graphql");function c(e){var t=e.backupId,n=e.qplFlow,r=e.recoveryCode,a=e.storage,i=e.userId;return o("WorkerRelayNetwork").getWorkerNetworkExecute().then(function(){return m({backupId:t,fetchQueryGraphQLFn:function(t,n){return o("WorkerRelay").createWorkerQuery(t,n)},qplFlow:n,recoveryCode:r,storage:a,userId:i})}).catch(function(){return o("WAResultOrError").makeError("worker-environment-error")})}function d(e){var t=e.backupId,n=e.environment,r=e.qplFlow,a=e.recoveryCode,i=e.storage,l=e.userId;return m({backupId:t,fetchQueryGraphQLFn:function(t,r){return o("CometRelay").fetchQuery(n,t,r,{fetchPolicy:"network-only"}).toPromise()},qplFlow:r,recoveryCode:a,storage:i,userId:l})}async function m(e){var t=e.backupId,n=e.fetchQueryGraphQLFn,a=e.qplFlow,l=e.recoveryCode,c=e.storage,d=e.userId,m=await o("EBMinosCheckWasmFeatureSupport").checkWasmFeatureSupportAndGK();try{return g(c).then(function(e){var t=e!=null?e:d;return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_PARSE_RECOVERY_CODE_START),Promise.all([c.runInTransaction(function(e){return r("LSParseRecoveryCode_v2.nop")(e,0,l,t,r("LSVec").ofArray([]))},"readwrite","ui",void 0,i.id+":209"),Promise.resolve(t)])}).then(function(e){a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_PARSE_RECOVERY_CODE_END);var l=e[0][0],d=e[0][1],g=e[1];if(l==null||d==null)return o("WAResultOrError").makeError("missing-mandatory-field");var h=o("WABase64").encodeB64(l);return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_START),n(u,{request_uuid:g,virtual_device_id:h}).then(function(e){var n,u,g,h;if((e==null||(n=e.fetch_virtual_device_info_for_device_addition_v2)==null?void 0:n.ok)===!1){var y,C,b;return a.addAnnotations({string:{fetch_vd_info_error_code:(y=e==null||(C=e.fetch_virtual_device_info_for_device_addition_v2)==null||(C=C.error)==null?void 0:C.code)!=null?y:""}}),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_END),(e==null||(b=e.fetch_virtual_device_info_for_device_addition_v2)==null||(b=b.error)==null?void 0:b.code)==="NO_VIRTUAL_DEVICE_FOUND"?o("EBGetLSVirtualDevices").getLSVirtualDevices(c).then(function(e){return e.length>0&&a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_EXISTS),o("WAResultOrError").makeError("graphql-fetch-vd-error")}):o("WAResultOrError").makeError("graphql-fetch-vd-error")}a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_END);var v=e==null||(u=e.fetch_virtual_device_info_for_device_addition_v2)==null?void 0:u.data,S=o("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId(),R=(v==null?void 0:v.encrypted_secret_values)!=null?f(v==null?void 0:v.encrypted_secret_values):null,L=v==null?void 0:v.epoch_storage_public_key,E=v==null?void 0:v.epoch_id,k=v==null?void 0:v.last_epoch_id;if(v==null||S===""||R==null||E==null||L==null||k==null){var I=[];return v==null&&I.push("payload"),S===""&&I.push("deviceRegistrationId"),R==null&&I.push("validated_encrypted_secret_values"),E==null&&I.push("epoch_id"),L==null&&I.push("epoch_storage_public_key"),k==null&&I.push("last_epoch_id"),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_MISSING_GRAPHQL_FIELDS,{string_array:{missing_mandatory_field:I}}),o("WAResultOrError").makeError("missing-mandatory-field")}var T=new(r("LSDict"));v.sync_epochs.forEach(function(e){var t=p(e);t!=null&&e.epoch_id!=null&&T.set(e.epoch_id,o("LSShape").ofRecord(t))});var D=_({epoch_head:(g=v.minos_epoch)==null?void 0:g.epoch_head,self_epoch_signature:(h=v.minos_epoch)==null?void 0:h.self_epoch_signature});a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_START);var x={backupId:t,backupTenancy:(s||(s=o("I64"))).of_int32(r("LSEncryptedBackupsBackupTenancy").PRODUCTION),blobDecryptionKey:d,deviceRegistrationId:S,encryptedSecretValues:o("LSShape").ofRecord(R),epochId:s.of_string(E),epochStoragePublicKey:o("WABase64").decodeB64(L),lastEpochId:s.of_string(k),syncEpochs:T,taskId:s.of_int32(0),traceId:a.getQPLAttrs().instanceKey.toString(),virtualDeviceId:l};return(m||r("gkx")("17219"))&&(x=babelHelpers.extends({},x,{minosEpoch:D})),c.runInTransaction(function(e){return r("LSAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure")(r("LSFactory")(e),x)},"readwrite",void 0,void 0,i.id+":382").then(function(){return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_END),o("WAResultOrError").makeResult()}).catch(function(e){var t=r("getErrorSafe")(e);return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_FAIL,{string:{error_message:t.message}}),o("WAResultOrError").makeError("vd-and-decryption-key-sproc-error")})}).catch(function(e){var t=r("getErrorSafe")(e);return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_FAIL,{string:{error_message:t.message}}),o("WAResultOrError").makeError("graphql-fetch-vd-error")})}).catch(function(e){var t=r("getErrorSafe")(e);return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_PARSE_RECOVERY_CODE_FAIL,{string:{error_message:t.message}}),o("WAResultOrError").makeError("parse-recovery-code-error")})}catch(e){var h=r("getErrorSafe")(e);return r("FBLogger")("wmi_eb").catching(h).mustfix("Runtime error performing EBAddDeviceGraphQL: %s",h.message),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_RUNTIME_ERROR,{string:{error_message:h.message}}),Promise.resolve(o("WAResultOrError").makeError("runtime-error"))}}function p(e){var t=e.backup_id,n=e.encrypted_epoch_key,a=e.epoch_anon_id,i=e.epoch_auth_public_key,l=e.epoch_data_v2,u=e.epoch_id,c=e.is_active_epoch,d=e.minos_epoch,m=e.next_epoch_id,p=e.prev_epoch_id;if(t==null||a==null||i==null||u==null||c==null)return null;var _=d==null?void 0:d.epoch_head,f=d==null?void 0:d.self_epoch_signature,g=_!=null&&f!=null?o("LSShape").ofRecord({epoch_head:o("WABase64").decodeB64(_),self_epoch_signature:o("WABase64").decodeB64(f)}):void 0,h=l==null?void 0:l.epoch_anon_id,y=l==null?void 0:l.epoch_root_key,C=h!=null&&y!=null?{epoch_anon_id:h,epoch_root_key:y}:null,b={backup_id:(s||(s=o("I64"))).of_string(t),encrypted_epoch_key:n!=null?o("WABase64").decodeB64(n):null,epoch_anon_id:o("WAArrayBufferUtils").stringToArrayBuffer(a),epoch_auth_public_key:o("WABase64").decodeB64(i),epoch_data_v2:C?o("LSShape").ofRecord(C):null,epoch_id:s.of_string(u),is_active_epoch:c,next_epoch_id:m!=null?(s||(s=o("I64"))).of_string(m):null,prev_epoch_id:p!=null?(s||(s=o("I64"))).of_string(p):null};return(r("gkx")("20911")||r("gkx")("17219"))&&(b=babelHelpers.extends({},b,{minos_epoch:g})),b}function _(e){var t=e.epoch_head,n=e.self_epoch_signature;return t==null||n==null?void 0:o("LSShape").ofRecord({epoch_head:o("WABase64").decodeB64(t),self_epoch_signature:o("WABase64").decodeB64(n)})}function f(e){var t=e.encrypted_epoch_anon_id,n=e.encrypted_epoch_root_key,r=e.encrypted_epoch_storage_private_key,o=e.encrypted_mailbox_root_key_blob,a=e.encrypted_oblivious_validation_token_blob,i=e.encrypted_ocmf_client_state,l=e.encrypted_orf_client_state_v2;return t==null||n==null||o==null||a==null||i==null?null:{encrypted_epoch_anon_id:t,encrypted_epoch_root_key:n,encrypted_epoch_storage_private_key:r,encrypted_mailbox_root_key_blob:o,encrypted_oblivious_validation_token_blob:a,encrypted_ocmf_client_state:i,encrypted_orf_client_state_v2:l}}function g(e){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.encrypted_backups)).then(function(e){var t=e==null?void 0:e.encryptionManagementDelegatorId;return t!=null?(s||(s=o("I64"))).to_string(t):null})}l.addDeviceGraphQLWorker=c,l.addDeviceGraphQL=d}),98);
__d("EBSMGating",["gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("gkx")("24151")}l.isPersistedEBTableEnabled=e}),98);
__d("EBSMGatingUI",["EBSMGating","MAWWaitForBackendSetup"],(function(t,n,r,o,a,i,l){"use strict";function e(){return o("MAWWaitForBackendSetup").isBackendSetupSuccessful()||o("EBSMGating").isPersistedEBTableEnabled()}l.isBackendSetupSuccessfulForEBSM=e}),98);
__d("LSOnboardFromExistingDeviceStart",["LSGetLatestEpochKeys","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][onboardFromExistingDeviceStart] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.db.table(282).add({stateKey:"auto_restored",stateValue:"true"})},function(n){return t.db.table(185).add({pk:t.i64.cast([0,1]),backupId:e[0],deviceRegistrationId:e[2],taskId:t.i64.cast([0,1])})},function(e){return t.storedProcedure(n("LSGetLatestEpochKeys"),!1).then(function(e){var t;return t=e,r[2]=t[0],r[3]=t[1],t})},function(o){return r[2]!==void 0?t.sequence([function(o){return r[11]=r[2].get("epoch_keys"),r[12]=r[11].get("epoch_id"),r[13]=new t.Map,r[13].set("existing_device_id",e[1]),r[13].set("base_epoch_id",r[12]),r[14]=new t.Map,r[14].set("success",r[13]),r[15]=t.toJSON(r[14]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",t.i64.cast([0,50036]),r[15],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return r[4]=void 0}]):t.sequence([function(e){return r[3]!==void 0?t.sequence([function(e){return r[12]=r[3].get("error_message"),r[13]=r[3].get("error_code"),r[14]=new t.Map,r[14].set("error_code",r[13]),r[14].set("stored_procedure","onboardFromExistingDeviceStart"),r[14].set("error_message",r[12]),r[15]=new t.Map,r[15].set("failure",r[14]),r[16]=t.toJSON(r[15]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",t.i64.cast([0,50036]),r[16],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[17]=t[0],t})},function(e){return r[18]=new t.Map,r[18].set("error_code",r[13]),r[18].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure"),r[18].set("error_message",""),r[11]=r[18]}]):t.sequence([function(e){return r[12]=new t.Map,r[12].set("error_code",t.i64.cast([0,603])),r[12].set("stored_procedure","onboardFromExistingDeviceStart"),r[12].set("error_message","Unknown error encountered"),r[13]=new t.Map,r[13].set("failure",r[12]),r[14]=t.toJSON(r[13]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",t.i64.cast([0,50036]),r[14],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[15]=t[0],t})},function(e){return r[16]=new t.Map,r[16].set("error_code",t.i64.cast([0,603])),r[16].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure"),r[16].set("error_message",""),r[11]=r[16]}])},function(e){return r[4]=r[11]}])},function(e){return r[5]=t.i64.of_float(Date.now()),r[6]=t.i64.random(),r[8]="Finishing execution. Execution time: ",r[9]=t.i64.to_string(t.i64.sub(r[5],r[0])),r[10]=" ms",r[7]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][onboardFromExistingDeviceStart] ",r[7],r[8],r[7],r[9],r[7],r[10]].join("")),t.i64.eq(t.i64.mod_(r[6],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[11]=",",r[12]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"onboardFromExistingDeviceStart",[r[8],r[11],r[9],r[11],r[10]].join(""),r[12],t.i64.cast([0,4]))):t.resolve()},function(e){return o[0]=r[4]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure",e.__tables__=["experiences_shared_state","device_metadata"],a.exports=e}),null);
__d("LSOnboardFromExistingDeviceStartStoredProcedure",["LSOnboardFromExistingDeviceStart","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSOnboardFromExistingDeviceStart"),a.backupId,a.previousDeviceId,a.newDeviceRegistrationId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("EBAddDeviceWithKeys",["ClientConsistencyEventEmitter","CurrentAppID","EBAPIQPLPoints","EBDB","EBSMAPI","EBSMGatingUI","I64","LSAuthorityLevel","LSFactory","LSIntEnum","LSOnboardFromExistingDeviceStartStoredProcedure","LSShape","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEBODSEntityName.enum","MWEncryptedBackupsInitializeRestoreDeferred","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsSharedState","ODS","Promise","QPLFlow","QPLUserFlow","ReQL","WAHashStringToNumber","WALogger","err","getErrorSafe","justknobx","promiseDone","qpl","requireDeferred","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C=r("requireDeferred")("MWEBUseLocalStorage").__setRef("EBAddDeviceWithKeys");function b(t){var a=t.backupId,l=t.db,_=t.newDeviceRegistrationId,b=t.previousDeviceId,S=t.source,R=t.trackAddingDevice;return new(y||(y=n("Promise")))(function(t,n){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys start"]))),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"START_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC");var y=o("WAHashStringToNumber").hashStringToNumber(r("uuidv4")()),L=r("qpl")._(521473756,"2768"),E=S,k=o("QPLFlow").startQPLFlow(L,{annotations:{bool:{isEBAddDeviceWithKeys:!0,isInWorker:!1},string:{restore_type:E}},instanceKey:y,timeoutInMs:r("justknobx")._("2444")});k.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_START),(f||(f=o("ODS"))).bumpEntityKey(7319,E,"start"),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys caling LSOnboardFromExistingDeviceStartStoredProcedure"]))),l.runInTransaction(function(e){return r("LSOnboardFromExistingDeviceStartStoredProcedure")(r("LSFactory")(e),{backupId:a,newDeviceRegistrationId:_,previousDeviceId:b})},"readwrite",void 0,void 0,i.id+":103").then(function(e){var a=e[0];if(r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"END_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC"),k.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_END),a!=null){var i,s=o("LSShape").toRecord(a).error_message;switch(r("QPLUserFlow").addPoint((i=o("MWChatEncryptedBackupsQPLEvents")).restoreDeviceAuthQplEvent,"FAIL_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC_WIPE_EBSM"),r("QPLUserFlow").addPoint(i.restoreQplEvent,"FAIL_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC_WIPE_EBSM"),o("MWChatEncryptedBackupsLogging").endFailure({errorName:s,event:i.restoreQplEvent}),o("MWChatEncryptedBackupsLogging").endFailure({errorName:s,event:i.restoreDeviceAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),k.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{string:{error_code:(g||(g=o("I64"))).to_string(o("LSShape").toRecord(a).error_code),error_message:s}}),(f||(f=o("ODS"))).bumpEntityKey(7319,E,"fail"),o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithKeys sproc failed, isInWorker: false, error: ",""])),s),r("promiseDone")(o("EBDB").clearEbStores()),o("CurrentAppID").getAppID()){case 772021112871879 .toString():r("ClientConsistencyEventEmitter").emit("hardRefresh","eb_autorestore_error");break;default:r("ClientConsistencyEventEmitter").emit("softRefresh","eb_autorestore_error")}n(r("err")(s))}k.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SUBSCRIPTION_START);var _=o("ReQL").fromTableAscending(l.tables.secure_encrypted_backups_client_state).subscribe(function(e,a){if(a.operation==="delete"){_();var i="[wmi][ebsm] EBAPI addDeviceWithKeys subscription failed, isInWorker: false, error: client state deleted";v(i,k,E),n(r("err")(i))}else if(a.operation==="add"||a.operation==="put"){var s=a.value,u=s.authorityLevel,y=s.deviceId;(g||(g=o("I64"))).equal(u,(h||(h=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))&&(r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"END_LS_ADD_DEVICE_WITH_EB_KEYS_TASK"),k.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SUBSCRIPTION_END),_(),r("promiseDone")(o("MWEncryptedBackupsSharedState").upsertEBSharedStateEntry({db:l,stateKey:r("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY})),o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys client state row added"]))),R(y),C.onReady(function(e){var t=e.mwEBCreateLocalStorageEntry,n=e.mwEBDeleteLocalStorageEntry;t(r("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION),t(r("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION_2),n(r("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE)}),o("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:l,onFailure:function(){o("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:o("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),o("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:o("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys initialize restore failed"])))},onSuccess:function(){r("QPLUserFlow").addAnnotations(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{restore_type:"auto_restore"}}),o("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{is_backend_setup:o("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},event:o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),o("MWChatEncryptedBackupsLogging").endSuccess({event:o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys initialize restore success"])))}}),r("EBSMAPI").fetchBackupIds("EBAddDeviceWithKeys").catch(function(e){o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["",""])),r("getErrorSafe")(e).message)}),k.endSuccess(),(f||(f=o("ODS"))).bumpEntityKey(7319,E,"success"),t())}})}).catch(function(e){var t="[wmi][ebsm] EBAPI addDeviceWithKeys sproc error, isInWorker: false, error: "+r("getErrorSafe")(e).message;v(t,k,E),n(r("err")(t))})})}function v(e,t,n){o("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{isBackendSetupOnFail:o("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:e,event:o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),o("MWChatEncryptedBackupsLogging").endFailure({errorName:e,event:o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),t.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{string:{error_message:e}}),(f||(f=o("ODS"))).bumpEntityKey(7319,n,"fail"),o("WALogger").ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["",""])),e)}l.addDeviceWithEBKeys=b}),98);
__d("LSAddDevice",["LSArrayGetObjectAt","LSBase64Encode.nop","LSGetViewerFBID","LSHandleWrongRecoveryCode","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSParseRecoveryCode_v2.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(r){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Beginning execution."),e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_sproc_start"):t.resolve()},function(a){return r("justknobx")._("946")?t.sequence([function(e){return o[8]=t.createArray(),t.forEach(t.db.table(179).fetch(),function(e){var n=e.item;return t.sequence([function(e){return o[15]=n.taskId,t.db.table(2).fetch([[[o[15]]]]).next().then(function(e,t){var n=e.done,r=e.value;return n?o[13]=!1:(t=r.item,o[13]=!0)})},function(e){return o[13]?0:o[16]=(o[8].push(o[15]),o[8])}])})},function(e){return o[9]=t.i64.of_int32(o[8].length),t.i64.gt(o[9],t.i64.cast([0,0]))?t.loopAsync(o[9],function(e){return o[13]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[8],o[13]).then(function(e){var t;return t=e,o[14]=t[0],o[15]=t[1],t})},function(e){return t.forEach(t.db.table(179).fetch([[[o[14]]]]),function(e){return e.delete()})}])}):t.resolve()},function(e){return t.db.table(179).fetch().next().then(function(e,t){var n=e.done,r=e.value;return n?o[10]=!1:(t=r.item,o[10]=!0)})},function(r){return o[10]?t.sequence([function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_error","LSEncryptedBackupsAddDeviceStoredProcedure: add device task already pending"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] add device task already pending"),o[14]="add device task already pending",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ","",o[14]].join("")),o[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",o[14],o[13],t.i64.cast([0,3]))},function(e){return o[12]=t.i64.cast([0,1])}]):t.sequence([function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_vd_error_correction_start"):t.resolve()},function(n){return o[13]=t.createArray(),t.forEach(t.filter(t.db.table(184).fetch(),function(n){return t.i64.eq(n.backupId,e[0])}),function(e){var n=e.item;return o[19]=new t.Map,o[19].set("virtual_device_id",n.virtualDeviceId),o[20]=(o[13].push(o[19]),o[13])})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_vd_error_correction_end"):t.resolve()},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_parse_recovery_code_start"):t.resolve()},function(e){return t.db.table(172).fetch().next().then(function(e,n){var r=e.done,a=e.value;return r?o[14]=void 0:(n=a.item,o[20]=n.encryptionManagementDelegatorId,t.i64.neq(o[20],void 0)?(t.i64.neq(o[20],t.i64.cast([0,0]))?o[21]=t.i64.to_string(o[20]):o[21]=void 0,o[19]=o[21]):o[19]=void 0,o[14]=o[19])})},function(e){return t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,o[16]=t[0],t})},function(r){return t.nativeOperation(n("LSParseRecoveryCode_v2.nop"),e[1],o[14]==null?t.i64.to_string(o[16]):o[14],o[13]).then(function(e){var t;return t=e,o[17]=t[0],o[18]=t[1],t})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_parse_recovery_code_end"):t.resolve()},function(r){return t.blobs.neq(o[17],void 0)?t.blobs.neq(o[18],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[17]).then(function(e){var t;return t=e,o[19]=t[0],t})},function(e){return t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,1])})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_issue_fetch_virtual_device_task_start"):t.resolve()},function(r){return o[24]=t.i64.cast([0,1e3]),o[20]=o[24],o[21]=new t.Map,o[21].set("backup_id",e[0]),o[21].set("virtual_device_id",o[19]==null?"":o[19]),o[21].set("trace_id",void 0),o[22]=t.toJSON(o[21]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50007]),o[22],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,o[20]).then(function(e){var t;return t=e,o[23]=t[0],t})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_issue_fetch_virtual_device_task_end"):t.resolve()},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_insert_device_registration_id_start"):t.resolve()},function(n){return t.db.table(185).add({pk:t.i64.cast([0,1]),backupId:e[0],deviceRegistrationId:e[2],taskId:o[23]})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_insert_device_registration_id_end"):t.resolve()},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_insert_recovery_code_data_start"):t.resolve()},function(e){return t.db.table(179).add({taskId:o[23],virtualDeviceId:o[17],blobDecryptionKey:o[18]})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_insert_recovery_code_data_end"):t.resolve()}]):t.sequence([function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_error","LSEncryptedBackupsAddDeviceStoredProcedure: Invalid recovery code. blob_decryption_key is null"):t.resolve()},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Invalid recovery code. blob_decryption_key is null",!0)}]):t.sequence([function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_error","LSEncryptedBackupsAddDeviceStoredProcedure: Invalid recovery code. virtual_device_id is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Invalid recovery code. virtual_device_id is null"),o[20]="Invalid recovery code. virtual_device_id is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ","",o[20]].join("")),o[19]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",o[20],o[19],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Invalid recovery code. virtual_device_id is null",!0)}])},function(e){return o[12]=t.i64.cast([0,0])}])},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_sproc_end"):t.resolve()},function(e){return o[1]=o[12]}]):t.sequence([function(r){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] addDeviceFlow is not enabled"),e[4]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_error","LSEncryptedBackupsAddDeviceStoredProcedure: add device flow is disabled"):t.resolve()},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_sproc_end"):t.resolve()},function(e){return o[1]=t.i64.cast([0,1])}])},function(e){return o[2]=t.i64.of_float(Date.now()),o[3]=t.i64.random(),o[5]="Finishing execution. Execution time: ",o[6]=t.i64.to_string(t.i64.sub(o[2],o[0])),o[7]=" ms",o[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ",o[4],o[5],o[4],o[6],o[4],o[7]].join("")),t.i64.eq(t.i64.mod_(o[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[8]=",",o[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",[o[5],o[8],o[6],o[8],o[7]].join(""),o[9],t.i64.cast([0,4]))):t.resolve()},function(e){return a[0]=o[1]}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsAddDeviceStoredProcedure",e.__tables__=["secure_recovery_code_data","pending_tasks","encrypted_backups_virtual_devices","encrypted_backups","secure_encrypted_backups_recovery_code_status","device_metadata"];var s=e;l.default=s}),98);
__d("LSAddDeviceStoredProcedure",["LSAddDevice","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSAddDevice"),a.backupId,a.recoveryCode,a.deviceRegistrationId,a.backupTenancy,a.traceId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSEncryptedBackupsOpStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({SUCCESS:0,FAILURE:1,UNKNOWN:2});i.default=e}),66);
__d("LSEncryptedBackupsRecoveryCodeStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({OPTIMISTIC:1,VALID:2,INVALID:3,SYSTEM_ERROR:4});i.default=e}),66);
__d("MWEncryptedBackupsRecoveryCodeStatus",["FBLogger","I64","LSEncryptedBackupsRecoveryCodeStatus"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.onFailure,a=t.onInvalidRecoveryCode,i=t.onSuccess,l=t.recoveryCodeStatusData;if((l==null?void 0:l.length)===1){var s=l[0].recoveryCodeStatus;switch((e||(e=o("I64"))).to_int32(s)){case r("LSEncryptedBackupsRecoveryCodeStatus").OPTIMISTIC:return r("LSEncryptedBackupsRecoveryCodeStatus").OPTIMISTIC;case r("LSEncryptedBackupsRecoveryCodeStatus").INVALID:return a==null||a(),r("LSEncryptedBackupsRecoveryCodeStatus").INVALID;case r("LSEncryptedBackupsRecoveryCodeStatus").VALID:return i==null||i(),r("LSEncryptedBackupsRecoveryCodeStatus").VALID;case r("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR:return n==null||n(),r("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR;default:n==null||n(),r("FBLogger")("wmi_eb").mustfix("Invalid Recovery Code Status type")}}}l.encryptedBackupsGetRecoveryCodeStatus=s}),98);
__d("EBAddDeviceWithRecoveryCode",["EBAPIQPLPoints","EBAddDeviceGraphQL","EBDeps","FBLogger","I64","LSAddDeviceStoredProcedure","LSEncryptedBackupsBackupTenancy","LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","MAWWaitForBackendSetup","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsRecoveryCodeStatus","ReQL","WALogger","WAResultOrError","isInstamadilloEB","justknobx","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p=10;function _(e){var t=e.count,n=e.storage;return new Promise(function(e,a){if(t===p)return e();r("promiseDone")(o("ReQL").firstAsync(o("ReQL").fromTableAscending(n.tables.encrypted_backups)),function(r){var o=r==null?void 0:r.backupId;if(o!=null)return e(o);window.setTimeout(function(){e(_({count:t+1,storage:n}))},1e3)},function(e){return a(e)})})}function f(t){var n=t.environment,a=t.qplFlow,l=t.recoveryCode,p=t.userId,f=function(){},y=!1,C=new Promise(function(e,t){window.setTimeout(function(){y||(r("FBLogger")("wmi_eb").warn("Add device failed by timeout 90 sec"),h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TIMEOUT),e("ADD_DEVICE_TIMEOUT"))},r("justknobx")._("4226"))}),b=new Promise(async function(t,g){a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_START);var y=await o("EBDeps").getDeps().getLSDB();a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_END),f=y.tables.secure_encrypted_backups_recovery_code_status.subscribe(function(e,n){if(n.operation!=="delete"){var i=[n.value];a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_CHECK_RC_STATUS),o("MWEncryptedBackupsRecoveryCodeStatus").encryptedBackupsGetRecoveryCodeStatus({onFailure:function(){h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILED_TO_GET_RC_STATUS),f(),t("ADD_DEVICE_FAILED_TO_GET_RC_STATUS")},onInvalidRecoveryCode:function(){h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.INVALID_RECOVERY_CODE),f(),t("INVALID_RECOVERY_CODE")},onSuccess:function(){a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TASK_END),a.endSuccess({bool:{isBackendSetupOnSuccess:o("EBDeps").getDeps().isBackendSetupSuccessful()}}),f(),r("promiseDone")(o("EBDeps").getDeps().trackAddingNewDevice()),t("SUCCESS")},recoveryCodeStatusData:i})}}),r("promiseDone")(_({count:0,storage:y}),function(_){if(_!=null)if(r("isInstamadilloEB")()){o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device sproc start"])));var b=o("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();return b===""?(h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILED_DEVICE_REGISTRATION_ID_NULL),f(),g("deviceRegistrationId is not defined")):(a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_START),y.runInTransaction(function(e){return r("LSAddDeviceStoredProcedure")(r("LSFactory")(e),{backupId:_,backupTenancy:(d||(d=o("I64"))).of_int32(r("LSEncryptedBackupsBackupTenancy").PRODUCTION),deviceRegistrationId:b,recoveryCode:l})},"readwrite",void 0,void 0,i.id+":232").then(function(e){var t=e[0];if(!(d||(d=o("I64"))).equal(t,(m||(m=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").SUCCESS)))return h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{bool:{is_backend_setup:o("MAWWaitForBackendSetup").isBackendSetupSuccessful()}}),f(),g("Add device sproc failed");a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_END),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TASK_START),o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device sproc success"])))}).catch(function(e){throw a.addAnnotations({string:{error_message:e.message}}),e}))}else{o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device gql start"]))),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_START);var C=n!=null?o("EBAddDeviceGraphQL").addDeviceGraphQL({backupId:_,environment:n,qplFlow:a,recoveryCode:l,storage:y,userId:p}):o("EBAddDeviceGraphQL").addDeviceGraphQLWorker({backupId:_,qplFlow:a,recoveryCode:l,storage:y,userId:p});return C.then(function(e){if(e.success)a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_END),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TASK_START),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device gql success"])));else return h(a,o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_FAIL,{string:{fail_result:e.error}}),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_FAIL),f(),t("ADD_DEVICE_GRAPHQL_ERROR")})}else return h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILURE_BACKUP_NOT_FOUND),f(),t("ADD_DEVICE_ERROR_BACKUP_ID_NOT_DEFINED")},function(e){return r("FBLogger")("wmi_eb").catching(e).mustfix("Add device failed. Could not find backup."),h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_COULD_NOT_FIND_BACKUP,{string:{error_message:e.message}}),f(),t("ADD_DEVICE_ERROR_COULD_NOT_READ_BACKUP_TABLE")})});return Promise.race([b,C]).then(function(e){return y=!0,g(e)})}function g(e){return e==="SUCCESS"?o("WAResultOrError").makeResult():o("WAResultOrError").makeError(e)}var h=function(t,n,r){t.endFail(n,babelHelpers.extends({},r!=null?r:{},{bool:{isBackendSetupOnFail:o("EBDeps").getDeps().isBackendSetupSuccessful()}}))};l.addDeviceWithRecoveryCode=f}),98);
__d("EBAddVirtualDevice",["EBDeps","EBLogger","I64","LSEncryptedBackupsOpStatus","LSEncryptedBackupsRecoveryCodeStatus","LSIntEnum","ReQL","WAResultOrError","promiseDone","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("requireDeferred")("MWEncryptedBackupsCreateExtraVirtualDeviceWithRecoveryCodeData").__setRef("EBAddVirtualDevice");async function c(t){var n=t.actionType,a=t.qplFlow,i=t.recoveryCodeData;a.addPoint("add_virtual_device_get_db_start");var l=await o("EBDeps").getDeps().getLSDB();return a.addPoint("add_virtual_device_get_db_end"),a.addPoint("add_virtual_device_sproc_start"),new Promise(function(t,c){return u.onReady(function(u){var c=l.tables.secure_encrypted_backups_recovery_code_status.subscribe(function(){r("promiseDone")(o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(l.tables.secure_encrypted_backups_recovery_code_status)),function(n){if(n!=null&&n.length===1){var a=n[0].recoveryCodeStatus;return(e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsRecoveryCodeStatus").VALID))?(c(),t(o("WAResultOrError").makeResult())):(e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsRecoveryCodeStatus").INVALID))?(c(),t(o("WAResultOrError").makeError("ADD_VIRTUAL_DEVICE_STATUS_INVALID"))):void 0}})});r("promiseDone")(u.initializeCreateExtraVirtualDeviceStoredProcedure(l,(e||(e=o("I64"))).of_int32(n),i),function(n){a.addPoint("add_virtual_device_sproc_end");var i=n[0];if(!(e||(e=o("I64"))).equal(i,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").SUCCESS)))return(e||(e=o("I64"))).equal(i,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE))?(a.endFail("add_virtual_device_sproc_failure"),o("EBLogger").EBLogger().mustfix("Error while creating extra virtual device - failure"),t(o("WAResultOrError").makeError("ADD_VIRTUAL_DEVICE_STATUS_FAILURE"))):(a.addPoint("add_virtual_device_sproc_fail_unknown"),o("EBLogger").EBLogger().mustfix("Error while creating extra virtual device - unknown"),t(o("WAResultOrError").makeError("ADD_VIRTUAL_DEVICE_STATUS_UNKNOWN")))},function(){return o("EBLogger").EBLogger().mustfix("Error while creating extra virtual device."),t(o("WAResultOrError").makeError("ADD_VIRTUAL_DEVICE_ERROR"))})})})}l.addVirtualDevice=c}),98);
__d("EBBatchRequestResignCdnUrlQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="24784488421147370"}),null);
__d("EBBatchRequestResignCdnUrlQuery.graphql",["EBBatchRequestResignCdnUrlQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"request"}],t=[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"payloads",variableName:"request"}],concreteType:"XFBResignCdnUrlResponse",kind:"LinkedField",name:"batch_resigned_attachment_cdn_url",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"instance_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"path",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_message",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_enum",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"EBBatchRequestResignCdnUrlQuery",selections:t,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"EBBatchRequestResignCdnUrlQuery",selections:t},params:{id:n("EBBatchRequestResignCdnUrlQuery_facebookRelayOperation"),metadata:{},name:"EBBatchRequestResignCdnUrlQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("EBBatchRequestResignCdnUrl",["EBBatchRequestResignCdnUrlQuery.graphql","EBEnqueueResignCdnUrlRequests","FBLogger","WADirectPath","WAErrorMessage","WAMediaUtils","WAResultOrError","createWorkerQuery"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h=function(){return r("FBLogger")("wmi").tags(["labyrinth_web","resign_cdn_url"])};async function y(e){var t=o("EBEnqueueResignCdnUrlRequests").getGqlRestoredCdnUrlMap(),n=[];for(var r of t.entries()){var a=r[0],i=r[1];i.pending||n.push([a,i])}if(!(n.length<1)){var l=n.map(function(e){return{instance_key:e[0],payload:e[1].payload}});n.forEach(function(e){var t=e[0],n=e[1];o("EBEnqueueResignCdnUrlRequests").setGqlRestoredCdnUrlMap(t,{payload:n.payload,pending:!0,resolvable:n.resolvable})}),await C(e,l)}}async function C(e,t){if(!(t.length<1)){var n=o("EBEnqueueResignCdnUrlRequests").getGqlRestoredCdnUrlMap();e==null||e.addPoint("resign_cdn_url_query_start");try{var a,i,l=await r("createWorkerQuery")(v,{request:t.map(function(e){return{instance_key:e.instance_key,payload:e.payload.payload}})});e==null||e.addPoint("resign_cdn_url_query_end");var f=l==null||(a=l.viewer)==null||(a=a.messenger_default_encrypted_backup)==null||(a=a.mailbox)==null?void 0:a.batch_resigned_attachment_cdn_url;h().DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Received "," requests"])),f==null?void 0:f.length),e==null||e.addAnnotations({int:{resign_cdn_url_gql_batch_size:(i=f==null?void 0:f.length)!=null?i:0}}),f==null||f.forEach(function(t){var r=t.instance_key!=null?o("WAMediaUtils").stringToDeliveryObjectId(t.instance_key):null,a=t.path;if(r!=null){var i,l=o("WADirectPath").validateDirectPath(a);if(!l.success){var s;h().WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",", graphql error: ",""])),l.error,t.exception_message),e==null||e.addAnnotations({string:{resign_cdn_url_exception_enum:(s=t.exception_enum)!=null?s:"unknown"}})}var m=(i=n.get(r))==null?void 0:i.resolvable;m!=null?m.resolve(l):h().MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["No resolvable found for instance key: ",""])),r),n.delete(r)}else h().MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url came back with no instance key, ",""])),a)})}catch(r){var g=o("WAErrorMessage").maybeGetMessageFromError(r);e==null||e.addPoint("resign_cdn_url_query_fail"),e==null||e.addAnnotations({string:{resign_cdn_url_gql_error:g}}),h().WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",""])),g),t.forEach(function(e){var t,r=(t=n.get(o("WAMediaUtils").stringToDeliveryObjectId(e.instance_key)))==null?void 0:t.resolvable;r!=null?r.resolve(o("WAResultOrError").makeError("resign-cdn-url-gql-error")):h().MUSTFIX(p||(p=babelHelpers.taggedTemplateLiteralLoose(["No resolvable found during error for instance key: ",""])),e.instance_key)})}finally{t.forEach(function(e){var t,r=o("WAMediaUtils").stringToDeliveryObjectId(e.instance_key),a=(t=n.get(r))==null?void 0:t.resolvable;(a==null?void 0:a.isSettled)===!1&&h().MUSTFIX(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Resolvable was not properly settled"]))),n.delete(o("WAMediaUtils").stringToDeliveryObjectId(e.instance_key))})}}}async function b(e,t,n){e==null||e.addPoint("resign_cdn_url_query_start");try{var a,i=await r("createWorkerQuery")(v,{request:[{instance_key:t,payload:n.payload}]});e==null||e.addPoint("resign_cdn_url_query_end");var l=i==null||(a=i.viewer)==null||(a=a.messenger_default_encrypted_backup)==null||(a=a.mailbox)==null?void 0:a.batch_resigned_attachment_cdn_url;(l==null?void 0:l.length)!==1&&(e==null||e.addPoint("resign_cdn_url_should_have_one_response"));var s=l==null?void 0:l[0],u=s==null?void 0:s.path,c=o("WADirectPath").validateDirectPath(u);if(!c.success){var d;h().WARN(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",", graphql error: ",""])),c.error,s==null?void 0:s.exception_message),e==null||e.addAnnotations({string:{resign_cdn_url_exception_enum:(d=s==null?void 0:s.exception_enum)!=null?d:"unknown"}})}return c}catch(t){var m=o("WAErrorMessage").maybeGetMessageFromError(t);return e==null||e.addPoint("resign_cdn_url_query_fail"),e==null||e.addAnnotations({string:{resign_cdn_url_gql_error:m}}),h().WARN(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",""])),m),o("WAResultOrError").makeError("resign-cdn-url-gql-error")}}var v=e!==void 0?e:e=n("EBBatchRequestResignCdnUrlQuery.graphql");l.batchedResignCdnUrlFromMap=y,l.batchedResignCdnUrlWithGraphQL=C,l.resignCdnUrlWithGraphQL=b}),98);
__d("EBEnqueueResignCdnUrlRequests",["EBBatchRequestResignCdnUrl","WACustomError","WAPromiseDelays","WAPromiseTimeout","WAResolvable","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){var e=!0;return{get:function(){return e},set:function(n){e=n}}})(),s=(function(){var e=window.performance.now();return{get:function(){return e},set:function(n){e=n}}})(),u=new Map,c=r("justknobx")._("4662"),d=r("justknobx")._("3244");function m(t,n,r){var a,i=(a=u.get(t))==null?void 0:a.resolvable;if(i!=null)return r==null||r.addPoint("resign_cdn_url_map_hit"),p({mediaDownloadFlow:r,objectId:t,payload:n,promise:i.promise});var l=new(o("WAResolvable")).Resolvable,s=u.size===0;return u.set(t,{payload:n,pending:!1,resolvable:l}),e.get()?(_(s),p({mediaDownloadFlow:r,objectId:t,payload:n,promise:l.promise})):p({mediaDownloadFlow:r,objectId:t,payload:n,promise:l.promise})}function p(e){var t=e.mediaDownloadFlow,n=e.objectId,r=e.payload,a=e.promise;return o("WAPromiseTimeout").promiseTimeout(a,d).then(function(e){return!e.success&&e.error==="direct-path-undefined"?(u.delete(n),o("WAPromiseDelays").delayMs(d).then(function(){return o("EBBatchRequestResignCdnUrl").resignCdnUrlWithGraphQL(t,n,r)})):e}).catch(function(e){var a=e instanceof Error&&["NetworkTransportError","NetworkTimeoutError","NetworkRequestError"].includes(e.name);if(e instanceof o("WACustomError").TimeoutError||a)return t==null||t.addPoint("resign-cdn-url-gql-timeout"),u.delete(n),o("EBBatchRequestResignCdnUrl").resignCdnUrlWithGraphQL(t,n,r);throw t==null||t.addPoint("resign-cdn-url-gql-unexpected-error"),t==null||t.addAnnotations({string:{resign_cdn_url_payload_fail_reason:e.message}}),e})}function _(t,n){if(e.set(!1),t)return e.set(!0),s.set(window.performance.now()),o("EBBatchRequestResignCdnUrl").batchedResignCdnUrlFromMap(n);var r=Math.max(c-(window.performance.now()-s.get()),0);return o("WAPromiseDelays").delayMs(r).then(function(){return e.set(!0),s.set(window.performance.now()),o("EBBatchRequestResignCdnUrl").batchedResignCdnUrlFromMap(n)})}function f(){return u}function g(e,t){u.set(e,t)}l.enqueueResignCdnUrl=m,l.getGqlRestoredCdnUrlMap=f,l.setGqlRestoredCdnUrlMap=g}),98);
__d("EBBucketUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n){if(t===void 0&&(t=100),n===void 0&&(n=5),e===0)return"zero";if(e<0)return"negative";if(n<=0)return"invalidIncrement";if(e>t)return"greaterThanLimit";var r=Math.floor((e-1)/n)*n+1,o=Math.min(r+n-1,t);return r+"-"+o}i.getBucketName=e}),66);
__d("EBCreateResignCDNUrlPayload",["CreateDerivedKeys","EBBase64Encode","EBWorkerEBDBApi","GetBlobFromInt64BE","Hmac_v2","I64","LSVec","OcmfClientMap","OpeEncrypt","TruncateSortKey","WAArrayBufferUtils","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s="thread_ope_key",u="__DEVICE_ID_PLACEHOLDER__";async function c(e){var t=e.accessTokenSecret,n=e.deliveryObjectId,r=e.mediaType,a=e.messageId,i=e.primaryKeySecret,l=e.productType,s=e.sort,c=s===void 0?!1:s,m=e.sortOrderMs,p=e.threadId,_=await d({accessTokenSecret:t,deliveryObjectId:n,mediaType:r,messageId:a,primaryKeySecret:i,productType:l,sortOrderMs:m,threadId:p});if(!_.success)return _;var f=_.value,g=f.device_id,h=babelHelpers.extends({},f,{device_id:u}),y=c?JSON.stringify(h,Object.keys(h).sort()):JSON.stringify(h);return o("WAResultOrError").makeResult(y.replace('"'+u+'"',String(g)))}async function d(e){var t=e.accessTokenSecret,n=e.deliveryObjectId,a=e.mediaType,i=e.messageId,l=e.primaryKeySecret,s=e.productType,u=e.sortOrderMs,c=e.threadId,d=await o("EBWorkerEBDBApi").getSecureEBClientState();if(d==null)return o("WAResultOrError").makeError("no-eb-client-state");var _=String(d.backupId),f=d.deviceId;if(f==null)return o("WAResultOrError").makeError("no-device-id");var g=r("EBBase64Encode")(d.mailboxRootKeyBlob),h=r("EBBase64Encode")(d.ocmfClientStateBlob),y=await Promise.all([m("attachment_key_scope",JSON.stringify([_,n]),d.ocmfClientStateBlob),m("mailbox_id_scope",_,d.ocmfClientStateBlob),m("message_id_scope",i,d.ocmfClientStateBlob),m("attachment_token_salt_scope",i,d.ocmfClientStateBlob),m("attachment_key_salt_scope",JSON.stringify([_,n]),d.ocmfClientStateBlob),m("attachment_token_salt_scope",JSON.stringify([i,n]),d.ocmfClientStateBlob),m("thread_id_scope",c,d.ocmfClientStateBlob),p(d.mailboxRootKeyBlob,u,c)]),C=y[0],b=y[1],v=y[2],S=y[3],R=y[4],L=y[5],E=y[6],k=y[7];return k==null?o("WAResultOrError").makeError("no-encrypted-sort-key"):o("WAResultOrError").makeResult({access_token_secret:t,attachment_index_key:r("EBBase64Encode")(C),backup_ent_fbid:-8,backup_id:_,delivery_object_id:n,device_id:f,isOpenEB:0,mailbox_partial_id:r("EBBase64Encode")(b),media_type:a,message_partial_id:r("EBBase64Encode")(v),primary_key_secret:l,product_type:s,raw_identifiers:{otid:i,server_thread_key:null,timestamp:u.toString()},raw_tokens:{mailbox_root_key:g,ocmf_client_state_blob:h},salt_partial_access_token:r("EBBase64Encode")(L),salt_partial_attachment_index_key:r("EBBase64Encode")(R),salt_partial_id:r("EBBase64Encode")(S),sort_key:k,thread_id:c,thread_partial_id:r("EBBase64Encode")(E)})}function m(e,t,n){return r("Hmac_v2")(o("WAArrayBufferUtils").stringToArrayBuffer(e),o("WAArrayBufferUtils").stringToArrayBuffer(t)).then(function(e){return r("OcmfClientMap")(n,e[0])})}async function p(t,n,a){var i=new TextEncoder().encode(s+"_"+a).buffer,l=(await o("CreateDerivedKeys").CreateDerivedKeys(i,void 0,t,[(e||(e=o("I64"))).of_int32(32)]))[0];if(l==null)return null;var u=await o("GetBlobFromInt64BE").GetBlobFromInt64BE(e.of_float(n)),c=await o("TruncateSortKey").TruncateSortKey(u[0]),d=await o("OpeEncrypt").OpeEncrypt(r("LSVec").toArray(l)[0],c[0],e.of_int32(16)),m=Array.from(new Uint8Array(d[0])),p=m.map(function(e){return e.toString(16).padStart(2,"0")});return p.join("").toUpperCase()}l.createStringifiedMediaRestorePayloadFromEBDB=c}),98);
__d("EBDeleteBackupsOnClient",["EBAPIQPLPoints","EBDeps","EBSMAPI","QPLFlow","Random","ReQL","getErrorSafe","qpl"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.reason,n=o("Random").uint32(),a=o("QPLFlow").startQPLFlow(r("qpl")._(521485243,"1081"),{annotations:{string:{reason:t}},instanceKey:n});try{var i;a.addPoint((i=o("EBAPIQPLPoints")).EBDeleteBackupsOnClientQPLPoints.GET_DB_START);var l=await o("EBDeps").getDeps().getLSDB();a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.GET_DB_END),a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.TRANSACTION_START),await l.runInTransaction(async function(e){var t,n;a.addPoint((t=o("EBAPIQPLPoints")).EBDeleteBackupsOnClientQPLPoints.CLEAR_CLIENT_STATE_START);var r=await(n=o("ReQL")).toArrayAsync(n.fromTableAscending(e.secure_encrypted_backups_client_state));await Promise.all(r.map(function(t){return e.secure_encrypted_backups_client_state.delete(t.backupId)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_CLIENT_STATE_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_EPOCHS_START);var i=await n.toArrayAsync(n.fromTableAscending(e.secure_encrypted_backups_epochs));await Promise.all(i.map(function(t){return e.secure_encrypted_backups_epochs.delete(t.epochId)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_EPOCHS_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_RECOVERY_CODE_START);var l=await n.toArrayAsync(n.fromTableAscending(e.secure_encrypted_backups_generated_recovery_code));await Promise.all(l.map(function(t){return e.secure_encrypted_backups_generated_recovery_code.delete(t.pk)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_RECOVERY_CODE_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_ENCRYPTED_BACKUPS_START);var s=await n.toArrayAsync(n.fromTableAscending(e.encrypted_backups));await Promise.all(s.map(function(t){return e.encrypted_backups.put(babelHelpers.extends({},t,{backupId:void 0}))})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_ENCRYPTED_BACKUPS_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_METADATA_START);var u=await n.toArrayAsync(n.fromTableAscending(e.encrypted_backups_metadata));await Promise.all(u.map(function(t){return e.encrypted_backups_metadata.delete(t.backupId)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_METADATA_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_VIRTUAL_DEVICES_START);var c=await n.toArrayAsync(n.fromTableAscending(e.encrypted_backups_virtual_devices));await Promise.all(c.map(function(t){return e.encrypted_backups_virtual_devices.delete(t.pk)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_VIRTUAL_DEVICES_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_RECOVERY_CODE_STATUS_START);var d=await n.toArrayAsync(n.fromTableAscending(e.secure_encrypted_backups_recovery_code_status));await Promise.all(d.map(function(t){return e.secure_encrypted_backups_recovery_code_status.delete(t.pk)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_RECOVERY_CODE_STATUS_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_PENDING_BACKUPS_START);var m=await n.toArrayAsync(n.fromTableAscending(e.pending_backups_context_v2));await Promise.all(m.map(async function(t){var n=t.pendingBackupTaskId;n!=null&&await e.pending_tasks.delete(n)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_PENDING_BACKUPS_END)},"readwrite"),a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.TRANSACTION_END),a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.FETCH_BACKUP_IDS_START),await r("EBSMAPI").fetchBackupIds("deleteBackupsOnClient"),a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.FETCH_BACKUP_IDS_END),a.endSuccess()}catch(e){var s=r("getErrorSafe")(e);throw a.endFail("runtime_error",{string:{error_message:s.message}}),e}}l.deleteBackupsOnClient=e}),98);
__d("LSDeleteBackups",["LSBase64Encode.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(a){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] Beginning execution."),r("justknobx")._("803")?t.sequence([function(r){return t.db.table(168).fetch([[[e[0]]]]).next().then(function(r,a){var i=r.done,l=r.value;return i?((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] Row not found in client state table for the backupidDeleting the backup without deleting mailbox"),o[9]=new t.Map,o[9].set("backup_id",e[0]),o[9].set("trace_id",e[1]),o[9].set("backup_deletion_source",e[2]),o[10]=t.toJSON(o[9]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50011]),o[10],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[1],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[11]=t[0],t})):(a=l.item,t.sequence([function(r){return o[13]=a.deviceId,t.nativeOperation(n("LSGetBlobFromString.nop"),t.i64.to_string(e[0])).then(function(e){var t;return t=e,o[9]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWFpbGJveF9pZF9zY29wZQ=="),o[9]).then(function(e){var t;return t=e,o[10]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),a.ocmfClientStateBlob,o[10]).then(function(e){var t;return t=e,o[11]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[11]).then(function(e){var t;return t=e,o[12]=t[0],t})},function(r){return t.i64.neq(o[13],void 0)?(o[14]=new t.Map,o[14].set("device_id",o[13]),o[14].set("mailbox_partial_id",o[12]==null?"":o[12]),o[14].set("trace_id",e[1]),o[14].set("backup_deletion_source",e[2]),o[15]=t.toJSON(o[14]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_encrypted_backups",t.i64.cast([0,50014]),o[15],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[1],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[16]=t[0],t})):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] device_id is null"),o[15]="device_id is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] ","",o[15]].join("")),o[14]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupsStoredProcedure",o[15],o[14],t.i64.cast([0,3]))},function(r){return o[16]=new t.Map,o[16].set("backup_id",e[0]),o[16].set("trace_id",e[1]),o[16].set("backup_deletion_source",e[2]),o[17]=t.toJSON(o[16]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50011]),o[17],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[1],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[18]=t[0],t})}])}]))})},function(e){return o[1]=t.i64.cast([0,0])}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] backup deletion flow is not enabled"),o[1]=t.i64.cast([0,1])))},function(e){return o[2]=t.i64.of_float(Date.now()),o[3]=t.i64.random(),o[5]="Finishing execution. Execution time: ",o[6]=t.i64.to_string(t.i64.sub(o[2],o[0])),o[7]=" ms",o[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] ",o[4],o[5],o[4],o[6],o[4],o[7]].join("")),t.i64.eq(t.i64.mod_(o[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[8]=",",o[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupsStoredProcedure",[o[5],o[8],o[6],o[8],o[7]].join(""),o[9],t.i64.cast([0,4]))):t.resolve()},function(e){return a[0]=o[1]}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsDeleteBackupsStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state"];var s=e;l.default=s}),98);
__d("LSDeleteBackupsStoredProcedure",["LSDeleteBackups","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSDeleteBackups"),a.backupId,a.traceId,a.backupDeletionSource);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("encryptedBackupsDeleteBackupsStoredProcedure",["LSDeleteBackupsStoredProcedure","LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","LSResult","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,a){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.encrypted_backups)).then(async function(l){var s=r("LSResult")((e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE));if(l!=null){var u=l.backupId;u!=null&&(s=await t.runInTransaction(function(t){return r("LSDeleteBackupsStoredProcedure")(r("LSFactory")(t),{backupDeletionSource:(e||(e=o("LSIntEnum"))).ofNumber(n),backupId:u,traceId:a})},"readwrite",void 0,void 0,i.id+":37"))}return s})}l.default=s}),98);
__d("EBDeleteEncryptedBackup",["EBAPIQPLPoints","EBDeps","EBSMAPI","LSEncryptedBackupsOpStatus","LSIntEnum","WAResultOrError","WATagsLogger","encryptedBackupsDeleteBackupsStoredProcedure","getSafeQplErrorMessage","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS(["EB","EBAPIDeleteEncryptedBackup"]);async function c(t){var n=t.qplFlow,a=t.reason;n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_GET_DB_START);var i=await o("EBDeps").getDeps().getLSDB();return n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_GET_DB_END),n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_START),new Promise(function(t,l){r("encryptedBackupsDeleteBackupsStoredProcedure")(i,a,n.getQPLAttrs().instanceKey.toString()).then(function(e){var a=e[0];if(a===(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)){n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_FAIL),n.endFail("delete_eb_sproc_fail"),t(o("WAResultOrError").makeError("DELETE_EB_SPROC_FAIL"));return}n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_SUCCESS);var l=i.tables.encrypted_backups.subscribe(function(e,a){if(a.operation==="put"){if(a.value.backupId==null)return n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_TASK_SUCCESS),n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.FETCH_BACKUP_IDS_START),r("promiseDone")(r("EBSMAPI").fetchBackupIds("EBDeleteEncryptedBackup"),function(){n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.FETCH_BACKUP_IDS_END),n.endSuccess()},function(){n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.FETCH_BACKUP_IDS_END),n.endFail("fetch_backup_ids_fail")}),t(o("WAResultOrError").makeResult()),l();n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_NON_DELETE_OPERATION)}else n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_NON_PUT_OPERATION)},void 0,["backupId"])}).catch(function(r){u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Exception while calling deleteBackups stored procedure: ",""])),r),n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_ERROR,{string:{error:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(r)}}),n.endFail("delete_eb_sproc_error"),t(o("WAResultOrError").makeError("DELETE_EB_SPROC_ERROR"))})})}l.deleteEncryptedBackup=c}),98);
__d("EBFetchBackupIds",["EBDeps","I64","LSAuthorityLevel","LSEncryptedBackupsBackupTenancy","LSFactory","LSFetchBackupIdsStoredProcedure","LSIntEnum","MWEBODSEntityName.enum","ODS","err","justknobx","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;async function c(t,n){(e||(e=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MW_EBSM_FETCH_BACKUP_IDS,t+".sproc"),n.addPoint("eb_fetch_backup_ids_get_storage_start");var a=await o("EBDeps").getDeps().getLSDB();return n.addPoint("eb_fetch_backup_ids_get_storage_ended"),new Promise(function(e,t){var i,l=a.tables.encrypted_backups.subscribe(function(t,a){if(a.operation==="delete"||!(s||(s=o("I64"))).equal(a.value.authorityLevel,(u||(u=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))){a.operation==="delete"?n.addPoint("eb_fetch_backup_ids_delete_detected"):n.addPoint("eb_fetch_backup_ids_authority_level_not_auth");return}l(),window.clearTimeout(i),n.addPoint("eb_fetch_backup_ids_success"),n.endSuccess(),e()});n.addPoint("eb_fetch_backup_ids_sproc_start"),r("promiseDone")(a.runInTransaction(function(e){return r("LSFetchBackupIdsStoredProcedure")(r("LSFactory")(e),{backupTenancy:(u||(u=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsBackupTenancy").PRODUCTION),isUiBlocking:!1}).then(function(){n.addPoint("eb_fetch_backup_ids_sproc_ended"),i=window.setTimeout(function(){n.endFail("eb_fetch_backup_ids_timeout"),t(r("err")("[wmi][ebapi] Timeout fetching backup ids"))},r("justknobx")._("3868"))})},"readwrite"))})}function d(e,t){return c(e,t)}l.fetchBackupIds=d}),98);
__d("LSCreateRecoveryCode.nop",["CryptoLogger","GF32RecoveryCodes","GaloisField32","LSResult","Promise","UInt8Array"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){for(;;){var t=o("UInt8Array").getBufferWithRandomValuesFromLength(1),n=new Uint8Array(t)[0];if(n<256-256%e)return n%e}return 0}var u=function(a,i){var t=["2","0"].join("");try{for(var l=[],u=0;u<=33;++u)l.push(s(32));var c=o("GF32RecoveryCodes").getEccForCode(o("GaloisField32").asGf32MatExn(l)),d=l.concat(c),m=o("GaloisField32").matrixToSymbols(o("GaloisField32").asGf32MatExn(d)),p=t+m;return(e||(e=n("Promise"))).resolve(r("LSResult")(p))}catch(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("create_recovery_code"),e).mustfix("creating recovery code failed"),e}};u.__nop_name__="LSCreateRecoveryCode",l.default=u}),98);
__d("LSGenerateRecoveryCode",["LSCreateRecoveryCode.nop","LSGetViewerFBID","LSLogMebClientEvent.nop","LSParseRecoveryCode_v2.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateRecoveryCodeStoredProcedure] Beginning execution."),t.forEach(t.filter(t.db.table(174).fetch(),function(e){return e.recoveryCode==="1SHADOWTESTINGRECOVERYCODE00000000000000"}),function(e){return e.delete()})},function(e){return t.db.table(174).fetch([[[t.i64.cast([0,1])]]]).next().then(function(e,o){var a=e.done,i=e.value;return a?t.sequence([function(e){return t.nativeOperation(n("LSCreateRecoveryCode.nop")).then(function(e){var t;return t=e,r[15]=t[0],t})},function(e){return t.db.table(174).add({pk:t.i64.cast([0,1]),recoveryCode:r[15]})},function(e){return r[1]=r[15]}]):(o=i.item,r[1]=o.recoveryCode)})},function(n){return t.forEach(t.db.table(174).fetch([[[t.i64.cast([0,1])]]]),function(t){var n=t.update,r=t.item;return n({virtualDeviceType:e[0],cloudServiceAccount:void 0,hsmPinNormalizationStatus:void 0})})},function(e){return r[3]=t.createArray(),t.db.table(172).fetch().next().then(function(e,n){var o=e.done,a=e.value;return o?r[4]=void 0:(n=a.item,r[16]=n.encryptionManagementDelegatorId,t.i64.neq(r[16],void 0)?(t.i64.neq(r[16],t.i64.cast([0,0]))?r[17]=t.i64.to_string(r[16]):r[17]=void 0,r[15]=r[17]):r[15]=void 0,r[4]=r[15])})},function(e){return t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,r[6]=t[0],t})},function(e){return t.nativeOperation(n("LSParseRecoveryCode_v2.nop"),r[1],r[4]==null?t.i64.to_string(r[6]):r[4],r[3]).then(function(e){var t;return t=e,r[7]=t[0],r[8]=t[1],t})},function(e){return r[9]=t.i64.of_float(Date.now()),r[10]=t.i64.random(),r[12]="Finishing execution. Execution time: ",r[13]=t.i64.to_string(t.i64.sub(r[9],r[0])),r[14]=" ms",r[11]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateRecoveryCodeStoredProcedure] ",r[11],r[12],r[11],r[13],r[11],r[14]].join("")),t.i64.eq(t.i64.mod_(r[10],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[15]=",",r[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateRecoveryCodeStoredProcedure",[r[12],r[15],r[13],r[15],r[14]].join(""),r[16],t.i64.cast([0,4]))):t.resolve()},function(e){var n;return n=[r[1],t.i64.cast([0,0]),r[7]],o[0]=n[0],o[1]=n[1],o[2]=n[2],n}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGenerateRecoveryCodeStoredProcedure",e.__tables__=["secure_encrypted_backups_generated_recovery_code","encrypted_backups"],a.exports=e}),null);
__d("LSGenerateRecoveryCodeStoredProcedure",["LSGenerateRecoveryCode","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSGenerateRecoveryCode"),a.virtualDeviceType);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("EBGenerateRecoveryCode",["Base64Utils","EBDeps","LSEncryptedBackupsOpStatus","LSFactory","LSGenerateRecoveryCodeStoredProcedure","LSIntEnum","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=await o("EBDeps").getDeps().getLSDB(),a=t.virtualDeviceType;return n.runInTransaction(function(e){return r("LSGenerateRecoveryCodeStoredProcedure")(r("LSFactory")(e),{virtualDeviceType:a})},"readwrite",void 0,void 0,i.id+":35").then(function(t){var n=t[0],a=t[1],i=t[2];return(e||(e=o("LSIntEnum"))).toNumber(a)!==r("LSEncryptedBackupsOpStatus").SUCCESS?o("WAResultOrError").makeError("sproc_failure"):o("WAResultOrError").makeResult({recoveryCode:n,virtualDeviceId:i!=null?o("Base64Utils").fromArrayBuffer(i):void 0})})}l.generateRecoveryCode=s}),98);
__d("EBGetContactEpochHead",["EBMinosSecureMailboxKeysForContact","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.rawContactId;if(t==null)return Promise.reject(o("WAResultOrError").makeError("invalid-arguments"));var n=await o("EBMinosSecureMailboxKeysForContact").getSecureMailboxKeysForContact(t);return n==null?o("WAResultOrError").makeResult():o("WAResultOrError").makeResult({epochHead:n.epoch_head,epochHeadCreationTime:n.epoch_head_creation_time})}l.getContactEpochHead=e}),98);
__d("EBGetCryptoWasm",["WAWasmModuleCache","bx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("bx").getURL(r("bx")("32099")),s=function(){return o("WAWasmModuleCache").loadWasmModule(e)};l.getCryptoWasm=s}),98);
__d("EBGetEBStateQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="23909871918604871"}),null);
__d("EBGetEBStateQuery.graphql",["EBGetEBStateQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},t={alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"has_seen_eb_auto_restore_notice",storageKey:null},e,{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},e,{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null}],storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"backup_state",storageKey:null}]}],storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EBGetEBStateQuery",selections:[{kind:"RequiredField",field:t,action:"LOG",path:"viewer"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"EBGetEBStateQuery",selections:[t]},params:{id:n("EBGetEBStateQuery_facebookRelayOperation"),metadata:{},name:"EBGetEBStateQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("MAWOneTimeCodeGating",["gkx","justknobx"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("gkx")("1910")&&r("justknobx")._("1601")}l.isOneTimeCodeEnabled=e}),98);
__d("EBGetEBState",["EBGetEBStateQuery.graphql","FBLogger","MAWOneTimeCodeGating","RelayHooks","WAResultOrError","XPlatRelayEnvironment","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e!==void 0?e:e=n("EBGetEBStateQuery.graphql");async function u(){try{var e,t,n,a,i,l,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k=await o("RelayHooks").fetchQuery(o("XPlatRelayEnvironment").getRelayEnvironment(),s,{}).toPromise().then(function(e){return e}),I=k==null||(e=k.viewer)==null?void 0:e.backup_state;if(I===1||I===0)return o("WAResultOrError").makeResult({backupStatus:I});var T=(t=k==null||(n=k.viewer)==null||(n=n.encrypted_backup)==null?void 0:n.virtual_devices)!=null?t:[],D=T.filter(function(e){return e.device_type==="HSM"}),x=T.filter(function(e){return e.device_type==="OFFLINE"});return o("WAResultOrError").makeResult({backupStatus:(k==null||(a=k.viewer)==null?void 0:a.backup_state)!=null?k.viewer.backup_state:0,ebState:{backupMetadata:{backupId:(i=k==null||(l=k.viewer)==null||(l=l.encrypted_backup)==null?void 0:l.id)!=null?i:"",creationTime:(u=k==null||(c=k.viewer)==null||(c=c.encrypted_backup)==null?void 0:c.backup_creation_time)!=null?u:0,deviceCreatedOn:(d=D[0].device_created_on)!=null?d:"",removalStatus:"",requiresHsmMigration:D[0].migration_status!=="DOES_NOT_REQUIRE_MIGRATION",virtualDeviceCreationTime:(m=(p=D[0])==null?void 0:p.creation_time)!=null?m:0,virtualDeviceId:(_=(f=D[0])==null?void 0:f.id)!=null?_:"",virtualDeviceType:(g=(h=D[0])==null?void 0:h.device_type)!=null?g:""},backupTenancy:(y=k==null||(C=k.viewer)==null||(C=C.encrypted_backup)==null?void 0:C.backup_tenancy)!=null?y:"PRODUCTION",hasOtcEligibleDevices:!!(o("MAWOneTimeCodeGating").isOneTimeCodeEnabled()&&(k==null||(b=k.viewer)==null||(b=b.encrypted_backup)==null?void 0:b.has_otc_eligible_devices)!==!1),hasSeenEbAutoRestoreNotice:(v=k==null||(S=k.viewer)==null||(S=S.encrypted_backup)==null?void 0:S.has_seen_eb_auto_restore_notice)!=null?v:!1,isPINCodeRegistered:((R=D[0])==null?void 0:R.id)!=null,isUserOptedOut:(L=k==null||(E=k.viewer)==null||(E=E.encrypted_backup)==null?void 0:E.is_user_opted_out)!=null?L:!1,offlineDevicesCount:x.length}})}catch(e){return r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Failed to check EB enabled"),o("WAResultOrError").makeResult({backupStatus:0})}}l.GetEbState=u}),98);
__d("EBGetLatestChatJids",["I64","MAWBridgeSafeActionsWorkerAndUI","ReQL","WAResultOrError","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=1e3;async function u(e,t){t===void 0&&(t=s);try{var n=c(e,t);return o("WAResultOrError").makeResult(await n)}catch(e){return o("WAResultOrError").makeError(r("getErrorSafe")(e))}}async function c(t,n){n===void 0&&(n=s);var r=await Promise.all([o("MAWBridgeSafeActionsWorkerAndUI").sendAndReceiveBackendWorkerAndUIShared("getLatestChatJids",{count:n}),await t.runInTransaction(function(t){return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.mi_act_mapping_table).map(function(t){var n=t.jid;return(e||(e=o("I64"))).to_string(n)}))},"readonly",void 0,void 0,i.id+":54")]),a=r[0],l=r[1],u=[];if(l.length>0){var c=new Set(l);a.forEach(function(e){var t=e.split("@")[0];c.has(t)&&u.push(e)})}return u}l.getLatestChatJids=u}),98);
__d("EBGetMessageKeys",["EBMinosDb","FBLogger","WAResultOrError","WebMps","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=async function(t,n){var e=await o("EBMinosDb").getEBMinosDb(),r=await e.runInTransaction(["secure_minos_message_epoch_heads"],"readonly",function(e){return e.stores.secure_minos_message_epoch_heads.readIndex("[thread_id+message_id]",[t,n])},"LoadNewMinosMessageEpochHead");return r.length===0?null:{epochHead:r[0].epoch_head}};async function u(t){var n=t.messageId,a=t.threadId;try{if(n==null||a==null)return o("WAResultOrError").makeError("invalid-arguments");var i=await o("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!0,strategy:"local-only"},debug:{purpose:"get-message-keys"},messageId:n,threadId:a}),l=await s(a,n);if(l==null)return o("WAResultOrError").makeError("no-epoch-head-found");if(i.success===!1)return o("WAResultOrError").makeError(i.error);var u=i.value;if(u==null)return o("WAResultOrError").makeError("no-message");var c=new Map;await Promise.all(Array.from(u.supplementalProtobufs).map(async function(e){var t=e[0],n=e[1],r=await s(a,n.messageId);if(r==null)return o("WAResultOrError").makeError("no-epoch-head-found");c.set(t,babelHelpers.extends({},n,{senderEpochHead:r.epochHead}))}));var d=babelHelpers.extends({},u.toplevelProtobuf,{senderEpochHead:l.epochHead});return o("WAResultOrError").makeResult(babelHelpers.extends({},u,{supplementalProtobufs:c,toplevelProtobuf:d}))}catch(t){throw r("FBLogger")("wmi_minos").catching(r("getErrorSafe")(t)).MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Runtime error in EBGetMessageKeys"]))),t}}l.getMessageKeys=u}),98);
__d("EBMinosWasmOpenEpoch",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t,n=e.minosSignedEpoch,r=n.epochHead,a=n.epochPublicData,i=n.signatures;return o("WAResultOrError").makeResult({epochHead:(t=o("EBMinosTypes")).unsafeCastToEpochHead(r),epochPublicData:{epochNumber:t.unsafeCastToEpochNumber(a.epochNumber),mailboxAuthPk:t.unsafeCastToMailboxAuthPK(a.mailboxAuthPk),mailboxEncryptionPk:t.unsafeCastToMailboxEncryptionPK(a.mailboxEncryptionPk),mailboxSigningPk:t.unsafeCastToMailboxSigningPK(a.mailboxSigningPk),previousEpochHead:a.previousEpochHead==null?null:o("EBMinosTypes").unsafeCastToEpochHead(a.previousEpochHead),userFbid:o("EBMinosTypes").unsafeCastToUserFbId(a.userFbid)},signatures:{prevSignature:i.prevSignature==null?null:o("EBMinosTypes").unsafeCastToEpochPrevSig(i.prevSignature),selfSignature:o("EBMinosTypes").unsafeCastToEpochSelfSig(i.selfSignature)}})}return async function(n){var t=n.epochNumber,r=n.exportRootKey,a=n.previousEpochHead,i=n.previousEpochNumber,l=n.previousExportRootKey,s=n.userFbid;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").MinosOpenEpochResultSpec,validateResult:e},{minosOpenEpoch:{epochNumber:t,exportRootKey:r,previousEpochHead:a,previousEpochNumber:i,previousExportRootKey:l,userFbid:s}})}}var s=e();l.openEpoch=s}),98);
__d("EBMinosWasmOpenInitialEpoch",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t,n=e.minosSignedEpoch,r=n.epochHead,a=n.epochPublicData,i=n.signatures;return o("WAResultOrError").makeResult({epochHead:(t=o("EBMinosTypes")).unsafeCastToEpochHead(r),epochPublicData:{epochNumber:t.unsafeCastToEpochNumber(a.epochNumber),mailboxAuthPk:t.unsafeCastToMailboxAuthPK(a.mailboxAuthPk),mailboxEncryptionPk:t.unsafeCastToMailboxEncryptionPK(a.mailboxEncryptionPk),mailboxSigningPk:t.unsafeCastToMailboxSigningPK(a.mailboxSigningPk),previousEpochHead:a.previousEpochHead==null?null:o("EBMinosTypes").unsafeCastToEpochHead(a.previousEpochHead),userFbid:o("EBMinosTypes").unsafeCastToUserFbId(a.userFbid)},signatures:{prevSignature:i.prevSignature==null?null:o("EBMinosTypes").unsafeCastToEpochPrevSig(i.prevSignature),selfSignature:o("EBMinosTypes").unsafeCastToEpochSelfSig(i.selfSignature)}})}return async function(n){var t=n.epochNumber,r=n.exportRootKey,a=n.userFbid;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").MinosOpenInitialEpochResultSpec,validateResult:e},{minosOpenInitialEpoch:{epochNumber:t,exportRootKey:r,userFbid:a}})}}var s=e();l.openInitialEpoch=s}),98);
__d("EBMinosCreateMinosEpochParams",["EBMinosLogger","EBMinosTypes","EBMinosWasmOpenEpoch","EBMinosWasmOpenInitialEpoch","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d;async function m(t){var n=t.epochAnonId,r=t.epochRootKeyBlob,a=t.previousEpochAnonId,i=t.previousEpochHead,l=t.previousEpochRootKeyBlob,m=t.qplFlow,p=t.rawUserFbid;o("EBMinosLogger").minosLogger.DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["start creating minos epoch params"])));var _=o("EBMinosTypes").unsafeCastToUserFbId(p),f=o("EBMinosTypes").unsafeCastToBase64StringIntToEpochNumber(n),g=o("EBMinosTypes").unsafeCastToExportRootKey(r),h=a==null?null:o("EBMinosTypes").unsafeCastToBase64StringIntToEpochNumber(a),y=l==null?null:o("EBMinosTypes").unsafeCastToExportRootKey(l);if(h==null||y==null||i==null){m.addPoint("open_initial_epoch_start",{bool:{isInitialEpoch:!0}});var C=await o("EBMinosWasmOpenInitialEpoch").openInitialEpoch({epochNumber:f,exportRootKey:g,userFbid:_});return C.success?(m.addPoint("open_initial_epoch_end"),o("EBMinosLogger").minosLogger.DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Created minos epoch params successfully for initial epoch"]))),o("WAResultOrError").makeResult({epochHead:C.value.epochHead,mailboxAuthPk:C.value.epochPublicData.mailboxAuthPk,mailboxEncryptionPk:C.value.epochPublicData.mailboxEncryptionPk,mailboxSigningPk:C.value.epochPublicData.mailboxSigningPk,previousEpochSignature:null,selfEpochSignature:C.value.signatures.selfSignature})):(o("EBMinosLogger").minosLogger.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to open epoch ",""])),C.error),m.addPoint("open_initial_epoch_fail"),o("WAResultOrError").makeError({errorName:"open-initial-epoch-failed",failReason:C.error}))}m.addPoint("open_epoch_start",{bool:{isInitialEpoch:!1}});var b=await o("EBMinosWasmOpenEpoch").openEpoch({epochNumber:f,exportRootKey:g,previousEpochHead:o("EBMinosTypes").unsafeCastToEpochHead(i),previousEpochNumber:h,previousExportRootKey:y,userFbid:_});return b.success?(m.addPoint("open_epoch_end"),o("EBMinosLogger").minosLogger.DEV(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Created minos epoch params successfully"]))),o("WAResultOrError").makeResult({epochHead:b.value.epochHead,mailboxAuthPk:b.value.epochPublicData.mailboxAuthPk,mailboxEncryptionPk:b.value.epochPublicData.mailboxEncryptionPk,mailboxSigningPk:b.value.epochPublicData.mailboxSigningPk,previousEpochSignature:b.value.signatures.prevSignature,selfEpochSignature:b.value.signatures.selfSignature})):(o("EBMinosLogger").minosLogger.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Failed to open epoch ",""])),b.error),m.addPoint("open_epoch_fail"),o("WAResultOrError").makeError({errorName:"open-epoch-failed",failReason:b.error}))}l.createMinosEpochParamsType=m}),98);
__d("LSCreateMinosEpochParams.nop",["EBMinosCheckWasmFeatureSupport","EBMinosCreateMinosEpochParams","EBMinosQplFlow","FBLogger","MAWCurrentUser","WAResultOrError","err","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s=async function(n,a,i,l,s,u,c){var t,d=await o("EBMinosCheckWasmFeatureSupport").checkWasmFeatureSupport();if(!(r("gkx")("20911")||r("gkx")("17219")))throw r("err")("createMinosEpochParamsType error: gk is off but still called");if(!d)throw r("err")("createMinosEpochParamsType error: wasm is not supported");var m=o("EBMinosQplFlow").startMinosCreateEpochParamsQpl(),p=await o("EBMinosCreateMinosEpochParams").createMinosEpochParamsType({epochAnonId:l,epochRootKeyBlob:i,previousEpochAnonId:u,previousEpochHead:c,previousEpochRootKeyBlob:s,qplFlow:m,rawUserFbid:o("MAWCurrentUser").getID()}).catch(function(t){var n=r("FBLogger")("minos"),a=r("getErrorSafe")(t);return n.catching(a).MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["createMinosEpochParamsType runtime-error"]))),o("WAResultOrError").makeError({errorName:"runtime-error",failReason:a.message})});if(!p.success){var _;throw m.endFailWithError(p.error.errorName,p.error.failReason),r("err")("createMinosEpochParamsType error: "+p.error.errorName+" "+((_=p.error.failReason)!=null?_:""))}return m.endSuccess(),[p.value.mailboxEncryptionPk,p.value.mailboxSigningPk,p.value.mailboxAuthPk,p.value.epochHead,p.value.selfEpochSignature,(t=p.value.previousEpochSignature)!=null?t:void 0]};s.__nop_name__="LSCreateMinosEpochParamsType",l.default=s}),98);
__d("LSOcmfClientInit_v2.nop",["CryptoLogger","LSResult","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("ristretto255").__setRef("LSOcmfClientInit_v2.nop"),s=function(n,a){return e.load().then(function(e){return r("LSResult")(e.scalar.getRandom().buffer)}).catch(function(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("ocmf_client_init_v2"),e).mustfix("Failed to init OCMF client."),e})};s.__nop_name__="LSOcmfClientInit_v2",l.default=s}),98);
__d("LSRandom.nop",["CryptoLogger","I64","LSMaxInt32","LSResult","Promise","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(a,i,l){var t=o("CryptoLogger").CryptoLogger("ope_encrypt");if((s||(s=o("I64"))).gt(l,r("LSMaxInt32")))return t.mustfix("numBytes '"+String(l)+"' too large. Returning an empty array"),(e||(e=n("Promise"))).resolve(r("LSResult")(new Uint8Array(0).buffer));for(var u=(s||(s=o("I64"))).to_int32(l),c=new Uint8Array(u),d=65536,m=0;m<u;m+=d){var p=c.subarray(m,m+Math.min(u-m,d));o("XPlatReactCrypto").getRandomValues(p)}return(e||(e=n("Promise"))).resolve(r("LSResult")(c.buffer))};u.__nop_name__="LSRandom",l.default=u}),98);
__d("LSGenerateInitialDeviceSetupPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateAuthKeyPair.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientInit_v2.nop","LSOcmfClientMap.nop","LSRandom.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][generateInitialDeviceSetupPayload] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[33]=new t.Map,r[33].set("error_msg","Expected a nonempty query result"),r[33].set("code",t.i64.cast([0,3])),r[33].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[34]=t.createArray(),r[35]=(r[34].push(r[33]),r[34]),o=[void 0,r[34]],r[2]=o[0],r[3]=o[1]):(n=l.item,r[33]=new t.Map,r[33].set("backup_id",n.backupId),r[33].set("device_public_key_blob",n.devicePublicKeyBlob),r[33].set("device_private_key_blob",n.devicePrivateKeyBlob),r[33].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[33].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[33].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[33].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[33].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[33].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[33].set("orf_client_state_v2_blob",void 0),r[33].set("orf_v2_authority_level",void 0),r[33].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[33].set("device_id",n.deviceId),r[33].set("backup_tenancy",n.backupTenancy),r[33].set("encryption_version",n.encryptionVersion),r[33].set("revision_version",n.revisionVersion),r[33].set("initialize_restore_result",void 0),r[33].set("device_creation_timestamp_sec",void 0),r[33].set("authority_level",n.authorityLevel),a=[r[33],void 0],r[2]=a[0],r[3]=a[1])})},function(e){return r[5]=new t.Map,r[5].set("value",r[2]),r[5].set("errors",r[3]),r[6]=r[5].get("value"),r[6]!==void 0?t.sequence([function(e){return r[33]=r[6].get("backup_id"),r[34]=r[6].get("device_public_key_blob"),r[35]=r[6].get("device_private_key_blob"),r[36]=r[6].get("epoch_storage_public_key_blob"),r[37]=r[6].get("epoch_storage_private_key_blob"),r[38]=r[6].get("epoch_auth_public_key_blob"),r[39]=r[6].get("epoch_auth_private_key_blob"),r[40]=r[6].get("mailbox_root_key_blob"),r[41]=r[6].get("ocmf_client_state_blob"),r[42]=r[6].get("orf_client_state_v2_blob"),r[43]=r[6].get("orf_v2_authority_level"),r[44]=r[6].get("oblivious_validation_token_blob"),r[45]=r[6].get("device_id"),r[46]=r[6].get("backup_tenancy"),r[47]=r[6].get("encryption_version"),r[48]=r[6].get("revision_version"),r[49]=r[6].get("initialize_restore_result"),r[50]=r[6].get("device_creation_timestamp_sec"),r[51]=r[6].get("authority_level"),t.i64.neq(r[45],void 0)?t.sequence([function(e){return r[70]=void 0,t.i64.neq(r[70],void 0)?t.resolve(r[71]=r[70]):t.sequence([function(e){return r[74]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[75]=t[0],t})},function(e){return r[75]&&(r[84]=(r[74].push(t.i64.cast([0,0])),r[74])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[76]=t[0],t})},function(e){return r[76]&&(r[84]=(r[74].push(t.i64.cast([0,2])),r[74])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[77]=t[0],t})},function(e){return r[77]&&(r[84]=(r[74].push(t.i64.cast([0,3])),r[74])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[78]=t[0],t})},function(e){return r[78]&&(r[84]=(r[74].push(t.i64.cast([0,4])),r[74])),r[79]=t.createArray(),r[80]=t.i64.of_int32(r[74].length),t.i64.gt(r[80],t.i64.cast([0,0]))?t.loopAsync(r[80],function(e){return r[84]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[74],r[84]).then(function(e){var t;return t=e,r[85]=t[0],r[86]=t[1],t})},function(e){return r[87]=(r[79].push(r[85]),r[79])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[84]=t.createArray(),r[85]=t.i64.of_int32(r[79].length),t.i64.gt(r[85],t.i64.cast([0,0]))?t.loopAsync(r[85],function(e){return r[87]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[79],r[87]).then(function(e){var t;return t=e,r[88]=t[0],r[89]=t[1],t})},function(e){return r[90]=(r[84].push(t.i64.to_string(r[88])),r[84])}])}):t.resolve()},function(e){return r[86]=r[84].join(","),r[81]=r[86]}])},function(e){return r[79].some(function(e){return t.i64.eq(r[47],e)})?r[82]=r[47]:r[82]=void 0,t.i64.neq(r[82],void 0)?r[83]=r[82]:r[83]=void 0,r[71]=r[83]}])},function(e){var n;return t.i64.neq(r[71],void 0)?r[72]=r[71]:r[72]=t.i64.cast([0,0]),t.i64.neq(r[46],void 0)?r[73]=r[46]:r[73]=t.i64.cast([0,1]),n=[r[33],r[45],r[40],r[41],void 0,void 0,r[72],r[73],r[38],r[39],r[34],r[35],r[36],r[37],r[44],r[51],void 0,void 0],r[52]=n[0],r[53]=n[1],r[54]=n[2],r[55]=n[3],r[56]=n[4],r[57]=n[5],r[58]=n[6],r[59]=n[7],r[60]=n[8],r[61]=n[9],r[62]=n[10],r[63]=n[11],r[64]=n[12],r[65]=n[13],r[66]=n[14],r[67]=n[15],r[68]=n[16],r[69]=n[17]}]):t.sequence([function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})},function(e){return r[70]=t.i64.random(),r[71]=t.i64.random(),t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[72]=t[0],r[73]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[74]=t[0],r[75]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateAuthKeyPair.nop")).then(function(e){var t;return t=e,r[76]=t[0],r[77]=t[1],t})},function(e){return t.nativeOperation(n("LSRandom.nop"),t.i64.cast([0,32])).then(function(e){var t;return t=e,r[78]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientInit_v2.nop")).then(function(e){var t;return t=e,r[79]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientInit_v2.nop")).then(function(e){var t;return t=e,r[80]=t[0],t})},function(e){return t.nativeOperation(n("LSRandom.nop"),t.i64.cast([0,32])).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[82]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[83]=t[0],t})},function(e){return r[83]&&(r[109]=(r[82].push(t.i64.cast([0,0])),r[82])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[84]=t[0],t})},function(e){return r[84]&&(r[109]=(r[82].push(t.i64.cast([0,2])),r[82])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[85]=t[0],t})},function(e){return r[85]&&(r[109]=(r[82].push(t.i64.cast([0,3])),r[82])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[86]=t[0],t})},function(e){return r[86]&&(r[109]=(r[82].push(t.i64.cast([0,4])),r[82])),r[87]=t.i64.of_int32(r[82].length),t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[82],t.i64.sub(r[87],t.i64.cast([0,1]))).then(function(e){var t;return t=e,r[88]=t[0],r[89]=t[1],t})},function(e){return t.forEach(t.filter(t.db.table(168).fetch([[[r[70]]]]),function(e){return t.i64.eq(e.backupId,r[70])&&t.i64.lt(e.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(e){return t.db.table(168).add({backupId:r[70],deviceId:r[71],devicePublicKeyBlob:r[73],devicePrivateKeyBlob:r[72],epochStoragePublicKeyBlob:r[75],epochStoragePrivateKeyBlob:r[74],epochAuthPublicKeyBlob:r[77],epochAuthPrivateKeyBlob:r[76],mailboxRootKeyBlob:r[78],ocmfClientStateBlob:r[79],obliviousValidationTokenBlob:r[81],authorityLevel:t.i64.cast([0,20]),encryptionVersion:r[88],revisionVersion:t.i64.cast([0,1]),backupTenancy:t.i64.cast([0,1])})},function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,20]))}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,o){var a,i=e.done,l=e.value;return i?(a=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,20]),void 0,void 0],r[90]=a[0],r[91]=a[1],r[92]=a[2],r[93]=a[3],r[94]=a[4],r[95]=a[5],r[96]=a[6],r[97]=a[7],r[98]=a[8],r[99]=a[9],r[100]=a[10],r[101]=a[11],r[102]=a[12],r[103]=a[13],r[104]=a[14],r[105]=a[15],r[106]=a[16],r[107]=a[17],a):(o=l.item,t.sequence([function(e){return r[114]=o.backupTenancy,r[113]=o.encryptionVersion,r[109]=void 0,t.i64.neq(r[109],void 0)?t.resolve(r[110]=r[109]):t.sequence([function(e){return r[115]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[116]=t[0],t})},function(e){return r[116]&&(r[125]=(r[115].push(t.i64.cast([0,0])),r[115])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[117]=t[0],t})},function(e){return r[117]&&(r[125]=(r[115].push(t.i64.cast([0,2])),r[115])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[118]=t[0],t})},function(e){return r[118]&&(r[125]=(r[115].push(t.i64.cast([0,3])),r[115])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[119]=t[0],t})},function(e){return r[119]&&(r[125]=(r[115].push(t.i64.cast([0,4])),r[115])),r[120]=t.createArray(),r[121]=t.i64.of_int32(r[115].length),t.i64.gt(r[121],t.i64.cast([0,0]))?t.loopAsync(r[121],function(e){return r[125]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[115],r[125]).then(function(e){var t;return t=e,r[126]=t[0],r[127]=t[1],t})},function(e){return r[128]=(r[120].push(r[126]),r[120])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[125]=t.createArray(),r[126]=t.i64.of_int32(r[120].length),t.i64.gt(r[126],t.i64.cast([0,0]))?t.loopAsync(r[126],function(e){return r[128]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[120],r[128]).then(function(e){var t;return t=e,r[129]=t[0],r[130]=t[1],t})},function(e){return r[131]=(r[125].push(t.i64.to_string(r[129])),r[125])}])}):t.resolve()},function(e){return r[127]=r[125].join(","),r[122]=r[127]}])},function(e){return r[120].some(function(e){return t.i64.eq(r[113],e)})?r[123]=r[113]:r[123]=void 0,t.i64.neq(r[123],void 0)?r[124]=r[123]:r[124]=void 0,r[110]=r[124]}])},function(e){var n;return t.i64.neq(r[110],void 0)?r[111]=r[110]:r[111]=t.i64.cast([0,0]),t.i64.neq(r[114],void 0)?r[112]=r[114]:r[112]=t.i64.cast([0,1]),n=[o.backupId,o.deviceId,o.mailboxRootKeyBlob,o.ocmfClientStateBlob,void 0,void 0,r[111],r[112],o.epochAuthPublicKeyBlob,o.epochAuthPrivateKeyBlob,o.devicePublicKeyBlob,o.devicePrivateKeyBlob,o.epochStoragePublicKeyBlob,o.epochStoragePrivateKeyBlob,o.obliviousValidationTokenBlob,o.authorityLevel,void 0,void 0],r[90]=n[0],r[91]=n[1],r[92]=n[2],r[93]=n[3],r[94]=n[4],r[95]=n[5],r[96]=n[6],r[97]=n[7],r[98]=n[8],r[99]=n[9],r[100]=n[10],r[101]=n[11],r[102]=n[12],r[103]=n[13],r[104]=n[14],r[105]=n[15],r[106]=n[16],r[107]=n[17]}]))})},function(e){var t;return t=[r[90],r[91],r[92],r[93],r[94],r[95],r[96],r[97],r[98],r[99],r[100],r[101],r[102],r[103],r[104],r[105],r[106],r[107]],r[52]=t[0],r[53]=t[1],r[54]=t[2],r[55]=t[3],r[56]=t[4],r[57]=t[5],r[58]=t[6],r[59]=t[7],r[60]=t[8],r[61]=t[9],r[62]=t[10],r[63]=t[11],r[64]=t[12],r[65]=t[13],r[66]=t[14],r[67]=t[15],r[68]=t[16],r[69]=t[17],t}])},function(e){var t;return t=[r[52],r[53],r[54],r[55],r[56],r[57],r[58],r[59],r[60],r[61],r[62],r[63],r[64],r[65],r[66],r[67],r[68],r[69]],r[7]=t[0],r[8]=t[1],r[9]=t[2],r[10]=t[3],r[11]=t[4],r[12]=t[5],r[13]=t[6],r[14]=t[7],r[15]=t[8],r[16]=t[9],r[17]=t[10],r[18]=t[11],r[19]=t[12],r[20]=t[13],r[21]=t[14],r[22]=t[15],r[23]=t[16],r[24]=t[17],t}]):t.sequence([function(e){return r[33]=r[5].get("errors"),r[34]=r[5].get("errors"),t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})},function(e){return r[35]=t.i64.random(),r[36]=t.i64.random(),t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[37]=t[0],r[38]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[39]=t[0],r[40]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateAuthKeyPair.nop")).then(function(e){var t;return t=e,r[41]=t[0],r[42]=t[1],t})},function(e){return t.nativeOperation(n("LSRandom.nop"),t.i64.cast([0,32])).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientInit_v2.nop")).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientInit_v2.nop")).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return t.nativeOperation(n("LSRandom.nop"),t.i64.cast([0,32])).then(function(e){var t;return t=e,r[46]=t[0],t})},function(e){return r[47]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return r[48]&&(r[74]=(r[47].push(t.i64.cast([0,0])),r[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[49]=t[0],t})},function(e){return r[49]&&(r[74]=(r[47].push(t.i64.cast([0,2])),r[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[50]=t[0],t})},function(e){return r[50]&&(r[74]=(r[47].push(t.i64.cast([0,3])),r[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[51]=t[0],t})},function(e){return r[51]&&(r[74]=(r[47].push(t.i64.cast([0,4])),r[47])),r[52]=t.i64.of_int32(r[47].length),t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[47],t.i64.sub(r[52],t.i64.cast([0,1]))).then(function(e){var t;return t=e,r[53]=t[0],r[54]=t[1],t})},function(e){return t.forEach(t.filter(t.db.table(168).fetch([[[r[35]]]]),function(e){return t.i64.eq(e.backupId,r[35])&&t.i64.lt(e.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(e){return t.db.table(168).add({backupId:r[35],deviceId:r[36],devicePublicKeyBlob:r[38],devicePrivateKeyBlob:r[37],epochStoragePublicKeyBlob:r[40],epochStoragePrivateKeyBlob:r[39],epochAuthPublicKeyBlob:r[42],epochAuthPrivateKeyBlob:r[41],mailboxRootKeyBlob:r[43],ocmfClientStateBlob:r[44],obliviousValidationTokenBlob:r[46],authorityLevel:t.i64.cast([0,20]),encryptionVersion:r[53],revisionVersion:t.i64.cast([0,1]),backupTenancy:t.i64.cast([0,1])})},function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,20]))}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,o){var a,i=e.done,l=e.value;return i?(a=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,20]),void 0,void 0],r[55]=a[0],r[56]=a[1],r[57]=a[2],r[58]=a[3],r[59]=a[4],r[60]=a[5],r[61]=a[6],r[62]=a[7],r[63]=a[8],r[64]=a[9],r[65]=a[10],r[66]=a[11],r[67]=a[12],r[68]=a[13],r[69]=a[14],r[70]=a[15],r[71]=a[16],r[72]=a[17],a):(o=l.item,t.sequence([function(e){return r[79]=o.backupTenancy,r[78]=o.encryptionVersion,r[74]=void 0,t.i64.neq(r[74],void 0)?t.resolve(r[75]=r[74]):t.sequence([function(e){return r[80]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[81]&&(r[90]=(r[80].push(t.i64.cast([0,0])),r[80])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return r[82]&&(r[90]=(r[80].push(t.i64.cast([0,2])),r[80])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[83]=t[0],t})},function(e){return r[83]&&(r[90]=(r[80].push(t.i64.cast([0,3])),r[80])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[84]=t[0],t})},function(e){return r[84]&&(r[90]=(r[80].push(t.i64.cast([0,4])),r[80])),r[85]=t.createArray(),r[86]=t.i64.of_int32(r[80].length),t.i64.gt(r[86],t.i64.cast([0,0]))?t.loopAsync(r[86],function(e){return r[90]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[80],r[90]).then(function(e){var t;return t=e,r[91]=t[0],r[92]=t[1],t})},function(e){return r[93]=(r[85].push(r[91]),r[85])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[90]=t.createArray(),r[91]=t.i64.of_int32(r[85].length),t.i64.gt(r[91],t.i64.cast([0,0]))?t.loopAsync(r[91],function(e){return r[93]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[85],r[93]).then(function(e){var t;return t=e,r[94]=t[0],r[95]=t[1],t})},function(e){return r[96]=(r[90].push(t.i64.to_string(r[94])),r[90])}])}):t.resolve()},function(e){return r[92]=r[90].join(","),r[87]=r[92]}])},function(e){return r[85].some(function(e){return t.i64.eq(r[78],e)})?r[88]=r[78]:r[88]=void 0,t.i64.neq(r[88],void 0)?r[89]=r[88]:r[89]=void 0,r[75]=r[89]}])},function(e){var n;return t.i64.neq(r[75],void 0)?r[76]=r[75]:r[76]=t.i64.cast([0,0]),t.i64.neq(r[79],void 0)?r[77]=r[79]:r[77]=t.i64.cast([0,1]),n=[o.backupId,o.deviceId,o.mailboxRootKeyBlob,o.ocmfClientStateBlob,void 0,void 0,r[76],r[77],o.epochAuthPublicKeyBlob,o.epochAuthPrivateKeyBlob,o.devicePublicKeyBlob,o.devicePrivateKeyBlob,o.epochStoragePublicKeyBlob,o.epochStoragePrivateKeyBlob,o.obliviousValidationTokenBlob,o.authorityLevel,void 0,void 0],r[55]=n[0],r[56]=n[1],r[57]=n[2],r[58]=n[3],r[59]=n[4],r[60]=n[5],r[61]=n[6],r[62]=n[7],r[63]=n[8],r[64]=n[9],r[65]=n[10],r[66]=n[11],r[67]=n[12],r[68]=n[13],r[69]=n[14],r[70]=n[15],r[71]=n[16],r[72]=n[17]}]))})},function(e){var t;return t=[r[55],r[56],r[57],r[58],r[59],r[60],r[61],r[62],r[63],r[64],r[65],r[66],r[67],r[68],r[69],r[70],r[71],r[72]],r[7]=t[0],r[8]=t[1],r[9]=t[2],r[10]=t[3],r[11]=t[4],r[12]=t[5],r[13]=t[6],r[14]=t[7],r[15]=t[8],r[16]=t[9],r[17]=t[10],r[18]=t[11],r[19]=t[12],r[20]=t[13],r[21]=t[14],r[22]=t[15],r[23]=t[16],r[24]=t[17],t}])},function(o){var a;return t.i64.neq(r[7],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[18],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[17],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[19],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[15],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[10],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[9],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[18],t.blob("MA=="),r[19]).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[18],t.blob("MQ=="),r[15]).then(function(e){var t;return t=e,r[46]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),t.i64.to_string(r[7])).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWFpbGJveF9pZF9zY29wZQ=="),r[47]).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[10],r[48]).then(function(e){var t;return t=e,r[49]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[49]).then(function(e){var t;return t=e,r[50]=t[0],t})},function(n){var o;return r[51]=new t.Map,r[51].set("optimistic_backup_id",r[7]),r[51].set("device_private_key",r[18]),r[51].set("device_public_key",r[17]),r[51].set("epoch_storage_public_key",r[19]),r[51].set("epoch_storage_public_key_sig",r[45]==null?t.blob("bnVsbA=="):r[45]),r[51].set("epoch_auth_public_key",r[15]),r[51].set("epoch_auth_public_key_sig",r[46]==null?t.blob("bnVsbA=="):r[46]),r[51].set("ocmf_client_state",r[10]),r[51].set("mailbox_partial_id",r[50]==null?"":r[50]),r[51].set("mailbox_root_key",r[9]),r[51].set("device_registration_id",e[0]),r[51].set("orf_client_state_v2",void 0),o=[r[51],void 0],r[43]=o[0],r[44]=o[1]}]):t.resolve((r[45]=new t.Map,r[45].set("error_code",t.i64.cast([0,9])),r[45].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[45].set("error_message",""),a=[void 0,r[45]],r[43]=a[0],r[44]=a[1]))},function(e){var t;return t=[r[43],r[44]],r[41]=t[0],r[42]=t[1],t}]):t.resolve((r[43]=new t.Map,r[43].set("error_code",t.i64.cast([0,9])),r[43].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[43].set("error_message",""),a=[void 0,r[43]],r[41]=a[0],r[42]=a[1]))},function(e){var t;return t=[r[41],r[42]],r[39]=t[0],r[40]=t[1],t}]):t.resolve((r[41]=new t.Map,r[41].set("error_code",t.i64.cast([0,9])),r[41].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[41].set("error_message",""),a=[void 0,r[41]],r[39]=a[0],r[40]=a[1]))},function(e){var t;return t=[r[39],r[40]],r[37]=t[0],r[38]=t[1],t}]):t.resolve((r[39]=new t.Map,r[39].set("error_code",t.i64.cast([0,9])),r[39].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[39].set("error_message",""),a=[void 0,r[39]],r[37]=a[0],r[38]=a[1]))},function(e){var t;return t=[r[37],r[38]],r[35]=t[0],r[36]=t[1],t}]):t.resolve((r[37]=new t.Map,r[37].set("error_code",t.i64.cast([0,9])),r[37].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[37].set("error_message",""),a=[void 0,r[37]],r[35]=a[0],r[36]=a[1]))},function(e){var t;return t=[r[35],r[36]],r[33]=t[0],r[34]=t[1],t}]):t.resolve((r[35]=new t.Map,r[35].set("error_code",t.i64.cast([0,9])),r[35].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[35].set("error_message",""),a=[void 0,r[35]],r[33]=a[0],r[34]=a[1]))},function(e){var t;return t=[r[33],r[34]],r[25]=t[0],r[26]=t[1],t}]):t.resolve((r[33]=new t.Map,r[33].set("error_code",t.i64.cast([0,9])),r[33].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[33].set("error_message",""),a=[void 0,r[33]],r[25]=a[0],r[26]=a[1]))},function(e){return r[27]=t.i64.of_float(Date.now()),r[28]=t.i64.random(),r[30]="Finishing execution. Execution time: ",r[31]=t.i64.to_string(t.i64.sub(r[27],r[0])),r[32]=" ms",r[29]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][generateInitialDeviceSetupPayload] ",r[29],r[30],r[29],r[31],r[29],r[32]].join("")),t.i64.eq(t.i64.mod_(r[28],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[33]=",",r[34]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"generateInitialDeviceSetupPayload",[r[30],r[33],r[31],r[33],r[32]].join(""),r[34],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[25],r[26]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSCreateSymmetricEncryptionSecretKey.nop",["CryptoLogger","LSResult","Promise","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i){return(e||(e=n("Promise"))).resolve(r("LSResult")(o("XPlatReactCrypto").getRandomValues(new Uint8Array(32)).buffer)).catch(function(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("create_symmetric_encryption_secret_key"),e).mustfix("Creation of symmetric encryption secret key failed"),e})};s.__nop_name__="LSCreateSymmetricEncryptionSecretKey",l.default=s}),98);
__d("LSGetNextEpochAnonId.nop",["CryptoLogger","LSCryptoUtils","LSResult","Promise","XPlatReactTextDecoder"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i,l){var t=o("LSCryptoUtils").strToBuf("0"),s;if(l!=null){var u=l;if(u.byteLength===0)s=t;else{var c=new(o("XPlatReactTextDecoder")).TextDecoder,d=c.decode(u),m=Number.parseInt(d,10),p=m+1;s=o("LSCryptoUtils").strToBuf(String(p))}}else s=t;return(e||(e=n("Promise"))).resolve(r("LSResult")(s)).catch(function(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("get_next_epoch_anonid"),e).mustfix("Getting next epoch anon id failed"),e})};s.__nop_name__="LSGetNextEpochAnonId",l.default=s}),98);
__d("LSStoreEpoch",["LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(r){return t.sequence([function(r){return n[1]="Storing newly derived epoch ",n[2]=t.blobs.to_string(e[2]),n[3]=" authority_level:",n[4]=t.i64.to_string(e[5]),n[5]=" status:",n[6]=t.i64.to_string(e[4]),n[0]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsStoreEpochStoredProcedure] ",n[0],n[1],n[0],n[2],n[0],n[3],n[0],n[4],n[0],n[5],n[0],n[6]].join("")),t.resolve()},function(n){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsStoreEpochStoredProcedure] Storing epoch in epochs table (regular execution)"),t.filter(t.db.table(169).fetch([[[e[0]]]]),function(n){return t.i64.eq(n.epochId,e[0])&&t.i64.gt(n.authorityLevel,e[5])}).next().then(function(n){var r=n.done,o=n.value;return r?t.db.table(169).put({epochId:e[0],backupId:e[1],epochAnonIdBlob:e[2],epochRootKeyBlob:e[3],epochStatus:e[4],epochHead:e[7],authorityLevel:e[5]}):0})}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSEncryptedBackupsStoreEpochStoredProcedure",e.__tables__=["secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSGenerateInitialEpochSetupPayload",["LSCreateMinosEpochParams.nop","LSCreateSymmetricEncryptionSecretKey.nop","LSGetNextEpochAnonId.nop","LSLogMebClientEvent.nop","LSStoreEpoch","gkx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(a){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][generateInitialEpochSetupPayload] Beginning execution."),o[1]=t.i64.of_float(Date.now()),t.filter(t.db.table(169).fetch(),function(e){return t.i64.eq(e.epochStatus,t.i64.cast([0,1]))&&t.i64.eq(e.authorityLevel,t.i64.cast([0,20]))}).next().then(function(a,i){var l,s=a.done,u=a.value;return s?t.sequence([function(e){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure] Generating new initial epoch."),t.nativeOperation(n("LSGetNextEpochAnonId.nop"),void 0).then(function(e){var t;return t=e,o[16]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSymmetricEncryptionSecretKey.nop")).then(function(e){var t;return t=e,o[17]=t[0],t})},function(e){return r("gkx")("11690")&&r("gkx")("16269")?t.sequence([function(e){return t.nativeOperation(n("LSCreateMinosEpochParams.nop"),o[17],o[16],void 0,void 0,void 0).then(function(e){var t;return t=e,o[20]=t[0],o[21]=t[1],o[22]=t[2],o[23]=t[3],o[24]=t[4],o[25]=t[5],t})},function(e){return o[18]=o[23]}]):t.resolve(o[18]=void 0)},function(r){return o[19]=t.i64.random(),t.storedProcedure(n("LSStoreEpoch"),o[19],e[0],o[16],o[17],t.i64.cast([0,1]),t.i64.cast([0,20]),!1,o[18])},function(e){var t;return t=[o[19],o[16],o[17],void 0,void 0,o[18]],o[2]=t[0],o[3]=t[1],o[4]=t[2],o[5]=t[3],o[6]=t[4],o[7]=t[5],t}]):(i=u.item,(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure] Using local optimistic initial epoch."),l=[i.epochId,i.epochAnonIdBlob,i.epochRootKeyBlob,void 0,void 0,i.epochHead],o[2]=l[0],o[3]=l[1],o[4]=l[2],o[5]=l[3],o[6]=l[4],o[7]=l[5])})},function(e){return o[9]=new t.Map,o[9].set("optimistic_epoch_id",o[2]),o[9].set("epoch_anon_id",o[3]),o[9].set("epoch_root_key",o[4]),o[10]=t.i64.of_float(Date.now()),o[11]=t.i64.random(),o[13]="Finishing execution. Execution time: ",o[14]=t.i64.to_string(t.i64.sub(o[10],o[0])),o[15]=" ms",o[12]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][generateInitialEpochSetupPayload] ",o[12],o[13],o[12],o[14],o[12],o[15]].join("")),t.i64.eq(t.i64.mod_(o[11],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[16]=",",o[17]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"generateInitialEpochSetupPayload",[o[13],o[16],o[14],o[16],o[15]].join(""),o[17],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[o[9],void 0],a[0]=t[0],a[1]=t[1],t}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure",e.__tables__=["secure_encrypted_backups_epochs"];var s=e;l.default=s}),98);
__d("LSGetOpenEpochKeys",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSDeleteBackupOnClient","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Beginning execution."),r[11]="Querying latest epoch keys with authority level: ",e[0]?r[1]="OPTIMISTIC":r[1]="AUTHORITATIVE",r[2]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",r[2],r[11],r[2],r[1]].join("")),t.resolve()},function(o){return e[0]?r[3]="OPTIMISTIC":r[3]="AUTHORITATIVE",t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return r[16]?r[17]=!0:r[17]=!1,r[17]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[19]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[19]].join("")),r[18]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[19],r[18],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return r[16]?r[17]=!0:r[17]=!1,r[17]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[19]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[19]].join("")),r[18]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[19],r[18],t.i64.cast([0,3]))):t.resolve()}])},function(n){return r[4]=t.createArray(),t.forEach(t.filter(t.db.table(169).fetch(),function(n){return e[0]||t.i64.eq(n.authorityLevel,t.i64.cast([0,80]))}),function(e){var n=e.item;return r[16]=(r[4].push(t.blobs.to_string(n.epochAnonIdBlob)),r[4])})},function(e){return r[5]=t.i64.of_int32(r[4].length),t.i64.gt(r[5],t.i64.cast([0,0]))?t.sequence([function(e){return r[16]=t.i64.of_int32(r[4].length),t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[21]=t[0],t})},function(e){return r[21]?r[22]=!0:r[22]=!1,r[22]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[24]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[24]].join("")),r[23]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[24],r[23],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[4],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[17]=t[0],r[18]=t[1],t})},function(e){return r[19]=r[17],r[20]=t.i64.of_int32(r[4].length),t.i64.gt(r[20],t.i64.cast([0,0]))?t.loopAsync(r[20],function(e){return r[21]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[4],r[21]).then(function(e){var t;return t=e,r[22]=t[0],r[23]=t[1],t})},function(e){return t.i64.eq([0,r[19].length],[0,r[22].length])?(r[19]===r[22]?r[25]=r[19]:(r[19]>r[22]?r[26]=r[19]:r[26]=r[22],r[25]=r[26]),r[24]=r[25]):(t.i64.gt([0,r[19].length],[0,r[22].length])?r[25]=r[19]:r[25]=r[22],r[24]=r[25]),r[19]=r[24]}])}):t.resolve()},function(e){return r[6]=r[19]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Epoch anon ID list is empty."),r[17]="Epoch anon ID list is empty.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ","",r[17]].join("")),r[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",r[17],r[16],t.i64.cast([0,3]))},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return r[18]?r[19]=!0:r[19]=!1,r[19]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[21]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[21]].join("")),r[20]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[21],r[20],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[6]=void 0}])},function(e){return r[6]!==void 0?t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return r[16]?r[17]=!0:r[17]=!1,r[17]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[19]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[19]].join("")),r[18]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[19],r[18],t.i64.cast([0,3]))):t.resolve()}]):t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return r[16]?r[17]=!0:r[17]=!1,r[17]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[19]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[19]].join("")),r[18]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[19],r[18],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[12]=t.blobs.of_string(r[6]),t.blobs.neq(r[12],void 0)?t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return r[18]?r[19]=!0:r[19]=!1,r[19]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[21]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[21]].join("")),r[20]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[21],r[20],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.filter(t.db.table(169).fetch(),function(e){return t.blobs.eq(e.epochAnonIdBlob,r[12])}).next().then(function(e,o){var a=e.done,i=e.value;return a?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Found a most recent epoch anon ID, but unable to locate it again in the table. This can really only happen if the tablesomehow changed in the middle of our transaction."),r[19]="Found a most recent epoch anon ID, but unable to locate it again in the table. This can really only happen if the tablesomehow changed in the middle of our transaction.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ","",r[19]].join("")),r[18]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",r[19],r[18],t.i64.cast([0,3]))},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[20]=t[0],t})},function(e){return r[20]?r[21]=!0:r[21]=!1,r[21]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[23]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[23]].join("")),r[22]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[23],r[22],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[16]=void 0}]):(o=i.item,t.sequence([function(e){return r[22]=o.epochAnonIdBlob,r[20]="Using latest epoch: ",r[21]=t.blobs.to_string(r[22]),r[18]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",r[18],r[20],r[18],r[21]].join("")),t.resolve()},function(e){return r[19]=new t.Map,r[19].set("epoch_id",o.epochId),r[19].set("epoch_root_key",o.epochRootKeyBlob),r[19].set("epoch_anon_id",r[22]),r[16]=r[19]}]))})},function(e){return r[7]=r[16]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] No epochs whatsoever on client! This should absolutely never happen. Deleting backup from client."),r[17]="No epochs whatsoever on client! This should absolutely never happen. Deleting backup from client.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ","",r[17]].join("")),r[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",r[17],r[16],t.i64.cast([0,3]))},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return r[18]?r[19]=!0:r[19]=!1,r[19]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[21]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[21]].join("")),r[20]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[21],r[20],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.storedProcedure(n("LSDeleteBackupOnClient"),void 0,"get_open_epoch_keys",!0,void 0,"Attempted to fetch epoch keys when there are no epochs on the client.",!1)},function(e){return r[7]=void 0}])},function(e){return r[8]=t.i64.of_float(Date.now()),r[9]=t.i64.random(),r[13]="Finishing execution. Execution time: ",r[14]=t.i64.to_string(t.i64.sub(r[8],r[0])),r[15]=" ms",r[10]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",r[10],r[13],r[10],r[14],r[10],r[15]].join("")),t.i64.eq(t.i64.mod_(r[9],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[16]=",",r[17]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",[r[13],r[16],r[14],r[16],r[15]].join(""),r[17],t.i64.cast([0,4]))):t.resolve()},function(e){return o[0]=r[7]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",e.__tables__=["secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSHandleCreateVirtualDeviceFailure",["LSAppendDataTraceAddon","LSDeleteBackupOnClient","LSFlushDataTrace.nop","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] Beginning execution."),t.sequence([function(r){return e[2]!==void 0?t.storedProcedure(n("LSAppendDataTraceAddon"),e[2],t.i64.cast([0,1412]),t.i64.cast([0,2]),void 0,void 0):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[7]=t[0],t})},function(e){return r[7]?r[8]=!0:r[8]=!1,r[8]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[10]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[10]].join("")),r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[10],r[9],t.i64.cast([0,3]))):t.resolve()}])},function(o){return e[1]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] Failure when creating virtual device, deleting backup"),r[8]="Failure when creating virtual device, deleting backup",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] ","",r[8]].join("")),r[7]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure",r[8],r[7],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSDeleteBackupOnClient"),e[0],void 0,!1,e[2],void 0,!1)}]):t.sequence([function(o){return r[7]="Failure when creating virtual device",r[7]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] ","",r[7]].join("")),r[8]=t.createArray(),e[2]!==void 0&&(r[9]=(r[8].push(e[2]),r[8])),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure",r[7],r[8],t.i64.cast([0,3]))):t.resolve()},function(e){return t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,3])})}])},function(o){return t.sequence([function(r){return e[2]!==void 0?t.nativeOperation(n("LSFlushDataTrace.nop"),e[2]):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[7]=t[0],t})},function(e){return r[7]?r[8]=!0:r[8]=!1,r[8]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[10]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[10]].join("")),r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[10],r[9],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[1]=t.i64.of_float(Date.now()),r[2]=t.i64.random(),r[4]="Finishing execution. Execution time: ",r[5]=t.i64.to_string(t.i64.sub(r[1],r[0])),r[6]=" ms",r[3]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] ",r[3],r[4],r[3],r[5],r[3],r[6]].join("")),t.i64.eq(t.i64.mod_(r[2],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[7]=",",r[8]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure",[r[4],r[7],r[5],r[7],r[6]].join(""),r[8],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure",e.__tables__=["secure_encrypted_backups_recovery_code_status"],a.exports=e}),null);
__d("LSGenerateInitialVirtualDeviceSetupPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSGetBlobFromString.nop","LSGetOpenEpochKeys","LSGetViewerFBID","LSHandleCreateVirtualDeviceFailure","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop","LSParseRecoveryCode_v2.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][generateInitialVirtualDeviceSetupPayload] Beginning execution."),r[1]=t.i64.of_float(Date.now()),e[1]!==void 0?t.sequence([function(o){return r[10]=e[1].get("recovery_code"),r[11]=e[1].get("virtual_device_type"),r[12]=e[1].get("cloud_service_account"),r[13]=e[1].get("hsm_pin_normalization_status"),r[14]=e[1].get("security_question_type"),r[15]=e[1].get("trusted_contact_id"),r[16]=t.createArray(),t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,r[17]=t[0],t})},function(e){return t.nativeOperation(n("LSParseRecoveryCode_v2.nop"),r[10],t.i64.to_string(r[17]),r[16]).then(function(e){var t;return t=e,r[18]=t[0],r[19]=t[1],t})},function(o){return t.blobs.neq(r[19],void 0)?t.sequence([function(o){return t.blobs.neq(r[18],void 0)?t.sequence([function(e){return t.storedProcedure(n("LSGetOpenEpochKeys"),!0).then(function(e){var t;return t=e,r[24]=t[0],t})},function(o){return r[24]!==void 0?t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[34]=new t.Map,r[34].set("error_msg","Expected a nonempty query result"),r[34].set("code",t.i64.cast([0,3])),r[34].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[35]=t.createArray(),r[36]=(r[35].push(r[34]),r[35]),o=[void 0,r[35]],r[27]=o[0],r[28]=o[1]):(n=l.item,r[34]=new t.Map,r[34].set("backup_id",n.backupId),r[34].set("device_public_key_blob",n.devicePublicKeyBlob),r[34].set("device_private_key_blob",n.devicePrivateKeyBlob),r[34].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[34].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[34].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[34].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[34].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[34].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[34].set("orf_client_state_v2_blob",void 0),r[34].set("orf_v2_authority_level",void 0),r[34].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[34].set("device_id",n.deviceId),r[34].set("backup_tenancy",n.backupTenancy),r[34].set("encryption_version",n.encryptionVersion),r[34].set("revision_version",n.revisionVersion),r[34].set("initialize_restore_result",void 0),r[34].set("device_creation_timestamp_sec",void 0),r[34].set("authority_level",n.authorityLevel),a=[r[34],void 0],r[27]=a[0],r[28]=a[1])})},function(e){var o;return r[30]=new t.Map,r[30].set("value",r[27]),r[30].set("errors",r[28]),r[31]=r[30].get("value"),r[31]!==void 0?t.sequence([function(e){var o;return r[34]=r[31].get("backup_id"),r[35]=r[31].get("device_public_key_blob"),r[36]=r[31].get("device_private_key_blob"),r[37]=r[31].get("epoch_storage_public_key_blob"),r[38]=r[31].get("epoch_storage_private_key_blob"),r[39]=r[31].get("epoch_auth_public_key_blob"),r[40]=r[31].get("epoch_auth_private_key_blob"),r[41]=r[31].get("mailbox_root_key_blob"),r[42]=r[31].get("ocmf_client_state_blob"),r[43]=r[31].get("orf_client_state_v2_blob"),r[44]=r[31].get("orf_v2_authority_level"),r[45]=r[31].get("oblivious_validation_token_blob"),r[46]=r[31].get("device_id"),r[47]=r[31].get("backup_tenancy"),r[48]=r[31].get("encryption_version"),r[49]=r[31].get("revision_version"),r[50]=r[31].get("initialize_restore_result"),r[51]=r[31].get("device_creation_timestamp_sec"),r[52]=r[31].get("authority_level"),t.i64.neq(r[46],void 0)?t.sequence([function(e){return r[55]=void 0,t.i64.neq(r[55],void 0)?t.resolve(r[56]=r[55]):t.sequence([function(e){return r[107]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[108]=t[0],t})},function(e){return r[108]&&(r[117]=(r[107].push(t.i64.cast([0,0])),r[107])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[109]=t[0],t})},function(e){return r[109]&&(r[117]=(r[107].push(t.i64.cast([0,2])),r[107])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[110]=t[0],t})},function(e){return r[110]&&(r[117]=(r[107].push(t.i64.cast([0,3])),r[107])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[111]=t[0],t})},function(e){return r[111]&&(r[117]=(r[107].push(t.i64.cast([0,4])),r[107])),r[112]=t.createArray(),r[113]=t.i64.of_int32(r[107].length),t.i64.gt(r[113],t.i64.cast([0,0]))?t.loopAsync(r[113],function(e){return r[117]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[107],r[117]).then(function(e){var t;return t=e,r[118]=t[0],r[119]=t[1],t})},function(e){return r[120]=(r[112].push(r[118]),r[112])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[117]=t.createArray(),r[118]=t.i64.of_int32(r[112].length),t.i64.gt(r[118],t.i64.cast([0,0]))?t.loopAsync(r[118],function(e){return r[120]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[112],r[120]).then(function(e){var t;return t=e,r[121]=t[0],r[122]=t[1],t})},function(e){return r[123]=(r[117].push(t.i64.to_string(r[121])),r[117])}])}):t.resolve()},function(e){return r[119]=r[117].join(","),r[114]=r[119]}])},function(e){return r[112].some(function(e){return t.i64.eq(r[48],e)})?r[115]=r[48]:r[115]=void 0,t.i64.neq(r[115],void 0)?r[116]=r[115]:r[116]=void 0,r[56]=r[116]}])},function(e){return t.i64.neq(r[56],void 0)?r[57]=r[56]:r[57]=t.i64.cast([0,0]),t.i64.neq(r[47],void 0)?r[58]=r[47]:r[58]=t.i64.cast([0,1]),t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[59]=t[0],r[60]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[61]=t[0],r[62]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[59],t.blob("MA=="),r[62]).then(function(e){var t;return t=e,r[63]=t[0],t})},function(e){return r[64]=r[24].get("epoch_anon_id"),r[65]=r[24].get("epoch_root_key"),r[66]=t.createArray(),r[107]=(r[66].push(t.i64.cast([0,32])),r[66]),t.nativeOperation(n("LSBase64Encode.nop"),r[64]).then(function(e){var t;return t=e,r[67]=t[0],t})},function(e){return r[67]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",r[67]].join("")),void 0,r[65],r[66]).then(function(e){var t;return t=e,r[107]=t[0],t})},function(e){return r[107]?r[108]=!1:r[108]=!0,r[108]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),r[111]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[111]].join("")),r[110]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[111],r[110],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[112]=t[0],t})},function(e){return r[109]=r[112]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[107],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[110]=t[0],r[111]=t[1],t})},function(e){return r[109]=r[110]}])},function(e){return r[68]=r[109]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),r[108]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[108],r[107],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[109]=t[0],t})},function(e){return r[68]=r[109]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),r[68],r[60]).then(function(e){var t;return t=e,r[69]=t[0],t})},function(e){return t.blobs.neq(r[69],void 0)?t.resolve(r[70]=r[69]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] device_epoch_hmac is null!"),r[108]="device_epoch_hmac is null!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[109]=t[0],t})},function(e){return r[70]=r[109]}])},function(e){return r[71]=r[24].get("epoch_root_key"),r[72]=t.createArray(),r[107]=(r[72].push(t.i64.cast([0,18])),r[72]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,r[71],r[72]).then(function(e){var t;return t=e,r[73]=t[0],t})},function(e){return r[73]!==void 0?t.sequence([function(e){return r[107]=t.i64.of_int32(r[73].length),t.i64.ge(r[107],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[73],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[109]=t[0],r[110]=t[1],t})},function(e){return r[108]=r[109]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[110]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[110]].join("")),r[109]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[110],r[109],t.i64.cast([0,3]))},function(e){return r[108]=void 0}])},function(e){return r[74]=r[108]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[108]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[108],r[107],t.i64.cast([0,3]))},function(e){return r[74]=void 0}])},function(e){return t.blobs.neq(r[74],void 0)?r[75]=!0:r[75]=!1,r[75]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),r[42]).then(function(e){var t;return t=e,r[76]=t[0],r[77]=t[1],t})},function(e){var o;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,r[107]=t[0],r[108]=t[1],t})},function(e){var t;return t=[r[76],r[77],r[107],r[108]],r[78]=t[0],r[79]=t[1],r[80]=t[2],r[81]=t[3],t}]):t.resolve((o=[r[76],r[77],void 0,void 0],r[78]=o[0],r[79]=o[1],r[80]=o[2],r[81]=o[3],o))},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[59]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6dmlydHVhbF9kZXZpY2VfcHJpdmF0ZV9rZXk="),r[82]==null?"":r[82]).then(function(e){var t;return t=e,r[83]=t[0],t})},function(e){return r[83]!==void 0?r[84]=r[83]:r[84]="",r[84]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_device_private_key is empty!"),r[108]="encrypted_device_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[61]).then(function(e){var t;return t=e,r[85]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),r[85]==null?"":r[85]).then(function(e){var t;return t=e,r[86]=t[0],t})},function(e){return r[86]!==void 0?r[87]=r[86]:r[87]="",r[87]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_storage_private_key is empty!"),r[108]="encrypted_epoch_storage_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[78]).then(function(e){var t;return t=e,r[88]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),r[88]==null?"":r[88]).then(function(e){var t;return t=e,r[89]=t[0],t})},function(e){return r[89]!==void 0?r[90]=r[89]:r[90]="",r[90]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_orf_client_state_v1_shape is empty!"),r[108]="encrypted_orf_client_state_v1_shape is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[45]).then(function(e){var t;return t=e,r[91]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),r[91]==null?"":r[91]).then(function(e){var t;return t=e,r[92]=t[0],t})},function(e){return r[92]!==void 0?r[93]=r[92]:r[93]="",r[93]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_oblivious_validation_token is empty!"),r[108]="encrypted_oblivious_validation_token is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[41]).then(function(e){var t;return t=e,r[94]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),r[94]==null?"":r[94]).then(function(e){var t;return t=e,r[95]=t[0],t})},function(e){return r[95]!==void 0?r[96]=r[95]:r[96]="",r[96]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_mailbox_root_key is empty!"),r[108]="encrypted_mailbox_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return r[97]=r[24].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),r[97]).then(function(e){var t;return t=e,r[98]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),r[98]==null?"":r[98]).then(function(e){var t;return t=e,r[99]=t[0],t})},function(e){return r[99]!==void 0?r[100]=r[99]:r[100]="",r[100]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_anon_id is empty!"),r[108]="encrypted_epoch_anon_id is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return r[101]=r[24].get("epoch_root_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[101]).then(function(e){var t;return t=e,r[102]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),r[102]==null?"":r[102]).then(function(e){var t;return t=e,r[103]=t[0],t})},function(e){return r[103]!==void 0?r[104]=r[103]:r[104]="",r[104]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_root_key is empty!"),r[108]="encrypted_epoch_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){var n;return r[105]=new t.Map,r[105].set("encrypted_device_private_key",r[84]),r[105].set("encrypted_epoch_storage_private_key",r[87]),r[105].set("encrypted_ocmf_client_state",r[90]),r[105].set("encrypted_orf_client_state_v2",void 0),r[105].set("encrypted_oblivious_validation_token_blob",r[93]),r[105].set("encrypted_mailbox_root_key_blob",r[96]),r[105].set("encrypted_epoch_anon_id",r[100]),r[105].set("encrypted_epoch_root_key",r[104]),r[106]=new t.Map,r[106].set("virtual_device_public_key",r[60]),r[106].set("virtual_device_id",r[18]),r[106].set("virtual_device_epoch_storage_public_key",r[62]),r[106].set("virtual_device_epoch_storage_public_key_sig",r[63]==null?t.blob("bnVsbA=="):r[63]),r[106].set("device_epoch_hmac",r[70]),r[106].set("epoch_root_key_fingerprint",r[74]),r[106].set("virtual_device_type",r[11]),r[106].set("action_type",t.i64.cast([0,1])),r[106].set("ocmf_rotation_token",r[79]),r[106].set("encrypted_secret_values_payload",r[105]),r[106].set("cloud_service_account",r[12]),r[106].set("hsm_pin_normalization_status",r[13]),r[106].set("security_question_type",r[14]),r[106].set("trusted_contact_id",r[15]),n=[r[106],void 0],r[53]=n[0],r[54]=n[1]}]):t.resolve((r[55]=new t.Map,r[55].set("error_code",t.i64.cast([0,9])),r[55].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[55].set("error_message",""),o=[void 0,r[55]],r[53]=o[0],r[54]=o[1]))},function(e){var t;return t=[r[53],r[54]],r[32]=t[0],r[33]=t[1],t}]):t.resolve((r[34]=r[30].get("errors"),r[35]=r[30].get("errors"),r[36]=new t.Map,r[36].set("error_code",t.i64.cast([0,9])),r[36].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[36].set("error_message",""),o=[void 0,r[36]],r[32]=o[0],r[33]=o[1]))},function(e){var t;return t=[r[32],r[33]],r[25]=t[0],r[26]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Epoch keys are unavailable."),r[28]="Epoch keys are unavailable.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[28]].join("")),r[27]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[28],r[27],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[29]=new t.Map,r[29].set("error_code",t.i64.cast([0,11])),r[29].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[29].set("error_message",""),n=[void 0,r[29]],r[25]=n[0],r[26]=n[1]}])},function(e){var t;return t=[r[25],r[26]],r[22]=t[0],r[23]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),r[25]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[25]].join("")),r[24]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[25],r[24],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[26]=new t.Map,r[26].set("error_code",t.i64.cast([0,10])),r[26].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[26].set("error_message",""),n=[void 0,r[26]],r[22]=n[0],r[23]=n[1]}])},function(e){var t;return t=[r[22],r[23]],r[20]=t[0],r[21]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),r[23]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[23]].join("")),r[22]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[23],r[22],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[24]=new t.Map,r[24].set("error_code",t.i64.cast([0,10])),r[24].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[24].set("error_message",""),n=[void 0,r[24]],r[20]=n[0],r[21]=n[1]}])},function(e){var t;return t=[r[20],r[21]],r[2]=t[0],r[3]=t[1],t}]):t.sequence([function(o){return t.db.table(174).fetch([[[t.i64.cast([0,1])]]]).next().then(function(o,a){var i=o.done,l=o.value;return i?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] No recovery code found in recovery code table"),r[14]="No recovery code found in recovery code table",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[14]].join("")),r[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[14],r[13],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[15]=new t.Map,r[15].set("error_code",t.i64.cast([0,501])),r[15].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[15].set("error_message",""),n=[void 0,r[15]],r[10]=n[0],r[11]=n[1]}]):(a=l.item,t.sequence([function(e){return r[13]=t.createArray(),t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,r[14]=t[0],t})},function(e){return t.nativeOperation(n("LSParseRecoveryCode_v2.nop"),a.recoveryCode,t.i64.to_string(r[14]),r[13]).then(function(e){var t;return t=e,r[15]=t[0],r[16]=t[1],t})},function(o){return t.blobs.neq(r[16],void 0)?t.sequence([function(o){return t.blobs.neq(r[15],void 0)?t.sequence([function(e){return t.storedProcedure(n("LSGetOpenEpochKeys"),!0).then(function(e){var t;return t=e,r[21]=t[0],t})},function(o){return r[21]!==void 0?t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[31]=new t.Map,r[31].set("error_msg","Expected a nonempty query result"),r[31].set("code",t.i64.cast([0,3])),r[31].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[32]=t.createArray(),r[33]=(r[32].push(r[31]),r[32]),o=[void 0,r[32]],r[24]=o[0],r[25]=o[1]):(n=l.item,r[31]=new t.Map,r[31].set("backup_id",n.backupId),r[31].set("device_public_key_blob",n.devicePublicKeyBlob),r[31].set("device_private_key_blob",n.devicePrivateKeyBlob),r[31].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[31].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[31].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[31].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[31].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[31].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[31].set("orf_client_state_v2_blob",void 0),r[31].set("orf_v2_authority_level",void 0),r[31].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[31].set("device_id",n.deviceId),r[31].set("backup_tenancy",n.backupTenancy),r[31].set("encryption_version",n.encryptionVersion),r[31].set("revision_version",n.revisionVersion),r[31].set("initialize_restore_result",void 0),r[31].set("device_creation_timestamp_sec",void 0),r[31].set("authority_level",n.authorityLevel),a=[r[31],void 0],r[24]=a[0],r[25]=a[1])})},function(e){var o;return r[27]=new t.Map,r[27].set("value",r[24]),r[27].set("errors",r[25]),r[28]=r[27].get("value"),r[28]!==void 0?t.sequence([function(e){var o;return r[31]=r[28].get("backup_id"),r[32]=r[28].get("device_public_key_blob"),r[33]=r[28].get("device_private_key_blob"),r[34]=r[28].get("epoch_storage_public_key_blob"),r[35]=r[28].get("epoch_storage_private_key_blob"),r[36]=r[28].get("epoch_auth_public_key_blob"),r[37]=r[28].get("epoch_auth_private_key_blob"),r[38]=r[28].get("mailbox_root_key_blob"),r[39]=r[28].get("ocmf_client_state_blob"),r[40]=r[28].get("orf_client_state_v2_blob"),r[41]=r[28].get("orf_v2_authority_level"),r[42]=r[28].get("oblivious_validation_token_blob"),r[43]=r[28].get("device_id"),r[44]=r[28].get("backup_tenancy"),r[45]=r[28].get("encryption_version"),r[46]=r[28].get("revision_version"),r[47]=r[28].get("initialize_restore_result"),r[48]=r[28].get("device_creation_timestamp_sec"),r[49]=r[28].get("authority_level"),t.i64.neq(r[43],void 0)?t.sequence([function(e){return r[52]=void 0,t.i64.neq(r[52],void 0)?t.resolve(r[53]=r[52]):t.sequence([function(e){return r[104]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[105]=t[0],t})},function(e){return r[105]&&(r[114]=(r[104].push(t.i64.cast([0,0])),r[104])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[106]=t[0],t})},function(e){return r[106]&&(r[114]=(r[104].push(t.i64.cast([0,2])),r[104])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[107]=t[0],t})},function(e){return r[107]&&(r[114]=(r[104].push(t.i64.cast([0,3])),r[104])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[108]=t[0],t})},function(e){return r[108]&&(r[114]=(r[104].push(t.i64.cast([0,4])),r[104])),r[109]=t.createArray(),r[110]=t.i64.of_int32(r[104].length),t.i64.gt(r[110],t.i64.cast([0,0]))?t.loopAsync(r[110],function(e){return r[114]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[104],r[114]).then(function(e){var t;return t=e,r[115]=t[0],r[116]=t[1],t})},function(e){return r[117]=(r[109].push(r[115]),r[109])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[114]=t.createArray(),r[115]=t.i64.of_int32(r[109].length),t.i64.gt(r[115],t.i64.cast([0,0]))?t.loopAsync(r[115],function(e){return r[117]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[109],r[117]).then(function(e){var t;return t=e,r[118]=t[0],r[119]=t[1],t})},function(e){return r[120]=(r[114].push(t.i64.to_string(r[118])),r[114])}])}):t.resolve()},function(e){return r[116]=r[114].join(","),r[111]=r[116]}])},function(e){return r[109].some(function(e){return t.i64.eq(r[45],e)})?r[112]=r[45]:r[112]=void 0,t.i64.neq(r[112],void 0)?r[113]=r[112]:r[113]=void 0,r[53]=r[113]}])},function(e){return t.i64.neq(r[53],void 0)?r[54]=r[53]:r[54]=t.i64.cast([0,0]),t.i64.neq(r[44],void 0)?r[55]=r[44]:r[55]=t.i64.cast([0,1]),t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[56]=t[0],r[57]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[58]=t[0],r[59]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[56],t.blob("MA=="),r[59]).then(function(e){var t;return t=e,r[60]=t[0],t})},function(e){return r[61]=r[21].get("epoch_anon_id"),r[62]=r[21].get("epoch_root_key"),r[63]=t.createArray(),r[104]=(r[63].push(t.i64.cast([0,32])),r[63]),t.nativeOperation(n("LSBase64Encode.nop"),r[61]).then(function(e){var t;return t=e,r[64]=t[0],t})},function(e){return r[64]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",r[64]].join("")),void 0,r[62],r[63]).then(function(e){var t;return t=e,r[104]=t[0],t})},function(e){return r[104]?r[105]=!1:r[105]=!0,r[105]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),r[108]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[108],r[107],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[109]=t[0],t})},function(e){return r[106]=r[109]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[104],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[107]=t[0],r[108]=t[1],t})},function(e){return r[106]=r[107]}])},function(e){return r[65]=r[106]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),r[105]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[105],r[104],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[106]=t[0],t})},function(e){return r[65]=r[106]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),r[65],r[57]).then(function(e){var t;return t=e,r[66]=t[0],t})},function(e){return t.blobs.neq(r[66],void 0)?t.resolve(r[67]=r[66]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] device_epoch_hmac is null!"),r[105]="device_epoch_hmac is null!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[106]=t[0],t})},function(e){return r[67]=r[106]}])},function(e){return r[68]=r[21].get("epoch_root_key"),r[69]=t.createArray(),r[104]=(r[69].push(t.i64.cast([0,18])),r[69]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,r[68],r[69]).then(function(e){var t;return t=e,r[70]=t[0],t})},function(e){return r[70]!==void 0?t.sequence([function(e){return r[104]=t.i64.of_int32(r[70].length),t.i64.ge(r[104],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[70],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[106]=t[0],r[107]=t[1],t})},function(e){return r[105]=r[106]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[107]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[107]].join("")),r[106]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[107],r[106],t.i64.cast([0,3]))},function(e){return r[105]=void 0}])},function(e){return r[71]=r[105]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[105]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[105],r[104],t.i64.cast([0,3]))},function(e){return r[71]=void 0}])},function(e){return t.blobs.neq(r[71],void 0)?r[72]=!0:r[72]=!1,r[72]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),r[39]).then(function(e){var t;return t=e,r[73]=t[0],r[74]=t[1],t})},function(e){var o;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,r[104]=t[0],r[105]=t[1],t})},function(e){var t;return t=[r[73],r[74],r[104],r[105]],r[75]=t[0],r[76]=t[1],r[77]=t[2],r[78]=t[3],t}]):t.resolve((o=[r[73],r[74],void 0,void 0],r[75]=o[0],r[76]=o[1],r[77]=o[2],r[78]=o[3],o))},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[56]).then(function(e){var t;return t=e,r[79]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6dmlydHVhbF9kZXZpY2VfcHJpdmF0ZV9rZXk="),r[79]==null?"":r[79]).then(function(e){var t;return t=e,r[80]=t[0],t})},function(e){return r[80]!==void 0?r[81]=r[80]:r[81]="",r[81]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_device_private_key is empty!"),r[105]="encrypted_device_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[58]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),r[82]==null?"":r[82]).then(function(e){var t;return t=e,r[83]=t[0],t})},function(e){return r[83]!==void 0?r[84]=r[83]:r[84]="",r[84]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_storage_private_key is empty!"),r[105]="encrypted_epoch_storage_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[75]).then(function(e){var t;return t=e,r[85]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),r[85]==null?"":r[85]).then(function(e){var t;return t=e,r[86]=t[0],t})},function(e){return r[86]!==void 0?r[87]=r[86]:r[87]="",r[87]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_orf_client_state_v1_shape is empty!"),r[105]="encrypted_orf_client_state_v1_shape is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[42]).then(function(e){var t;return t=e,r[88]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),r[88]==null?"":r[88]).then(function(e){var t;return t=e,r[89]=t[0],t})},function(e){return r[89]!==void 0?r[90]=r[89]:r[90]="",r[90]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_oblivious_validation_token is empty!"),r[105]="encrypted_oblivious_validation_token is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[38]).then(function(e){var t;return t=e,r[91]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),r[91]==null?"":r[91]).then(function(e){var t;return t=e,r[92]=t[0],t})},function(e){return r[92]!==void 0?r[93]=r[92]:r[93]="",r[93]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_mailbox_root_key is empty!"),r[105]="encrypted_mailbox_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return r[94]=r[21].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),r[94]).then(function(e){var t;return t=e,r[95]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),r[95]==null?"":r[95]).then(function(e){var t;return t=e,r[96]=t[0],t})},function(e){return r[96]!==void 0?r[97]=r[96]:r[97]="",r[97]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_anon_id is empty!"),r[105]="encrypted_epoch_anon_id is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return r[98]=r[21].get("epoch_root_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[98]).then(function(e){var t;return t=e,r[99]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),r[99]==null?"":r[99]).then(function(e){var t;return t=e,r[100]=t[0],t})},function(e){return r[100]!==void 0?r[101]=r[100]:r[101]="",r[101]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_root_key is empty!"),r[105]="encrypted_epoch_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){var n;return r[102]=new t.Map,r[102].set("encrypted_device_private_key",r[81]),r[102].set("encrypted_epoch_storage_private_key",r[84]),r[102].set("encrypted_ocmf_client_state",r[87]),r[102].set("encrypted_orf_client_state_v2",void 0),r[102].set("encrypted_oblivious_validation_token_blob",r[90]),r[102].set("encrypted_mailbox_root_key_blob",r[93]),r[102].set("encrypted_epoch_anon_id",r[97]),r[102].set("encrypted_epoch_root_key",r[101]),r[103]=new t.Map,r[103].set("virtual_device_public_key",r[57]),r[103].set("virtual_device_id",r[15]),r[103].set("virtual_device_epoch_storage_public_key",r[59]),r[103].set("virtual_device_epoch_storage_public_key_sig",r[60]==null?t.blob("bnVsbA=="):r[60]),r[103].set("device_epoch_hmac",r[67]),r[103].set("epoch_root_key_fingerprint",r[71]),r[103].set("virtual_device_type",a.virtualDeviceType),r[103].set("action_type",t.i64.cast([0,1])),r[103].set("ocmf_rotation_token",r[76]),r[103].set("encrypted_secret_values_payload",r[102]),r[103].set("cloud_service_account",a.cloudServiceAccount),r[103].set("hsm_pin_normalization_status",a.hsmPinNormalizationStatus),r[103].set("security_question_type",void 0),r[103].set("trusted_contact_id",void 0),n=[r[103],void 0],r[50]=n[0],r[51]=n[1]}]):t.resolve((r[52]=new t.Map,r[52].set("error_code",t.i64.cast([0,9])),r[52].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[52].set("error_message",""),o=[void 0,r[52]],r[50]=o[0],r[51]=o[1]))},function(e){var t;return t=[r[50],r[51]],r[29]=t[0],r[30]=t[1],t}]):t.resolve((r[31]=r[27].get("errors"),r[32]=r[27].get("errors"),r[33]=new t.Map,r[33].set("error_code",t.i64.cast([0,9])),r[33].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[33].set("error_message",""),o=[void 0,r[33]],r[29]=o[0],r[30]=o[1]))},function(e){var t;return t=[r[29],r[30]],r[22]=t[0],r[23]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Epoch keys are unavailable."),r[25]="Epoch keys are unavailable.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[25]].join("")),r[24]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[25],r[24],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[26]=new t.Map,r[26].set("error_code",t.i64.cast([0,11])),r[26].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[26].set("error_message",""),n=[void 0,r[26]],r[22]=n[0],r[23]=n[1]}])},function(e){var t;return t=[r[22],r[23]],r[19]=t[0],r[20]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),r[22]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[22]].join("")),r[21]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[22],r[21],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[23]=new t.Map,r[23].set("error_code",t.i64.cast([0,10])),r[23].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[23].set("error_message",""),n=[void 0,r[23]],r[19]=n[0],r[20]=n[1]}])},function(e){var t;return t=[r[19],r[20]],r[17]=t[0],r[18]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),r[20]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[20]].join("")),r[19]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[20],r[19],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[21]=new t.Map,r[21].set("error_code",t.i64.cast([0,10])),r[21].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[21].set("error_message",""),n=[void 0,r[21]],r[17]=n[0],r[18]=n[1]}])},function(e){var t;return t=[r[17],r[18]],r[10]=t[0],r[11]=t[1],t}]))})},function(e){var t;return t=[r[10],r[11]],r[2]=t[0],r[3]=t[1],t}])},function(e){return r[4]=t.i64.of_float(Date.now()),r[5]=t.i64.random(),r[7]="Finishing execution. Execution time: ",r[8]=t.i64.to_string(t.i64.sub(r[4],r[0])),r[9]=" ms",r[6]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][generateInitialVirtualDeviceSetupPayload] ",r[6],r[7],r[6],r[8],r[6],r[9]].join("")),t.i64.eq(t.i64.mod_(r[5],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[10]=",",r[11]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"generateInitialVirtualDeviceSetupPayload",[r[7],r[10],r[8],r[10],r[9]].join(""),r[11],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[2],r[3]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_generated_recovery_code"],a.exports=e}),null);
__d("LSInitializeBackupV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSCreateMinosEpochParams.nop","LSCreateSignature_v2.nop","LSGenerateInitialDeviceSetupPayload","LSGenerateInitialEpochSetupPayload","LSGenerateInitialVirtualDeviceSetupPayload","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","gkx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(r){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][initializeBackupV2] Beginning execution."),o[1]=t.i64.of_float(Date.now()),t.storedProcedure(n("LSGenerateInitialDeviceSetupPayload"),e[0]).then(function(e){var t;return t=e,o[2]=t[0],o[3]=t[1],t})},function(r){var a,i,l;return o[2]!==void 0?t.sequence([function(e){return o[15]=o[2].get("device_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[15]).then(function(e){var t;return t=e,o[16]=t[0],t})},function(e){return o[17]=o[2].get("epoch_storage_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[17]).then(function(e){var t;return t=e,o[18]=t[0],t})},function(e){return o[19]=o[2].get("epoch_storage_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),o[19]).then(function(e){var t;return t=e,o[20]=t[0],t})},function(e){return o[21]=o[2].get("epoch_auth_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[21]).then(function(e){var t;return t=e,o[22]=t[0],t})},function(e){return o[23]=o[2].get("epoch_auth_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),o[23]).then(function(e){var t;return t=e,o[24]=t[0],t})},function(e){return o[25]=o[2].get("ocmf_client_state"),t.nativeOperation(n("LSBase64Encode.nop"),o[25]).then(function(e){var t;return t=e,o[26]=t[0],t})},function(e){return o[27]=o[2].get("mailbox_root_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[27]).then(function(e){var t;return t=e,o[28]=t[0],t})},function(e){return o[29]=o[2].get("device_private_key"),o[30]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,o[31]=t[0],t})},function(e){return o[31]&&(o[44]=(o[30].push(t.i64.cast([0,0])),o[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,o[32]=t[0],t})},function(e){return o[32]&&(o[44]=(o[30].push(t.i64.cast([0,2])),o[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,o[33]=t[0],t})},function(e){return o[33]&&(o[44]=(o[30].push(t.i64.cast([0,3])),o[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,o[34]=t[0],t})},function(e){return o[34]&&(o[44]=(o[30].push(t.i64.cast([0,4])),o[30])),o[35]="",o[36]=t.i64.of_int32(o[30].length),t.i64.gt(o[36],t.i64.cast([0,0]))?t.loopAsync(o[36],function(e){return o[44]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[30],o[44]).then(function(e){var t;return t=e,o[45]=t[0],o[46]=t[1],t})},function(e){return o[35]=[o[35],"_",t.i64.to_string(o[45])].join("")}])}):t.resolve()},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),["supported_versions_",o[35],"revision_version_",t.i64.to_string(t.i64.cast([0,1]))].join("")).then(function(e){var t;return t=e,o[37]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[29],t.blob("Mg=="),o[37]).then(function(e){var t;return t=e,o[38]=t[0],t})},function(e){return t.blobs.neq(o[38],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[38]).then(function(e){var t;return t=e,o[44]=t[0],t})},function(e){return o[39]=o[44]}]):t.resolve(o[39]=void 0)},function(n){var r;return o[40]=o[2].get("optimistic_backup_id"),o[41]=o[2].get("mailbox_partial_id"),o[42]=new t.Map,o[42].set("supported_encryption_versions",o[30]),o[42].set("client_version",t.i64.cast([0,1])),o[42].set("version_sig",o[39]==null?"":o[39]),o[43]=new t.Map,o[43].set("device_public_key",o[16]==null?"":o[16]),o[43].set("epoch_storage_public_key",o[18]==null?"":o[18]),o[43].set("epoch_storage_public_key_sig",o[20]==null?"":o[20]),o[43].set("epoch_auth_public_key",o[22]==null?"":o[22]),o[43].set("epoch_auth_public_key_sig",o[24]==null?"":o[24]),o[43].set("device_registration_id",e[0]),o[43].set("ocmf_client_state",o[26]==null?"":o[26]),o[43].set("mailbox_partial_id",o[41]),o[43].set("mailbox_root_key",o[28]==null?"":o[28]),o[43].set("encryption_version_data",o[42]),r=[o[43],o[40],!0,t.i64.cast([0,0])],o[4]=r[0],o[5]=r[1],o[6]=r[2],o[7]=r[3]}]):t.resolve((o[3]!==void 0?(o[19]=o[3].get("error_code"),a=[void 0,t.i64.cast([-1,4294967295]),!1,o[19]],o[15]=a[0],o[16]=a[1],o[17]=a[2],o[18]=a[3]):(i=[void 0,t.i64.cast([-1,4294967295]),!1,t.i64.cast([0,12])],o[15]=i[0],o[16]=i[1],o[17]=i[2],o[18]=i[3]),l=[o[15],o[16],o[17],o[18]],o[4]=l[0],o[5]=l[1],o[6]=l[2],o[7]=l[3]))},function(a){return o[6]?t.sequence([function(a){return o[4]!==void 0?t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var r,a,i=e.done,l=e.value;return i?(o[25]=new t.Map,o[25].set("error_msg","Expected a nonempty query result"),o[25].set("code",t.i64.cast([0,3])),o[25].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),o[26]=t.createArray(),o[27]=(o[26].push(o[25]),o[26]),r=[void 0,o[26]],o[16]=r[0],o[17]=r[1]):(n=l.item,o[25]=new t.Map,o[25].set("backup_id",n.backupId),o[25].set("device_public_key_blob",n.devicePublicKeyBlob),o[25].set("device_private_key_blob",n.devicePrivateKeyBlob),o[25].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),o[25].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),o[25].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),o[25].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),o[25].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),o[25].set("ocmf_client_state_blob",n.ocmfClientStateBlob),o[25].set("orf_client_state_v2_blob",void 0),o[25].set("orf_v2_authority_level",void 0),o[25].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),o[25].set("device_id",n.deviceId),o[25].set("backup_tenancy",n.backupTenancy),o[25].set("encryption_version",n.encryptionVersion),o[25].set("revision_version",n.revisionVersion),o[25].set("initialize_restore_result",void 0),o[25].set("device_creation_timestamp_sec",void 0),o[25].set("authority_level",n.authorityLevel),a=[o[25],void 0],o[16]=a[0],o[17]=a[1])})},function(e){var a;return o[19]=new t.Map,o[19].set("value",o[16]),o[19].set("errors",o[17]),o[20]=o[19].get("value"),o[20]!==void 0?t.sequence([function(e){var a;return o[25]=o[20].get("backup_id"),o[26]=o[20].get("device_public_key_blob"),o[27]=o[20].get("device_private_key_blob"),o[28]=o[20].get("epoch_storage_public_key_blob"),o[29]=o[20].get("epoch_storage_private_key_blob"),o[30]=o[20].get("epoch_auth_public_key_blob"),o[31]=o[20].get("epoch_auth_private_key_blob"),o[32]=o[20].get("mailbox_root_key_blob"),o[33]=o[20].get("ocmf_client_state_blob"),o[34]=o[20].get("orf_client_state_v2_blob"),o[35]=o[20].get("orf_v2_authority_level"),o[36]=o[20].get("oblivious_validation_token_blob"),o[37]=o[20].get("device_id"),o[38]=o[20].get("backup_tenancy"),o[39]=o[20].get("encryption_version"),o[40]=o[20].get("revision_version"),o[41]=o[20].get("initialize_restore_result"),o[42]=o[20].get("device_creation_timestamp_sec"),o[43]=o[20].get("authority_level"),t.i64.neq(o[37],void 0)?t.sequence([function(e){return o[47]=void 0,t.i64.neq(o[47],void 0)?t.resolve(o[48]=o[47]):t.sequence([function(e){return o[58]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,o[59]=t[0],t})},function(e){return o[59]&&(o[68]=(o[58].push(t.i64.cast([0,0])),o[58])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,o[60]=t[0],t})},function(e){return o[60]&&(o[68]=(o[58].push(t.i64.cast([0,2])),o[58])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,o[61]=t[0],t})},function(e){return o[61]&&(o[68]=(o[58].push(t.i64.cast([0,3])),o[58])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,o[62]=t[0],t})},function(e){return o[62]&&(o[68]=(o[58].push(t.i64.cast([0,4])),o[58])),o[63]=t.createArray(),o[64]=t.i64.of_int32(o[58].length),t.i64.gt(o[64],t.i64.cast([0,0]))?t.loopAsync(o[64],function(e){return o[68]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[58],o[68]).then(function(e){var t;return t=e,o[69]=t[0],o[70]=t[1],t})},function(e){return o[71]=(o[63].push(o[69]),o[63])}])}):t.resolve()},function(e){return t.sequence([function(e){return o[68]=t.createArray(),o[69]=t.i64.of_int32(o[63].length),t.i64.gt(o[69],t.i64.cast([0,0]))?t.loopAsync(o[69],function(e){return o[71]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[63],o[71]).then(function(e){var t;return t=e,o[72]=t[0],o[73]=t[1],t})},function(e){return o[74]=(o[68].push(t.i64.to_string(o[72])),o[68])}])}):t.resolve()},function(e){return o[70]=o[68].join(","),o[65]=o[70]}])},function(e){return o[63].some(function(e){return t.i64.eq(o[39],e)})?o[66]=o[39]:o[66]=void 0,t.i64.neq(o[66],void 0)?o[67]=o[66]:o[67]=void 0,o[48]=o[67]}])},function(e){return t.i64.neq(o[48],void 0)?o[49]=o[48]:o[49]=t.i64.cast([0,0]),t.i64.neq(o[38],void 0)?o[50]=o[38]:o[50]=t.i64.cast([0,1]),o[51]=new t.Map,o[51].set("device_id",o[37]),o[51].set("public_key",o[26]),o[52]=t.createArray(),o[58]=(o[52].push(o[51]),o[52]),t.storedProcedure(n("LSGenerateInitialEpochSetupPayload"),o[25],o[52]).then(function(e){var t;return t=e,o[53]=t[0],o[54]=t[1],t})},function(e){var a,i,l;return o[53]!==void 0?t.sequence([function(e){return o[58]=o[53].get("epoch_anon_id"),o[59]=o[53].get("epoch_root_key"),t.blobs.neq(o[59],void 0)?t.sequence([function(e){return o[76]=t.createArray(),o[82]=(o[76].push(t.i64.cast([0,18])),o[76]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,o[59],o[76]).then(function(e){var t;return t=e,o[77]=t[0],t})},function(e){return o[77]!==void 0?t.sequence([function(e){return o[82]=t.i64.of_int32(o[77].length),t.i64.ge(o[82],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[77],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[84]=t[0],o[85]=t[1],t})},function(e){return o[83]=o[84]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),o[85]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[85]].join("")),o[84]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[85],o[84],t.i64.cast([0,3]))},function(e){return o[83]=void 0}])},function(e){return o[78]=o[83]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),o[83]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[83]].join("")),o[82]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[83],o[82],t.i64.cast([0,3]))},function(e){return o[78]=void 0}])},function(e){return t.blobs.neq(o[78],void 0)?o[79]=!0:o[79]=!1,o[79]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),o[78]).then(function(e){var t;return t=e,o[80]=t[0],t})},function(e){return o[80]!==void 0?o[81]=o[80]:o[81]="encodingfailed",o[60]=o[81]}]):t.resolve(o[60]="null")},function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[52],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[61]=t[0],o[62]=t[1],t})},function(e){return o[63]=o[61].get("public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[63]).then(function(e){var t;return t=e,o[64]=t[0],t})},function(e){return o[65]=o[61].get("public_key"),o[66]=t.createArray(),o[76]=(o[66].push(t.i64.cast([0,32])),o[66]),t.nativeOperation(n("LSBase64Encode.nop"),o[58]).then(function(e){var t;return t=e,o[67]=t[0],t})},function(e){return o[67]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",o[67]].join("")),void 0,o[59],o[66]).then(function(e){var t;return t=e,o[76]=t[0],t})},function(e){return o[76]?o[77]=!1:o[77]=!0,o[77]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),o[80]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[80]].join("")),o[79]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[80],o[79],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[81]=t[0],t})},function(e){return o[78]=o[81]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[76],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[79]=t[0],o[80]=t[1],t})},function(e){return o[78]=o[79]}])},function(e){return o[68]=o[78]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),o[77]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[77]].join("")),o[76]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[77],o[76],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[78]=t[0],t})},function(e){return o[68]=o[78]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),o[68],o[65]).then(function(e){var t;return t=e,o[69]=t[0],t})},function(e){return r("gkx")("11690")&&r("gkx")("16269")?t.sequence([function(e){return t.nativeOperation(n("LSCreateMinosEpochParams.nop"),o[59],o[58],void 0,void 0,void 0).then(function(e){var t;return t=e,o[76]=t[0],o[77]=t[1],o[78]=t[2],o[79]=t[3],o[80]=t[4],o[81]=t[5],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[76]).then(function(e){var t;return t=e,o[82]=t[0],t})},function(e){return o[82]!==void 0?o[83]=o[82]:o[83]="",t.nativeOperation(n("LSBase64Encode.nop"),o[78]).then(function(e){var t;return t=e,o[84]=t[0],t})},function(e){return o[84]!==void 0?o[85]=o[84]:o[85]="",t.nativeOperation(n("LSBase64Encode.nop"),o[77]).then(function(e){var t;return t=e,o[86]=t[0],t})},function(e){return o[86]!==void 0?o[87]=o[86]:o[87]="",t.nativeOperation(n("LSBase64Encode.nop"),o[79]).then(function(e){var t;return t=e,o[88]=t[0],t})},function(e){return o[88]!==void 0?o[89]=o[88]:o[89]="",t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),void 0).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return o[96]!==void 0?o[97]=o[96]:o[97]="",o[90]=o[97]}]):t.resolve(o[90]=void 0)},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[80]).then(function(e){var t;return t=e,o[91]=t[0],t})},function(e){return o[91]!==void 0?o[92]=o[91]:o[92]="",t.blobs.neq(o[81],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[81]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return o[96]!==void 0?o[97]=o[96]:o[97]="",o[93]=o[97]}]):t.resolve(o[93]=void 0)},function(e){return o[94]=new t.Map,o[94].set("mailbox_encryption_public_key",o[83]),o[94].set("mailbox_auth_public_key",o[85]),o[94].set("mailbox_signing_public_key",o[87]),o[94].set("epoch_head",o[89]),o[94].set("previous_epoch_head",o[90]),o[94].set("self_signature",o[92]),o[94].set("prev_signature",o[93]),o[94]!==void 0?t.resolve(o[95]=o[94]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochUtils] Missing Native Op for MEBMinosCreateMailboxEncryptionKeyPair"),o[97]="Missing Native Op for MEBMinosCreateMailboxEncryptionKeyPair",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochUtils] ","",o[97]].join("")),o[96]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochUtils",o[97],o[96],t.i64.cast([0,3]))},function(e){return o[95]=void 0}])},function(e){return o[70]=o[95]}]):t.resolve(o[70]=void 0)},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[58]).then(function(e){var t;return t=e,o[71]=t[0],t})},function(e){return o[72]=o[53].get("optimistic_epoch_id"),t.blobs.neq(o[69],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[69]).then(function(e){var t;return t=e,o[76]=t[0],t})},function(e){return o[73]=o[76]}]):t.resolve(o[73]=void 0)},function(e){var n;return o[74]=new t.Map,o[74].set("device_pub",o[64]==null?"":o[64]),o[74].set("hmac",o[73]==null?"":o[73]),o[74].set("encrypted_epoch_key",void 0),o[74].set("epoch_root_key_fingerprint",o[60]),o[75]=new t.Map,o[75].set("epoch_data",""),o[75].set("epoch_anon_id",o[71]==null?"":o[71]),o[75].set("minos_epoch_creation_params",o[70]),o[75].set("optimistic_epoch_id",o[72]),o[75].set("membership",o[74]),n=[o[75],!0,t.i64.cast([0,0])],o[55]=n[0],o[56]=n[1],o[57]=n[2]}]):t.resolve((o[54]!==void 0?(o[61]=o[54].get("error_code"),a=[void 0,!1,o[61]],o[58]=a[0],o[59]=a[1],o[60]=a[2]):(i=[void 0,!1,t.i64.cast([0,14])],o[58]=i[0],o[59]=i[1],o[60]=i[2]),l=[o[58],o[59],o[60]],o[55]=l[0],o[56]=l[1],o[57]=l[2]))},function(e){var t;return t=[o[55],o[56],o[57]],o[44]=t[0],o[45]=t[1],o[46]=t[2],t}]):t.resolve((a=[void 0,!1,t.i64.cast([0,9])],o[44]=a[0],o[45]=a[1],o[46]=a[2],a))},function(e){var t;return t=[o[44],o[45],o[46]],o[21]=t[0],o[22]=t[1],o[23]=t[2],t}]):t.resolve((o[25]=o[19].get("errors"),o[26]=o[19].get("errors"),a=[void 0,!1,t.i64.cast([0,9])],o[21]=a[0],o[22]=a[1],o[23]=a[2]))},function(r){return o[22]?t.sequence([function(r){return o[21]!==void 0?t.sequence([function(r){return t.storedProcedure(n("LSGenerateInitialVirtualDeviceSetupPayload"),o[5],e[2]).then(function(e){var t;return t=e,o[26]=t[0],o[27]=t[1],t})},function(e){var r,a,i;return o[26]!==void 0?t.sequence([function(e){return o[32]=o[26].get("virtual_device_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[32]).then(function(e){var t;return t=e,o[33]=t[0],t})},function(e){return o[34]=o[26].get("virtual_device_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[34]).then(function(e){var t;return t=e,o[35]=t[0],t})},function(e){return o[36]=o[26].get("virtual_device_epoch_storage_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[36]).then(function(e){var t;return t=e,o[37]=t[0],t})},function(e){return o[38]=o[26].get("virtual_device_epoch_storage_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),o[38]).then(function(e){var t;return t=e,o[39]=t[0],t})},function(e){return o[40]=o[26].get("device_epoch_hmac"),t.nativeOperation(n("LSBase64Encode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[42]=o[26].get("epoch_root_key_fingerprint"),t.blobs.neq(o[42],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[42]).then(function(e){var t;return t=e,o[54]=t[0],t})},function(e){return o[43]=o[54]}]):t.resolve(o[43]=void 0)},function(e){return o[44]=o[26].get("ocmf_rotation_token"),t.nativeOperation(n("LSBase64Encode.nop"),o[44]).then(function(e){var t;return t=e,o[45]=t[0],t})},function(e){var n;return o[46]=o[26].get("encrypted_secret_values_payload"),o[47]=o[26].get("virtual_device_type"),o[48]=o[26].get("action_type"),o[49]=o[26].get("cloud_service_account"),o[50]=o[26].get("hsm_pin_normalization_status"),o[51]=o[26].get("security_question_type"),o[52]=o[26].get("trusted_contact_id"),o[53]=new t.Map,o[53].set("virtual_device_public_key",o[33]==null?"":o[33]),o[53].set("virtual_device_id",o[35]==null?"":o[35]),o[53].set("virtual_device_epoch_storage_public_key",o[37]==null?"":o[37]),o[53].set("virtual_device_epoch_storage_public_key_sig",o[39]==null?"":o[39]),o[53].set("encrypted_secret_values",o[46]),o[53].set("device_epoch_hmac",o[41]==null?"":o[41]),o[53].set("epoch_root_key_fingerprint",o[43]),o[53].set("ocmf_rotation_token",o[45]==null?"":o[45]),o[53].set("virtual_device_type",o[47]),o[53].set("action_type",o[48]),o[53].set("cloud_service_account",o[49]),o[53].set("hsm_pin_normalization_status",o[50]),o[53].set("security_question_type",o[51]),o[53].set("trusted_contact_id",o[52]),n=[o[53],!0,t.i64.cast([0,0])],o[28]=n[0],o[29]=n[1],o[30]=n[2]}]):t.resolve((o[27]!==void 0?(o[35]=o[27].get("error_code"),r=[void 0,!1,o[35]],o[32]=r[0],o[33]=r[1],o[34]=r[2]):(a=[void 0,!1,t.i64.cast([0,16])],o[32]=a[0],o[33]=a[1],o[34]=a[2]),i=[o[32],o[33],o[34]],o[28]=i[0],o[29]=i[1],o[30]=i[2]))},function(r){return o[29]?t.sequence([function(r){return o[28]!==void 0?t.sequence([function(r){return o[33]=new t.Map,o[33].set("optimistic_backup_id",o[5]),o[33].set("device_payload",o[4]),o[33].set("epoch_payload",o[21]),o[33].set("virtual_device_payload",o[28]),o[38]=t.i64.cast([0,1e3]),o[34]=o[38],o[35]=new t.Map,o[35].set("success",o[33]),o[35].set("request_id",e[1]),o[36]=t.toJSON(o[35]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[36],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,o[34]).then(function(e){var t;return t=e,o[37]=t[0],t})},function(e){return o[32]=t.i64.cast([0,0])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null virtual device payload"),o[34]="Null virtual device payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[34]].join("")),o[33]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[34],o[33],t.i64.cast([0,3]))},function(r){return o[35]=new t.Map,o[35].set("error_code",o[30]),o[35].set("error_message","Null virtual device payload"),o[35].set("stored_procedure","initializeBackupV2"),o[36]=new t.Map,o[36].set("failure",o[35]),o[36].set("request_id",e[1]),o[37]=t.toJSON(o[36]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[37],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[38]=t[0],t})},function(e){return o[32]=t.i64.cast([0,1])}])},function(e){return o[31]=o[32]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create virtual device payload"),o[33]="Could not create virtual device payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[33]].join("")),o[32]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[33],o[32],t.i64.cast([0,3]))},function(r){return o[34]=new t.Map,o[34].set("error_code",o[30]),o[34].set("error_message","Could not create virtual device payload"),o[34].set("stored_procedure","initializeBackupV2"),o[35]=new t.Map,o[35].set("failure",o[34]),o[35].set("request_id",e[1]),o[36]=t.toJSON(o[35]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[36],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[37]=t[0],t})},function(e){return o[31]=t.i64.cast([0,1])}])},function(e){return o[25]=o[31]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null epoch payload"),o[27]="Null epoch payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[27]].join("")),o[26]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[27],o[26],t.i64.cast([0,3]))},function(r){return o[28]=new t.Map,o[28].set("error_code",o[23]),o[28].set("error_message","Null epoch payload"),o[28].set("stored_procedure","initializeBackupV2"),o[29]=new t.Map,o[29].set("failure",o[28]),o[29].set("request_id",e[1]),o[30]=t.toJSON(o[29]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[30],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[31]=t[0],t})},function(e){return o[25]=t.i64.cast([0,1])}])},function(e){return o[24]=o[25]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create epoch payload"),o[26]="Could not create epoch payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[26]].join("")),o[25]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[26],o[25],t.i64.cast([0,3]))},function(r){return o[27]=new t.Map,o[27].set("error_code",o[23]),o[27].set("error_message","Could not create epoch payload"),o[27].set("stored_procedure","initializeBackupV2"),o[28]=new t.Map,o[28].set("failure",o[27]),o[28].set("request_id",e[1]),o[29]=t.toJSON(o[28]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[29],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[30]=t[0],t})},function(e){return o[24]=t.i64.cast([0,1])}])},function(e){return o[15]=o[24]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null device payload"),o[17]="Null device payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[17]].join("")),o[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[17],o[16],t.i64.cast([0,3]))},function(r){return o[18]=new t.Map,o[18].set("error_code",o[7]),o[18].set("error_message","Null device payload"),o[18].set("stored_procedure","initializeBackupV2"),o[19]=new t.Map,o[19].set("failure",o[18]),o[19].set("request_id",e[1]),o[20]=t.toJSON(o[19]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[20],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[21]=t[0],t})},function(e){return o[15]=t.i64.cast([0,1])}])},function(e){return o[8]=o[15]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create device payload"),o[16]="Could not create device payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[16]].join("")),o[15]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[16],o[15],t.i64.cast([0,3]))},function(r){return o[17]=new t.Map,o[17].set("error_code",o[7]),o[17].set("error_message","Could not create device payload"),o[17].set("stored_procedure","initializeBackupV2"),o[18]=new t.Map,o[18].set("failure",o[17]),o[18].set("request_id",e[1]),o[19]=t.toJSON(o[18]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[19],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[20]=t[0],t})},function(e){return o[8]=t.i64.cast([0,1])}])},function(e){return o[9]=t.i64.of_float(Date.now()),o[10]=t.i64.random(),o[12]="Finishing execution. Execution time: ",o[13]=t.i64.to_string(t.i64.sub(o[9],o[0])),o[14]=" ms",o[11]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][initializeBackupV2] ",o[11],o[12],o[11],o[13],o[11],o[14]].join("")),t.i64.eq(t.i64.mod_(o[10],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[15]=",",o[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"initializeBackupV2",[o[12],o[15],o[13],o[15],o[14]].join(""),o[16],t.i64.cast([0,4]))):t.resolve()},function(e){return a[0]=o[8]}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsInitializeBackupV2StoredProcedure",e.__tables__=["secure_encrypted_backups_client_state"];var s=e;l.default=s}),98);
__d("LSInitializeBackupV2StoredProcedure",["LSInitializeBackupV2","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSInitializeBackupV2"),a.deviceRegistrationId,a.requestId,a.recoveryCodeData);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MWEncryptedBackupsInitializeBackup",["LSFactory","LSInitializeBackupV2StoredProcedure","LSShape"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a){return e.runInTransaction(function(e){return r("LSInitializeBackupV2StoredProcedure")(r("LSFactory")(e),{deviceRegistrationId:t,recoveryCodeData:a?o("LSShape").ofRecord(a):void 0,requestId:n!=null?n:""})},"readwrite",void 0,void 0,i.id+":28")}l.initializeBackupStoredProcedure=e}),98);
__d("EBInitializeBackup",["EBAPIQPLPoints","EBDeps","EBLogger","EBMainThreadEBDBApiDeferred","EBSMAPI","I64","LSAuthorityLevel","LSEncryptedBackupsOpStatus","LSIntEnum","MAWTraceUtils","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsInitializeBackup","Random","RecoveryCodeDB","WAResultOrError","getErrorSafe","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(e,t){var n=await o("RecoveryCodeDB").getOrCreateRecoveryCodeDB(),a=o("Random").uint32();await n.runInTransaction(["persisted_recovery_code"],"readwrite",async function(n){var o=await n.stores.persisted_recovery_code.readAll(),i=o.filter(function(e){return e.virtualDeviceType===t&&e.authorityLevel===r("LSAuthorityLevel").OPTIMISTIC}).map(function(e){return e.pk});i.length>0&&await n.stores.persisted_recovery_code.bulkDelete(i),await n.stores.persisted_recovery_code.bulkPut([{authorityLevel:r("LSAuthorityLevel").OPTIMISTIC,pk:a,recoveryCode:e,virtualDeviceType:t}])},"EBDB - persist recovery code optimistic")}async function c(e,t){var n=await o("RecoveryCodeDB").getOrCreateRecoveryCodeDB();await n.runInTransaction(["persisted_recovery_code"],"readwrite",async function(n){var o=await n.stores.persisted_recovery_code.readAll(),a=o.find(function(n){return n.recoveryCode===e&&n.virtualDeviceType===t&&n.authorityLevel===r("LSAuthorityLevel").OPTIMISTIC});a!=null&&await n.stores.persisted_recovery_code.bulkPut([babelHelpers.extends({},a,{authorityLevel:r("LSAuthorityLevel").AUTHORITATIVE})])},"RecoveryCodeDB - update recovery code to authoritative")}async function d(e){var t=await o("RecoveryCodeDB").getOrCreateRecoveryCodeDB();await t.runInTransaction(["persisted_recovery_code"],"readwrite",async function(t){var n=await t.stores.persisted_recovery_code.readAll(),o=n.filter(function(t){return t.virtualDeviceType===e&&t.authorityLevel===r("LSAuthorityLevel").OPTIMISTIC}).map(function(e){return e.pk});o.length>0&&await t.stores.persisted_recovery_code.bulkDelete(o)},"RecoveryCodeDB - cleanup recovery code optimistic")}var m=!1,p=new Map;async function _(t,n,a){if(r("justknobx")._("5261")&&m===!0)return o("EBLogger").EBLogger().warn("initializeBackup: init in progress"),t.endFail(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_RUNNING),Promise.resolve(o("WAResultOrError").makeError("init_in_progress"));m=!0;var i=null;try{if((e||(e=o("I64"))).equal(n,(s||(s=o("LSIntEnum"))).ofNumber(16))){var l=await o("RecoveryCodeDB").getOrCreateRecoveryCodeDB(),_=await l.runInTransaction(["persisted_recovery_code"],"readonly",async function(e){var t=await e.stores.persisted_recovery_code.readAll(),n=t.find(function(e){return e.virtualDeviceType===16&&e.authorityLevel===r("LSAuthorityLevel").OPTIMISTIC});return n!=null?{pk:n.pk,recoveryCode:n.recoveryCode}:null},"RecoveryCodeDB - read existing optimistic recovery code");t.addAnnotations({bool:{is_auto_eb_retry:_!=null}});var f=r("justknobx")._("776");if(_!=null&&f)return o("EBLogger").EBLogger().mustfix("Auto EB initBackup retry prevented by killswitch: wmi/armadillo:stop_auto_eb_initbackup_retry"),t.endFail("auto_eb_retry_prevented_by_killswitch"),await d(16),m=!1,Promise.resolve(o("WAResultOrError").makeError("auto_eb_init_failed"));if(_!=null)i=_.recoveryCode,t.addAnnotations({int:{recovery_code_db_pk:_.pk}});else{var g=await r("EBSMAPI").generateRecoveryCode({virtualDeviceType:n});if(g.success===!1)return t.endFail("generate_recovery_code_failure"),m=!1,g;g.success===!0&&(i=g.value.recoveryCode,await u(i,16))}}}catch(a){var h=r("getErrorSafe")(a);return t.endFail("auto_eb_init_failed"),o("EBLogger").EBLogger().catching(h).mustfix("Auto EB init failed."),(e||(e=o("I64"))).equal(n,(s||(s=o("LSIntEnum"))).ofNumber(16))&&await d(16),m=!1,Promise.resolve(o("WAResultOrError").makeError("auto_eb_init_failed"))}var y=function(){},C=new Promise(function(e,n){window.setTimeout(function(){y(),o("EBLogger").EBLogger().warn("Init backup failed by timeout"),t.endFail(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_TIMEOUT),e(o("WAResultOrError").makeError("timed_out"))},r("justknobx")._("4211"))}),b=new Promise(async function(l,u){var m=o("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(t.addAnnotations({string:{deviceRegistrationId:m}}),m===""){t.endFail("device_registration_id_null"),l(o("WAResultOrError").makeError("device_registration_id_null"));return}t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.GET_DB_START);var _=await o("EBDeps").getDeps().getLSDB();t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.GET_DB_END),y=_.tables.secure_encrypted_backups_client_state.subscribe(async function(a,u){if(u.operation==="delete"){t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SUBSCRIPTION_DELETE,{int:{deleteAuthorityLevel:(e||(e=o("I64"))).to_int32(u.prevValue.authorityLevel),deleteBackupId:e.to_int32(u.prevValue.backupId),deleteInputVirtualDeviceType:e.to_int32(n)}});return}var d=u.value,m=d.authorityLevel,p=d.backupId;(e||(e=o("I64"))).equal(m,(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))?(t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_END),i!=null&&(e||(e=o("I64"))).equal(n,(s||(s=o("LSIntEnum"))).ofNumber(16))&&await c(i,16),y(),t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.FETCH_BACKUP_IDS_START),r("EBSMAPI").fetchBackupIds("EBInitializeBackup").finally(function(){t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.FETCH_BACKUP_IDS_END),t.endSuccess(),o("EBMainThreadEBDBApiDeferred").addNewDevice()}),l(o("WAResultOrError").makeResult(p))):t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.OPTIMISTIC_CLIENT_STATE,{int:{ocsAuthorityLevel:(e||(e=o("I64"))).to_int32(m),ocsBackupId:e.to_int32(p),ocsInputVirtualDeviceType:e.to_int32(n)},string:{ocsOperation:u.operation}})}),p.set(t.getQPLAttrs().instanceKey.toString(),{clientStateUnsubscribe:y,qplFlow:t,resolve:l}),t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_START);var f=await o("MWEncryptedBackupsInitializeBackup").initializeBackupStoredProcedure(_,m,o("MAWTraceUtils").stringToTraceId(t.getQPLAttrs().instanceKey.toString()),a),g=f[0];if((e||(e=o("I64"))).equal(g,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE))){t.endFail(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_FAIL),(e||(e=o("I64"))).equal(n,(s||(s=o("LSIntEnum"))).ofNumber(16))&&await d(16),l(o("WAResultOrError").makeError("sproc_failure"));return}t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_END,{int:{sproc_status:(e||(e=o("I64"))).to_int32(g)}})});return Promise.race([b,C]).then(function(e){return e}).finally(function(){p.delete(t.getQPLAttrs().instanceKey.toString()),m=!1})}async function f(t,n,r){var a=p.get(t);a!=null&&(a.resolve(o("WAResultOrError").makeError("initialize_backup_fail")),a.qplFlow.endFail(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_FAIL,{string:{errorMsg:n}}),a.clientStateUnsubscribe()),r!=null&&(e||(e=o("I64"))).equal(r,(s||(s=o("LSIntEnum"))).ofNumber(16))&&await d(16),p.delete(t)}l.initializeBackup=_,l.resolveInitializeBackupPromiseWithError=f}),98);
__d("EBLoadMostRecentSelfMinosEpoch",["EBDB","EBMinosTypes","WALongInt"],(function(t,n,r,o,a,i,l){"use strict";var e=async function(){var e=await o("EBDB").getEBDB(),t=await e.store("secure_encrypted_backups_epochs").readAll(),n=Array.from(t).map(function(e){var t=e.epochAnonIdBlob,n=e.epochHead,r=e.epochId,a=e.epochRootKeyBlob;return n==null?null:{epochFbId:o("EBMinosTypes").unsafeCastToEpochFbId(r.toString()),epochHead:o("EBMinosTypes").unsafeCastToEpochHead(n),epochNumber:o("EBMinosTypes").unsafeCastToBase64StringIntToEpochNumber(t),exportRootKey:o("EBMinosTypes").unsafeCastToExportRootKey(a)}}).filter(Boolean).sort(function(e,t){return o("WALongInt").numberOrThrowIfTooLarge(t.epochNumber)-o("WALongInt").numberOrThrowIfTooLarge(e.epochNumber)}),r=n[0];return r};l.loadMostRecentSelfMinosEpoch=e}),98);
__d("EBLoadSelfMinosEpochForDecryption",["EBDB","EBMinosEncryptedMekVersion","EBMinosLogger","EBMinosTypes","EBMinosWasmOpenEpoch","WAGlobals","WALongInt","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e=["epochNumber"],s,u,c,d,m,p,_,f=async function(t,n){var e=await o("EBDB").getEBDB(),r=await e.store("secure_encrypted_backups_epochs").get(BigInt(t));if(r==null)return o("WAResultOrError").makeError("no-self-epoch-found");var a=r.epochHead,i=r.epochRootKeyBlob;if(a!=null)return o("WAResultOrError").makeResult({exportEpochHead:o("EBMinosTypes").unsafeCastToEpochHead(a),exportRootKey:o("EBMinosTypes").unsafeCastToExportRootKey(i)});if(n===o("EBMinosEncryptedMekVersion").MinosEncryptedMekVersion.V1||n===o("EBMinosEncryptedMekVersion").MinosEncryptedMekVersion.V2)return o("WAResultOrError").makeResult({exportEpochHead:null,exportRootKey:o("EBMinosTypes").unsafeCastToExportRootKey(i)});o("EBMinosLogger").minosLogger.WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["No epoch head found for user's epoch, attempting to re-calculate"])));var l=await e.store("secure_encrypted_backups_epochs").readAll(),p=o("EBMinosTypes").userJidToUserFbId(o("WAGlobals").getMyUserJid());if(p==null)return o("WAResultOrError").makeError("no-user-fbid-found");var _=g(l),f=_.firstMinosEpochIndex,y=_.sortedEpochs;if(f===-1)return o("EBMinosLogger").minosLogger.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["No minos epoch heads found"]))),o("WAResultOrError").makeError("no-self-epoch-head-found");var C=await h(f,t,y,p);if(!C.success)return o("EBMinosLogger").minosLogger.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Failed to process epochs: ",""])),C.error),C;var b=C.value,v=b.currentEpochHead,S=b.currentExportRootKey;return v==null||S==null?(o("EBMinosLogger").minosLogger.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Failed to re-calculate epoch head"]))),o("WAResultOrError").makeError("no-self-epoch-head-found")):(o("EBMinosLogger").minosLogger.DEV(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Successfully recalculated minos epoch head"]))),o("WAResultOrError").makeResult({exportEpochHead:v,exportRootKey:S}))};function g(e){var t=e.filter(function(e){return e!=null}).map(function(e){return babelHelpers.extends({},e,{epochNumber:o("EBMinosTypes").unsafeCastToBase64StringIntToEpochNumber(e.epochAnonIdBlob)})}).sort(function(e,t){return o("WALongInt").numberOrThrowIfTooLarge(e.epochNumber)-o("WALongInt").numberOrThrowIfTooLarge(t.epochNumber)}),n=(function(){for(var e=t.length-1;e>=0;e--)if(t[e].epochHead!=null)return e;return-1})();return{firstMinosEpochIndex:n,sortedEpochs:t}}async function h(t,n,r,a){for(var i,l=r[t].epochHead?o("EBMinosTypes").unsafeCastToEpochHead(r[t].epochHead):null,s=r[t].epochRootKeyBlob?o("EBMinosTypes").unsafeCastToExportRootKey(r[t].epochRootKeyBlob):null,u=(i=r[t].epochNumber)!=null?i:null,c=[],d=t+1;d<r.length;d++){var m=r[d],f=m.epochNumber,g=babelHelpers.objectWithoutPropertiesLoose(m,e),h=o("EBMinosTypes").unsafeCastToExportRootKey(m.epochRootKeyBlob);if(l==null||u==null||s==null)return o("EBMinosLogger").minosLogger.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Failed to open epoch: previousEpochHead, previousEpochNumber, or previousExportRootKey is null"]))),o("WAResultOrError").makeError("failed-to-open-epoch");var y=await o("EBMinosWasmOpenEpoch").openEpoch({epochNumber:f,exportRootKey:h,previousEpochHead:l,previousEpochNumber:u,previousExportRootKey:s,userFbid:a});if(y.success)l=y.value.epochHead,s=h,u=f,c.push(babelHelpers.extends({},g,{epochHead:y.value.epochHead}));else return o("EBMinosLogger").minosLogger.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Failed to open epoch: ",""])),y.error),o("WAResultOrError").makeError("failed-to-open-epoch");if(m.epochId===BigInt(n))break}return o("WAResultOrError").makeResult({currentEpochHead:l,currentExportRootKey:s,reCalculatedEpochs:c})}l.loadSelfMinosEpochForDecryption=f}),98);
__d("EBMinosLoadMessageEncryptionKey",["EBMinosDb","WACryptoUtils","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return{mek:{key:e.encryption_key_blob,mekId:e.mek_id_blob,rosterHash:e.roster_hash},mekFbid:e.mek_fbid}}var s=async function(n){var t=await o("EBMinosDb").getEBMinosDb(),r=await t.runInTransaction(["secure_minos_thread_message_encryption_keys_v2"],"readonly",function(e){return e.stores.secure_minos_thread_message_encryption_keys_v2.get(n)},"loadMessageEncryptionKeyByMekId");if(r!=null)return e(r)},u=async function(n,a,i){var t=await o("EBMinosDb").getEBMinosDb();if(r("gkx")("380")){var l=await t.runInTransaction(["secure_minos_thread_message_encryption_keys_v2"],"readonly",function(e){return e.stores.secure_minos_thread_message_encryption_keys_v2.readIndex("[roster_hash+minos_thread_id]",[a,n])},"loadMessageEncryptionKey");for(var s of l)if(s.created_by_self||s.mek_creator_epoch_head!=null&&i!=null&&o("WACryptoUtils").arrayBuffersEqual(s.mek_creator_epoch_head,i))return e(s)}else{var u=await t.runInTransaction(["secure_minos_thread_message_encryption_keys"],"readonly",function(e){return e.stores.secure_minos_thread_message_encryption_keys.readIndex("[roster_hash+minos_thread_id]",[a,n])},"loadMessageEncryptionKey");if(u.length===0)return null;var c=u[0];return e(c)}};l.loadMessageEncryptionKeyForDecryption=s,l.loadMessageEncryptionKey=u}),98);
__d("EBMinosSaveNewMessageEncryptionKey",["EBMinosDb","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e=async function(t,n,a,i,l,s){var e=await o("EBMinosDb").getEBMinosDb();r("gkx")("7918")?await e.runInTransaction(["secure_minos_thread_message_encryption_keys_v2"],"readwrite",function(e){return e.stores.secure_minos_thread_message_encryption_keys_v2.bulkPut([{created_by_self:i,encryption_key_blob:n.key,last_used_ts_ms:l,mek_creator_epoch_head:s,mek_fbid:a,mek_id_blob:n.mekId,minos_thread_id:t,roster_hash:n.rosterHash}])},"SaveNewMessageEncryptionKeyV2"):i&&await e.runInTransaction(["secure_minos_thread_message_encryption_keys"],"readwrite",function(e){return e.stores.secure_minos_thread_message_encryption_keys.bulkPut([{encryption_key_blob:n.key,mek_fbid:a,mek_id_blob:n.mekId,minos_thread_id:t,roster_hash:n.rosterHash}])},"SaveNewMessageEncryptionKey")};l.saveNewMessageEncryptionKey=e}),98);
__d("EBRegisterMinosMessageEncryptionKeyMutation_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="25185089431099815"}),null);
__d("EBRegisterMinosMessageEncryptionKeyMutation.graphql",["EBRegisterMinosMessageEncryptionKeyMutation_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{kind:"Variable",name:"input",variableName:"input"}],r={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"mek_fbid",storageKey:null}],type:"XFBMinosRegisterMessageEncryptionKeyResponse",abstractKey:null},o={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"message",storageKey:null}],type:"XFBMinosRegisterMessageEncryptionKeyError",abstractKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"EBRegisterMinosMessageEncryptionKeyMutation",selections:[{alias:null,args:t,concreteType:null,kind:"LinkedField",name:"xfb_minos_register_message_encryption_key",plural:!1,selections:[r,o],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"EBRegisterMinosMessageEncryptionKeyMutation",selections:[{alias:null,args:t,concreteType:null,kind:"LinkedField",name:"xfb_minos_register_message_encryption_key",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},r,o],storageKey:null}]},params:{id:n("EBRegisterMinosMessageEncryptionKeyMutation_facebookRelayOperation"),metadata:{},name:"EBRegisterMinosMessageEncryptionKeyMutation",operationKind:"mutation",text:null}}})();a.exports=e}),null);
__d("EBRegisterMinosMessageEncryptionKey",["Base64Utils","EBMinosTypes","EBRegisterMinosMessageEncryptionKeyMutation.graphql","WALongInt","WAResultOrError","createWorkerMutation"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e!==void 0?e:e=n("EBRegisterMinosMessageEncryptionKeyMutation.graphql"),u=async function(t){var e,n=t.actThreadId,a=t.instanceKey,i=t.mekEncryptionVersion,l=t.mekEnvelopes,u=t.mekId,c=t.mekRosterHash,d=t.sender,m=l.map(function(e){var t=e.encryptedMek,n=e.mailboxKey,r=e.mailboxKeyFbid,a=e.participantId;return{encrypted_mek_base64:o("Base64Utils").fromArrayBuffer(t),mailbox_key_base64:o("Base64Utils").fromArrayBuffer(n),mailbox_key_fbid:o("WALongInt").longIntToDecimalString(r),participant_id:a}}),p=r("createWorkerMutation")(s),_=p[0],f=await _({input:{mek_envelopes:m,mek_info:babelHelpers.extends({act_thread_id:n,mek_encryption_version:i,mek_id_base64:o("Base64Utils").fromArrayBuffer(u),mek_roster_base64:o("Base64Utils").fromArrayBuffer(c)},d.senderType==="Minos"?{minos_sender:{epoch_fbid:d.epochFbId}}:{transport_sender:{ephemeral_hpke_pub_key_base64:o("Base64Utils").fromArrayBuffer(d.ephemeralEncryptionPk),ephemeral_key_signature_base64:o("Base64Utils").fromArrayBuffer(d.signature),signing_pub_key_base64:o("Base64Utils").fromArrayBuffer(d.signingPk)}}),request_uuid:a.toString(),version:"REAL_MAILBOX_KEYS"}});if(f==null)return o("WAResultOrError").makeError({errorName:"empty-response"});if((f==null||(e=f.xfb_minos_register_message_encryption_key)==null?void 0:e.mek_fbid)!=null){var g=f.xfb_minos_register_message_encryption_key.mek_fbid;return o("WAResultOrError").makeResult({mekFbid:o("EBMinosTypes").unsafeCastToMekFbId(g)})}var h=(f==null?void 0:f.xfb_minos_register_message_encryption_key)||{},y=h.code,C=h.message,b="error code: "+(y!=null?y:"null")+" error description: "+(C!=null?C:"null");return y!=null?o("WAResultOrError").makeError({errorName:"graphql-error",failReason:b}):o("WAResultOrError").makeError({errorName:"unexpected-graphql-response",failReason:b})};l.registerMinosMessageEncryptionKey=u}),98);
__d("EBInitializeMinosCryptoLibrary",["EBLoadMostRecentSelfMinosEpoch","EBLoadSelfMinosEpochForDecryption","EBMinosCryptoLibrary","EBMinosLoadMessageEncryptionKey","EBMinosLogger","EBMinosSaveNewMessageEncryptionKey","EBRegisterMinosMessageEncryptionKey","FBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=t.transportSigningKeypair,a=await o("EBMinosCryptoLibrary").createMinosCryptoLibrary({io:{loadMessageEncryptionKey:o("EBMinosLoadMessageEncryptionKey").loadMessageEncryptionKey,loadMessageEncryptionKeyForDecryption:o("EBMinosLoadMessageEncryptionKey").loadMessageEncryptionKeyForDecryption,loadMostRecentSelfMinosEpoch:o("EBLoadMostRecentSelfMinosEpoch").loadMostRecentSelfMinosEpoch,loadSelfMinosEpochForDecryption:o("EBLoadSelfMinosEpochForDecryption").loadSelfMinosEpochForDecryption,registerMinosMessageEncryptionKey:o("EBRegisterMinosMessageEncryptionKey").registerMinosMessageEncryptionKey,saveNewMessageEncryptionKey:o("EBMinosSaveNewMessageEncryptionKey").saveNewMessageEncryptionKey},logger:o("EBMinosLogger").minosLogger,transportSigningKeypair:n});if(!a.success){r("FBLogger")("wmi_minos").MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to create Minos crypto library ",""])),a.error);return}o("EBMinosCryptoLibrary").setMinosCryptoLibrary(a.value)}l.initializeMinosCryptoLibrary=s}),98);
__d("EBMinosWasmDeriveAttachmentTokenPrimaryKey",["EBMinosWasmDeriveAttachmentAccessTokenSecret","EBMinosWasmDeriveAttachmentPrimaryKeySecret","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=await o("EBMinosWasmDeriveAttachmentPrimaryKeySecret").deriveAttachmentPrimaryKeySecret({mediaKey:e});if(!t.success)return o("WAResultOrError").makeError("derive-primary-key-secret-error");var n=await o("EBMinosWasmDeriveAttachmentAccessTokenSecret").deriveAttachmentAccessTokenSecret({mediaKey:e});return n.success?o("WAResultOrError").makeResult({accessToken:n.value,primaryKey:t.value}):o("WAResultOrError").makeError("derive-access-token-secret-error")}l.deriveAttachmentTokenPrimaryKeySecret=e}),98);
__d("LSCreateResignCDNUrlPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSBinaryToHex.nop","LSCreateDerivedKeys.nop","LSFindBackup","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return e[10]?t.sequence([function(o){var a;return t.blobs.neq(e[11],void 0)?t.sequence([function(o){var a;return t.i64.neq(e[8],void 0)?t.sequence([function(o){var a;return e[9]!==void 0?t.sequence([function(o){var a;return t.blobs.neq(e[12],void 0)?t.sequence([function(o){return r[10]=t.createArray(),r[19]=(r[10].push(e[9]),r[10]),r[19]=(r[10].push(e[1]),r[10]),r[11]=t.toJSON(r[10]),r[12]=t.createArray(),r[19]=(r[12].push(t.i64.cast([0,32])),r[12]),t.nativeOperation(n("LSGetBlobFromString.nop"),["thread_ope_key","_",e[5]].join("")).then(function(e){var t;return t=e,r[13]=t[0],t})},function(o){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[13],void 0,e[12],r[12]).then(function(e){var t;return t=e,r[14]=t[0],t})},function(e){return r[14]?r[15]=!1:r[15]=!0,r[15]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),r[20]="Got null keys while deriving message list OPE key. Returning null blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[20]].join("")),r[19]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[20],r[19],t.i64.cast([0,3]))},function(e){return r[16]=void 0}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[14],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[19]=t[0],r[20]=t[1],t})},function(e){return r[16]=r[19]}])},function(o){var a;return t.blobs.neq(r[16],void 0)?t.sequence([function(o){return t.nativeOperation(n("LSGetBlobFromInt64BE.nop"),e[6]).then(function(e){var t;return t=e,r[19]=t[0],t})},function(e){return t.nativeOperation(n("LSTruncateSortKey.nop"),r[19]).then(function(e){var t;return t=e,r[20]=t[0],t})},function(e){return t.nativeOperation(n("LSOpeEncrypt.nop"),r[16],r[20],t.i64.cast([0,16])).then(function(e){var t;return t=e,r[21]=t[0],t})},function(e){return t.nativeOperation(n("LSBinaryToHex.nop"),r[21]).then(function(e){var t;return t=e,r[22]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),r[11]).then(function(e){var t;return t=e,r[23]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),r[23]).then(function(e){var t;return t=e,r[24]=t[0],t})},function(o){return t.nativeOperation(n("LSOcmfClientMap.nop"),e[11],r[24]).then(function(e){var t;return t=e,r[25]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[25]).then(function(e){var t;return t=e,r[26]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[9]).then(function(e){var t;return t=e,r[27]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWFpbGJveF9pZF9zY29wZQ=="),r[27]).then(function(e){var t;return t=e,r[28]=t[0],t})},function(o){return t.nativeOperation(n("LSOcmfClientMap.nop"),e[11],r[28]).then(function(e){var t;return t=e,r[29]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[29]).then(function(e){var t;return t=e,r[30]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[4]).then(function(e){var t;return t=e,r[31]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWVzc2FnZV9pZF9zY29wZQ=="),r[31]).then(function(e){var t;return t=e,r[32]=t[0],t})},function(o){return t.nativeOperation(n("LSOcmfClientMap.nop"),e[11],r[32]).then(function(e){var t;return t=e,r[33]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[33]).then(function(e){var t;return t=e,r[34]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[4]).then(function(e){var t;return t=e,r[35]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),r[35]).then(function(e){var t;return t=e,r[36]=t[0],t})},function(o){return t.nativeOperation(n("LSOcmfClientMap.nop"),e[11],r[36]).then(function(e){var t;return t=e,r[37]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[37]).then(function(e){var t;return t=e,r[38]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[5]).then(function(e){var t;return t=e,r[39]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("dGhyZWFkX2lkX3Njb3Bl"),r[39]).then(function(e){var t;return t=e,r[40]=t[0],t})},function(o){return t.nativeOperation(n("LSOcmfClientMap.nop"),e[11],r[40]).then(function(e){var t;return t=e,r[41]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[41]).then(function(e){var t;return t=e,r[42]=t[0],t})},function(o){return r[43]=new t.Map,r[43].set("attachment_index_key",r[26]==null?"":r[26]),r[43].set("backup_ent_fbid",e[0]),r[43].set("delivery_object_id",e[1]),r[43].set("device_id",e[8]),r[43].set("mailbox_partial_id",r[30]==null?"":r[30]),r[43].set("media_type",e[3]),r[43].set("message_partial_id",r[34]==null?"":r[34]),r[43].set("product_type",e[2]),r[43].set("salt_partial_id",r[38]==null?"":r[38]),r[43].set("sort_key",r[22]==null?"":r[22]),r[43].set("thread_partial_id",r[42]==null?"":r[42]),r[43].set("isOpenEB",e[10]===!0),r[44]=new t.Map,r[44].set("otid",e[4]),r[44].set("server_thread_key",e[7]),r[44].set("timestamp",t.i64.to_string(e[6])),t.nativeOperation(n("LSBase64Encode.nop"),e[11]).then(function(e){var t;return t=e,r[45]=t[0],t})},function(o){return t.nativeOperation(n("LSBase64Encode.nop"),e[12]).then(function(e){var t;return t=e,r[46]=t[0],t})},function(o){return r[47]=new t.Map,r[47].set("ocmf_client_state_blob",r[45]==null?"":r[45]),r[47].set("mailbox_root_key",r[46]==null?"":r[46]),r[48]=t.createArray(),r[60]=(r[48].push(e[4]),r[48]),r[60]=(r[48].push(e[1]),r[48]),r[49]=t.toJSON(r[48]),r[43].set("raw_identifiers",r[44]),r[43].set("backup_id",e[9]),r[43].set("thread_id",e[5]),t.nativeOperation(n("LSGetBlobFromString.nop"),r[49]).then(function(e){var t;return t=e,r[50]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),r[50]).then(function(e){var t;return t=e,r[51]=t[0],t})},function(o){return t.nativeOperation(n("LSOcmfClientMap.nop"),e[11],r[51]).then(function(e){var t;return t=e,r[52]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[52]).then(function(e){var t;return t=e,r[53]=t[0],t})},function(e){return r[43].set("salt_partial_access_token",r[53]==null?"":r[53]),t.nativeOperation(n("LSGetBlobFromString.nop"),r[11]).then(function(e){var t;return t=e,r[54]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),r[54]).then(function(e){var t;return t=e,r[55]=t[0],t})},function(o){return t.nativeOperation(n("LSOcmfClientMap.nop"),e[11],r[55]).then(function(e){var t;return t=e,r[56]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[56]).then(function(e){var t;return t=e,r[57]=t[0],t})},function(n){var o;return r[43].set("salt_partial_attachment_index_key",r[57]==null?"":r[57]),r[43].set("raw_tokens",r[47]),e[13]!==void 0&&r[43].set("access_token_secret",e[13]),e[14]!==void 0&&r[43].set("primary_key_secret",e[14]),r[58]=t.toJSON(r[43]),r[59]=new t.Map,r[59].set("payload",r[58]),o=[r[59],void 0],r[17]=o[0],r[18]=o[1]}]):t.resolve((r[19]=new t.Map,r[19].set("error_code",t.i64.cast([0,25])),r[19].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[19].set("error_message","OPE key is null for IssueAttachmentRestoreTask"),a=[void 0,r[19]],r[17]=a[0],r[18]=a[1]))},function(e){var t;return t=[r[17],r[18]],r[8]=t[0],r[9]=t[1],t}]):t.resolve((r[10]=new t.Map,r[10].set("error_code",t.i64.cast([0,20])),r[10].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[10].set("error_message","Missing mailbox_root_key for IssueAttachmentRestoreTask"),a=[void 0,r[10]],r[8]=a[0],r[9]=a[1]))},function(e){var t;return t=[r[8],r[9]],r[6]=t[0],r[7]=t[1],t}]):t.resolve((r[8]=new t.Map,r[8].set("error_code",t.i64.cast([0,1])),r[8].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[8].set("error_message","Missing backup_id for IssueAttachmentRestoreTask"),a=[void 0,r[8]],r[6]=a[0],r[7]=a[1]))},function(e){var t;return t=[r[6],r[7]],r[4]=t[0],r[5]=t[1],t}]):t.resolve((r[6]=new t.Map,r[6].set("error_code",t.i64.cast([0,24])),r[6].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[6].set("error_message","Missing device_id for IssueAttachmentRestoreTask"),a=[void 0,r[6]],r[4]=a[0],r[5]=a[1]))},function(e){var t;return t=[r[4],r[5]],r[2]=t[0],r[3]=t[1],t}]):t.resolve((r[4]=new t.Map,r[4].set("error_code",t.i64.cast([0,22])),r[4].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[4].set("error_message","Missing ocmf_client_state_blob for IssueAttachmentRestoreTask"),a=[void 0,r[4]],r[2]=a[0],r[3]=a[1]))},function(e){var t;return t=[r[2],r[3]],r[0]=t[0],r[1]=t[1],t}]):t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,o){var a,i=e.done,l=e.value;return i?(a=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,20]),void 0,void 0],r[2]=a[0],r[3]=a[1],r[4]=a[2],r[5]=a[3],r[6]=a[4],r[7]=a[5],r[8]=a[6],r[9]=a[7],r[10]=a[8],r[11]=a[9],r[12]=a[10],r[13]=a[11],r[14]=a[12],r[15]=a[13],r[16]=a[14],r[17]=a[15],r[18]=a[16],r[19]=a[17],a):(o=l.item,t.sequence([function(e){return r[29]=o.backupTenancy,r[28]=o.encryptionVersion,r[24]=void 0,t.i64.neq(r[24],void 0)?t.resolve(r[25]=r[24]):t.sequence([function(e){return r[30]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[31]=t[0],t})},function(e){return r[31]&&(r[40]=(r[30].push(t.i64.cast([0,0])),r[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[32]=t[0],t})},function(e){return r[32]&&(r[40]=(r[30].push(t.i64.cast([0,2])),r[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[33]=t[0],t})},function(e){return r[33]&&(r[40]=(r[30].push(t.i64.cast([0,3])),r[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[34]=t[0],t})},function(e){return r[34]&&(r[40]=(r[30].push(t.i64.cast([0,4])),r[30])),r[35]=t.createArray(),r[36]=t.i64.of_int32(r[30].length),t.i64.gt(r[36],t.i64.cast([0,0]))?t.loopAsync(r[36],function(e){return r[40]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[30],r[40]).then(function(e){var t;return t=e,r[41]=t[0],r[42]=t[1],t})},function(e){return r[43]=(r[35].push(r[41]),r[35])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[40]=t.createArray(),r[41]=t.i64.of_int32(r[35].length),t.i64.gt(r[41],t.i64.cast([0,0]))?t.loopAsync(r[41],function(e){return r[43]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[35],r[43]).then(function(e){var t;return t=e,r[44]=t[0],r[45]=t[1],t})},function(e){return r[46]=(r[40].push(t.i64.to_string(r[44])),r[40])}])}):t.resolve()},function(e){return r[42]=r[40].join(","),r[37]=r[42]}])},function(e){return r[35].some(function(e){return t.i64.eq(r[28],e)})?r[38]=r[28]:r[38]=void 0,t.i64.neq(r[38],void 0)?r[39]=r[38]:r[39]=void 0,r[25]=r[39]}])},function(e){var n;return t.i64.neq(r[25],void 0)?r[26]=r[25]:r[26]=t.i64.cast([0,0]),t.i64.neq(r[29],void 0)?r[27]=r[29]:r[27]=t.i64.cast([0,1]),n=[o.backupId,o.deviceId,o.mailboxRootKeyBlob,o.ocmfClientStateBlob,void 0,void 0,r[26],r[27],o.epochAuthPublicKeyBlob,o.epochAuthPrivateKeyBlob,o.devicePublicKeyBlob,o.devicePrivateKeyBlob,o.epochStoragePublicKeyBlob,o.epochStoragePrivateKeyBlob,o.obliviousValidationTokenBlob,o.authorityLevel,void 0,void 0],r[2]=n[0],r[3]=n[1],r[4]=n[2],r[5]=n[3],r[6]=n[4],r[7]=n[5],r[8]=n[6],r[9]=n[7],r[10]=n[8],r[11]=n[9],r[12]=n[10],r[13]=n[11],r[14]=n[12],r[15]=n[13],r[16]=n[14],r[17]=n[15],r[18]=n[16],r[19]=n[17]}]))})},function(e){return t.storedProcedure(n("LSFindBackup")).then(function(e){var t;return t=e,r[21]=t[0],t})},function(o){var a;return t.blobs.neq(r[5],void 0)?t.sequence([function(o){var a;return t.i64.neq(r[3],void 0)?t.sequence([function(o){var a;return r[21]!==void 0?t.sequence([function(o){var a;return t.blobs.neq(r[4],void 0)?t.sequence([function(o){return r[30]=t.createArray(),r[39]=(r[30].push(r[21]),r[30]),r[39]=(r[30].push(e[1]),r[30]),r[31]=t.toJSON(r[30]),r[32]=t.createArray(),r[39]=(r[32].push(t.i64.cast([0,32])),r[32]),t.nativeOperation(n("LSGetBlobFromString.nop"),["thread_ope_key","_",e[5]].join("")).then(function(e){var t;return t=e,r[33]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),r[33],void 0,r[4],r[32]).then(function(e){var t;return t=e,r[34]=t[0],t})},function(e){return r[34]?r[35]=!1:r[35]=!0,r[35]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),r[40]="Got null keys while deriving message list OPE key. Returning null blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoUtils] ","",r[40]].join("")),r[39]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoUtils",r[40],r[39],t.i64.cast([0,3]))},function(e){return r[36]=void 0}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[34],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[39]=t[0],r[40]=t[1],t})},function(e){return r[36]=r[39]}])},function(o){var a;return t.blobs.neq(r[36],void 0)?t.sequence([function(o){return t.nativeOperation(n("LSGetBlobFromInt64BE.nop"),e[6]).then(function(e){var t;return t=e,r[39]=t[0],t})},function(e){return t.nativeOperation(n("LSTruncateSortKey.nop"),r[39]).then(function(e){var t;return t=e,r[40]=t[0],t})},function(e){return t.nativeOperation(n("LSOpeEncrypt.nop"),r[36],r[40],t.i64.cast([0,16])).then(function(e){var t;return t=e,r[41]=t[0],t})},function(e){return t.nativeOperation(n("LSBinaryToHex.nop"),r[41]).then(function(e){var t;return t=e,r[42]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),r[31]).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),r[43]).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[44]).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[45]).then(function(e){var t;return t=e,r[46]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),r[21]).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWFpbGJveF9pZF9zY29wZQ=="),r[47]).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[48]).then(function(e){var t;return t=e,r[49]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[49]).then(function(e){var t;return t=e,r[50]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[4]).then(function(e){var t;return t=e,r[51]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWVzc2FnZV9pZF9zY29wZQ=="),r[51]).then(function(e){var t;return t=e,r[52]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[52]).then(function(e){var t;return t=e,r[53]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[53]).then(function(e){var t;return t=e,r[54]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[4]).then(function(e){var t;return t=e,r[55]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),r[55]).then(function(e){var t;return t=e,r[56]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[56]).then(function(e){var t;return t=e,r[57]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[57]).then(function(e){var t;return t=e,r[58]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[5]).then(function(e){var t;return t=e,r[59]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("dGhyZWFkX2lkX3Njb3Bl"),r[59]).then(function(e){var t;return t=e,r[60]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[60]).then(function(e){var t;return t=e,r[61]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[61]).then(function(e){var t;return t=e,r[62]=t[0],t})},function(o){return r[63]=new t.Map,r[63].set("attachment_index_key",r[46]==null?"":r[46]),r[63].set("backup_ent_fbid",e[0]),r[63].set("delivery_object_id",e[1]),r[63].set("device_id",r[3]),r[63].set("mailbox_partial_id",r[50]==null?"":r[50]),r[63].set("media_type",e[3]),r[63].set("message_partial_id",r[54]==null?"":r[54]),r[63].set("product_type",e[2]),r[63].set("salt_partial_id",r[58]==null?"":r[58]),r[63].set("sort_key",r[42]==null?"":r[42]),r[63].set("thread_partial_id",r[62]==null?"":r[62]),r[63].set("isOpenEB",e[10]===!0),r[64]=new t.Map,r[64].set("otid",e[4]),r[64].set("server_thread_key",e[7]),r[64].set("timestamp",t.i64.to_string(e[6])),t.nativeOperation(n("LSBase64Encode.nop"),r[5]).then(function(e){var t;return t=e,r[65]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[4]).then(function(e){var t;return t=e,r[66]=t[0],t})},function(o){return r[67]=new t.Map,r[67].set("ocmf_client_state_blob",r[65]==null?"":r[65]),r[67].set("mailbox_root_key",r[66]==null?"":r[66]),r[68]=t.createArray(),r[80]=(r[68].push(e[4]),r[68]),r[80]=(r[68].push(e[1]),r[68]),r[69]=t.toJSON(r[68]),r[63].set("raw_identifiers",r[64]),r[63].set("backup_id",r[21]),r[63].set("thread_id",e[5]),t.nativeOperation(n("LSGetBlobFromString.nop"),r[69]).then(function(e){var t;return t=e,r[70]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),r[70]).then(function(e){var t;return t=e,r[71]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[71]).then(function(e){var t;return t=e,r[72]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[72]).then(function(e){var t;return t=e,r[73]=t[0],t})},function(e){return r[63].set("salt_partial_access_token",r[73]==null?"":r[73]),t.nativeOperation(n("LSGetBlobFromString.nop"),r[31]).then(function(e){var t;return t=e,r[74]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),r[74]).then(function(e){var t;return t=e,r[75]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[5],r[75]).then(function(e){var t;return t=e,r[76]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[76]).then(function(e){var t;return t=e,r[77]=t[0],t})},function(n){var o;return r[63].set("salt_partial_attachment_index_key",r[77]==null?"":r[77]),r[63].set("raw_tokens",r[67]),e[13]!==void 0&&r[63].set("access_token_secret",e[13]),e[14]!==void 0&&r[63].set("primary_key_secret",e[14]),r[78]=t.toJSON(r[63]),r[79]=new t.Map,r[79].set("payload",r[78]),o=[r[79],void 0],r[37]=o[0],r[38]=o[1]}]):t.resolve((r[39]=new t.Map,r[39].set("error_code",t.i64.cast([0,25])),r[39].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[39].set("error_message","OPE key is null for IssueAttachmentRestoreTask"),a=[void 0,r[39]],r[37]=a[0],r[38]=a[1]))},function(e){var t;return t=[r[37],r[38]],r[28]=t[0],r[29]=t[1],t}]):t.resolve((r[30]=new t.Map,r[30].set("error_code",t.i64.cast([0,20])),r[30].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[30].set("error_message","Missing mailbox_root_key for IssueAttachmentRestoreTask"),a=[void 0,r[30]],r[28]=a[0],r[29]=a[1]))},function(e){var t;return t=[r[28],r[29]],r[26]=t[0],r[27]=t[1],t}]):t.resolve((r[28]=new t.Map,r[28].set("error_code",t.i64.cast([0,1])),r[28].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[28].set("error_message","Missing backup_id for IssueAttachmentRestoreTask"),a=[void 0,r[28]],r[26]=a[0],r[27]=a[1]))},function(e){var t;return t=[r[26],r[27]],r[24]=t[0],r[25]=t[1],t}]):t.resolve((r[26]=new t.Map,r[26].set("error_code",t.i64.cast([0,24])),r[26].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[26].set("error_message","Missing device_id for IssueAttachmentRestoreTask"),a=[void 0,r[26]],r[24]=a[0],r[25]=a[1]))},function(e){var t;return t=[r[24],r[25]],r[22]=t[0],r[23]=t[1],t}]):t.resolve((r[24]=new t.Map,r[24].set("error_code",t.i64.cast([0,22])),r[24].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),r[24].set("error_message","Missing ocmf_client_state_blob for IssueAttachmentRestoreTask"),a=[void 0,r[24]],r[22]=a[0],r[23]=a[1]))},function(e){var t;return t=[r[22],r[23]],r[0]=t[0],r[1]=t[1],t}])},function(e){var t;return t=[r[0],r[1]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state"],a.exports=e}),null);
__d("LSCreateResignCDNUrlPayloadStoredProcedure",["LSCreateResignCDNUrlPayload","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSCreateResignCDNUrlPayload"),a.backupEntFbid,a.deliveryObjectId,a.productType,a.mediaType,a.messageId,a.threadId,a.sortOrder,a.serverThreadKey,a.deviceId,a.backupId,a.isOpenEb,a.ocmfClientState,a.mailboxRootKey,a.accessTokenSecret,a.primaryKeySecret);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("EBLSResignCdnUrl",["Base64Utils","EBCreateResignCDNUrlPayload","EBEnqueueResignCdnUrlRequests","EBLS","EBMinosCheckWasmFeatureSupport","EBMinosWasmDeriveAttachmentTokenPrimaryKey","FBLogger","I64","LSCreateResignCDNUrlPayloadStoredProcedure","LSFactory","LSShape","MAWConfig","WAJids","WAResultOrError","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S=function(){return r("FBLogger")("wmi").tags(["labyrinth_web","resign_cdn_url"])},R="-8",L=(v||(v=o("I64"))).of_string(R);async function E(t){var n=t.chatJid,a=t.deliveryObjectId,l=t.externalId,_=t.mediaDownloadFlow,f=t.mediaKey,g=t.mediaType,h=t.sortOrderMs;S().INFO(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL"])));var y=await o("EBMinosCheckWasmFeatureSupport").checkWasmFeatureSupportAndGK();_==null||_.addPoint("resign_cdn_url_gql_ebls_start");var C=(await o("EBLS").init()).db;_==null||_.addPoint("resign_cdn_url_gql_ebls_end");var b=null,R=null;if(y){var E=await o("EBMinosWasmDeriveAttachmentTokenPrimaryKey").deriveAttachmentTokenPrimaryKeySecret(f);E.success?(b=o("Base64Utils").fromArrayBuffer(E.value.accessToken),R=o("Base64Utils").fromArrayBuffer(E.value.primaryKey)):S().WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",""])),E.error)}var k={accessTokenSecret:b,backupEntFbid:L,deliveryObjectId:a,mediaType:g,messageId:l,primaryKeySecret:R,productType:o("MAWConfig").getConfig().productTypeForEBAttachments,sortOrder:(v||(v=o("I64"))).of_float(h),threadId:o("WAJids").threadIdForChatJid(n)};_==null||_.addPoint("resign_cdn_url_gql_payload_start");var I=[C.runInTransaction(function(e){return r("LSCreateResignCDNUrlPayloadStoredProcedure")(r("LSFactory")(e),k)},"readwrite",void 0,void 0,i.id+":108").then(function(e){var t=e[0],n=e[1];if(t!=null)return o("LSShape").toRecord(t);var r=n==null?{}:o("LSShape").toRecord(n);return S().MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to create payload. stored procedure: ",", error code: ",", error message: ",""])),r.stored_procedure,r.error_code,r.error_message),null}).catch(function(e){var t=r("getErrorSafe")(e);return _==null||_.addPoint("resign_cdn_url_gql_lsdb_payload_fail"),S().catching(t).MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Failed to create lsdb payload"]))),null}),o("EBCreateResignCDNUrlPayload").createStringifiedMediaRestorePayloadFromEBDB({accessTokenSecret:b,deliveryObjectId:a,mediaType:g,messageId:l,primaryKeySecret:R,productType:o("MAWConfig").getConfig().productTypeForEBAttachments,sortOrderMs:h,threadId:o("WAJids").threadIdForChatJid(n)}).then(function(e){return e.success?{payload:e.value}:(_==null||_.addPoint("resign_cdn_url_gql_ebdb_payload_fail"),_==null||_.addAnnotations({string:{payload_fail_error:e.error}}),null)}).catch(function(e){var t=r("getErrorSafe")(e);return S().catching(t).MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Failed to create ebdb payload"]))),_==null||_.addAnnotations({string:{payload_fail_error:t.message}}),null})],T=await Promise.all(I),D=T[0],x=T[1],$=D!=null?D:x;if(D==null&&x!=null&&(_==null||_.addPoint("resign_cdn_url_fallback_to_ebdb")),$==null)return _==null||_.addPoint("resign_cdn_url_gql_payload_fail"),o("WAResultOrError").makeError("create-payload-failed");_==null||_.addPoint("resign_cdn_url_gql_payload_end"),_==null||_.addPoint("resign_cdn_url_gql_restore_start");var P=await o("EBEnqueueResignCdnUrlRequests").enqueueResignCdnUrl(a,$,_);return P.success?(_==null||_.addPoint("resign_cdn_url_gql_restore_end"),S().INFO(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL succeeded"]))),o("WAResultOrError").makeResult(P.value)):(S().MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",""])),P.error),_==null||_.addPoint("resign_cdn_url_gql_restore_fail"),P)}function k(e,t){var n=[];for(var r in e){var o=e[r],a=t[r];typeof o=="object"&&o!==null?typeof a!="object"||a===null?n.push(r):n.push.apply(n,k(o,a)):o!==a&&n.push(r)}return n}async function I(e){var t=e.chatJid,n=e.deliveryObjectId,r=e.externalId,a=e.mediaDownloadFlow,i=e.mediaKey,l=e.mediaType,s=e.sortOrderMs,u=await o("EBMinosCheckWasmFeatureSupport").checkWasmFeatureSupportAndGK(),c=null,d=null;if(u){var m=await o("EBMinosWasmDeriveAttachmentTokenPrimaryKey").deriveAttachmentTokenPrimaryKeySecret(i);m.success?(c=o("Base64Utils").fromArrayBuffer(m.value.accessToken),d=o("Base64Utils").fromArrayBuffer(m.value.primaryKey)):S().WARN(_||(_=babelHelpers.taggedTemplateLiteralLoose(["",""])),m.error)}var p={accessTokenSecret:c,chatJid:t,deliveryObjectId:n,externalId:r,mediaDownloadFlow:a,mediaType:l,primaryKeySecret:d,sortOrderMs:s},f=await D(p);if(f==null)return T(p);var g=await $({deliveryObjectId:n,mediaDownloadFlow:a,payload:f});return g.success?g:T(p)}async function T(e){var t;(t=e.mediaDownloadFlow)==null||t.addPoint("resign_cdn_url_fallback_to_ls");var n=await x(e);return n==null?o("WAResultOrError").makeError("create-payload-failed"):$({deliveryObjectId:e.deliveryObjectId,mediaDownloadFlow:e.mediaDownloadFlow,payload:n})}function D(e){var t=e.accessTokenSecret,n=e.chatJid,a=e.deliveryObjectId,i=e.externalId,l=e.mediaDownloadFlow,s=e.mediaType,u=e.primaryKeySecret,c=e.sortOrderMs;return l==null||l.addPoint("resign_cdn_url_gql_payload_start"),o("EBCreateResignCDNUrlPayload").createStringifiedMediaRestorePayloadFromEBDB({accessTokenSecret:t,deliveryObjectId:a,mediaType:s,messageId:i,primaryKeySecret:u,productType:o("MAWConfig").getConfig().productTypeForEBAttachments,sortOrderMs:c,threadId:o("WAJids").threadIdForChatJid(n)}).then(function(e){return e.success?(l==null||l.addPoint("resign_cdn_url_gql_payload_end"),{payload:e.value}):(l==null||l.addAnnotations({string:{payload_fail_error:e.error}}),l==null||l.addPoint("resign_cdn_url_gql_payload_fail"),null)}).catch(function(e){var t=r("getErrorSafe")(e);return S().catching(t).MUSTFIX(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Failed to create payload"]))),l==null||l.addAnnotations({string:{payload_fail_error:t.message}}),l==null||l.addPoint("resign_cdn_url_gql_payload_fail"),null})}function x(e){var t=e.accessTokenSecret,n=e.chatJid,a=e.deliveryObjectId,l=e.externalId,s=e.mediaDownloadFlow,u=e.mediaType,c=e.primaryKeySecret,d=e.sortOrderMs;return s==null||s.addPoint("resign_cdn_url_gql_payload_start"),o("EBLS").init().then(function(e){return e.db.runInTransaction(function(e){return r("LSCreateResignCDNUrlPayloadStoredProcedure")(r("LSFactory")(e),{accessTokenSecret:t,backupEntFbid:L,deliveryObjectId:a,mediaType:u,messageId:l,primaryKeySecret:c,productType:o("MAWConfig").getConfig().productTypeForEBAttachments,sortOrder:(v||(v=o("I64"))).of_float(d),threadId:o("WAJids").threadIdForChatJid(n)})},"readwrite",void 0,void 0,i.id+":365").then(function(e){var t=e[0],n=e[1];if(t!=null)return s==null||s.addPoint("resign_cdn_url_gql_payload_end"),o("LSShape").toRecord(t);var r=n==null?{}:o("LSShape").toRecord(n);return S().MUSTFIX(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Failed to create payload. stored procedure: ",", error code: ",", error message: ",""])),r.stored_procedure,r.error_code,r.error_message),s==null||s.addPoint("resign_cdn_url_gql_payload_fail"),null})}).catch(function(e){var t=r("getErrorSafe")(e);return S().catching(t).MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to create payload"]))),s==null||s.addAnnotations({string:{payload_fail_error:t.message}}),s==null||s.addPoint("resign_cdn_url_gql_payload_fail"),null})}function $(e){var t=e.deliveryObjectId,n=e.mediaDownloadFlow,a=e.payload;return n==null||n.addPoint("resign_cdn_url_gql_restore_start"),o("EBEnqueueResignCdnUrlRequests").enqueueResignCdnUrl(t,a,n).then(function(e){return e.success?(n==null||n.addPoint("resign_cdn_url_gql_restore_end"),S().INFO(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with GraphQL succeeded"]))),e):(S().MUSTFIX(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with GraphQL failed: ",""])),e.error),n==null||n.addPoint("resign_cdn_url_gql_restore_fail"),e)}).catch(function(e){var t=r("getErrorSafe")(e);return S().catching(t).MUSTFIX(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Failed to resign cdn url"]))),n==null||n.addAnnotations({string:{resign_cdn_url_gql_restore_error:t.message}}),n==null||n.addPoint("resign_cdn_url_gql_restore_fail"),o("WAResultOrError").makeError("resign-cdn-url-runtime-error")})}l.DEPRECATED_eblsResignCdnUrlWithGraphQL=E,l.getPayloadMismatches=k,l.resignCdnUrlUsingEbdb=I}),98);
__d("EBLabyrinthWasmReactorSingleton",["EBGetCryptoWasm","WAWasmReactor","memoizeWithArgs"],(function(t,n,r,o,a,i,l){"use strict";var e="Labyrinth_REPL",s=r("memoizeWithArgs")(function(){return o("WAWasmReactor").createWasmInstance(o("EBGetCryptoWasm").getCryptoWasm,e)},function(){return"cache"}),u=async function(t,n){var e=t.InputSpec,r=t.ResultSpec,o=t.validateResult,a=await s();return a.DEPRECATED_createWasmCommand({InputSpec:e,ResultSpec:r,validateResult:o})(n)};l.labyrinthCommand=u}),98);
__d("EBMainThreadEBDBApi",["$InternalEnum","EBDB","EBDBConsistencyApi","FBLogger","LSDatabaseSingleton","WAResolvable","WormDump","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new(o("WAResolvable")).Resolvable;async function u(){var t=await(e||(e=o("LSDatabaseSingleton"))).LSDatabaseSingleton;try{await o("EBDBConsistencyApi").startListeningDeviceRegistrations(t,o("EBDB").EBDBEnvironment.UI)}catch(e){var n=r("getErrorSafe")(e);r("FBLogger")("wmi_eb").catching(n).mustfix("Error on startListeningDeviceRegistrations in UI")}finally{s.resolve(t)}}async function c(e){await o("EBDBConsistencyApi").trackOverprompting(o("EBDB").EBDBEnvironment.UI,e)}async function d(e){var t=await s.promise;await o("EBDBConsistencyApi").addNewDevice(t,o("EBDB").EBDBEnvironment.UI,e)}async function m(){var e,t=await o("EBDB").getEBDB();return t.dump({auto_restore_opt_out:{customFields:{optOutKey:(e=o("WormDump")).wormNonSensitiveField,optOutValue:e.wormNonSensitiveField}},device_metadata:{customFields:{backupId:e.wormNonSensitiveField,deviceRegistrationId:e.wormNonSensitiveField,pk:e.wormNonSensitiveField,taskId:e.wormNonSensitiveField}},device_state:{customFields:{deviceId:e.wormNonSensitiveField,env:e.wormNonSensitiveField}},encrypted_backups:{customFields:{authorityLevel:e.wormNonSensitiveField,backupId:e.wormNonSensitiveField,backupTenancy:e.wormNonSensitiveField,hasOtcEligibleDevices:e.wormNonSensitiveField,isUserOptedOut:e.wormNonSensitiveField,pk:e.wormNonSensitiveField}},encrypted_backups_virtual_devices:{customFields:{backupId:e.wormNonSensitiveField,creationTime:e.wormNonSensitiveField,deviceCreatedOn:e.wormNonSensitiveField,pk:e.wormNonSensitiveField,removalStatus:e.wormNonSensitiveField,requiresHsmMigration:e.wormNonSensitiveField}},experiences_shared_state:{},secure_encrypted_backups_client_state:{customFields:{authorityLevel:e.wormNonSensitiveField,backupId:e.wormNonSensitiveField,backupTenancy:e.wormNonSensitiveField,deviceId:e.wormNonSensitiveField,encryptionVersion:e.wormNonSensitiveField}},secure_encrypted_backups_epochs:{customFields:{authorityLevel:e.wormNonSensitiveField,epochId:e.wormNonSensitiveField,epochStatus:e.wormNonSensitiveField}},secure_encrypted_backups_recovery_code_status:{customFields:{pk:e.wormNonSensitiveField,recoveryCodeStatus:e.wormNonSensitiveField}}})}var p=n("$InternalEnum")({Disabled:0,UIInconsistent:1,WorkerInconsistent:2,Consistent:3});async function _(e,t){var n=await s.promise;o("EBDBConsistencyApi").trackConsistency(n,o("EBDB").EBDBEnvironment.UI,e,function(){var e=p.Disabled,n=o("EBDBConsistencyApi").getDeviceId();return n!=null&&t!=null?e=p.Consistent:n!=null&&t==null?e=p.WorkerInconsistent:n==null&&t!=null&&(e=p.UIInconsistent),{int:{crossEnvConsistency:e}}})}l.startListeningDeviceRegistrations=u,l.trackOverprompting=c,l.addNewDevice=d,l.getEBDBDump=m,l.EBCrossEnvConsistencyResult=p,l.trackConsistency=_}),98);
__d("EBOptOut",["EBAPIQPLPoints","EBDeps","EBSMAPI","ReQL","WAResultOrError","promiseDone","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("encryptedBackupsOptOutOfBackup").__setRef("EBOptOut");function s(t){var n=t.qplFlow;return new Promise(function(t,a){return void e.load().then(async function(e){n.addPoint("eb_opt_out_get_db_start");var a=await o("EBDeps").getDeps().getLSDB();n.addPoint("eb_opt_out_get_db_end"),r("promiseDone")(e.optOutOfBackupStoredProcedure(a),function(e){n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_SPROC_END);var i=a.tables.secure_encrypted_backups_client_state.subscribe(function(){r("promiseDone")(o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state)),function(e){if(e!=null)if(e.length===0)r("promiseDone")(r("EBSMAPI").fetchBackupIds("useEncryptedBackupsOptOutOfBackupDeferred.react").finally(function(){n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_TASK_END),n.endSuccess(),i(),t(o("WAResultOrError").makeResult())}));else{n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_ROW_EXISTS);return}else n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_ROW_NULL),n.endFail("opt_out_backup_row_null"),i(),t(o("WAResultOrError").makeError("EB_OPT_OUT_CLIENT_STATE_NULL"))})})},function(){n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_SPROC_FAIL),n.endFail("opt_out_backup_sproc_fail"),t(o("WAResultOrError").makeError("EB_OPT_OUT_SPROC_FAILURE"))})})})}l.ebOptOut=s}),98);
__d("LSGenerateLocalKeys",["LSArrayGetObjectAt","LSCreateAuthKeyPair.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][generateLocalKeys] Beginning execution."),r[1]=t.i64.of_float(Date.now()),e[0]?t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[29]=new t.Map,r[29].set("error_msg","Expected a nonempty query result"),r[29].set("code",t.i64.cast([0,3])),r[29].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[30]=t.createArray(),r[31]=(r[30].push(r[29]),r[30]),o=[void 0,r[30]],r[17]=o[0],r[18]=o[1]):(n=l.item,r[29]=new t.Map,r[29].set("backup_id",n.backupId),r[29].set("device_public_key_blob",n.devicePublicKeyBlob),r[29].set("device_private_key_blob",n.devicePrivateKeyBlob),r[29].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[29].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[29].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[29].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[29].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[29].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[29].set("orf_client_state_v2_blob",void 0),r[29].set("orf_v2_authority_level",void 0),r[29].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[29].set("device_id",n.deviceId),r[29].set("backup_tenancy",n.backupTenancy),r[29].set("encryption_version",n.encryptionVersion),r[29].set("revision_version",n.revisionVersion),r[29].set("initialize_restore_result",void 0),r[29].set("device_creation_timestamp_sec",void 0),r[29].set("authority_level",n.authorityLevel),a=[r[29],void 0],r[17]=a[0],r[18]=a[1])})},function(e){return r[20]=new t.Map,r[20].set("value",r[17]),r[20].set("errors",r[18]),r[21]=r[20].get("value"),r[21]!==void 0?t.sequence([function(e){return r[29]=r[21].get("backup_id"),r[30]=r[21].get("device_public_key_blob"),r[31]=r[21].get("device_private_key_blob"),r[32]=r[21].get("epoch_storage_public_key_blob"),r[33]=r[21].get("epoch_storage_private_key_blob"),r[34]=r[21].get("epoch_auth_public_key_blob"),r[35]=r[21].get("epoch_auth_private_key_blob"),r[36]=r[21].get("mailbox_root_key_blob"),r[37]=r[21].get("ocmf_client_state_blob"),r[38]=r[21].get("orf_client_state_v2_blob"),r[39]=r[21].get("orf_v2_authority_level"),r[40]=r[21].get("oblivious_validation_token_blob"),r[41]=r[21].get("device_id"),r[42]=r[21].get("backup_tenancy"),r[43]=r[21].get("encryption_version"),r[44]=r[21].get("revision_version"),r[45]=r[21].get("initialize_restore_result"),r[46]=r[21].get("device_creation_timestamp_sec"),r[47]=r[21].get("authority_level"),t.i64.neq(r[41],void 0)?t.sequence([function(e){return r[55]=void 0,t.i64.neq(r[55],void 0)?t.resolve(r[56]=r[55]):t.sequence([function(e){return r[59]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[60]=t[0],t})},function(e){return r[60]&&(r[69]=(r[59].push(t.i64.cast([0,0])),r[59])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[61]=t[0],t})},function(e){return r[61]&&(r[69]=(r[59].push(t.i64.cast([0,2])),r[59])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[62]=t[0],t})},function(e){return r[62]&&(r[69]=(r[59].push(t.i64.cast([0,3])),r[59])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[63]=t[0],t})},function(e){return r[63]&&(r[69]=(r[59].push(t.i64.cast([0,4])),r[59])),r[64]=t.createArray(),r[65]=t.i64.of_int32(r[59].length),t.i64.gt(r[65],t.i64.cast([0,0]))?t.loopAsync(r[65],function(e){return r[69]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[59],r[69]).then(function(e){var t;return t=e,r[70]=t[0],r[71]=t[1],t})},function(e){return r[72]=(r[64].push(r[70]),r[64])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[69]=t.createArray(),r[70]=t.i64.of_int32(r[64].length),t.i64.gt(r[70],t.i64.cast([0,0]))?t.loopAsync(r[70],function(e){return r[72]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[64],r[72]).then(function(e){var t;return t=e,r[73]=t[0],r[74]=t[1],t})},function(e){return r[75]=(r[69].push(t.i64.to_string(r[73])),r[69])}])}):t.resolve()},function(e){return r[71]=r[69].join(","),r[66]=r[71]}])},function(e){return r[64].some(function(e){return t.i64.eq(r[43],e)})?r[67]=r[43]:r[67]=void 0,t.i64.neq(r[67],void 0)?r[68]=r[67]:r[68]=void 0,r[56]=r[68]}])},function(e){var n;return t.i64.neq(r[56],void 0)?r[57]=r[56]:r[57]=t.i64.cast([0,0]),t.i64.neq(r[42],void 0)?r[58]=r[42]:r[58]=t.i64.cast([0,1]),n=[!0,r[30],r[31],r[32],r[33],r[34],r[35]],r[48]=n[0],r[49]=n[1],r[50]=n[2],r[51]=n[3],r[52]=n[4],r[53]=n[5],r[54]=n[6]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] Fetching keys locally failed. Reason: 24"),r[56]="Fetching keys locally failed. Reason: 24",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] ","",r[56]].join("")),r[55]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateLocalKeysStoredProcedure",r[56],r[55],t.i64.cast([0,3]))},function(e){var n;return n=[!1,t.blob("ZGV2aWNlX3B1YmxpY19rZXk="),t.blob("ZGV2aWNlX3ByaXZhdGVfa2V5"),t.blob("ZXBvY2hfc3RvcmFnZV9wdWJsaWNfa2V5"),t.blob("ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),t.blob("ZXBvY2hfYXV0aF9wdWJsaWNfa2V5"),t.blob("ZXBvY2hfYXV0aF9wcml2YXRlX2tleQ==")],r[48]=n[0],r[49]=n[1],r[50]=n[2],r[51]=n[3],r[52]=n[4],r[53]=n[5],r[54]=n[6],n}])},function(e){var t;return t=[r[48],r[49],r[50],r[51],r[52],r[53],r[54]],r[22]=t[0],r[23]=t[1],r[24]=t[2],r[25]=t[3],r[26]=t[4],r[27]=t[5],r[28]=t[6],t}]):t.sequence([function(e){return r[29]=r[20].get("errors"),r[30]=r[20].get("errors"),(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] Fetching keys locally failed. Reason: 1"),r[32]="Fetching keys locally failed. Reason: 1",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] ","",r[32]].join("")),r[31]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateLocalKeysStoredProcedure",r[32],r[31],t.i64.cast([0,3]))},function(e){var n;return n=[!1,t.blob("ZGV2aWNlX3B1YmxpY19rZXk="),t.blob("ZGV2aWNlX3ByaXZhdGVfa2V5"),t.blob("ZXBvY2hfc3RvcmFnZV9wdWJsaWNfa2V5"),t.blob("ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),t.blob("ZXBvY2hfYXV0aF9wdWJsaWNfa2V5"),t.blob("ZXBvY2hfYXV0aF9wcml2YXRlX2tleQ==")],r[22]=n[0],r[23]=n[1],r[24]=n[2],r[25]=n[3],r[26]=n[4],r[27]=n[5],r[28]=n[6],n}])},function(e){var t;return t=[r[22],r[23],r[24],r[25],r[26],r[27],r[28]],r[2]=t[0],r[3]=t[1],r[4]=t[2],r[5]=t[3],r[6]=t[4],r[7]=t[5],r[8]=t[6],t}]):t.sequence([function(e){return t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[17]=t[0],r[18]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[19]=t[0],r[20]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateAuthKeyPair.nop")).then(function(e){var t;return t=e,r[21]=t[0],r[22]=t[1],t})},function(e){var t;return t=[!0,r[18],r[17],r[20],r[19],r[22],r[21]],r[2]=t[0],r[3]=t[1],r[4]=t[2],r[5]=t[3],r[6]=t[4],r[7]=t[5],r[8]=t[6],t}])},function(e){var o;return r[2]?t.sequence([function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[4],t.blob("MA=="),r[5]).then(function(e){var t;return t=e,r[17]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[4],t.blob("MQ=="),r[7]).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){var n;return r[19]=new t.Map,r[19].set("device_private_key",r[4]),r[19].set("device_public_key",r[3]),r[20]=new t.Map,r[20].set("epoch_storage_private_key",r[6]),r[20].set("epoch_storage_public_key",r[5]),r[21]=new t.Map,r[21].set("epoch_auth_private_key",r[8]),r[21].set("epoch_auth_public_key",r[7]),r[22]=new t.Map,r[22].set("device_key",r[19]),r[22].set("epoch_storage_key",r[20]),r[22].set("epoch_storage_public_key_sig",r[17]==null?t.blob("bnVsbA=="):r[17]),r[22].set("epoch_auth_key",r[21]),r[22].set("epoch_auth_public_key_sig",r[18]==null?t.blob("bnVsbA=="):r[18]),n=[r[22],void 0],r[9]=n[0],r[10]=n[1]}]):t.resolve((r[17]=new t.Map,r[17].set("error_code",t.i64.cast([0,9])),r[17].set("stored_procedure","LSEncryptedBackupsGenerateLocalKeysStoredProcedure"),r[17].set("error_message",""),o=[void 0,r[17]],r[9]=o[0],r[10]=o[1]))},function(e){return r[11]=t.i64.of_float(Date.now()),r[12]=t.i64.random(),r[14]="Finishing execution. Execution time: ",r[15]=t.i64.to_string(t.i64.sub(r[11],r[0])),r[16]=" ms",r[13]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][generateLocalKeys] ",r[13],r[14],r[13],r[15],r[13],r[16]].join("")),t.i64.eq(t.i64.mod_(r[12],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[17]=",",r[18]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"generateLocalKeys",[r[14],r[17],r[15],r[17],r[16]].join(""),r[18],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[9],r[10]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGenerateLocalKeysStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state"],a.exports=e}),null);
__d("LSFinishAddPeerDevice",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateSignature_v2.nop","LSDeleteBackupOnClient","LSGenerateLocalKeys","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Beginning execution."),t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[8]=t[0],t})},function(e){return r[8]?r[9]=!0:r[9]=!1,r[9]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[11]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[11]].join("")),r[10]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[11],r[10],t.i64.cast([0,3]))):t.resolve()}])},function(o){return t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}).next().then(function(o,a){var i=o.done,l=o.value;return i?t.sequence([function(e){return t.db.table(168).fetch().next().then(function(e,r){var o=e.done,a=e.value;return o?0:(r=a.item,t.storedProcedure(n("LSDeleteBackupOnClient"),r.backupId,void 0,!1,void 0,"null",!0))})},function(o){return r[8]=e[0].get("backup_id"),t.storedProcedure(n("LSGenerateLocalKeys"),!1).then(function(e){var t;return t=e,r[9]=t[0],r[10]=t[1],t})},function(o){return r[9]!==void 0?t.sequence([function(e){return r[11]=r[9].get("device_key"),r[12]=r[9].get("epoch_storage_key"),r[13]=r[9].get("epoch_auth_key"),r[14]=r[11].get("device_private_key"),r[15]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return r[16]&&(r[44]=(r[15].push(t.i64.cast([0,0])),r[15])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[17]=t[0],t})},function(e){return r[17]&&(r[44]=(r[15].push(t.i64.cast([0,2])),r[15])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return r[18]&&(r[44]=(r[15].push(t.i64.cast([0,3])),r[15])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[19]=t[0],t})},function(e){return r[19]&&(r[44]=(r[15].push(t.i64.cast([0,4])),r[15])),r[20]="",r[21]=t.i64.of_int32(r[15].length),t.i64.gt(r[21],t.i64.cast([0,0]))?t.loopAsync(r[21],function(e){return r[44]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[15],r[44]).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return r[20]=[r[20],"_",t.i64.to_string(r[45])].join("")}])}):t.resolve()},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),["supported_versions_",r[20],"revision_version_",t.i64.to_string(t.i64.cast([0,1]))].join("")).then(function(e){var t;return t=e,r[22]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[14],t.blob("Mg=="),r[22]).then(function(e){var t;return t=e,r[23]=t[0],t})},function(e){return t.blobs.neq(r[23],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[23]).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return r[24]=r[44]}]):t.resolve(r[24]=void 0)},function(o){return r[25]=e[0].get("temp_ocmf_client_state"),t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),r[25]).then(function(e){var t;return t=e,r[26]=t[0],r[27]=t[1],t})},function(e){var o;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,r[44]=t[0],r[45]=t[1],t})},function(e){var t;return t=[r[26],r[27],r[44],r[45]],r[28]=t[0],r[29]=t[1],r[30]=t[2],r[31]=t[3],t}]):t.resolve((o=[r[26],r[27],void 0,void 0],r[28]=o[0],r[29]=o[1],r[30]=o[2],r[31]=o[3],o))},function(n){return r[32]=r[11].get("device_public_key"),r[33]=r[11].get("device_private_key"),r[34]=r[12].get("epoch_storage_public_key"),r[35]=r[12].get("epoch_storage_private_key"),r[36]=r[13].get("epoch_auth_public_key"),r[37]=r[13].get("epoch_auth_private_key"),r[38]=e[0].get("mailbox_root_key"),r[39]=e[0].get("oblivious_validation_token"),t.forEach(t.filter(t.db.table(168).fetch([[[r[8]]]]),function(e){return t.i64.eq(e.backupId,r[8])&&t.i64.lt(e.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(e){return t.db.table(168).add({backupId:r[8],devicePublicKeyBlob:r[32],devicePrivateKeyBlob:r[33],epochStoragePublicKeyBlob:r[34],epochStoragePrivateKeyBlob:r[35],epochAuthPublicKeyBlob:r[36],epochAuthPrivateKeyBlob:r[37],mailboxRootKeyBlob:r[38],ocmfClientStateBlob:r[28],obliviousValidationTokenBlob:r[39],authorityLevel:t.i64.cast([0,20]),backupTenancy:t.i64.cast([0,1]),revisionVersion:t.i64.cast([0,1]),encryptionVersion:t.i64.cast([0,0])})},function(o){return r[40]=e[0].get("add_peer_epoch_data"),r[41]=t.i64.of_int32(r[40].length),t.i64.gt(r[41],t.i64.cast([0,0]))?t.loopAsync(r[41],function(e){return r[44]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[40],r[44]).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return r[47]=r[45].get("epoch_id"),r[48]=r[45].get("epoch_anon_id"),r[49]=r[45].get("epoch_root_key"),r[50]=r[45].get("epoch_status"),r[51]=r[45].get("epoch_head"),t.forEach(t.filter(t.db.table(169).fetch([[[r[47]]]]),function(e){return t.i64.eq(e.epochId,r[47])&&t.i64.lt(e.authorityLevel,t.i64.cast([0,80]))}),function(e){return e.delete()})},function(e){return t.db.table(169).add({epochId:r[47],authorityLevel:t.i64.cast([0,80]),backupId:r[8],epochAnonIdBlob:r[48],epochRootKeyBlob:r[49],epochStatus:r[50],epochHead:r[51]})}])}):t.resolve()},function(e){return t.count(t.db.table(169).fetch()).then(function(e){return r[42]=e})},function(e){return t.i64.le(r[42],t.i64.cast([0,1]))?t.sequence([function(e){return t.db.table(169).fetch().next().then(function(e,o){var a=e.done,i=e.value;return a?t.sequence([function(e){return r[46]="No epoch available in epochs table",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",r[46]].join("")),r[47]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[r[46]].join(""),r[47],t.i64.cast([0,3]))},function(e){return r[44]=void 0}]):(o=i.item,r[46]=new t.Map,r[46].set("epoch_id",o.epochId),r[46].set("backup_id",o.backupId),r[46].set("epoch_anon_id_blob",o.epochAnonIdBlob),r[46].set("epoch_root_key_blob",o.epochRootKeyBlob),r[46].set("epoch_status",o.epochStatus),r[46].set("epoch_head",o.epochHead),r[46].set("authority_level",o.authorityLevel),r[44]=r[46])})},function(e){return r[43]=r[44]}]):t.sequence([function(e){return r[44]="Multiple epochs available in epochs table",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",r[44]].join("")),r[45]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[r[44]].join(""),r[45],t.i64.cast([0,3]))},function(e){return r[43]=void 0}])},function(o){return r[43]!==void 0?t.sequence([function(e){return r[44]=r[43].get("epoch_anon_id_blob"),r[45]=r[43].get("epoch_root_key_blob"),r[46]=r[11].get("device_public_key"),r[47]=t.createArray(),r[51]=(r[47].push(t.i64.cast([0,32])),r[47]),t.nativeOperation(n("LSBase64Encode.nop"),r[44]).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return r[48]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",r[48]].join("")),void 0,r[45],r[47]).then(function(e){var t;return t=e,r[51]=t[0],t})},function(e){return r[51]?r[52]=!1:r[52]=!0,r[52]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),r[55]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[55]].join("")),r[54]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[55],r[54],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[56]=t[0],t})},function(e){return r[53]=r[56]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[51],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[54]=t[0],r[55]=t[1],t})},function(e){return r[53]=r[54]}])},function(e){return r[49]=r[53]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),r[52]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[52]].join("")),r[51]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[52],r[51],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[53]=t[0],t})},function(e){return r[49]=r[53]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),r[49],r[46]).then(function(e){var t;return t=e,r[50]=t[0],t})},function(o){return t.blobs.neq(r[50],void 0)?t.sequence([function(e){return r[51]=r[11].get("device_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[51]).then(function(e){var t;return t=e,r[52]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[50]).then(function(e){var t;return t=e,r[53]=t[0],t})},function(e){return r[54]=r[43].get("epoch_root_key_blob"),t.blobs.neq(r[54],void 0)?t.sequence([function(e){return r[81]=t.createArray(),r[87]=(r[81].push(t.i64.cast([0,18])),r[81]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,r[54],r[81]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return r[82]!==void 0?t.sequence([function(e){return r[87]=t.i64.of_int32(r[82].length),t.i64.ge(r[87],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[82],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[89]=t[0],r[90]=t[1],t})},function(e){return r[88]=r[89]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[90]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[90]].join("")),r[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[90],r[89],t.i64.cast([0,3]))},function(e){return r[88]=void 0}])},function(e){return r[83]=r[88]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[88]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[88]].join("")),r[87]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[88],r[87],t.i64.cast([0,3]))},function(e){return r[83]=void 0}])},function(e){return t.blobs.neq(r[83],void 0)?r[84]=!0:r[84]=!1,r[84]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),r[83]).then(function(e){var t;return t=e,r[85]=t[0],t})},function(e){return r[85]!==void 0?r[86]=r[85]:r[86]="encodingfailed",r[55]=r[86]}]):t.resolve(r[55]="null")},function(e){return r[56]=r[12].get("epoch_storage_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[56]).then(function(e){var t;return t=e,r[57]=t[0],t})},function(e){return r[58]=r[9].get("epoch_storage_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),r[58]).then(function(e){var t;return t=e,r[59]=t[0],t})},function(e){return r[60]=r[13].get("epoch_auth_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[60]).then(function(e){var t;return t=e,r[61]=t[0],t})},function(e){return r[62]=r[9].get("epoch_auth_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),r[62]).then(function(e){var t;return t=e,r[63]=t[0],t})},function(o){return r[64]=r[11].get("device_private_key"),r[65]=e[0].get("mailbox_root_key"),r[66]=r[12].get("epoch_storage_private_key"),t.blobs.neq(r[65],void 0)?t.sequence([function(e){return r[81]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),r[65],"private_key",r[64],t.i64.cast([0,1]),r[81]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.blobs.neq(r[82],void 0)?r[83]=r[82]:r[83]=void 0,r[67]=r[83]}]):t.resolve(r[67]=void 0)},function(e){return t.blobs.neq(r[67],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[67]).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[68]=r[81]}]):t.resolve(r[68]=void 0)},function(e){return t.blobs.neq(r[65],void 0)?t.sequence([function(e){return r[81]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),r[65],"ocmf_client_state",r[28],t.i64.cast([0,1]),r[81]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.blobs.neq(r[82],void 0)?r[83]=r[82]:r[83]=void 0,r[69]=r[83]}]):t.resolve(r[69]=void 0)},function(e){return t.blobs.neq(r[69],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[69]).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[70]=r[81]}]):t.resolve(r[70]=void 0)},function(e){return t.blobs.neq(r[65],void 0)?t.sequence([function(e){return r[81]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),r[65],"epoch_storage_private_key",r[66],t.i64.cast([0,1]),r[81]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.blobs.neq(r[82],void 0)?r[83]=r[82]:r[83]=void 0,r[71]=r[83]}]):t.resolve(r[71]=void 0)},function(e){return t.blobs.neq(r[71],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[71]).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[72]=r[81]}]):t.resolve(r[72]=void 0)},function(o){return r[73]=e[0].get("backup_id"),t.nativeOperation(n("LSBase64Encode.nop"),r[29]).then(function(e){var t;return t=e,r[74]=t[0],t})},function(o){return r[75]=e[0].get("server_data_id"),r[76]=r[43].get("epoch_id"),r[77]=new t.Map,r[77].set("supported_encryption_versions",r[15]),r[77].set("client_version",t.i64.cast([0,1])),r[77].set("version_sig",r[24]==null?"":r[24]),r[78]=new t.Map,r[78].set("backup_id",r[73]),r[78].set("device_epoch_hmac",r[53]==null?"":r[53]),r[78].set("epoch_root_key_fingerprint",r[55]),r[78].set("device_public_key",r[52]==null?"":r[52]),r[78].set("epoch_auth_pubkey",r[61]==null?"":r[61]),r[78].set("epoch_auth_pubkey_sig",r[63]==null?"":r[63]),r[78].set("epoch_storage_pubkey",r[57]==null?"":r[57]),r[78].set("epoch_storage_pubkey_sig",r[59]==null?"":r[59]),r[78].set("ocmf_rotation_token",r[74]==null?"":r[74]),r[78].set("server_data_id",r[75]),r[78].set("device_registration_id",e[1]),r[78].set("base_epoch_id",r[76]),r[78].set("encryption_version_data",r[77]),r[78].set("private_key_debug_token",r[68]),r[78].set("ocmf_client_state_debug_token",r[70]),r[78].set("epoch_storage_pvtkey_debug_token",r[72]),r[78].set("trace_id",void 0),r[78].set("occam_only_eligible",!0),r[79]=t.toJSON(r[78]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50017]),r[79],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[80]=t[0],t})}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] $device_epoch_hmac found to be null"),r[51]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","$device_epoch_hmac found to be null",r[51],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSDeleteBackupOnClient"),r[8],"backup_init_flow",!0,void 0,void 0,!1)},function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})}])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! There should be exactly one open epoch. Deleting local state and terminating device addition"),r[44]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! There should be exactly one open epoch. Deleting local state and terminating device addition",r[44],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSDeleteBackupOnClient"),r[8],"backup_init_flow",!0,void 0,void 0,!1)},function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})}])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! Error in generating the keys. Deleting local state and terminating device addition"),r[11]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! Error in generating the keys. Deleting local state and terminating device addition",r[11],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSDeleteBackupOnClient"),r[8],"backup_init_flow",!0,void 0,void 0,!1)},function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})}])}]):(a=l.item,r[8]="An authoritative row already exists, aborting execution of add peer device",r[8]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",r[8]].join("")),r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",r[8],r[9],t.i64.cast([0,3]))):t.resolve())})},function(e){return r[2]=t.i64.of_float(Date.now()),r[3]=t.i64.random(),r[5]="Finishing execution. Execution time: ",r[6]=t.i64.to_string(t.i64.sub(r[2],r[0])),r[7]=" ms",r[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ",r[4],r[5],r[4],r[6],r[4],r[7]].join("")),t.i64.eq(t.i64.mod_(r[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[8]=",",r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[r[5],r[8],r[6],r[8],r[7]].join(""),r[9],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("MWPakeQPLEvents",["qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=r("qpl")._(231349365,"1751");l.pakeInitiatorQplEvent=e}),98);
__d("PAKEMessageQplLoggingAction",[],(function(t,n,r,o,a,i){var e=Object.freeze({ADD_MARKER:0,END_SUCCESS:1,END_FAILURE:2,ADD_ERROR_ANNOTATION:3});i.default=e}),66);
__d("LSQplInteractionHelper.nop",["FBLogger","I64","MWPakeQPLEvents","PAKEMessageQplLoggingAction","Promise","QPLUserFlow"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(a,i,l,u,c){var t=(s||(s=o("I64"))).to_int32(u);switch(t){case r("PAKEMessageQplLoggingAction").ADD_MARKER:l==null?r("FBLogger")("wmi_eb").mustfix("PAKE: markerName is null when adding DS PAKE marker."):r("QPLUserFlow").addPoint(o("MWPakeQPLEvents").pakeInitiatorQplEvent,l);break;case r("PAKEMessageQplLoggingAction").END_FAILURE:l==null?r("FBLogger")("wmi_eb").mustfix("PAKE: markerName is null when adding failure DS PAKE marker."):r("QPLUserFlow").endFailure(o("MWPakeQPLEvents").pakeInitiatorQplEvent,l);break;case r("PAKEMessageQplLoggingAction").END_SUCCESS:r("QPLUserFlow").endSuccess(o("MWPakeQPLEvents").pakeInitiatorQplEvent);break;case r("PAKEMessageQplLoggingAction").ADD_ERROR_ANNOTATION:c==null?r("FBLogger")("wmi_eb").mustfix("PAKE: pakeMessageType is null when annotating PAKE error."):r("QPLUserFlow").addAnnotations(o("MWPakeQPLEvents").pakeInitiatorQplEvent,{int:{errorCode:(s||(s=o("I64"))).to_int32(c)}});break}return(e||(e=n("Promise"))).resolve()};u.__nop_name__="LSQplInteractionHelper",l.default=u}),98);
__d("LSDeserializeSecretsAndAddDevice",["LSArrayGetObjectAt","LSBase64Decode.nop","LSDeserializeFromJsonIntoDictionaryV2.nop","LSFinishAddPeerDevice","LSQplInteractionHelper.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return t.nativeOperation(n("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_START",t.i64.cast([0,0]),void 0)},function(o){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),e[0]).then(function(e){var t;return t=e,r[0]=t[0],t})},function(e){return t.nativeOperation(n("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_END",t.i64.cast([0,0]),void 0)},function(e){return r[1]=r[0].get("temp_ocmf_client_state"),t.nativeOperation(n("LSBase64Decode.nop"),r[1]).then(function(e){var t;return t=e,r[2]=t[0],t})},function(e){return r[3]=r[0].get("mailbox_root_key"),t.nativeOperation(n("LSBase64Decode.nop"),r[3]).then(function(e){var t;return t=e,r[4]=t[0],t})},function(e){return r[5]=r[0].get("oblivious_validation_token"),t.nativeOperation(n("LSBase64Decode.nop"),r[5]).then(function(e){var t;return t=e,r[6]=t[0],t})},function(e){return r[7]=t.createArray(),r[8]=r[0].get("add_peer_epoch_data_serializable"),r[9]=t.i64.of_int32(r[8].length),t.i64.gt(r[9],t.i64.cast([0,0]))?t.loopAsync(r[9],function(e){return r[14]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[8],r[14]).then(function(e){var t;return t=e,r[15]=t[0],r[16]=t[1],t})},function(e){return r[17]=r[15].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Decode.nop"),r[17]).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return r[19]=r[15].get("epoch_root_key"),t.nativeOperation(n("LSBase64Decode.nop"),r[19]).then(function(e){var t;return t=e,r[20]=t[0],t})},function(e){return r[21]=r[15].get("epoch_id"),r[22]=r[15].get("epoch_status"),r[23]=new t.Map,r[23].set("epoch_id",r[21]),r[23].set("epoch_anon_id",r[18]==null?t.blob(""):r[18]),r[23].set("epoch_root_key",r[20]==null?t.blob(""):r[20]),r[23].set("epoch_status",r[22]),r[24]=r[15].get("epoch_head"),r[24]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSBase64Decode.nop"),r[24]).then(function(e){var t;return t=e,r[25]=t[0],t})},function(e){return r[23].set("epoch_head",r[25])}]):t.resolve()},function(e){return r[25]=(r[7].push(r[23]),r[7])}])}):t.resolve()},function(o){return r[10]=r[0].get("backup_id"),r[11]=r[0].get("server_data_id"),r[12]=new t.Map,r[12].set("backup_id",r[10]),r[12].set("server_data_id",r[11]),r[12].set("temp_ocmf_client_state",r[2]==null?t.blob(""):r[2]),r[12].set("mailbox_root_key",r[4]==null?t.blob(""):r[4]),r[12].set("oblivious_validation_token",r[6]==null?t.blob(""):r[6]),r[12].set("add_peer_epoch_data",r[7]),r[12]!==void 0?t.sequence([function(o){return t.storedProcedure(n("LSFinishAddPeerDevice"),r[12],e[1])},function(e){return r[13]=!0}]):t.resolve(r[13]=!1)},function(e){return o[0]=r[13]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsDeserializeSecretsAndAddDeviceStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSDeserializeSecretsAndAddDeviceStoredProcedure",["LSDeserializeSecretsAndAddDevice","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSDeserializeSecretsAndAddDevice"),a.serializedPayload,a.deviceRegistrationId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("EBOtcAddDevice",["EBAPIQPLPoints","EBDeps","EBLogger","EBMainThreadEBDBApiDeferred","I64","LSDeserializeSecretsAndAddDeviceStoredProcedure","LSEncryptedBackupsRecoveryCodeStatus","LSFactory","LSIntEnum","ReQL","WAResultOrError","getSafeQplErrorMessage"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(t){var n=t.initiatorId,a=t.qplFlow,i=t.secrets,l=function(){};a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_START);var u=await o("EBDeps").getDeps().getLSDB();return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_END),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SPROC_START),new Promise(function(t,d){return u.runInTransaction(function(e){return r("LSDeserializeSecretsAndAddDeviceStoredProcedure")(r("LSFactory")(e),{deviceRegistrationId:n,serializedPayload:i})},"readwrite").then(function(n){var i=n[0];if(a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SPROC_END),!i)return a.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SPROC_FAILURE),t(c("OTC_ADD_DEVICE_SPROC_FAILURE"));l=o("ReQL").fromTableAscending(u.tables.secure_encrypted_backups_recovery_code_status).subscribe(function(n,i){if(i.operation==="add"||i.operation==="put"){l();var u=i.value.recoveryCodeStatus;if((e||(e=o("I64"))).equal(u,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsRecoveryCodeStatus").VALID)))a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SUCCESS),a.endSuccess(),o("EBMainThreadEBDBApiDeferred").addNewDevice(),t(c("SUCCESS"));else if((e||(e=o("I64"))).equal(u,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR)))a.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SYSTEM_ERROR),o("EBLogger").EBLogger().mustfix("PAKE: LSEncryptedBackupsFinishAddPeerDeviceTask task failed"),t(c("OTC_ADD_DEVICE_SYSTEM_ERROR"));else{var d="PAKE: Unexpected recovery code status: "+(e||(e=o("I64"))).to_int32(u);a.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_UNEXPECTED_RECOVERY_CODE_STATUS,{string:{errorMessage:d}}),o("EBLogger").EBLogger("wmi_eb").mustfix(d),t(c("OTC_ADD_DEVICE_UNEXPECTED_RECOVERY_CODE_STATUS",d))}}})}).catch(function(e){l(),t(c("OTC_ADD_DEVICE_SPROC_ERROR",o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)))})})}function c(e,t){return e==="SUCCESS"?o("WAResultOrError").makeResult():o("WAResultOrError").makeError({errorMessage:t,status:e})}l.otcAddDevice=u}),98);
__d("EBParseUploadSerializationPayload",["EBLogger","MAWEBUploadTrackingUtils","WAErrorMessage","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("EBLogger").EBLogger().tags(["parseUploadSerializationResponse"]);function c(t){try{var n=JSON.parse(t);return o("WAResultOrError").makeResult(n)}catch(t){var r=o("WAErrorMessage").maybeGetMessageFromError(t);return u.MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["parseUploadSerializationResponse: ",""])),r),o("WAResultOrError").makeError("parse_exception")}}function d(e,t,n){var r=[],a=[];if(e.forEach(function(e){var n=e.error_code+": "+e.error_message;u.MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["EB upload "," serializer error: ",""])),t,n),r.push(e.error_code),a.push(e.error_message)}),n!=null){var i,l;o("MAWEBUploadTrackingUtils").addPointWorkerOnly(n,t+"_upload_task_serialization_failure",{int_array:(i={},i[t+"_serialization_error_codes"]=r,i),string_array:(l={},l[t+"_serialization_errors"]=a,l)})}}l.parseUploadSerializationResponse=c,l.logUploadSerializationErrors=d}),98);
__d("EBPrewarmSenderUploadQueue",["EBSenderUploadQueue"],(function(t,n,r,o,a,i,l){"use strict";function e(){o("EBSenderUploadQueue").ebSenderUploadQueue()}l.prewarmSenderUploadQueue=e}),98);
__d("EBRepairEpochQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="25352669137720538"}),null);
__d("EBRepairEpochQuery.graphql",["EBRepairEpochQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null}],r={alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"request",variableName:"input"}],concreteType:"XFBRepairEpochResponse",kind:"LinkedField",name:"repair_epoch",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_success",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"target_device_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_sync_reason",storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:t,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:t,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null},{alias:null,args:null,concreteType:"XFBMinosEpoch",kind:"LinkedField",name:"to_minos_epoch",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"epoch_head",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"self_epoch_signature",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"error_code",storageKey:null}],storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"EBRepairEpochQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[r],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"EBRepairEpochQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:n("EBRepairEpochQuery_facebookRelayOperation"),metadata:{},name:"EBRepairEpochQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("EBRepairEpochQuery",["EBRepairEpochQuery.graphql","WAResultOrError","createWorkerQuery"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var a,i=e!==void 0?e:e=n("EBRepairEpochQuery.graphql"),l=await r("createWorkerQuery")(i,{input:t}),s=l==null||(a=l.viewer)==null||(a=a.encrypted_backup)==null||(a=a.mailbox)==null?void 0:a.repair_epoch;return(s==null?void 0:s.is_success)===!0&&(s==null?void 0:s.epoch_derivation_set)!=null?o("WAResultOrError").makeResult(s.epoch_derivation_set):(s==null?void 0:s.exception_string)!=null?o("WAResultOrError").makeError({errorCode:s.error_code,message:s.exception_string}):o("WAResultOrError").makeError({message:"Repair epoch failed"})}l.RepairEpochQuery=s}),98);
__d("EBRepairEpochs",["Base64Utils","EBAPIQPLPoints","EBDeps","EBDeriveAndStoreEpochs","EBEpochUtils","EBGetClientState","EBRepairEpochQuery","I64","LSAuthorityLevel","LSIntEnum","QPLFlow","Random","ReQL","WAResultOrError","getErrorSafe","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(){var t=await o("EBDeps").getDeps().getLSDB(),n=o("Random").uint32(),a=String(n),i=o("QPLFlow").startQPLFlow(r("qpl")._(521474335,"1476"),{annotations:{string:{traceId:a}},instanceKey:n});try{i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.GET_CLIENT_STATE_START);var l=await o("EBGetClientState").getClientState(t);if(i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.GET_CLIENT_STATE_END),l==null)return i.endFail("client_state_is_missing"),o("WAResultOrError").makeError({message:"Client state is missing"});var u=l.backupId,c=l.deviceId;if(u==null||c==null)return i.endFail("backup_id_or_device_id_is_missing"),o("WAResultOrError").makeError({message:"Backup ID or device ID is missing"});i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.GET_EPOCHS_START);var d=await o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.tables.secure_encrypted_backups_epochs));i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.GET_EPOCHS_END);var m=await Promise.all(d.filter(function(t){return(e||(e=o("I64"))).equal(t.authorityLevel,(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))}).map(async function(t){var n=await o("EBEpochUtils").getFingerPrint(t.epochRootKeyBlob,"MEBEpochRootKey");return{epoch_id:(e||(e=o("I64"))).to_string(t.epochId),fingerprint:{sensitive_string_value:o("Base64Utils").fromArrayBuffer(n)}}}));i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.REPAIR_EPOCH_QUERY_START);var p=await o("EBRepairEpochQuery").RepairEpochQuery({backup_id:u,device_id:c,locally_available_epochs:m,trace_id:a});if(i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.REPAIR_EPOCH_QUERY_END),!p.success){var _;return i.endFail("repair_epoch_query_failed",{string:{error_code:String((_=p.error.errorCode)!=null?_:"none"),error_message:p.error.message}}),p}return i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.DERIVE_AND_STORE_EPOCHS_START),await o("EBDeriveAndStoreEpochs").deriveAndStoreEpochsNonLS(t,p.value),i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.DERIVE_AND_STORE_EPOCHS_END),i.endSuccess(),p}catch(e){var f=r("getErrorSafe")(e);return i.endFail("runtime_error",{string:{error_message:f.message}}),o("WAResultOrError").makeError({message:f.message})}}l.EBRepairEpochs=u}),98);
__d("LSGetRemoveVirtualDeviceRequestStatus",["LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return t.islc(t.filter(t.db.table(184).fetch(),function(n){return t.blobs.eq(n.virtualDeviceId,e[0])}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(o,a){var i=o.done,l=o.value;return i?r[0]=t.i64.cast([0,3]):(a=l.item,t.sequence([function(o){return r[3]=a.removalStatus,t.i64.eq(r[3],t.i64.cast([0,1]))?t.resolve(r[2]=t.i64.cast([0,1])):t.sequence([function(o){return t.i64.eq(r[3],t.i64.cast([0,2]))?t.resolve(r[4]=t.i64.cast([0,0])):t.sequence([function(o){return t.i64.eq(r[3],t.i64.cast([0,3]))?t.resolve(r[5]=t.i64.cast([0,2])):t.sequence([function(o){return r[6]=["Unknown RemoveVirtualDeviceStatus found ",t.i64.to_string(r[3])].join(""),r[6]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGetRemoveVirtualDeviceRequestStatusStoredProcedure] ","",r[6]].join("")),r[7]=t.createArray(),e[1]!==void 0&&(r[8]=(r[7].push(e[1]),r[7])),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetRemoveVirtualDeviceRequestStatusStoredProcedure",r[6],r[7],t.i64.cast([0,3]))):t.resolve()},function(e){return r[5]=t.i64.cast([-1,4294967295])}])},function(e){return r[4]=r[5]}])},function(e){return r[2]=r[4]}])},function(e){return r[0]=r[2]}]))})},function(e){return o[0]=r[0]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGetRemoveVirtualDeviceRequestStatusStoredProcedure",e.__tables__=["encrypted_backups_virtual_devices"],a.exports=e}),null);
__d("LSGetRemoveVirtualDeviceRequestStatusStoredProcedure",["LSGetRemoveVirtualDeviceRequestStatus","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSGetRemoveVirtualDeviceRequestStatus"),a.virtualDeviceId,a.traceId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSRemoveVirtualDevice",["LSAppendDataTraceAddon","LSBase64Encode.nop","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[5]=t[0],t})},function(e){return r[5]?r[6]=!0:r[6]=!1,r[6]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[8]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[8]].join("")),r[7]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[8],r[7],t.i64.cast([0,3]))):t.resolve()}])},function(n){return e[1]!==void 0?r[0]=e[1]:r[0]="vd_removal:remove_vd_task",t.islc(t.filter(t.db.table(184).fetch(),function(n){return t.blobs.eq(n.virtualDeviceId,e[0])}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[1]=n[0],r[2]=n[1],n):(t=i.item,o=[t.pk,t.backupId],r[1]=o[0],r[2]=o[1])})},function(o){return t.i64.neq(r[2],void 0)?t.sequence([function(o){return t.nativeOperation(n("LSBase64Encode.nop"),e[0]).then(function(e){var t;return t=e,r[5]=t[0],t})},function(e){return r[6]=new t.Map,r[6].set("backup_id",r[2]),r[6].set("virtual_device_id",r[5]==null?"":r[5]),r[6].set("removal_reason",r[0]),r[6].set("trace_id",void 0),r[7]=t.toJSON(r[6]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_encrypted_backups",t.i64.cast([0,50024]),r[7],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[8]=t[0],t})},function(e){return t.i64.neq(r[1],void 0)?t.forEach(t.db.table(184).fetch([[[r[1]]]]),function(e){var n=e.update,r=e.item;return n({removalStatus:t.i64.cast([0,2])})}):t.resolve()},function(e){return r[4]=t.i64.cast([0,0])}]):t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[6]=t[0],t})},function(e){return r[6]?r[7]=!0:r[7]=!1,r[7]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[9]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[9]].join("")),r[8]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[9],r[8],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[5]="Backup not found",r[5]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsRemoveVirtualDeviceStoredProcedure] ","",r[5]].join("")),r[6]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsRemoveVirtualDeviceStoredProcedure",r[5],r[6],t.i64.cast([0,3]))):t.resolve()},function(e){return r[4]=t.i64.cast([0,1])}])},function(e){return o[0]=r[4]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsRemoveVirtualDeviceStoredProcedure",e.__tables__=["encrypted_backups_virtual_devices"],a.exports=e}),null);
__d("LSRemoveVirtualDeviceStoredProcedure",["LSRemoveVirtualDevice","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSRemoveVirtualDevice"),a.virtualDeviceId,a.removalReason,a.traceId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("EBRevokeVirtualDevice",["Base64Utils","EBAPIQPLPoints","EBDeps","I64","LSEncryptedBackupsOpStatus","LSFactory","LSGetRemoveVirtualDeviceRequestStatusStoredProcedure","LSIntEnum","LSRemoveVirtualDeviceStoredProcedure","WAResultOrError","getSafeQplErrorMessage"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(t,n){var a,i=function(){},l=(a=n.getQPLAttrs().instanceKey.toString())!=null?a:"";n.addPoint(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_DB_START);var u=await o("EBDeps").getDeps().getLSDB();n.addPoint(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_DB_END);var c=o("Base64Utils").toArrayBuffer(t),d=function(t){return u.runInTransaction(function(e){return r("LSGetRemoveVirtualDeviceRequestStatusStoredProcedure")(r("LSFactory")(e),{traceId:l,virtualDeviceId:t})},"readonly").then(function(e){return e[0]})};return u.runInTransaction(function(e){return r("LSRemoveVirtualDeviceStoredProcedure")(r("LSFactory")(e),{traceId:l,virtualDeviceId:c})},"readwrite").then(function(t){var a=t[0];return(e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").SUCCESS))?new Promise(function(e,t){i=u.tables.encrypted_backups_virtual_devices.subscribe(function(){d(c).then(function(t){switch((s||(s=o("LSIntEnum"))).toNumber(t)){case 0:return;case 2:case-1:i(),n.endFail(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_STATUS_INTERNAL_ERROR),e(o("WAResultOrError").makeError("REVOKE_VIRTUAL_DEVICE_GET_STATUS_INTERNAL_ERROR"));return;case 1:case 3:i(),n.endSuccess(),e(o("WAResultOrError").makeResult());return}}).catch(function(t){i(),n.endFail(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_DB_ERROR,{string:{errorMessage:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(t)}}),e(o("WAResultOrError").makeError("REVOKE_VIRTUAL_DEVICE_GET_SPROC_ERROR"))})})}):(i(),n.endFail(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_SPROC_FAILURE),o("WAResultOrError").makeError("REVOKE_VIRTUAL_DEVICE_SPROC_FAILURE"))},function(e){return i(),n.endFail(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_SPROC_ERROR,{string:{errorMessage:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)}}),o("WAResultOrError").makeError("REVOKE_VIRTUAL_DEVICE_SPROC_FAILURE")})}l.revokeVirtualDevice=u}),98);
__d("EBSetRestoreStatusForInitialRestore",["I64","LSEncryptedBackupsClientRestoreState","LSIntEnum","ReQL","WAJids","performanceAbsoluteNow"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;async function c(t,n){var a=await o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(n.tables.encrypted_backups_client_restore_status).map(function(e){var t=e.threadId;return t}));return n.runInTransaction(async function(n){var i=[],l=[];a.forEach(function(e){i.push(n.encrypted_backups_client_restore_status.delete(e))}),await Promise.all(i),t.forEach(function(t){l.push(n.encrypted_backups_client_restore_status.put({lastUpdated:(u||(u=o("I64"))).of_float((e||(e=r("performanceAbsoluteNow")))()),restoreStatus:(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsClientRestoreState").RESTORE_IN_PROGRESS),threadId:o("WAJids").threadIdForChatJid(t)}))}),await Promise.all(l)},"readwrite",void 0,void 0,i.id+":37")}async function d(e){var t=await o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.tables.encrypted_backups_client_restore_status).map(function(e){var t=e.threadId;return t}));return e.runInTransaction(async function(e){var n=[];t.forEach(function(t){n.push(e.encrypted_backups_client_restore_status.delete(t))}),await Promise.all(n)},"readwrite",void 0,void 0,i.id+":75")}l.setRestoreStatusForInitialRestore=c,l.resetClientRestoreStatus=d}),98);
__d("LSSyncEpochs",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(e){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] Beginning execution."),t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[13]=t[0],t})},function(e){return r[13]?r[14]=!0:r[14]=!1,r[14]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[16]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[16]].join("")),r[15]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[16],r[15],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!1}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[13]=new t.Map,r[13].set("error_msg","Expected a nonempty query result"),r[13].set("code",t.i64.cast([0,3])),r[13].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[14]=t.createArray(),r[15]=(r[14].push(r[13]),r[14]),o=[void 0,r[14]],r[1]=o[0],r[2]=o[1]):(n=l.item,r[13]=new t.Map,r[13].set("backup_id",n.backupId),r[13].set("device_public_key_blob",n.devicePublicKeyBlob),r[13].set("device_private_key_blob",n.devicePrivateKeyBlob),r[13].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[13].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[13].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[13].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[13].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[13].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[13].set("orf_client_state_v2_blob",void 0),r[13].set("orf_v2_authority_level",void 0),r[13].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[13].set("device_id",n.deviceId),r[13].set("backup_tenancy",n.backupTenancy),r[13].set("encryption_version",n.encryptionVersion),r[13].set("revision_version",n.revisionVersion),r[13].set("initialize_restore_result",void 0),r[13].set("device_creation_timestamp_sec",void 0),r[13].set("authority_level",n.authorityLevel),a=[r[13],void 0],r[1]=a[0],r[2]=a[1])})},function(e){return r[4]=new t.Map,r[4].set("value",r[1]),r[4].set("errors",r[2]),r[5]=r[4].get("value"),r[5]!==void 0?t.sequence([function(e){return r[13]=r[5].get("backup_id"),r[14]=r[5].get("device_public_key_blob"),r[15]=r[5].get("device_private_key_blob"),r[16]=r[5].get("epoch_storage_public_key_blob"),r[17]=r[5].get("epoch_storage_private_key_blob"),r[18]=r[5].get("epoch_auth_public_key_blob"),r[19]=r[5].get("epoch_auth_private_key_blob"),r[20]=r[5].get("mailbox_root_key_blob"),r[21]=r[5].get("ocmf_client_state_blob"),r[22]=r[5].get("orf_client_state_v2_blob"),r[23]=r[5].get("orf_v2_authority_level"),r[24]=r[5].get("oblivious_validation_token_blob"),r[25]=r[5].get("device_id"),r[26]=r[5].get("backup_tenancy"),r[27]=r[5].get("encryption_version"),r[28]=r[5].get("revision_version"),r[29]=r[5].get("initialize_restore_result"),r[30]=r[5].get("device_creation_timestamp_sec"),r[31]=r[5].get("authority_level"),t.i64.neq(r[25],void 0)?t.sequence([function(e){return r[33]=void 0,t.i64.neq(r[33],void 0)?t.resolve(r[34]=r[33]):t.sequence([function(e){return r[41]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[42]=t[0],t})},function(e){return r[42]&&(r[51]=(r[41].push(t.i64.cast([0,0])),r[41])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return r[43]&&(r[51]=(r[41].push(t.i64.cast([0,2])),r[41])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return r[44]&&(r[51]=(r[41].push(t.i64.cast([0,3])),r[41])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return r[45]&&(r[51]=(r[41].push(t.i64.cast([0,4])),r[41])),r[46]=t.createArray(),r[47]=t.i64.of_int32(r[41].length),t.i64.gt(r[47],t.i64.cast([0,0]))?t.loopAsync(r[47],function(e){return r[51]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[41],r[51]).then(function(e){var t;return t=e,r[52]=t[0],r[53]=t[1],t})},function(e){return r[54]=(r[46].push(r[52]),r[46])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[51]=t.createArray(),r[52]=t.i64.of_int32(r[46].length),t.i64.gt(r[52],t.i64.cast([0,0]))?t.loopAsync(r[52],function(e){return r[54]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[46],r[54]).then(function(e){var t;return t=e,r[55]=t[0],r[56]=t[1],t})},function(e){return r[57]=(r[51].push(t.i64.to_string(r[55])),r[51])}])}):t.resolve()},function(e){return r[53]=r[51].join(","),r[48]=r[53]}])},function(e){return r[46].some(function(e){return t.i64.eq(r[27],e)})?r[49]=r[27]:r[49]=void 0,t.i64.neq(r[49],void 0)?r[50]=r[49]:r[50]=void 0,r[34]=r[50]}])},function(e){return t.i64.neq(r[34],void 0)?r[35]=r[34]:r[35]=t.i64.cast([0,0]),t.i64.neq(r[26],void 0)?r[36]=r[26]:r[36]=t.i64.cast([0,1]),t.filter(t.db.table(2).fetch(),function(e){return e.context==="50013"}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[37]=!1:(t=o.item,r[37]=!0)})},function(e){return t.filter(t.db.table(2).fetch(),function(e){return e.context==="50025"}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[39]=!1:(t=o.item,r[39]=!0)})},function(e){return r[37]||r[39]?(r[41]="Another sync job is already in progress. Terminating this.",r[41]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",r[41]].join("")),r[42]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",r[41],r[42],t.i64.cast([0,3]))):t.resolve()):t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[49]=t[0],t})},function(e){return r[49]?r[50]=!0:r[50]=!1,r[50]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[52]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[52]].join("")),r[51]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[52],r[51],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[41]=t.createArray(),t.forEach(t.filter(t.db.table(169).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}),function(e){var t=e.item;return r[49]=(r[41].push(t.epochId),r[41])})},function(e){return r[47]="Queried locally available epochs. Count: ",r[42]=t.i64.of_int32(r[41].length),r[48]=t.i64.to_string(r[42]),r[43]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochClientUtils] ",r[43],r[47],r[43],r[48]].join("")),t.resolve()},function(e){return r[44]=new t.Map,r[44].set("backup_id",r[13]),r[44].set("device_id",r[25]),r[44].set("locally_available_epochs",r[41]),r[44].set("trace_id",void 0),r[45]=t.toJSON(r[44]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_encrypted_backups",t.i64.cast([0,50025]),r[45],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[46]=t[0],t})}])},function(e){return r[32]=!0}]):t.sequence([function(e){return r[33]=["Failed to load client state: ","","NULL_DEVICE_ID"].join(""),r[33]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",r[33]].join("")),r[34]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",r[33],r[34],t.i64.cast([0,3]))):t.resolve()},function(e){return r[32]=!1}])},function(e){return r[6]=r[32]}]):t.sequence([function(e){return r[13]=r[4].get("errors"),r[14]=r[4].get("errors"),r[15]=["Failed to load client state: ","","BACKUP_NOT_FOUND"].join(""),r[15]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",r[15]].join("")),r[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",r[15],r[16],t.i64.cast([0,3]))):t.resolve()},function(e){return r[6]=!1}])},function(e){return r[7]=t.i64.of_float(Date.now()),r[8]=t.i64.random(),r[10]="Finishing execution. Execution time: ",r[11]=t.i64.to_string(t.i64.sub(r[7],r[0])),r[12]=" ms",r[9]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ",r[9],r[10],r[9],r[11],r[9],r[12]].join("")),t.i64.eq(t.i64.mod_(r[8],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[13]=",",r[14]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",[r[10],r[13],r[11],r[13],r[12]].join(""),r[14],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsSyncEpochsStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","pending_tasks","secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSSyncEpochsStoredProcedure",["LSSyncEpochs","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t){var a=t.storedProcedure(r("LSSyncEpochs"));return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}l.default=s}),98);
__d("EBSyncEpochs",["EBAPIQPLPoints","EBDeps","LSFactory","LSSyncEpochsStoredProcedure","QPLFlow","Random","WAResultOrError","getErrorSafe","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=new Map;function s(t,n){if(n==null){for(var r of e.entries()){var a=r[0],i=r[1];i.unsub(),window.clearTimeout(i.timeout),i.resolve(o("WAResultOrError").makeError(t)),e.delete(a)}return}var l=e.get(n);l!=null&&(l.unsub(),window.clearTimeout(l.timeout),l.resolve(o("WAResultOrError").makeError(t)),e.delete(n))}async function u(){var t=await o("EBDeps").getDeps().getLSDB(),n,a=o("Random").uint32(),l=String(a),s=o("QPLFlow").startQPLFlow(r("qpl")._(521475098,"1328"),{annotations:{string:{traceId:l}},instanceKey:a});return new Promise(async function(a,u){var c=t.tables.secure_encrypted_backups_epochs.subscribe(function(t,r){if(r.operation!=="delete")return c(),window.clearTimeout(n),e.delete(l),s.endSuccess(),a(o("WAResultOrError").makeResult())});s.addPoint(o("EBAPIQPLPoints").EBSyncEpochsQPLPoints.SYNC_EPOCH_SPROC_START),await t.runInTransaction(function(e){return r("LSSyncEpochsStoredProcedure")(r("LSFactory")(e))},"readwrite",void 0,void 0,i.id+":95").then(function(){s.addPoint(o("EBAPIQPLPoints").EBSyncEpochsQPLPoints.SYNC_EPOCH_SPROC_END),n=window.setTimeout(function(){return e.delete(l),s.endFail(o("EBAPIQPLPoints").EBSyncEpochsQPLPoints.SYNC_EPOCH_TIMEOUT),u(o("WAResultOrError").makeError("timeout"))},12e4),e.set(l,{resolve:a,timeout:n,unsub:c})}).catch(function(t){var n=r("getErrorSafe")(t);return c(),e.delete(l),u(o("WAResultOrError").makeError(n.message))})})}l.resolveSyncEpochsWithError=s,l.EBSyncEpochs=u}),98);
__d("EBUploadMessagesFromWorkerMutation_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="25145199965171420"}),null);
__d("EBUploadMessagesFromWorkerMutation.graphql",["EBUploadMessagesFromWorkerMutation_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"XFBTUploadMessageGQLResponse",kind:"LinkedField",name:"xfb_upload_encrypted_msg_to_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBTUploadMessageGQLResponseLabyrinth10",kind:"LinkedField",name:"labyrinth_1_0",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"device_epoch_status",storageKey:null},{alias:null,args:null,concreteType:"XFBTAttachmentUploadStatus",kind:"LinkedField",name:"attachment_upload_status",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,concreteType:"XFBTAttachmentUploadContext",kind:"LinkedField",name:"upload_context",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"attachment_trace_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"media_type",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBTUploadMessageHandlerResponse",kind:"LinkedField",name:"backup_write_result_response",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_success",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"delete_mailbox",storageKey:null},{alias:null,args:null,concreteType:"XFBTProtobufParams",kind:"LinkedField",name:"protobuf_params",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"delete_on_success",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"EBUploadMessagesFromWorkerMutation",selections:t,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"EBUploadMessagesFromWorkerMutation",selections:t},params:{id:n("EBUploadMessagesFromWorkerMutation_facebookRelayOperation"),metadata:{},name:"EBUploadMessagesFromWorkerMutation",operationKind:"mutation",text:null}}})();a.exports=e}),null);
__d("MAWEBFrontendQPLLogger",["ExecutionEnvironment","FBLogger","MAWBridgeSafeActionsWorkerAndUI","MAWEBUploadTrackingUtils","MWEBODSEntityName.enum","ODS","QPLUserFlow","WAHashStringToNumber","qpl","vulture"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e,t,n){e!=null&&((s||(s=r("ExecutionEnvironment"))).isInWorker?(y("point",t),o("MAWEBUploadTrackingUtils").handleBridgeEbUploadTrackingQPL("point",e,t,n)):o("MAWBridgeSafeActionsWorkerAndUI").fireAndForgetBackendWorkerAndUIShared("addEbUploadTrackingWorkerQPL",{annotations:n,pointName:t,qplInstanceKey:e,qplType:"point"}))}function c(e,t){(s||(s=r("ExecutionEnvironment"))).isInWorker?(y("success","upload_tracking_completed"),o("MAWEBUploadTrackingUtils").handleBridgeEbUploadTrackingQPL("success",e,"upload_tracking_completed",t)):o("MAWBridgeSafeActionsWorkerAndUI").fireAndForgetBackendWorkerAndUIShared("addEbUploadTrackingWorkerQPL",{annotations:t,pointName:"upload_tracking_completed",qplInstanceKey:e,qplType:"success"})}function d(e,t,n){(s||(s=r("ExecutionEnvironment"))).isInWorker?(y("fail",t),o("MAWEBUploadTrackingUtils").handleBridgeEbUploadTrackingQPL("fail",e,t,n)):o("MAWBridgeSafeActionsWorkerAndUI").fireAndForgetBackendWorkerAndUIShared("addEbUploadTrackingWorkerQPL",{annotations:n,pointName:t,qplInstanceKey:e,qplType:"fail"})}function m(e){var t=e.deliveryObjectId,n=e.flow,a=e.mediaType,i=e.messageId,l=e.threadId,s=e.traceId;if(_(n)){var u=o("WAHashStringToNumber").hashStringToNumber(s),c={bool:{is_legacy_hardening:!1,is_unified_attachment:!0},string:{deliveryObjectId:t,flow:n,mediaType:a,messageId:i,threadId:l,traceId:s}};r("QPLUserFlow").start(r("qpl")._(521480391,"1167"),{annotations:c,instanceKey:u})}}function p(e,t,n,a){if(e!=null&&_(n)){var i=o("WAHashStringToNumber").hashStringToNumber(e);if(t){r("QPLUserFlow").endSuccess(r("qpl")._(521480391,"1167"),{instanceKey:i});return}r("QPLUserFlow").endFailure(r("qpl")._(521480391,"1167"),"upload_attachment_backup_failed",{annotations:{string:{error:a!=null?a:"upload_attachment_backup_failed"}},instanceKey:i})}}function _(e){return e==="old"}function f(e,t){e.forEach(function(e){if(e.uploadTrackingInstanceKey!=null){var n={string:{traceId:e.traceId}};u(e.uploadTrackingInstanceKey,t,n)}})}function g(e){return{addAnnotations:function(n){h(e,n)},addPoint:function(n,r){u(e,n,r)},endCancel:function(n,r){d(e,""+(n!=null?n:""),r)},endFail:function(n,r){d(e,n,r)},endSuccess:function(n){r("vulture")("4syeud8BqBgtuBSg1W-sc4TtQwY="),c(e,n)},getQPLAttrs:function(){return{instanceKey:e}},isActive:function(){return!0},start:function(){}}}function h(e,t){r("FBLogger")("EBFrontendQPLLogger").warn("addAnnotations not implemented for EB Frontend QPL")}function y(t,n){(e||(e=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MAW_EB_FRONTEND_QPL_IN_WORKER,t+"."+n)}l.addPointEBUploadTracking=u,l.endEBUploadTracking=c,l.failEBUploadTracking=d,l.startFlowUploadAttachmentBackup=m,l.endFlowUploadAttachmentBackup=p,l.addPointForUploadMessageArray=f,l.makeEBFrontendQplFlowFromInstanceKey=g}),98);
__d("LSHandleBackupWriteCompletion",["LSVec","MAWEBFrontendQPLLogger","cr:847"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t,a,i){if(i!=null){var l=r("LSVec").toArray(i);l.forEach(function(e){return o("MAWEBFrontendQPLLogger").endFlowUploadAttachmentBackup(e,a,"unified")})}if(n("cr:847")!=null){var s=i!=null?r("LSVec").toArray(i):[];s.length>0&&await n("cr:847")(e,s)}return Promise.resolve()}l.call=e}),98);
__d("LSHandleBackupWriteCompletion.nop",["LSHandleBackupWriteCompletion"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,r,a){return o("LSHandleBackupWriteCompletion").call(t,n,r,a)};e.__nop_name__="LSHandleBackupWriteCompletion",l.default=e}),98);
__d("LSMarkBackupAsCompleted.nop",["Promise"],(function(t,n,r,o,a,i){"use strict";var e,l=function(r,o,a,i,l,s,u){return(e||(e=n("Promise"))).resolve()};l.__nop_name__="LSMarkBackupAsCompleted",i.default=l}),66);
__d("LSHandleProtobufWriteResult",["LSArrayGetObjectAt","LSMarkBackupAsCompleted.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return e[3]?r[0]=!1:r[0]=!0,r[0]?t.resolve():(r[1]=e[3].get("delete_on_success"),r[1]&&e[0]&&!e[1]?(e[2]?r[2]=!1:r[2]=!0,r[2]?t.resolve():t.sequence([function(o){return r[3]=t.i64.of_float(Date.now()),r[4]=t.i64.of_int32(e[2].length),t.i64.gt(r[4],t.i64.cast([0,0]))?t.loopAsync(r[4],function(o){return r[7]=o,t.sequence([function(o){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),e[2],r[7]).then(function(e){var t;return t=e,r[8]=t[0],r[9]=t[1],t})},function(e){return t.filter(t.db.table(305).fetch(),function(e){return t.i64.eq(e.pendingBackupTaskId,r[8])}).next().then(function(e,r){var o=e.done,a=e.value;return o?0:(r=a.item,t.nativeOperation(n("LSMarkBackupAsCompleted.nop"),r.actThreadId,r.toplevelOfflineThreadingId,r.supplementalKey,r.messageTimestampMs,r.backupAction))})}])}):t.resolve()},function(o){return r[5]=t.i64.of_int32(e[2].length),t.i64.gt(r[5],t.i64.cast([0,0]))?t.loopAsync(r[5],function(o){return r[7]=o,t.sequence([function(o){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),e[2],r[7]).then(function(e){var t;return t=e,r[8]=t[0],r[9]=t[1],t})},function(e){return t.filter(t.db.table(305).fetch(),function(e){return t.i64.eq(e.pendingBackupTaskId,r[8])}).next().then(function(e,n){var o=e.done,a=e.value;return o?0:(n=a.item,r[12]=n.actThreadId,r[13]=n.toplevelOfflineThreadingId,r[11]=n.supplementalKey,r[14]=n.messageTimestampMs,r[11]!==void 0?t.forEach(t.filter(t.db.table(302).fetch(),function(e){return e.threadId===r[12]&&e.toplevelOfflineThreadingId===r[13]&&e.supplementalKey===r[11]&&t.i64.le(e.messageTimestampMs,r[14])}),function(e){return e.delete()}):t.forEach(t.filter(t.db.table(301).fetch(),function(e){return e.threadId===r[12]&&e.offlineThreadingId===r[13]&&t.i64.le(e.messageTimestampMs,r[14])}),function(e){return e.delete()}))})}])}):t.resolve()},function(o){return r[6]=t.i64.of_int32(e[2].length),t.i64.gt(r[6],t.i64.cast([0,0]))?t.loopAsync(r[6],function(o){return r[7]=o,t.sequence([function(o){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),e[2],r[7]).then(function(e){var t;return t=e,r[8]=t[0],r[9]=t[1],t})},function(e){return t.filter(t.db.table(305).fetch(),function(e){return t.i64.eq(e.pendingBackupTaskId,r[8])}).next().then(function(e,n){var r=e.done,o=e.value;return r?0:(n=o.item,t.forEach(t.db.table(304).fetch([[[n.toplevelOfflineThreadingId,n.actThreadId]],"offlineThreadingId"]),function(e){return e.delete()}))})}])}):t.resolve()}])):t.resolve())},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsHandleProtobufWriteResultStoredProcedure",e.__tables__=["pending_protobuf_backups_context","local_message_persistence_store_supplemental","local_message_persistence_store","local_message_persistence_store_tag_index"],a.exports=e}),null);
__d("LSHandleBackupWriteResultV2",["LSArrayGetObjectAt","LSDeleteBackupOnClient","LSHandleBackupWriteCompletion.nop","LSHandleProtobufWriteResult","LSLogMEBUploadSuccessEvent.nop","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure] Beginning execution."),r[1]=t.createArray(),r[2]=t.createArray(),e[3]?r[3]=!1:r[3]=!0,r[3]?t.resolve():(r[12]=t.i64.of_int32(e[3].length),t.i64.gt(r[12],t.i64.cast([0,0]))?t.loopAsync(r[12],function(o){return r[13]=o,t.sequence([function(o){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),e[3],r[13]).then(function(e){var t;return t=e,r[14]=t[0],r[15]=t[1],t})},function(o){return t.db.table(177).fetch([[[r[14]]],"fk_pending_tasks"]).next().then(function(o,a){var i=o.done,l=o.value;return i?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure] Pending backup task id not found!"),r[18]="Pending backup task id not found!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure] ","",r[18]].join("")),r[17]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure",r[18],r[17],t.i64.cast([0,3]))):(a=l.item,t.sequence([function(r){return t.i64.eq(a.contentType,t.i64.cast([0,1]))?t.nativeOperation(n("LSLogMEBUploadSuccessEvent.nop"),a.uniqueKey,a.lsTraceId,e[1]):t.resolve()},function(e){return r[17]=(r[2].push(a.persistentId),r[2])}]))})}])}):t.resolve())},function(r){return t.storedProcedure(n("LSHandleProtobufWriteResult"),e[1],e[2],e[3],e[4],!1)},function(o){return r[4]=t.i64.of_float(Date.now()),e[3]?r[5]=!1:r[5]=!0,r[5]?t.resolve():(r[12]=t.i64.of_int32(e[3].length),t.i64.gt(r[12],t.i64.cast([0,0]))?t.loopAsync(r[12],function(o){return r[13]=o,t.sequence([function(o){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),e[3],r[13]).then(function(e){var t;return t=e,r[14]=t[0],r[15]=t[1],t})},function(e){return t.forEach(t.filter(t.db.table(305).fetch(),function(e){return t.i64.eq(e.pendingBackupTaskId,r[14])}),function(e){return e.delete()})}])}):t.resolve())},function(o){return e[2]?t.sequence([function(o){return r[12]=t.i64.of_int32(e[0].length),t.sequence([function(o){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),e[0],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[14]=t[0],r[15]=t[1],t})},function(e){return r[13]=r[14]}])},function(e){return t.storedProcedure(n("LSDeleteBackupOnClient"),void 0,void 0,!0,r[13],void 0,!0)}]):t.resolve()},function(o){return t.nativeOperation(n("LSHandleBackupWriteCompletion.nop"),e[1],e[0],r[2])},function(e){return r[6]=t.i64.of_float(Date.now()),r[7]=t.i64.random(),r[9]="Finishing execution. Execution time: ",r[10]=t.i64.to_string(t.i64.sub(r[6],r[0])),r[11]=" ms",r[8]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure] ",r[8],r[9],r[8],r[10],r[8],r[11]].join("")),t.i64.eq(t.i64.mod_(r[7],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[12]=",",r[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure",[r[9],r[12],r[10],r[12],r[11]].join(""),r[13],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure",e.__tables__=["pending_backups_context_v2","pending_protobuf_backups_context"],a.exports=e}),null);
__d("LSHandleBackupWriteResultV2StoredProcedure",["LSHandleBackupWriteResultV2","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSHandleBackupWriteResultV2"),a.traceIds,a.isSuccess,a.deleteMailbox,a.taskIds,a.protobufParams);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSPrepareOpenEpochV2",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(e){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] Beginning execution."),t.filter(t.db.table(2).fetch(),function(e){return e.context==="50005"}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[1]=!1:(t=o.item,r[1]=!0)})},function(e){return t.filter(t.db.table(2).fetch(),function(e){return e.context==="320"}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[3]=!1:(t=o.item,r[3]=!0)})},function(e){return r[1]||r[3]?t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] Skipping openEpoch start because there is already an openEpoch flow in progress."),r[5]=t.i64.cast([0,1]))):t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return r[18]?r[19]=!0:r[19]=!1,r[19]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[21]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[21]].join("")),r[20]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[21],r[20],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!1}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[18]=new t.Map,r[18].set("error_msg","Expected a nonempty query result"),r[18].set("code",t.i64.cast([0,3])),r[18].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[19]=t.createArray(),r[20]=(r[19].push(r[18]),r[19]),o=[void 0,r[19]],r[12]=o[0],r[13]=o[1]):(n=l.item,r[18]=new t.Map,r[18].set("backup_id",n.backupId),r[18].set("device_public_key_blob",n.devicePublicKeyBlob),r[18].set("device_private_key_blob",n.devicePrivateKeyBlob),r[18].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[18].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[18].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[18].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[18].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[18].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[18].set("orf_client_state_v2_blob",void 0),r[18].set("orf_v2_authority_level",void 0),r[18].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[18].set("device_id",n.deviceId),r[18].set("backup_tenancy",n.backupTenancy),r[18].set("encryption_version",n.encryptionVersion),r[18].set("revision_version",n.revisionVersion),r[18].set("initialize_restore_result",void 0),r[18].set("device_creation_timestamp_sec",void 0),r[18].set("authority_level",n.authorityLevel),a=[r[18],void 0],r[12]=a[0],r[13]=a[1])})},function(e){return r[15]=new t.Map,r[15].set("value",r[12]),r[15].set("errors",r[13]),r[16]=r[15].get("value"),r[16]!==void 0?t.sequence([function(e){return r[18]=r[16].get("backup_id"),r[19]=r[16].get("device_public_key_blob"),r[20]=r[16].get("device_private_key_blob"),r[21]=r[16].get("epoch_storage_public_key_blob"),r[22]=r[16].get("epoch_storage_private_key_blob"),r[23]=r[16].get("epoch_auth_public_key_blob"),r[24]=r[16].get("epoch_auth_private_key_blob"),r[25]=r[16].get("mailbox_root_key_blob"),r[26]=r[16].get("ocmf_client_state_blob"),r[27]=r[16].get("orf_client_state_v2_blob"),r[28]=r[16].get("orf_v2_authority_level"),r[29]=r[16].get("oblivious_validation_token_blob"),r[30]=r[16].get("device_id"),r[31]=r[16].get("backup_tenancy"),r[32]=r[16].get("encryption_version"),r[33]=r[16].get("revision_version"),r[34]=r[16].get("initialize_restore_result"),r[35]=r[16].get("device_creation_timestamp_sec"),r[36]=r[16].get("authority_level"),t.i64.neq(r[30],void 0)?t.sequence([function(e){return r[38]=void 0,t.i64.neq(r[38],void 0)?t.resolve(r[39]=r[38]):t.sequence([function(e){return r[50]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[51]=t[0],t})},function(e){return r[51]&&(r[60]=(r[50].push(t.i64.cast([0,0])),r[50])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[52]=t[0],t})},function(e){return r[52]&&(r[60]=(r[50].push(t.i64.cast([0,2])),r[50])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[53]=t[0],t})},function(e){return r[53]&&(r[60]=(r[50].push(t.i64.cast([0,3])),r[50])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[54]=t[0],t})},function(e){return r[54]&&(r[60]=(r[50].push(t.i64.cast([0,4])),r[50])),r[55]=t.createArray(),r[56]=t.i64.of_int32(r[50].length),t.i64.gt(r[56],t.i64.cast([0,0]))?t.loopAsync(r[56],function(e){return r[60]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[50],r[60]).then(function(e){var t;return t=e,r[61]=t[0],r[62]=t[1],t})},function(e){return r[63]=(r[55].push(r[61]),r[55])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[60]=t.createArray(),r[61]=t.i64.of_int32(r[55].length),t.i64.gt(r[61],t.i64.cast([0,0]))?t.loopAsync(r[61],function(e){return r[63]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[55],r[63]).then(function(e){var t;return t=e,r[64]=t[0],r[65]=t[1],t})},function(e){return r[66]=(r[60].push(t.i64.to_string(r[64])),r[60])}])}):t.resolve()},function(e){return r[62]=r[60].join(","),r[57]=r[62]}])},function(e){return r[55].some(function(e){return t.i64.eq(r[32],e)})?r[58]=r[32]:r[58]=void 0,t.i64.neq(r[58],void 0)?r[59]=r[58]:r[59]=void 0,r[39]=r[59]}])},function(e){return t.i64.neq(r[39],void 0)?r[40]=r[39]:r[40]=t.i64.cast([0,0]),t.i64.neq(r[31],void 0)?r[41]=r[31]:r[41]=t.i64.cast([0,1]),t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[50]=t[0],t})},function(e){return r[50]?r[51]=!0:r[51]=!1,r[51]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[53]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[53]].join("")),r[52]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[53],r[52],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[42]=t.createArray(),t.forEach(t.filter(t.db.table(169).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}),function(e){var t=e.item;return r[50]=(r[42].push(t.epochId),r[42])})},function(e){return r[48]="Queried locally available epochs. Count: ",r[43]=t.i64.of_int32(r[42].length),r[49]=t.i64.to_string(r[43]),r[44]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochClientUtils] ",r[44],r[48],r[44],r[49]].join("")),t.resolve()},function(e){return r[45]=new t.Map,r[45].set("backup_id",r[18]),r[45].set("locally_available_epochs",r[42]),r[45].set("device_id",r[30]),r[45].set("trace_id",void 0),r[46]=t.toJSON(r[45]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_request_for_asssoc_devices",t.i64.cast([0,50005]),r[46],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[50]=t[0],t})},function(e){return r[50]?r[51]=!0:r[51]=!1,r[51]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[53]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[53]].join("")),r[52]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[53],r[52],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[37]=t.i64.cast([0,0])}]):t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[39]=t[0],t})},function(e){return r[39]?r[40]=!0:r[40]=!1,r[40]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[42]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[42]].join("")),r[41]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[42],r[41],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[38]="No backup found.",r[38]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] ","",r[38]].join("")),r[39]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure",r[38],r[39],t.i64.cast([0,3]))):t.resolve()},function(e){return r[37]=t.i64.cast([0,1])}])},function(e){return r[17]=r[37]}]):t.sequence([function(e){return r[18]=r[15].get("errors"),r[19]=r[15].get("errors"),t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[21]=t[0],t})},function(e){return r[21]?r[22]=!0:r[22]=!1,r[22]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[24]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[24]].join("")),r[23]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[24],r[23],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[20]="No backup found.",r[20]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] ","",r[20]].join("")),r[21]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure",r[20],r[21],t.i64.cast([0,3]))):t.resolve()},function(e){return r[17]=t.i64.cast([0,1])}])},function(e){return r[5]=r[17]}])},function(e){return r[6]=t.i64.of_float(Date.now()),r[7]=t.i64.random(),r[9]="Finishing execution. Execution time: ",r[10]=t.i64.to_string(t.i64.sub(r[6],r[0])),r[11]=" ms",r[8]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] ",r[8],r[9],r[8],r[10],r[8],r[11]].join("")),t.i64.eq(t.i64.mod_(r[7],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[12]=",",r[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure",[r[9],r[12],r[10],r[12],r[11]].join(""),r[13],t.i64.cast([0,4]))):t.resolve()},function(e){return o[0]=r[5]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure",e.__tables__=["pending_tasks","secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSPrepareOpenEpochV2StoredProcedure",["LSPrepareOpenEpochV2","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){a===void 0&&(a={});var i=t.storedProcedure(r("LSPrepareOpenEpochV2"),a.backupId,a.traceId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWEBFalcoLoggerUtils",["requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e=r("requireDeferred"))("EncryptedBackupTaskFailureFalcoEvent").__setRef("MAWEBFalcoLoggerUtils"),u=e("EncryptedBackupTaskIssuedFalcoEvent").__setRef("MAWEBFalcoLoggerUtils"),c=e("EncryptedBackupTaskSkippedFalcoEvent").__setRef("MAWEBFalcoLoggerUtils"),d=e("EncryptedBackupUploadSuccessFalcoEvent").__setRef("MAWEBFalcoLoggerUtils"),m={0:"unknown",1:"upsert_top_level",2:"upsert_supplemental",3:"delete_top_level",4:"delete_top_level_with_placeholder"};function p(e,t){g(e,t)}function _(e,t,n){g(e,t,n)}function f(e,t,n){g(e,t,void 0,n)}function g(e,t,n,r){n!=null?s.onReady(function(r){r.log(function(){var r,o,a,i,l;return{backup_action:(r=m[(o=(a=e.protoMsg)==null?void 0:a.backupActionType)!=null?o:0])!=null?r:"unknown",backup_protocol:t,failure_reason:n,labyrinth_version:0,message_id:(i=(l=e.protoMsg)==null||(l=l.msgId)==null?void 0:l.externalId)!=null?i:e.messageId,thread_id:e.threadId,trace_id:e.traceId}})}):r!=null?c.onReady(function(n){n.log(function(){var n,o,a,i,l;return{backup_action:(n=m[(o=(a=e.protoMsg)==null?void 0:a.backupActionType)!=null?o:0])!=null?n:"unknown",backup_protocol:t,labyrinth_version:0,message_id:(i=(l=e.protoMsg)==null||(l=l.msgId)==null?void 0:l.externalId)!=null?i:e.messageId,skipped_reason:r,thread_id:e.threadId,trace_id:e.traceId}})}):u.onReady(function(n){n.log(function(){var n,r,o,a,i;return{backup_action:(n=m[(r=(o=e.protoMsg)==null?void 0:o.backupActionType)!=null?r:0])!=null?n:"unknown",backup_protocol:t,labyrinth_version:0,message_id:(a=(i=e.protoMsg)==null||(i=i.msgId)==null?void 0:i.externalId)!=null?a:e.messageId,thread_id:e.threadId,trace_id:e.traceId}})})}function h(e){d.onReady(function(t){t.log(function(){var t,n;return{labyrinth_version:0,message_id:(t=(n=e.protoMsg)==null||(n=n.msgId)==null?void 0:n.externalId)!=null?t:e.messageId,thread_id:e.threadId,trace_id:e.traceId}})})}l.BackupActionMap=m,l.logEBFalcoTaskIssued=p,l.logEBFalcoTaskFailure=_,l.logEBFalcoTaskSkipped=f,l.logEBFalcoEncryptedBackupUploadSuccess=h}),98);
__d("EBWasm.pb",["$InternalEnum","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s,u=(s=n("$InternalEnum"))({UPSERT_BACKUP_ITEM:1,REMOVE_BACKUP_ITEM:2}),c=s({MESSAGE:1,THREAD:2}),d=s({STANDARD:0,VANISH_MODE:1,DUAL_SEND_SHADOW:2,BTV_COMPANION:3,BLEND_DUAL_SEND:4,BLEND_DUAL_SEND_NO_NETWORK:5}),m=s({UNKNOWN:0,ENCRYPTIONKDFWITHVERSION:2,ENCRYPTIONKDFWITHNULLSALT:3,ENCRYPTIONKDFWITHNULLSALTDFCANARY:4,TESTVERSION:99}),p=s({UNKNOWN:0,UPSERT_TOPLEVEL:1,UPSERT_SUPPLEMENTAL:2,DELETE_TOPLEVEL:3,DELETE_TOPLEVEL_WITH_PLACEHOLDER:4}),_=s({PHOTO:0,PERMANENT:1,EPHEMERAL:2,VIDEO:3,GIF:4,AUDIO:5,FILE:6,RAVEN:7,UNREAD_RAVEN:8,SHARE_IG_MEDIA:9,SHARE_LINK:10,SHARE_IG_CLIPS:11,SHH:12,STORY_REPLY:13,DISAPPEARING_MESSAGE:14,RAVEN_SEEN:15,RAVEN_REPLAYED:16,RAVEN_READ_ONCE:17,RAVEN_REPLAYABLE:18,RAVEN_PERMANENT:19,ACTION_LOG:20}),f=s({ECHO_SERIALIZATION_FAILURE:0,ECHO_UPLOAD_IS_DISABLED:1,DELTA_PAYLOAD_IS_TOO_BIG:2,ECHO_VALUE_CLEANED_UP:3,ECHO_UPLOAD_OPTIONAL_FOR_LOOPING_UPLOAD:4,ECHO_UPLOAD_SKIPPED_ON_PROTOBUF_SUCCESS_FOR_LOOPING_UPLOAD:5}),g={},h={},y={},C={},b={},v={},S={},R={};g.name="SupplementalMessage",g.internalSpec={toplevelOfflineThreadingId:[1,(e=o("WAProtoConst")).FLAGS.REQUIRED|e.TYPES.UINT64],supplementalKey:[2,e.FLAGS.REQUIRED|e.TYPES.STRING],payload:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES],maybeOutOfOrder:[4,e.TYPES.BOOL]},h.name="ToplevelMessage",h.internalSpec={payload:[1,e.FLAGS.REQUIRED|e.TYPES.BYTES]},y.name="Epoch",y.internalSpec={epochId:[1,e.FLAGS.REQUIRED|e.TYPES.UINT64],epochAnonId:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],epochRootKey:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES]},C.name="MessageUploadSerializerInput",C.internalSpec={threadId:[1,e.FLAGS.REQUIRED|e.TYPES.UINT64],operationType:[2,e.FLAGS.REQUIRED|e.TYPES.ENUM,u],contentType:[3,e.FLAGS.REQUIRED|e.TYPES.ENUM,c],attachmentPayload:[6,e.TYPES.STRING],threadSubtype:[7,e.FLAGS.REQUIRED|e.TYPES.ENUM,d],encryptionVersion:[8,e.FLAGS.REQUIRED|e.TYPES.UINT64],actionType:[9,e.FLAGS.REQUIRED|e.TYPES.ENUM,p],messageTags:[10,e.FLAGS.REPEATED|e.TYPES.ENUM,_],tagsToDelete:[11,e.FLAGS.REPEATED|e.TYPES.ENUM,_],offlineThreadingId:[12,e.FLAGS.REQUIRED|e.TYPES.UINT64],timestamp:[13,e.FLAGS.REQUIRED|e.TYPES.UINT64],deletionOtid:[14,e.TYPES.UINT64],requestId:[15,e.FLAGS.REQUIRED|e.TYPES.STRING],supplementalMessage:[4,e.TYPES.MESSAGE,g],toplevelMessage:[5,e.TYPES.MESSAGE,h],__oneofs__:{message:["supplementalMessage","toplevelMessage"]}},b.name="MessageUploadSerializerBatchInput",b.internalSpec={messages:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,C],mailboxRootKeyBlob:[2,e.FLAGS.REQUIRED|e.TYPES.BYTES],ocmfClientStateBlob:[3,e.FLAGS.REQUIRED|e.TYPES.BYTES],epoch:[4,e.FLAGS.REQUIRED|e.TYPES.MESSAGE,y],deviceId:[5,e.FLAGS.REQUIRED|e.TYPES.UINT64],backupId:[6,e.FLAGS.REQUIRED|e.TYPES.UINT64]},v.name="MessageUploadPayloadOutput",v.internalSpec={offlineThreadingId:[3,e.FLAGS.REQUIRED|e.TYPES.UINT64],timestamp:[4,e.FLAGS.REQUIRED|e.TYPES.UINT64],threadId:[5,e.FLAGS.REQUIRED|e.TYPES.UINT64],payload:[1,e.TYPES.STRING],error:[2,e.TYPES.STRING],__oneofs__:{result:["payload","error"]}},S.name="MessageUploadSerializerBatchOutput",S.internalSpec={payloads:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,v]},R.name="LabyrinthCommand",R.internalSpec={messageUploadSerializerBatchInput:[1,e.TYPES.MESSAGE,b],__oneofs__:{commandInput:["messageUploadSerializerBatchInput"]}},l.BackupOperationType=u,l.BackupContentType=c,l.ThreadSubtype=d,l.EncryptionVersion=m,l.EncryptedBackupsKeyValueActionType=p,l.MessageTag=_,l.EchoOptionalUploadReason=f,l.SupplementalMessageSpec=g,l.ToplevelMessageSpec=h,l.EpochSpec=y,l.MessageUploadSerializerInputSpec=C,l.MessageUploadSerializerBatchInputSpec=b,l.MessageUploadPayloadOutputSpec=v,l.MessageUploadSerializerBatchOutputSpec=S,l.LabyrinthCommandSpec=R}),98);
__d("EBWasmSerializeMessagesPayload",["EBLabyrinthWasmReactorSingleton","EBWasm.pb","WAResultOrError","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WATagsLogger").TAGS(["EBSerializeMessagesPayload"]);function s(){function e(e){var t=e.payloads;return o("WAResultOrError").makeResult({payloads:t})}return async function(t){var n=t.messagesData;return await o("EBLabyrinthWasmReactorSingleton").labyrinthCommand({InputSpec:o("EBWasm.pb").LabyrinthCommandSpec,ResultSpec:o("EBWasm.pb").MessageUploadSerializerBatchOutputSpec,validateResult:e},{messageUploadSerializerBatchInput:n})}}var u=s();l.logger=e,l.serializeMessagesPayload=u}),98);
__d("EBWasmSerializeMessagesModule",["EBLogger","EBWasm.pb","EBWasmSerializeMessagesPayload","I64","MAWEBUploadTrackingUtils","MSGDataclassTypes.flow","ReQL","WALongInt","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("EBLogger").EBLogger().tags(["EBWasmSerializeMessagesModule"]);function f(e){return e===o("MSGDataclassTypes.flow").MpsMessageTag.Photo?o("EBWasm.pb").MessageTag.PHOTO:e===o("MSGDataclassTypes.flow").MpsMessageTag.Permanent?o("EBWasm.pb").MessageTag.PERMANENT:e===o("MSGDataclassTypes.flow").MpsMessageTag.Ephemeral?o("EBWasm.pb").MessageTag.EPHEMERAL:e===o("MSGDataclassTypes.flow").MpsMessageTag.Video?o("EBWasm.pb").MessageTag.VIDEO:e===o("MSGDataclassTypes.flow").MpsMessageTag.Gif?o("EBWasm.pb").MessageTag.GIF:e===o("MSGDataclassTypes.flow").MpsMessageTag.Audio?o("EBWasm.pb").MessageTag.AUDIO:e===o("MSGDataclassTypes.flow").MpsMessageTag.File?o("EBWasm.pb").MessageTag.FILE:e===o("MSGDataclassTypes.flow").MpsMessageTag.Raven?o("EBWasm.pb").MessageTag.RAVEN:e===o("MSGDataclassTypes.flow").MpsMessageTag.UnreadRaven?o("EBWasm.pb").MessageTag.UNREAD_RAVEN:e===o("MSGDataclassTypes.flow").MpsMessageTag.ShareIgMedia?o("EBWasm.pb").MessageTag.SHARE_IG_MEDIA:e===o("MSGDataclassTypes.flow").MpsMessageTag.ShareLink?o("EBWasm.pb").MessageTag.SHARE_LINK:e===o("MSGDataclassTypes.flow").MpsMessageTag.ShareIgClips?o("EBWasm.pb").MessageTag.SHARE_IG_CLIPS:e===o("MSGDataclassTypes.flow").MpsMessageTag.Shh?o("EBWasm.pb").MessageTag.SHH:e===o("MSGDataclassTypes.flow").MpsMessageTag.StoryReply?o("EBWasm.pb").MessageTag.STORY_REPLY:e===o("MSGDataclassTypes.flow").MpsMessageTag.DisappearingMessage?o("EBWasm.pb").MessageTag.DISAPPEARING_MESSAGE:e===o("MSGDataclassTypes.flow").MpsMessageTag.RavenSeen?o("EBWasm.pb").MessageTag.RAVEN_SEEN:e===o("MSGDataclassTypes.flow").MpsMessageTag.RavenReplayed?o("EBWasm.pb").MessageTag.RAVEN_REPLAYED:e===o("MSGDataclassTypes.flow").MpsMessageTag.RavenReadOnce?o("EBWasm.pb").MessageTag.RAVEN_READ_ONCE:e===o("MSGDataclassTypes.flow").MpsMessageTag.RavenReplayable?o("EBWasm.pb").MessageTag.RAVEN_REPLAYABLE:e===o("MSGDataclassTypes.flow").MpsMessageTag.RavenPermanent?o("EBWasm.pb").MessageTag.RAVEN_PERMANENT:e===o("MSGDataclassTypes.flow").MpsMessageTag.ActionLog?o("EBWasm.pb").MessageTag.ACTION_LOG:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}function g(e){var t;return(function(e){return e===0?o("EBWasm.pb").EncryptedBackupsKeyValueActionType.UNKNOWN:e===1?o("EBWasm.pb").EncryptedBackupsKeyValueActionType.UPSERT_TOPLEVEL:e===2?o("EBWasm.pb").EncryptedBackupsKeyValueActionType.UPSERT_SUPPLEMENTAL:e===3?o("EBWasm.pb").EncryptedBackupsKeyValueActionType.DELETE_TOPLEVEL:e===4?o("EBWasm.pb").EncryptedBackupsKeyValueActionType.DELETE_TOPLEVEL_WITH_PLACEHOLDER:o("EBWasm.pb").EncryptedBackupsKeyValueActionType.UNKNOWN})((t=e.protoMsg)==null?void 0:t.backupActionType)}function h(t,n,r){var o,a=t==null||(o=t.protoMsg)==null?void 0:o.supplementalKey;if(a==null){_.MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Supplemental key is null - unable to serialize payload"])));return}return{payload:r,supplementalKey:a,toplevelOfflineThreadingId:n}}function y(e,t,n){var r,a,i,l=o("WALongInt").decimalStringToLongInt(e.threadId),y=o("WALongInt").decimalStringToLongInt(e.sortOrderMs.toString()),C=g(e);if(C===o("EBWasm.pb").EncryptedBackupsKeyValueActionType.UNKNOWN){_.MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Action type is unknown - unable to serialize payload"])));return}var b=e.actionType===2?o("EBWasm.pb").BackupOperationType.REMOVE_BACKUP_ITEM:o("EBWasm.pb").BackupOperationType.UPSERT_BACKUP_ITEM,v=o("EBWasm.pb").ThreadSubtype.STANDARD,S=o("WALongInt").decimalStringToLongInt((p||(p=o("I64"))).to_string(t)),R=e.traceId,L={actionType:C,attachmentPayload:n,contentType:o("EBWasm.pb").BackupContentType.MESSAGE,encryptionVersion:S,operationType:b,requestId:R,threadId:l,threadSubtype:v,timestamp:y},E=(r=e.protoMsg)==null?void 0:r.tags,k=E!=null?E.map(function(e){return f(e)}):[],I=[],T=(a=e.protoMsg)==null||(a=a.originalMsgProtocolId)==null?void 0:a.externalId;if(T==null){_.MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Original message otid is null - unable to serialize payload"])));return}var D=o("WALongInt").decimalStringToLongInt(T),x=(i=e.protoMsg)==null||(i=i.protobuf)==null?void 0:i.buffer;if(x==null){_.MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Protobuf top level upload payload is null - unable to serialize payload"])));return}if(C===o("EBWasm.pb").EncryptedBackupsKeyValueActionType.UPSERT_TOPLEVEL){var $={payload:x};return babelHelpers.extends({},L,{messageTags:k,offlineThreadingId:D,tagsToDelete:I,toplevelMessage:$})}if(C===o("EBWasm.pb").EncryptedBackupsKeyValueActionType.UPSERT_SUPPLEMENTAL){var P,N=(P=e.protoMsg)==null||(P=P.msgId)==null?void 0:P.externalId;if(N==null){_.MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Supplemental otid is null - unable to serialize payload"])));return}var M=o("WALongInt").decimalStringToLongInt(N),w=h(e,D,x);if(w!=null)return babelHelpers.extends({},L,{messageTags:k,offlineThreadingId:M,supplementalMessage:w,tagsToDelete:I})}if(C===o("EBWasm.pb").EncryptedBackupsKeyValueActionType.DELETE_TOPLEVEL||C===o("EBWasm.pb").EncryptedBackupsKeyValueActionType.DELETE_TOPLEVEL_WITH_PLACEHOLDER){var A,F=(A=e.protoMsg)==null||(A=A.msgId)==null?void 0:A.externalId;if(F==null){_.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Deletion message otid is null - unable to serialize payload"])));return}var O=o("WALongInt").decimalStringToLongInt(F),B={payload:x},W=babelHelpers.extends({},L,{messageTags:k,offlineThreadingId:O,tagsToDelete:I,toplevelMessage:B});return C===o("EBWasm.pb").EncryptedBackupsKeyValueActionType.DELETE_TOPLEVEL_WITH_PLACEHOLDER?babelHelpers.extends({},W,{deletionOtid:D}):W}}async function C(e,t,n){var r=await o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.secure_encrypted_backups_client_state)),a=r==null?void 0:r.backupId,i=r==null?void 0:r.deviceId,l=r==null?void 0:r.encryptionVersion,s=await o("ReQL").firstAsync(o("ReQL").fromTableDescending(e.secure_encrypted_backups_epochs)),u=s==null?void 0:s.epochId,c=s==null?void 0:s.epochAnonIdBlob,d=s==null?void 0:s.epochRootKeyBlob,m=r==null?void 0:r.ocmfClientStateBlob,_=r==null?void 0:r.mailboxRootKeyBlob;if(a==null)return t.map(function(e){return o("WAResultOrError").makeError({error:"backup_id_null",instanceKey:e.uploadTrackingInstanceKey})});if(i==null)return t.map(function(e){return o("WAResultOrError").makeError({error:"device_id_null",instanceKey:e.uploadTrackingInstanceKey})});if(u==null)return t.map(function(e){return o("WAResultOrError").makeError({error:"epoch_id_null",instanceKey:e.uploadTrackingInstanceKey})});if(c==null)return t.map(function(e){return o("WAResultOrError").makeError({error:"epoch_anon_id_null",instanceKey:e.uploadTrackingInstanceKey})});if(d==null)return t.map(function(e){return o("WAResultOrError").makeError({error:"epoch_root_key_null",instanceKey:e.uploadTrackingInstanceKey})});if(m==null)return t.map(function(e){return o("WAResultOrError").makeError({error:"ocmf_client_state_blob_null",instanceKey:e.uploadTrackingInstanceKey})});if(_==null)return t.map(function(e){return o("WAResultOrError").makeError({error:"mailbox_root_key_blob_null",instanceKey:e.uploadTrackingInstanceKey})});if(l==null)return t.map(function(e){return o("WAResultOrError").makeError({error:"encryption_version_null",instanceKey:e.uploadTrackingInstanceKey})});var f=o("WALongInt").decimalStringToLongInt((p||(p=o("I64"))).to_string(a)),g=o("WALongInt").decimalStringToLongInt(p.to_string(i)),h=o("WALongInt").decimalStringToLongInt(p.to_string(u)),C=t.map(function(e,t){var r=n[t];return y(e,l,r!=null?r:void 0)}),b={backupId:f,deviceId:g,epoch:{epochAnonId:c,epochId:h,epochRootKey:d},mailboxRootKeyBlob:_,messages:C.filter(Boolean),ocmfClientStateBlob:m};try{var v=await o("EBWasmSerializeMessagesPayload").serializeMessagesPayload({messagesData:b});if(v.success){var S=v.value.payloads,R=new Map;return S.forEach(function(e){var t=o("WALongInt").longIntToDecimalString(e.threadId),n=o("WALongInt").longIntToDecimalString(e.offlineThreadingId),r=n+"_"+t;R.set(r,e)}),t.map(function(e){var t,n=e.threadId,r=(t=e.protoMsg)==null||(t=t.msgId)==null?void 0:t.externalId;if(r==null)return o("WAResultOrError").makeError({error:"otid is null",instanceKey:e.uploadTrackingInstanceKey});var a=r+"_"+n,i=R.get(a);if(i==null)return o("WAResultOrError").makeError({error:"serialized_payload_not_found",instanceKey:e.uploadTrackingInstanceKey});var l=i.payload,s=i.error,u=e.uploadTrackingInstanceKey;if(l!=null){if(u!=null){var c=o("MAWEBUploadTrackingUtils").makeEBWorkerQplFlowFromInstanceKey(u);c.addPoint("eb_wasm_serialization_success")}return o("WAResultOrError").makeResult({msg:e,payload:l})}return o("WAResultOrError").makeError({error:s!=null?s:"runtime_error_during_serialization",instanceKey:e.uploadTrackingInstanceKey})})}else return t.map(function(e){return o("WAResultOrError").makeError({error:v.error,instanceKey:e.uploadTrackingInstanceKey})})}catch(e){return t.map(function(e){return o("WAResultOrError").makeError({error:"runtime_error",instanceKey:e.uploadTrackingInstanceKey})})}}l.serializeMessageBatchWasm=C}),98);
__d("LSBackupContentType",[],(function(t,n,r,o,a,i){var e=Object.freeze({MESSAGE:1,THREAD:2});i.default=e}),66);
__d("LSEncryptedBackupsAttachmentErrorCode",[],(function(t,n,r,o,a,i){var e=Object.freeze({NO_ERROR:0,UNKNOWN_ERROR:1,MEDIA_TYPE_MISSING:2,PRODUCT_TYPE_MISSING:3,SERIALIZATION_ERROR:21});i.default=e}),66);
__d("LSPendingBackupStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({NEEDS_BACKUP:1,BACKUP_IN_PROGRESS:2,BLOCKED:3});i.default=e}),66);
__d("LSSerializeAttachmentBackupPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][serializeAttachmentBackupPayload] Beginning execution."),r[1]=t.i64.of_float(Date.now()),r[2]=void 0,r[3]=t.i64.of_int32(e[0].length),t.i64.gt(r[3],t.i64.cast([0,0]))?t.loopAsync(r[3],function(o){return r[17]=o,t.sequence([function(o){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),e[0],r[17]).then(function(e){var t;return t=e,r[18]=t[0],r[19]=t[1],t})},function(e){return r[20]=r[18].get("attachment_trace_id"),r[2]=r[20]}])}):t.resolve()},function(e){return r[2]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,637746317]),r[2],"LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure_start"):t.resolve()},function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!1}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[17]=new t.Map,r[17].set("error_msg","Expected a nonempty query result"),r[17].set("code",t.i64.cast([0,3])),r[17].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[18]=t.createArray(),r[19]=(r[18].push(r[17]),r[18]),o=[void 0,r[18]],r[4]=o[0],r[5]=o[1]):(n=l.item,r[17]=new t.Map,r[17].set("backup_id",n.backupId),r[17].set("device_public_key_blob",n.devicePublicKeyBlob),r[17].set("device_private_key_blob",n.devicePrivateKeyBlob),r[17].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[17].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[17].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[17].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[17].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[17].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[17].set("orf_client_state_v2_blob",void 0),r[17].set("orf_v2_authority_level",void 0),r[17].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[17].set("device_id",n.deviceId),r[17].set("backup_tenancy",n.backupTenancy),r[17].set("encryption_version",n.encryptionVersion),r[17].set("revision_version",n.revisionVersion),r[17].set("initialize_restore_result",void 0),r[17].set("device_creation_timestamp_sec",void 0),r[17].set("authority_level",n.authorityLevel),a=[r[17],void 0],r[4]=a[0],r[5]=a[1])})},function(o){return r[7]=new t.Map,r[7].set("value",r[4]),r[7].set("errors",r[5]),r[8]=r[7].get("value"),r[8]!==void 0?t.sequence([function(o){return r[17]=r[8].get("backup_id"),r[18]=r[8].get("device_public_key_blob"),r[19]=r[8].get("device_private_key_blob"),r[20]=r[8].get("epoch_storage_public_key_blob"),r[21]=r[8].get("epoch_storage_private_key_blob"),r[22]=r[8].get("epoch_auth_public_key_blob"),r[23]=r[8].get("epoch_auth_private_key_blob"),r[24]=r[8].get("mailbox_root_key_blob"),r[25]=r[8].get("ocmf_client_state_blob"),r[26]=r[8].get("orf_client_state_v2_blob"),r[27]=r[8].get("orf_v2_authority_level"),r[28]=r[8].get("oblivious_validation_token_blob"),r[29]=r[8].get("device_id"),r[30]=r[8].get("backup_tenancy"),r[31]=r[8].get("encryption_version"),r[32]=r[8].get("revision_version"),r[33]=r[8].get("initialize_restore_result"),r[34]=r[8].get("device_creation_timestamp_sec"),r[35]=r[8].get("authority_level"),t.i64.neq(r[29],void 0)?t.sequence([function(e){return r[38]=void 0,t.i64.neq(r[38],void 0)?t.resolve(r[39]=r[38]):t.sequence([function(e){return r[44]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return r[45]&&(r[54]=(r[44].push(t.i64.cast([0,0])),r[44])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[46]=t[0],t})},function(e){return r[46]&&(r[54]=(r[44].push(t.i64.cast([0,2])),r[44])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return r[47]&&(r[54]=(r[44].push(t.i64.cast([0,3])),r[44])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return r[48]&&(r[54]=(r[44].push(t.i64.cast([0,4])),r[44])),r[49]=t.createArray(),r[50]=t.i64.of_int32(r[44].length),t.i64.gt(r[50],t.i64.cast([0,0]))?t.loopAsync(r[50],function(e){return r[54]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[44],r[54]).then(function(e){var t;return t=e,r[55]=t[0],r[56]=t[1],t})},function(e){return r[57]=(r[49].push(r[55]),r[49])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[54]=t.createArray(),r[55]=t.i64.of_int32(r[49].length),t.i64.gt(r[55],t.i64.cast([0,0]))?t.loopAsync(r[55],function(e){return r[57]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[49],r[57]).then(function(e){var t;return t=e,r[58]=t[0],r[59]=t[1],t})},function(e){return r[60]=(r[54].push(t.i64.to_string(r[58])),r[54])}])}):t.resolve()},function(e){return r[56]=r[54].join(","),r[51]=r[56]}])},function(e){return r[49].some(function(e){return t.i64.eq(r[31],e)})?r[52]=r[31]:r[52]=void 0,t.i64.neq(r[52],void 0)?r[53]=r[52]:r[53]=void 0,r[39]=r[53]}])},function(o){return t.i64.neq(r[39],void 0)?r[40]=r[39]:r[40]=t.i64.cast([0,0]),t.i64.neq(r[30],void 0)?r[41]=r[30]:r[41]=t.i64.cast([0,1]),t.i64.eq(e[4],t.i64.cast([0,0]))?t.sequence([function(o){return r[44]=t.createArray(),r[45]=t.i64.of_int32(e[0].length),t.i64.gt(r[45],t.i64.cast([0,0]))?t.loopAsync(r[45],function(o){return r[61]=o,t.sequence([function(o){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),e[0],r[61]).then(function(e){var t;return t=e,r[62]=t[0],r[63]=t[1],t})},function(e){return r[64]=r[62].get("media_type"),r[65]=r[62].get("zippy_object_id"),r[66]=r[65],t.like(r[66],"%.%")||t.like(r[66],"%\uFFFD%")?(r[86]=["Object ID: ",r[66]].join(""),(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure] ",r[86]].join("")),r[85]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure",r[86],r[85],t.i64.cast([0,4]))):t.resolve()},function(o){return r[67]=r[62].get("attachment_trace_id"),r[68]=t.createArray(),r[85]=(r[68].push(t.i64.to_string(r[17])),r[68]),r[85]=(r[68].push(r[66]),r[68]),r[69]=t.toJSON(r[68]),r[70]=t.createArray(),r[85]=(r[70].push(e[1]),r[70]),r[85]=(r[70].push(r[66]),r[70]),r[71]=t.toJSON(r[70]),t.nativeOperation(n("LSGetBlobFromString.nop"),r[69]).then(function(e){var t;return t=e,r[72]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),r[72]).then(function(e){var t;return t=e,r[73]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[25],r[73]).then(function(e){var t;return t=e,r[74]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[74]).then(function(e){var t;return t=e,r[75]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),r[71]).then(function(e){var t;return t=e,r[76]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),r[76]).then(function(e){var t;return t=e,r[77]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[25],r[77]).then(function(e){var t;return t=e,r[78]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[78]).then(function(e){var t;return t=e,r[79]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),r[69]).then(function(e){var t;return t=e,r[80]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),r[80]).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[25],r[81]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[82]).then(function(e){var t;return t=e,r[83]=t[0],t})},function(e){return r[84]=new t.Map,r[84].set("attachment_index_key",r[75]==null?"":r[75]),r[84].set("media_type",r[64]),r[84].set("zippy_object_id",r[66]),r[84].set("attachment_trace_id",r[67]),r[84].set("salt_partial_access_token",r[79]==null?"":r[79]),r[84].set("salt_partial_attachment_index_key",r[83]==null?"":r[83]),r[85]=(r[44].push(r[84]),r[44])}])}):t.resolve()},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[1]).then(function(e){var t;return t=e,r[46]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWVzc2FnZV9pZF9zY29wZQ=="),r[46]).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[25],r[47]).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[48]).then(function(e){var t;return t=e,r[49]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[1]).then(function(e){var t;return t=e,r[50]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),r[50]).then(function(e){var t;return t=e,r[51]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[25],r[51]).then(function(e){var t;return t=e,r[52]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[52]).then(function(e){var t;return t=e,r[53]=t[0],t})},function(o){return t.nativeOperation(n("LSGetBlobFromString.nop"),e[2]).then(function(e){var t;return t=e,r[54]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("dGhyZWFkX2lkX3Njb3Bl"),r[54]).then(function(e){var t;return t=e,r[55]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[25],r[55]).then(function(e){var t;return t=e,r[56]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[56]).then(function(e){var t;return t=e,r[57]=t[0],t})},function(n){var o;return r[58]=new t.Map,r[58].set("attachment_infos",r[44]),r[58].set("message_partial_id",r[49]==null?"":r[49]),r[58].set("product_type",e[3]),r[58].set("salt_partial_id",r[53]==null?"":r[53]),r[58].set("thread_partial_id",r[57]==null?"":r[57]),r[59]=t.toJSON(r[58]),r[60]=new t.Map,r[60].set("payload",r[59]),o=[r[60],void 0],r[42]=o[0],r[43]=o[1]}]):t.sequence([function(o){return e[5]!==void 0?r[44]=e[5]:r[44]="",r[45]=".",r[47]=["LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure",r[45],r[44],r[45],t.i64.to_string(t.i64.cast([-1,4294967295]))].join(""),r[2]!==void 0&&r[47]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[2],"attachment_error",r[47]):t.resolve()},function(e){var n;return r[46]=new t.Map,r[46].set("error_code",t.i64.cast([-1,4294967295])),r[46].set("stored_procedure","LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure"),r[46].set("error_message",r[44]),n=[void 0,r[46]],r[42]=n[0],r[43]=n[1]}])},function(e){var t;return t=[r[42],r[43]],r[36]=t[0],r[37]=t[1],t}]):t.sequence([function(e){return r[38]=".",r[40]=["LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure",r[38],"Error while reading client state",r[38],t.i64.to_string(t.i64.cast([0,24]))].join(""),r[2]!==void 0&&r[40]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[2],"attachment_error",r[40]):t.resolve()},function(e){var n;return r[39]=new t.Map,r[39].set("error_code",t.i64.cast([0,24])),r[39].set("stored_procedure","LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure"),r[39].set("error_message",""),n=[void 0,r[39]],r[36]=n[0],r[37]=n[1]}])},function(e){var t;return t=[r[36],r[37]],r[9]=t[0],r[10]=t[1],t}]):t.sequence([function(e){return r[17]=r[7].get("errors"),r[18]=r[7].get("errors"),r[19]=".",r[21]=["LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure",r[19],"Error while reading client state",r[19],t.i64.to_string(t.i64.cast([0,1]))].join(""),r[2]!==void 0&&r[21]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,637746317]),r[2],"attachment_error",r[21]):t.resolve()},function(e){var n;return r[20]=new t.Map,r[20].set("error_code",t.i64.cast([0,1])),r[20].set("stored_procedure","LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure"),r[20].set("error_message",""),n=[void 0,r[20]],r[9]=n[0],r[10]=n[1]}])},function(e){return r[11]=t.i64.of_float(Date.now()),r[12]=t.i64.random(),r[14]="Finishing execution. Execution time: ",r[15]=t.i64.to_string(t.i64.sub(r[11],r[0])),r[16]=" ms",r[13]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][serializeAttachmentBackupPayload] ",r[13],r[14],r[13],r[15],r[13],r[16]].join("")),t.i64.eq(t.i64.mod_(r[12],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[17]=",",r[18]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"serializeAttachmentBackupPayload",[r[14],r[17],r[15],r[17],r[16]].join(""),r[18],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[9],r[10]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state"],a.exports=e}),null);
__d("LSSerializeAttachmentBackupPayloadStoredProcedure",["LSSerializeAttachmentBackupPayload","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSSerializeAttachmentBackupPayload"),a.attachmentInfos,a.messageId,a.threadId,a.productType,a.error,a.errorMessage);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWUploadPayloadGenerator",["EBLogger","EBParseUploadSerializationPayload","EBWasmSerializeMessagesModule","I64","LSBackupContentType","LSEncryptedBackupsAttachmentErrorCode","LSFactory","LSIntEnum","LSPendingBackupStatus","LSSerializeAttachmentBackupPayloadStoredProcedure","LSShape","LSTaskSerializerEncryptedBackupsUpload","LSVec","MAWCastToMsgrServerMediaType","MAWEBFrontendQPLLogger","MAWEBUploadTrackingUtils","MWEBODSUtils","Random","ReQL","WAErrorMessage","WAResultOrError","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=o("EBLogger").EBLogger().tags(["MAWUploadPayloadGenerator"]),p="0",_=new Set;function f(){for(var e=0;e<1e8;e++){var t=o("Random").uint32();if(!_.has(t))return t}throw m.mustfixThrow("Unable to generate a unique task ID after 100 million attempts")}function g(e,t){return r("gkx")("18428")?h(e,t):y(e,t)}async function h(t,n){var r=await Promise.allSettled(n.map(function(e){var n=e.uploadTrackingInstanceKey;if(n!=null){var r=o("MAWEBUploadTrackingUtils").makeEBWorkerQplFlowFromInstanceKey(n);r.addPoint("wasm_upload_serialization_start")}return S(t,e)})),a=r.map(function(t){if(t.status==="rejected"){m.WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate attachment payload: ",""])),t.reason);return}return t.value});return o("EBWasmSerializeMessagesModule").serializeMessageBatchWasm(t,n,a)}async function y(e,t){var n="unknown";n=await L(e)?"available":"unavailable";var a=t.map(function(t){try{var n=f();return _.add(n),o("WAResultOrError").makeResult({msg:t,taskMetadataPromise:C(e,t,n)})}catch(e){return o("WAResultOrError").makeError({error:o("WAErrorMessage").maybeGetMessageFromError(e),instanceKey:t.uploadTrackingInstanceKey})}}),i=await Promise.allSettled(a.map(async function(t){if(!t.success)return t;var a=t.value,i=a.msg,l=a.taskMetadataPromise;try{var s=await l,u=s.uploadTrackingInstanceKey;u!=null&&o("MAWEBUploadTrackingUtils").addPointWorkerOnly(u,"upload_task_serialization_start",{string:{base_epoch_availability:n}});var d=await r("LSTaskSerializerEncryptedBackupsUpload")((c||(c=o("I64"))).of_int32(s.task),r("LSFactory")(e)),m=d[0],p=d[1];if(m!=null){var f=o("EBParseUploadSerializationPayload").parseUploadSerializationResponse(m);if(!f.success)return o("WAResultOrError").makeError({error:f.error,instanceKey:u});var g=f.value,h=!1;if(g.failure!=null&&(h=!0,o("EBParseUploadSerializationPayload").logUploadSerializationErrors([g.failure],"echo",s.uploadTrackingInstanceKey)),g.protobuf_failures!=null){var y=r("LSVec").toArray(g.protobuf_failures).filter(Boolean);y.length>0&&(h=!0,o("EBParseUploadSerializationPayload").logUploadSerializationErrors(y,"protobuf",s.uploadTrackingInstanceKey))}u!=null&&o("MAWEBUploadTrackingUtils").addPointWorkerOnly(u,h?"upload_task_serialization_failure":"upload_task_serialization_success")}return await e.pending_backups_context_v2.delete(s.pending_backups_context_v2_pk),s.pending_protobuf_backups_context_pk!=null&&await e.pending_protobuf_backups_context.delete(s.pending_protobuf_backups_context_pk),_.delete(s.task),o("WAResultOrError").makeResult({msg:i,payload:m})}catch(e){return o("WAResultOrError").makeError({error:o("WAErrorMessage").maybeGetMessageFromError(e),instanceKey:i.uploadTrackingInstanceKey})}}));return i.map(function(e){return e.status==="rejected"?o("WAResultOrError").makeError(e.reason):e.value})}async function C(e,t,n){var a,i,l,p,_,f=t.sortOrderMs.toString(),g=(c||(c=o("I64"))).of_int32(n),h=c.of_float(t.actionType),y=void 0;try{y=await S(e,t)}catch(e){m.WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate attachment payload: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e))}var C=t.protoMsg,b=C==null||(a=C.originalMsgProtocolId)==null?void 0:a.externalId,v=C==null||(i=C.msgId)==null?void 0:i.externalId,L=C!=null&&t.actionType===2;if(!L&&(t.echoDocument==null||t.echoDocument.length===0)){var E,k;m.MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["upload message is missing echo document msgType: ",""])),(E=t.messageType)!=null?E:"unknown"),o("MWEBODSUtils").markODSForEB("upload","missing_echo_document."+((k=t.messageType)!=null?k:"unknown"))}var I={actionType:h,attachmentErrorCode:R(t),backupStatus:(d||(d=o("LSIntEnum"))).ofNumber(r("LSPendingBackupStatus").BACKUP_IN_PROGRESS),contentType:d.ofNumber(r("LSBackupContentType").MESSAGE),echoContent:L?"":(l=t.echoDocument)!=null?l:"",listKey:t.threadId,pendingBackupTaskId:c.of_int32(n),persistentId:"",pk:g,sortKey:f,uniqueKey:t.messageId};y!=null&&(I=babelHelpers.extends({},I,{attachmentPayload:y}));var T=await e.pending_backups_context_v2.add(I);if(C==null)return{pending_backups_context_v2_pk:T[0],task:n,uploadTrackingInstanceKey:t.uploadTrackingInstanceKey};var D={actThreadId:t.threadId,backupAction:c.of_float(C.backupActionType),messageTimestampMs:c.of_float(t.sortOrderMs),pendingBackupTaskId:c.of_float(n),supplementalKey:C.supplementalKey,toplevelOfflineThreadingId:C.backupActionType===4?C.msgId.externalId:(p=(_=C.originalMsgProtocolId)==null?void 0:_.externalId)!=null?p:C.msgId.externalId};if(C.backupActionType===2&&b!=null&&v!=null&&b!==v&&(D=babelHelpers.extends({},D,{supplementalOfflineThreadingId:v})),y!=null&&(D=babelHelpers.extends({},D,{attachmentPayload:y})),C.backupActionType===4){var x,$=(x=C.originalMsgProtocolId)==null?void 0:x.externalId;D=babelHelpers.extends({},D,{deletionOfflineThreadingId:$})}var P=await e.pending_protobuf_backups_context.add(D);return{pending_backups_context_v2_pk:T[0],pending_protobuf_backups_context_pk:P[0],task:n,uploadTrackingInstanceKey:t.uploadTrackingInstanceKey}}function b(e){if(e.attachmentInfos.length!==1)return[];var t=e.attachmentInfos[0];return[{attachment_trace_id:t.attachmentTraceId,media_type:t.mediaType,zippy_object_id:t.zippyObjectId}]}function v(e){var t,n=e.bridgeUploadAttachmentBackupContext,a=e.messageId,i=e.serverThreadKey,l=e.threadId,s=e.traceId;if(n.attachmentInfos.length!==0){var u=n.attachmentInfos;o("MAWEBFrontendQPLLogger").startFlowUploadAttachmentBackup({deliveryObjectId:u[0].zippyObjectId,flow:"unified",mediaType:(t=o("MAWCastToMsgrServerMediaType").castMediaAttachmentTypeToServerMediaType(u[0].mediaType))!=null?t:"unknown",messageId:a,threadId:l,traceId:s});var c=r("LSVec").ofArray(u.map(function(e){return o("LSShape").ofRecord({attachment_trace_id:e.attachmentTraceId,media_type:e.mediaType,zippy_object_id:e.zippyObjectId})})),m=(d||(d=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsAttachmentErrorCode").NO_ERROR);n.error!=null&&(m=(d||(d=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsAttachmentErrorCode").UNKNOWN_ERROR));var p={attachment_infos:c,error:m,error_message:null,product_type:n.productType,server_thread_key:i};return p}}async function S(e,t){var n,a,i=t.attachmentBackupContext;if(i!=null){if(t.uploadTrackingInstanceKey!=null){var l="undefined";if(i.attachmentInfos.length>0){l="new";for(var s of i.attachmentInfos)if(s.zippyObjectId.length<=60){l="old";break}}o("MAWEBUploadTrackingUtils").addPointWorkerOnly(t.uploadTrackingInstanceKey,"attachment_payload_generation_start",{string:{attachment_object_id_type:l}})}if(a=v({bridgeUploadAttachmentBackupContext:i,messageId:t.messageId,serverThreadKey:null,threadId:t.threadId,traceId:t.traceId}),a!=null){var u=await r("LSSerializeAttachmentBackupPayloadStoredProcedure")(r("LSFactory")(e),{attachmentInfos:a.attachment_infos,error:a.error,errorMessage:a.error_message,messageId:t.messageId,productType:a.product_type,threadId:t.threadId}),d=u[0],m=u[1];if(d!=null){var p=o("LSShape").toRecord(d);n=JSON.stringify({success:p.payload,upload_context:b(i)}),t.uploadTrackingInstanceKey!=null&&o("MAWEBUploadTrackingUtils").addPointWorkerOnly(t.uploadTrackingInstanceKey,"attachment_payload_generation_success",{bool:{attachment_payload_generation_success:!0}})}else if(m!=null){var _=o("LSShape").toRecord(m),f=_.error_code;n=JSON.stringify({failure:{error_code:(c||(c=o("I64"))).to_float(f),error_message:_.error_message,stored_procedure:_.stored_procedure},upload_context:b(i)}),t.uploadTrackingInstanceKey!=null&&o("MAWEBUploadTrackingUtils").addPointWorkerOnly(t.uploadTrackingInstanceKey,"attachment_payload_generation_failure",{bool:{attachment_payload_generation_success:!1},string:{attachment_payload_generation_error_code:(c||(c=o("I64"))).to_string(f),attachment_payload_generation_error_message:_.error_message}})}}}return n}function R(e){var t;return(c||(c=o("I64"))).of_float(((t=e.attachmentBackupContext)==null?void 0:t.error)!=null?r("LSEncryptedBackupsAttachmentErrorCode").UNKNOWN_ERROR:r("LSEncryptedBackupsAttachmentErrorCode").NO_ERROR)}function L(e){var t=new TextDecoder;return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.secure_encrypted_backups_epochs).filter(function(e){return t.decode(e.epochAnonIdBlob)===p})).then(function(e){return e!=null})}l.genUploadPayload=g,l.genLSUploadPayload=y}),98);
__d("XFBEBDeviceEpochStatus.facebook",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum").Mirrored(["INELIGIBLE_FOR_LABYRINTH_11","NO_OPEN_EPOCH","OK","OUTDATED","RATE_LIMITED"]),l=e;i.default=l}),66);
__d("EBUploadMessagesFromWorkerMutation",["EBBucketUtils","EBDeps","EBIsEbEnabled","EBLS","EBLogger","EBMessageProbe","EBSMAPI","EBUploadMessagesFromWorkerMutation.graphql","EncryptedBackupsWriteToMPSTables","FBLogger","I64","LSEBPayloadSerializerError","LSFactory","LSHandleBackupWriteResultV2StoredProcedure","LSPrepareOpenEpochV2StoredProcedure","LSShape","LSVec","MAWCurrentUser","MAWEBFalcoLoggerUtils","MAWEBLSInWorkerSwitch","MAWEBSwitch","MAWEBUploadTrackingUtils","MAWODSProxy","MAWUploadPayloadGenerator","MWEBODSEntityName.enum","MpsTypes","ODS","WAErrorMessage","WALogger","WAOdsEnums","WAResultOrError","createWorkerMutation","err","getErrorSafe","gkx","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C=e!==void 0?e:e=n("EBUploadMessagesFromWorkerMutation.graphql");function b(e,t,n){e.forEach(function(e){e.uploadTrackingInstanceKey!=null&&o("MAWEBUploadTrackingUtils").addPointWorkerOnly(e.uploadTrackingInstanceKey,t,n)})}function v(e,t){e.forEach(function(e){e.uploadTrackingInstanceKey!=null&&o("MAWEBUploadTrackingUtils").addAnnotationsWorkerOnly(e.uploadTrackingInstanceKey,t)})}function S(e,t,n){e.forEach(function(e){e.uploadTrackingInstanceKey!=null&&o("MAWEBUploadTrackingUtils").endFailWorkerOnly(e.uploadTrackingInstanceKey,t,n)})}function R(e,t){if(e!=null){var n=new Map;for(var r of t){var a;if(!(r.uploadTrackingInstanceKey==null||((a=r.attachmentBackupContext)==null?void 0:a.attachmentInfos)==null))for(var i of r.attachmentBackupContext.attachmentInfos)i.attachmentTraceId!=null&&n.set(i.attachmentTraceId,r.uploadTrackingInstanceKey)}for(var l of e)if(l.upload_context.length>0){var c=l.upload_context[0].attachment_trace_id;if(c==null){o("EBLogger").EBLogger().WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Received null attachment trace id from the server"])));continue}var d=n.get(c);if(d==null){o("EBLogger").EBLogger().WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Received unknown attachment trace id from the server"])));continue}o("MAWEBUploadTrackingUtils").addPointWorkerOnly(d,"attachment_upload_response_received",{string:{attachment_upload_status:l.status==null?"unknown":l.status}})}}}async function L(e){var t,n=e.backupWriteResult,a=e.deviceEpochStatus,l=e.exception_string,s=e.inputMessages;if(n==null)return S(s,"ebls_upload_failed_backup_write_result_null",{string:{error:"backupWriteResult is null"}}),o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backupWriteResult is null"]))),o("WAResultOrError").makeError("backup_write_result_null");var u=await o("EBLS").getLSStorage(),m=n.is_success,p=n.delete_mailbox,_=(t=n.protobuf_params)==null?void 0:t.delete_on_success;if(m!=null&&p!=null){if(m){r("FBLogger")("wmi_eb").info("Worker successfully completed GQL upload batch of size %s",s.length),b(s,"ebls_upload_success");var g=o("EBMessageProbe").getEBMessageProbeInstance();s.forEach(function(e){g.addMarkerToItem(o("MpsTypes").toMessageId(e.messageId),"graphql_upload_success",{batch_size:s.length,is_success:!0})})}else{S(s,"ebls_upload_failed",{string:{error:l}});var f=o("EBMessageProbe").getEBMessageProbeInstance();return s.forEach(function(e){f.addMarkerToItem(o("MpsTypes").toMessageId(e.messageId),"graphql_upload_failed",{is_success:!1,upload_error:l!=null?l:"unknown_error"})}),o("WAResultOrError").makeError("gql_upload_failed")}await u.runInTransaction(function(e){return r("LSHandleBackupWriteResultV2StoredProcedure")(r("LSFactory")(e),{deleteMailbox:p,isSuccess:m,protobufParams:_!=null?o("LSShape").ofRecord({delete_on_success:_}):void 0,traceIds:r("LSVec").ofArray(s.map(function(e){return e.traceId}))})},"readwrite",void 0,void 0,i.id+":293")}var h=a==null?"null":a;if(v(s,{string:{deviceEpochStatus:h}}),D(a)&&o("EBLogger").EBLogger().MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["EBUpload: deviceEpochStatus is not OK: ",""])),h),a==null)return o("WAResultOrError").makeError("device_epoch_status_null");e:{if(a==="NO_OPEN_EPOCH"){return b(s,"prepare_open_epoch_v2_start"),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_UPLOAD,key:"prepare_open_epoch"}),await u.runInTransaction(function(e){return r("LSPrepareOpenEpochV2StoredProcedure")(r("LSFactory")(e),{backupId:void 0})},"readwrite",void 0,void 0,i.id+":333"),b(s,"prepare_open_epoch_v2_end"),o("WAResultOrError").makeResult();break e}if(a==="OUTDATED"){return o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_UPLOAD,key:"outdated_epoch"}),await T(s),o("WAResultOrError").makeError("bad_epoch_status");break e}if(a==="OK"){b(s,"epoch_status_ok");break e}if(a==="INELIGIBLE_FOR_LABYRINTH_11")return b(s,"ineligible_for_labyrinth_1_1"),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_UPLOAD,key:"ineligible_for_labyrinth_1_1"}),r("gkx")("20911")?(S(s,"ineligible_for_labyrinth_1_1",{string:{error:"ineligible for labyrinth 1.1"}}),o("WAResultOrError").makeError("bad_epoch_status")):o("WAResultOrError").makeResult();if(a==="RATE_LIMITED"){return b(s,"rate_limited"),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_UPLOAD,key:"rate_limited"}),o("WAResultOrError").makeResult();break e}{o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_UPLOAD,key:"unknown_epoch_status"}),b(s,"unknown_epoch_status");break e}}return o("WAResultOrError").makeResult()}async function E(e,t){var n=o("EBMessageProbe").getEBMessageProbeInstance();try{var a;(h||(h=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"worker_thread"),b(e,"ebls_init_start"),await o("EBLS").init();var l=await o("EBLS").getLSStorage();b(e,"ebls_backup_tenancy_start");var s={bool:{is_main_thread:!1},int:{batch_size:e.length},string:{batch_bucket:o("EBBucketUtils").getBucketName(e.length,100,10),source:t}};if(v(e,s),!await o("EBIsEbEnabled").isEbEnabledLS(l.tables)){for(var u of e)if(u.uploadTrackingInstanceKey!=null){var c=u.uploadTrackingInstanceKey;o("MAWEBUploadTrackingUtils").addPointWorkerOnly(c,"user_device_not_enrolled_invalid_gql_request",{bool:{MAWEBLSInWorkerSwitch:r("MAWEBLSInWorkerSwitch").isEnabled(),MAWEBSwitch:r("MAWEBSwitch").isEnabled()}});var d=u.echoDocument!=null?"dual_upload":"protobuf_only";o("MAWEBFalcoLoggerUtils").logEBFalcoTaskSkipped(u,d,"user_device_not_enrolled"),o("MAWEBUploadTrackingUtils").endSuccessWorkerOnly(c,"upload_tracking_completed")}return o("WAResultOrError").makeError("user_device_not_enrolled")}b(e,"ebls_upload_start");var g;try{g=await l.runInTransaction(async function(t){var n=new Map;for(var a of e)a.uploadTrackingInstanceKey!=null&&a.protoMsg!=null&&n.set(a.uploadTrackingInstanceKey,a);if(r("gkx")("18428"))b(e,"ebls_lsdb_write_skipped"),b(e,"ebls_mps_write_skipped");else{var i=await Promise.allSettled(n.values().map(async function(e){var n=e.protoMsg,a=e.threadId,i=e.uploadTrackingInstanceKey;if(i==null||n==null)throw r("err")("uploadTrackingInstanceKey or protoMsg are null");o("MAWEBUploadTrackingUtils").addPointWorkerOnly(i,"ebls_mps_write_start");var l=e.uploadTrackingInstanceKey!=null?o("MAWEBUploadTrackingUtils").makeEBWorkerQplFlowFromInstanceKey(e.uploadTrackingInstanceKey):null,s=await o("EncryptedBackupsWriteToMPSTables").writeToMPSTables(t,n,a,!1,l);if(n.backupActionType===1&&await o("EncryptedBackupsWriteToMPSTables").writeTagsToMPSTables(t,n,a),s.success){o("MAWEBUploadTrackingUtils").addPointWorkerOnly(i,"ebls_mps_write_success");return}var u=s.error,c=u.errorCode,d=u.errorMsg;throw k(c)?o("MAWEBUploadTrackingUtils").endCancelWorkerOnly(i,{int:{errorCode:c!=null?(y||(y=o("I64"))).to_float(c):r("LSEBPayloadSerializerError").UNKNOWN},string:{error:d}}):o("MAWEBUploadTrackingUtils").endFailWorkerOnly(i,"ebls_mps_write_failed",{string:{error:d}}),r("err")("Failed to write to MPS")})),l=n.keys().toArray();for(var s of i.entries()){var u=s[0],c=s[1];c.status==="rejected"&&n.delete(l[u])}}var d=await o("MAWUploadPayloadGenerator").genUploadPayload(t,n.values().toArray());return d.map(function(e){if(e.success){if(e.value.msg.uploadTrackingInstanceKey!=null)return o("MAWEBUploadTrackingUtils").addPointWorkerOnly(e.value.msg.uploadTrackingInstanceKey,"ebls_upload_payload_generated"),e.value}else{var t=e.error,n=t.error,r=t.instanceKey;return r!=null&&o("MAWEBUploadTrackingUtils").endFailWorkerOnly(r,"ebls_payload_generation_failed",{string:{error:n}}),null}}).filter(Boolean)},"readwrite",void 0,void 0,i.id+":445")}catch(t){var E=o("WAErrorMessage").maybeGetMessageFromError(t);return S(e,"ebls_upload_failed_payload",{string:{error:E}}),o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to generate payload: ",""])),E),o("WAResultOrError").makeError("upload_serialization_failure")}if(g.length===0)return S(e,"ebls_upload_payload_empty"),o("WAResultOrError").makeResult();var T=g.map(function(e){return e.msg});T.forEach(function(e){var t=e.echoDocument!=null?"dual_upload":"protobuf_only";o("MAWEBFalcoLoggerUtils").logEBFalcoTaskIssued(e,t)});var D=r("createWorkerMutation")(C),x=D[0];T.forEach(function(e){n.addMarkerToItem(o("MpsTypes").toMessageId(e.messageId),"graphql_upload_start")});var $=await x({input:{app_id_str:o("MAWCurrentUser").getAppID(),payload:{msg_payloads:g.map(function(e){return e.payload}).filter(Boolean)}}});if(b(T,"ebls_received_gql_upload_response"),$==null)return S(T,"ebls_upload_failed_response_null"),o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] graphqlResponse is null"]))),T.forEach(function(e){var t=e.echoDocument!=null?"dual_upload":"protobuf_only";o("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(e,t,"ebls_not_initialized"),n.addMarkerToItem(o("MpsTypes").toMessageId(e.messageId),"graphql_upload_failed_null_response")}),o("WAResultOrError").makeError("gql_upload_null_response");var P=(a=$.xfb_upload_encrypted_msg_to_backup)!=null?a:{},N=P.exception_string,M=P.labyrinth_1_0;R(M==null?void 0:M.attachment_upload_status,T);var w=await L({backupWriteResult:M==null?void 0:M.backup_write_result_response,deviceEpochStatus:M==null?void 0:M.device_epoch_status,exception_string:N,inputMessages:T});return w.success?T.forEach(function(e){o("MAWEBFalcoLoggerUtils").logEBFalcoEncryptedBackupUploadSuccess(e)}):T.forEach(function(e){var t=e.echoDocument!=null?"dual_upload":"protobuf_only";o("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(e,t,w.error)}),w}catch(t){var A=r("getErrorSafe")(t);return S(e,"ebls_upload_failed_response",{string:{error:A.message}}),I(t)&&(o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_UPLOAD,key:"mismatched_vsr_fingerprint"}),r("justknobx")._("5155")&&await r("EBSMAPI").deleteBackupsOnClient({reason:"vsr_fingerprint_mismatch"})),o("EBLogger").EBLogger().catching(A).MUSTFIX(_||(_=babelHelpers.taggedTemplateLiteralLoose(["EB graphql upload failed"]))),e.forEach(function(e){var t=e.echoDocument!=null?"dual_upload":"protobuf_only";o("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(e,t,"ebls_not_initialized"),n.addMarkerToItem(o("MpsTypes").toMessageId(e.messageId),"graphql_upload_exception")}),o("WALogger").ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to upload with EBLS: ",""])),t),o("WAResultOrError").makeError("gql_upload_runtime_error")}}function k(e){var t=e!=null?(y||(y=o("I64"))).to_int32(e):null;switch(t){case r("LSEBPayloadSerializerError").SKIP_MPS_WRITE_DUE_TO_HIGHER_TIMESTAMP_AVAILABILITY:case r("LSEBPayloadSerializerError").MESSAGE_ALREADY_DELETED:return!0;default:return!1}return!1}function I(e){return e!=null&&typeof e=="object"&&"code"in e&&e.code===2018471}async function T(e){b(e,"sync_epochs_start");var t=await o("EBDeps").getDeps().getEBSMAPI(),n=await t.syncEpochs();if(n.success===!1){var r;o("EBLogger").EBLogger().MUSTFIX(g||(g=babelHelpers.taggedTemplateLiteralLoose(["EBUpload syncEpochs failed due to: ",""])),n.error),b(e,"sync_epochs_failure"),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_UPLOAD,key:"sync_epochs_failure"}),S(e,"sync_epochs_failed",{string:{error:(r=n.error)!=null?r:"unknown sync epochs error"}}),b(e,"fetch_backup_ids_start"),await t.fetchBackupIds("sync_epochs_failure"),b(e,"fetch_backup_ids_end")}else o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_UPLOAD,key:"sync_epochs_success"}),b(e,"sync_epochs_end")}function D(e){return e==null?!0:!(e==="NO_OPEN_EPOCH"||e==="OK"||e==="RATE_LIMITED")}l.uploadMessagesFromWorker=E}),98);
__d("EchoSerializationFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5722"),s=o("FalcoLoggerInternal").create("echo_serialization_failure",e),u=s;l.default=u}),98);
__d("EchoSerializationSuccessFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5723"),s=o("FalcoLoggerInternal").create("echo_serialization_success",e),u=s;l.default=u}),98);
__d("EncryptedBackupTaskSkippedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5727"),s=o("FalcoLoggerInternal").create("encrypted_backup_task_skipped",e),u=s;l.default=u}),98);
__d("LSCreateExtraVirtualDeviceWithRecoveryCodeData",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignatureWithArmadilloKey.nop","LSCreateSignature_v2.nop","LSGetArmadilloPublicKey.nop","LSGetBlobFromString.nop","LSGetOpenEpochKeys","LSGetViewerFBID","LSHandleCreateVirtualDeviceFailure","LSHmac_v2.nop","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop","LSParseRecoveryCode_v2.nop","LSSymmetricEncryptionCreateEncryptedString.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(a){return t.sequence([function(n){return o[0]=e[2].get("recovery_code"),o[1]=e[2].get("virtual_device_type"),o[2]=e[2].get("cloud_service_account"),o[3]=e[2].get("hsm_pin_normalization_status"),o[4]=e[2].get("security_question_type"),o[5]=e[2].get("trusted_contact_id"),t.db.table(168).fetch().next().then(function(e,n){var r=e.done,a=e.value;return r?o[6]=t.i64.cast([0,1]):(n=a.item,o[9]=n.backupTenancy,t.i64.neq(o[9],void 0)?o[8]=o[9]:o[8]=t.i64.cast([0,1]),o[6]=o[8])})},function(a){return t.i64.eq(o[6],t.i64.cast([0,1]))&&o[0]==="1SHADOWTESTINGRECOVERYCODE00000000000000"?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Invalid Recovery Code Used."),o[9]="Invalid Recovery Code Used.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[9]].join("")),o[8]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[9],o[8],t.i64.cast([0,3]))):t.sequence([function(e){return o[8]=t.createArray(),t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,o[9]=t[0],t})},function(e){return t.nativeOperation(n("LSParseRecoveryCode_v2.nop"),o[0],t.i64.to_string(o[9]),o[8]).then(function(e){var t;return t=e,o[10]=t[0],o[11]=t[1],t})},function(a){return t.blobs.neq(o[11],void 0)?t.blobs.neq(o[10],void 0)?t.sequence([function(e){return t.storedProcedure(n("LSGetOpenEpochKeys"),!1).then(function(e){var t;return t=e,o[12]=t[0],t})},function(a){return o[12]!==void 0?t.sequence([function(a){return o[79]=r("justknobx")._("1310"),e[3]!==void 0?o[79]?t.sequence([function(r){return e[3]!==void 0?t.storedProcedure(n("LSAppendDataTraceAddon"),e[3],t.i64.cast([0,2866]),t.i64.cast([0,2]),void 0,void 0):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[89]?o[90]=!0:o[90]=!1,o[90]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[92]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[92]].join("")),o[91]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[92],o[91],t.i64.cast([0,3]))):t.resolve()}]):t.sequence([function(r){return e[3]!==void 0?t.storedProcedure(n("LSAppendDataTraceAddon"),e[3],t.i64.cast([0,2867]),t.i64.cast([0,2]),void 0,void 0):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[89]?o[90]=!0:o[90]=!1,o[90]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[92]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[92]].join("")),o[91]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[92],o[91],t.i64.cast([0,3]))):t.resolve()}]):t.resolve()},function(e){return o[79]?t.resolve():t.sequence([function(e){return t.count(t.db.table(169).fetch()).then(function(e){return o[89]=e})},function(e){return t.i64.gt(o[89],t.i64.cast([0,1]))?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Multiple rows in $epoch_tables."),o[91]="Multiple rows in $epoch_tables.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[91]].join("")),o[90]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[91],o[90],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,o[13]=t[0],o[14]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,o[15]=t[0],o[16]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[13],t.blob("MA=="),o[16]).then(function(e){var t;return t=e,o[17]=t[0],t})},function(r){return o[80]=t.blob(""),o[81]=t.blob(""),o[82]=t.blob(""),t.db.table(168).fetch([[[e[1]]]]).next().then(function(e,r){var a,i=e.done,l=e.value;return i?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Row with backupid not found in client state table"),o[90]="Row with backupid not found in client state table",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))},function(e){var t;return t=[o[80],o[81],void 0,o[82]],o[18]=t[0],o[19]=t[1],o[20]=t[2],o[21]=t[3],t}]):(r=l.item,a=[r.obliviousValidationTokenBlob,r.mailboxRootKeyBlob,r.deviceId,r.ocmfClientStateBlob],o[18]=a[0],o[19]=a[1],o[20]=a[2],o[21]=a[3])})},function(e){return t.blobs.eq(o[18],o[80])?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] oblivious_token is empty!"),o[90]="oblivious_token is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.blobs.eq(o[19],o[81])?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] mailbox_root_key is empty!"),o[90]="mailbox_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.blobs.eq(o[21],o[82])?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ocmf_client_state is empty!"),o[90]="ocmf_client_state is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return o[23]=o[12].get("epoch_anon_id"),o[24]=o[12].get("epoch_root_key"),o[25]=t.createArray(),o[89]=(o[25].push(t.i64.cast([0,32])),o[25]),t.nativeOperation(n("LSBase64Encode.nop"),o[23]).then(function(e){var t;return t=e,o[26]=t[0],t})},function(e){return o[26]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",o[26]].join("")),void 0,o[24],o[25]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[89]?o[90]=!1:o[90]=!0,o[90]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),o[93]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[93]].join("")),o[92]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[93],o[92],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[94]=t[0],t})},function(e){return o[91]=o[94]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[89],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[92]=t[0],o[93]=t[1],t})},function(e){return o[91]=o[92]}])},function(e){return o[27]=o[91]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),o[90]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[90],o[89],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[91]=t[0],t})},function(e){return o[27]=o[91]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),o[27],o[14]).then(function(e){var t;return t=e,o[28]=t[0],t})},function(e){return t.blobs.neq(o[28],void 0)?t.resolve(o[29]=o[28]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] device_epoch_hmac is null!"),o[90]="device_epoch_hmac is null!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[91]=t[0],t})},function(e){return o[29]=o[91]}])},function(e){return o[30]=o[12].get("epoch_root_key"),t.blobs.neq(o[30],void 0)?t.sequence([function(e){return o[89]=t.createArray(),o[95]=(o[89].push(t.i64.cast([0,18])),o[89]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,o[30],o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return o[90]!==void 0?t.sequence([function(e){return o[95]=t.i64.of_int32(o[90].length),t.i64.ge(o[95],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[90],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[97]=t[0],o[98]=t[1],t})},function(e){return o[96]=o[97]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),o[98]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[98]].join("")),o[97]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[98],o[97],t.i64.cast([0,3]))},function(e){return o[96]=void 0}])},function(e){return o[91]=o[96]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),o[96]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[96]].join("")),o[95]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[96],o[95],t.i64.cast([0,3]))},function(e){return o[91]=void 0}])},function(e){return t.blobs.neq(o[91],void 0)?o[92]=!0:o[92]=!1,o[92]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),o[91]).then(function(e){var t;return t=e,o[93]=t[0],t})},function(e){return o[93]!==void 0?o[94]=o[93]:o[94]="encodingfailed",o[31]=o[94]}]):t.resolve(o[31]="null")},function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),o[21]).then(function(e){var t;return t=e,o[32]=t[0],o[33]=t[1],t})},function(e){var r;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,o[89]=t[0],o[90]=t[1],t})},function(e){var t;return t=[o[32],o[33],o[89],o[90]],o[34]=t[0],o[35]=t[1],o[36]=t[2],o[37]=t[3],t}]):t.resolve((r=[o[32],o[33],void 0,void 0],o[34]=r[0],o[35]=r[1],o[36]=r[2],o[37]=r[3],r))},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[13]).then(function(e){var t;return t=e,o[38]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6dmlydHVhbF9kZXZpY2VfcHJpdmF0ZV9rZXk="),o[38]==null?"":o[38]).then(function(e){var t;return t=e,o[39]=t[0],t})},function(e){return o[39]!==void 0?o[40]=o[39]:o[40]="",o[40]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_device_private_key is empty!"),o[90]="encrypted_device_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[15]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),o[41]==null?"":o[41]).then(function(e){var t;return t=e,o[42]=t[0],t})},function(e){return o[42]!==void 0?o[43]=o[42]:o[43]="",o[43]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_epoch_storage_private_key is empty!"),o[90]="encrypted_epoch_storage_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[34]).then(function(e){var t;return t=e,o[44]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),o[44]==null?"":o[44]).then(function(e){var t;return t=e,o[45]=t[0],t})},function(e){return o[45]!==void 0?o[46]=o[45]:o[46]="",o[46]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_orf_client_state_v1_shape is empty!"),o[90]="encrypted_orf_client_state_v1_shape is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[18]).then(function(e){var t;return t=e,o[47]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),o[47]==null?"":o[47]).then(function(e){var t;return t=e,o[48]=t[0],t})},function(e){return o[48]!==void 0?o[49]=o[48]:o[49]="",o[49]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_oblivious_validation_token is empty!"),o[90]="encrypted_oblivious_validation_token is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[19]).then(function(e){var t;return t=e,o[50]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),o[50]==null?"":o[50]).then(function(e){var t;return t=e,o[51]=t[0],t})},function(e){return o[51]!==void 0?o[52]=o[51]:o[52]="",o[52]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_mailbox_root_key is empty!"),o[90]="encrypted_mailbox_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return o[53]=o[12].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[53]).then(function(e){var t;return t=e,o[54]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),o[54]==null?"":o[54]).then(function(e){var t;return t=e,o[55]=t[0],t})},function(e){return o[55]!==void 0?o[56]=o[55]:o[56]="",o[56]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_epoch_anon_id is empty!"),o[90]="encrypted_epoch_anon_id is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return o[57]=o[12].get("epoch_root_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[57]).then(function(e){var t;return t=e,o[58]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),o[58]==null?"":o[58]).then(function(e){var t;return t=e,o[59]=t[0],t})},function(e){return o[59]!==void 0?o[60]=o[59]:o[60]="",o[60]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_epoch_root_key is empty!"),o[90]="encrypted_epoch_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return o[61]=new t.Map,o[61].set("encrypted_device_private_key",o[40]),o[61].set("encrypted_epoch_storage_private_key",o[43]),o[61].set("encrypted_ocmf_client_state",o[46]),o[61].set("encrypted_orf_client_state_v2",void 0),o[61].set("encrypted_oblivious_validation_token_blob",o[49]),o[61].set("encrypted_mailbox_root_key_blob",o[52]),o[61].set("encrypted_epoch_anon_id",o[56]),o[61].set("encrypted_epoch_root_key",o[60]),t.nativeOperation(n("LSBase64Encode.nop"),o[10]).then(function(e){var t;return t=e,o[62]=t[0],t})},function(e){return o[83]=o[62]==null?"":o[62],t.nativeOperation(n("LSBase64Encode.nop"),o[14]).then(function(e){var t;return t=e,o[63]=t[0],t})},function(e){return o[84]=o[63]==null?"":o[63],t.nativeOperation(n("LSBase64Encode.nop"),o[16]).then(function(e){var t;return t=e,o[64]=t[0],t})},function(e){return o[85]=o[64]==null?"":o[64],t.nativeOperation(n("LSBase64Encode.nop"),o[17]==null?t.blob("bnVsbA=="):o[17]).then(function(e){var t;return t=e,o[65]=t[0],t})},function(e){return o[86]=o[65]==null?"":o[65],t.nativeOperation(n("LSBase64Encode.nop"),o[29]).then(function(e){var t;return t=e,o[66]=t[0],t})},function(e){return o[87]=o[66]==null?"":o[66],t.nativeOperation(n("LSBase64Encode.nop"),o[35]).then(function(e){var t;return t=e,o[67]=t[0],t})},function(e){return o[88]=o[67]==null?"":o[67],t.nativeOperation(n("LSGetBlobFromString.nop"),o[0]).then(function(e){var t;return t=e,o[68]=t[0],t})},function(e){return t.blobs.neq(o[19],void 0)?t.sequence([function(e){return o[89]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[19],"private_key",o[13],t.i64.cast([0,1]),o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return t.blobs.neq(o[90],void 0)?o[91]=o[90]:o[91]=void 0,o[69]=o[91]}]):t.resolve(o[69]=void 0)},function(e){return t.blobs.neq(o[69],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[69]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[70]=o[89]}]):t.resolve(o[70]=void 0)},function(e){return t.blobs.neq(o[19],void 0)?t.sequence([function(e){return o[89]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[19],"ocmf_client_state",o[34],t.i64.cast([0,1]),o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return t.blobs.neq(o[90],void 0)?o[91]=o[90]:o[91]=void 0,o[71]=o[91]}]):t.resolve(o[71]=void 0)},function(e){return t.blobs.neq(o[71],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[71]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[72]=o[89]}]):t.resolve(o[72]=void 0)},function(e){return t.blobs.neq(o[19],void 0)?t.sequence([function(e){return o[89]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[19],"epoch_storage_private_key",o[15],t.i64.cast([0,1]),o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return t.blobs.neq(o[90],void 0)?o[91]=o[90]:o[91]=void 0,o[73]=o[91]}]):t.resolve(o[73]=void 0)},function(e){return t.blobs.neq(o[73],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[73]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[74]=o[89]}]):t.resolve(o[74]=void 0)},function(e){return t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,o[75]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),t.i64.to_string(o[75])).then(function(e){var t;return t=e,o[76]=t[0],t})},function(e){return t.blobs.neq(o[76],void 0)?t.sequence([function(e){return o[89]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[76],"recovery_code",o[68],t.i64.cast([0,1]),o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return t.blobs.neq(o[90],void 0)?o[91]=o[90]:o[91]=void 0,o[77]=o[91]}]):t.resolve(o[77]=void 0)},function(e){return t.blobs.neq(o[77],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[77]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[78]=o[89]}]):t.resolve(o[78]=void 0)},function(r){return t.i64.neq(o[20],void 0)?t.sequence([function(e){return o[89]=o[12].get("epoch_id"),t.db.table(168).fetch().next().then(function(e,n){var r=e.done,a=e.value;return r?o[90]=t.i64.cast([0,1]):(n=a.item,o[95]=n.backupTenancy,t.i64.neq(o[95],void 0)?o[94]=o[95]:o[94]=t.i64.cast([0,1]),o[90]=o[94])})},function(e){return t.i64.eq(o[90],t.i64.cast([0,2]))?t.resolve(o[92]=void 0):t.sequence([function(e){return t.nativeOperation(n("LSGetArmadilloPublicKey.nop")).then(function(e){var t;return t=e,o[94]=t[0],t})},function(e){return o[92]=o[94]}])},function(e){return t.blobs.neq(o[92],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSCreateSignatureWithArmadilloKey.nop"),o[14]).then(function(e){var t;return t=e,o[94]=t[0],t})},function(e){return t.blobs.neq(o[94],void 0)?t.resolve(o[95]=o[94]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create labyrinth signature"),o[100]="Failed to create labyrinth signature",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoKeySigningUtils] ","",o[100]].join("")),o[99]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils",o[100],o[99],t.i64.cast([0,3]))},function(e){return o[95]=void 0}])},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[13],t.blob("Mw=="),o[92]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return t.blobs.neq(o[96],void 0)?t.resolve(o[97]=o[96]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create armadillo signature"),o[100]="Failed to create armadillo signature",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoKeySigningUtils] ","",o[100]].join("")),o[99]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils",o[100],o[99],t.i64.cast([0,3]))},function(e){return o[97]=void 0}])},function(e){return t.blobs.neq(o[97],void 0)?(t.blobs.neq(o[95],void 0)?(o[100]=new t.Map,o[100].set("armadillo_public_key",o[92]),o[100].set("armadillo_key_signature",o[97]),o[100].set("labyrinth_key_signature",o[95]),o[99]=o[100]):o[99]=void 0,o[98]=o[99]):o[98]=void 0,o[93]=o[98]}]):t.resolve(o[93]=void 0)},function(r){return o[93]!==void 0?t.sequence([function(e){return o[94]=o[93].get("armadillo_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[94]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[96]=o[93].get("armadillo_key_signature"),t.nativeOperation(n("LSBase64Encode.nop"),o[96]).then(function(e){var t;return t=e,o[97]=t[0],t})},function(e){return o[98]=o[93].get("labyrinth_key_signature"),t.nativeOperation(n("LSBase64Encode.nop"),o[98]).then(function(e){var t;return t=e,o[99]=t[0],t})},function(r){return o[100]=new t.Map,o[100].set("backup_id",e[1]),o[100].set("request_device_id",o[20]),o[100].set("virtual_device_id",o[83]),o[100].set("encrypted_secret_values",o[61]),o[100].set("public_key",o[84]),o[100].set("epoch_storage_pubkey",o[85]),o[100].set("epoch_storage_pubkey_sig",o[86]),o[100].set("device_epoch_hmac",o[87]),o[100].set("epoch_root_key_fingerprint",o[31]),o[100].set("ocmf_rotation_token",o[88]),o[100].set("is_init",!1),o[100].set("epoch_id",o[89]),o[100].set("virtual_device_type",o[1]),o[100].set("action_type",e[0]),o[100].set("private_key_debug_token",o[70]),o[100].set("ocmf_client_state_debug_token",o[72]),o[100].set("epoch_storage_pvtkey_debug_token",o[74]),o[100].set("recovery_code_debug_token",o[78]),o[100].set("trace_id",e[3]),o[100].set("cloud_service_account",o[2]),o[100].set("hsm_pin_normalization_status",o[3]),o[100].set("security_question_type",o[4]),o[100].set("trusted_contact_id",o[5]),o[100].set("armadillo_public_key",o[95]==null?"":o[95]),o[100].set("armadillo_key_signature",o[97]==null?"":o[97]),o[100].set("labyrinth_key_signature",o[99]==null?"":o[99]),o[101]=t.toJSON(o[100]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50004]),o[101],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[3],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[102]=t[0],t})}]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] failed to get armadillo key and device signatures"),o[94]=new t.Map,o[94].set("backup_id",e[1]),o[94].set("request_device_id",o[20]),o[94].set("virtual_device_id",o[83]),o[94].set("encrypted_secret_values",o[61]),o[94].set("public_key",o[84]),o[94].set("epoch_storage_pubkey",o[85]),o[94].set("epoch_storage_pubkey_sig",o[86]),o[94].set("device_epoch_hmac",o[87]),o[94].set("epoch_root_key_fingerprint",o[31]),o[94].set("ocmf_rotation_token",o[88]),o[94].set("is_init",!1),o[94].set("epoch_id",o[89]),o[94].set("virtual_device_type",o[1]),o[94].set("action_type",e[0]),o[94].set("private_key_debug_token",o[70]),o[94].set("ocmf_client_state_debug_token",o[72]),o[94].set("epoch_storage_pvtkey_debug_token",o[74]),o[94].set("recovery_code_debug_token",o[78]),o[94].set("trace_id",e[3]),o[94].set("cloud_service_account",o[2]),o[94].set("hsm_pin_normalization_status",o[3]),o[94].set("security_question_type",o[4]),o[94].set("trusted_contact_id",o[5]),o[95]=t.toJSON(o[94]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50004]),o[95],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[3],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[96]=t[0],t}))}]):t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[1],!1,e[3])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Epoch keys are unavailable."),o[14]="Epoch keys are unavailable.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[14]].join("")),o[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[14],o[13],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[1],!1,e[3])}])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Invalid Recovery Code Provided"),o[13]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[13]].join("")),o[12]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[13],o[12],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[1],!1,e[3])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Invalid Recovery Code Provided"),o[13]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[13]].join("")),o[12]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[13],o[12],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[1],!1,e[3])}])}])}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsCreateExtraVirtualDeviceWithRecoveryCodeDataStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];var s=e;l.default=s}),98);
__d("LSCreateExtraVirtualDeviceWithRecoveryCodeDataStoredProcedure",["LSCreateExtraVirtualDeviceWithRecoveryCodeData","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSCreateExtraVirtualDeviceWithRecoveryCodeData"),a.actionType,a.backupId,a.recoveryCodeData,a.traceId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSOptOutOfBackup",["LSAppendDataTraceAddon","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(a){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] Beginning execution."),r("justknobx")._("1099")?t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[11]=t[0],t})},function(e){return o[11]?o[12]=!0:o[12]=!1,o[12]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[14]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[14]].join("")),o[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[14],o[13],t.i64.cast([0,3]))):t.resolve()}])},function(r){return o[8]=new t.Map,o[8].set("backup_id",e[0]),o[8].set("trace_id",void 0),o[9]=t.toJSON(o[8]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_opt_out",t.i64.cast([0,50019]),o[9],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[10]=t[0],t})},function(e){return o[1]=t.i64.cast([0,0])}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] backup opt out flow is not enabled"),o[1]=t.i64.cast([0,1])))},function(e){return o[2]=t.i64.of_float(Date.now()),o[3]=t.i64.random(),o[5]="Finishing execution. Execution time: ",o[6]=t.i64.to_string(t.i64.sub(o[2],o[0])),o[7]=" ms",o[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] ",o[4],o[5],o[4],o[6],o[4],o[7]].join("")),t.i64.eq(t.i64.mod_(o[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[8]=",",o[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsOptOutOfBackupStoredProcedure",[o[5],o[8],o[6],o[8],o[7]].join(""),o[9],t.i64.cast([0,4]))):t.resolve()},function(e){return a[0]=o[1]}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsOptOutOfBackupStoredProcedure",e.__tables__=[];var s=e;l.default=s}),98);
__d("LSOptOutOfBackupStoredProcedure",["LSOptOutOfBackup","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSOptOutOfBackup"),a.backupId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MAWUISnippetsMessagesMetadataMapObservable",["I64","ReplayLastSubject"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(e){function t(t){var n;return n=e.call(this,t)||this,n.value=t,n}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.next=function(n){this.value=n,e.prototype.next.call(this,n)},t})(o("ReplayLastSubject").ReplayLastSubject),u=(function(){function t(){this.$1=new Map}var n=t.prototype;return n.get=function(n){var t=(e||(e=o("I64"))).to_string(n),r=this.$1.get(t);if(r==null){var a=new s([]);return this.$1.set(t,a),a}return r},n.set=function(t,n){var e=this.get(t),r=e.value;if(r.length!==n.length){e.next(n);return}var o=r.every(function(e,t){var r=n[t];return e.externalId===r.externalId&&e.sortOrderMs===r.sortOrderMs});o||e.next(n)},t})();l.Subject=s,l.MAWUISnippetsMessagesMetadataMapObservable=u}),98);
__d("updateMWLSThreadSnippet",["FBLogger","I64","MAWBridgeBuildThreadSnippet","getMAWLastMessageCtaType"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n,a=t.thread,i=t.threadSnippet,l=t.txn,s=i.snippetParams,u=o("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet({snippetContactIDs:s.contactIDs,snippetMentionJIDs:(n=s.mentionJIDs)!=null?n:[],snippetParams:s.strings,snippetSenderContactId:i.snippetSenderContactId,snippetType:i.snippetType});u==null&&r("FBLogger")("messenger_web").warn("[updateMWLSThreadSnippet] null snippet is calculated for a thread, snippetType: %s, contactsIDs is null: %s, snippetParams is null: %s",i.snippetType,s.contactIDs==null,s.strings==null);var c=i.snippetSenderContactId!=null?(e||(e=o("I64"))).of_string(i.snippetSenderContactId):(e||(e=o("I64"))).zero,d=r("getMAWLastMessageCtaType")(i.snippetType);await l.threads.put(babelHelpers.extends({},a,{lastMessageCtaType:d,snippet:u,snippetSenderContactId:c}))}l.updateMWLSThreadSnippet=s}),98);
__d("MAWUISnippetsCacheService",["FBLogger","I64","LSDatabaseSingleton","MAWChatJid","MAWJids","MAWMiActGetThreadLifecycleState__DO_NOT_USE","MAWUISnippetsMessagesMetadataMapObservable","ReStoreVaulting","WAJids","promiseDone","updateMWLSThreadSnippet"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(function(){function t(){this.namespace="snippets",this.$1=new(o("MAWUISnippetsMessagesMetadataMapObservable")).MAWUISnippetsMessagesMetadataMapObservable}var n=t.prototype;return n.onCacheChange=function(n,a){r("promiseDone")((e||(e=o("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(e){return e.runInTransaction(function(e){return Promise.all(n.map(async function(t){var n=t[0],r=t[1],i=o("WAJids").unsafeCoerceToChatJid(n),l=await o("MAWChatJid").toThreadMaybe(e,i);if(l==null){await d(e,i);return}var s=r.value.snippet,u=babelHelpers.extends({},s.snippetParams,{strings:s.snippetParams.strings.map(function(e){return o("ReStoreVaulting").maybeVault(e)})});return o("updateMWLSThreadSnippet").updateMWLSThreadSnippet({thread:l,threadSnippet:babelHelpers.extends({},s,{snippetParams:u}),txn:e}).then(function(){m(l.threadKey,a,r)})}))},"readwrite",void 0,void 0,i.id+":47")}))},n.getNewestIncomingMessagesMetadata=function(t){return this.$1.get(t)},t})(),c="[SnippetsCacheService][UI]";async function d(e,t){var n=await o("MAWMiActGetThreadLifecycleState__DO_NOT_USE").getThreadLifecycleStateByJid(e,o("MAWJids").convertChatJidToIntJid(t),"MAWUISnippetsCacheService");r("FBLogger")("MAWCacheService").mustfix(c+" Missing LSDBThread when updating snippet. jid: %s, thread state: %s",t,n.type)}function m(e,t,n){r("FBLogger")("MAWCacheService").info(c+" Updated thread snippet. threadKey: %s, source: %s, msgId: %s, reactionId: %s, ack level %s",(s||(s=o("I64"))).to_string(e),t,n.value.snippetMsgId,n.value.snippetReactionId,n.value.snippetMsgAckLevel)}var p=new u;function _(){return p}l.getMAWUISnippetsCacheService=_}),98);
__d("MAWUICacheServiceRegistry",["MAWUISnippetsCacheService"],(function(t,n,r,o,a,i,l){"use strict";var e={snippets:o("MAWUISnippetsCacheService").getMAWUISnippetsCacheService()};function s(){return e}l.getUICacheServiceRegistry=s}),98);
__d("MAWUICacheServices",["BroadcastChannelFallback","FBLogger","MAWBridgeSendAndReceive","MAWCacheServiceQPL","MAWCacheServiceUtils","MAWLoggerUtils","MAWUICacheServiceRegistry","MAWUICacheServicesBase","promiseDone","shallowArrayEqual"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){this.$1=new(o("MAWUICacheServicesBase")).MAWUICacheServicesBase(o("MAWUICacheServiceRegistry").getUICacheServiceRegistry()),this.$2=o("MAWCacheServiceUtils").getMAWCacheServiceBroadcastChannel(),this.$3()}var t=e.prototype;return t.$3=function(){var e=this,t=function(n){var t,o,a,i;if(typeof n=="object"&&n!=null&&typeof n.data=="object"&&n.data!==null&&typeof((t=n.data)==null?void 0:t.namespace)=="string"&&typeof((o=n.data)==null?void 0:o.source)=="string"&&typeof((a=n.data)==null?void 0:a.cache)=="object"&&((i=n.data)==null?void 0:i.cache)!==null&&Array.isArray(n.data.cache)){var l,s=n.data.namespace,u=n.data.cache,c=n.data.source,d;typeof((l=n.data)==null?void 0:l.instanceKey)=="number"?(d=n.data.instanceKey,c==="realtime-update"&&r("MAWCacheServiceQPL").registerInstanceKeyInUI(d),r("MAWCacheServiceQPL").addPointQPL(d,"broadcasting_to_ui_end",c)):r("FBLogger")("MAWCacheService").info("Invalid instance key received via broadcast channel."),e.$1.updateInMemoryCacheAndTriggerCallback(s,u,c,d)}else throw r("FBLogger")("messenger_web").mustfixThrow("Invalid payload received via broadcast channel.")};this.$2==null?o("BroadcastChannelFallback").registerBroadcastChannelFallbackListener(o("MAWCacheServiceUtils").MAW_CACHE_SERVICE_BROADCAST_CHANNEL,t):this.$2.onmessage=t},t.resetInMemoryCache=function(t,n){this.$1.resetInMemoryCache(t,n)},t.checkExistingCacheOrGetFromScratchAndNotifyListenersFor=async function(t,n){var e=this,a=Array.from(new Set(n)),i=o("MAWLoggerUtils").getInstanceKey();r("MAWCacheServiceQPL").startQPL(i,t),r("MAWCacheServiceQPL").addAnnotationsQPL(i,{string:{instanceKey:i.toString()},string_array:{allKeys:r("MAWCacheServiceQPL").redactKeysForNonEmployee(a)}});var l=this.$1.checkInMemoryCacheAndTriggerCallback(t,a,i);if(l.length===0){r("FBLogger")("MAWUICacheServices").info("All keys are in memory cache. Namespace: %s",t);return}var s=await this.$1.checkPersistedCacheAndTriggerCallback(t,l,i).catch(function(e){return r("FBLogger")("MAWCacheService").catching(e).mustfix("Failed to read from persisted cache in UI.",t),r("MAWCacheServiceQPL").addPointQPL(i,"read_from_persisted_cache_failed"),l});if(r("shallowArrayEqual")(l,s)?this.$1.QPLMetadata.set(i,"all-from-scratch"):(r("FBLogger")("MAWUICacheServices").info("Sending low priority bridge call to invalidate cache for keys: %s",l.join(", ")),r("MAWCacheServiceQPL").addPointQPL(i,"invalidating_cache"),r("MAWCacheServiceQPL").addAnnotationsQPL(i,{string_array:{keysToInvalidateCacheFor:r("MAWCacheServiceQPL").redactKeysForNonEmployee(l)}}),r("promiseDone")(o("MAWBridgeSendAndReceive").sendAndReceive("backend","computeCachePayloadFromScratch",{instanceKey:i,isLowPriority:!0,keys:l,namespace:t}).catch(function(e){r("MAWCacheServiceQPL").addPointQPL(i,"invalidating_cache_failed"),r("FBLogger")("MAWCacheService").catching(e).mustfix("Failed to invalidate potential outdated persisted cache.",t)}))),r("MAWCacheServiceQPL").addAnnotationsQPL(i,{int:{memoryHitRate:Math.floor((a.length-l.length)/a.length*100),persistedHitRate:Math.floor((l.length-s.length)/l.length*100)}}),s.length===0){r("FBLogger")("MAWUICacheServices").info("All keys are in persisted cache. Namespace: %s",t);return}r("FBLogger")("MAWUICacheServices").info("Sending bridge call to calculate cache from scratch for keys: %s",s.join(", ")),r("MAWCacheServiceQPL").addPointQPL(i,"sending_bridge_call_to_compute_from_scratch"),r("MAWCacheServiceQPL").addAnnotationsQPL(i,{string_array:{keysToBeCalculatedFromScratch:r("MAWCacheServiceQPL").redactKeysForNonEmployee(s)}}),await o("MAWBridgeSendAndReceive").sendAndReceive("backend","computeCachePayloadFromScratch",{instanceKey:i,isLowPriority:!1,keys:s,namespace:t}).catch(function(n){r("MAWCacheServiceQPL").endFailureQPL(i,"sending_bridge_call_to_compute_from_scratch_failed"),r("MAWCacheServiceQPL").addAnnotationsQPL(i,{string:{error:n.message}}),e.$1.QPLMetadata.delete(i),r("FBLogger")("MAWCacheService").catching(n).mustfix("Failed to compute cache from scratch for",t)})},t.getFromScratchSkippingCacheAndNotifyListenersFor=async function(t,n){var e=this,a,i=Array.from(new Set(n)),l=o("MAWLoggerUtils").getInstanceKey();(a=r("MAWCacheServiceQPL")).startQPL(l,t),a.addAnnotationsQPL(l,{string:{instanceKey:l.toString()},string_array:{allKeys:a.redactKeysForNonEmployee(i)}}),this.$1.QPLMetadata.set(l,"all-from-scratch"),a.addPointQPL(l,"sending_bridge_call_to_compute_from_scratch_skipping_cache"),await o("MAWBridgeSendAndReceive").sendAndReceive("backend","computeCachePayloadFromScratch",{instanceKey:l,isLowPriority:!1,keys:i,namespace:t}).catch(function(n){r("MAWCacheServiceQPL").endFailureQPL(l,"sending_bridge_call_to_compute_from_scratch_failed"),r("MAWCacheServiceQPL").addAnnotationsQPL(l,{string:{error:n.message}}),e.$1.QPLMetadata.delete(l),r("FBLogger")("MAWCacheService").catching(n).mustfix("Failed to compute cache from scratch for",t)})},e})(),s=null,u=function(){return s==null&&(s=new e),s};l.getMAWUICacheServices=u}),98);
__d("MWEncryptedBackupsCreateExtraVirtualDeviceWithRecoveryCodeData",["LSCreateExtraVirtualDeviceWithRecoveryCodeDataStoredProcedure","LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","LSShape","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t,n,a){var l=await o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.encrypted_backups));if(l==null)return[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)];var s=l.backupId;return s!=null?(await t.runInTransaction(function(e){return r("LSCreateExtraVirtualDeviceWithRecoveryCodeDataStoredProcedure")(r("LSFactory")(e),{actionType:n,backupId:s,recoveryCodeData:o("LSShape").ofRecord(a),traceId:void 0})},"readwrite",void 0,void 0,i.id+":41"),[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").SUCCESS)]):[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)]}l.initializeCreateExtraVirtualDeviceStoredProcedure=s}),98);
__d("MWEncryptedBackupsInitializeRestore",["EBGetLatestChatJids","EBSetRestoreStatusForInitialRestore","ExecutionEnvironment","FBLogger","LSRequestId","MAWBridge","MAWBridgeSendAndReceive","MAWEBRestoreTrackingUtils","MAWMpsGating","MAWUICacheServices","MpsOverBridge","MpsTypes","getErrorSafe","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=20;function c(e){var t=r("LSRequestId").generate();return o("MAWMpsGating").isFullMpsEnabled()?d(e,t,m,"FULL_MPS"):d(e,t,p,"MPS")}async function d(t,n,a,i){r("FBLogger")("messenger_web").INFO(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Initializing restore with ",""])),i),_(i);try{o("MAWEBRestoreTrackingUtils").markEBRestoreInitial({querySource:"GQL_MAIN_THREAD",traceId:n});var l=await o("EBGetLatestChatJids").getLatestChatJids(t,50);if(l.success===!1){o("MAWEBRestoreTrackingUtils").markEBRestoreFail(n,(s||(s=r("ExecutionEnvironment"))).isInWorker,"latestChatJidsResultOrError: "+r("getErrorSafe")(l.error).message);return}await o("EBSetRestoreStatusForInitialRestore").setRestoreStatusForInitialRestore(l.value,t);var u=o("MAWUICacheServices").getMAWUICacheServices();r("promiseDone")(u.getFromScratchSkippingCacheAndNotifyListenersFor("snippets",l.value.map(o("MpsTypes").toThreadId))),await a(l.value),o("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(n)}catch(e){throw o("MAWEBRestoreTrackingUtils").markEBRestoreFail(n,(s||(s=r("ExecutionEnvironment"))).isInWorker,"initialize_restore_failed: "+r("getErrorSafe")(e).message),e}finally{await o("EBSetRestoreStatusForInitialRestore").resetClientRestoreStatus(t)}}function m(e){return Promise.all(e.map(function(e){return o("MpsOverBridge").mps().loadMessages({debug:{purpose:"InitializeRestore"},direction:"desc",from:[o("MpsTypes").toTimestamp(Number.MAX_SAFE_INTEGER),void 0],numMessages:u,threadId:o("MpsTypes").toThreadId(e)})})).then(function(){})}function p(e){return o("MAWBridgeSendAndReceive").sendAndReceive("backend","maw_load_msgs_by_chat_jids_into_maw",{actionType:"pre-load",config:e.map(function(e){return{chatJid:e,direction:"before",includeLowerBoundMsg:!0,lowerBoundSortOrderMs:Date.now(),numMsgs:u}})})}function _(e){o("MAWBridge").getBridge().fireAndForget("backend","logInitRestoreMethodForDebugging",{method:e})}l.initializeRestore=c}),98);
__d("X25519",["$InternalEnum","Promise","WACryptoCurve25519Dependencies","WASignalKeys","WASignalOther","WASignalSignatures"],(function(t,n,r,o,a,i,l){"use strict";var e,s=n("$InternalEnum").Mirrored(["Encryption","Signing"]),u=n("$InternalEnum")({PublicKey:0,PrivateKey:1,Signature:2});function c(e,t){if(t===s.Encryption)return[];var n=1;switch(e){case u.PublicKey:n=1;break;case u.PrivateKey:n=2;break;case u.Signature:n=3;break}return[255,n]}function d(e,t,n){var r=c(t,n),o=r.length;if(o<=0)return e;var a=new Uint8Array(o+e.byteLength);return a.set(Array.from(r)),a.set(e,o),a}function m(e,t,n){var r=c(t,n).length;return e.slice(r)}function p(e,t){return{privateKey:d(e.privateKey,u.PrivateKey,t),publicKey:d(e.publicKey,u.PublicKey,t)}}function _(e){var t=p(o("WASignalKeys").makeKeyPair(),e);return{pk:t.publicKey,sk:t.privateKey}}function f(e,t){if(t===s.Encryption)return 32;switch(e){case u.PublicKey:case u.PrivateKey:return 32;case u.Signature:return 64}}function g(e,t,n){var r=c(t,n),o=r.length,a=f(t,n),i=a!=null?o+a:0;if(e.length!==i)return!1;var l=e.subarray(0,o),s=new Uint8Array(r);return s.length===l.length&&s.every(function(e,t){return e===l[t]})}function h(e,t){if(g(e,u.PublicKey,t))return e}function y(e,t){if(g(e,u.PrivateKey,t))return e}function C(e,t){var n=h(e.pkBytes,t),r=y(e.skBytes,t);if(n!=null&&r!=null)return{pk:n,sk:r}}function b(t,r){var a=m(t,u.PrivateKey,s.Signing);return o("WASignalSignatures").signMsg(o("WASignalKeys").makeKeyPairFrom(o("WASignalOther").ensureSize(a,32)),r).then(function(t){var r=d(t,u.Signature,s.Signing);return(e||(e=n("Promise"))).resolve(r)})}function v(e){if(g(e,u.Signature,s.Signing))return e}function S(e,t,n){var r=m(t,u.PublicKey,s.Signing);return o("WASignalSignatures").verifyMsgSignalVariant(o("WASignalKeys").serializeIdentity(r),n,o("WASignalOther").ensureSize(m(e,u.Signature,s.Signing),64))}function R(t,r){var a=r,i=t;return!g(i,u.PublicKey,s.Encryption)||!g(a,u.PrivateKey,s.Encryption)?(e||(e=n("Promise"))).resolve():o("WACryptoCurve25519Dependencies").calculateAgreement(i,a).then(function(t){return(e||(e=n("Promise"))).resolve(new Uint8Array(t))})}l.KeyPurpose=s,l.generateKeys=_,l.publicKeyFromBytes=h,l.secretKeyFromBytes=y,l.keysFromBytes=C,l.sign=b,l.signatureFromBytes=v,l.verify=S,l.exchangeKeys=R}),98);
__d("PublicKeyCrypto",["Promise","UInt8Array","X25519"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,r){return(e||(e=n("Promise"))).all([t,r]).then(function(t){return(e||(e=n("Promise"))).resolve(t[0]!=null&&t[1]!=null?o("UInt8Array").concatBytes([t[0],t[1]]):void 0)})}function u(e,t,n){return s(o("X25519").exchangeKeys(n,e),o("X25519").exchangeKeys(n,t))}function c(e,t,n){return s(o("X25519").exchangeKeys(n,e),o("X25519").exchangeKeys(t,e))}l.senderDeriveSharedSecret=u,l.receiverDeriveSharedSecret=c}),98);
__d("ReverbWriteFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5829"),s=o("FalcoLoggerInternal").create("reverb_write_failure",e),u=s;l.default=u}),98);
__d("ReverbWriteSuccessFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5831"),s=o("FalcoLoggerInternal").create("reverb_write_success",e),u=s;l.default=u}),98);
__d("WASmaxInAbPropsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","error");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQErrorResponseMixin=e}),98);
__d("WASmaxInAbPropsIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","bad-request");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",400);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorBadRequestMixin=e}),98);
__d("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","feature-not-implemented");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",501);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorFeatureNotImplementedMixin=e}),98);
__d("WASmaxInAbPropsNoRetryErrors",["WAResultOrError","WASmaxInAbPropsIQErrorBadRequestMixin","WASmaxInAbPropsIQErrorFeatureNotImplementedMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInAbPropsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:t.value});var n=o("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin").parseIQErrorFeatureNotImplementedMixin(e);return n.success?o("WAResultOrError").makeResult({name:"IQErrorFeatureNotImplemented",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorBadRequest","IQErrorFeatureNotImplemented"],[t,n])}l.parseNoRetryErrors=e}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry",["WAResultOrError","WASmaxInAbPropsIQErrorResponseMixin","WASmaxInAbPropsNoRetryErrors","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInAbPropsNoRetryErrors").parseNoRetryErrors(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorNoRetryErrors:i.value})):i}l.parseGetExperimentConfigResponseErrorNoRetry=e}),98);
__d("WASmaxInAbPropsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","internal-server-error");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",500);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorInternalServerErrorMixin=e}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry",["WAResultOrError","WASmaxInAbPropsIQErrorInternalServerErrorMixin","WASmaxInAbPropsIQErrorResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInAbPropsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(r.value);if(!a.success)return a;var i=o("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({errorIQErrorInternalServerErrorMixin:a.value},i.value)):i}l.parseGetExperimentConfigResponseErrorRetry=e}),98);
__d("WASmaxInAbPropsExperimentConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"prop");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"config_code",1,void 0);if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(e,"config_value");if(!r.success)return r;var a=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,e,"config_expo_key",0,void 0);return a.success?o("WAResultOrError").makeResult({configCode:n.value,configValue:r.value,configExpoKey:a.value}):a}l.parseExperimentConfigMixin=e}),98);
__d("WASmaxInAbPropsSamplingConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"prop");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"event_code",1,void 0);if(!n.success)return n;var r=o("WASmaxParseUtils").attrIntRange(e,"sampling_weight",-1e4,1e4);return r.success?o("WAResultOrError").makeResult({eventCode:n.value,samplingWeight:r.value}):r}l.parseSamplingConfigMixin=e}),98);
__d("WASmaxInAbPropsConfigs",["WAResultOrError","WASmaxInAbPropsExperimentConfigMixin","WASmaxInAbPropsSamplingConfigMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInAbPropsExperimentConfigMixin").parseExperimentConfigMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"ExperimentConfig",value:t.value});var n=o("WASmaxInAbPropsSamplingConfigMixin").parseSamplingConfigMixin(e);return n.success?o("WAResultOrError").makeResult({name:"SamplingConfig",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["ExperimentConfig","SamplingConfig"],[t,n])}l.parseConfigs=e}),98);
__d("WASmaxInAbPropsEnums",[],(function(t,n,r,o,a,i){var e={false:"false",true:"true"};i.ENUM_FALSE_TRUE=e}),66);
__d("WASmaxInAbPropsIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","result");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQResultResponseMixin=e}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseSuccess",["WAResultOrError","WASmaxInAbPropsConfigs","WASmaxInAbPropsEnums","WASmaxInAbPropsIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"prop");if(!t.success)return t;var n=o("WASmaxInAbPropsConfigs").parseConfigs(e);return n.success?o("WAResultOrError").makeResult({configs:n.value}):n}function s(e){var t=o("WASmaxParseUtils").assertTag(e,"erid");if(!t.success)return t;var n=o("WASmaxParseUtils").contentBytesRange(e,1,100);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function u(t,n){var r=o("WASmaxParseUtils").assertTag(t,"iq");if(!r.success)return r;var a=o("WASmaxParseUtils").flattenedChildWithTag(t,"props");if(!a.success)return a;var i=o("WASmaxParseUtils").optionalChildWithTag(t,"erid",s);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,a.value,"protocol","1");if(!l.success)return l;var u=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,a.value,"ab_key");if(!u.success)return u;var c=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,a.value,"hash");if(!c.success)return c;var d=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,a.value,"refresh",0,void 0);if(!d.success)return d;var m=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,a.value,"refresh_id",0,void 0);if(!m.success)return m;var p=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrStringEnum,a.value,"delta_update",o("WASmaxInAbPropsEnums").ENUM_FALSE_TRUE);if(!p.success)return p;var _=o("WASmaxInAbPropsIQResultResponseMixin").parseIQResultResponseMixin(t,n);if(!_.success)return _;var f=o("WASmaxParseUtils").mapChildrenWithTag(a.value,"prop",0,1/0,e);return f.success?o("WAResultOrError").makeResult(babelHelpers.extends({propsProtocol:l.value,propsAbKey:u.value,propsHash:c.value,propsRefresh:d.value,propsRefreshId:m.value,propsDeltaUpdate:p.value},_.value,{erid:i.value,propsProp:f.value})):f}l.parseGetExperimentConfigResponseSuccessPropsProp=e,l.parseGetExperimentConfigResponseSuccessErid=s,l.parseGetExperimentConfigResponseSuccess=u}),98);
__d("WASmaxOutAbPropsBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("iq",{id:o("WAWap").generateId(),type:"get"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeBaseIQGetRequestMixin=s}),98);
__d("WASmaxOutAbPropsGetExperimentConfigRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutAbPropsBaseIQGetRequestMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.propsHash,n=e.propsRefreshId,r=o("WASmaxOutAbPropsBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(o("WASmaxJsx").smax("iq",{xmlns:"abt",to:o("WAWap").S_WHATSAPP_NET},o("WASmaxJsx").smax("props",{protocol:"1",hash:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t),refresh_id:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,n)})));return r}l.makeGetExperimentConfigRequest=e}),98);
__d("WASmaxAbPropsGetExperimentConfigRPC",["WAComms","WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry","WASmaxInAbPropsGetExperimentConfigResponseErrorRetry","WASmaxInAbPropsGetExperimentConfigResponseSuccess","WASmaxOutAbPropsGetExperimentConfigRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(t,n,r,o,a,i,l){async function e(e,t){var n=o("WASmaxOutAbPropsGetExperimentConfigRequest").makeGetExperimentConfigRequest(e),r=await o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInAbPropsGetExperimentConfigResponseSuccess").parseGetExperimentConfigResponseSuccess(r,n);if(a.success)return{name:"GetExperimentConfigResponseSuccess",value:a.value};var i=o("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry").parseGetExperimentConfigResponseErrorNoRetry(r,n);if(i.success)return{name:"GetExperimentConfigResponseErrorNoRetry",value:i.value};var l=o("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry").parseGetExperimentConfigResponseErrorRetry(r,n);if(l.success)return{name:"GetExperimentConfigResponseErrorRetry",value:l.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("GetExperimentConfig",{Success:a,ErrorNoRetry:i,ErrorRetry:l}))}l.sendGetExperimentConfigRPC=e}),98);
__d("WAGetAbPropsProtocol",["WALogger","WAResultOrError","WASmaxAbPropsGetExperimentConfigRPC"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=await o("WASmaxAbPropsGetExperimentConfigRPC").sendGetExperimentConfigRPC(t);if(n.name==="GetExperimentConfigResponseSuccess"){var r=n.value,a=r.erid,i=r.propsAbKey,l=r.propsDeltaUpdate,s=r.propsHash,c=r.propsProp,d=r.propsRefresh,m=r.propsRefreshId,p=u(c),_=p.newProps,f=p.samplingConfigs;return o("WAResultOrError").makeResult({abKey:i,hash:s,refresh:d,refreshId:m,props:_,samplingConfigs:f,erid:a==null?void 0:a.elementValue,isDeltaUpdate:l==="true"})}return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getAbPropsProtocol failed ",""])),n.value),o("WAResultOrError").makeError()}function u(e){var t=[],n=[];return e.forEach(function(e){var r=e.configs;if(r.name==="ExperimentConfig"){var o;t.push({configCode:r.value.configCode,configValue:r.value.configValue,configExpoKey:(o=r.value.configExpoKey)==null?void 0:o.toString()})}else r.name==="SamplingConfig"&&n.push({eventCode:r.value.eventCode,samplingWeight:r.value.samplingWeight})}),{newProps:t,samplingConfigs:n}}l.getAbPropsProtocol=s}),98);
__d("WAAbPropsSync",["WAAbProps","WAAbPropsHelpers","WAGetAbPropsProtocol","WALogger","WAPromiseManagement","WAResultOrError","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("WAPromiseManagement").cacheWhilePending(function(){return"abProps"},m);function m(e){var t=e.sendHash,n=t===void 0?!0:t;return n==null||n===!1?_(null):o("WAAbProps").getHash().then(function(e){return _(e)})}var p=m;async function _(t){var n=await o("WAGetAbPropsProtocol").getAbPropsProtocol({propsHash:t});if(!n.success)o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["fetchAbProps failed"])));else{var r=n.value,a=r.abKey,i=r.hash,l=r.props,u=r.refresh,c=o("WAAbPropsHelpers").parseAbProps(o("WAAbProps").getConfig(),l),d=await f(a,i,u,c);d.success===!1&&(d.error,o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["syncAbProps: detected no hash"]))))}var m=await o("WAAbProps").getRefreshSecs();return{seconds:m}}async function f(e,t,n,r){var a=await o("WAAbProps").getAbProps(),i={abKey:e!=null?e:a.abKey,hash:t!=null?t:a.hash,refresh:o("WAAbPropsHelpers").maybeUpdateRefresh(n),lastSyncTime:o("WATimeUtils").unixTime(),propValues:a.propValues,propExpoKeys:a.propExpoKeys,internalExpoKeys:a.internalExpoKeys,expoKeyStr:a.expoKeyStr};if(t==null)return await o("WAAbProps").setAbProps(i),o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["WAAbProps.update: detected no hash"]))),o("WAResultOrError").makeError("noHash");o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["WAAbProps.update: updating ab configs"])));var l=r.expoKeys,s=r.values,d=o("WAAbPropsHelpers").maybeUpdatePropValues(s,a.propValues,o("WAAbProps").getConfig()),m=o("WAAbPropsHelpers").maybeUpdateExpoKeys(l,a.propExpoKeys,o("WAAbProps").getConfig()),p=m.expoKeysToDelete,_=m.propExpoKeys,f,g,h=o("WAAbPropsHelpers").maybeUpdateInternalExpoKeys(p,a.internalExpoKeys);return h!=null&&(f=h.internalExpoKeys,g=h.expoKeyStr),await o("WAAbProps").setAbProps(babelHelpers.extends({},i,{propValues:d,propExpoKeys:_,internalExpoKeys:f,expoKeyStr:g})),o("WAResultOrError").makeResult()}l.syncAbProps=d,l.syncAbPropsDebug=p}),98);
__d("WASmaxInDevicesFetchSelfResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:i.value})):i}l.parseFetchSelfResponseError=e}),98);
__d("WASmaxInDevicesDeviceInfoMixin",["WAResultOrError","WASmaxInDevicesIdentityKeyMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"platform");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function s(e){var t=o("WASmaxParseUtils").assertTag(e,"manufacturer");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function u(e){var t=o("WASmaxParseUtils").assertTag(e,"model");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function c(e){var t=o("WASmaxParseUtils").assertTag(e,"seen");if(!t.success)return t;var n=o("WASmaxParseUtils").contentInt(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function d(e){var t=o("WASmaxParseUtils").assertTag(e,"creation");if(!t.success)return t;var n=o("WASmaxParseUtils").contentInt(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function m(e){var t=o("WASmaxParseUtils").assertTag(e,"ip");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function p(e){var t=o("WASmaxParseUtils").assertTag(e,"location");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"latitude");if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(e,"longitude");if(!r.success)return r;var a=o("WASmaxParseUtils").contentString(e);return a.success?o("WAResultOrError").makeResult({latitude:n.value,longitude:r.value,elementValue:a.value}):a}function _(t){var n=o("WASmaxParseUtils").assertTag(t,"device");if(!n.success)return n;var r=o("WASmaxParseUtils").optionalChildWithTag(t,"platform",e);if(!r.success)return r;var a=o("WASmaxParseUtils").optionalChildWithTag(t,"manufacturer",s);if(!a.success)return a;var i=o("WASmaxParseUtils").optionalChildWithTag(t,"model",u);if(!i.success)return i;var l=o("WASmaxParseUtils").optionalChildWithTag(t,"seen",c);if(!l.success)return l;var _=o("WASmaxParseUtils").optionalChildWithTag(t,"creation",d);if(!_.success)return _;var f=o("WASmaxParseUtils").optionalChildWithTag(t,"ip",m);if(!f.success)return f;var g=o("WASmaxParseUtils").optionalChildWithTag(t,"location",p);if(!g.success)return g;var h=o("WASmaxParseUtils").attrIntRange(t,"id",1,999);if(!h.success)return h;var y=o("WASmaxInDevicesIdentityKeyMixin").parseIdentityKeyMixin(t);return y.success?o("WAResultOrError").makeResult(babelHelpers.extends({id:h.value},y.value,{platform:r.value,manufacturer:a.value,model:i.value,seen:l.value,creation:_.value,ip:f.value,location:g.value})):y}l.parseDeviceInfoPlatform=e,l.parseDeviceInfoManufacturer=s,l.parseDeviceInfoModel=u,l.parseDeviceInfoSeen=c,l.parseDeviceInfoCreation=d,l.parseDeviceInfoIp=m,l.parseDeviceInfoLocation=p,l.parseDeviceInfoMixin=_}),98);
__d("WASmaxInDevicesFetchSelfResponseSuccess",["WAResultOrError","WASmaxInDevicesDeviceInfoMixin","WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"device");if(!t.success)return t;var n=o("WASmaxInDevicesDeviceInfoMixin").parseDeviceInfoMixin(e);return n.success,n}function s(t,n){var r=o("WASmaxParseUtils").assertTag(t,"iq");if(!r.success)return r;var a=o("WASmaxParseUtils").flattenedChildWithTag(t,"self");if(!a.success)return a;var i=o("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(t,n);if(!i.success)return i;var l=o("WASmaxParseUtils").mapChildrenWithTag(a.value,"device",1,25,e);return l.success?o("WAResultOrError").makeResult(babelHelpers.extends({},i.value,{selfDevice:l.value})):l}l.parseFetchSelfResponseSuccessSelfDevice=e,l.parseFetchSelfResponseSuccess=s}),98);
__d("WASmaxOutDevicesFetchSelfRequest",["WASmaxJsx","WASmaxOutDevicesBaseIQGetRequestMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxOutDevicesBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},o("WASmaxJsx").smax("self",null)));return e}l.makeFetchSelfRequest=e}),98);
__d("WASmaxDevicesFetchSelfRPC",["WAComms","WASmaxInDevicesFetchSelfResponseError","WASmaxInDevicesFetchSelfResponseSuccess","WASmaxOutDevicesFetchSelfRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(t,n,r,o,a,i,l){async function e(e){var t=o("WASmaxOutDevicesFetchSelfRequest").makeFetchSelfRequest(),n=await o("WAComms").sendSmaxStanza(t,e),r=o("WASmaxInDevicesFetchSelfResponseSuccess").parseFetchSelfResponseSuccess(n,t);if(r.success)return{name:"FetchSelfResponseSuccess",value:r.value};var a=o("WASmaxInDevicesFetchSelfResponseError").parseFetchSelfResponseError(n,t);if(a.success)return{name:"FetchSelfResponseError",value:a.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("FetchSelf",{Success:r,Error:a}))}l.sendFetchSelfRPC=e}),98);
__d("WAGetCurrentUserDeviceList",["WAAssertUnreachable","WAGlobals","WAJids","WALogger","WAPersistedJobManager","WASignalKeys","WASmaxDevicesFetchSelfRPC","WATimeUtils","err"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n){if(t.isCurrentDevice&&n.isCurrentDevice)return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Two devices were detected as isCurrentDevice in getCurrentUserDeviceList"]))),0;if(t.isCurrentDevice)return-1;if(n.isCurrentDevice)return 1;if(t.lastSeen!=null&&n.lastSeen==null)return-1;if(t.lastSeen==null&&n.lastSeen!=null)return 1;if(t.lastSeen!=null&&n.lastSeen!=null){var r=t.lastSeen,a=n.lastSeen;return a.getTime()-r.getTime()}return 0}async function u(){var e=await o("WASmaxDevicesFetchSelfRPC").sendFetchSelfRPC();switch(e.name){case"FetchSelfResponseError":{var t=e.value.errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup;switch(t.name){case"RetryableIQError":{var n=t.value.backoff;throw n!=null?new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{delay:n,type:"constant"},jitter:0}):new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{first:o("WATimeUtils").HOUR_MILLISECONDS/60,type:"exponential"},jitter:.1})}default:{t.name;var a=t.value.code;throw r("err")("Failed with an error code "+a)}}}case"FetchSelfResponseSuccess":{var i=o("WAJids").extractDeviceId(o("WAGlobals").getMyDeviceJid());return e.value.selfDevice.map(function(e){var t,n,r,a,l,s=e.creation,u=e.elementValue,c=e.id,d=e.ip,m=e.location,p=e.manufacturer,_=e.model,f=e.platform,g=e.seen;return{creationTime:s==null?null:o("WATimeUtils").toDate(o("WATimeUtils").castToUnixTime(s.elementValue)),id:o("WAJids").interpretAsDeviceId(c),identityKey:o("WASignalKeys").serializeIdentity(u),ipAddress:(t=d==null?void 0:d.elementValue)!=null?t:null,isCurrentDevice:c===i,lastSeen:g==null?null:o("WATimeUtils").toDate(o("WATimeUtils").castToUnixTime(g.elementValue)),latitude:m==null?null:parseFloat(m.latitude),location:(n=m==null?void 0:m.elementValue)!=null?n:null,longitude:m==null?null:parseFloat(m.longitude),manufacturer:(r=p==null?void 0:p.elementValue)!=null?r:null,model:(a=_==null?void 0:_.elementValue)!=null?a:null,platform:(l=f==null?void 0:f.elementValue)!=null?l:null}}).sort(s)}default:return r("WAAssertUnreachable")(e.name)}}l.getCurrentUserDeviceList=u}),98);
__d("WAPublishAppDataProtocol",["FBLogger","WABridge","WAEncUserMsg","WAGetCurrentUserDeviceInfoApi","WAGlobals","WAOdsEnums","WASmaxAppdataPublishPeerRPC","WATagsLogger","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS(["sendAppDataFanout"]);async function c(t){var n=t.externalId,a=t.identities,i=t.messagePayload,l=a.get(o("WAGlobals").getMyUserJid());if(l==null)throw r("FBLogger")("wmi").mustfixThrow("Missing my user identities");var c=Array.from(l.entries()).map(function(e){var t=e[0],n=e[1];return{identity:n,jid:t}}),d=[{devicesInfo:c,user:o("WAGlobals").getMyUserJid()}],m=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return o("WAEncUserMsg").encryptUserMsg(d,{messageBytes:i.messageBytes,type:"appdata"},{cryptoManager:t})},{operationType:"encrypt",flush:!0}),p=m.phash,_=!1,f=[];m.participants!=null&&m.participants.forEach(function(e){e.type==="pkmsg"&&(_=!0),f.push({toJid:e.to,encTypeIndividualMixinArgs:{encType:e.type,encElementValue:e.ciphertext},encVersionFutureproofMixinArgs:{encV:parseInt(e.v,10)}})});var g={appdataTo:o("WAGlobals").getMyUserJid(),toArgs:f},h={peerPeerFanout:g},y=void 0;if(_){var C=await o("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo(),b=C==null?void 0:C.identityKey;if(b==null)throw u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch current device public identity key"]))),r("FBLogger")("wmi").mustfixThrow("No public identity key");y={deviceIdentityElementValue:b}}var v={appdataDeviceListCheck:"true"},S={appdataId:n,peerMsgTypesArgs:h,deviceIdentityMixinArgs:y,withDeviceListCheckMixinArgs:v},R=await o("WASmaxAppdataPublishPeerRPC").sendPeerRPC(S);switch(R.name){case"PeerResponseSuccess":{var L,E=(L=R.value.deviceListStaleMixin)==null?void 0:L.phash;return E!=null&&p!=null&&E!==p?(u.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch on appdata, local[","] server[","]"])),p,E),o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PHASH_MISMATCH,key:"appdata"}),{type:"success",ts:o("WATimeUtils").castToUnixTime(R.value.t),phash:{type:"mismatch",local:p,server:E},count:null,reportingMeta:null}):{type:"success",ts:o("WATimeUtils").castToUnixTime(R.value.t),phash:{type:"ok"},count:null,reportingMeta:null}}default:throw R.name,r("FBLogger")("wmi").mustfixThrow("Failed to send appdata %s",R.value.error)}}l.publishAppData=c}),98);
__d("WASaveReceiptApi",["MAWTransactionMode","WADbTransactor","WAMsg"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WADbTransactor").makeSignalTransactor({receipts:o("MAWTransactionMode").READWRITE},"saveReceipt",function(e){return(function(t){return e.receipts.put({msgId:t.id.externalId.toString(),permittedIdentitiesPerDevice:t.permittedIdentitiesPerDevice,recipientDevices:t.recipientDevices,waMsgId:o("WAMsg").craftWAMsgIdString(t.id)}).then(function(){})})});l.saveReceipt=e}),98);
__d("WAPublishMessage",["FBLogger","WAGenReportingMeta","WAGlobals","WAJids","WALoadReceiptApi","WALogger","WAMsg","WASaveReceiptApi","WASendMsgInternal","WASentBytesCache","WATimeUtils","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(e,t){var n=e.identities,r=e.messagePayload,a={author:r.protocolMsgId.author,chat:r.protocolMsgId.chat,externalId:r.protocolMsgId.externalId},i=await o("WALoadReceiptApi").loadReceipt(a);if(i.success)return i.value;var l=new Map;for(var s of n){var u=s[0],c=s[1];for(var d of c){var m=d[0],p=d[1];m!==o("WAGlobals").getMyDeviceJid()&&l.set(m,{pubKey:p})}}var _=new Set,f={permittedIdentitiesPerDevice:l,recipientDevices:_,id:a};return t.addPoint("save_receipts_start"),await o("WASaveReceiptApi").saveReceipt(f),t.addPoint("save_receipts_end"),f}async function c(t,n){var a=t.identities,i=t.messagePayload,l=t.sendIdentity,s=l===void 0?!1:l;n.addPoint("prepare_receipt_start");var c=await u({messagePayload:i,identities:a},n);n.addPoint("prepare_receipt_end"),n.addPoint("calculate_recipients_start");var p=i.backupDirective,_=i.frankingKey,f=i.frankingVersion,g=i.messageBytes,h=i.messageType,y=i.protocolMsgId,C=d(c.permittedIdentitiesPerDevice),b=h.type==="text"&&h.invitedParticipantUserJid!=null?C.filter(function(e){return e.user===h.invitedParticipantUserJid||e.user===o("WAGlobals").getMyUserJid()}):C;n.addPoint("calculate_recipients_end",{int:{recipientsCount:b.length}});var v=h.type==="text"&&h.invitedParticipantUserJid!=null?h.invitedParticipantUserJid:y.chat,S=y.chat===o("WAGlobals").getMyUserJid();if(b.length===0&&!S)throw r("FBLogger")("wmi").mustfixThrow("Trying to send a message with no recipients");if(b.length===0&&S)return{serverResponse:{type:"success",ts:o("WATimeUtils").unixTime(),phash:{type:"ok"},count:null,reportingMeta:null},encryption:{type:"user",messageTo:o("WAGlobals").getMyUserJid(),participants:[],phash:""}};var R=s?await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return m(t)},{operationType:"get_my_device_identity",flush:!1,afterInit:!0}):null,L=await(h.isRevoked===!0?Promise.resolve(null):o("WAGenReportingMeta").genReportingMeta(g.bytes,_,f)),E=await o("WASendMsgInternal").sendMessageV2({type:"chat",messageBytes:g,chat:v,deviceIdentity:R,messageType:h,protocolMsgId:y,externalId:y.externalId,recipients:b,reportingMeta:L,backupDirective:p},n),k=E.serverResponse;return k.type==="success"&&await o("WASentBytesCache").sentBytesCache().saveSentBytes({ts:k.ts,frankingKey:_,frankingVersion:f,messageBytes:g,backupDirective:p,messageType:h,protocolMsgId:y,waMsgId:o("WAMsg").craftWAMsgIdString({author:y.author,chat:y.chat,externalId:y.externalId})}).catch(function(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to save sent bytes to cache: ",""])),t)}),E}function d(e){var t=new Map;return e.forEach(function(e,n){var r=e.pubKey,a=o("WAJids").extractUserJid(n),i={identity:r,jid:n},l=t.get(a)||[];l.push(i),t.set(a,l)}),Array.from(t,function(e){var t=e[0],n=e[1];return{devicesInfo:n,user:t}})}async function m(e){try{var t=await e.storage.loadIdentities(o("WAGlobals").getMyUserJid()),n=t.get(o("WAGlobals").getMyDeviceJid());if(n!=null)return n;throw r("err")("missing-identity")}catch(e){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Error loading current device identity ",""])),e)}}l.publishMessage=c}),98);
__d("WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup",["WAResultOrError","WASmaxInDevicesIQErrorBadRequestMixin","WASmaxInDevicesIQErrorItemNotFoundMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInDevicesIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:t.value});var n=o("WASmaxInDevicesIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(e);return n.success?o("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorBadRequest","IQErrorItemNotFound"],[t,n])}l.parseIQErrorBadRequestOrItemNotFoundMixinGroup=e}),98);
__d("WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup").parseIQErrorBadRequestOrItemNotFoundMixinGroup(e);return n.success?o("WAResultOrError").makeResult({iQErrorBadRequestOrItemNotFoundMixinGroup:n.value}):n}l.parseNonRetryableRemoveDeviceIQErrorMixin=e}),98);
__d("WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup",["WAResultOrError","WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin","WASmaxInDevicesRetryableIQErrorMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInDevicesRetryableIQErrorMixin").parseRetryableIQErrorMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"RetryableIQError",value:t.value});var n=o("WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin").parseNonRetryableRemoveDeviceIQErrorMixin(e);return n.success?o("WAResultOrError").makeResult({name:"NonRetryableRemoveDeviceIQError",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["RetryableIQError","NonRetryableRemoveDeviceIQError"],[t,n])}l.parseRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup=e}),98);
__d("WASmaxInDevicesRemoveResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup").parseRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup:i.value})):i}l.parseRemoveResponseError=e}),98);
__d("WASmaxInDevicesRemoveResponseSuccess",["WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(e,t);return r.success,r}l.parseRemoveResponseSuccess=e}),98);
__d("WASmaxOutDevicesKeyDataMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyElementValue,n=o("WASmaxJsx").smax("smax$any",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeKeyDataMixin=s}),98);
__d("WASmaxOutDevicesIdentityKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutDevicesKeyDataMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxJsx").smax("smax$any",null,o("WASmaxOutDevicesKeyDataMixin").mergeKeyDataMixin(o("WASmaxJsx").smax("identity",null),e));return t}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIdentityKeyMixin=s}),98);
__d("WASmaxOutDevicesRemoveRequest",["WASmaxJsx","WASmaxOutDevicesBaseIQSetRequestMixin","WASmaxOutDevicesIdentityKeyMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.removeId,n=e.identityKeyMixinArgs,r=o("WASmaxOutDevicesBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},o("WASmaxOutDevicesIdentityKeyMixin").mergeIdentityKeyMixin(o("WASmaxJsx").smax("remove",{id:o("WAWap").INT(t)}),n)));return r}l.makeRemoveRequest=e}),98);
__d("WASmaxDevicesRemoveRPC",["WAComms","WASmaxInDevicesRemoveResponseError","WASmaxInDevicesRemoveResponseSuccess","WASmaxOutDevicesRemoveRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(t,n,r,o,a,i,l){async function e(e,t){var n=o("WASmaxOutDevicesRemoveRequest").makeRemoveRequest(e),r=await o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInDevicesRemoveResponseSuccess").parseRemoveResponseSuccess(r,n);if(a.success)return{name:"RemoveResponseSuccess",value:a.value};var i=o("WASmaxInDevicesRemoveResponseError").parseRemoveResponseError(r,n);if(i.success)return{name:"RemoveResponseError",value:i.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("Remove",{Success:a,Error:i}))}l.sendRemoveRPC=e}),98);
__d("WARemoveDevice",["WALogger","WAPersistedJobManager","WAPushSafeTypes","WAResultOrError","WASignalOther","WASmaxDevicesRemoveRPC","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=o("WAPushSafeTypes").unsafeNotNullable(t),r=n.deviceId,a=n.identity,i=o("WASignalOther").sliceBytes(a,1,32),l=await o("WASmaxDevicesRemoveRPC").sendRemoveRPC({removeId:r,identityKeyMixinArgs:{anyElementValue:i}});if(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["removeDevice result for ",": "," "])),r,l),l.name==="RemoveResponseSuccess")return o("WAResultOrError").makeResult();l.name;var s=l.value.errorRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup;if(s.name!=="RetryableIQError")return o("WAResultOrError").makeError();s.name;var u=s.value.backoff;throw u!=null?new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{type:"constant",delay:u},jitter:0}):new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{type:"exponential",first:o("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1})}l.removeDevice=s}),98);
__d("WARemoveCurrentDevice",["WAGetCurrentUserDeviceInfoApi","WAGlobals","WALogger","WARemoveDevice","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s=async function(){var t=await o("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo();if(t==null)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["There is no stored user info, it was already deleted or this job was called twice, possibly from another tab"]))),o("WAResultOrError").makeResult();var n=t.deviceId,r=t.identityKey,a=await o("WARemoveDevice").removeDevice({deviceId:n,identity:r});return a.success&&await o("WAGlobals").getDependencies().clearSignalAndTempStores(),o("WAResultOrError").makeResult()};l.removeCurrentDevice=s}),98);
__d("WASendAppDataFanoutProtocol",["WAAsMessageApplication","WABridge","WAConvertAppData","WAEncUserMsg","WAErrorMessage","WAGetCurrentUserDeviceInfoApi","WAGlobals","WAMsgApplication.pb","WAOdsEnums","WAResultOrError","WASmaxAppdataPublishPeerRPC","WATagsLogger","WATimeUtils","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WATagsLogger").TAGS(["sendAppDataFanout"]),f=24;function g(t){var n=t.checkPhash,r=n===void 0?"checkPhash":n,a=t.contents,i=t.externalId,l=t.permittedIdentitiesPerDevice;return h(a,i,l,r).catch(function(t){var n=o("WAErrorMessage").maybeGetMessageFromError(t);return _.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata to devices with error: ",""])),n),o("WAResultOrError").makeError("runtime-error")})}async function h(e,t,n,r){r===void 0&&(r="checkPhash"),_.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Sending appdata, externalId: ",""])),t);var a=o("WAConvertAppData").convertAppData(e),i={bytes:o("WAAsMessageApplication").castToMessageApplicationBytes(o("encodeProtobuf").encodeProtobuf(o("WAMsgApplication.pb").MessageApplicationSpec,a).readByteArrayView()),version:"v3"},l=[],g=Array.from(n.entries()).map(function(e){var t=e[0],n=e[1];return{identity:n.pubKey,jid:t}}),h=f;g.length>h&&(_.WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to "," devices"])),g.length),_.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to more than the allowed "," devices"])),h),g=g.slice(0,h));var y=[{devicesInfo:g,user:o("WAGlobals").getMyUserJid()}],C=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return o("WAEncUserMsg").encryptUserMsg(y,{messageBytes:i,type:"appdata"},{cryptoManager:t})},{operationType:"encrypt",flush:!0}),b=C.phash,v=!1;C.participants!=null&&C.participants.forEach(function(e){e.type==="pkmsg"&&(v=!0),l.push({toJid:e.to,encTypeIndividualMixinArgs:{encType:e.type,encElementValue:e.ciphertext},encVersionFutureproofMixinArgs:{encV:parseInt(e.v,10)}})});var S={appdataTo:o("WAGlobals").getMyUserJid(),toArgs:l},R={peerPeerFanout:S},L=void 0;if(v){var E=await o("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo(),k=E==null?void 0:E.identityKey;if(k==null)return _.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch current device public identity key"]))),o("WAResultOrError").makeError("no-public-identity");L={deviceIdentityElementValue:k}}var I={appdataDeviceListCheck:r==="checkPhash"?"true":"false"},T={appdataId:t,peerMsgTypesArgs:R,deviceIdentityMixinArgs:L,withDeviceListCheckMixinArgs:I},D=await o("WASmaxAppdataPublishPeerRPC").sendPeerRPC(T);switch(D.name){case"PeerResponseSuccess":{var x,$=(x=D.value.deviceListStaleMixin)==null?void 0:x.phash;return $!=null&&b!=null&&$!==b?(_.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch on appdata, local[","] server[","]"])),b,$),o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PHASH_MISMATCH,key:"appdata"}),o("WAResultOrError").makeResult({phashMismatch:!0,serverTs:o("WATimeUtils").castToUnixTime(D.value.t)})):o("WAResultOrError").makeResult({phashMismatch:!1,serverTs:o("WATimeUtils").castToUnixTime(D.value.t)})}default:return D.name,_.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata. Error: ",""])),D.value.error),o("WAResultOrError").makeError("ack-failure")}}l.MAX_APPDATA_RECIPIENTS=f,l.sendAppDataToDevicesProtocol=g}),98);
__d("WASendMsgUtilV2",["WADevicesState","WAGenReportingMeta","WAGlobals","WAJids","WALoadReceiptApi","WALogger","WAMsg","WAResultOrError","WASaveReceiptApi","WASendMsgInternal","WASentBytesCache","WATimeUtils","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p;function _(e){return Promise.resolve()}function f(e,t){return o("WADevicesState").getDevicesState().waitForUserDevices(Array.from(new Set([e,o("WAGlobals").getMyUserJid()])),"GetDevicesBeforeSend: "+t)}function g(t){var n=t.chatJid,r=t.reason;return o("WAJids").switchOnChatJidType(n,{group:function(t){return _(t)},interopUser:function(t){return f(t,r)},lidUser:function(t){return f(t,r)},msgrUser:function(t){return f(t,r)},phoneUser:function(t){return f(t,r)}}).catch(function(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Error during get devices before sending: ",""])),t),Promise.resolve()})}async function h(e,t){var n=e.loadThreadParticipants,r=e.messagePayload,a={author:r.protocolMsgId.author,chat:r.protocolMsgId.chat,externalId:r.protocolMsgId.externalId},i=await o("WALoadReceiptApi").loadReceipt(a);if(i.success)return i;t.addPoint("get_devices_before_send_start"),await g({chatJid:r.protocolMsgId.chat,reason:"prepareReceipt"}),t.addPoint("get_devices_before_send_end");var l=await n(r.protocolMsgId.chat);t.addPoint("get_identities_start");var u=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return t.storage.bulkLoadIdentities(l)},{flush:!1,afterInit:!0,operationType:"prepare_receipt_load_identities"}),c=[];if(u.size===0)c=[].concat(l);else for(var d of u){var m=d[0],p=d[1];p.size===0&&c.push(m)}c.length>0&&(await o("WADevicesState").getDevicesState().waitForUserDevices(c,"GetDevicesBeforeSend: prepareReceipt",!0),u=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return t.storage.bulkLoadIdentities(l)},{afterInit:!0,flush:!1,operationType:"prepare_receipt_load_identities"}));var _=new Map;for(var f of u){var h=f[0],y=f[1];for(var C of y){var b=C[0],v=C[1];b!==o("WAGlobals").getMyDeviceJid()&&_.set(b,{pubKey:v})}}t.addPoint("get_identities_end");var S=new Set,R={permittedIdentitiesPerDevice:_,recipientDevices:S,id:a};return t.addPoint("save_receipts_start"),await o("WASaveReceiptApi").saveReceipt(R).catch(function(e){return t.addPoint("save_receipts_fail"),o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to save receipt for message with error ",""])),e),o("WAResultOrError").makeError("missing-receipt")}),t.addPoint("save_receipts_end"),o("WAResultOrError").makeResult(R)}async function y(e,t){var n=e.isInstamadillo,r=n===void 0?!1:n,a=e.loadThreadParticipants,i=e.messagePayload,l=e.sendIdentity,s=l===void 0?!1:l;t.addPoint("prepare_receipt_start");var p=await h({messagePayload:i,loadThreadParticipants:a},t);if(p.success===!1)return t.addPoint("prepare_receipt_fail"),o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message that does not have a receipt in db"]))),o("WAResultOrError").makeError({type:"missing-receipt"});t.addPoint("prepare_receipt_end");var _=p.value,f=i.backupDirective,g=i.frankingKey,y=i.frankingVersion,v=i.messageBytes,S=i.messageType,R=i.protocolMsgId,L=C(_.permittedIdentitiesPerDevice),E=S.type==="text"&&S.invitedParticipantUserJid!=null?L.filter(function(e){return e.user===S.invitedParticipantUserJid||e.user===o("WAGlobals").getMyUserJid()}):L;t.addPoint("recipients-calculated",{int:{recipientsCount:E.length},string:{msgType:S.type}});var k=S.type==="text"&&S.invitedParticipantUserJid!=null?S.invitedParticipantUserJid:R.chat,I=R.chat===o("WAGlobals").getMyUserJid();if(E.length===0&&!I)return o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message with no recipients"]))),o("WAResultOrError").makeError({type:"no-recipients",isRetriable:!1});if(E.length===0&&I)return o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message with no recipients, but it is a self thread"]))),o("WAResultOrError").makeResult({baseKey:null,reportingMeta:null,serverTs:o("WATimeUtils").unixTime()});var T=s?await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return b(t)},{operationType:"get_my_device_identity",flush:!1,afterInit:!0}):null,D=await(S.isRevoked===!0?Promise.resolve(null):o("WAGenReportingMeta").genReportingMeta(v.bytes,g,y));return o("WASendMsgInternal").sendMessage({type:"chat",messageBytes:v,chat:k,deviceIdentity:T,messageType:S,protocolMsgId:R,externalId:R.externalId,recipients:E,reportingMeta:D,backupDirective:f},t,r).then(function(e){return e.success?o("WASentBytesCache").sentBytesCache().saveSentBytes({ts:e.value.serverTs,frankingKey:g,frankingVersion:y,messageBytes:v,backupDirective:f,messageType:S,protocolMsgId:R,waMsgId:o("WAMsg").craftWAMsgIdString({author:R.author,chat:R.chat,externalId:R.externalId})}).catch(function(e){o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to save sent bytes to cache: ",""])),e)}).then(function(){return e}):e})}function C(e){var t=new Map;return e.forEach(function(e,n){var r=e.pubKey,a=o("WAJids").extractUserJid(n),i={identity:r,jid:n},l=t.get(a)||[];l.push(i),t.set(a,l)}),Array.from(t,function(e){var t=e[0],n=e[1];return{devicesInfo:n,user:t}})}async function b(e){try{var t=await e.storage.loadIdentities(o("WAGlobals").getMyUserJid()),n=t.get(o("WAGlobals").getMyDeviceJid());if(n!=null)return n;throw r("err")("missing-identity")}catch(e){o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Error loading current device identity ",""])),e)}}l.getDevicesBeforeSend=g,l.sendChatMessage=y}),98);
__d("WASetClockSkewApi",["WASetMetaApi"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){var e=t.clockSkew;return o("WASetMetaApi").setMeta({clockSkew:e})};l.setClockSkew=e}),98);
__d("WASendPing",["WAComms","WALogger","WASetClockSkewApi","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendPing: sending"]))),o("WAComms").sendPing()}async function u(e){var t=e.clockSkew;o("WATimeUtils").setClockSkew(t),await o("WASetClockSkewApi").setClockSkew({clockSkew:t})}l.sendPing=s,l.updateClockSkew=u}),98);
__d("WASignalDbDump",["WASignalDB","WormDump"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e,t=o("WASignalDB").getDb();return t.dump({contacts:{customFields:{lastSyncTs:(e=o("WormDump")).wormNonSensitiveField},limit:2e3},meta:{customFields:{key:e.wormNonSensitiveField}},prekey:{customFields:{keyId:e.wormNonSensitiveField,isDeleted:e.wormNonSensitiveField}},prekeyGeneration:{customFields:{createdTs:e.wormNonSensitiveField,generationId:e.wormNonSensitiveField,startingId:e.wormNonSensitiveField,endingId:e.wormNonSensitiveField}}})}l.debugGetSignalDbDump=e}),98);
__d("WASyncAbProps",["WAAbPropsSync","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=t.sendHash;o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Syncing ABProps"]))),await o("WAAbPropsSync").syncAbProps({sendHash:n})}l.syncAbProps=s}),98);
__d("XmaEventsE2eeFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("1399"),s=o("FalcoLoggerInternal").create("xma_events_e2ee",e),u=s;l.default=u}),98);
__d("encryptedBackupsOptOutOfBackup",["LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","LSOptOutOfBackupStoredProcedure","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.encrypted_backups)).then(function(n){if(n==null)return[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)];var a=n.backupId;return a!=null?t.runInTransaction(function(e){return r("LSOptOutOfBackupStoredProcedure")(r("LSFactory")(e),{backupId:a})},"readwrite",void 0,void 0,i.id+":32"):[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)]})}l.optOutOfBackupStoredProcedure=s}),98);/*FB_PKG_DELIM*/
__d("ErrorCodes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({LOGIN__TWO_FACTOR_SMS_CODE_REQUIRED:1348190,TWO_FACTOR_LOGIN__INVALIDCODE:3951006}),l=e;i.default=l}),66);
__d("FxAuthenticationFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5227"),s=o("FalcoLoggerInternal").create("fx_authentication",e),u=s;l.default=u}),98);
__d("FXAuthenticationLogger",["FxAuthenticationFalcoEvent"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.event,n=e.target_account_id,o=n===void 0?null:n,a=e.target_account_type,i=a===void 0?null:a,l={fx_auth_event:t,target_account_id:o,target_account_type:i};r("FxAuthenticationFalcoEvent").log(function(){return l})}l.logEvent=e}),98);
__d("IGWebCallWindowControllerLoader",["FBLogger","JSResourceForInteraction","getErrorSafe","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("RTWebCallWindowOpener").__setRef("IGWebCallWindowControllerLoader"),s=r("requireDeferred")("ZenonCallWindowController").__setRef("IGWebCallWindowControllerLoader"),u=(function(e){function t(){return e.apply(this,arguments)||this}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error)),c=(function(){function t(e,t){this.$1=null,this.$2=e,this.$3=t}var n=t.prototype;return n.init=async function(){try{var t=await Promise.all([s.load(),e.load()]),n=t[0],o=t[1];this.$1=new n(this.$2,{callWindowInitializerResource:this.$3,callWindowOpener:new o,uriBuilderResource:r("JSResourceForInteraction")("IGCallUriBuilder").__setRef("IGWebCallWindowControllerLoader")})}catch(e){r("FBLogger")("rtc_www").catching(r("getErrorSafe")(e)).warn("Failed to initialize call window controller")}},n.initCall=function(t){if(this.$1)return this.$1.initCall(t);throw new u},t})();c.ResourceNotReadyError=u,l.default=c}),98);
__d("ZenonCallInviteModelLoader",["BaseEventEmitter","emptyFunction","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("ZenonCallInviteModel").__setRef("ZenonCallInviteModelLoader"),s=r("requireDeferred")("delegateZenonCallInviteModel").__setRef("ZenonCallInviteModelLoader"),u=(function(t){function n(e){var n;return n=t.call(this)||this,n.$ZenonCallInviteModelLoader$p_1=null,n.getCurrentInvite=function(){return null},n.startListening=function(e){this.$ZenonCallInviteModelLoader$p_1=e},n.stopListening=function(){this.$ZenonCallInviteModelLoader$p_1=null},n.dismiss=r("emptyFunction"),n.accept=r("emptyFunction"),n.decline=r("emptyFunction"),n.$ZenonCallInviteModelLoader$p_2=e,n}babelHelpers.inheritsLoose(n,t);var o=n.prototype;return o.init=async function(){var t=await Promise.all([e.load(),s.load()]),n=t[0],r=t[1],o=new n(this.$ZenonCallInviteModelLoader$p_2);r(this,o),this.$ZenonCallInviteModelLoader$p_1!==null&&o.startListening(this.$ZenonCallInviteModelLoader$p_1)},n})(r("BaseEventEmitter"));l.default=u}),98);
__d("ZenonIncomingRingSDK",["BaseEventEmitter","RTWebIncomingRingConfiguration","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("ZenonParentCallsManager").__setRef("ZenonIncomingRingSDK"),s=[1,2,15,16],u=(function(t){function n(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,e.$ZenonIncomingRingSDK$p_1=[],e.$ZenonIncomingRingSDK$p_2=[],babelHelpers.assertThisInitialized(e)||babelHelpers.assertThisInitialized(e)}babelHelpers.inheritsLoose(n,t);var r=n.prototype;return r.init=function(n){var t=this;this.$ZenonIncomingRingSDK$p_3=n,e.onReady(function(e){t.callsManager==null&&(t.callsManager=new e(n));var r=t.callsManager;for(r.addListener("unsupportedRing",function(e){return t.emit("unsupportedRing",e)}),r.addListener("incomingRing",function(e){var n;e.actorID!=null&&!((n=t.$ZenonIncomingRingSDK$p_3)!=null&&n.enableIncomingActorCalls)||t.emit("incomingRing",e)}),r.addListener("ringCancel",function(e){return t.emit("ringCancel",e)}),r.initListeners(t.$ZenonIncomingRingSDK$p_1);t.$ZenonIncomingRingSDK$p_2.length>0;){var o=t.$ZenonIncomingRingSDK$p_2.shift();o!=null&&r.startOutgoingCallIntent(o.nonce,o.callParams)}})},r.initListeners=function(t){var e=this.callsManager;if(e!=null)e.initListeners(t);else{var n;(n=this.$ZenonIncomingRingSDK$p_1).push.apply(n,t)}},r.removeListeners=function(t){var e=this;if(this.callsManager!=null)this.callsManager.removeListeners(t);else{var n=function(n){e.$ZenonIncomingRingSDK$p_1=e.$ZenonIncomingRingSDK$p_1.filter(function(e){return e!==n})};for(var r of t)n(r)}},r.isCallSupported=function(t){switch(t.type){case"thread":if(this.$ZenonIncomingRingSDK$p_3&&s.includes(t.threadType)){var e;return(e=o("RTWebIncomingRingConfiguration").isSupportedClient())!=null?e:!1}break;default:return!1}return!1},r.startCallIntent=function(t,n){this.callsManager?this.callsManager.startOutgoingCallIntent(t,n):this.$ZenonIncomingRingSDK$p_2.push({callParams:n,nonce:t})},n})(r("BaseEventEmitter"));l.default=u}),98);
__d("IGWebPreCallContextSingleton",["FBLogger","IGWebCallWindowControllerLoader","JSResource","ZenonCallInviteModelLoader","ZenonIncomingRingSDK","cr:27495","getErrorSafe","gkx","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e=!1,s;function u(e){if(!r("gkx")("25307"))return null;if(s!=null)return s;try{var t=new(r("ZenonIncomingRingSDK"));return s={callInviteModel:new(r("ZenonCallInviteModelLoader"))(t),callWindowController:new(r("IGWebCallWindowControllerLoader"))(e,r("JSResource")("IGWebCallWindowInitializer").__setRef("IGWebPreCallContextSingleton")),incomingRingSDK:t},s}catch(e){return r("FBLogger")("rtc_www").catching(r("getErrorSafe")(e)).mustfix("Pre-call context initialization failed! This breaks all calling!"),null}}function c(t){return r("gkx")("25307")?(e||(e=!0,r("promiseDone")(s.callInviteModel.init()),r("promiseDone")(s.callWindowController.init()),s.incomingRingSDK.init({enableIncomingActorCalls:!1,relayEnvironment:t}),r("promiseDone")(n("cr:27495").load(),function(e){s.incomingRingSDK.initListeners([new e])})),s):null}l.create=u,l.init=c}),98);
__d("IGWebPreCallProvider.react",["CometRelay","IGWebPreCallContext","IGWebPreCallContextSingleton","react","react-compiler-runtime","useStable"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useEffect;function c(e){var t=o("react-compiler-runtime").c(9),n=e.children,a=o("CometRelay").useRelayEnvironment(),i;t[0]!==a?(i=function(){return o("IGWebPreCallContextSingleton").create({relayEnvironment:a})},t[0]=a,t[1]=i):i=t[1];var l=r("useStable")(i),c,d;t[2]!==l||t[3]!==a?(c=function(){l&&(o("IGWebPreCallContextSingleton").init(a),l.callInviteModel.startListening({callsBlocked:!1}))},d=[l,a],t[2]=l,t[3]=a,t[4]=c,t[5]=d):(c=t[4],d=t[5]),u(c,d);var m;return t[6]!==n||t[7]!==l?(m=s.jsx(r("IGWebPreCallContext").Provider,{value:l,children:n}),t[6]=n,t[7]=l,t[8]=m):m=t[8],m}l.default=c}),98);
__d("IgtsDefaultsFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("4193"),s=o("FalcoLoggerInternal").create("igts_defaults",e),u=s;l.default=u}),98);
__d("InstagramGdprConsentFlowActionsFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("4180"),s=o("FalcoLoggerInternal").create("instagram_gdpr_consent_flow_actions",e),u=s;l.default=u}),98);
__d("InstagramGdprConsentFlowEntryFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("4187"),s=o("FalcoLoggerInternal").create("instagram_gdpr_consent_flow_entry",e),u=s;l.default=u}),98);
__d("InstagramGdprConsentFlowFinishedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("4188"),s=o("FalcoLoggerInternal").create("instagram_gdpr_consent_flow_finished",e),u=s;l.default=u}),98);
__d("InstagramGdprConsentFlowViewFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("4189"),s=o("FalcoLoggerInternal").create("instagram_gdpr_consent_flow_view",e),u=s;l.default=u}),98);
__d("InstagramSignupQPL",["QPLUserFlow"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$2=!1,this.$1=e}var t=e.prototype;return t.$3=function(t,n){r("QPLUserFlow").addPoint(this.$1,t,n)},t.isActive=function(){return this.$2},t.start=function(t){t===void 0&&(t={}),this.$2=!0,r("QPLUserFlow").start(this.$1,babelHelpers.extends({cancelExisting:!0},t))},t.endSuccess=function(){this.$2&&(r("QPLUserFlow").endSuccess(this.$1),this.$2=!1)},t.endFailure=function(t,n){this.$2&&(r("QPLUserFlow").endFailure(this.$1,t,{error:n}),this.$2=!1)},t.endCancel=function(t,n){this.$2&&(r("QPLUserFlow").endCancel(this.$1,{annotations:{string:{cancel_type:n}},cancelReason:t}),this.$2=!1)},t.endCancelSeamlessLogin=function(){this.endCancel(4,"valid_credentials_seamless_login")},t.endCancelSmsFallback=function(){this.endCancel(4,"sms_fallback")},t.endFailureFormValidationError=function(){this.endFailure("form_validation_error")},t.addPointSignupAttempt=function(){this.$3("signup_attempt")},e})();l.default=e}),98);
__d("InstagramWebAgeCollectionFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5139"),s=o("FalcoLoggerInternal").create("instagram_web_age_collection",e),u=s;l.default=u}),98);
__d("InstagramWebRegistrationFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5678"),s=o("FalcoLoggerInternal").create("instagram_web_registration",e),u=s;l.default=u}),98);
__d("PolarisAPIFXCALAuthLogin",["PolarisEncryptionHelper","PolarisInstapi","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t,n,a){var i={requestUUID:r("uuidv4")()},l=babelHelpers.extends({},await o("PolarisEncryptionHelper").getEncryptedParam("password",t,i),{etoken:a,username:e});return o("PolarisInstapi").apiPost("/api/v1/web/fxcal/auth/login/ajax/",{body:l}).then(function(e){return e.data})}l.fxcalAuthLogin=e}),98);
__d("PolarisAPIFetchParentalConsent",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(){return o("PolarisInstapi").apiGet("/api/v1/web/consent/fetch_parental_consent_reg/").then(function(e){return e.data})}l.fetchParentalConsent=e}),98);
__d("PolarisAPIFetchUnconsentedConsents",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(){return o("PolarisInstapi").apiGet("/api/v1/web/consent/get/roadblocking/").then(function(e){return e.data})}l.fetchUnconsentedConsents=e}),98);
__d("PolarisAPIFxcalAuthTwoFactorLogin",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r,a,i,l){var s={app_id:i,etoken:l,identifier:e,trust_signal:t,two_fac_code:r,username:n,verification_method:a};return o("PolarisInstapi").apiPost("/api/v1/web/fxcal/auth/two_fac_login/ajax/",{body:s}).then(function(e){return e.data})}l.fxcalAuthTwoFactorLogin=e}),98);
__d("PolarisAPIGetUsernameSuggestions",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n={email:e,name:t};return o("PolarisInstapi").apiPost("/api/v1/web/accounts/username_suggestions/",{body:n}).then(function(e){return e.data})}l.getUsernameSuggestions=e}),98);
__d("PolarisAPILoginTwoFactor",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r,a,i,l){l===void 0&&(l=!1);var s={identifier:e,isPrivacyPortalReq:l,queryParams:i,trust_signal:t,username:n,verification_method:a,verificationCode:r};return o("PolarisInstapi").apiPost("/api/v1/web/accounts/login/ajax/two_factor/",{body:s}).then(function(e){return e.data})}l.loginTwoFactor=e}),98);
__d("PolarisAPIRequestSignupSMSCode",["PolarisAPIConstants","PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var r={captcha_token:n,client_id:e,phone_number:t};return o("PolarisInstapi").apiPost("/api/v1/web/accounts/send_signup_sms_code_ajax/",{body:r},{options:{timeout:o("PolarisAPIConstants").SIGNUP_TIMEOUT}}).then(function(e){return e.data})}l.requestSignupSMSCode=e}),98);
__d("PolarisAPISendAccountRecoveryEmail",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("PolarisInstapi").apiPost("/api/v1/web/accounts/send_account_recovery_email_ajax/",{body:{query:e}}).then(function(e){return e.data})}l.sendAccountRecoveryEmail=e}),98);
__d("PolarisAPISendParentalConsentEmail",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n={current_screen_key:t,guardian_email:e};return o("PolarisInstapi").apiPost("/api/v1/web/consent/send_parental_consent_email/",{body:n}).then(function(e){return e.data})}l.sendParentalConsentEmail=e}),98);
__d("PolarisAPISendTwoFactorLoginSms",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n={identifier:t,username:e};return o("PolarisInstapi").apiPost("/api/v1/web/accounts/send_two_factor_login_sms/",{body:n}).then(function(e){return e.data})}l.sendTwoFactorLoginSms=e}),98);
__d("PolarisAPISendTwoFactorLoginWhatsappMutation_instagramRelayOperation",[],(function(t,n,r,o,a,i){a.exports="10060380564020189"}),null);
__d("PolarisAPISendTwoFactorLoginWhatsappMutation.graphql",["PolarisAPISendTwoFactorLoginWhatsappMutation_instagramRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{alias:null,args:[{kind:"Variable",name:"request_data",variableName:"input"}],concreteType:"XDTSendTwoFactorLoginResponse",kind:"LinkedField",name:"xdt_send_two_factor_login_whatsapp",plural:!1,selections:[{alias:null,args:null,concreteType:"XDTTwoFactorLoginInfo",kind:"LinkedField",name:"two_factor_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"obfuscated_phone_number",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_messenger_code_option",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_new_login_screen",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sms_not_allowed_reason",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sms_two_factor_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"totp_two_factor_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"two_factor_identifier",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"whatsapp_two_factor_on",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"two_factor_required",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"PolarisAPISendTwoFactorLoginWhatsappMutation",selections:t,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"PolarisAPISendTwoFactorLoginWhatsappMutation",selections:t},params:{id:n("PolarisAPISendTwoFactorLoginWhatsappMutation_instagramRelayOperation"),metadata:{is_distillery:!0,root_field_name:["xdt_send_two_factor_login_whatsapp"]},name:"PolarisAPISendTwoFactorLoginWhatsappMutation",operationKind:"mutation",text:null}}})();a.exports=e}),null);
__d("PolarisAPISendTwoFactorLoginWhatsapp",["CometRelay","PolarisAPISendTwoFactorLoginWhatsappMutation.graphql","PolarisRelayEnvironment","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=e!==void 0?e:e=n("PolarisAPISendTwoFactorLoginWhatsappMutation.graphql");function c(e,t){return new(s||(s=n("Promise")))(function(n,a){o("CometRelay").commitMutation(r("PolarisRelayEnvironment"),{mutation:u,onCompleted:function(t,r){if(r&&r.length){a(r);return}n(t)},onError:function(t){a([t])},variables:{input:{identifier:t,username:e}}})})}l.sendTwoFactorLoginWhatsapp=c}),98);
__d("PolarisAPISetPrivateAccount",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r){var a={is_private:e};return t===!0&&(a.bypass_rate_limit_dialog="1"),n===!0&&(a.privacy_nux_action=!0),r===!0&&(a.using_confirmation_dialog=!0),o("PolarisInstapi").apiPost("/api/v1/web/accounts/set_private/",{body:a}).then(function(e){return babelHelpers.extends({},e.data,{status:e.status})})}l.setPrivateAccount=e}),98);
__d("PolarisAPISignup",["invariant","PolarisAPIConstants","PolarisEncryptionHelper","PolarisInstapi","PolarisPasswordEncryptionLogger","WebSession","uuidv4"],(function(t,n,r,o,a,i,l,s){"use strict";async function e(e,t,n){var a=e.email,i=e.password,l=e.phoneNumber,u=e.username;(a!=null||l!=null||u!=null)&&i!=null||s(0,51789);var c={requestUUID:r("uuidv4")()},d=babelHelpers.extends({},await o("PolarisEncryptionHelper").getEncryptedParam("password",i,c),{captcha:e.captcha,day:e.day,email:a,failed_birthday_year_count:e.failedBirthdayYearCount,first_name:e.fullName,month:e.month,phone_number:typeof e.phoneNumber=="string"?e.phoneNumber:null,subno_key:e.subnoKey,username:e.username,year:e.year});typeof e.smsCode=="string"&&(d.sms_code=e.smsCode),typeof e.clientId=="string"&&(d.client_id=e.clientId),typeof e.seamlessLoginEnabled=="string"&&(d.seamless_login_enabled=e.seamlessLoginEnabled),typeof e.gdpr_s=="string"&&(d.gdpr_s=e.gdpr_s),typeof e.tosVersion=="string"&&(d.tos_version=e.tosVersion),typeof e.phoneId=="string"&&(d.phone_id=e.phoneId),typeof e.optIntoOneTap=="boolean"&&(d.opt_into_one_tap=e.optIntoOneTap),typeof e.fbToken=="string"&&(d.big_blue_token=e.fbToken),typeof e.emailSignupCode=="string"&&(d.force_sign_up_code=e.emailSignupCode),typeof e.failedBirthdayYearCount=="string"&&(d.failed_birthday_year_count=e.failedBirthdayYearCount),t?d.use_new_suggested_user_name="true":d.extra_session_id=o("WebSession").getId();var m=t?"/api/v1/web/accounts/web_create_ajax/attempt/":"/api/v1/web/accounts/web_create_ajax/";return o("PolarisPasswordEncryptionLogger").logEncryptedPayloadSend(m,d,c),o("PolarisInstapi").apiPost(m,{body:d},{before:n,options:{timeout:o("PolarisAPIConstants").SIGNUP_TIMEOUT}}).then(function(e){return e.data})}function u(t){return e(t,!1)}function c(t,n){return e(t,!0,n)}l.signup=u,l.signupDryRun=c}),98);
__d("PolarisAPISkipParentalConsent",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t={action:"skip",current_screen_key:e};return o("PolarisInstapi").apiPost("/api/v1/web/consent/update/",{body:t}).then(function(e){return e.data})}l.skipParentalConsent=e}),98);
__d("PolarisAPIUpdateConsentDob",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return o("PolarisInstapi").apiPost("/api/v1/web/consent/update_dob/",{body:babelHelpers.extends({},e,{current_screen_key:t})}).then(function(e){return e.data})}l.updateConsentDob=e}),98);
__d("PolarisAPIUpdateConsentState",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return o("PolarisInstapi").apiPost("/api/v1/web/consent/update/",{body:{current_screen_key:t,updates:JSON.stringify(e)}}).then(function(e){return e.data})}l.updateConsentState=e}),98);
__d("PolarisAPIUpdateNewUserConsent",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=e.dob,r=e.gdpr_s,a=e.updates,i=babelHelpers.extends({current_screen_key:t},n,{gdpr_s:r});return a&&(i.updates=JSON.stringify(a)),o("PolarisInstapi").apiPost("/api/v1/web/consent/new_user_flow/",{body:i}).then(function(e){return e.data})}l.updateNewUserConsent=e}),98);
__d("PolarisAPIValidateSignupSMSCode",["PolarisAPIConstants","PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return o("PolarisInstapi").apiPost("/api/v1/web/accounts/validate_signup_sms_code_ajax/",{body:{client_id:e,phone_number:t,sms_code:n}},{options:{timeout:o("PolarisAPIConstants").SIGNUP_TIMEOUT}}).then(function(e){return e.data})}l.validateSignupSMSCode=e}),98);
__d("PolarisAPIVerifyAge",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("PolarisInstapi").apiPost("/api/v1/web/consent/check_age_eligibility/",{body:e}).then(function(e){return e.data})}l.verifyAge=e}),98);
__d("PolarisAcceptTermsOfUseBody.react",["IGDSCheckbox.react","IGDSDivider.react","IGDSListItem.react","IGDSText.react","IGDSTextVariants.react","PolarisAuthStrings","PolarisExternalLink.react","PolarisGenericStrings","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useEffect,d=u.useState,m="https://help.instagram.com/581066165581870",p="https://help.instagram.com/519522125107875",_="https://help.instagram.com/626057554667531",f=new Map([[o("PolarisAuthStrings").TERMS_OF_USE_REQUIRED,m],[o("PolarisAuthStrings").DATA_POLICY_REQUIRED,p],[o("PolarisAuthStrings").LOCATION_BASED_FEATURES_REQUIRED,_]]);function g(e){var t=o("react-compiler-runtime").c(14),n=e.onToggle,a=e.selected,i=e.subtitleHref,l=e.title,u;t[0]!==n||t[1]!==a?(u=s.jsx(r("IGDSCheckbox.react"),{checkboxShape:"circle",isChecked:a,name:"acceptTermsCheckbox",onChange:n}),t[0]=n,t[1]=a,t[2]=u):u=t[2];var c;t[3]===Symbol.for("react.memo_cache_sentinel")?(c={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x12nagc"},t[3]=c):c=t[3];var d;t[4]===Symbol.for("react.memo_cache_sentinel")?(d=s.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"primaryButton",zeroMargin:!1,children:o("PolarisGenericStrings").LEARN_MORE}),t[4]=d):d=t[4];var m;t[5]!==i?(m=s.jsx("div",babelHelpers.extends({},c,{children:s.jsx(r("PolarisExternalLink.react"),{href:i,children:d})})),t[5]=i,t[6]=m):m=t[6];var p;t[7]===Symbol.for("react.memo_cache_sentinel")?(p={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x14vqqas"},t[7]=p):p=t[7];var _;t[8]!==l?(_=s.jsx("div",babelHelpers.extends({},p,{children:s.jsx(r("IGDSText.react"),{maxLines:1,zeroMargin:!0,children:l})})),t[8]=l,t[9]=_):_=t[9];var f;return t[10]!==u||t[11]!==m||t[12]!==_?(f=s.jsx(r("IGDSListItem.react"),{addOnEnd:u,paddingX:0,paddingY:0,subtitle:m,title:_}),t[10]=u,t[11]=m,t[12]=_,t[13]=f):f=t[13],f}function h(e){var t=o("react-compiler-runtime").c(21),n=e.onAcceptAllTermsChange,a=f.size,i=d(!1),l=i[0],u=i[1],m;t[0]===Symbol.for("react.memo_cache_sentinel")?(m=new Set,t[0]=m):m=t[0];var p=d(m),_=p[0],h=p[1],y;t[1]!==l?(y=function(){h(l?new Set:new Set(f.keys())),u(!l)},t[1]=l,t[2]=y):y=t[2];var C=y,b,v;t[3]!==l||t[4]!==n?(b=function(){n(l)},v=[l,n],t[3]=l,t[4]=n,t[5]=b,t[6]=v):(b=t[5],v=t[6]),c(b,v);var S;t[7]===Symbol.for("react.memo_cache_sentinel")?(S={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xh8yej3"},t[7]=S):S=t[7];var R;t[8]!==C||t[9]!==l?(R=s.jsx(r("IGDSCheckbox.react"),{checkboxShape:"circle",isChecked:l,name:"acceptAllTermsCheckbox",onChange:C}),t[8]=C,t[9]=l,t[10]=R):R=t[10];var L;t[11]===Symbol.for("react.memo_cache_sentinel")?(L={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1l90r2v xyamay9"},t[11]=L):L=t[11];var E;t[12]===Symbol.for("react.memo_cache_sentinel")?(E=s.jsx("div",babelHelpers.extends({},L,{children:s.jsx(r("IGDSText.react"),{maxLines:1,zeroMargin:!1,children:o("PolarisAuthStrings").agreeToAllTermsText(a)})})),t[12]=E):E=t[12];var k;t[13]!==R?(k=s.jsx(r("IGDSListItem.react"),{addOnEnd:R,paddingX:0,paddingY:0,title:E}),t[13]=R,t[14]=k):k=t[14];var I;t[15]===Symbol.for("react.memo_cache_sentinel")?(I=s.jsx(r("IGDSDivider.react"),{}),t[15]=I):I=t[15];var T;t[16]!==_?(T=Array.from(f.entries()).map(function(e){var t=e[0],n=e[1],r=_.has(t);return s.jsx(g,{onToggle:function(){var e=new Set(_);r?e.delete(t):e.add(t),h(e),u(e.size===a)},selected:r,subtitleHref:n,title:t},t.toString())}),t[16]=_,t[17]=T):T=t[17];var D;return t[18]!==T||t[19]!==k?(D=s.jsxs("div",babelHelpers.extends({},S,{children:[k,I,T]})),t[18]=T,t[19]=k,t[20]=D):D=t[20],D}l.default=h}),98);
__d("PolarisRegistrationLogger",["IGNavChain","InstagramWebRegistrationFalcoEvent","PolarisFBConnectStatus","PolarisLogger","PolarisPigeonLogger","PolarisUA","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t,n=o("PolarisLogger").getExtra(e),a=o("PolarisUA").isMobile()?"mobile":"desktop",i=o("PolarisFBConnectStatus").getFBConnectStatusMapping(e.fbconnect_status),l=o("PolarisPigeonLogger").getState(),s={account_creation_error_type:e.account_creation_error_type,confirmation_code:e.confirmation_code,confirmation_error_type:e.confirmation_error_type,contactpoint:e.contactpoint,contactpoint_type:e.contactpoint_type,error_message:e.error_message,event_name:e.event_name,fbconnect_status:i,frontend_env:n.frontend_env,ig_userid:n.ig_userid,input_error_type:e.input_error_type,module:e.containermodule,nav_chain:(t=r("IGNavChain").getInstance())==null?void 0:t.getNavChainForSend(),pigeon_session_id:l.session.sessionID,platform:a,referral_source:e.referral_source,rollout_hash:n.rollout_hash,step:e.step,username:e.username};e.event_name==="account_creation_success"&&r("gkx")("6383")?r("InstagramWebRegistrationFalcoEvent").logCritical(function(){return s}):r("InstagramWebRegistrationFalcoEvent").log(function(){return s})}function s(t){e(babelHelpers.extends({},t,{containermodule:"multiStepSignupPage",referral_source:t.referral_source}))}l.logRegistrationEvent=e,l.logMultiStepRegistrationEvent=s}),98);
__d("PolarisConsentLogger",["InstagramGdprConsentFlowActionsFalcoEvent","InstagramGdprConsentFlowEntryFalcoEvent","InstagramGdprConsentFlowFinishedFalcoEvent","InstagramGdprConsentFlowViewFalcoEvent","PolarisLogger"],(function(t,n,r,o,a,i,l){"use strict";function e(e){r("InstagramGdprConsentFlowEntryFalcoEvent").log(function(){return o("PolarisLogger").getExtra(e)})}function s(e){r("InstagramGdprConsentFlowActionsFalcoEvent").log(function(){return o("PolarisLogger").getExtra(e)})}function u(e){r("InstagramGdprConsentFlowViewFalcoEvent").log(function(){return o("PolarisLogger").getExtra(e)})}function c(e){r("InstagramGdprConsentFlowFinishedFalcoEvent").log(function(){return o("PolarisLogger").getExtra(e)})}function d(e){}function m(e){}l.logConsentFlowEntry=e,l.logConsentAction=s,l.logConsentView=u,l.logConsentFlowFinished=c,l.logConsentEmailSuccess=d,l.logConsentEmailFailure=m}),98);
__d("PolarisConsentActions",["invariant","FBLogger","PolarisAPIFetchParentalConsent","PolarisAPIFetchUnconsentedConsents","PolarisAPISendParentalConsentEmail","PolarisAPISkipParentalConsent","PolarisAPIUpdateConsentDob","PolarisAPIUpdateConsentState","PolarisAPIUpdateNewUserConsent","PolarisAgeCollectionHelpers","PolarisConsentLogger","PolarisConsentStrings.react","PolarisConsentTypes","PolarisEmailValidator","PolarisGenericStrings","PolarisIsLoggedIn","PolarisNavigationUtils","PolarisRoutes","PolarisSignupActionSignup","Promise","browserHistory_DO_NOT_USE","nullthrows"],(function(t,n,r,o,a,i,l,s){"use strict";var e;function u(e,t,n){if(n===void 0&&(n=o("PolarisConsentStrings.react").CONSENTS_FINISHED_TEXT),e.screen_key&&e.screen_key===o("PolarisConsentTypes").ConsentScreenKeys.FINISHED){if(o("PolarisConsentLogger").logConsentFlowFinished(v(babelHelpers.extends({},t,{isNewUserFlow:!1}))),t.entrypointType===o("PolarisConsentTypes").ConsentEntrypoints.BLOCK){var r=o("browserHistory_DO_NOT_USE").getQuery(o("browserHistory_DO_NOT_USE").browserHistory);r.next?r.next.startsWith("instagram://")?o("browserHistory_DO_NOT_USE").redirect(r.next):o("PolarisNavigationUtils").redirectToNextParam():o("browserHistory_DO_NOT_USE").browserHistory.push("/")}return{toast:{text:n}}}return{}}function c(){return function(e,t){e({type:"LOAD_TERMS_UNBLOCK_PAGE"}),o("PolarisConsentLogger").logConsentView(babelHelpers.extends({},v(babelHelpers.extends({},t().consent,{isNewUserFlow:!1})),{stage:"gdpr_block_screen"}))}}function d(e){return function(t,n){e===o("PolarisConsentTypes").ConsentEntrypoints.BLOCK&&o("PolarisConsentLogger").logConsentAction(babelHelpers.extends({},v(babelHelpers.extends({},n().consent,{isNewUserFlow:!1})),{action:"next",stage:"gdpr_block_screen"})),t({entrypointType:e,type:"FETCH_CONSENTS_REQUESTED"}),o("PolarisConsentLogger").logConsentFlowEntry(v(babelHelpers.extends({},n().consent,{isNewUserFlow:!1})));var a=e===o("PolarisConsentTypes").ConsentEntrypoints.REG?o("PolarisAPIFetchParentalConsent").fetchParentalConsent:o("PolarisAPIFetchUnconsentedConsents").fetchUnconsentedConsents;return a().then(function(e){t({consents:e.contents,primaryButtonText:e.primary_button_text,screenKey:e.screen_key,tosVersion:e.tos_version,type:"FETCH_CONSENTS_SUCCESS"})}).catch(function(o){r("FBLogger")("ig_web","consent_fetch_failed").catching(o).warn("failed to fetch consents %s for entrypoint %s",JSON.stringify(n().consent),e),t({type:"FETCH_CONSENTS_FAILED"})})}}function m(t){return function(r,a){if(t.screen_key===o("PolarisConsentTypes").ConsentScreenKeys.FINISHED||t.screen_key===o("PolarisConsentTypes").ConsentScreenKeys.PARENTAL_CONSENT){var i=a().signup.signupCredentials;i||s(0,50425),o("PolarisConsentLogger").logConsentFlowFinished(v(babelHelpers.extends({},a().consent,{isNewUserFlow:!0}))),r(y());var l={};return t.screen_key===o("PolarisConsentTypes").ConsentScreenKeys.PARENTAL_CONSENT&&(l.forceRedirectUrl=""+o("PolarisRoutes").TERMS_START_PATH+o("PolarisConsentTypes").ConsentEntrypoints.REG),r(o("PolarisSignupActionSignup").signup(babelHelpers.extends({},i,{emailOrPhone:i.emailOrPhone!=null&&i.emailOrPhone!==""?i.emailOrPhone:i.phoneNumber!=null&&i.phoneNumber!==""?i.phoneNumber:i.email,gdpr_s:t.gdpr_s}),"gdpr",l))}else t.screen_key===o("PolarisConsentTypes").ConsentScreenKeys.UNDER_13&&o("PolarisAgeCollectionHelpers").incrementNumInvalidAgeAttempts();return(e||(e=n("Promise"))).resolve()}}function p(){return function(e){e({entrypointType:o("PolarisConsentTypes").ConsentEntrypoints.REG,type:"FETCH_CONSENTS_REQUESTED"}),e({consents:{},primaryButtonText:o("PolarisGenericStrings").OK_TEXT,screenKey:o("PolarisConsentTypes").ConsentScreenKeys.UNDER_13,type:"FETCH_CONSENTS_SUCCESS"})}}function _(e){return function(t,n){var r=!o("PolarisIsLoggedIn").isLoggedIn(),a=n().consent,i=a.gdpr_s,l=a.screenKey;return l||s(0,50424),t({type:"UPDATE_CONSENT_REQUESTED"}),r?o("PolarisAPIUpdateNewUserConsent").updateNewUserConsent({gdpr_s:i,updates:e},l).then(function(e){t(m(e)),t({consents:e.contents,gdpr_s:e.gdpr_s,primaryButtonText:e.primary_button_text,screenKey:e.screen_key,tosVersion:e.tos_version,type:"UPDATE_CONSENT_SUCCESS"})}).catch(function(){t({type:"UPDATE_CONSENT_FAILED"})}):o("PolarisAPIUpdateConsentState").updateConsentState(e,l).then(function(e){t(babelHelpers.extends({consents:e.contents,primaryButtonText:e.primary_button_text,screenKey:e.screen_key,tosVersion:e.tos_version,type:"UPDATE_CONSENT_SUCCESS"},u(e,n().consent)))}).catch(function(){t({type:"UPDATE_CONSENT_FAILED"})})}}function f(e){return function(t,n){var r=!o("PolarisIsLoggedIn").isLoggedIn(),a=n().consent,i=a.gdpr_s,l=a.screenKey;return l||s(0,50424),t({type:"UPDATE_CONSENT_DOB_REQUESTED"}),r?o("PolarisAPIUpdateNewUserConsent").updateNewUserConsent({dob:e,gdpr_s:i},l).then(function(e){t(m(e)),t({consents:e.contents,gdpr_s:e.gdpr_s,primaryButtonText:e.primary_button_text,screenKey:e.screen_key,tosVersion:e.tos_version,type:"UPDATE_CONSENT_DOB_SUCCESS"})}).catch(function(e){t({errorMessage:e.message,type:"UPDATE_CONSENT_DOB_FAILED"})}):o("PolarisAPIUpdateConsentDob").updateConsentDob(e,l).then(function(e){t(babelHelpers.extends({consents:e.contents,primaryButtonText:e.primary_button_text,screenKey:e.screen_key,tosVersion:e.tos_version,type:"UPDATE_CONSENT_DOB_SUCCESS"},u(e,n().consent)))}).catch(function(e){t({errorMessage:e.message,type:"UPDATE_CONSENT_DOB_FAILED"})})}}function g(t){return function(a,i){var l=i().consent,c=l.screenKey,d=l.sessionId;return c||s(0,50424),a({type:"SEND_PARENTAL_CONSENT_EMAIL_REQUESTED"}),r("PolarisEmailValidator")(t)?o("PolarisAPISendParentalConsentEmail").sendParentalConsentEmail(t,c).then(function(e){o("PolarisConsentLogger").logConsentEmailSuccess({module:"instagram_terms_flow",session_id:d}),a(babelHelpers.extends({consents:e.contents,primaryButtonText:e.primary_button_text,screenKey:e.screen_key,tosVersion:e.tos_version,type:"SEND_PARENTAL_CONSENT_EMAIL_SUCCESS"},u(e,i().consent,o("PolarisConsentStrings.react").EMAIL_SENT_CONSENTS_FINISHED_TEXT)))}).catch(function(e){a({errorMessage:e.message,type:"SEND_PARENTAL_CONSENT_EMAIL_FAILED"}),o("PolarisConsentLogger").logConsentEmailFailure({module:"instagram_terms_flow",reason:e.message,session_id:d})}):(o("PolarisConsentLogger").logConsentEmailFailure({module:"instagram_terms_flow",reason:o("PolarisConsentStrings.react").INVALID_EMAIL_TEXT,session_id:d}),a({errorMessage:o("PolarisConsentStrings.react").INVALID_EMAIL_TEXT,type:"SEND_PARENTAL_CONSENT_EMAIL_FAILED"}),(e||(e=n("Promise"))).resolve())}}function h(){return function(e,t){var n=t().consent.screenKey;return n||s(0,50424),e({type:"SKIP_PARENTAL_CONSENT_REQUESTED"}),o("PolarisAPISkipParentalConsent").skipParentalConsent(n).then(function(n){e(babelHelpers.extends({consents:n.contents,primaryButtonText:n.primary_button_text,screenKey:n.screen_key,tosVersion:n.tos_version,type:"SKIP_PARENTAL_CONSENT_SUCCESS"},u(n,t().consent)))}).catch(function(t){e({errorMessage:t.message,type:"SKIP_PARENTAL_CONSENT_FAILED"})})}}function y(){return{type:"CLOSE_CONSENT_MODAL"}}function C(e){return{email:e,type:"PARENTAL_EMAIL_FIELD_CHANGE"}}function b(e){return{dob:e,type:"DOB_FIELD_CHANGE"}}function v(e){return{entry_point:r("nullthrows")(e.entrypointType),module:"instagram_terms_flow",session_id:r("nullthrows")(e.sessionId),user_state:e.isNewUserFlow?"new":"existing"}}l.loadTermsUnblockPage=c,l.loadConsents=d,l.checkNewUserStatus=m,l.handleAgeSignupBlocked=p,l.updateConsent=_,l.updateConsentDob=f,l.sendParentalConsentEmail=g,l.skipParentalConsent=h,l.closeConsentModal=y,l.parentEmailFieldChange=C,l.dobFieldChange=b,l.getDataForLogger=v}),98);
__d("PolarisAuthLimitedRegistrationHelpers",["PolarisConfig","YouthRegulationConfig"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){var e=r("YouthRegulationConfig").config;return!!(e!=null&&e!=null&&e.should_block_registration)},s=function(){return o("PolarisConfig").getCountryCode()==="KR"};l.hasRestrictedRegistration=e,l.shouldShowSouthKoreaTOS=s}),98);
__d("PolarisSignupAPI",["PolarisInstapi"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("PolarisInstapi").apiPost("/api/v1/accounts/check_confirmation_code/",{body:e}).then(function(e){return e.data})}function s(e){return o("PolarisInstapi").apiPost("/api/v1/accounts/send_verify_email/",{body:e}).then(function(e){return e.data})}l.checkEmailConfirmationCode=e,l.sendVerifyEmail=s}),98);
__d("PolarisSignupActionConstants",[],(function(t,n,r,o,a,i){"use strict";var e=3;i.VALID_CREDENTIALS_RESPONSE_CODE=e}),66);
__d("PolarisSignupDryRunExitError",["Promise"],(function(t,n,r,o,a,i){"use strict";var e;function l(){var t=new Error;return t._dryRunEarlyExit=!0,(e||(e=n("Promise"))).reject(t)}i.dryRunExitError=l}),66);
__d("PolarisSignupGetAPISignupFields",["PolarisAgeCollectionHelpers","PolarisDateHelpers"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=e.birthday!=null?o("PolarisDateHelpers").dateStringToDateType(e.birthday):{};return babelHelpers.extends({},t,{day:n.day!=null?String(n.day):void 0,failedBirthdayYearCount:o("PolarisAgeCollectionHelpers").getFailedBirthdayYearCount(),fullName:e.fullName,month:n.month!=null?String(n.month):void 0,optIntoOneTap:e.optIntoOneTap,password:e.password,username:e.username,year:n.year!=null?String(n.year):void 0})}l.getAPISignupFields=e}),98);
__d("PolarisLoginActionLogin",["FBLogger","PolarisLoginActionBaseLogin","PolarisOneTapLogin","PolarisRedirectHelper","PolarisTrustedDevicesUtils","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a,i,l,s,u,c){i===void 0&&(i=!1),l===void 0&&(l=null),s===void 0&&(s=!1),u===void 0&&(u=!1),c===void 0&&(c=null);var d=n.isFromReg===!0?"from_reg_password":"password",m=JSON.stringify(o("PolarisTrustedDevicesUtils").getTrustedDevicesNonces());return function(p,_){var f=p(o("PolarisLoginActionBaseLogin").baseLogin(e,t,d,n,a,i,l,m,s,u));return f.then(function(t){var n=t.isAuthenticated,i=t.response,l=_(),s=l.auth,u=s.dyiJobID,d=s.next;if(n){var m=i==null?void 0:i.loginNonce;a===!0&&m!=null&&m!==""&&o("PolarisOneTapLogin").addLoginNonce(r("nullthrows")(i==null?void 0:i.userId),r("nullthrows")(i==null?void 0:i.loginNonce),e,r("nullthrows")(i==null?void 0:i.profilePictureUrl));var p=d;c!=null&&(p=d+"&destination_url="+c);var f=!!(i!=null&&i.oneTapPrompt);o("PolarisRedirectHelper").redirectAfterLogin(p,!!(i!=null&&i.reactivated),f,(i==null?void 0:i.nonce)||"",u,(i==null?void 0:i.shouldShowProfileSelector)||!1)}}).catch(function(e){return r("FBLogger")("ig_web").catching(e).mustfix("unexpected")})}}l.login=e}),98);
__d("PolarisSignupSeamlessLogin",["PolarisLoginActionLogin","PolarisRegistrationLogger","nullthrows","polarisLogAction"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a,i,l){var s=r("nullthrows")(e.username),u=t.password;r("polarisLogAction")("signupWithValidCredentialsLoginAttempt",n),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:a,containermodule:i,event_name:"reg_existing_login",username:s}),l(o("PolarisLoginActionLogin").login(s,u||"",{isFromReg:!0,source:i}))}l.seamlessLogin=e}),98);
__d("polarisSignupSelectors",["mapObject"],(function(t,n,r,o,a,i,l){"use strict";var e,s=6;function u(e,t){var n;return!!(!(t==null||(n=t.fields)==null||(n=n[e])==null)&&n.validated)}function c(t){return t&&typeof t=="object"?(e||(e=r("mapObject")))(t,function(){return!0}):{}}function d(e,t,n){n===void 0&&(n={isOnlyError:!1});var r=!!e[t];return n.isOnlyError?Object.keys(e).length===1&&r:r}function m(e,t){var n;return t==null||(n=t.fields)==null||(n=n[e])==null?void 0:n.error}function p(e,t){var n;return t==null||(n=t.fields)==null||(n=n[e])==null?void 0:n.value}function _(e){return e?p("username",e):null}function f(e,t,n){n===void 0&&(n=!0);var r=e.needEmailOrPhone,o=e.needPassword,a=t.emailOrPhone,i=t.password,l=t.username,u=r===!0&&(a==null||a===""),c=l==null||l==="",d=o===!0&&(i==null||i.length<s);return u||n&&c||d}l.isAccepted=u,l.getAllErrorsFromSignupResponse=c,l.getErrorFromSignupResponse=d,l.getErrorFromSignupResult=m,l.getValueFromSignupResult=p,l.getUsernameFromSignupResult=_,l.getSubmitDisabled=f}),98);
__d("PolarisSignupActions",["invariant","PolarisAPIGetUsernameSuggestions","PolarisAPIRequestSignupSMSCode","PolarisAPISignup","PolarisAPIValidateSignupSMSCode","PolarisAPIVerifyAge","PolarisAgeCollectionHelpers","PolarisAuthLimitedRegistrationHelpers","PolarisAuthStrings","PolarisConsentActions","PolarisDateHelpers","PolarisInstajax","PolarisMachineID","PolarisRegistrationLogger","PolarisSignupAPI","PolarisSignupActionConstants","PolarisSignupActionSignup","PolarisSignupDryRunExitError","PolarisSignupGetAPISignupFields","PolarisSignupSeamlessLogin","PolarisSignupTypes","PolarisToastActions","PolarisUA","isStringNullOrEmpty","nullthrows","polarisGetAppPlatform","polarisIsPhoneNumber","polarisLogAction","polarisNormalizeSignupResponse","polarisSignupSelectors","vulture"],(function(t,n,r,o,a,i,l,s){"use strict";function e(e){var t=e.eventName,n=e.formContents,r=e.referralSource,a=e.source,i=n.emailOrPhone,l=i!=null?h(i):void 0;o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:n.emailOrPhone,contactpoint_type:l,containermodule:a,event_name:t,full_name:n.fullName,referral_source:r,username:n.username})}function u(e,t,n){return function(r,a){var i,l,u=a().auth,c=u.signup&&u.signup.signupCredentials,d=(i=n!=null?n:c==null?void 0:c.username)!=null?i:"",m=(l=u.multiSignup)==null?void 0:l.referralSource;c||s(0,51693),o("PolarisRegistrationLogger").logRegistrationEvent({confirmation_code:e,contactpoint:c.phoneNumber,contactpoint_type:"phone",containermodule:t,event_name:"confirmation_code_submit",full_name:c.fullName,referral_source:m,username:d});var p=babelHelpers.extends({},c,{emailOrPhone:c.phoneNumber,smsCode:e,username:d});o("PolarisUA").isMobile(),r(o("PolarisSignupActionSignup").signup(p,t))}}function c(e,t,n){return function(r){o("PolarisAPIGetUsernameSuggestions").getUsernameSuggestions(e||"",t||"").then(function(n){var o=n.suggestions;r({forEmail:e,forFullName:t,suggestions:o,type:"USERNAME_SUGGESTIONS_FETCHED"})}).catch(function(){o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:n,event_name:"username_suggestions_fetch_failed"}),r({type:"USERNAME_SUGGESTIONS_FETCH_FAILED"})})}}function d(e,t){return function(n,r){n({focusedField:t,formContents:e,type:"SIGNUP_FORM_FOCUS_CHANGED"})}}var m,p=["username","password","emailOrPhone","fullName"];function _(e){var t=o("PolarisMachineID").getMID()||"";return function(n,a){var i=a().auth.signup;i||s(0,51714);var l=i.requestInFlight,u=i.signupResult,c=u?u.fields.emailOrPhone&&u.fields.emailOrPhone.value!==e.emailOrPhone:e.emailOrPhone!==void 0,d=u?u.fields.fullName&&u.fields.fullName.value!==e.fullName:e.fullName!==void 0,_=u==null?e.username!==void 0:u.fields.username&&u.fields.username.value!==e.username,f=!Object.keys(e).some(function(t){return e[t]}),g=p,h=u?g.some(function(t){return(u.fields[t]||{}).value!==e[t]}):!f;if(h&&!l){m&&(m.abort(),m=null),e.emailOrPhone!=null||s(0,51697);var y=r("polarisIsPhoneNumber")(e.emailOrPhone),C=o("PolarisSignupGetAPISignupFields").getAPISignupFields(e,{email:y?void 0:e.emailOrPhone,phoneNumber:y?e.emailOrPhone:void 0});return y&&(C.clientId=t),o("PolarisAPISignup").signupDryRun(C,function(e){m=e}).then(function(t){m=null,o("PolarisRegistrationLogger").logRegistrationEvent({event_name:"signup_dryrun_success"}),n({formContents:e,isInlineDryRun:!0,result:o("polarisNormalizeSignupResponse").normalizeSignupResponse(t,e,!0),type:"SIGNUP_DRY_RUN_RESULT_RECEIVED",usernameSuggestions:(c!=null&&c||d||_?t.username_suggestions:i==null?void 0:i.usernameSuggestions)||[]})},function(e){var t,n=e instanceof o("PolarisInstajax").AjaxError?(t=e.responseObject)==null?void 0:t.message:void 0;o("PolarisRegistrationLogger").logRegistrationEvent({error_message:n,event_name:"signup_dryrun_failed"})})}return Promise.resolve()}}function f(e){return function(t){return o("PolarisAPIVerifyAge").verifyAge(o("PolarisDateHelpers").dateStringToDateType(e)).then(function(n){return n.eligible_to_register?(t({birthday:e,type:"SIGNUP_AGE_VERIFICATION_SUCCEEDED"}),Promise.resolve()):Promise.reject(new Error("failed to verify age"))}).catch(function(e){return Promise.reject(e)})}}function g(e,t,n){return function(r,a){return e!=null||s(0,67032),o("PolarisAgeCollectionHelpers").maybeCooldownAgeAttempt(),o("PolarisAgeCollectionHelpers").isAgeBlockedFromSignup()?(r(o("PolarisConsentActions").handleAgeSignupBlocked()),r(L()),r(n),Promise.resolve()):Promise.resolve(r(f(e))).then(function(e){r(t)}).catch(function(){o("PolarisAgeCollectionHelpers").incrementNumInvalidAgeAttempts(),o("PolarisAgeCollectionHelpers").saveAgeWrongAttemptSignal(e),o("PolarisAgeCollectionHelpers").isAgeBlockedFromSignup()&&r(o("PolarisConsentActions").handleAgeSignupBlocked()),r(L()),r(n)})}}function h(e){var t=r("polarisIsPhoneNumber")(e);return t?"phone":"email"}function y(t,n){var a=o("PolarisMachineID").getMID()||"";return function(i){var l=t.emailOrPhone;if(l==null)return r("polarisLogAction")("validationAttempt",{platform:o("polarisGetAppPlatform").getAppPlatform()}),o("PolarisSignupDryRunExitError").dryRunExitError();var s=r("polarisIsPhoneNumber")(l),u=h(l),c={platform:o("polarisGetAppPlatform").getAppPlatform(),type:u};r("polarisLogAction")("validationAttempt",c),e({eventName:"form_submit",formContents:t,source:n});var d=o("PolarisSignupGetAPISignupFields").getAPISignupFields(t,{clientId:a,email:s?void 0:t.emailOrPhone,fullName:t.fullName,phoneNumber:s?t.emailOrPhone:void 0,seamlessLoginEnabled:"1"});return m&&(m.abort(),m=null),(async function(){try{var e=await o("PolarisAPISignup").signupDryRun(d);if(e.code===o("PolarisSignupActionConstants").VALID_CREDENTIALS_RESPONSE_CODE)return o("PolarisSignupSeamlessLogin").seamlessLogin(e,t,c,u,n,i),o("PolarisSignupDryRunExitError").dryRunExitError();var a=o("polarisSignupSelectors").getAllErrorsFromSignupResponse(e.errors),l=!1;if(s?l=o("polarisSignupSelectors").getErrorFromSignupResponse(a,"sms_code",{isOnlyError:!0}):l=Object.keys(a).length===0,!l&&o("PolarisUA").isMobile()&&o("polarisSignupSelectors").getErrorFromSignupResponse(a,"username",{isOnlyError:!0}))return Promise.resolve();if(i({formContents:t,fromPhoneSignup:s,result:o("polarisNormalizeSignupResponse").normalizeSignupResponse(e,t,!0),type:"SIGNUP_DRY_RUN_RESULT_RECEIVED",usernameSuggestions:e.username_suggestions||[]}),!l){r("polarisLogAction")("validationFailure",babelHelpers.extends({fields:a},c));var m=o("polarisNormalizeSignupResponse").normalizeSignupResponse(e,t);for(var p in m.fields)if(Object.prototype.hasOwnProperty.call(m.fields,p)&&!(s&&p==="sms_code")){var _=m.fields[p];_.error&&o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:t.emailOrPhone,contactpoint_type:u,containermodule:n,event_name:"form_input_error",full_name:t.fullName,input_error_type:_.errorCode,username:t.username})}return i({result:m,type:"SIGNUP_FAILED",usernameSuggestions:e.username_suggestions}),o("PolarisSignupDryRunExitError").dryRunExitError()}return s||r("polarisLogAction")("validationSuccess",c),Promise.resolve()}catch(e){var f,g=e instanceof o("PolarisInstajax").AjaxError?(f=e.responseObject)==null?void 0:f.message:void 0;return o("PolarisRegistrationLogger").logRegistrationEvent({error_message:g,event_name:"base_form_validation_failed"}),o("PolarisSignupDryRunExitError").dryRunExitError()}})()}}function C(t,n){var a=o("PolarisMachineID").getMID()||"",i={platform:o("polarisGetAppPlatform").getAppPlatform(),type:"phone"},l=t.emailOrPhone;return l!=null||s(0,51691),function(s,u){return(async function(){try{var c,d=(c=u().auth.multiSignup)==null?void 0:c.referralSource,m=await o("PolarisAPIRequestSignupSMSCode").requestSignupSMSCode(a,l,t.captcha);if(m.require_captcha===!0)return s({emailOrPhone:t.emailOrPhone||"",type:"REQUEST_CAPTCHA"}),e({eventName:"captcha_required",formContents:t,referralSource:d,source:n}),Promise.resolve();if(m.sms_sent===!0)return s({clientId:a,formContents:t,type:"PHONE_SIGNUP_CODE_SENT"}),r("polarisLogAction")("validationSuccess",i),e({eventName:"confirmation_code_sent",formContents:t,referralSource:d,source:n}),Promise.resolve();var p=m.errors||{},_=Object.keys(p).map(function(e){return p[e][0]})[0]||o("PolarisAuthStrings").ERROR_SIGNUP_UNKNOWN;return s({formContents:t,message:_,type:"PHONE_SIGNUP_CODE_REQUEST_FAILED"}),r("polarisLogAction")("validationFailure",i),o("PolarisRegistrationLogger").logRegistrationEvent({confirmation_error_type:"conf_code_not_sent",contactpoint:t.emailOrPhone,contactpoint_type:"phone",containermodule:n,error_message:JSON.stringify(p),event_name:"confirmation_error",full_name:t.fullName,referral_source:d,username:t.username}),Promise.reject(new Error("phone signup code validation failure"))}catch(e){var f=e instanceof o("PolarisInstajax").AjaxError?e.responseObject:null,g=(f==null?void 0:f.message)!=null?f==null?void 0:f.message:o("PolarisAuthStrings").ERROR_SIGNUP_UNKNOWN;return s({formContents:t,message:g||o("PolarisAuthStrings").ERROR_SIGNUP_UNKNOWN,type:"PHONE_SIGNUP_CODE_REQUEST_FAILED"}),r("polarisLogAction")("validationFailure",i),o("PolarisRegistrationLogger").logRegistrationEvent({confirmation_error_type:"conf_code_not_sent",contactpoint:t.emailOrPhone,contactpoint_type:"phone",containermodule:n,error_message:JSON.stringify(f),event_name:"confirmation_error",full_name:t.fullName,username:t.username}),Promise.reject(new Error("phone signup validation failure"))}})()}}function b(e,t){var n=o("PolarisMachineID").getMID()||"",r=e.emailOrPhone;return r!=null||s(0,51691),function(r){return Promise.resolve(r(y(e,t))).then(function(o){r({clientId:n,formContents:e,type:"PHONE_SIGNUP_CODE_REQUESTED"}),r(C(e,t))}).catch(function(e){e&&"_dryRunEarlyExit"in e})}}function v(e,t){var n=e.emailOrPhone!=null&&r("polarisIsPhoneNumber")(e.emailOrPhone);return async function(r,a){if(n){var i=o("PolarisMachineID").getMID()||"",l=e.emailOrPhone;l!=null||s(0,51691),r({clientId:i,formContents:e,type:"PHONE_SIGNUP_CODE_REQUESTED"}),r(C(e,t))}else{var u,c=e.emailOrPhone;c!=null||s(0,51698),await r(N(c,e.captcha)),((u=a().signup.emailConfirmationCodeRequest)==null?void 0:u.require_captcha)!==!0&&r({type:"SIGNUP_EMAIL_CONFIRMATION_STEP_REQUESTED"})}}}function S(){return function(e){e({type:"SIGNUP_FORM_GO_BACK"})}}function R(){return{type:"SIGNUP_BIRTHDAY_PROCESSING"}}function L(){return{type:"SIGNUP_BIRTHDAY_FAILED"}}function E(t,n,r,a){var i=t.birthday;i!=null||s(0,67031),e({eventName:"birthday_form_next_clicked",formContents:t,referralSource:a,source:n});var l=function(i){e({eventName:"age_verification_succeeded",formContents:t,referralSource:a,source:n}),r(v(t,n))},u=function(i){e({eventName:"age_verification_failed",formContents:t,referralSource:a,source:n}),o("PolarisAgeCollectionHelpers").isAgeBlockedFromSignup()||i({errorMessage:o("PolarisAgeCollectionHelpers").WE_COULDNT_CREATE_AN_ACC,type:"SIGNUP_ERROR"})};return r(g(i,l,u))}function k(t,n,a){return a===void 0&&(a={}),function(i,l){var c,d,m=o("PolarisMachineID").getMID(),p=r("polarisIsPhoneNumber")((c=t==null?void 0:t.emailOrPhone)!=null?c:""),_=l();_.auth.signup!=null||s(0,756);var f=_.auth.signup.step,g=(d=_.auth.multiSignup)==null?void 0:d.referralSource;switch(f){case o("PolarisSignupTypes").STEP.captcha:return e({eventName:"captcha_next_clicked",formContents:t,referralSource:g,source:n}),i(v(t,n));case o("PolarisSignupTypes").STEP.birthday:return E(t,n,i,g);case o("PolarisSignupTypes").STEP.emailConfirmation:return i(w(t,n,a));case o("PolarisSignupTypes").STEP.phoneConfirmation:{var h=_.signup.gdprRequired,C=t.twofac;return!r("isStringNullOrEmpty")(C)||s(0,51694),h||o("PolarisUA").isMobile()||o("PolarisAuthLimitedRegistrationHelpers").shouldShowSouthKoreaTOS()?i(D(C,n)):i(u(C,n))}case o("PolarisSignupTypes").STEP.acceptTerms:return i(I(p,_,t,n,a,m));case o("PolarisSignupTypes").STEP.accountPrivacy:return r("vulture")("NJrwr5YAtXa4DsWRQAqrC2zlvWk="),o("PolarisAuthLimitedRegistrationHelpers").shouldShowSouthKoreaTOS()?i({type:"SIGNUP_ACCEPT_TERMS_REQUESTED"}):i(I(p,_,t,n,a,m));case o("PolarisSignupTypes").STEP.base:default:{if(t.birthday!=null){var b=babelHelpers.extends({},t,{birthday:void 0});return Promise.resolve(i(y(b,n))).then(function(){return E(t,n,i,g)}).catch(function(e){e&&"_dryRunEarlyExit"in e})}return Promise.resolve(i(y(t,n))).then(function(){return i({type:"SIGNUP_BIRTHDAY_REQUESTED"})}).catch(function(e){e&&"_dryRunEarlyExit"in e})}}}}function I(e,t,n,r,o,a){return function(i){i(T(e,t,n,r,o,a))}}function T(e,t,n,a,i,l){return function(u,c){var d={};if(e){var m,p=r("nullthrows")((m=t.auth.signup)==null?void 0:m.signupCredentials),_=t.signup.gdprRequired,f=p.smsCode;!r("isStringNullOrEmpty")(f)||s(0,51690),_&&(d.smsCode=f,d.emailOrPhone=p.phoneNumber)}else{var g,h,y=(g=(h=c().signup)==null?void 0:h.emailSignupCode)!=null?g:{},C=y.signupCode;C!=null||s(0,51695),d.emailSignupCode=C}return u(o("PolarisSignupActionSignup").signup(babelHelpers.extends({},n,d,{clientId:l}),a,i))}}function D(e,t){var n=o("PolarisMachineID").getMID()||"";return function(a,i){var l=i();l.auth.signup||s(0,756);var u=r("nullthrows")(l.auth.signup.signupCredentials),c=r("nullthrows")(u.phoneNumber);return a({type:"PHONE_SIGNUP_CODE_VERIFICATION_REQUESTED"}),o("PolarisAPIValidateSignupSMSCode").validateSignupSMSCode(n,c,e).then(function(n){if(n.verified)if(a({smsCode:e,type:"PHONE_SIGNUP_CODE_VERIFICATION_SUCCEEDED"}),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:c,contactpoint_type:"phone",event_name:"twofac_confirmation_code_success"}),o("PolarisAuthLimitedRegistrationHelpers").shouldShowSouthKoreaTOS())a({type:"SIGNUP_ACCEPT_TERMS_REQUESTED"});else{var i=l.signup.gdprRequired;i&&a(o("PolarisSignupActionSignup").signup(babelHelpers.extends({},u,{emailOrPhone:u.phoneNumber,smsCode:e}),t))}else{var r;a({message:n==null||(r=n.errors)==null||(r=r.nonce)==null?void 0:r[0],type:"PHONE_SIGNUP_CODE_VERIFICATION_FAILED"}),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:c,contactpoint_type:"phone",event_name:"form_input_error",input_error_type:n.error_type})}},function(e){a({message:e.message,type:"PHONE_SIGNUP_CODE_VERIFICATION_FAILED"}),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:"phone",error_message:e.message,event_name:"form_input_error",input_error_type:"sms_verification_unknown_error"})})}}function x(e){var t=o("PolarisMachineID").getMID()||"",n={platform:o("polarisGetAppPlatform").getAppPlatform(),type:"phone"};return function(a,i){var l=i();l.auth.signup||s(0,756);var u=l.auth.signup.signupCredentials;u||s(0,51696);var c=u.phoneNumber;c!=null||s(0,51699);var d=e!=null?e:c;return d!==c&&(n.newNum="1"),a({clientId:t,phoneNumber:d,type:"PHONE_SIGNUP_CODE_REREQUESTED"}),r("polarisLogAction")("signupSmsResendAttempt",n),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:d,contactpoint_type:"phone",event_name:"request_new_code_click",full_name:u.fullName,username:u.username}),o("PolarisAPIRequestSignupSMSCode").requestSignupSMSCode(t,d).then(function(e){if(e.require_captcha===!0)a({emailOrPhone:d,type:"REQUEST_CAPTCHA"}),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:d,contactpoint_type:"phone",event_name:"captcha_required",full_name:u.fullName,username:u.username});else if(e.sms_sent===!0)a({clientId:t,phoneNumber:d,type:"PHONE_SIGNUP_CODE_RESENT"}),r("polarisLogAction")("signupSmsResendSuccess",n),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:d,contactpoint_type:"phone",event_name:"confirmation_code_sent",full_name:u.fullName,username:u.username});else{var i=e.errors||{},l=Object.keys(i).map(function(e){return i[e][0]})[0]||o("PolarisAuthStrings").ERROR_SIGNUP_UNKNOWN;a({message:l,type:"PHONE_SIGNUP_CODE_REREQUEST_FAILED"}),r("polarisLogAction")("signupSmsResendFailure",n),o("PolarisRegistrationLogger").logRegistrationEvent({confirmation_error_type:"conf_code_not_sent",contactpoint:d,contactpoint_type:"phone",error_message:JSON.stringify(i),event_name:"confirmation_error",full_name:u.fullName,username:u.username})}},function(e){var t=e instanceof o("PolarisInstajax").AjaxError?e.responseObject:null,i=(t==null?void 0:t.message)!=null?t==null?void 0:t.message:o("PolarisAuthStrings").ERROR_SIGNUP_UNKNOWN;a({message:i,type:"PHONE_SIGNUP_CODE_REREQUEST_FAILED"}),r("polarisLogAction")("signupSmsResendFailure",n),o("PolarisRegistrationLogger").logRegistrationEvent({confirmation_error_type:"conf_code_not_sent",contactpoint:d,contactpoint_type:"phone",error_message:JSON.stringify(t),event_name:"confirmation_error",full_name:u.fullName,username:u.username})})}}function $(e){return function(t,n){if(e==="changePhoneNumber"){var r=n();r.auth.signup||s(0,756);var a=r.auth.signup.signupCredentials;a||s(0,51696),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:a.phoneNumber,contactpoint_type:"phone",event_name:"change_phone_number_click",full_name:a.fullName,username:a.username})}return t({newStep:e,type:"PHONE_SIGNUP_STEP_SWITCHED"}),Promise.resolve()}}function P(e,t,n,r){return n===void 0&&(n=null),r===void 0&&(r=!1),function(a){return a({type:"SIGNUP_CONFIRMATION_EMAIL_REQUESTED"}),o("PolarisSignupAPI").sendVerifyEmail({captcha_token:n,device_id:e,email:t}).then(function(e){if(e.require_captcha===!0){o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:"email",event_name:"captcha_required"}),a({emailOrPhone:t,type:"REQUEST_CAPTCHA"}),a({type:"SIGNUP_CONFIRMATION_EMAIL_RECAPTCHA"});return}return a({type:"SIGNUP_CONFIRMATION_EMAIL_SUCCEEDED"}),o("PolarisAuthStrings").emailConfirmationCodeSentToast(t)},function(e){var t,n=(t=e.responseObject)!=null?t:{},r=n.error_type,i=n.message;return a({error:{message:i,type:r},type:"SIGNUP_CONFIRMATION_EMAIL_FAILED"}),o("PolarisAuthStrings").ERROR_SENDING_EMAIL_CONFIRMATION_CODE_UNKNOWN}).then(function(e){r&&a(o("PolarisToastActions").showToast({text:e}))})}}function N(e,t,n,r){return t===void 0&&(t=null),n===void 0&&(n=!1),r===void 0&&(r=o("PolarisRegistrationLogger").logRegistrationEvent),async function(a,i){var l,s=(l=i().auth.multiSignup)==null?void 0:l.referralSource;r({contactpoint:e,contactpoint_type:"email",event_name:"email_confirmation_send_attempt",referral_source:s}),await a(P(o("PolarisMachineID").getMID(),e,t,n));var u=i().signup.emailConfirmationCodeRequest;if((u==null?void 0:u.require_captcha)!==!0){var c=u==null?void 0:u.error;if(c==null)r({contactpoint:e,contactpoint_type:"email",event_name:"email_confirmation_send_success",referral_source:s});else{var d;r({contactpoint:e,contactpoint_type:"email",error_message:(d=c.type)!=null?d:"",event_name:"email_confirmation_send_error",referral_source:s})}}}}function M(e,t,n){return async function(r,a){var i=a(),l=i.signup.emailSignupCode;if(!((l==null?void 0:l.confirmationCode)===e&&(l==null?void 0:l.email)===n&&(l==null?void 0:l.signupCode)!=null))try{var s=await o("PolarisSignupAPI").checkEmailConfirmationCode({code:e,device_id:t,email:n});r(A({confirmationCode:e,email:n,error:null,signupCode:s.signup_code}))}catch(t){var u=t instanceof o("PolarisInstajax").AjaxError?t.responseObject:null,c=u==null?void 0:u.error_type,d=u==null?void 0:u.message;r(A({confirmationCode:e,email:n,error:{message:d!=null?d:"",type:c!=null?c:""},signupCode:null}))}}}function w(e,t,n){return async function(r,a){var i,l;e.emailOrPhone!=null||s(0,51680),e.emailConfirmationCode!=null||s(0,51682);var u=e.birthday;u!=null||s(0,56388);var c=e.emailOrPhone,d=e.emailConfirmationCode,m=o("PolarisMachineID").getMID(),p=(i=a().auth.multiSignup)==null?void 0:i.referralSource;r({type:"EMAIL_SIGNUP_CODE_REQUESTED"}),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:c,event_name:"email_confirmation_code_attempt",referral_source:p}),await r(M(d,m,c));var _=(l=a().signup)==null?void 0:l.emailSignupCode;if((_==null?void 0:_.signupCode)!=null){var f=_.signupCode;o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:c,event_name:"email_confirmation_code_success",referral_source:p}),o("PolarisAuthLimitedRegistrationHelpers").shouldShowSouthKoreaTOS()?r({type:"SIGNUP_ACCEPT_TERMS_REQUESTED"}):await r(o("PolarisSignupActionSignup").signup(babelHelpers.extends({},e,{clientId:m,emailSignupCode:f}),t,n))}else if((_==null?void 0:_.error)!=null){var g=_.error,h=g.message,y=g.type;o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:c,contactpoint_type:"email",error_message:h,event_name:"form_input_error",input_error_type:y,referral_source:p});var C=y==="invalid_nonce"?h:o("PolarisAuthStrings").ERROR_CONFIRMING_EMAIL_CONFIRMATION_CODE_UNKNOWN;r({errorMessage:C,type:"EMAIL_SIGNUP_CODE_FAILED"})}}}function A(e){return{signupCode:e,type:"SIGNUP_SET_EMAIL_SIGNUP_CODE"}}function F(){return{type:"SHOW_REGULATORY_CONSENT_MODAL"}}function O(){return{type:"REGULATORY_CONSENT_MODAL_DISMISSED"}}function B(){return{type:"SIGNUP_ADS_FREE_SUBSCRIPTION_EXISTS"}}l.signupWithPhoneCode=u,l.fetchUsernameSuggestions=c,l.changeSignupFormFocus=d,l.performDryRun=_,l.validateSignupAgeAndContinue=g,l.validateBaseSignupFormAndMaybeLogin=y,l.validateFormAndRequestSMSCode=b,l.requestContactpointConfirmationCode=v,l.returnToBaseSignupForm=S,l.processBirthday=R,l.failBirthday=L,l.validateFormAndContinue=k,l.verifySMSCode=D,l.rerequestSMSCode=x,l.switchPhoneSignupStep=$,l.requestConfirmationEmail=P,l.requestConfirmationEmailWithLogging=N,l.verifyEmailConfirmationCode=M,l.submitEmailConfirmationForm=w,l.setEmailSignupCode=A,l.setShowRegulatoryConsentModal=F,l.setDismissRegulatoryConsentModal=O,l.setSignupAdsFreeSubscriptionExists=B}),98);
__d("PolarisSignupQPL",["InstagramSignupQPL","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=new(r("InstagramSignupQPL"))(r("qpl")._(316872749,"2561"));l.default=e}),98);
__d("trackFBRegistrationConversion",["ExecutionEnvironment","PolarisFBPixel"],(function(t,n,r,o,a,i,l){"use strict";var e,s={complete_registration:"CompleteRegistration"};function u(){(e||(e=r("ExecutionEnvironment"))).canUseDOM&&o("PolarisFBPixel").trackEvent(s.complete_registration)}l.default=u}),98);
__d("PolarisSignupActionSignup",["invariant","PolarisAPILogin","PolarisAPISignup","PolarisAuthStrings","PolarisConsentTypes","PolarisInstajax","PolarisOneTapLogin","PolarisQueryParams","PolarisRedirectHelper","PolarisRegistrationLogger","PolarisSignupActionConstants","PolarisSignupActions","PolarisSignupGetAPISignupFields","PolarisSignupQPL","PolarisSignupSeamlessLogin","PolarisUA","gkx","mapObject","nullthrows","performance","polarisGetAppPlatform","polarisIsPhoneNumber","polarisLogAction","polarisNormalizeSignupResponse","polarisSignupSelectors","qex","trackFBRegistrationConversion"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c=6e4,d=function(t){return new Promise(function(e){return window.setTimeout(e,t)})};function m(t,n,a){a===void 0&&(a={});var i={platform:o("polarisGetAppPlatform").getAppPlatform(),source:n};t.emailOrPhone!=null||s(0,51697);var l=r("polarisIsPhoneNumber")(t.emailOrPhone);i.type=l?"phone":"email","captcha"in t&&(i.captcha="yes");var m=t.emailOrPhone!=null?l?"phone":"email":null,p=o("PolarisSignupGetAPISignupFields").getAPISignupFields(t,{captcha:t.captcha,email:l?void 0:t.emailOrPhone,phoneNumber:l?t.emailOrPhone:void 0,seamlessLoginEnabled:"1"});return t.smsCode&&(p.smsCode=t.smsCode),t.clientId&&(p.clientId=t.clientId),t.gdpr_s&&(p.gdpr_s=t.gdpr_s),t.phoneId!=null&&(p.phoneId=t.phoneId),t.fbToken!=null&&(p.fbToken=t.fbToken),function(s,_){var f,g,h=(e||(e=r("performance"))).now(),y=_(),C=y.auth,b=y.signup;r("PolarisSignupQPL").isActive()||r("PolarisSignupQPL").start(),r("PolarisSignupQPL").addPointSignupAttempt(),p.tosVersion=b.tosVersion||o("PolarisConsentTypes").TosVersion.DEFAULT,((f=b.emailSignupCode)==null?void 0:f.signupCode)!=null&&(p.emailSignupCode=b.emailSignupCode.signupCode);var v=(g=_().auth.multiSignup)==null?void 0:g.referralSource,S=C.multiSignup?o("PolarisRegistrationLogger").logMultiStepRegistrationEvent:o("PolarisRegistrationLogger").logRegistrationEvent;r("polarisLogAction")("signupAttempt",i),l||o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:t.emailOrPhone,contactpoint_type:m,containermodule:n,event_name:"form_submit",full_name:t.fullName,referral_source:v,username:t.username}),s({type:"SIGNUP_ATTEMPTED"}),S({contactpoint:t.emailOrPhone,contactpoint_type:m,containermodule:n,event_name:"signup_attempted",full_name:t.fullName,referral_source:v,username:t.username});var R=_().auth.next,L=function(u){if(u.account_created===!0){if(r("PolarisSignupQPL").endSuccess(),s({type:"SIGNUP_SUCCEEDED"}),u.user_id!=null&&(i.ig_userid=u.user_id),r("polarisLogAction")("signupSuccess",i),S({contactpoint:t.emailOrPhone,contactpoint_type:m,containermodule:n,event_name:"account_creation_success",full_name:t.fullName,ig_userid:u.user_id,referral_source:v,username:t.username}),u.login_nonce!=null){var e;o("PolarisOneTapLogin").addLoginNonce((e=r("nullthrows"))(u.user_id),String(e(u.login_nonce)),e(u.username),e(u.profile_picture_url))}var c=u.show_privacy_page;a.forceRedirectUrl!=null?o("PolarisRedirectHelper").redirectAfterSignup(a.forceRedirectUrl,!1,c):R?o("PolarisRedirectHelper").redirectAfterSignup(R,!1,c):o("PolarisRedirectHelper").redirectAfterSignup("/",!1,c),r("trackFBRegistrationConversion")();return}if(S({contactpoint:t.emailOrPhone,contactpoint_type:m,containermodule:n,error_message:JSON.stringify(u.errors),event_name:"account_creation_rejection",full_name:t.fullName,ig_userid:u.user_id,referral_source:v,username:t.username}),u.code===o("PolarisSignupActionConstants").VALID_CREDENTIALS_RESPONSE_CODE){r("PolarisSignupQPL").endCancelSeamlessLogin(),o("PolarisSignupSeamlessLogin").seamlessLogin(u,t,i,m,n,s);return}var d=o("polarisNormalizeSignupResponse").normalizeSignupResponse(u,t);if(u.errors&&"phone_autoconfirm"in u.errors){o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:t.emailOrPhone,contactpoint_type:m,containermodule:n,event_name:"account_creation_sms_fallback",full_name:t.fullName,referral_source:v,username:t.username}),s(o("PolarisSignupActions").validateFormAndRequestSMSCode(t,n)),r("PolarisSignupQPL").endCancelSmsFallback();return}var p=o("polarisSignupSelectors").getAllErrorsFromSignupResponse(u.errors);r("polarisLogAction")("signupFailure",babelHelpers.extends({fields:p},i)),r("PolarisSignupQPL").endFailureFormValidationError();for(var _ in d.fields)if(Object.prototype.hasOwnProperty.call(d.fields,_)){var f=d.fields[_];f.error&&S({contactpoint:t.emailOrPhone,contactpoint_type:m,containermodule:n,event_name:"form_input_error",full_name:t.fullName,input_error_type:f.errorCode,referral_source:v,username:t.username})}var g="form_validation_error";d.otherError!=null&&l&&(S({confirmation_error_type:d.otherErrorCode,contactpoint:t.emailOrPhone,contactpoint_type:m,containermodule:n,event_name:"confirmation_error",full_name:t.fullName,referral_source:v,username:t.username}),g="confirmation_error"+(d.otherErrorCode!=null?"_"+d.otherErrorCode:"")),S({account_creation_error_type:g,contactpoint:t.emailOrPhone,contactpoint_type:m,containermodule:n,event_name:"account_creation_error",full_name:t.fullName,referral_source:v,username:t.username}),C.multiSignup?s({result:d,type:"MULTI_SIGNUP_FAILED"}):s({result:d,type:"SIGNUP_FAILED",usernameSuggestions:u.username_suggestions})},E=async function(n,a){for(var t=(e||(e=r("performance"))).now();t-h<c;){try{var l=await o("PolarisAPILogin").login(n,a,o("PolarisOneTapLogin").queryParamStringWithOneTapInfo(o("PolarisQueryParams").parseQueryParams()));if(l.authenticated)return r("PolarisSignupQPL").endSuccess(),s({type:"SIGNUP_SUCCEEDED"}),(l==null?void 0:l.userId)!=null&&(i.ig_userid=l.userId),r("polarisLogAction")("signupSuccess",i),o("PolarisRedirectHelper").redirectAfterSignup("/",!1,!1),!0;await d(5e3)}catch(e){await d(5e3)}t=(e||(e=r("performance"))).now()}return!1},k=async function(a){r("polarisLogAction")("signupFailure",i);var e,l="error_unknown";if(a instanceof o("PolarisInstajax").AjaxError){var c,d;if(e=(c=a.responseText)!=null?c:void 0,((d=a.responseObject)==null?void 0:d.error_type)!=null){var p;l=(p=a.responseObject)==null?void 0:p.error_type}else a.statusCode===429&&(l="rate_limit_error");(a.statusCode===572||a.statusCode===0)&&(l="signup_killed_timeout")}var _=t.password,f=t.username;if(f!=null&&_!=null&&l==="signup_killed_timeout"){var g=r("qex")._("957")===!0,h=o("PolarisUA").isMobile()&&!g;if(!h){var y=await E(f,_);if(y)return}}r("PolarisSignupQPL").endFailure(e!=null?e:"account_creation_error"),S({account_creation_error_type:l,contactpoint:t.emailOrPhone,contactpoint_type:m,containermodule:n,error_message:e!=null?e:void 0,event_name:"account_creation_error",full_name:t.fullName,referral_source:v,username:t.username});var b={fields:(u||(u=r("mapObject")))(t,function(e,t){return{value:e}}),otherError:o("PolarisAuthStrings").ERROR_SIGNUP_UNKNOWN,wasDryRun:!1};C.multiSignup?s({result:b,type:"MULTI_SIGNUP_FAILED"}):s({formContents:t,result:b,type:"SIGNUP_FAILED",usernameSuggestions:null})};return o("PolarisAPISignup").signup(p).then(L,k)}}function p(e,t,n){if(!r("gkx")("2717"))return function(){n()};e.emailOrPhone!=null||s(0,51697);var a=r("polarisIsPhoneNumber")(e.emailOrPhone),i=o("PolarisSignupGetAPISignupFields").getAPISignupFields(e,{captcha:e.captcha,email:a?void 0:e.emailOrPhone,phoneNumber:a?e.emailOrPhone:void 0,seamlessLoginEnabled:"1"});return function(r,l){return o("PolarisAPISignup").signupDryRun(i).then(function(i){var s,u=o("polarisNormalizeSignupResponse").normalizeSignupResponse(i,e,!0),c=l(),d=c.auth,m=d.multiSignup?o("PolarisRegistrationLogger").logMultiStepRegistrationEvent:o("PolarisRegistrationLogger").logRegistrationEvent,p=e.emailOrPhone!=null?a?"phone":"email":null;if(u.fields.fullName.error!=null||((s=u.fields.password)==null?void 0:s.error)!=null){var _,f,g=(_=l().auth.multiSignup)==null?void 0:_.referralSource;if(u.fields.fullName.errorCode!=null&&m({contactpoint:e.emailOrPhone,contactpoint_type:p,containermodule:t,event_name:"form_input_error",full_name:u.fields.fullName.value||"",input_error_type:u.fields.fullName.errorCode,referral_source:g,username:e.username}),((f=u.fields.password)==null?void 0:f.errorCode)!=null){var h;m({contactpoint:e.emailOrPhone,contactpoint_type:p,containermodule:t,event_name:"form_input_error",full_name:u.fields.fullName.value||"",input_error_type:(h=u.fields.password)==null?void 0:h.errorCode,referral_source:g,username:e.username})}r({result:u,type:"MULTI_SIGNUP_NAME_PASSWORD_VERIFICATION_FAILED"})}else n()}).catch(function(){n()})}}l.signup=m,l.signupDryRunNamePassword=p}),98);
__d("PolarisAuthConstants",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e="IG_REG_MSITE",l="IG_REG_WEB",s="IG_REG_WEB",u="IG_REG_MSITE",c="IG_NUX_MSITE",d="IG_NUX_WEB",m="IG_REG_WEB_OIDC",p="ssfErrorAlert",_=n("$InternalEnum").Mirrored(["Login","Signup"]);i.FLOW_TYPE_REG_MOBILE=e,i.FLOW_TYPE_REG_DESKTOP=l,i.FLOW_TYPE_IG_WEB_REG_DESKTOP=s,i.FLOW_TYPE_IG_WEB_REG_MOBILE=u,i.FLOW_TYPE_IG_WEB_NUX_MOBILE=c,i.FLOW_TYPE_IG_WEB_NUX_DESKTOP=d,i.FLOW_TYPE_IG_REG_WEB_OIDC=m,i.SLIM_SIGNUP_FORM_ALERT_ID=p,i.AuthPageType=_}),66);
__d("PolarisSignupFormFields.react",["IGDSBox.react","IGDSDialogFooter.react","IGDSText.react","IGDSTextVariants.react","PolarisAuthConstants","PolarisAuthStrings","PolarisGenericStrings","PolarisIGCoreButton.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){var t=o("react-compiler-runtime").c(39),n=e.children,a=e.handleGoBack,i=e.handleNext,l=e.header,u=e.icon,c=e.isNextActionDisabled,d=e.maxWidth,m=e.requestInFlight,p=e.shouldShowRedesignedSignup,_=e.signupNonSpecificError,f=e.style,g=e.subHeader,h=d===void 0?350:d,y=p===void 0?!1:p,C=y?0:2,b;t[0]!==l||t[1]!==y?(b=y?s.jsx(r("IGDSText.react"),{color:"primaryText",size:"title",textAlign:"center",weight:"bold",zeroMargin:!1,children:l}):s.jsx(o("IGDSTextVariants.react").IGDSTextBodyEmphasized,{textAlign:"center",zeroMargin:!1,children:l}),t[0]=l,t[1]=y,t[2]=b):b=t[2];var v;t[3]!==C||t[4]!==b?(v=s.jsx(r("IGDSBox.react"),{marginBottom:C,marginTop:4,position:"relative",children:b}),t[3]=C,t[4]=b,t[5]=v):v=t[5];var S;t[6]===Symbol.for("react.memo_cache_sentinel")?(S={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1e56ztr xw7yly9 x1n2onr6"},t[6]=S):S=t[6];var R;t[7]!==g?(R=s.jsx("div",babelHelpers.extends({},S,{children:s.jsx(o("IGDSTextVariants.react").IGDSTextBody,{textAlign:"center",zeroMargin:!1,children:g})})),t[7]=g,t[8]=R):R=t[8];var L;t[9]!==i||t[10]!==c||t[11]!==m||t[12]!==y||t[13]!==f?(L=f==="default"&&s.jsx(r("IGDSBox.react"),{marginTop:2,paddingX:2,paddingY:y===!0?2:4,position:"relative",width:"100%",children:s.jsx(r("PolarisIGCoreButton.react"),{disabled:c,fullWidth:!0,loading:m,onClick:i,children:o("PolarisGenericStrings").NEXT})}),t[9]=i,t[10]=c,t[11]=m,t[12]=y,t[13]=f,t[14]=L):L=t[14];var E;t[15]!==_?(E=_!=null&&s.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1e56ztr x1n2onr6",children:s.jsx("div",{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 xkmlbd1 x78zum5 xdt5ytf x2lah0s xln7xf2 xvs91rp xd4r4e8 xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl x1n2onr6 x2b8uid x11njtxf",children:s.jsx("p",{"aria-atomic":"true",id:o("PolarisAuthConstants").SLIM_SIGNUP_FORM_ALERT_ID,role:"alert",children:_})})}),t[15]=_,t[16]=E):E=t[16];var k;t[17]!==a||t[18]!==y||t[19]!==f?(k=f==="default"&&s.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1e56ztr x1n2onr6 xh8yej3",children:y?s.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xf159sx xmzvs34 x1n2onr6 xh8yej3",children:s.jsx(r("PolarisIGCoreButton.react"),{borderless:!1,color:"ig-secondary-button",fullWidth:!0,onClick:a,children:o("PolarisGenericStrings").BACK_TEXT})}):s.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:a,children:o("PolarisGenericStrings").GO_BACK})}),t[17]=a,t[18]=y,t[19]=f,t[20]=k):k=t[20];var I;t[21]!==n||t[22]!==u||t[23]!==h||t[24]!==k||t[25]!==v||t[26]!==R||t[27]!==L||t[28]!==E?(I=s.jsxs(r("IGDSBox.react"),{alignItems:"center",maxWidth:h,paddingX:7,paddingY:2,position:"relative",children:[u,v,R,n,L,E,k]}),t[21]=n,t[22]=u,t[23]=h,t[24]=k,t[25]=v,t[26]=R,t[27]=L,t[28]=E,t[29]=I):I=t[29];var T;t[30]!==a||t[31]!==i||t[32]!==c||t[33]!==m||t[34]!==f?(T=f==="modal"&&s.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1sy10c2 x1n2onr6 xh8yej3",children:s.jsx(r("IGDSDialogFooter.react"),{endAdornment:s.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,disabled:c,loading:m,onClick:i,children:o("PolarisAuthStrings").CONTINUE}),startAdornment:s.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:a,children:o("PolarisGenericStrings").BACK_TEXT})})}),t[30]=a,t[31]=i,t[32]=c,t[33]=m,t[34]=f,t[35]=T):T=t[35];var D;return t[36]!==I||t[37]!==T?(D=s.jsxs(s.Fragment,{children:[I,T]}),t[36]=I,t[37]=T,t[38]=D):D=t[38],D}l.default=u}),98);
__d("PolarisSignupTypesHelpers",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t={fullName:"",username:""};return(e==null?void 0:e.fields)!=null&&Object.keys(e.fields).forEach(function(n){var r;if(((r=e.fields[n])==null?void 0:r.value)!=null)switch(n){case"optIntoOneTap":t[n]=!!e.fields[n].value;break;default:t[n]=e.fields[n].value}}),t}i.convertSignupResultToSignupFields=e}),66);
__d("usePolarisEmailOrPhoneContactpointType",["PolarisReactRedux.react","polarisIsPhoneNumber"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e,t=o("PolarisReactRedux.react").useSelector(s),n=t==null||(e=t.fields.emailOrPhone)==null?void 0:e.value;if(n==null)return null;var a=r("polarisIsPhoneNumber")(n);return a?"phone":"email"}function s(e){var t;return(t=e.auth.signup)==null?void 0:t.signupResult}l.default=e}),98);
__d("PolarisAcceptTermsOfUseForm.react",["PolarisAcceptTermsOfUseBody.react","PolarisAuthStrings","PolarisReactRedux.react","PolarisRegistrationLogger","PolarisSignupActions","PolarisSignupFormFields.react","PolarisSignupTypesHelpers","react","react-compiler-runtime","usePolarisEmailOrPhoneContactpointType"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useEffect,d=u.useState;function m(e){var t=o("react-compiler-runtime").c(18),n=e.onSignup,a=e.requestInFlight,i=e.signupNonSpecificError,l=e.style,u=l===void 0?"default":l,m=o("PolarisReactRedux.react").useDispatch(),_=o("PolarisReactRedux.react").useSelector(p),f=r("usePolarisEmailOrPhoneContactpointType")(),g;t[0]!==f||t[1]!==m?(g=function(){m(o("PolarisSignupActions").returnToBaseSignupForm()),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:f,event_name:"back_button_clicked",step:"acceptTerms"})},t[0]=f,t[1]=m,t[2]=g):g=t[2];var h=g,y;t[3]!==f||t[4]!==n||t[5]!==_?(y=function(){n(o("PolarisSignupTypesHelpers").convertSignupResultToSignupFields(_)),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:f,event_name:"accept_terms_form_next_clicked"})},t[3]=f,t[4]=n,t[5]=_,t[6]=y):y=t[6];var C=y,b,v;t[7]!==f?(b=function(){o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:f,event_name:"form_load",step:"acceptTerms"})},v=[f],t[7]=f,t[8]=b,t[9]=v):(b=t[8],v=t[9]),c(b,v);var S=d(!0),R=S[0],L=S[1],E;t[10]===Symbol.for("react.memo_cache_sentinel")?(E=s.jsx(r("PolarisAcceptTermsOfUseBody.react"),{onAcceptAllTermsChange:function(t){L(!t)}}),t[10]=E):E=t[10];var k;return t[11]!==h||t[12]!==C||t[13]!==R||t[14]!==a||t[15]!==i||t[16]!==u?(k=s.jsx(r("PolarisSignupFormFields.react"),{handleGoBack:h,handleNext:C,header:o("PolarisAuthStrings").AGREE_TO_TERMS,isNextActionDisabled:R,requestInFlight:a,signupNonSpecificError:i,style:u,subHeader:o("PolarisAuthStrings").PERSONAL_INFO_SECURE,children:E}),t[11]=h,t[12]=C,t[13]=R,t[14]=a,t[15]=i,t[16]=u,t[17]=k):k=t[17],k}function p(e){var t;return(t=e.auth.signup)==null?void 0:t.signupResult}l.default=m}),98);
__d("PolarisAccountPrivacyHelpers",[],(function(t,n,r,o,a,i){"use strict";var e={PRIVATE:"private",PUBLIC:"public"},l={NUX_FORM_IMPRESSION:"web_pbd_nux_form_impression",NUX_FORM_NEXT_BUTTON_CLICK:"web_pbd_nux_form_next_button_click",NUX_FORM_SELECT_OPTION:"web_pbd_nux_form_select_option",NUX_FORM_SET_PRIVATE_FAILURE:"web_pbd_nux_form_set_private_failure",NUX_FORM_SET_PRIVATE_SUCCESS:"web_pbd_nux_form_set_private_success",NUX_PAGE_IMPRESSION:"web_pbd_nux_page_impression"};i.PrivacyOptionsEnum=e,i.PBDNuxEventsEnum=l}),66);
__d("PolarisAccountPrivacyBody.react",["IGDSRadioButton.react","IGDSTextVariants.react","PolarisAccountPrivacyHelpers","PolarisAuthStrings","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){var t=o("react-compiler-runtime").c(5),n=e.selectedBodyOption,a=e.setSelectedBodyOption,i;if(t[0]===Symbol.for("react.memo_cache_sentinel")){var l;i=[{desc:(l=o("PolarisAuthStrings")).PRIVATE_ACCOUNT_DESCRIPTION,label:l.PRIVATE_ACCOUNT,value:o("PolarisAccountPrivacyHelpers").PrivacyOptionsEnum.PRIVATE},{desc:l.PUBLIC_ACCOUNT_DESCRIPTION,label:l.PUBLIC_ACCOUNT,value:o("PolarisAccountPrivacyHelpers").PrivacyOptionsEnum.PUBLIC}],t[0]=i}else i=t[0];var u=i,c;t[1]===Symbol.for("react.memo_cache_sentinel")?(c={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1xmf6yo x1n2onr6"},t[1]=c):c=t[1];var d;return t[2]!==n||t[3]!==a?(d=s.jsx("div",babelHelpers.extends({},c,{children:u.map(function(e){return s.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1yztbdb x14vqqas",children:s.jsx(r("IGDSRadioButton.react"),{isChecked:e.value===n,label:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1",children:s.jsx(o("IGDSTextVariants.react").IGDSTextBodyEmphasized,{textAlign:"start",zeroMargin:!1,children:e.label})}),s.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1gslohp x1n2onr6",children:s.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"secondaryText",textAlign:"start",zeroMargin:!1,children:e.desc})})]}),onChange:function(){return a(e.value)},value:e.value})},e.value)})})),t[2]=n,t[3]=a,t[4]=d):d=t[4],d}l.default=u}),98);
__d("PolarisSettingsActionSetPrivateAccount",["FBLogger","InstagramGenericSettingStrings","PolarisAPISetPrivateAccount","PolarisGenericStrings","PolarisSentryFeedbackActions"],(function(t,n,r,o,a,i,l){"use strict";function e(t){var n=t.handleFailure,a=t.handleSuccess,i=t.isNuxAction,l=t.isUsingConfirmationDialog,s=t.privateAccount,u=t.publicToPrivateRateLimitOverride,c=t.setErrorMessage,d=t.setLoading;return function(t){return d!=null&&d(!0),c!=null&&c(null),t({privateAccount:s,type:"PRIVATE_ACCOUNT_UPDATE_REQUESTED"}),o("PolarisAPISetPrivateAccount").setPrivateAccount(s,u,i,l).then(function(r){if(s&&r.status==="ok"&&r.has_private_public_switch_restriction){var i=r.privacy_rate_limit_dialog_message;t({message:i,title:r.privacy_rate_limit_dialog_title,type:"ACCOUNT_PRIVACY_PUBLIC_TO_PRIVATE_SWITCH_RATE_LIMITED"}),d!=null&&d(!1),c!=null&&c(i),n!=null&&n();return}if(!s&&r.status==="ok"&&r.has_private_public_switch_restriction){var l=r.privacy_rate_limit_dialog_message;t({message:l,title:r.privacy_rate_limit_dialog_title,type:"ACCOUNT_PRIVACY_PRIVATE_TO_PUBLIC_SWITCH_RATE_LIMITED"}),d!=null&&d(!1),c!=null&&c(l),n!=null&&n();return}r.status==="ok"?(t({privateAccount:s,toast:{text:o("InstagramGenericSettingStrings").GENERIC_SETTINGS_SAVED},type:"PRIVATE_ACCOUNT_UPDATE_SUCCEEDED"}),a!=null&&a()):(t({privateAccount:!s,toast:{actionHandler:function(){return t(e({privateAccount:s}))},actionText:o("PolarisGenericStrings").RETRY_TEXT,text:o("InstagramGenericSettingStrings").GENERIC_SETTINGS_ERROR},type:"PRIVATE_ACCOUNT_UPDATE_FAILED"}),d!=null&&d(!1),c!=null&&c(o("PolarisGenericStrings").GENERIC_ERROR_MESSAGE),n!=null&&n())},function(a){var i,l;d!=null&&d(!1);var u=((i=a.responseObject)==null?void 0:i.spam)||!1;if(u){var m,p,_,f,g,h,y,C=(m=a.responseObject)==null?void 0:m.feedback_title,b=(p=a.responseObject)==null?void 0:p.feedback_message,v=(_=a.responseObject)==null?void 0:_.feedback_url,S=(f=a.responseObject)==null?void 0:f.feedback_action,R=(g=a.responseObject)==null?void 0:g.feedback_appeal_label,L=(h=a.responseObject)==null?void 0:h.restriction_enrollment_data,E=(y=a.responseObject)==null?void 0:y.enforcement_transparency_instance_identifier;t(o("PolarisSentryFeedbackActions").showSentryFeedback({action:S,enforcement_transparency_instance_identifier:E,feedback_appeal_label:R,message:b,restriction_enrollment_data:L,sourceOfAction:"set_private_account",title:C,url:v})),c!=null&&c(b),n!=null&&n()}var k=(l=a.responseObject)==null?void 0:l.message;t({privateAccount:!s,toast:u?void 0:{actionHandler:function(){return t(e({privateAccount:s}))},actionText:o("PolarisGenericStrings").RETRY_TEXT,text:k||o("InstagramGenericSettingStrings").GENERIC_SETTINGS_ERROR},type:"PRIVATE_ACCOUNT_UPDATE_FAILED"}),c!=null&&c(k||o("PolarisGenericStrings").GENERIC_ERROR_MESSAGE),n!=null&&n(),r("FBLogger")("ig_web").catching(a)})}}l.setPrivateAccount=e}),98);
__d("PolarisAccountPrivacyForm.react",["IGDSLockOutline96Icon.react","IGDSTextVariants.react","IgtsDefaultsFalcoEvent","InstagramODS","PolarisAccountPrivacyBody.react","PolarisAccountPrivacyHelpers","PolarisAuthStrings","PolarisConfig","PolarisGenericOnboardingUnit.react","PolarisReactRedux.react","PolarisSettingsActionSetPrivateAccount","gkx","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useEffect,d=u.useState;function m(e){var t=o("react-compiler-runtime").c(33),n=e.buttonLabel,a=e.defaultedToPrivate,i=e.handleNext,l=e.subtitle,u=a||r("gkx")("6489")||r("gkx")("25363"),m=d(u?o("PolarisAccountPrivacyHelpers").PrivacyOptionsEnum.PRIVATE:null),p=m[0],_=m[1],f;t[0]===Symbol.for("react.memo_cache_sentinel")?(f=o("PolarisConfig").getViewerId(),t[0]=f):f=t[0];var g=f,h=o("PolarisReactRedux.react").useDispatch(),y=d(!1),C=y[0],b=y[1],v=d(null),S=v[0],R=v[1],L,E;t[1]!==u?(L=function(){r("InstagramODS").incr("web.pbd.impression"),r("IgtsDefaultsFalcoEvent").log(function(){return{client_userid:g,event_type:o("PolarisAccountPrivacyHelpers").PBDNuxEventsEnum.NUX_FORM_IMPRESSION,is_set_to_private:u}})},E=[u,g],t[1]=u,t[2]=L,t[3]=E):(L=t[2],E=t[3]),c(L,E);var k;t[4]!==i||t[5]!==p?(k=function(){r("InstagramODS").incr("web.pbd.set_private_success"),r("IgtsDefaultsFalcoEvent").log(function(){return{client_userid:g,event_type:o("PolarisAccountPrivacyHelpers").PBDNuxEventsEnum.NUX_FORM_SET_PRIVATE_SUCCESS,target_control_type:p}}),i()},t[4]=i,t[5]=p,t[6]=k):k=t[6];var I=k,T;t[7]!==p?(T=function(){r("InstagramODS").incr("web.pbd.set_private_failure"),r("IgtsDefaultsFalcoEvent").log(function(){return{client_userid:g,event_type:o("PolarisAccountPrivacyHelpers").PBDNuxEventsEnum.NUX_FORM_SET_PRIVATE_FAILURE,target_control_type:p}})},t[7]=p,t[8]=T):T=t[8];var D=T,x;t[9]!==h||t[10]!==D||t[11]!==I||t[12]!==p?(x=function(){r("InstagramODS").incr("web.pbd.next_button_click"),r("IgtsDefaultsFalcoEvent").log(function(){return{client_userid:g,event_type:o("PolarisAccountPrivacyHelpers").PBDNuxEventsEnum.NUX_FORM_NEXT_BUTTON_CLICK,target_control_type:p}}),h(o("PolarisSettingsActionSetPrivateAccount").setPrivateAccount({handleFailure:D,handleSuccess:I,isNuxAction:!0,privateAccount:p===o("PolarisAccountPrivacyHelpers").PrivacyOptionsEnum.PRIVATE,publicToPrivateRateLimitOverride:!0,setErrorMessage:R,setLoading:b}))},t[9]=h,t[10]=D,t[11]=I,t[12]=p,t[13]=x):x=t[13];var $=x,P;t[14]===Symbol.for("react.memo_cache_sentinel")?(P=function(t){r("InstagramODS").incr("web.pbd.option_select"),r("IgtsDefaultsFalcoEvent").log(function(){return{client_userid:g,event_type:o("PolarisAccountPrivacyHelpers").PBDNuxEventsEnum.NUX_FORM_SELECT_OPTION,target_control_type:t}}),_(t)},t[14]=P):P=t[14];var N=P,M;t[15]===Symbol.for("react.memo_cache_sentinel")?(M={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1yztbdb x1n2onr6"},t[15]=M):M=t[15];var w;t[16]!==l?(w=s.jsx("div",babelHelpers.extends({},M,{children:s.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"secondaryText",textAlign:"center",zeroMargin:!1,children:l})})),t[16]=l,t[17]=w):w=t[17];var A;t[18]!==p?(A=s.jsx(r("PolarisAccountPrivacyBody.react"),{selectedBodyOption:p,setSelectedBodyOption:N}),t[18]=p,t[19]=A):A=t[19];var F;t[20]!==A||t[21]!==w?(F=s.jsxs(s.Fragment,{children:[w,A]}),t[20]=A,t[21]=w,t[22]=F):F=t[22];var O=p==null,B;t[23]!==S?(B=S!=null?s.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1l90r2v x11lfxj5 x135b78x xyamay9 x1n2onr6",children:s.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"errorOrDestructive",textAlign:"center",zeroMargin:!1,children:S})}):null,t[23]=S,t[24]=B):B=t[24];var W;t[25]===Symbol.for("react.memo_cache_sentinel")?(W=s.jsx(r("IGDSLockOutline96Icon.react"),{alt:o("PolarisAuthStrings").ACCOUNT_PRIVACY_HEADER_TEXT,size:64}),t[25]=W):W=t[25];var q;return t[26]!==n||t[27]!==$||t[28]!==C||t[29]!==F||t[30]!==O||t[31]!==B?(q=s.jsx(r("PolarisGenericOnboardingUnit.react"),{bodyText:F,buttonDisabled:O,buttonText:n,footer:B,headerText:o("PolarisAuthStrings").ACCOUNT_PRIVACY_HEADER_TEXT,icon:W,isProcessing:C,onButtonClick:$}),t[26]=n,t[27]=$,t[28]=C,t[29]=F,t[30]=O,t[31]=B,t[32]=q):q=t[32],q}l.default=m}),98);
__d("polarisActivityUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=["comments","likes","relationships","usertags"];for(var n of t)if(n in e&&e[n]>0)return!0;return!1}i.hasUnreadCountsV2=e}),66);
__d("PolarisActivityStorySelectors",["polarisActivityUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e.activityStories}function s(t){return e(t).error}function u(t){return e(t).loading}function c(t){return e(t).newStories}function d(t){return e(t).oldStories}function m(t){return e(t).followRequests}function p(t){return e(t).relationships}function _(t){return Object.keys(e(t).followRequests).length>0}function f(t){return e(t).suggestedUsers}function g(t){return e(t).partition}function h(t){return e(t).countsRequested}function y(t){return e(t).counts}function C(t){return o("polarisActivityUtils").hasUnreadCountsV2(e(t).counts)}function b(t){return e(t).showBanner}l.feedError=s,l.feedIsLoading=u,l.newStories=c,l.oldStories=d,l.followRequests=m,l.relationships=p,l.showFollowRequests=_,l.suggestedUsers=f,l.partition=g,l.countsIsLoading=h,l.unreadCounts=y,l.hasUnread=C,l.showBanner=b}),98);
__d("PolarisPlatformBadge",["PolarisConfig"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t,n,r,a=o("PolarisConfig").getPlatformInstallBadgeLinks();switch(e){case"ios":return(t=a==null?void 0:a.ios)!=null?t:"";case"android":return(n=a==null?void 0:a.android)!=null?n:"";case"windows_nt_10":return(r=a==null?void 0:a.windows_nt_10)!=null?r:""}return""}l.default=e}),98);
__d("PolarisAppInstallLink.react",["fbt","PolarisConfigConstants","PolarisFastLink.react","PolarisIgLiteCarbonUpsellsUtils","PolarisLoggedOutCtaClickLogger","PolarisNavigationUtils","PolarisPlatformBadge","polarisGetAppPlatform","polarisGetInstallAppHref","polarisLogAction","react","stylex","usePolarisPageID"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c=u||(u=o("react")),d=u.useMemo,m={root:{marginInlineEnd:"x1xegmmw x1j53mea",$$css:!0}};function p(t){var n=t.campaign,a=t.children,i=t.ctaTypeV2,l=t["data-testid"],u=t.isDismissible,p=u===void 0?!1:u,_=t.isForIGCarbonPath,f=t.medium,g=t.onClick,h=t.platform,y=t.role,C=t.smallHeight,b=t.xstyle,v=h!=null&&h.length>0?h:o("polarisGetAppPlatform").getAppPlatform(),S=_===!0||o("PolarisIgLiteCarbonUpsellsUtils").isIgLiteCarbonUpsellsEligible(),R=r("usePolarisPageID")(),L=function(t){g&&(g(t),t.isDefaultPrevented())||(t.preventDefault(),r("polarisLogAction")("appInstallClick",{medium:k(),platform:v,source:n}),o("PolarisLoggedOutCtaClickLogger").logLoggedOutCtaClickEvent("app_store_open",i,R,{isDismissible:p}),o("PolarisNavigationUtils").openURLWithFullPageReload(E()))},E=function(){return S?o("polarisGetInstallAppHref").getInstallIGLiteCarbonAppHref(n,k(),v):o("polarisGetInstallAppHref").getInstallAppHref(n,k(),v)},k=function(){return f!=null?f:a!=null?"installLink":"badge"},I=d(function(){var e,t;switch(v){case o("PolarisConfigConstants").appPlatformTypes.ANDROID:t=s._(/*BTDS*/"Descargar en Google Play"),e=r("PolarisPlatformBadge")("android");break;case o("PolarisConfigConstants").appPlatformTypes.IOS:t=s._(/*BTDS*/"Descargar en la App Store"),e=r("PolarisPlatformBadge")("ios");break;case o("PolarisConfigConstants").appPlatformTypes.WINDOWSNT10:t=s._(/*BTDS*/"Descargar desde Microsoft"),e=r("PolarisPlatformBadge")("windows_nt_10");break}var n;return e==null||e===""?n=null:n=c.jsx("img",{alt:t,className:_===!0?"xwvwv9b":{0:"",2:"x1vqgdyp",1:"x10w6t97",3:"x10w6t97"}[(C!==!0)<<1|(C===!0)<<0],src:e}),{altText:t,badgeImage:n}},[_,v,C]);return c.jsx(r("PolarisFastLink.react"),{"aria-label":I.altText,className:(e||(e=r("stylex")))(m.root,b),"data-testid":void 0,href:E(),onClick:L,role:y,children:a!=null?a:I.badgeImage})}p.displayName=p.name+" [from "+i.id+"]",l.default=p}),226);
__d("PolarisTooManyAccountsDialog.react",["fbt","PolarisConfirmDialog.react","PolarisGenericStrings","PolarisOneTapLogin","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react"));function c(e){var t=o("react-compiler-runtime").c(8),n=e.onClose,a=e.onConfirm,i=d,l;t[0]===Symbol.for("react.memo_cache_sentinel")?(l=i(),t[0]=l):l=t[0];var c;t[1]!==a?(c=a!=null?s._(/*BTDS*/"Editar cuentas"):void 0,t[1]=a,t[2]=c):c=t[2];var m=a!=null?a:void 0,p;t[3]===Symbol.for("react.memo_cache_sentinel")?(p=s._(/*BTDS*/"No se puede agregar la cuenta"),t[3]=p):p=t[3];var _;return t[4]!==n||t[5]!==c||t[6]!==m?(_=u.jsx(r("PolarisConfirmDialog.react"),{body:l,cancelLabel:o("PolarisGenericStrings").OK_TEXT,confirmLabel:c,onClose:n,onConfirm:m,title:p}),t[4]=n,t[5]=c,t[6]=m,t[7]=_):_=t[7],_}function d(){return o("PolarisOneTapLogin").TOO_MANY_ACCOUNTS_TEXT}l.default=c}),226);
__d("XPolarisLoginControllerRouteBuilder",["jsRouteBuilder"],(function(t,n,r,o,a,i,l){var e=r("jsRouteBuilder")("/accounts/login/",Object.freeze({force_authentication:!1,enable_fb_login:!1,is_from_rle:!1,is_profile_curation:!1,mtn:!1,flo:!1}),new Set(["force_authentication","enable_fb_login","is_from_rle","is_profile_curation","mtn"])),s=e;l.default=s}),98);
__d("usePolarisOneTapLoginEditModeStateQuery.graphql",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{alias:null,args:null,concreteType:"XDTViewer",kind:"LinkedField",name:"xdt_viewer",plural:!1,selections:[{kind:"ClientExtension",selections:[{alias:null,args:null,concreteType:"PolarisOneTapLogin",kind:"LinkedField",name:"one_tap_login",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"edit_mode",storageKey:null}],storageKey:null}]}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"usePolarisOneTapLoginEditModeStateQuery",selections:e,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"usePolarisOneTapLoginEditModeStateQuery",selections:e},params:{cacheID:"fded0f553435868ea14676d1156763b5",id:null,metadata:{is_distillery:!0,root_field_name:["xdt_viewer"]},name:"usePolarisOneTapLoginEditModeStateQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("usePolarisOneTapLoginEditModeState",["CometRelay","PolarisLoginLogger","react","react-compiler-runtime","usePolarisOneTapLoginEditModeStateQuery.graphql"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(s||(s=o("react"))).useCallback;function c(){var t,r,a=o("react-compiler-runtime").c(7),i=o("CometRelay").useRelayEnvironment(),l,s;a[0]===Symbol.for("react.memo_cache_sentinel")?(l=e!==void 0?e:e=n("usePolarisOneTapLoginEditModeStateQuery.graphql"),s={},a[0]=l,a[1]=s):(l=a[0],s=a[1]);var u=o("CometRelay").useClientQuery(l,s),c;a[2]!==i?(c=function(t){o("CometRelay").commitLocalUpdate(i,function(e){e.getRoot().getOrCreateLinkedRecord("xdt_viewer","XDTViewer").getOrCreateLinkedRecord("one_tap_login","PolarisOneTapLogin").setValue(t,"edit_mode")}),o("PolarisLoginLogger").logLoginEvent({event_name:t?"one_tap_login_done_editing_click":"one_tap_login_manage_accounts_click",login_type:"device_based_login"})},a[2]=i,a[3]=c):c=a[3];var d=c,m=(t=u==null||(r=u.xdt_viewer)==null||(r=r.one_tap_login)==null?void 0:r.edit_mode)!=null?t:!1,p;return a[4]!==m||a[5]!==d?(p=[m,d],a[4]=m,a[5]=d,a[6]=p):p=a[6],p}l.default=c}),98);
__d("PolarisAuthTypeSwitcher.react",["fbt","IGDSButton.react","IGDSTextVariants.react","PolarisAuthActionConstants","PolarisAuthActions","PolarisAuthConstants","PolarisAuthLimitedRegistrationHelpers","PolarisAuthStrings","PolarisFastLink.react","PolarisLinkBuilder","PolarisLoggedOutCtaClickLogger","PolarisLoggedOutUpsellExposureV2","PolarisLoginLogger","PolarisMultiSignupTypes","PolarisOneTapLogin","PolarisOneTapLoginStorage","PolarisReactRedux.react","PolarisRoutes","PolarisSignupActions","PolarisTooManyAccountsDialog.react","PolarisUA","XPolarisLoginControllerRouteBuilder","XPolarisMultiStepSignupControllerRouteBuilder","react","react-compiler-runtime","usePolarisOneTapLoginEditModeState","usePolarisPageID"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e,d=c.useCallback,m=c.useState,p=o("PolarisAuthLimitedRegistrationHelpers").hasRestrictedRegistration();function _(e){var t=o("react-compiler-runtime").c(17),n=e.className,a=e.fromLoggedOutDialog,i=e.onClick,l=a===void 0?!1:a,c=o("PolarisReactRedux.react").useDispatch(),d=r("usePolarisPageID")(),m;t[0]===Symbol.for("react.memo_cache_sentinel")?(m=u.jsx(o("IGDSTextVariants.react").IGDSTextBodyEmphasized,{color:"primaryButton",zeroMargin:!1,children:s._(/*BTDS*/"Reg\u00edstrate")}),t[0]=m):m=t[0];var _=m,f;t[1]!==c||t[2]!==l||t[3]!==i||t[4]!==d?(f=function(){return o("PolarisLoggedOutCtaClickLogger").logLoggedOutCtaClickEvent("signup",l?"auth_form_dialog":"auth_form",d),o("PolarisLoginLogger").logLoginEvent({event_flow:"login_manual",event_name:"sign_up_button_clicked"}),p&&c(o("PolarisSignupActions").setShowRegulatoryConsentModal()),i},t[1]=c,t[2]=l,t[3]=i,t[4]=d,t[5]=f):f=t[5];var g=f,h;t[6]!==d?(h=function(){if(o("PolarisUA").isMobile()&&!p)return r("XPolarisMultiStepSignupControllerRouteBuilder").buildUri({step_name:o("PolarisMultiSignupTypes").getFirstStep()}).toString();if(!o("PolarisUA").isMobile()&&!p||d!=="unifiedHome")return o("PolarisRoutes").EMAIL_SIGNUP_PATH},t[6]=d,t[7]=h):h=t[7];var y=h,C;t[8]===Symbol.for("react.memo_cache_sentinel")?(C=s._(/*BTDS*/"\u00bfNo tienes una cuenta?"),t[8]=C):C=t[8];var b;t[9]!==y?(b=y(),t[9]=y,t[10]=b):b=t[10];var v;t[11]!==g||t[12]!==b?(v=u.jsx(r("PolarisFastLink.react"),{"data-testid":void 0,href:b,onClick:g,prefetchQueriesOnMount_I_KNOW_WHAT_IM_DOING:r("PolarisLoggedOutUpsellExposureV2").xplatform.enable_faster_nav_for_cta,preloadCodeOnMount:r("PolarisLoggedOutUpsellExposureV2").xplatform.enable_faster_nav_for_cta,children:_}),t[11]=g,t[12]=b,t[13]=v):v=t[13];var S;return t[14]!==n||t[15]!==v?(S=u.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"secondaryText",textAlign:"auto",zeroMargin:!1,children:u.jsxs("p",{className:n,children:[C," ",v]})}),t[14]=n,t[15]=v,t[16]=S):S=t[16],S}function f(e){var t=o("react-compiler-runtime").c(11),n=e.className,a=e.fromLoggedOutDialog,i=e.onClick,l=a===void 0?!1:a,c=r("usePolarisPageID")(),d;t[0]!==l||t[1]!==i||t[2]!==c?(d=function(){return o("PolarisLoggedOutCtaClickLogger").logLoggedOutCtaClickEvent("login",l?"auth_form_dialog":"auth_form",c),i},t[0]=l,t[1]=i,t[2]=c,t[3]=d):d=t[3];var m=d,p;t[4]===Symbol.for("react.memo_cache_sentinel")?(p=u.jsx(o("IGDSTextVariants.react").IGDSTextBodyEmphasized,{color:"primaryButton",zeroMargin:!1,children:s._(/*BTDS*/"Inicia sesi\u00f3n")}),t[4]=p):p=t[4];var _=p,f;if(t[5]!==m){var g;t[7]===Symbol.for("react.memo_cache_sentinel")?(g=o("PolarisLinkBuilder").buildLoginLink("",{source:"auth_switcher"}),t[7]=g):g=t[7],f=s._(/*BTDS*/"\u00bfTienes una cuenta? {link that reads Log in}",[s._param("link that reads Log in",u.jsx(r("PolarisFastLink.react"),{"data-testid":void 0,href:g,onClick:m,children:_}))]),t[5]=m,t[6]=f}else f=t[6];var h;return t[8]!==n||t[9]!==f?(h=u.jsx("p",{className:n,children:f}),t[8]=n,t[9]=f,t[10]=h):h=t[10],h}function g(e){var t=o("react-compiler-runtime").c(34),n=e.onSwitchAuthType,a=e.pageType,i=o("PolarisReactRedux.react").useDispatch(),l=r("usePolarisPageID")(),c=r("usePolarisOneTapLoginEditModeState")(),d=c[0],_=c[1],f=m(!1),g=f[0],h=f[1],y;t[0]!==n?(y=function(){o("PolarisOneTapLogin").hasMaxOneTapNonces()?(h(!0),o("PolarisLoginLogger").logLoginEvent({event_name:"one_tap_login_switch_account_too_many_accounts",login_type:"device_based_login"})):(n(o("PolarisAuthActionConstants").AUTH.login),o("PolarisLoginLogger").logLoginEvent({event_flow:"aymh",event_name:"one_tap_login_switch_account_click",login_type:"device_based_login"}))},t[0]=n,t[1]=y):y=t[1];var C=y,b;t[2]!==d||t[3]!==_?(b=function(){_(!d)},t[2]=d,t[3]=_,t[4]=b):b=t[4];var v=b,S;t[5]!==l?(S=function(){if(!(p&&l==="unifiedHome"))return o("PolarisUA").isMobile()?r("XPolarisMultiStepSignupControllerRouteBuilder").buildUri({step_name:o("PolarisMultiSignupTypes").getFirstStep()}).toString():o("PolarisRoutes").EMAIL_SIGNUP_PATH},t[5]=l,t[6]=S):S=t[6];var R=S,L;if(t[7]!==i||t[8]!==R||t[9]!==C||t[10]!==n||t[11]!==a){var E;t[13]!==a?(E=o("PolarisOneTapLogin").hasMaxOneTapNonces()?void 0:a===o("PolarisAuthConstants").AuthPageType.Signup?r("XPolarisLoginControllerRouteBuilder").buildURL({}):void 0,t[13]=a,t[14]=E):E=t[14];var k;t[15]===Symbol.for("react.memo_cache_sentinel")?(k=s._(/*BTDS*/"Cambiar de cuenta"),t[15]=k):k=t[15];var I;t[16]!==C||t[17]!==E?(I=u.jsx(r("IGDSButton.react"),{display:"block",href:E,label:k,onClick:C,variant:"primary_link"}),t[16]=C,t[17]=E,t[18]=I):I=t[18];var T;t[19]!==R?(T=R(),t[19]=R,t[20]=T):T=t[20];var D;t[21]===Symbol.for("react.memo_cache_sentinel")?(D=s._(/*BTDS*/"Registrarte"),t[21]=D):D=t[21];var x;t[22]!==i||t[23]!==n?(x=function(){if(p){i(o("PolarisSignupActions").setShowRegulatoryConsentModal());return}n(o("PolarisAuthActionConstants").AUTH.signup),o("PolarisLoginLogger").logLoginEvent({event_flow:"aymh",event_name:"one_tap_login_signup_click",login_type:"device_based_login"})},t[22]=i,t[23]=n,t[24]=x):x=t[24];var $;t[25]!==x||t[26]!==T?($=u.jsx(r("IGDSButton.react"),{display:"block",href:T,label:D,onClick:x,variant:"primary_link"}),t[25]=x,t[26]=T,t[27]=$):$=t[27],L=u.jsx("div",{children:s._(/*BTDS*/"{link that reads Switch Accounts} o {link that reads sign up}",[s._param("link that reads Switch Accounts",I),s._param("link that reads sign up",$)])}),t[7]=i,t[8]=R,t[9]=C,t[10]=n,t[11]=a,t[12]=L}else L=t[12];var P;t[28]!==v||t[29]!==g?(P=g&&u.jsx(r("PolarisTooManyAccountsDialog.react"),{onClose:function(){return h(!1)},onConfirm:function(){v(),h(!1)}}),t[28]=v,t[29]=g,t[30]=P):P=t[30];var N;return t[31]!==L||t[32]!==P?(N=u.jsxs(u.Fragment,{children:[L,P]}),t[31]=L,t[32]=P,t[33]=N):N=t[33],N}function h(e){var t=o("react-compiler-runtime").c(42),n=e.authType,r=e.className,a=e.fromLoggedOutDialog,i=e.loggedInFBUser,l=e.onNavigate,s=e.onSwitchAuthType,c=e.pageType,d=e.primary,m=a===void 0?!1:a;if(n===o("PolarisAuthActionConstants").AUTH.fbLogin||n===o("PolarisAuthActionConstants").AUTH.fbAccountPicker||n===o("PolarisAuthActionConstants").AUTH.oneTapLogin){var p,h;if(t[0]!==n||t[1]!==r){var y,C=o("PolarisOneTapLoginStorage").getLoginNonces();if(n===o("PolarisAuthActionConstants").AUTH.oneTapLogin&&Object.values(C).length===1){var b=Object.keys(C)[0];y=C[b].username}p=r,h=y!=null&&u.jsx("div",{className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x12nagc x1n2onr6",children:o("PolarisAuthStrings").notUsernameText(y)}),t[0]=n,t[1]=r,t[2]=p,t[3]=h}else p=t[2],h=t[3];var v;t[4]!==s||t[5]!==c||t[6]!==d?(v=u.jsx(g,{onSwitchAuthType:s,pageType:c,primary:d}),t[4]=s,t[5]=c,t[6]=d,t[7]=v):v=t[7];var S;return t[8]!==p||t[9]!==h||t[10]!==v?(S=u.jsxs("div",{className:p,children:[h,v]}),t[8]=p,t[9]=h,t[10]=v,t[11]=S):S=t[11],S}else if(n===o("PolarisAuthActionConstants").AUTH.fbConnectV2&&i!=null&&i.profile_name!=null){var R;t[12]===Symbol.for("react.memo_cache_sentinel")?(R={className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x12nagc x1n2onr6"},t[12]=R):R=t[12];var L;t[13]!==i.profile_name?(L=i.profile_name!=null?o("PolarisAuthStrings").notUsernameText(i.profile_name.split(" ")[0]):void 0,t[13]=i.profile_name,t[14]=L):L=t[14];var E;t[15]!==L?(E=u.jsx("div",babelHelpers.extends({},R,{children:L})),t[15]=L,t[16]=E):E=t[16];var k;t[17]!==s||t[18]!==c||t[19]!==d?(k=u.jsx(g,{onSwitchAuthType:s,pageType:c,primary:d}),t[17]=s,t[18]=c,t[19]=d,t[20]=k):k=t[20];var I;return t[21]!==r||t[22]!==E||t[23]!==k?(I=u.jsxs("div",{className:r,children:[E,k]}),t[21]=r,t[22]=E,t[23]=k,t[24]=I):I=t[24],I}else if(n===o("PolarisAuthActionConstants").AUTH.login||n===o("PolarisAuthActionConstants").AUTH.none){var T;t[25]!==l?(T=function(){return l==null?void 0:l("signup")},t[25]=l,t[26]=T):T=t[26];var D;return t[27]!==r||t[28]!==m||t[29]!==T?(D=u.jsx(_,{className:r,fromLoggedOutDialog:m,onClick:T}),t[27]=r,t[28]=m,t[29]=T,t[30]=D):D=t[30],D}else if(n===o("PolarisAuthActionConstants").AUTH.signup){var x;t[31]!==l?(x=function(){return l==null?void 0:l("login")},t[31]=l,t[32]=x):x=t[32];var $;return t[33]!==r||t[34]!==m||t[35]!==x?($=u.jsx(f,{className:r,fromLoggedOutDialog:m,onClick:x}),t[33]=r,t[34]=m,t[35]=x,t[36]=$):$=t[36],$}else if(o("PolarisUA").isMobile()){var P;t[37]!==l?(P=function(){return l==null?void 0:l("signup")},t[37]=l,t[38]=P):P=t[38];var N;return t[39]!==r||t[40]!==P?(N=u.jsx(_,{className:r,onClick:P}),t[39]=r,t[40]=P,t[41]=N):N=t[41],N}return null}function y(e){var t=e.auth.authType;return{authType:t}}function C(e){return{onSwitchAuthType:function(n){e(o("PolarisAuthActions").switchAuthType(n))}}}var b=o("PolarisReactRedux.react").connect(y,C)(h);l.default=b}),226);
__d("PolarisBarcelonaAppSVGIcon.react",["react","react-compiler-runtime","vulture"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u="Threads";function c(e){var t=o("react-compiler-runtime").c(5),n=e.fill,a=e.size,i=n===void 0?"var(--barcelona-logo)":n,l=a===void 0?34:a;r("vulture")("7bQEAu-DlqjkZDNXRF9VX2XxyTI=");var c;t[0]!==i?(c=s.jsx("path",{d:"M141.537 88.9883C140.71 88.5919 139.87 88.2104 139.019 87.8451C137.537 60.5382 122.616 44.905 97.5619 44.745C97.4484 44.7443 97.3355 44.7443 97.222 44.7443C82.2364 44.7443 69.7731 51.1409 62.102 62.7807L75.881 72.2328C81.6116 63.5383 90.6052 61.6848 97.2286 61.6848C97.3051 61.6848 97.3819 61.6848 97.4576 61.6855C105.707 61.7381 111.932 64.1366 115.961 68.814C118.893 72.2193 120.854 76.925 121.825 82.8638C114.511 81.6207 106.601 81.2385 98.145 81.7233C74.3247 83.0954 59.0111 96.9879 60.0396 116.292C60.5615 126.084 65.4397 134.508 73.775 140.011C80.8224 144.663 89.899 146.938 99.3323 146.423C111.79 145.74 121.563 140.987 128.381 132.296C133.559 125.696 136.834 117.143 138.28 106.366C144.217 109.949 148.617 114.664 151.047 120.332C155.179 129.967 155.42 145.8 142.501 158.708C131.182 170.016 117.576 174.908 97.0135 175.059C74.2042 174.89 56.9538 167.575 45.7381 153.317C35.2355 139.966 29.8077 120.682 29.6052 96C29.8077 71.3178 35.2355 52.0336 45.7381 38.6827C56.9538 24.4249 74.2039 17.11 97.0132 16.9405C119.988 17.1113 137.539 24.4614 149.184 38.788C154.894 45.8136 159.199 54.6488 162.037 64.9503L178.184 60.6422C174.744 47.9622 169.331 37.0357 161.965 27.974C147.036 9.60668 125.202 0.195148 97.0695 0H96.9569C68.8816 0.19447 47.2921 9.6418 32.7883 28.0793C19.8819 44.4864 13.2244 67.3157 13.0007 95.9325L13 96L13.0007 96.0675C13.2244 124.684 19.8819 147.514 32.7883 163.921C47.2921 182.358 68.8816 191.806 96.9569 192H97.0695C122.03 191.827 139.624 185.292 154.118 170.811C173.081 151.866 172.51 128.119 166.26 113.541C161.776 103.087 153.227 94.5962 141.537 88.9883ZM98.4405 129.507C88.0005 130.095 77.1544 125.409 76.6196 115.372C76.2232 107.93 81.9158 99.626 99.0812 98.6368C101.047 98.5234 102.976 98.468 104.871 98.468C111.106 98.468 116.939 99.0737 122.242 100.233C120.264 124.935 108.662 128.946 98.4405 129.507Z",fill:i}),t[0]=i,t[1]=c):c=t[1];var d;return t[2]!==l||t[3]!==c?(d=s.jsx("svg",{"aria-label":u,height:l,role:"img",viewBox:"0 0 192 192",width:l,xmlns:"http://www.w3.org/2000/svg",children:c}),t[2]=l,t[3]=c,t[4]=d):d=t[4],d}l.default=c}),98);
__d("PolarisTextInput.react",["cx","getTextDirection","joinClasses","react"],(function(t,n,r,o,a,i,l,s){"use strict";var e=["className","type","value"],u,c=u||(u=o("react")),d=(function(t){function n(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,e.$1=c.createRef(),babelHelpers.assertThisInitialized(e)||babelHelpers.assertThisInitialized(e)}babelHelpers.inheritsLoose(n,t);var o=n.prototype;return o.blur=function(){this.$1.current!=null&&this.$1.current.blur()},o.focus=function(){this.$1.current!=null&&this.$1.current.focus()},o.select=function(){this.$1.current!=null&&this.$1.current.select()},o.render=function(){var t,n=this.props,o=n.className,a=n.type,i=n.value,l=babelHelpers.objectWithoutPropertiesLoose(n,e),s=r("joinClasses")(o,"_ac4d","_ap35"),u=a==="text"?r("getTextDirection")((t=i==null?void 0:i.toString())!=null?t:""):void 0;return c.jsx("input",babelHelpers.extends({},l,{className:s,dir:u,ref:this.$1,type:a,value:i}))},n})(c.Component);d.defaultProps={type:"text"},l.default=d}),98);
__d("PolarisLabeledTextInput.react",["cx","PolarisTextInput.react","react"],(function(t,n,r,o,a,i,l,s){"use strict";var e=["isInputFocused","isRedesignedSignupFieldInput","onInput","placeholder","slimTextInputCol"],u,c=u||(u=o("react")),d=(function(t){function n(e){var n;return n=t.call(this)||this,n.$4=function(e){var t=e.currentTarget;n.$3(t.value),n.props.onInput&&n.props.onInput(e)},n.state={hasContent:!!e.value},n}babelHelpers.inheritsLoose(n,t),n.getDerivedStateFromProps=function(t,r){return n.$2(t.value||"",r)},n.$2=function(t,n){return t.length>0&&!n.hasContent?{hasContent:!0}:t.length===0?{hasContent:!1}:null};var o=n.prototype;return o.$3=function(t){var e=n.$2(t,this.state);e!==null&&this.setState(e)},o.$5=function(){return this.props.id!=null?this.props.id:void 0},o.blur=function(){this.$1&&this.$1.blur()},o.focus=function(){this.$1&&this.$1.focus()},o.select=function(){this.$1&&this.$1.select()},o.render=function(){var t=this,n=this.props,o=n.isInputFocused,a=n.isRedesignedSignupFieldInput,i=n.onInput,l=n.placeholder,s=n.slimTextInputCol,u=babelHelpers.objectWithoutPropertiesLoose(n,e);return c.jsxs("label",{className:"_aa48"+(this.state.hasContent||o?" _aa49":"")+(a?" _aues":""),htmlFor:this.$5(),children:[c.jsx("span",{className:"_aa4a",children:l}),c.jsx(r("PolarisTextInput.react"),babelHelpers.extends({},u,{className:"_aa4b"+(s?" _add6":"")+(a?" _auet":""),id:this.$5(),onInput:this.$4,ref:function(n){return t.$1=n}}))]})},n})(c.Component);l.default=d}),98);
__d("PolarisSlimTextInput.react",["fbt","PolarisIGCoreButton.react","PolarisLabeledTextInput.react","react","stylex"],(function(t,n,r,o,a,i,l,s){"use strict";var e=["accepted","canRefresh","className","disabled","errorMessage","hasError","isPasswordHidden","isRedesignedSignupFieldInput","omitErrorMarginBottom","onFocus","onPasswordToggle","onRefresh","showPasswordToggleLink"],u,c,d=c||(c=o("react")),m={disabled:{backgroundColor:"x19g9edo",color:"x1roi4f4",$$css:!0},inputError:{borderTopColor:"xplnoro",borderInlineEndColor:"x1mrmp0p",borderBottomColor:"x11j5czd",borderInlineStartColor:"x1d24mgy",borderTopStyle:"x13fuv20",borderInlineEndStyle:"x18b5jzi",borderBottomStyle:"x1q0q8m5",borderInlineStartStyle:"x1t7ytsu",borderTopWidth:"x178xt8z",borderInlineEndWidth:"x1lun4ml",borderBottomWidth:"xso031l",borderInlineStartWidth:"xpilrb4",$$css:!0},inputFocused:{borderTopColor:"x11f1dot",borderInlineEndColor:"x1lpj336",borderBottomColor:"x1ii8w9m",borderInlineStartColor:"x1c5q3k4",borderTopStyle:"x13fuv20",borderInlineEndStyle:"x18b5jzi",borderBottomStyle:"x1q0q8m5",borderInlineStartStyle:"x1t7ytsu",borderTopWidth:"x178xt8z",borderInlineEndWidth:"x1lun4ml",borderBottomWidth:"xso031l",borderInlineStartWidth:"xpilrb4",$$css:!0},redesigned:{backgroundColor:"x7r02ix",borderTopColor:"x1yvgwvq",borderInlineEndColor:"xjd31um",borderBottomColor:"x1ixjvfu",borderInlineStartColor:"xwt6s21",borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",$$css:!0},redesignedFocused:{borderTopColor:"x19gtwsn",borderInlineEndColor:"xhpglom",borderBottomColor:"x1xp9za0",borderInlineStartColor:"x1fqc88y",$$css:!0},root:{alignItems:"x6s0dn4",backgroundColor:"xnz67gz",borderTopColor:"x19gtwsn",borderInlineEndColor:"xhpglom",borderBottomColor:"x1xp9za0",borderInlineStartColor:"x1fqc88y",borderStartStartRadius:"x1fqc64z",borderStartEndRadius:"xs83zq4",borderEndEndRadius:"xt6ovg4",borderEndStartRadius:"x1ru8ea5",borderTopStyle:"x13fuv20",borderInlineEndStyle:"x18b5jzi",borderBottomStyle:"x1q0q8m5",borderInlineStartStyle:"x1t7ytsu",borderTopWidth:"x178xt8z",borderInlineEndWidth:"x1lun4ml",borderBottomWidth:"xso031l",borderInlineStartWidth:"xpilrb4",boxSizing:"x9f619",color:"x5n08af",display:"x78zum5",flexDirection:"x1q0g3np",fontSize:"xvs91rp",position:"x1n2onr6",width:"xh8yej3",$$css:!0}},p=(function(t){function n(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,e.state={inputFocused:!1},e.$2=function(t){e.props.onFocus&&e.props.onFocus(t),e.setState({inputFocused:!0})},e.$3=function(){e.setState({inputFocused:!1})},babelHelpers.assertThisInitialized(e)||babelHelpers.assertThisInitialized(e)}babelHelpers.inheritsLoose(n,t);var o=n.prototype;return o.$4=function(){var e=this.props,t=e.accepted,n=e.canRefresh,r=e.hasError,o=e.showPasswordToggleLink,a=[];return t===!0?a.push(d.jsx("span",{className:"xo3uz88 x1twbzvy xiy17q3 x17rw0jw x17z2i9w xnsbi7g x1quspbi xermsev x972fbf x10w94by x1qhh985 x14e42zd xjb2p0i xk390pu xdj266r x14z9mp xat24cr x13fj5qh xexx8yu xyri2b x18d9i69 x1c1uobl x11njtxf"},"accepted")):r===!0&&a.push(d.jsx("span",{className:"xo3uz88 x1nxxyus xiy17q3 x17rw0jw x17z2i9w xnsbi7g x1mb7f8p xermsev x972fbf x10w94by x1qhh985 x14e42zd xjb2p0i xk390pu xdj266r x14z9mp xat24cr x13fj5qh xexx8yu xyri2b x18d9i69 x1c1uobl x11njtxf"},"error")),o===!0&&a.push(this.$5()),n===!0&&a.push(this.$6()),a},o.$6=function(){return d.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x13fj5qh x1n2onr6",children:d.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:this.props.onRefresh,children:d.jsx("span",{className:"xo3uz88 xcdibw7 xiy17q3 x17rw0jw x1kl0l3y xnsbi7g x1hu2l8e xermsev x1lliihq x6ikm8r x10wlt62 xevxmoj xuxw1ft",children:s._(/*BTDS*/"Actualizar sugerencia")})})},"refresh")},o.$5=function(){var e=this.props.isPasswordHidden;return d.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x13fj5qh x1n2onr6",children:d.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,color:"ig-secondary-button",onClick:this.props.onPasswordToggle,children:e===!0?s._(/*BTDS*/"Mostrar"):s._(/*BTDS*/"Ocultar")})},"toggle-password")},o.$7=function(){var e,t;return(e=(t=this.props).onError)==null||e.call(t),d.jsx("div",babelHelpers.extends({},{0:{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 xxk16z8 x78zum5 xdt5ytf x2lah0s x1fhwpqd x1gslohp x14z9mp xat24cr x13fj5qh xexx8yu xyri2b x18d9i69 x1c1uobl x1n2onr6 x11njtxf"},1:{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 xxk16z8 x78zum5 xdt5ytf x2lah0s x1fhwpqd x1gslohp x14z9mp x13fj5qh xexx8yu xyri2b x18d9i69 x1c1uobl x1n2onr6 x11njtxf x1e56ztr"}}[(this.props.omitErrorMarginBottom!==!0)<<0],{children:this.props.errorMessage}))},o.render=function(){var t=this,n=this.props,o=n.accepted,a=n.canRefresh,i=n.className,l=n.disabled,s=n.errorMessage,c=n.hasError,p=n.isPasswordHidden,_=n.isRedesignedSignupFieldInput,f=n.omitErrorMarginBottom,g=n.onFocus,h=n.onPasswordToggle,y=n.onRefresh,C=n.showPasswordToggleLink,b=babelHelpers.objectWithoutPropertiesLoose(n,e),v=this.state.inputFocused,S=c===!0&&s!=null&&s!=="",R=this.$4(),L=(u||(u=r("stylex")))(m.root,_===!0&&m.redesigned,v&&_!==!0&&m.inputFocused,v&&_===!0&&m.redesignedFocused,S&&m.inputError,!!l&&m.disabled);return d.jsxs("div",{className:i,children:[d.jsxs("div",{className:L,children:[d.jsx(r("PolarisLabeledTextInput.react"),babelHelpers.extends({},b,{disabled:l,isInputFocused:v&&!!this.props.isInputFocused,isRedesignedSignupFieldInput:_,onBlur:this.$3,onFocus:this.$2,ref:function(n){return t.$1=n},slimTextInputCol:!0})),d.jsx("div",{className:"x6s0dn4 x972fbf x10w94by x1qhh985 x14e42zd x9f619 x78zum5 xdl72j9 x1q0g3np x1c4vz4f x2lah0s xk390pu x5yr21d xdj266r x14z9mp xat24cr x1lziwak xexx8yu x18d9i69 x1c1uobl xf159sx x1n2onr6 xxymvpz",children:R})]}),S&&this.$7()]})},o.focus=function(){this.$1&&this.$1.focus()},n})(d.Component);l.default=p}),226);
__d("PolarisConsentModal.react",["cx","invariant","FBLogger","IGCoreDialog.react","IGCoreModal.react","IGDSBox.react","IGDSButton.react","IGDSCircleCheckPanoOutlineIcon.react","IGDSLockOutline96Icon.react","IGDSRadioButton.react","IGDSRadioButtonGroup.react","IGDSSpinner.react","PolarisAgeCollectionHelpers","PolarisAuthStrings","PolarisConfirmDialog.react","PolarisConsentActions","PolarisConsentConstants","PolarisConsentLogger","PolarisConsentStrings.react","PolarisConsentTypes","PolarisDOBFieldSelect.react","PolarisDateHelpers","PolarisExternalLink.react","PolarisExternalRoutes","PolarisGenericStrings","PolarisIGCoreModalHeader.react","PolarisIsLoggedIn","PolarisNavigationUtils","PolarisReactRedux.react","PolarisSlimTextInput.react","PolarisUA","emptyFunction","isStringNullOrEmpty","joinClasses","nullthrows","react","react-compiler-runtime","vulture"],(function(t,n,r,o,a,i,l,s,u){"use strict";var e=["optional_paragraphs","paragraphs"],c=["screenKey"],d,m=d||(d=o("react"));function p(e){return{entry_point:r("nullthrows")(e.entrypointType),module:"instagram_terms_flow",session_id:r("nullthrows")(e.sessionId),user_state:e.isNewUserFlow?"new":"existing"}}function _(e){var t=o("react-compiler-runtime").c(5),n=e.style,r=e.text;switch(n){case"bulletpoint":{var a;t[0]===Symbol.for("react.memo_cache_sentinel")?(a={className:"x1roi4f4 x1fhwpqd xtaz4m5 xdj266r x11t971q x1e56ztr xyqm7xq xexx8yu xyri2b x18d9i69 x1c1uobl x11njtxf"},t[0]=a):a=t[0];var i;return t[1]!==r?(i=m.jsx("ul",babelHelpers.extends({},a,{children:m.jsx("li",{children:r})})),t[1]=r,t[2]=i):i=t[2],i}case"paragraph":default:{var l;return t[3]!==r?(l=m.jsx("span",{className:"_aa6o",children:r}),t[3]=r,t[4]=l):l=t[4],l}}}function f(e){var t=o("react-compiler-runtime").c(4),n=e.buttonText,a=e.disabled,i=e.onClick,l=!!a,s;return t[0]!==n||t[1]!==i||t[2]!==l?(s=m.jsx(r("IGDSBox.react"),{margin:3,position:"relative",children:m.jsx(r("IGDSButton.react"),{fullWidth:!0,isDisabled:l,label:n,onClick:i,size:"large"})}),t[0]=n,t[1]=i,t[2]=l,t[3]=s):s=t[3],s}function g(e){var t=o("react-compiler-runtime").c(15),n=e.bodyWrapperClass,a=e.consent_key,i=e.headline,l=e.paragraphs,s;t[0]!==i?(s=m.jsx("header",{className:"_aa6p",children:i}),t[0]=i,t[1]=s):s=t[1];var u;t[2]!==n?(u=r("joinClasses")("_aa6q",n),t[2]=n,t[3]=u):u=t[3];var c;if(t[4]!==a||t[5]!==l){var d;t[7]!==a?(d=function(t,n){return m.createElement(_,babelHelpers.extends({},t,{key:a+".paragraph."+n}))},t[7]=a,t[8]=d):d=t[8],c=l.map(d),t[4]=a,t[5]=l,t[6]=c}else c=t[6];var p;t[9]!==u||t[10]!==c?(p=m.jsx("div",{className:u,children:c}),t[9]=u,t[10]=c,t[11]=p):p=t[11];var f;return t[12]!==s||t[13]!==p?(f=m.jsxs(m.Fragment,{children:[s,p]}),t[12]=s,t[13]=p,t[14]=f):f=t[14],f}function h(e){var t=o("react-compiler-runtime").c(8),n=e.handleOpenHelpCenter,r=e.handleOtherOptionsExit,a;t[0]!==n?(a=m.jsx(o("IGCoreDialog.react").IGCoreDialogItem,{onClick:n,children:o("PolarisConsentStrings.react").OPEN_HELP_CENTER_TITLE}),t[0]=n,t[1]=a):a=t[1];var i;t[2]!==r?(i=m.jsx(o("IGCoreDialog.react").IGCoreDialogItem,{onClick:r,children:o("PolarisGenericStrings").CANCEL_TEXT}),t[2]=r,t[3]=i):i=t[3];var l;return t[4]!==r||t[5]!==a||t[6]!==i?(l=m.jsxs(o("IGCoreDialog.react").IGCoreDialog,{onModalClose:r,children:[a,i]}),t[4]=r,t[5]=a,t[6]=i,t[7]=l):l=t[7],l}var y="ageBucketSection",C=[o("PolarisConsentTypes").ConsentScreenKeys.TOS,o("PolarisConsentTypes").ConsentScreenKeys.TOS_AND_TWO_AGE_BUTTON,o("PolarisConsentTypes").ConsentScreenKeys.TOS_AND_THREE_AGE_BUTTON],b=[o("PolarisConsentTypes").ConsentScreenKeys.TOS_AND_THREE_AGE_BUTTON,o("PolarisConsentTypes").ConsentScreenKeys.AGE_CONSENT_THREE_BUTTON],v=(function(t){function n(){for(var e,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a))||this,e.state={ageBucket:null,parentalConsentEntered:!1,showAgeUnderageConfirm:!1,showCloseConfirm:!1,showDobUnderageConfirm:!1,showOtherOptionsMenu:!1},e.onClose=function(){e.$2("dismiss"),e.setState({showAgeUnderageConfirm:!1,showCloseConfirm:!1,showDobUnderageConfirm:!1,showOtherOptionsMenu:!1}),e.props.onCloseModal(),o("PolarisUA").isMobile()&&document.body!=null&&(document.body.style.overflow="auto")},e.$3=function(){e.props.screenKey===o("PolarisConsentTypes").ConsentScreenKeys.FINISHED||e.props.screenKey===o("PolarisConsentTypes").ConsentScreenKeys.ALREADY_FINISHED||e.props.screenKey===o("PolarisConsentTypes").ConsentScreenKeys.PARENTAL_CONSENT?e.onClose():e.setState({showCloseConfirm:!0})},e.$4=function(){e.setState({showCloseConfirm:!1})},e.$5=function(t){e.props.onDobFieldChange(t)},e.$6=function(t){var n=t.target;n instanceof HTMLInputElement&&e.props.onEmailFieldChange(n.value)},e.$7=function(t){e.setState({ageBucket:t})},e.$8=function(){e.setState({showOtherOptionsMenu:!0})},e.$9=function(){e.setState({showOtherOptionsMenu:!1})},e.$10=function(){o("PolarisNavigationUtils").openURLWithFullPageReload(o("PolarisConsentConstants").OTHER_OPTIONS_LINK,{openInNewTab:!0}),e.$2("link_click",{click_point:o("PolarisConsentConstants").OTHER_OPTIONS_LINK}),e.setState({showOtherOptionsMenu:!1})},e.$11=function(){e.$2("next"),e.setState({parentalConsentEntered:!0})},e.$12=function(t){t.preventDefault(),e.state.ageBucket===o("PolarisConsentTypes").ConsentAgeBuckets.UNDER_13&&e.props.screenKey!=null&&b.includes(e.props.screenKey)&&!e.props.isNewUserFlow?(e.$2("next",{age_selection:r("nullthrows")(e.state.ageBucket)}),e.setState({showAgeUnderageConfirm:!0})):e.$13()},e.$13=function(){var t={};e.props.screenKey!=null&&C.includes(e.props.screenKey)&&(t[o("PolarisConsentTypes").ConsentKeys.TOS_CONSENT_KEY]=o("PolarisConsentTypes").ConsentStates.CONSENTED),e.props.screenKey!==o("PolarisConsentTypes").ConsentScreenKeys.TOS&&(t[o("PolarisConsentTypes").ConsentKeys.AGE_CONSENT_KEY]=e.state.ageBucket===o("PolarisConsentTypes").ConsentAgeBuckets.ABOVE_18?o("PolarisConsentTypes").ConsentStates.CONSENTED:e.state.ageBucket===o("PolarisConsentTypes").ConsentAgeBuckets.UNDER_13?o("PolarisConsentTypes").ConsentStates.BLOCKING:o("PolarisConsentTypes").ConsentStates.WITHDRAWN),e.props.onUpdateConsent(t),e.$2("next",{age_selection:e.state.ageBucket}),e.setState({showAgeUnderageConfirm:!1})},e.$14=function(){e.$2("cancel",{age_selection:r("nullthrows")(e.state.ageBucket)}),e.setState({showAgeUnderageConfirm:!1})},e.$15=function(){var t;e.$2("next"),e.props.onUpdateConsent((t={},t[o("PolarisConsentTypes").ConsentKeys.EXISTING_USER_CONSENT_KEY]=o("PolarisConsentTypes").ConsentStates.CONSENTED,t))},e.$16=function(t){t.preventDefault();var n=new Date,a=new Date(n.getFullYear()-o("PolarisConsentConstants").MIN_INSTAGRAM_AGE,n.getMonth(),n.getDate()),i=o("PolarisDateHelpers").dateTypeToDate(r("nullthrows")(e.props.dob.value)),l=o("PolarisDateHelpers").dateTypeToIsoStringForLogging(r("nullthrows")(e.props.dob.value));i>=a&&e.props.screenKey===o("PolarisConsentTypes").ConsentScreenKeys.DOB&&!e.props.isNewUserFlow?(e.$2("next",{age_selection:l}),e.setState({showDobUnderageConfirm:!0})):e.$17()},e.$17=function(t){t&&t.preventDefault(),e.props.dob.value||u(0,63795);var n=o("PolarisDateHelpers").dateTypeToIsoStringForLogging(e.props.dob.value);e.setState({showDobUnderageConfirm:!1}),e.$2("next",{age_selection:n}),e.props.onUpdateDob(r("nullthrows")(e.props.dob.value))},e.$18=function(){e.props.dob.value||u(0,63795);var t=o("PolarisDateHelpers").dateTypeToIsoStringForLogging(e.props.dob.value);e.$2("cancel",{age_selection:t}),e.setState({showDobUnderageConfirm:!1})},e.$19=function(){e.$2("next"),e.props.email.value!=null||u(0,63796),e.props.onSendParentalConsentEmail(e.props.email.value)},e.$20=function(){e.$2("link_click",{click_point:o("PolarisExternalRoutes").NEW_LEGAL_TERMS_PATH})},e.$21=function(){e.$2("link_click",{click_point:o("PolarisExternalRoutes").INSTAGRAM_PRIVACY_POLICY_PATH})},e.$22=function(){var t,n=(t=e.props.redirectUrl)!=null?t:"/";e.onClose(),o("PolarisNavigationUtils").openURLWithFullPageReload(n)},e.$31=function(){e.$2("skip"),e.props.onSkipParentalConsent()},babelHelpers.assertThisInitialized(e)||babelHelpers.assertThisInitialized(e)}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.componentDidUpdate=function(t,n){(this.props.screenKey&&t.screenKey!==this.props.screenKey||this.state.parentalConsentEntered!==n.parentalConsentEntered)&&o("PolarisConsentLogger").logConsentView(babelHelpers.extends({},p(this.props),{stage:this.$1()}))},a.$1=function(){return this.state.showDobUnderageConfirm?"dob_dialog":this.state.showAgeUnderageConfirm?"age_dialog":this.state.showCloseConfirm?"dismiss_dialog":this.props.screenKey===o("PolarisConsentTypes").ConsentScreenKeys.PARENTAL_CONSENT?this.state.parentalConsentEntered?"parental_contact":"parental_approval":this.props.screenKey===o("PolarisConsentTypes").ConsentScreenKeys.UNDER_13?"underage":this.props.screenKey===o("PolarisConsentTypes").ConsentScreenKeys.ALREADY_FINISHED?o("PolarisConsentTypes").ConsentScreenKeys.FINISHED:r("nullthrows")(this.props.screenKey)},a.$2=function(t,n){var e=this.$1(),r={};(n==null?void 0:n.age_selection)!=null&&(r.age_selection=n.age_selection),(n==null?void 0:n.click_point)!=null&&(r.click_point=n.click_point),o("PolarisConsentLogger").logConsentAction(babelHelpers.extends({},p(this.props),{action:t,stage:e},r))},a.$23=function(){var t=r("nullthrows")(this.props.consents[o("PolarisConsentTypes").ConsentKeys.TOS_CONSENT_KEY]),n=t.optional_paragraphs,a=t.paragraphs,i=babelHelpers.objectWithoutPropertiesLoose(t,e),l=[].concat(a);return this.state.ageBucket&&this.state.ageBucket!==o("PolarisConsentTypes").ConsentAgeBuckets.ABOVE_18&&n&&n.length>0&&l.splice(1,0,n[0]),m.jsxs("div",{children:[m.jsx(g,babelHelpers.extends({paragraphs:l},i)),this.props.tosVersion===o("PolarisConsentTypes").TosVersion.EU?m.jsx("div",{className:"_aa6r",children:m.jsx(r("PolarisExternalLink.react"),{href:o("PolarisExternalRoutes").NEW_LEGAL_TERMS_PATH,onClick:this.$20,children:o("PolarisConsentStrings.react").TERMS_LINK_TEXT})}):m.jsx("div",{className:"_aa6s",children:m.jsx(o("PolarisConsentStrings.react").RowTermsPrivacyPolicyLinkTextFixed,{linkClassName:"_aa6t"})})]})},a.$24=function(){return m.jsxs("div",{id:y,children:[m.jsx(g,babelHelpers.extends({},this.props.consents[o("PolarisConsentTypes").ConsentKeys.AGE_CONSENT_KEY])),m.jsxs(r("IGDSRadioButtonGroup.react"),{name:"ageRadio",onChange:this.$7,selectedValue:this.state.ageBucket,children:[m.jsx(r("IGDSRadioButton.react"),{label:o("PolarisConsentStrings.react").DOB_ABOVE_18_RADIO_OPTION,value:o("PolarisConsentTypes").ConsentAgeBuckets.ABOVE_18}),m.jsx(r("IGDSRadioButton.react"),{label:o("PolarisConsentStrings.react").DOB_UNDER_18_RADIO_OPTION,value:o("PolarisConsentTypes").ConsentAgeBuckets.UNDER_18})]})]})},a.$25=function(){var e;return m.jsxs("div",{id:y,children:[m.jsx(g,babelHelpers.extends({},this.props.consents[(e=o("PolarisConsentTypes")).ConsentKeys.AGE_CONSENT_KEY])),m.jsxs(r("IGDSRadioButtonGroup.react"),{name:"ageRadio",onChange:this.$7,selectedValue:this.state.ageBucket,children:[m.jsx(r("IGDSRadioButton.react"),{label:o("PolarisConsentStrings.react").DOB_ABOVE_18_RADIO_OPTION,value:e.ConsentAgeBuckets.ABOVE_18}),m.jsx(r("IGDSRadioButton.react"),{label:o("PolarisConsentStrings.react").DOB_13_18_RADIO_OPTION,value:e.ConsentAgeBuckets.TEEN_13_18}),m.jsx(r("IGDSRadioButton.react"),{label:o("PolarisConsentStrings.react").DOB_UNDER_13_RADIO_OPTION,value:e.ConsentAgeBuckets.UNDER_13})]})]})},a.$26=function(){return m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 x78zum5 xdt5ytf x1iyjqo2 xs83m0k xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xw2csxc x1odjw0f x1p5oq8j xv54qhq xwxc41k xf7dkkf x1n2onr6 x11njtxf",children:[m.jsx(g,babelHelpers.extends({},this.props.consents[o("PolarisConsentTypes").ConsentKeys.EXISTING_USER_CONSENT_KEY],{bodyWrapperClass:"_aa6v"})),m.jsx("div",{className:"_aa6r",children:m.jsx(r("PolarisExternalLink.react"),{href:o("PolarisExternalRoutes").INSTAGRAM_PRIVACY_POLICY_PATH,onClick:this.$21,children:o("PolarisConsentStrings.react").PRIVACY_POLICY_LINK_TEXT})})]}),m.jsx("div",{className:"_aa6w",children:m.jsx(f,{buttonText:this.props.primaryButtonText,disabled:this.props.isUpdating,onClick:this.$15})})]})},a.$27=function(){var e=this.props.screenKey===o("PolarisConsentTypes").ConsentScreenKeys.TOS_AND_TWO_AGE_BUTTON,t=this.props.screenKey===o("PolarisConsentTypes").ConsentScreenKeys.TOS_AND_THREE_AGE_BUTTON,n=!(e||t)||!!this.state.ageBucket,r=o("PolarisConsentStrings.react").OtherOptionsFooter,a=o("PolarisConsentStrings.react").SelectYourAgeFooter;return m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 x78zum5 xdt5ytf x1iyjqo2 xs83m0k xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xw2csxc x1odjw0f x1p5oq8j xv54qhq xwxc41k xf7dkkf x1n2onr6 x11njtxf",children:[e&&this.$24(),t&&this.$25(),(e||t)&&m.jsx("hr",{className:"_aa6x"}),this.$23()]}),m.jsxs("div",{className:"_aa6w",children:[m.jsx(f,{buttonText:this.props.primaryButtonText,disabled:this.props.isUpdating||!n,onClick:this.$12}),m.jsx("span",{className:"_aa6y",children:n?m.jsx(r,{linkClassName:"_aa6z",otherOptionsClick:this.$8}):m.jsx(a,{ageAnchorLink:"#"+y,linkClassName:"_aa6z",otherOptionsClick:this.$8})})]})]})},a.$28=function(){var e=this.props.screenKey===o("PolarisConsentTypes").ConsentScreenKeys.AGE_CONSENT_TWO_BUTTON,t=this.props.screenKey===o("PolarisConsentTypes").ConsentScreenKeys.AGE_CONSENT_THREE_BUTTON;return m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 x78zum5 xdt5ytf x1iyjqo2 xs83m0k xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xw2csxc x1odjw0f x1p5oq8j xv54qhq xwxc41k xf7dkkf x1n2onr6 x11njtxf",children:[e&&this.$24(),t&&this.$25()]}),m.jsx("div",{className:"_aa6w",children:m.jsx(f,{buttonText:this.props.primaryButtonText,disabled:this.props.isUpdating||!this.state.ageBucket,onClick:this.$12})})]})},a.$29=function(){var e=this.props.dob.dirty?"":this.props.dob.errorMessage;return this.props.dob||u(0,63795),m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 x78zum5 xdt5ytf x1iyjqo2 xs83m0k xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xw2csxc x1odjw0f x1p5oq8j xv54qhq xwxc41k xf7dkkf x1n2onr6 x11njtxf",children:[m.jsx(g,babelHelpers.extends({},this.props.consents[o("PolarisConsentTypes").ConsentKeys.DOB_CONSENT_KEY])),m.jsx("div",{className:"x78zum5 xdt5ytf",children:m.jsx(r("PolarisDOBFieldSelect.react"),{className:"x6s0dn4 x78zum5 xqui205 x1ys307a x1hq5gj4 xyqm7xq",date:r("nullthrows")(this.props.dob.value),errorMessage:e,onDateChange:this.$5})})]}),m.jsx("div",{className:"_aa6w",children:m.jsx(f,{buttonText:this.props.primaryButtonText,disabled:this.props.isUpdating,onClick:this.$16})})]})},a.$30=function(){var e=this.props,t=e.isBlockedFromCreatingAccount,n=e.isNewUserFlow,a=e.screenKey;switch(!0){case(t||a===o("PolarisConsentTypes").ConsentScreenKeys.UNDER_13):return o("PolarisConsentStrings.react").NEW_USER_UNDER_13_TITLE;case n:return r("vulture")("ETM0w4Ob5VqxElT7MwPQ4hOLMZw="),o("PolarisConsentStrings.react").NEW_USER_DOB_HEADER;case a===o("PolarisConsentTypes").ConsentScreenKeys.PARENTAL_CONSENT:return o("PolarisConsentStrings.react").PARENTAL_CONSENT_MODAL_HEADER;default:return o("PolarisConsentStrings.react").MODAL_HEADER}},a.$32=function(){if(!this.state.parentalConsentEntered)return m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 x78zum5 xdt5ytf x1iyjqo2 xs83m0k xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xw2csxc x1odjw0f x1p5oq8j xv54qhq xwxc41k xf7dkkf x1n2onr6 x11njtxf",children:m.jsx(g,babelHelpers.extends({},r("nullthrows")(this.props.consents[o("PolarisConsentTypes").ConsentKeys.PARENTAL_CONSENT_INTRO_KEY])))}),m.jsxs("div",{className:"_aa6w",children:[m.jsx(f,{buttonText:o("PolarisConsentStrings.react").GET_APPROVAL_BUTTON_SHORT_TEXT,disabled:!1,onClick:this.$11}),m.jsx(f,{buttonText:o("PolarisConsentStrings.react").SKIP_PARENTAL_CONSENT_BUTTON_TEXT,disabled:!1,onClick:this.$31})]})]});var e=this.props.email.dirty?"":this.props.email.errorMessage;return m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 x78zum5 xdt5ytf x1iyjqo2 xs83m0k xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xw2csxc x1odjw0f x1p5oq8j xv54qhq xwxc41k xf7dkkf x1n2onr6 x11njtxf",children:[m.jsx(g,babelHelpers.extends({},r("nullthrows")(this.props.consents[o("PolarisConsentTypes").ConsentKeys.PARENTAL_CONSENT_EMAIL_KEY]))),m.jsx(r("PolarisSlimTextInput.react"),{"aria-describedby":o("PolarisAuthStrings").EMAIL,"aria-label":o("PolarisAuthStrings").EMAIL,"aria-required":"true",autoCapitalize:"off",autoCorrect:"off",errorMessage:e,hasError:!!e,name:"email",onChange:this.$6,placeholder:o("PolarisAuthStrings").EMAIL,showInlineError:!0,value:this.props.email.value})]}),m.jsx("div",{className:"_aa6w",children:m.jsx(f,{buttonText:o("PolarisConsentStrings.react").PARENTAL_CONSENT_SEND_BUTTON_TEXT,disabled:this.props.isUpdating||r("isStringNullOrEmpty")(this.props.email.value)||!!e,onClick:this.$19})})]})},a.$33=function(){return m.jsxs(m.Fragment,{children:[m.jsx(r("IGDSBox.react"),{alignItems:"center",marginBottom:10,marginTop:10,position:"relative",children:m.jsx(r("IGDSLockOutline96Icon.react"),{alt:o("PolarisConsentStrings.react").BLOCK_UNDER_13_TITLE,size:96})}),m.jsx("div",{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 x78zum5 x1r8uery xdt5ytf x1iyjqo2 xs83m0k xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl x1n2onr6 x2b8uid x11njtxf",children:m.jsx(_,{style:"paragraph",text:o("PolarisConsentStrings.react").NEW_USER_UNDER_13_BODY})}),m.jsx("div",{className:"_aa6w",children:m.jsx(f,{buttonText:o("PolarisConsentStrings.react").NEW_USER_UNDER_13_CONFIRMATION,disabled:!1,onClick:this.onClose})})]})},a.$34=function(){return m.jsxs(m.Fragment,{children:[m.jsx(r("IGDSBox.react"),{alignItems:"center",marginBottom:10,marginTop:10,children:m.jsx(r("IGDSCircleCheckPanoOutlineIcon.react"),{alt:"",size:62})}),m.jsxs("div",{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 x78zum5 xdt5ytf x1iyjqo2 xs83m0k xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xw2csxc x1odjw0f x1p5oq8j xv54qhq xwxc41k xf7dkkf x1n2onr6 x11njtxf",children:[m.jsx("header",{className:"_aa6p",children:o("PolarisConsentStrings.react").NOTIFICATION_DONE_HEADLINE}),m.jsx("div",{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 x78zum5 x1r8uery xdt5ytf x1iyjqo2 xs83m0k xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl x1n2onr6 x2b8uid x11njtxf",children:m.jsx("div",{className:"_aa6s",children:m.jsx(o("PolarisConsentStrings.react").NotificationDoneBodyWithLinks,{linkClassName:"_aa6t"})})}),m.jsx(r("IGDSBox.react"),{marginTop:4,position:"relative",children:m.jsx("div",{className:"_aa6w",children:m.jsx(f,{buttonText:o("PolarisConsentStrings.react").CONSENT_FINISHED_SCREEN_BUTTON_TEXT,disabled:!1,onClick:this.$22})})})]})]})},a.renderConsents=function(){if(this.props.isBlockedFromCreatingAccount)return this.$33();switch(this.props.screenKey){case o("PolarisConsentTypes").ConsentScreenKeys.QP_INTRO:return this.$26();case o("PolarisConsentTypes").ConsentScreenKeys.TOS:case o("PolarisConsentTypes").ConsentScreenKeys.TOS_AND_TWO_AGE_BUTTON:case o("PolarisConsentTypes").ConsentScreenKeys.TOS_AND_THREE_AGE_BUTTON:return this.$27();case o("PolarisConsentTypes").ConsentScreenKeys.AGE_CONSENT_TWO_BUTTON:case o("PolarisConsentTypes").ConsentScreenKeys.AGE_CONSENT_THREE_BUTTON:return r("vulture")("UMNkQbZg8055po620OoPANRSsPw="),this.$28();case o("PolarisConsentTypes").ConsentScreenKeys.DOB:return this.$29();case o("PolarisConsentTypes").ConsentScreenKeys.PARENTAL_CONSENT:return this.$32();case o("PolarisConsentTypes").ConsentScreenKeys.UNDER_13:return this.$33();case o("PolarisConsentTypes").ConsentScreenKeys.FINISHED:case o("PolarisConsentTypes").ConsentScreenKeys.ALREADY_FINISHED:return this.$34();default:return r("FBLogger")("ig_web").mustfix("Should not show ConsentModal with unexpected key "+String(this.props.screenKey)),m.jsx("div",{children:o("PolarisConsentStrings.react").CONSENTS_FINISHED_TEXT})}},a.render=function(){if(!this.props.isModalOpen)return null;var e=this.state.showCloseConfirm,t=this.props.screenKey===o("PolarisConsentTypes").ConsentScreenKeys.DOB&&this.state.showDobUnderageConfirm,n=this.props.screenKey!=null&&b.includes(this.props.screenKey)&&this.state.showAgeUnderageConfirm,a=this.props.screenKey!=null&&C.includes(this.props.screenKey)&&this.state.showOtherOptionsMenu,i=t||a?"_aa71":"_aa72",l=this.props.hideExitButton!==!0||this.props.isLoading;o("PolarisUA").isMobile()&&document.body!=null&&(document.body.style.overflow="hidden");var s=this.$30();return m.jsxs(m.Fragment,{children:[m.jsxs(r("IGCoreModal.react"),{"aria-label":s,size:o("PolarisUA").isMobile()?"large":"default",children:[m.jsx(r("PolarisIGCoreModalHeader.react"),{onClose:l?this.$3:void 0,children:s}),this.props.isLoading?m.jsx(r("IGDSBox.react"),{padding:5,position:"relative",children:m.jsx(r("IGDSSpinner.react"),{position:"absolute",size:"medium"})}):this.renderConsents()]}),e&&m.jsx(r("PolarisConfirmDialog.react"),{body:this.props.isNewUserFlow?o("PolarisConsentStrings.react").CLOSE_CONFIRM_BODY_NEW_USER:o("PolarisConsentStrings.react").CLOSE_CONFIRM_BODY,cancelLabel:o("PolarisConsentStrings.react").CLOSE_CONFIRM_LEAVE,className:i,confirmLabel:this.props.isNewUserFlow?o("PolarisConsentStrings.react").CLOSE_CONFIRM_GO_BACK:o("PolarisConsentStrings.react").CLOSE_CONFIRM_KEEP_REVIEWING,onClose:this.onClose,onConfirm:this.$4,onModalClose:r("emptyFunction"),title:o("PolarisConsentStrings.react").CLOSE_CONFIRM_TITLE}),t&&m.jsx(r("PolarisConfirmDialog.react"),{body:o("PolarisConsentStrings.react").dobConfirmAgeText(o("PolarisDateHelpers").getAgeWithOneDayLeeway(r("nullthrows")(this.props.dob.value))),cancelLabel:o("PolarisConsentStrings.react").DOB_CANCEL_AGE_BUTTON_TEXT,className:i,confirmLabel:o("PolarisConsentStrings.react").DOB_CONFIRM_AGE_BUTTON_TEXT,onClose:this.$18,onConfirm:this.$17,title:o("PolarisConsentStrings.react").DOB_CONFIRM_AGE}),n&&m.jsx(r("PolarisConfirmDialog.react"),{body:o("PolarisConsentStrings.react").UNDER_13_CONFIRM_TEXT,cancelLabel:o("PolarisConsentStrings.react").DOB_CANCEL_BUTTON_TEXT,className:i,confirmLabel:o("PolarisConsentStrings.react").DOB_CONFIRM_BUTTON_TEXT,onClose:this.$14,onConfirm:this.$13,title:o("PolarisConsentStrings.react").UNDER_13_CONFIRM_HEADER}),a&&m.jsx(h,{handleOpenHelpCenter:this.$10,handleOtherOptionsExit:this.$9})]})},n})(m.Component);function S(e){var t,n,r=!o("PolarisIsLoggedIn").isLoggedIn(),a=r&&o("PolarisAgeCollectionHelpers").isAgeBlockedFromSignup(),i=e==null||(t=e.consent)==null?void 0:t.dob,l=e==null||(n=e.consent)==null||(n=n.dob)==null?void 0:n.value,s=e.consent,u=s.screenKey,d=babelHelpers.objectWithoutPropertiesLoose(s,c);return babelHelpers.extends({},d,{dob:babelHelpers.extends({},i,{value:l===null?o("PolarisConsentConstants").getInitialDate(o("PolarisConsentConstants").DEFAULT_DATE_YEAR_OFFSET):l}),isBlockedFromCreatingAccount:a,isNewUserFlow:r,screenKey:u})}function R(e){return{onCloseModal:function(){e(o("PolarisConsentActions").closeConsentModal())},onDobFieldChange:function(n){e(o("PolarisConsentActions").dobFieldChange(n))},onEmailFieldChange:function(n){e(o("PolarisConsentActions").parentEmailFieldChange(n))},onSendParentalConsentEmail:function(n){e(o("PolarisConsentActions").sendParentalConsentEmail(n))},onSkipParentalConsent:function(){e(o("PolarisConsentActions").skipParentalConsent())},onUpdateConsent:function(n){e(o("PolarisConsentActions").updateConsent(n))},onUpdateDob:function(n){e(o("PolarisConsentActions").updateConsentDob(n))}}}var L=o("PolarisReactRedux.react").connect(S,R)(v);l.default=L}),98);
__d("usePolarisLoggedInFBUserForHomepage",["PolarisLoggedInFBUserContext","PolarisLoggedOutUpsellExposureV2","PolarisUA","react","usePolarisPageID"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useContext;function u(){var e,t=s(r("PolarisLoggedInFBUserContext")),n=r("usePolarisPageID")();if(o("PolarisUA").isDesktop()){if(n!=="unifiedHome")return null}else return null;return r("PolarisLoggedOutUpsellExposureV2").desktop.enable_fb_connect_v2!==!0?null:(e=t==null?void 0:t.user)!=null?e:null}l.default=u}),98);
__d("PolarisFBConnectV2LoginForm.react",["IGDSButton.react","IGDSText.react","PolarisAuthStrings","PolarisFBConnectHelpers","PolarisLoggedOutCtaClickLogger","PolarisLoggedOutLandingDialogStrings.react","PolarisNavigationReferrerUrlSession","PolarisUserAvatar.react","react","react-compiler-runtime","useCometRouterState","useCurrentRoute","usePolarisLoggedInFBUserForHomepage","usePolarisPageID"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u={primaryButton:{borderStartStartRadius:"x6nl9eh",borderStartEndRadius:"x1a5l9x9",borderEndEndRadius:"x7vuprf",borderEndStartRadius:"x1mg3h75",height:"x5kalc8",paddingTop:"xz9dl7a",paddingInlineEnd:"x1xnnf8n",paddingBottom:"xsag5q8",paddingInlineStart:"x106a9eq",$$css:!0}},c=96;function d(){var e=o("react-compiler-runtime").c(16),t=r("usePolarisLoggedInFBUserForHomepage")(),n=r("usePolarisPageID")(),a=r("useCurrentRoute")(),i=r("useCometRouterState")();if(t==null||t.profile_name==null)return null;var l=t.profile_name,d=t.profile_pic_url,m;e[0]===Symbol.for("react.memo_cache_sentinel")?(m={className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s xl56j7k x1tpxq4b x1y1aw1k xwib8y2 x1mfogq2 xsfy40s xgpatz3 xh8yej3"},e[0]=m):m=e[0];var p;e[1]!==l||e[2]!==d?(p=s.jsx(r("PolarisUserAvatar.react"),{isLink:!1,profilePictureUrl:d,size:c,username:l}),e[1]=l,e[2]=d,e[3]=p):p=e[3];var _;e[4]!==l?(_=o("PolarisLoggedOutLandingDialogStrings.react").continueWithYourFacebookAccount(l),e[4]=l,e[5]=_):_=e[5];var f;e[6]!==_?(f=s.jsx(r("IGDSText.react"),{color:"primaryText",size:"headline3",textAlign:"center",weight:"bold",zeroMargin:!1,children:_}),e[6]=_,e[7]=f):f=e[7];var g;e[8]!==n||e[9]!==(a==null?void 0:a.url)||e[10]!==i?(g=s.jsx(r("IGDSButton.react"),{display:"block",label:o("PolarisAuthStrings").FB_CONTINUE_BUTTON_TEXT,onClick:function(t){var e;t&&t.preventDefault(),o("PolarisLoggedOutCtaClickLogger").logLoggedOutCtaClickEvent("fb_connect","auth_form",n,{isDismissible:!0},"auth_form_fb_connect_v2"),o("PolarisNavigationReferrerUrlSession").setCurrentUrlInformation(i,n),o("PolarisFBConnectHelpers").redirectToFBOAuth((e=a==null?void 0:a.url)!=null?e:"",n)},variant:"primary",xstyle:u.primaryButton}),e[8]=n,e[9]=a==null?void 0:a.url,e[10]=i,e[11]=g):g=e[11];var h;return e[12]!==p||e[13]!==f||e[14]!==g?(h=s.jsxs("div",babelHelpers.extends({},m,{children:[p,f,g]})),e[12]=p,e[13]=f,e[14]=g,e[15]=h):h=e[15],h}l.default=d}),98);
__d("PolarisFacebookAccountPicker.react",["fbt","IGDSButton.react","IGDSText.react","IGDSTextVariants.react","PolarisAuthStrings","PolarisAuthTypeSwitcher.react","PolarisIGCoreConstants","PolarisIGCorePressable.react","PolarisLoginLogger","PolarisReactRedux.react","PolarisUA","PolarisUserAvatar.react","emptyFunction","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react"));function c(e){var t=o("react-compiler-runtime").c(8),n=e.fbConnectedIgProfiles,a=e.onRequestFBLogin,i,l;t[0]===Symbol.for("react.memo_cache_sentinel")?(i={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xyamay9 xv54qhq x1l90r2v xf7dkkf x1n2onr6"},l={className:"x1qjc9v5 x1xp8e9x x5kv4kf xh05dso x13lttk3 x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu x972fbf x10w94by x1qhh985 x14e42zd x9f619 x78zum5 xdt5ytf x2lah0s xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xyri2b x18d9i69 x1c1uobl xz9dl7a x1n2onr6 x11njtxf"},t[0]=i,t[1]=l):(i=t[0],l=t[1]);var s;t[2]!==n||t[3]!==a?(s=u.jsx("div",babelHelpers.extends({},i,{children:u.jsx("div",babelHelpers.extends({},l,{children:u.jsx(d,{fbConnectedIgProfiles:n,onRequestFBLogin:a})}))})),t[2]=n,t[3]=a,t[4]=s):s=t[4];var c;t[5]===Symbol.for("react.memo_cache_sentinel")?(c=o("PolarisUA").isMobile()&&u.jsx("div",{className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1n2onr6",children:u.jsx(r("PolarisAuthTypeSwitcher.react"),{primary:!0})}),t[5]=c):c=t[5];var m;return t[6]!==s?(m=u.jsxs("div",{children:[s,c]}),t[6]=s,t[7]=m):m=t[7],m}function d(e){var t=o("react-compiler-runtime").c(15),n=e.fbConnectedIgProfiles,a=e.onRequestFBLogin,i=o("PolarisReactRedux.react").useSelector(p),l=o("PolarisReactRedux.react").useSelector(m);if(!a||!n)return null;var s;t[0]!==i||t[1]!==l?(s=function(t){return i&&t!==l},t[0]=i,t[1]=l,t[2]=s):s=t[2];var c=s,d;t[3]!==i||t[4]!==l?(d=function(t){return i&&t===l},t[3]=i,t[4]=l,t[5]=d):d=t[5];var _=d,f;if(t[6]!==n||t[7]!==c||t[8]!==_||t[9]!==a){var g;t[11]!==c||t[12]!==_||t[13]!==a?(g=function(t){var e=t.username,n=c(e),i=_(e),l=function(){return a(e)};return u.jsxs(r("PolarisIGCorePressable.react"),{className:"x6s0dn4 x5n08af x1ypdohk x78zum5 x1q0g3np xwhw2v2 xsag5q8",onPress:n?r("emptyFunction"):l,role:"button",tabIndex:0,children:[u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xbmvrgn x1n2onr6",children:u.jsx(r("PolarisUserAvatar.react"),{isLink:!1,profilePictureUrl:t.profilePictureUrl,size:r("PolarisIGCoreConstants").AVATAR_SIZES.small,username:e})}),u.jsx("div",{className:"x9f619 x1lliihq x1iyjqo2 x2lwn1j xeuugli x1n2onr6",children:u.jsx(r("IGDSText.react"),{weight:"semibold",zeroMargin:!1,children:e})}),u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1n2onr6",children:u.jsx(r("IGDSButton.react"),{display:"block",isDisabled:n,isLoading:i,label:o("PolarisAuthStrings").LOG_IN_BUTTON_TEXT,onClick:l})})]},e)},t[11]=c,t[12]=_,t[13]=a,t[14]=g):g=t[14],f=n.map(g),t[6]=n,t[7]=c,t[8]=_,t[9]=a,t[10]=f}else f=t[10];return f}function m(e){return e.auth.login.igUsername}function p(e){return e.auth.login.requestInFlight}function _(e){var t=o("react-compiler-runtime").c(6),n=e.fbConnectedIgProfiles,r=e.onRequestFBLogin;o("PolarisLoginLogger").logLoginEvent({event_name:"account_picker_multi_linked_user_form_load"});var a;t[0]===Symbol.for("react.memo_cache_sentinel")?(a=s._(/*BTDS*/"Puedes iniciar sesi\u00f3n en estas cuentas porque est\u00e1n en el centro de cuentas."),t[0]=a):a=t[0];var i=a,l,d;t[1]===Symbol.for("react.memo_cache_sentinel")?(l={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1n2onr6 xxsgkw5"},d=u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1yztbdb x1xmf6yo xpdmqnj x1g0dm76 x1n2onr6",children:u.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"secondaryText",textAlign:"center",zeroMargin:!1,children:i})}),t[1]=l,t[2]=d):(l=t[1],d=t[2]);var m;return t[3]!==n||t[4]!==r?(m=u.jsxs("div",babelHelpers.extends({},l,{children:[d,u.jsx(c,{fbConnectedIgProfiles:n,onRequestFBLogin:r})]})),t[3]=n,t[4]=r,t[5]=m):m=t[5],m}l.default=_}),226);
__d("PolarisFacebookLoginForm.react",["fbt","IGDSButton.react","PolarisAuthActionConstants","PolarisAuthConstants","PolarisAuthStrings","PolarisIGCoreButton.react","PolarisIGCoreText","PolarisLoggedOutCtaImpressionLogger","PolarisLoginActionConstants","PolarisLoginLogger","XPolarisEmailSignupControllerRouteBuilder","polarisLogAction","react"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.$1=function(e,n){e.preventDefault(),t.props.onSwitchAccountsClick(n)},babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.componentDidMount=function(){r("polarisLogAction")("facebookLoginFormDisplayed"),o("PolarisLoginLogger").logLoginEvent({event_name:"fb_login_form_load",fbconnect_status:this.props.fbConnectStatus,login_type:"fbconnect"}),o("PolarisLoggedOutCtaImpressionLogger").logLoggedOutCtaImpressionEvent("auth_form",this.props.pageID)},n.$2=function(){var e,t;return this.props.errorMessage!=null&&this.props.errorMessage!==""&&(e=this.props.errorMessage,t="xkmlbd1 x1qoy3rc xdj266r xyu1916 xat24cr xbt2mb3 xexx8yu xf159sx xx6bls6 xe2zdcy xxymvpz"),e==null||e===""||e===o("PolarisLoginActionConstants").FB_SSO_DISABLED?null:u.jsx("div",{className:t,children:u.jsx("p",{"aria-atomic":"true",id:"errorAlert",role:"alert",children:e},"message")})},n.$3=function(){var e=this,t=this.props.accountInfo.profilePictureUrl,n=this.props.accountInfo.username,o=this.props.requestInFlight;return u.jsx("div",{className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s xl56j7k x1n2onr6",children:u.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:function(r){return e.props.onRequestLogin(n,r)},children:u.jsx("img",babelHelpers.extends({alt:s._(/*BTDS*/"Foto del perfil de {username}",[s._param("username",n)])},{0:{className:"x1ekkm8c x1143rjc xum4auv xj21bgg x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu x1m2trrv xxy3q5o x119j0k9 x1ynp9ky x1lliihq xln7xf2 xk390pu xpyat2d x1anpbxc x11t971q xyorhqc xvc5jky xexx8yu xyri2b x18d9i69 x1c1uobl x11njtxf x1exxlbk"},1:{className:"x1ekkm8c x1143rjc xum4auv xj21bgg x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu x1m2trrv xxy3q5o x119j0k9 x1ynp9ky x1lliihq xln7xf2 xk390pu xpyat2d x1anpbxc x11t971q xyorhqc xvc5jky xexx8yu xyri2b x18d9i69 x1c1uobl x11njtxf x1exxlbk xz5rk10"}}[!!o<<0],{src:t}))})})},n.render=function(){var e=this,t=this.props.accountInfo,n=s._(/*BTDS*/"Continuar como {username}",[s._param("username",t.username)]);return u.jsxs("div",{className:"x78zum5 xdt5ytf",children:[this.$2(),this.$3(),u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1yztbdb x11t971q xvc5jky xw7yly9 x1n2onr6 x193iq5w x1i9suas x15jlpm9",children:u.jsx(r("PolarisIGCoreButton.react"),{loading:this.props.requestInFlight,onClick:function(r){return e.props.onRequestLogin(t.username,r)},children:u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xv54qhq xf7dkkf x1n2onr6",children:u.jsx(r("PolarisIGCoreText").BodyEmphasized,{color:"web-always-white",display:"truncated",zeroMargin:!0,children:n})})})}),u.jsx("div",{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 x78zum5 xdt5ytf x2lah0s xln7xf2 xk390pu xcxhlts x14z9mp x1fqp7bg x1lziwak xexx8yu xp48ta0 x18d9i69 xtssl2i x1n2onr6 x2b8uid x11njtxf",children:u.jsxs("span",{className:"x972fbf x10w94by x1qhh985 x14e42zd x5n08af xt0psk2 xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl x11njtxf",children:[o("PolarisAuthStrings").notUsernameText(t.username)," ",this.props.pageType===o("PolarisAuthConstants").AuthPageType.Signup?u.jsx(r("IGDSButton.react"),{display:"block",href:r("XPolarisEmailSignupControllerRouteBuilder").buildURL({}),label:s._(/*BTDS*/"Registrarte"),onClick:function(n){return e.$1(n,o("PolarisAuthActionConstants").AUTH.signup)},variant:"primary_link"}):u.jsx(r("IGDSButton.react"),{display:"block",label:s._(/*BTDS*/"Cambiar de cuenta"),onClick:function(n){return e.$1(n,o("PolarisAuthActionConstants").AUTH.login)},variant:"primary_link"})]})})]})},t})(u.Component);l.default=c}),226);
__d("PolarisLandingFormButtonGroup.react",["IGDSText.react","PolarisAuthStrings","PolarisIGCoreButton.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){var t=o("react-compiler-runtime").c(6),n=e.button,a;t[0]===Symbol.for("react.memo_cache_sentinel")?(a={__className:"x5yr21d"},t[0]=a):a=t[0];var i;t[1]!==n.label?(i=s.jsx(r("IGDSText.react"),{color:"primaryButton",weight:"semibold",zeroMargin:!1,children:n.label}),t[1]=n.label,t[2]=i):i=t[2];var l;return t[3]!==n.onClick||t[4]!==i?(l=s.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,dangerouslySetClassName:a,"data-testid":void 0,onClick:n.onClick,children:i}),t[3]=n.onClick,t[4]=i,t[5]=l):l=t[5],l}function c(e){var t=o("react-compiler-runtime").c(12),n=e.buttonEnd,a=e.buttonStart,i;t[0]===Symbol.for("react.memo_cache_sentinel")?(i={className:"xamitd3 x9f619 x1rg5ohu x1c4vz4f x2lah0s x1sy10c2 x1n2onr6"},t[0]=i):i=t[0];var l;t[1]!==a?(l=a&&s.jsx(u,{button:a}),t[1]=a,t[2]=l):l=t[2];var c;t[3]!==n||t[4]!==a?(c=a&&n&&s.jsx("div",{className:"x9f619 x1rg5ohu x1c4vz4f x2lah0s x2fvf9 xdwrcjd x1n2onr6",children:s.jsx(r("IGDSText.react"),{color:"secondaryText",zeroMargin:!1,children:o("PolarisAuthStrings").OR})}),t[3]=n,t[4]=a,t[5]=c):c=t[5];var d;t[6]!==n?(d=n&&s.jsx(u,{button:n}),t[6]=n,t[7]=d):d=t[7];var m;return t[8]!==l||t[9]!==c||t[10]!==d?(m=s.jsxs("div",babelHelpers.extends({},i,{children:[l,c,d]})),t[8]=l,t[9]=c,t[10]=d,t[11]=m):m=t[11],m}function d(e){var t=o("react-compiler-runtime").c(7),n=e.fullWidth,a=e.primaryButton,i=n===void 0?!1:n,l=a.onClick,u;t[0]===Symbol.for("react.memo_cache_sentinel")?(u={className:"xqjyukv x6s0dn4 x9f619 x78zum5 x1q0g3np x1c4vz4f x2lah0s xl56j7k x1n2onr6"},t[0]=u):u=t[0];var c;t[1]!==a.label?(c=s.jsx("div",babelHelpers.extends({},u,{children:a.label})),t[1]=a.label,t[2]=c):c=t[2];var d;return t[3]!==i||t[4]!==a.onClick||t[5]!==c?(d=s.jsx(r("PolarisIGCoreButton.react"),{fullWidth:i,large:!0,onClick:l,children:c}),t[3]=i,t[4]=a.onClick,t[5]=c,t[6]=d):d=t[6],d}function m(e){var t=o("react-compiler-runtime").c(14),n=e.isBrandForwardStyle,r=e.primaryButton,a=e.secondaryButtonEnd,i=e.secondaryButtonStart,l=n===void 0?!1:n,u;t[0]!==l?(u={0:{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x11gldyt x11hdunq xw7yly9 x1n2onr6"},1:{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x11gldyt x11hdunq xw7yly9 x1n2onr6 xexx8yu x64bnmy x18d9i69 x13jy36j xh8yej3"}}[!!l<<0],t[0]=l,t[1]=u):u=t[1];var m;t[2]!==l||t[3]!==r?(m=l?s.jsx("div",{className:"x1wmp3kr x15b4ht x11g16fi xkyum4 x6ikm8r x10wlt62",children:s.jsx(d,{fullWidth:!0,primaryButton:r})}):s.jsx(d,{primaryButton:r}),t[2]=l,t[3]=r,t[4]=m):m=t[4];var p;t[5]!==u||t[6]!==m?(p=s.jsx("div",babelHelpers.extends({},u,{children:m})),t[5]=u,t[6]=m,t[7]=p):p=t[7];var _;t[8]!==a||t[9]!==i?(_=s.jsx(c,{buttonEnd:a,buttonStart:i}),t[8]=a,t[9]=i,t[10]=_):_=t[10];var f;return t[11]!==p||t[12]!==_?(f=s.jsxs(s.Fragment,{children:[p,_]}),t[11]=p,t[12]=_,t[13]=f):f=t[13],f}l.default=m}),98);
__d("PolarisLoggedOutCarouselCard.react",["CometImage.react","IGDSBox.react","PolarisHSnapScroll.react","PolarisStepIndicator.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useState,c={image:{display:"x1lliihq",height:"x5yr21d",width:"x14atkfc",$$css:!0}};function d(e){var t=o("react-compiler-runtime").c(20),n=e.images,a=e.texts,i=u(0),l=i[0],d=i[1],p;t[0]!==l||t[1]!==n.length?(p=function(t){var e=t.startPct,r=Math.round(e),o=Math.max(0,Math.min(r,n.length-1));o!==l&&d(o)},t[0]=l,t[1]=n.length,t[2]=p):p=t[2];var _=p,f;if(t[3]!==n||t[4]!==a){var g;t[6]!==a?(g=function(t,n){return s.jsxs("div",{className:"x6s0dn4 x78zum5 xdt5ytf xl56j7k x1g81zrj xn9wirt",children:[s.jsx("div",{className:"x6s0dn4 x78zum5 xdt5ytf x1vd4hg5 xl56j7k x6ikm8r x10wlt62 x14atkfc",children:s.jsx(r("CometImage.react"),{src:t,xstyle:c.image})}),s.jsx("div",{className:"x1qz8m4s xnh215r xddofbv x1j61x8r xo1l8bm xkds0cx x1ls015a xat24cr xotxm5o x11fxgd9 x2b8uid",children:a[n]||""})]},n)},t[6]=a,t[7]=g):g=t[7],f=n.map(g),t[3]=n,t[4]=a,t[5]=f}else f=t[5];var h=f,y;t[8]===Symbol.for("react.memo_cache_sentinel")?(y={className:"x16nrsnc xdj266r xpwdb9g xat24cr xefazk8 x1n2onr6 xh8yej3"},t[8]=y):y=t[8];var C;t[9]===Symbol.for("react.memo_cache_sentinel")?(C={next:!0,previous:!0},t[9]=C):C=t[9];var b;t[10]!==h||t[11]!==_||t[12]!==n.length?(b=s.jsx(r("PolarisHSnapScroll.react"),{animationDuration:150,enableMouseSwipe:!0,gutterWidth:0,itemCount:n.length,itemWidth:window.innerWidth,onInteract:m,onVisibilityChange:_,pagerDisabled:C,swipeSize:1,children:h}),t[10]=h,t[11]=_,t[12]=n.length,t[13]=b):b=t[13];var v;t[14]!==l||t[15]!==n.length?(v=n.length>1&&s.jsx(r("PolarisStepIndicator.react"),{className:"x6s0dn4 xxzp1fc x1f889gz xrr41r3 xl56j7k x10l6tqk",numSteps:n.length,selectedStep:l,style:"lightContrast"}),t[14]=l,t[15]=n.length,t[16]=v):v=t[16];var S;return t[17]!==b||t[18]!==v?(S=s.jsx(r("IGDSBox.react"),{alignItems:"center",display:"flex",justifyContent:"center",position:"relative",children:s.jsxs("div",babelHelpers.extends({},y,{children:[b,v]}))}),t[17]=b,t[18]=v,t[19]=S):S=t[19],S}function m(){}l.default=d}),98);
__d("XPolarisStarterPackDirectoryControllerRouteBuilder",["jsRouteBuilder"],(function(t,n,r,o,a,i,l){var e=r("jsRouteBuilder")("/list/directory/",Object.freeze({}),void 0),s=e;l.default=s}),98);
__d("usePolarisLOXMobileHomepageDesign",["react-compiler-runtime","usePolarisRouteConfig"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e=o("react-compiler-runtime").c(4),t=r("usePolarisRouteConfig")(),n=t.homepageDesignVariant,a=n==="mweb_branding",i=n!==void 0&&n!=="default",l=n==="mweb_starter_pack",s;return e[0]!==a||e[1]!==i||e[2]!==l?(s={isBrandingDesign:a,isLOXMobileHomepageDesign:i,isStarterPackDesign:l},e[0]=a,e[1]=i,e[2]=l,e[3]=s):s=e[3],s}l.default=e}),98);
__d("PolarisLoggedOutMobileHomeBrandingContent.react",["fbt","ix","IGCoreImage.react","IGDSBox.react","IGDSButton.react","IGDSIgLogoFilledIcon.react","IGDSListCell.react","IGDSText.react","PolarisLandingFormUtils","PolarisLoggedOutCarouselCard.react","PolarisLoggedOutCtaClickLogger","PolarisNavigationUtils","XPolarisStarterPackDirectoryControllerRouteBuilder","react","react-compiler-runtime","usePolarisLOXMobileHomepageDesign","usePolarisPageID","usePolarisRouteConfig"],(function(t,n,r,o,a,i,l,s,u){"use strict";var e,c=e||(e=o("react")),d={joinButton:{paddingInlineEnd:"x64bnmy",paddingInlineStart:"x13jy36j",$$css:!0},starterPackHeader:{backgroundColor:"xvbhtw8",borderBottomColor:"x1bs97v6",borderBottomStyle:"x1q0q8m5",borderBottomWidth:"xso031l",marginTop:"xxhku1v",paddingBottom:"xsag5q8",paddingTop:"xz9dl7a",zIndex:"x1vjfegm",$$css:!0}};function m(e){var t=o("react-compiler-runtime").c(16),n=e.onLogoClick,a;if(t[0]===Symbol.for("react.memo_cache_sentinel")){var i;a=[{images:[u("914477"),u("914478"),u("914479")],texts:[(i=o("PolarisLandingFormUtils")).WATCH_SEND_SHORT_VIDEOS,i.SEE_FRIENDS_CREATORS_UPDATES,i.FIND_SHARE_INTERESTS]},{images:[u("914480"),u("914481"),u("914482")],texts:[i.COMMUNITY_Q_AND_A,i.MATCH_MUSIC_TO_MOMENTS,i.SAVE_CORE_MEMORIES]},{images:[u("914483"),u("914484"),u("914485")],texts:[i.SHARE_WITH_CLOSE_FRIENDS,i.SPARK_DM_CONVERSATIONS,i.DROP_QUICK_NOTES]}],t[0]=a}else a=t[0];var l=a,m=r("usePolarisLOXMobileHomepageDesign")(),_=m.isLOXMobileHomepageDesign,f=r("usePolarisLOXMobileHomepageDesign")(),g=f.isStarterPackDesign,h=r("usePolarisRouteConfig")(),y=h.showBrandingPageWithNav,C=y===!0,b=r("usePolarisPageID")(),v;t[1]!==g||t[2]!==b?(v=g&&c.jsx(r("IGDSBox.react"),{direction:"row",justifyContent:"center",marginBottom:5,position:"sticky",top:!0,xstyle:d.starterPackHeader,children:c.jsx(r("IGDSListCell.react"),{addOnEnd:c.jsx(r("IGDSButton.react"),{display:"block",label:s._(/*BTDS*/"Unirse"),onClick:function(){o("PolarisLoggedOutCtaClickLogger").logLoggedOutCtaClickEvent("open_starter_pack_directory","full_page",b,{isDismissible:!1}),o("PolarisNavigationUtils").openURL(r("XPolarisStarterPackDirectoryControllerRouteBuilder").buildURL({}))},variant:"primary",xstyle:d.joinButton}),content:c.jsx(r("IGDSText.react"),{size:"body",weight:"semibold",zeroMargin:!1,children:"Customize a feed based on your interests when you join."})})}),t[1]=g,t[2]=b,t[3]=v):v=t[3];var S;t[4]!==C||t[5]!==_||t[6]!==n?(S=C||_?c.jsx(r("IGDSBox.react"),{alignItems:"baseline",marginBottom:5,marginTop:2,paddingX:2,children:c.jsx(r("IGDSButton.react"),{icon:c.jsx(r("IGDSIgLogoFilledIcon.react"),{alt:s._(/*BTDS*/"Instagram"),color:"ig-primary-text",size:47}),onClick:n,variant:"tertiary"})}):c.jsx(r("IGDSBox.react"),{alignItems:"baseline",marginBottom:3,paddingX:6,children:c.jsx(r("IGDSIgLogoFilledIcon.react"),{alt:s._(/*BTDS*/"Instagram"),color:"ig-primary-text",size:47})}),t[4]=C,t[5]=_,t[6]=n,t[7]=S):S=t[7];var R;t[8]===Symbol.for("react.memo_cache_sentinel")?(R=s._(/*BTDS*/"Imagen de destino"),t[8]=R):R=t[8];var L;t[9]===Symbol.for("react.memo_cache_sentinel")?(L=c.jsxs(r("IGDSBox.react"),{alignItems:"center",marginBottom:13,marginTop:10,paddingX:6,children:[c.jsx(r("IGCoreImage.react"),{alt:R,"data-testid":void 0,src:{light:u("914486")}}),c.jsx("div",{className:"x1qz8m4s xnh215r x1j61x8r x2b8uid xcg35fi xo1l8bm xmx5zq6 x9d7mpn x14vqqas",children:o("PolarisLandingFormUtils").SHARE_EVERYDAY_MOMENTS_FBT})]}),t[9]=L):L=t[9];var E;t[10]!==v||t[11]!==S?(E=c.jsxs(c.Fragment,{children:[v,S,L]}),t[10]=v,t[11]=S,t[12]=E):E=t[12];var k=E,I;t[13]===Symbol.for("react.memo_cache_sentinel")?(I=l.map(p),t[13]=I):I=t[13];var T=I,D;return t[14]!==k?(D=c.jsxs(c.Fragment,{children:[k,T]}),t[14]=k,t[15]=D):D=t[15],D}function p(e,t){return c.jsx("div",{className:"x1byr4rc xyri2b x1egpv2n x1c1uobl",children:c.jsx(r("PolarisLoggedOutCarouselCard.react"),{images:e.images,texts:e.texts},t)},t)}p.displayName=p.name+" [from "+i.id+"]",l.default=m}),226);
__d("PolarisLandingForm.react",["InstagramODS","PolarisAuthActionConstants","PolarisAuthActions","PolarisAuthLimitedRegistrationHelpers","PolarisAuthStrings","PolarisFooter.react","PolarisIGCoreText","PolarisIgLiteCarbonUpsellsUtils","PolarisLandingFormButtonGroup.react","PolarisLandingFormUtils","PolarisLoggedOutCtaClickLogger","PolarisLoggedOutMobileHomeBrandingContent.react","PolarisLoggedOutUpsellUtils","PolarisReactRedux.react","PolarisRoutePropUtils","PolarisSignupActions","PolarisUA","XPolarisLoginControllerRouteBuilder","gkx","react","react-compiler-runtime","useCometRouterDispatcher","usePolarisLOXMobileHomepageDesign","usePolarisOpenApp","usePolarisPageID","usePolarisRouteConfig"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useCallback,d=u.useContext;function m(e,t,n){return{primary:{label:n.buttonText,onClick:n.onClickFn},secondary:{end:{label:o("PolarisAuthStrings").SIGN_UP_BUTTON_TEXT_LOWER_CASE,onClick:t},start:{label:o("PolarisAuthStrings").LOG_IN_BUTTON_TEXT,onClick:e}}}}function p(e){var t=o("react-compiler-runtime").c(29),n=e.ref,a=o("PolarisReactRedux.react").useDispatch(),i=r("usePolarisPageID")(),l=r("useCometRouterDispatcher")(),u;t[0]===Symbol.for("react.memo_cache_sentinel")?(u=o("PolarisIgLiteCarbonUpsellsUtils").isIgLiteCarbonUpsellsEligible(),t[0]=u):u=t[0];var c=u,p=r("usePolarisLOXMobileHomepageDesign")(),_=p.isLOXMobileHomepageDesign,f=r("usePolarisRouteConfig")(),g=f.showBrandingPageWithNav,h=_||g===!0,y=d(o("PolarisRoutePropUtils").PolarisRoutePropContext),C;t[1]!==y.routePropQE?(C=y.routePropQE.getNumber("landing_page_value_prop_variant",0),t[1]=y.routePropQE,t[2]=C):C=t[2];var b=Number(C),v;t[3]!==a||t[4]!==i?(v=function(){o("PolarisLoggedOutCtaClickLogger").logLoggedOutCtaClickEvent("signup","full_page",i),o("PolarisAuthLimitedRegistrationHelpers").hasRestrictedRegistration()?a(o("PolarisSignupActions").setShowRegulatoryConsentModal()):a(o("PolarisAuthActions").switchAuthType(o("PolarisAuthActionConstants").AUTH.signup))},t[3]=a,t[4]=i,t[5]=v):v=t[5];var S=v,R;t[6]!==l||t[7]!==a||t[8]!==i?(R=function(){o("PolarisLoggedOutCtaClickLogger").logLoggedOutCtaClickEvent("login","full_page",i),r("gkx")("18606")===!0?l==null||l.go(r("XPolarisLoginControllerRouteBuilder").buildUri({mtn:!0}).toString(),{}):a(o("PolarisAuthActions").switchAuthType(o("PolarisAuthActionConstants").AUTH.login))},t[6]=l,t[7]=a,t[8]=i,t[9]=R):R=t[9];var L=R,E=r("usePolarisOpenApp")(),k;t[10]!==E||t[11]!==i?(k=function(){o("PolarisLoggedOutCtaClickLogger").logLoggedOutCtaClickEvent("app_open","full_page",i),o("PolarisUA").isDesktop()&&r("InstagramODS").incr("web.desktop.app_open_click.PolarisLandingForm"),E(c?{utmCampaignDefault:"rootLandingPage",utmMedium:"installLink"}:void 0)},t[10]=E,t[11]=i,t[12]=k):k=t[12];var I=k,T=o("PolarisLoggedOutUpsellUtils").useGetUpsellTextAndAction(I,c),D;t[13]!==L||t[14]!==S||t[15]!==T?(D=m(L,S,T),t[13]=L,t[14]=S,t[15]=T,t[16]=D):D=t[16];var x=D,$;t[17]===Symbol.for("react.memo_cache_sentinel")?($={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1iyjqo2 x1nhvcw1 x1sy10c2 x2lwn1j xeuugli x1n2onr6 xh8yej3"},t[17]=$):$=t[17];var P;t[18]!==x.primary||t[19]!==x.secondary.end||t[20]!==x.secondary.start||t[21]!==h||t[22]!==I||t[23]!==b||t[24]!==g?(P=h?s.jsxs(s.Fragment,{children:[s.jsx(r("PolarisLoggedOutMobileHomeBrandingContent.react"),{onLogoClick:I}),s.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xxqbpr",children:s.jsx(r("PolarisFooter.react"),{includeLanguageAndCopyright:!0,variant:"centered"})}),s.jsx("div",babelHelpers.extends({},{0:{className:"x6s0dn4 xm0mo6v xxux13n x1ey2m1c x78zum5 xdt5ytf xtijo5x x1o0tod xl84xjf xixxii4 xh8yej3 x1vjfegm"},1:{className:"x6s0dn4 xm0mo6v xxux13n x78zum5 xdt5ytf xtijo5x x1o0tod xl84xjf xixxii4 xh8yej3 x1vjfegm xvivwo0"}}[(g===!0)<<0],{children:s.jsx(r("PolarisLandingFormButtonGroup.react"),{isBrandForwardStyle:h,primaryButton:x.primary,secondaryButtonEnd:x.secondary.end,secondaryButtonStart:x.secondary.start})}))]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1yztbdb xziim83 x110972j x1n2onr6",children:s.jsx(r("PolarisIGCoreText"),{Element:"h1",size:"headline2",textAlign:"center",weight:"normal",children:o("PolarisLandingFormUtils").getLoginValuePropText(b)})}),s.jsx(r("PolarisLandingFormButtonGroup.react"),{primaryButton:x.primary,secondaryButtonEnd:x.secondary.end,secondaryButtonStart:x.secondary.start})]}),t[18]=x.primary,t[19]=x.secondary.end,t[20]=x.secondary.start,t[21]=h,t[22]=I,t[23]=b,t[24]=g,t[25]=P):P=t[25];var N;return t[26]!==n||t[27]!==P?(N=s.jsx("div",babelHelpers.extends({ref:n},$,{children:P})),t[26]=n,t[27]=P,t[28]=N):N=t[28],N}l.default=p}),98);
__d("PolarisLoggedOutContentWallDialogAuthCTAs.react",["IGDSText.react","PolarisAppInstallStrings","PolarisConsentStrings.react","PolarisLoggedOutLoginButton.react","PolarisLoggedOutSignupButton.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u={button:{height:"xn3w4p2",$$css:!0}};function c(){var e=o("react-compiler-runtime").c(5),t,n,a,i;e[0]===Symbol.for("react.memo_cache_sentinel")?(t={className:"xkh2ocl x78zum5 xdt5ytf xyamay9 xv54qhq x1l90r2v xf7dkkf x3pnbk8"},n=s.jsx(r("PolarisLoggedOutSignupButton.react"),{ctaTypeV2:"auth_form_dialog",isDismissible:!0,label:o("PolarisAppInstallStrings").SIGNUP_UP_FOR_INSTAGRAM_APP,loginSource:"logged_out_megaphone_signup",variant:"primary",xstyle:u.button}),a=s.jsx(r("PolarisLoggedOutLoginButton.react"),{ctaTypeV2:"auth_form_dialog",loginSource:"logged_out_megaphone_signup",variant:"secondary",xstyle:u.button}),i={className:"xz9dl7a xsag5q8"},e[0]=t,e[1]=n,e[2]=a,e[3]=i):(t=e[0],n=e[1],a=e[2],i=e[3]);var l;return e[4]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsxs("div",babelHelpers.extends({},t,{children:[n,a,s.jsx("div",babelHelpers.extends({},i,{children:s.jsx(r("IGDSText.react"),{color:"secondaryText",size:"footnote",textAlign:"center",zeroMargin:!1,children:o("PolarisConsentStrings.react").instagramTermsOfUseAndPrivacyPolicyText("secondaryText")})}))]})),e[4]=l):l=e[4],l}l.default=c}),98);
__d("PolarisLoggedOutNetzDGReportLink.react",["fbt","PolarisConfig","PolarisExternalLink.react","PolarisIGCoreText","PolarisLinkBuilder","PolarisReactRedux.react","PolarisReportUnderLawDialogItem.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react"));function c(e){if(e==="DSA")s._(/*BTDS*/"reportar contenido que consideres ilegal");else{if(e==="UKOSA")return s._(/*BTDS*/"Completar formulario");if(e==="JAPAN_IDPA")return s._(/*BTDS*/"Completar formulario");if(e==="CA_SMT")return s._(/*BTDS*/"Completar formulario")}return s._(/*BTDS*/"reportar contenido que consideres ilegal")}function d(e,t){return e==="DSA"?s._(/*BTDS*/"Tambi\u00e9n puedes {= report content you believe is unlawful} en tu pa\u00eds sin iniciar sesi\u00f3n.",[s._param("= report content you believe is unlawful",t)]):e==="UKOSA"?s._(/*BTDS*/"En el Reino\u00a0Unido, puedes crear un reporte detallado sobre algo que infringe la ley. {= Fill in form}",[s._param("= Fill in form",t)]):e==="JAPAN_IDPA"?s._(/*BTDS*/"En Jap\u00f3n, puedes crear un reporte detallado para el contenido que consideras ilegal de acuerdo con leyes locales espec\u00edficas. {= Fill in form}",[s._param("= Fill in form",t)]):e==="CA_SMT"?s._(/*BTDS*/"En California, puedes crear un reporte detallado para el contenido que incluya im\u00e1genes \u00edntimas, bullying, etc. {= Fill in form}",[s._param("= Fill in form",t)]):s._(/*BTDS*/"Tambi\u00e9n puedes {= report content you believe is unlawful} seg\u00fan la Ley sobre el cumplimiento de la normativa en las redes sociales (NetzDG) sin iniciar sesi\u00f3n.",[s._param("= report content you believe is unlawful",t)])}function m(e){var t=o("react-compiler-runtime").c(27),n=e.reportedUrlOrContentId,a=e.reportingType,i=e.textSize,l=e.username,s=o("PolarisReactRedux.react").useSelector(p),m,_,f,g,h,y,C;if(t[0]!==s||t[1]!==n||t[2]!==a||t[3]!==i||t[4]!==l){C=Symbol.for("react.early_return_sentinel");e:{var b,v=(b=o("PolarisConfig").getLoggedOutReportingVariantForUser())!=null?b:"NETZDG";if(!["NETZDG","DSA","UKOSA","JAPAN_IDPA","CA-SMT"].includes(v)){C=null;break e}var S;t[12]!==s||t[13]!==n||t[14]!==a||t[15]!==l?(S=s!=null?s:o("PolarisReportUnderLawDialogItem.react").buildReportedContentLink(l,n!=null?n:"",a!=null?a:o("PolarisReportUnderLawDialogItem.react").InstagramLegalReportingType.OTHER),t[12]=s,t[13]=n,t[14]=a,t[15]=l,t[16]=S):S=t[16];var R=S,L=o("PolarisReportUnderLawDialogItem.react").REGULATION_CONTACT_FORM_URL_MAPPING[v],E;if(t[17]!==L||t[18]!==R){var k=o("PolarisConfig").getCountryCode();E=R!=null?o("PolarisLinkBuilder").buildDSALegalReportLink(L,R,k):L,t[17]=L,t[18]=R,t[19]=E}else E=t[19];var I=E;m=r("PolarisIGCoreText"),_="ig-secondary-text",f="polaris-logged-out-netzdg-report-link",g=i,h="center",y=d(v,u.jsx(r("PolarisExternalLink.react"),{href:I,children:c(v)}))}t[0]=s,t[1]=n,t[2]=a,t[3]=i,t[4]=l,t[5]=m,t[6]=_,t[7]=f,t[8]=g,t[9]=h,t[10]=y,t[11]=C}else m=t[5],_=t[6],f=t[7],g=t[8],h=t[9],y=t[10],C=t[11];if(C!==Symbol.for("react.early_return_sentinel"))return C;var T;return t[20]!==m||t[21]!==_||t[22]!==f||t[23]!==g||t[24]!==h||t[25]!==y?(T=u.jsx(m,{color:_,"data-testid":void 0,size:g,textAlign:h,children:y}),t[20]=m,t[21]=_,t[22]=f,t[23]=g,t[24]=h,t[25]=y,t[26]=T):T=t[26],T}function p(e){return e.navigation.loginModalContentReportingLink}l.default=m}),226);
__d("PolarisLoginActionClearStopDeletionNonce",[],(function(t,n,r,o,a,i){"use strict";function e(){return function(e,t){e({deletionDate:null,deletionNonce:null,type:"ACCOUNT_DELETED"})}}i.clearStopDeletionNonce=e}),66);
__d("PolarisLoginActionOneTapLoginRemove",["PolarisAuthStrings","PolarisLoginLogger","PolarisOneTapLogin","PolarisToastActions"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return function(t,n){o("PolarisLoginLogger").logLoginEvent({event_name:"one_tap_account_remove_click",ig_userid:e,login_type:"device_based_login"});try{o("PolarisOneTapLogin").removeLoginNonce(e)}catch(e){o("PolarisLoginLogger").logLoginEvent({event_flow:"aymh",event_name:"one_tap_account_remove_failed",login_type:"device_based_login"}),t(o("PolarisToastActions").showToast({persistOnNavigate:!0,text:o("PolarisAuthStrings").LOGIN_FAILED_TEXT}))}window.location.reload()}}l.oneTapLoginRemove=e}),98);
__d("PolarisOneTapLoginForm.react",["fbt","CometPressable.react","IGDSButton.react","IGDSDivider.react","IGDSXPanoFilledIcon.react","PolarisAuthStrings","PolarisAuthTypeSwitcher.react","PolarisConfirmDialog.react","PolarisGenericStrings","PolarisIGCoreSVGIconButton.react","PolarisLoginActionOneTapLogin","PolarisLoginActionOneTapLoginRemove","PolarisLoginLogger","PolarisReactRedux.react","PolarisUA","PolarisUserAvatar.react","emptyFunction","react","react-compiler-runtime","usePolarisOneTapLoginEditModeState","useSingleSimpleImpression"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e,d=c.useCallback,m=c.useState,p=s._(/*BTDS*/"Administrar cuentas"),_={account:{alignItems:"x6s0dn4",cursor:"x1ypdohk",display:"x78zum5",flexDirection:"x1q0g3np",flexGrow:"x1iyjqo2",fontWeight:"xwhw2v2",$$css:!0}};function f(e){var t=o("react-compiler-runtime").c(12),n=e.handleRemoveOneTapLoginDialogClose,a=e.handleRemoveOneTapLoginDialogConfirm,i=e.userId,l=e.username,c;t[0]!==l?(c=s._(/*BTDS*/"Deber\u00e1s ingresar tu nombre de usuario y contrase\u00f1a la pr\u00f3xima vez que inicies sesi\u00f3n como {username}",[s._param("username",l)]),t[0]=l,t[1]=c):c=t[1];var d,m;t[2]===Symbol.for("react.memo_cache_sentinel")?(d=s._(/*BTDS*/"Cancelar"),m=s._(/*BTDS*/"Eliminar"),t[2]=d,t[3]=m):(d=t[2],m=t[3]);var p;t[4]!==a||t[5]!==i?(p=function(){return a(i)},t[4]=a,t[5]=i,t[6]=p):p=t[6];var _;t[7]===Symbol.for("react.memo_cache_sentinel")?(_=s._(/*BTDS*/"\u00bfEliminar cuenta?"),t[7]=_):_=t[7];var f;return t[8]!==n||t[9]!==c||t[10]!==p?(f=u.jsx(r("PolarisConfirmDialog.react"),{body:c,cancelLabel:d,confirmLabel:m,onClose:n,onConfirm:p,title:_}),t[8]=n,t[9]=c,t[10]=p,t[11]=f):f=t[11],f}function g(e){var t=o("react-compiler-runtime").c(34),n=e.fbConnectedUser,a=e.isLoginButtonDisabled,i=e.isLoginButtonLoading,l=e.onRequestFBLogin;if(!n||!l)return null;var s=n.fbUserID,c=n.profilePictureUrl,d=n.username,m=String(s),p;t[0]!==m||t[1]!==a?(p=a(m),t[0]=m,t[1]=a,t[2]=p):p=t[2];var f=p,g;t[3]!==m||t[4]!==i?(g=i(m),t[3]=m,t[4]=i,t[5]=g):g=t[5];var y=g,C;t[6]!==f||t[7]!==l||t[8]!==d?(C=f?r("emptyFunction"):function(){l(d)},t[6]=f,t[7]=l,t[8]=d,t[9]=C):C=t[9];var b;t[10]===Symbol.for("react.memo_cache_sentinel")?(b="x1w6pcvv x1kr3336 x1e5933n x8itksh x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu x178xt8z x1lun4ml xso031l xpilrb4 xbmvrgn",t[10]=b):b=t[10];var v;t[11]!==l||t[12]!==d?(v=function(){return l(d)},t[11]=l,t[12]=d,t[13]=v):v=t[13];var S;t[14]!==c||t[15]!==v||t[16]!==d?(S=u.jsx(r("PolarisUserAvatar.react"),{className:b,isLink:!1,onClick:v,profilePictureUrl:c,size:h,username:d}),t[14]=c,t[15]=v,t[16]=d,t[17]=S):S=t[17];var R;t[18]===Symbol.for("react.memo_cache_sentinel")?(R={className:"x1qjc9v5 xdt5ytf x1iyjqo2 xs83m0k x6ikm8r x10wlt62 xlyipyv xuxw1ft"},t[18]=R):R=t[18];var L;t[19]!==d?(L=u.jsx("div",babelHelpers.extends({},R,{children:d})),t[19]=d,t[20]=L):L=t[20];var E;t[21]===Symbol.for("react.memo_cache_sentinel")?(E={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x13a6bvl"},t[21]=E):E=t[21];var k;t[22]!==l||t[23]!==d?(k=function(){l(d)},t[22]=l,t[23]=d,t[24]=k):k=t[24];var I;t[25]!==f||t[26]!==y||t[27]!==k?(I=u.jsx("div",babelHelpers.extends({},E,{children:u.jsx(r("IGDSButton.react"),{display:"block",isDisabled:f,isLoading:y,label:o("PolarisAuthStrings").LOG_IN_BUTTON_TEXT,onClick:k})})),t[25]=f,t[26]=y,t[27]=k,t[28]=I):I=t[28];var T;return t[29]!==I||t[30]!==C||t[31]!==S||t[32]!==L?(T=u.jsxs(r("CometPressable.react"),{onPress:C,role:"button",xstyle:_.account,children:[S,L,I]}),t[29]=I,t[30]=C,t[31]=S,t[32]=L,t[33]=T):T=t[33],T}var h=38,y=86;function C(e){var t=o("react-compiler-runtime").c(14),n=e.handleLoginClick,a=e.isSingleAccount,i=e.loginNonces,l=e.userId,s=i[l],c=s.nonce,d=s.profilePicUrl,m=s.username,p;t[0]===Symbol.for("react.memo_cache_sentinel")?(p={className:"x78zum5 xl56j7k"},t[0]=p):p=t[0];var _;t[1]!==a?(_={0:"x1w6pcvv x1kr3336 x1e5933n x8itksh x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu x178xt8z x1lun4ml xso031l xpilrb4 xbmvrgn",1:"x1w6pcvv x1kr3336 x1e5933n x8itksh x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu x178xt8z x1lun4ml xso031l xpilrb4 x1xmf6yo x11t971q x1yztbdb xvc5jky"}[!!a<<0],t[1]=a,t[2]=_):_=t[2];var f;t[3]!==n||t[4]!==a||t[5]!==c||t[6]!==l?(f=a?function(){return n(l,c)}:void 0,t[3]=n,t[4]=a,t[5]=c,t[6]=l,t[7]=f):f=t[7];var g=a?y:h,C;return t[8]!==d||t[9]!==_||t[10]!==f||t[11]!==g||t[12]!==m?(C=u.jsx("div",babelHelpers.extends({},p,{children:u.jsx(r("PolarisUserAvatar.react"),{className:_,isLink:!1,onClick:f,profilePictureUrl:d,size:g,username:m})})),t[8]=d,t[9]=_,t[10]=f,t[11]=g,t[12]=m,t[13]=C):C=t[13],C}function b(e){var t=o("react-compiler-runtime").c(41),n=e.editMode,a=e.handleLoginClick,i=e.handleRemoveAccountClick,l=e.isLoginButtonDisabled,s=e.isLoginButtonLoading,c=e.loginNonces,d=e.userId,m=c[d].nonce,p=c[d].username,f;t[0]!==l||t[1]!==d?(f=l(d),t[0]=l,t[1]=d,t[2]=f):f=t[2];var g=f,h;t[3]!==s||t[4]!==d?(h=s(d),t[3]=s,t[4]=d,t[5]=h):h=t[5];var y=h,b;t[6]!==n||t[7]!==a||t[8]!==g||t[9]!==m||t[10]!==d?(b=n||g?r("emptyFunction"):function(){return a(d,m)},t[6]=n,t[7]=a,t[8]=g,t[9]=m,t[10]=d,t[11]=b):b=t[11];var v=b,S=g||y,R;t[12]!==i||t[13]!==d||t[14]!==p?(R=function(){return i(d,p)},t[12]=i,t[13]=d,t[14]=p,t[15]=R):R=t[15];var L;t[16]===Symbol.for("react.memo_cache_sentinel")?(L=u.jsx(r("IGDSXPanoFilledIcon.react"),{alt:o("PolarisGenericStrings").CLOSE_TEXT,size:12}),t[16]=L):L=t[16];var E;t[17]!==S||t[18]!==R?(E=u.jsx(r("PolarisIGCoreSVGIconButton.react"),{disabled:S,onClick:R,padding:0,children:L}),t[17]=S,t[18]=R,t[19]=E):E=t[19];var k=E,I;t[20]===Symbol.for("react.memo_cache_sentinel")?(I={className:"xqjyukv x6s0dn4 x9f619 xfex06f x78zum5 x1q0g3np x1iyjqo2 x1nhvcw1 x2lwn1j xeuugli xwib8y2 x1y1aw1k"},t[20]=I):I=t[20];var T;t[21]!==a||t[22]!==c||t[23]!==d?(T=u.jsx(C,{handleLoginClick:a,isSingleAccount:!1,loginNonces:c,userId:d}),t[21]=a,t[22]=c,t[23]=d,t[24]=T):T=t[24];var D;t[25]===Symbol.for("react.memo_cache_sentinel")?(D={className:"x1qjc9v5 xdt5ytf x1iyjqo2 xs83m0k x6ikm8r x10wlt62 xlyipyv xuxw1ft"},t[25]=D):D=t[25];var x;t[26]!==p?(x=u.jsx("div",babelHelpers.extends({},D,{children:p})),t[26]=p,t[27]=x):x=t[27];var $;t[28]===Symbol.for("react.memo_cache_sentinel")?($={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x13a6bvl"},t[28]=$):$=t[28];var P;t[29]!==n||t[30]!==v||t[31]!==g||t[32]!==y||t[33]!==k?(P=u.jsx("div",babelHelpers.extends({},$,{children:n?k:u.jsx(r("IGDSButton.react"),{display:"block",isDisabled:g,isLoading:y,label:o("PolarisAuthStrings").LOG_IN_BUTTON_TEXT,onClick:v})})),t[29]=n,t[30]=v,t[31]=g,t[32]=y,t[33]=k,t[34]=P):P=t[34];var N;return t[35]!==v||t[36]!==x||t[37]!==P||t[38]!==T||t[39]!==d?(N=u.jsx("div",babelHelpers.extends({},I,{children:u.jsxs(r("CometPressable.react"),{onPress:v,role:"button",xstyle:_.account,children:[T,x,P]},d)})),t[35]=v,t[36]=x,t[37]=P,t[38]=T,t[39]=d,t[40]=N):N=t[40],N}function v(){var e=o("react-compiler-runtime").c(1),t;return e[0]===Symbol.for("react.memo_cache_sentinel")?(t=u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xwib8y2 xjfo4ez xf7qf19 x1y1aw1k x1n2onr6 xh8yej3",children:u.jsx(r("IGDSDivider.react"),{})}),u.jsx("div",{className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1yztbdb xw7yly9 x1n2onr6",children:u.jsx(r("PolarisAuthTypeSwitcher.react"),{primary:!0})})]}),e[0]=t):t=e[0],t}function S(e){var t=o("react-compiler-runtime").c(3),n=e.onRemoveClick,a;t[0]===Symbol.for("react.memo_cache_sentinel")?(a=s._(/*BTDS*/"Eliminar cuenta"),t[0]=a):a=t[0];var i;return t[1]!==n?(i=u.jsx(r("IGDSButton.react"),{display:"block",label:a,onClick:n,variant:"primary_link"}),t[1]=n,t[2]=i):i=t[2],i}function R(e){var t=o("react-compiler-runtime").c(32),n=e.handleLoginClick,a=e.handleRemoveAccountClick,i=e.isLoginButtonLoading,l=e.loginNonces,c=e.showSingleAccountProfilePicture,d;t[0]!==l?(d=Object.keys(l),t[0]=l,t[1]=d):d=t[1];var m=d[0],p=l[m],_=p.nonce,f=p.username,g;t[2]!==f?(g=s._(/*BTDS*/"Continuar como {username}",[s._param("username",f)]),t[2]=f,t[3]=g):g=t[3];var h=g,y;t[4]===Symbol.for("react.memo_cache_sentinel")?(y={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1iyjqo2 x1nhvcw1 x2lwn1j xeuugli"},t[4]=y):y=t[4];var b;t[5]!==n||t[6]!==l||t[7]!==c||t[8]!==m?(b=c&&u.jsx(C,{handleLoginClick:n,isSingleAccount:!0,loginNonces:l,userId:m}),t[5]=n,t[6]=l,t[7]=c,t[8]=m,t[9]=b):b=t[9];var R;t[10]===Symbol.for("react.memo_cache_sentinel")?(R={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xieb3on x11t971q xvc5jky xw7yly9 x1n2onr6 x1i9suas x15jlpm9"},t[10]=R):R=t[10];var L;t[11]!==i||t[12]!==m?(L=i(m),t[11]=i,t[12]=m,t[13]=L):L=t[13];var E;t[14]!==n||t[15]!==_||t[16]!==m?(E=function(){return n(m,_)},t[14]=n,t[15]=_,t[16]=m,t[17]=E):E=t[17];var k;t[18]!==h||t[19]!==L||t[20]!==E?(k=u.jsx("div",babelHelpers.extends({},R,{children:u.jsx(r("IGDSButton.react"),{isLoading:L,label:h,onClick:E,size:"small",variant:"primary"})})),t[18]=h,t[19]=L,t[20]=E,t[21]=k):k=t[21];var I;t[22]===Symbol.for("react.memo_cache_sentinel")?(I={className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xieb3on x1n2onr6"},t[22]=I):I=t[22];var T;t[23]!==a||t[24]!==m||t[25]!==f?(T=u.jsx("div",babelHelpers.extends({},I,{children:u.jsx(S,{onRemoveClick:function(){return a(m,f)}})})),t[23]=a,t[24]=m,t[25]=f,t[26]=T):T=t[26];var D;t[27]===Symbol.for("react.memo_cache_sentinel")?(D=o("PolarisUA").isMobile()&&u.jsx(v,{}),t[27]=D):D=t[27];var x;return t[28]!==T||t[29]!==b||t[30]!==k?(x=u.jsxs("div",babelHelpers.extends({},y,{children:[b,k,T,D]})),t[28]=T,t[29]=b,t[30]=k,t[31]=x):x=t[31],x}function L(e){var t=o("react-compiler-runtime").c(31),n=e.editMode,a=e.fbConnectedUser,i=e.handleLoginClick,l=e.handleManageAccountsClick,c=e.handleRemoveAccountClick,d=e.isLoginButtonDisabled,m=e.isLoginButtonLoading,_=e.loginNonces,f=e.onRequestFBLogin,h;t[0]!==n?(h=n?s._(/*BTDS*/"Edici\u00f3n terminada"):p,t[0]=n,t[1]=h):h=t[1];var y=h,C;t[2]!==_?(C=Object.keys(_),t[2]=_,t[3]=C):C=t[3];var v;t[4]!==n||t[5]!==i||t[6]!==c||t[7]!==d||t[8]!==m||t[9]!==_||t[10]!==C?(v=C.map(function(e){return u.jsx(b,{editMode:n,handleLoginClick:i,handleRemoveAccountClick:c,isLoginButtonDisabled:d,isLoginButtonLoading:m,loginNonces:_,userId:e},"account_"+e)}),t[4]=n,t[5]=i,t[6]=c,t[7]=d,t[8]=m,t[9]=_,t[10]=C,t[11]=v):v=t[11];var S=v,R,L;t[12]===Symbol.for("react.memo_cache_sentinel")?(R={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1iyjqo2 x1nhvcw1 x2lwn1j xeuugli"},L={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xv54qhq xf7dkkf xx6bls6 x7sb2j6"},t[12]=R,t[13]=L):(R=t[12],L=t[13]);var E;t[14]!==a||t[15]!==d||t[16]!==m||t[17]!==f?(E=u.jsx(g,{fbConnectedUser:a,isLoginButtonDisabled:d,isLoginButtonLoading:m,onRequestFBLogin:f}),t[14]=a,t[15]=d,t[16]=m,t[17]=f,t[18]=E):E=t[18];var k;t[19]!==S||t[20]!==E?(k=u.jsxs("div",babelHelpers.extends({},L,{children:[S,E]})),t[19]=S,t[20]=E,t[21]=k):k=t[21];var I,T;t[22]===Symbol.for("react.memo_cache_sentinel")?(I={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1hq5gj4 x1n2onr6"},T={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xw7yly9 x1n2onr6"},t[22]=I,t[23]=T):(I=t[22],T=t[23]);var D;t[24]!==l||t[25]!==y?(D=u.jsx("div",babelHelpers.extends({},I,{children:u.jsx("div",babelHelpers.extends({},T,{children:u.jsx(r("IGDSButton.react"),{display:"block",label:y,onClick:l,variant:"primary_link"})}))})),t[24]=l,t[25]=y,t[26]=D):D=t[26];var x;t[27]===Symbol.for("react.memo_cache_sentinel")?(x=o("PolarisUA").isMobile()&&u.jsx("div",{className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1n2onr6",children:u.jsx(r("PolarisAuthTypeSwitcher.react"),{primary:!0})}),t[27]=x):x=t[27];var $;return t[28]!==D||t[29]!==k?($=u.jsxs("div",babelHelpers.extends({},R,{children:[k,D,x]})),t[28]=D,t[29]=k,t[30]=$):$=t[30],$}function E(e){var t=e.fbConnectedUser,n=e.loginNonces,a=e.onLoginClick,i=e.onRemoveClick,l=e.onRequestFBLogin,s=e.requestInFlight,c=e.requestUserId,p=e.showSingleAccountProfilePicture,_=p===void 0?!0:p,g=m({id:"",username:""}),h=g[0],y=g[1],C=m(!1),b=C[0],v=C[1],S=r("usePolarisOneTapLoginEditModeState")(),E=S[0],k=S[1];r("useSingleSimpleImpression")(function(){Object.keys(n).length===1?o("PolarisLoginLogger").logLoginEvent({event_name:"one_tap_login_single_user_form_load",login_type:"device_based_login"}):o("PolarisLoginLogger").logLoginEvent({event_name:"one_tap_login_multi_user_form_load",login_type:"device_based_login"}),o("PolarisLoginLogger").logLoginEvent({event_category:"aymh_home_page_init",event_flow:"aymh",event_name:"aymh_step_view_loaded",event_step:"home_page",extra_client_data:{total_count:Object.keys(n).length.toString()}})});var I=d(function(e,t){a(e,t,function(){return I(e,t)}),o("PolarisLoginLogger").logLoginEvent({event_flow:"aymh",event_name:"one_tap_login_login_click",extra_client_data:{credential_type:"nonce"},login_type:"device_based_login"})},[a]),T=d(function(e,t){y({id:e,username:t}),v(!0),o("PolarisLoginLogger").logLoginEvent({event_flow:"aymh",event_name:"one_tap_login_remove_account_prompt_show",login_type:"device_based_login"})},[]),D=d(function(e){i(e)},[i]),x=d(function(){y({id:"",username:""}),v(!1),o("PolarisLoginLogger").logLoginEvent({event_name:"one_tap_login_remove_account_prompt_hide",login_type:"device_based_login"})},[]),$=d(function(){k(!E)},[E,k]),P=function(t){return s&&t!==c},N=function(t){return s&&t===c},M=Object.keys(n).length===1&&!t;return u.jsxs("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xvs91rp xz5fbns x1dc814f xh8yej3",children:[M?u.jsx(R,{handleLoginClick:I,handleRemoveAccountClick:T,isLoginButtonLoading:N,loginNonces:n,showSingleAccountProfilePicture:_}):u.jsx(L,{editMode:E,fbConnectedUser:t,handleLoginClick:I,handleManageAccountsClick:$,handleRemoveAccountClick:T,isLoginButtonDisabled:P,isLoginButtonLoading:N,loginNonces:n,onRequestFBLogin:l}),b&&h.id&&h.username&&u.jsx(f,{handleRemoveOneTapLoginDialogClose:x,handleRemoveOneTapLoginDialogConfirm:D,userId:h.id,username:h.username})]})}E.displayName=E.name+" [from "+i.id+"]";function k(e){var t,n,r=e.auth;return{requestInFlight:(r==null||(t=r.login)==null?void 0:t.requestInFlight)===!0,requestUserId:r==null||(n=r.login)==null?void 0:n.userId}}function I(e){return{onLoginClick:function(n,r,a){e(o("PolarisLoginActionOneTapLogin").oneTapLogin({loginNonce:r,retry:a,userId:n}))},onRemoveClick:function(n){e(o("PolarisLoginActionOneTapLoginRemove").oneTapLoginRemove(n))}}}var T=o("PolarisReactRedux.react").connect(k,I)(E);l.default=T}),226);
__d("PolarisBirthdayFormInput.react",["PolarisAgeCollectionHelpers","PolarisDOBFieldSelect.react","PolarisDateHelpers","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useState;function c(e){var t=o("react-compiler-runtime").c(13),n=e.birthday,a=e.className,i=e.flex,l=e.onBirthdayChange,c=e.shouldShowRedesignedSignup,d=c===void 0?!1:c,m,p,_;t[0]!==n?(m=n!=null?o("PolarisDateHelpers").dateStringToDateType(n):o("PolarisDateHelpers").getOneYearAgoDateType(),p=u,_=o("PolarisAgeCollectionHelpers").getDOBInvalidInputMessage(m),t[0]=n,t[1]=m,t[2]=p,t[3]=_):(m=t[1],p=t[2],_=t[3]);var f=p(_),g=f[0],h=f[1],y;t[4]!==l?(y=function(t){h(o("PolarisAgeCollectionHelpers").getDOBInvalidInputMessage(t)),l(t)},t[4]=l,t[5]=y):y=t[5];var C=y,b;return t[6]!==a||t[7]!==m||t[8]!==g||t[9]!==i||t[10]!==C||t[11]!==d?(b=s.jsx(r("PolarisDOBFieldSelect.react"),{className:a,date:m,errorColor:"ig-secondary-text",errorMessage:g,flex:i,onDateChange:C,shouldShowRedesignedSignup:d,showAge:!1}),t[6]=a,t[7]=m,t[8]=g,t[9]=i,t[10]=C,t[11]=d,t[12]=b):b=t[12],b}l.default=c}),98);
__d("PolarisBirthdayConstants",[],(function(t,n,r,o,a,i){"use strict";var e={INPUT_AGE:"input_age",LEARN_MORE:"learn_more",LOG_OUT:"log_out",SEE_CONFIRMATION:"see_confirmation",SEE_PAGE:"see_page",SUBMIT_AGE:"submit_age"},l={CHECKPOINT:"checkpoint"};i.StepTypes=e,i.EntrypointTypes=l}),66);
__d("PolarisBirthdayHelpers",["InstagramWebAgeCollectionFalcoEvent"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,o,a){var i=n!=null?n.year.toString()+"-"+n.month.toString().padStart(2,"0")+"-"+n.day.toString().padStart(2,"0"):"";r("InstagramWebAgeCollectionFalcoEvent").log(function(){return{collected_birthday:i,endpoint:t,exception_message:o,exception_trace:a,step:e}})}l.logBirthdayAction=e}),98);
__d("PolarisBirthdaysAdditionalInfoModal.react",["ix","IGCoreImage.react","IGCoreModal.react","IGDSBox.react","IGDSText.react","IGDSTextVariants.react","PolarisAgeCollectionHelpers","PolarisBirthdayConstants","PolarisBirthdayHelpers","PolarisExternalLink.react","PolarisIGCoreButton.react","PolarisIGCoreModalHeader.react","PolarisNavigationUtils","PolarisUA","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react"));function c(e){var t=o("react-compiler-runtime").c(15),n=e.entrypoint,a=e.helpLink,i=e.onClose,l=a==null?o("PolarisAgeCollectionHelpers").DATA_POLICY_LINK:a;n!=null&&o("PolarisBirthdayHelpers").logBirthdayAction(o("PolarisBirthdayConstants").StepTypes.LEARN_MORE,n);var c;t[0]!==i?(c=u.jsx(r("PolarisIGCoreModalHeader.react"),{onClose:i,children:o("PolarisAgeCollectionHelpers").BIRTHDAYS_HEADER}),t[0]=i,t[1]=c):c=t[1];var d;t[2]===Symbol.for("react.memo_cache_sentinel")?(d=u.jsx(r("IGDSBox.react"),{padding:1,position:"relative",children:u.jsx(r("IGCoreImage.react"),{alt:o("PolarisAgeCollectionHelpers").BIRTHDAY_ICON_ALT_TEXT,src:{dark:s("877412"),light:s("877413")}})}),t[2]=d):d=t[2];var m;t[3]===Symbol.for("react.memo_cache_sentinel")?(m=u.jsx(r("IGDSBox.react"),{marginTop:1,padding:2,position:"relative",children:u.jsx(o("IGDSTextVariants.react").IGDSTextTitle,{zeroMargin:!1,children:o("PolarisAgeCollectionHelpers").BIRTHDAYS_ON_IG_TITLE})}),t[3]=m):m=t[3];var p;t[4]===Symbol.for("react.memo_cache_sentinel")?(p=u.jsx(r("IGDSBox.react"),{padding:3,position:"relative",children:u.jsx(o("IGDSTextVariants.react").IGDSTextBody,{textAlign:"center",zeroMargin:!1,children:o("PolarisAgeCollectionHelpers").BIRTHDAYS_ON_IG_BODY})}),t[4]=p):p=t[4];var _;t[5]!==l?(_=o("PolarisUA").isMobile()&&u.jsx(r("IGDSBox.react"),{padding:2,position:"relative",children:u.jsxs(r("PolarisExternalLink.react"),{href:l,onClick:function(){return o("PolarisNavigationUtils").openExternalURL(l)},children:[o("PolarisAgeCollectionHelpers").LEARN_MORE," "]})}),t[5]=l,t[6]=_):_=t[6];var f;t[7]!==_?(f=u.jsxs(r("IGDSBox.react"),{alignItems:"center",marginBottom:5,marginEnd:7,marginStart:7,marginTop:5,position:"relative",children:[d,m,p,_]}),t[7]=_,t[8]=f):f=t[8];var g;t[9]!==l?(g=!o("PolarisUA").isMobile()&&u.jsx("div",{className:"x6s0dn4 x1yvgwvq x13fuv20 x178xt8z x9f619 x1ypdohk x78zum5 xdt5ytf x2lah0s xln7xf2 xk390pu x11x8uw5 xl56j7k xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl x1n2onr6 x11njtxf",children:u.jsx(r("IGDSBox.react"),{position:"relative",width:"100%",children:u.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:function(){return o("PolarisNavigationUtils").openExternalURL(l)},children:u.jsx(r("IGDSText.react"),{color:"primaryButton",size:"body",textAlign:"center",weight:"semibold",zeroMargin:!1,children:o("PolarisAgeCollectionHelpers").LEARN_MORE})})})}),t[9]=l,t[10]=g):g=t[10];var h;return t[11]!==c||t[12]!==f||t[13]!==g?(h=u.jsxs(r("IGCoreModal.react"),{"aria-label":o("PolarisAgeCollectionHelpers").BIRTHDAYS_HEADER,size:o("PolarisUA").isMobile()?"large":"default",children:[c,f,g]}),t[11]=c,t[12]=f,t[13]=g,t[14]=h):h=t[14],h}l.default=c}),98);
__d("PolarisBirthdaySignupForm.react",["ix","IGCoreImage.react","IGDSBox.react","IGDSTextVariants.react","PolarisAgeCollectionHelpers","PolarisAuthStrings","PolarisBirthdayFormInput.react","PolarisBirthdaysAdditionalInfoModal.react","PolarisDateHelpers","PolarisDateStrings","PolarisExternalLink.react","PolarisIGCoreButton.react","PolarisReactRedux.react","PolarisRegistrationLogger","PolarisSignupActions","PolarisSignupFormFields.react","PolarisSignupTypesHelpers","gkx","react","react-compiler-runtime","usePolarisEmailOrPhoneContactpointType"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e,d=c.useEffect,m=c.useState;function p(e){var t=o("react-compiler-runtime").c(55),n=e.onBirthdayEntered,a=e.onSignup,i=e.pageIdentifier,l=e.requestInFlight,c=e.shouldShowBirthdayTransparency,p=e.shouldShowRedesignedSignup,f=e.signupNonSpecificError,g=e.style,h=c===void 0?!1:c,y=p===void 0?!1:p,C=g===void 0?"default":g,b=o("PolarisReactRedux.react").useDispatch(),v=m(!1),S=v[0],R=v[1],L=o("PolarisReactRedux.react").useSelector(_),E;if(t[0]!==L){var k;E=(L==null||(k=L.fields.birthday)==null?void 0:k.value)!=null?o("PolarisDateHelpers").dateToDateType(new Date(L.fields.birthday.value)):o("PolarisDateHelpers").getOneYearAgoDateType(),t[0]=L,t[1]=E}else E=t[1];var I=m(E),T=I[0],D=I[1],x=r("usePolarisEmailOrPhoneContactpointType")(),$;t[2]!==x||t[3]!==b?($=function(){b(o("PolarisSignupActions").returnToBaseSignupForm()),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:x,event_name:"back_button_clicked",step:"birthday"})},t[2]=x,t[3]=b,t[4]=$):$=t[4];var P=$,N;t[5]!==T?(N=o("PolarisAgeCollectionHelpers").isDOBInputAttemptDisabled(T),t[5]=T,t[6]=N):N=t[6];var M=N,w;t[7]!==T||t[8]!==n||t[9]!==a||t[10]!==L?(w=function(){var e=o("PolarisSignupTypesHelpers").convertSignupResultToSignupFields(L);e.birthday=o("PolarisDateHelpers").dateTypeToString(T),r("gkx")("14029")===!0&&n(),a(e)},t[7]=T,t[8]=n,t[9]=a,t[10]=L,t[11]=w):w=t[11];var A=w,F;t[12]!==i?(F=function(t){o("PolarisRegistrationLogger").logRegistrationEvent({containermodule:i,event_name:"birthday_interaction"}),D(t)},t[12]=i,t[13]=F):F=t[13];var O=F,B,W;t[14]!==x?(W=function(){o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:x,event_name:"form_load",step:"birthday"})},B=[x],t[14]=x,t[15]=B,t[16]=W):(B=t[15],W=t[16]),d(W,B);var q;t[17]!==y?(q=y?null:u.jsx(r("IGCoreImage.react"),{alt:o("PolarisAgeCollectionHelpers").BIRTHDAY_ICON_ALT_TEXT,src:{dark:s("877412"),light:s("877413")}}),t[17]=y,t[18]=q):q=t[18];var U=y?5:2,V;t[19]===Symbol.for("react.memo_cache_sentinel")?(V=u.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:function(){return R(!0)},children:u.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"primaryButton",zeroMargin:!1,children:o("PolarisAuthStrings").BIRTHDAY_WHY_LINK_TEXT})}),t[19]=V):V=t[19];var H;t[20]!==U?(H=u.jsx(r("IGDSBox.react"),{marginBottom:U,position:"relative",children:V}),t[20]=U,t[21]=H):H=t[21];var G;t[22]===Symbol.for("react.memo_cache_sentinel")?(G={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1e56ztr x1xmf6yo x1n2onr6"},t[22]=G):G=t[22];var z;t[23]!==T?(z=o("PolarisDateHelpers").dateTypeToString(T),t[23]=T,t[24]=z):z=t[24];var j;t[25]!==O||t[26]!==y||t[27]!==z?(j=u.jsx("div",babelHelpers.extends({},G,{children:u.jsx(r("PolarisBirthdayFormInput.react"),{birthday:z,onBirthdayChange:O,shouldShowRedesignedSignup:y})})),t[25]=O,t[26]=y,t[27]=z,t[28]=j):j=t[28];var K,Q;t[29]===Symbol.for("react.memo_cache_sentinel")?(K={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1n2onr6 xh8yej3"},Q={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1e56ztr x1xmf6yo x1n2onr6"},t[29]=K,t[30]=Q):(K=t[29],Q=t[30]);var X;t[31]===Symbol.for("react.memo_cache_sentinel")?(X=u.jsx("div",babelHelpers.extends({},Q,{children:u.jsx(o("IGDSTextVariants.react").IGDSTextBody2,{color:"secondaryText",textAlign:"center",zeroMargin:!1,children:o("PolarisDateStrings").getBirthdayDisclaimerText()})})),t[31]=X):X=t[31];var Y;t[32]!==h?(Y=h&&u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1e56ztr x1xmf6yo x1n2onr6",children:u.jsxs(o("IGDSTextVariants.react").IGDSTextBody2,{color:"secondaryText",textAlign:"center",zeroMargin:!1,children:[o("PolarisDateStrings").getBirthdayTransparencyText(),u.jsx(r("PolarisExternalLink.react"),{href:o("PolarisDateStrings").PRIVACY_POLICY_LINK,rel:"noopener noreferrer",target:"_blank",children:u.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,children:u.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"primaryButton",zeroMargin:!1,children:o("PolarisDateStrings").getPrivacyPolicyText()})})})]})}),t[32]=h,t[33]=Y):Y=t[33];var J;t[34]!==Y?(J=u.jsxs("div",babelHelpers.extends({},K,{children:[X,Y]})),t[34]=Y,t[35]=J):J=t[35];var Z;t[36]!==H||t[37]!==j||t[38]!==J?(Z=u.jsxs(u.Fragment,{children:[H,j,J]}),t[36]=H,t[37]=j,t[38]=J,t[39]=Z):Z=t[39];var ee;t[40]!==P||t[41]!==A||t[42]!==M||t[43]!==l||t[44]!==y||t[45]!==f||t[46]!==C||t[47]!==q||t[48]!==Z?(ee=u.jsx(r("PolarisSignupFormFields.react"),{handleGoBack:P,handleNext:A,header:o("PolarisAuthStrings").BIRTHDAY_HEADER_TEXT,icon:q,isNextActionDisabled:M,maxWidth:400,requestInFlight:l,shouldShowRedesignedSignup:y,signupNonSpecificError:f,style:C,subHeader:o("PolarisAuthStrings").BIRTHDAY_SUBHEADER_TEXT,children:Z}),t[40]=P,t[41]=A,t[42]=M,t[43]=l,t[44]=y,t[45]=f,t[46]=C,t[47]=q,t[48]=Z,t[49]=ee):ee=t[49];var te;t[50]!==S?(te=S&&u.jsx(r("PolarisBirthdaysAdditionalInfoModal.react"),{onClose:function(){return R(!1)}}),t[50]=S,t[51]=te):te=t[51];var ne;return t[52]!==ee||t[53]!==te?(ne=u.jsxs(u.Fragment,{children:[ee,te]}),t[52]=ee,t[53]=te,t[54]=ne):ne=t[54],ne}function _(e){var t;return(t=e.auth.signup)==null?void 0:t.signupResult}l.default=p}),98);
__d("PolarisCaptchaSignupForm.react",["IGDSTextVariants.react","PolarisAuthStrings","PolarisReactRedux.react","PolarisRecaptcha","PolarisRegistrationLogger","PolarisSignupActions","PolarisSignupFormFields.react","PolarisSignupTypesHelpers","react","react-compiler-runtime","usePolarisEmailOrPhoneContactpointType"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useEffect,d=u.useState;function m(e){var t=o("react-compiler-runtime").c(25),n=e.onSignup,a=e.requestInFlight,i=e.signupNonSpecificError,l=e.style,u=l===void 0?"default":l,m=o("PolarisReactRedux.react").useDispatch(),f=d(_),g=f[0],h=f[1],y=o("PolarisReactRedux.react").useSelector(p),C=r("usePolarisEmailOrPhoneContactpointType")(),b,v;t[0]!==C?(b=function(){o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:C,event_name:"form_load",step:"captcha"})},v=[C],t[0]=C,t[1]=b,t[2]=v):(b=t[1],v=t[2]),c(b,v);var S;t[3]!==C||t[4]!==m?(S=function(){m(o("PolarisSignupActions").returnToBaseSignupForm()),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:C,event_name:"back_button_clicked",step:"captcha"})},t[3]=C,t[4]=m,t[5]=S):S=t[5];var R=S,L=g==="",E;t[6]!==g||t[7]!==n||t[8]!==y?(E=function(){var e=o("PolarisSignupTypesHelpers").convertSignupResultToSignupFields(y);e.captcha=g,n(e)},t[6]=g,t[7]=n,t[8]=y,t[9]=E):E=t[9];var k=E,I;t[10]!==C?(I=function(t){o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:C,event_name:"captcha_solved"}),h(t)},t[10]=C,t[11]=I):I=t[11];var T=I,D;t[12]===Symbol.for("react.memo_cache_sentinel")?(D={className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s xl56j7k x1n2onr6"},t[12]=D):D=t[12];var x;t[13]!==T?(x=s.jsx("div",babelHelpers.extends({},D,{children:s.jsx(r("PolarisRecaptcha"),{onChange:T})})),t[13]=T,t[14]=x):x=t[14];var $;t[15]!==i?($=i!=null&&s.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xw7yly9 x1n2onr6",children:s.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"errorOrDestructive",textAlign:"center",zeroMargin:!1,children:i})}),t[15]=i,t[16]=$):$=t[16];var P;return t[17]!==R||t[18]!==k||t[19]!==L||t[20]!==a||t[21]!==u||t[22]!==x||t[23]!==$?(P=s.jsxs(r("PolarisSignupFormFields.react"),{handleGoBack:R,handleNext:k,header:o("PolarisAuthStrings").SIGN_UP_BUTTON_TEXT,isNextActionDisabled:L,requestInFlight:a,style:u,subHeader:o("PolarisAuthStrings").SIGN_UP_PHONE_LINK_TEXT,children:[x,$]}),t[17]=R,t[18]=k,t[19]=L,t[20]=a,t[21]=u,t[22]=x,t[23]=$,t[24]=P):P=t[24],P}function p(e){var t;return(t=e.auth.signup)==null?void 0:t.signupResult}function _(){return""}l.default=m}),98);
__d("PolarisEmailConfirmationForm.react",["fbt","ix","IGCoreImage.react","IGDSBox.react","IGDSButton.react","IGDSDialogFooter.react","IGDSText.react","IGDSTextVariants.react","PolarisAuthStrings","PolarisGenericStrings","PolarisIGCoreButton.react","PolarisIGCoreTextInput.react","PolarisLabeledTextInput.react","PolarisReactRedux.react","PolarisRegistrationLogger","PolarisSignupActions","qex","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s,u){"use strict";var e,c=e||(e=o("react")),d=e,m=d.useCallback,p=d.useEffect,_=d.useState,f=6,g=s._(/*BTDS*/"Confirmaci\u00f3n de correo electr\u00f3nico"),h=350;function y(e){var t,n,a=o("react-compiler-runtime").c(78),i=e.onSubmit,l=e.pageIdentifier,s=e.requestInFlight,d=e.shouldShowRedesignedSignup,m=e.signupNonSpecificError,y=e.style,b=d===void 0?!1:d,v=y===void 0?"default":y,S=o("PolarisReactRedux.react").useDispatch(),R=o("PolarisReactRedux.react").useSelector(C),L=(t=R==null||(n=R.fields.emailOrPhone)==null?void 0:n.value)!=null?t:"",E=_(""),k=E[0],I=E[1],T=_(!1),D=T[0],x=T[1],$=_(!1),P=$[0],N=$[1],M=k.length<f||s,w=m;if(w==null&&(R==null?void 0:R.fields)!=null){var A=R.fields,F=Object.keys(A).some(function(e){var t;return((t=A[e])==null?void 0:t.error)!=null});F&&(w=o("PolarisAuthStrings").ERROR_SIGNUP_UNKNOWN)}var O;a[0]===Symbol.for("react.memo_cache_sentinel")?(O=function(t){I(t.target.value)},a[0]=O):O=a[0];var B=O,W;a[1]!==S?(W=function(){S(o("PolarisSignupActions").returnToBaseSignupForm()),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:"email",event_name:"back_button_clicked",step:"emailConfirmation"})},a[1]=S,a[2]=W):W=a[2];var q=W,U;a[3]!==S||a[4]!==L?(U=function(){S(o("PolarisSignupActions").requestConfirmationEmailWithLogging(L,null,!0))},a[3]=S,a[4]=L,a[5]=U):U=a[5];var V=U,H;a[6]!==k||a[7]!==M||a[8]!==i||a[9]!==R?(H=function(){if(!M&&R!=null){var e=Object.keys(R.fields).reduce(function(e,t){var n,r=(n=R.fields[t])==null?void 0:n.value;return r!=null&&t!=="optIntoOneTap"&&(e[t]=r),e},{});e.emailConfirmationCode=k,i(e)}},a[6]=k,a[7]=M,a[8]=i,a[9]=R,a[10]=H):H=a[10];var G=H,z,j;a[11]!==l?(z=function(){o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:"email",containermodule:l,event_name:"form_load",step:"emailConfirmation"})},j=[l],a[11]=l,a[12]=z,a[13]=j):(z=a[12],j=a[13]),p(z,j);var K;a[14]!==k.length||a[15]!==G||a[16]!==D?(K=function(){D||k.length===f&&r("qex")._("2155")===!0&&(x(!0),G())},a[14]=k.length,a[15]=G,a[16]=D,a[17]=K):K=a[17];var Q;a[18]!==k||a[19]!==G||a[20]!==D?(Q=[k,G,D],a[18]=k,a[19]=G,a[20]=D,a[21]=Q):Q=a[21],p(K,Q);var X;a[22]!==b?(X=b!==!0&&c.jsx(r("IGCoreImage.react"),{alt:g,src:{dark:u("148908"),light:u("835354")}}),a[22]=b,a[23]=X):X=a[23];var Y;a[24]===Symbol.for("react.memo_cache_sentinel")?(Y={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1e56ztr xw7yly9 x1n2onr6"},a[24]=Y):Y=a[24];var J;a[25]!==b?(J=c.jsx("div",babelHelpers.extends({},Y,{children:b===!0?c.jsx(r("IGDSText.react"),{color:"primaryText",size:"title",textAlign:"center",weight:"bold",zeroMargin:!1,children:o("PolarisAuthStrings").JUST_ONE_MORE_STEP_HEADER}):c.jsx(o("IGDSTextVariants.react").IGDSTextBodyEmphasized,{textAlign:"center",zeroMargin:!1,children:o("PolarisAuthStrings").EMAIL_CONFIRMATION_CODE_HEADER})})),a[25]=b,a[26]=J):J=a[26];var Z=b?2:4,ee;a[27]!==L?(ee=o("PolarisAuthStrings").emailConfirmationCodeSubheader(L),a[27]=L,a[28]=ee):ee=a[28];var te;a[29]!==V?(te=c.jsx(r("IGDSButton.react"),{display:"block",label:o("PolarisAuthStrings").EMAIL_CONFIRMATION_RESEND_CODE,onClick:V,variant:"primary_link"}),a[29]=V,a[30]=te):te=a[30];var ne;a[31]!==ee||a[32]!==te?(ne=c.jsxs(o("IGDSTextVariants.react").IGDSTextBody,{textAlign:"center",zeroMargin:!1,children:[ee," ",te]}),a[31]=ee,a[32]=te,a[33]=ne):ne=a[33];var re;a[34]!==Z||a[35]!==ne?(re=c.jsx(r("IGDSBox.react"),{display:"inlineBlock",marginBottom:4,marginTop:Z,position:"relative",children:ne}),a[34]=Z,a[35]=ne,a[36]=re):re=a[36];var oe;a[37]!==X||a[38]!==J||a[39]!==re?(oe=c.jsxs(r("IGDSBox.react"),{alignItems:"center",maxWidth:h,paddingX:7,paddingY:2,position:"relative",children:[X,J,re]}),a[37]=X,a[38]=J,a[39]=re,a[40]=oe):oe=a[40];var ae;a[41]===Symbol.for("react.memo_cache_sentinel")?(ae={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1n2onr6 xh8yej3"},a[41]=ae):ae=a[41];var ie;a[42]!==G?(ie=function(t){t.preventDefault(),G()},a[42]=G,a[43]=ie):ie=a[43];var le;a[44]===Symbol.for("react.memo_cache_sentinel")?(le=c.jsx("input",{className:"x1s85apg",type:"submit"}),a[44]=le):le=a[44];var se=b?7:10,ue;a[45]===Symbol.for("react.memo_cache_sentinel")?(ue={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1n2onr6 xh8yej3"},a[45]=ue):ue=a[45];var ce;a[46]!==k||a[47]!==P||a[48]!==l||a[49]!==b?(ce=c.jsx("div",babelHelpers.extends({},ue,{children:b===!0?c.jsx("div",babelHelpers.extends({},{0:{className:"x6s0dn4 x7r02ix x1yvgwvq xjd31um x1ixjvfu xwt6s21 x1obq294 x5a5i1n xde0f50 x15x8krk x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu x178xt8z x1lun4ml xso031l xpilrb4 x9f619 x5n08af x78zum5 x1q0g3np xvs91rp x1n2onr6 xh8yej3"},1:{className:"x6s0dn4 x7r02ix x1obq294 x5a5i1n xde0f50 x15x8krk x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu x178xt8z x1lun4ml xso031l xpilrb4 x9f619 x5n08af x78zum5 x1q0g3np xvs91rp x1n2onr6 xh8yej3 x19gtwsn xhpglom x1xp9za0 x1fqc88y"}}[!!P<<0],{children:c.jsx(r("PolarisLabeledTextInput.react"),{"aria-label":o("PolarisAuthStrings").EMAIL_CONFIRMATION_CODE,autoComplete:"off",isRedesignedSignupFieldInput:!0,maxLength:8,name:"email_confirmation_code",onBlur:function(){return N(!1)},onChange:B,onFocus:function(){N(!0),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:"email",containermodule:l,event_name:"confirmation_interaction"})},placeholder:o("PolarisAuthStrings").EMAIL_CONFIRMATION_CODE,slimTextInputCol:!0,type:"text",value:k})})):c.jsx(r("PolarisIGCoreTextInput.react"),{"aria-label":o("PolarisAuthStrings").EMAIL_CONFIRMATION_CODE,autoComplete:"off",backgroundColor:"ig-secondary-background",maxLength:8,name:"email_confirmation_code",onChange:B,onFocus:function(){o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:"email",containermodule:l,event_name:"confirmation_interaction"})},placeholder:o("PolarisAuthStrings").EMAIL_CONFIRMATION_CODE,value:k})})),a[46]=k,a[47]=P,a[48]=l,a[49]=b,a[50]=ce):ce=a[50];var de;a[51]!==M||a[52]!==q||a[53]!==G||a[54]!==s||a[55]!==b||a[56]!==v?(de=v==="default"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xw7yly9 x1n2onr6 xh8yej3",children:c.jsx(r("IGDSButton.react"),{fullWidth:!0,isDisabled:M,isLoading:s,label:b===!0?o("PolarisGenericStrings").FINISH:o("PolarisGenericStrings").NEXT,onClick:G})}),b===!0?c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1xmf6yo x1n2onr6 xh8yej3",children:c.jsx(r("PolarisIGCoreButton.react"),{borderless:!1,color:"ig-secondary-button",fullWidth:!0,onClick:q,children:o("PolarisGenericStrings").BACK_TEXT})}):c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xw7yly9 x1n2onr6",children:c.jsx(r("IGDSButton.react"),{display:"block",isDisabled:s,label:o("PolarisGenericStrings").GO_BACK,onClick:q,variant:"primary_link"})})]}),a[51]=M,a[52]=q,a[53]=G,a[54]=s,a[55]=b,a[56]=v,a[57]=de):de=a[57];var me;a[58]!==w?(me=w!=null&&c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xw7yly9 x1n2onr6",children:c.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"errorOrDestructive",textAlign:"center",zeroMargin:!1,children:w})}),a[58]=w,a[59]=me):me=a[59];var pe;a[60]!==se||a[61]!==ce||a[62]!==de||a[63]!==me?(pe=c.jsxs(r("IGDSBox.react"),{alignItems:"center",margin:"auto",marginBottom:2,marginTop:2,maxWidth:h,paddingX:se,position:"relative",children:[ce,de,me]}),a[60]=se,a[61]=ce,a[62]=de,a[63]=me,a[64]=pe):pe=a[64];var _e;a[65]!==M||a[66]!==q||a[67]!==G||a[68]!==s||a[69]!==v?(_e=v==="modal"&&c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1sy10c2 x1n2onr6 xh8yej3",children:c.jsx(r("IGDSDialogFooter.react"),{endAdornment:c.jsx(r("IGDSButton.react"),{display:"block",isDisabled:M,isLoading:s,label:o("PolarisAuthStrings").CONTINUE,onClick:G,variant:"primary_link"}),startAdornment:c.jsx(r("IGDSButton.react"),{display:"block",label:o("PolarisGenericStrings").BACK_TEXT,onClick:q,variant:"primary_link"})})}),a[65]=M,a[66]=q,a[67]=G,a[68]=s,a[69]=v,a[70]=_e):_e=a[70];var fe;a[71]!==ie||a[72]!==pe||a[73]!==_e?(fe=c.jsx("div",babelHelpers.extends({},ae,{children:c.jsxs("form",{method:"POST",noValidate:!1,onSubmit:ie,children:[le,pe,_e]})})),a[71]=ie,a[72]=pe,a[73]=_e,a[74]=fe):fe=a[74];var ge;return a[75]!==oe||a[76]!==fe?(ge=c.jsxs(c.Fragment,{children:[oe,fe]}),a[75]=oe,a[76]=fe,a[77]=ge):ge=a[77],ge}function C(e){var t;return(t=e.auth.signup)==null?void 0:t.signupResult}l.default=y}),226);
__d("PolarisPhoneSignupChangeNumberForm.react",["fbt","PolarisGenericStrings","PolarisIGCoreButton.react","PolarisSlimTextInput.react","isStringNullOrEmpty","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e,d=c.useEffect,m=c.useRef,p=c.useState,_="phoneSignupConfirmErrorAlert",f=s._(/*BTDS*/"Nuevo n\u00famero de tel\u00e9fono");function g(e){var t=o("react-compiler-runtime").c(36),n=e.errorMessage,a=e.initialPhoneNumber,i=e.onGoBackClick,l=e.onSubmit,c=e.requestInFlight,g=m(null),h=p(""),y=h[0],C=h[1],b,v;t[0]===Symbol.for("react.memo_cache_sentinel")?(b=function(){var e;(e=g.current)==null||e.focus()},v=[],t[0]=b,t[1]=v):(b=t[0],v=t[1]),d(b,v);var S;t[2]!==y||t[3]!==l?(S=function(t){t.preventDefault(),l(y)},t[2]=y,t[3]=l,t[4]=S):S=t[4];var R=S,L;t[5]===Symbol.for("react.memo_cache_sentinel")?(L=function(t){C(t.target.value)},t[5]=L):L=t[5];var E=L,k,I,T,D,x,$;t[6]===Symbol.for("react.memo_cache_sentinel")?(I={className:"x889kno xyri2b x1a8lsjc x1c1uobl"},T=u.jsx("h2",{className:"x972fbf x10w94by x1qhh985 x14e42zd x1lliihq xln7xf2 x1jchvi3 x1s688f xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl x2b8uid x11njtxf",children:s._(/*BTDS*/"Cambiar n\u00famero de tel\u00e9fono")}),D={className:"x972fbf x10w94by x1qhh985 x14e42zd x1lliihq xln7xf2 x1f6kntn x1fcty0u xd4r4e8 xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl x2b8uid x11njtxf"},x=u.jsx("span",{className:"x972fbf x10w94by x1qhh985 x14e42zd x5n08af xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl x11njtxf",children:s._(/*BTDS*/"N\u00famero de tel\u00e9fono actual:")}),$=u.jsx("br",{}),k={className:"x972fbf x10w94by x1qhh985 x14e42zd x1roi4f4 xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl x11njtxf"},t[6]=k,t[7]=I,t[8]=T,t[9]=D,t[10]=x,t[11]=$):(k=t[6],I=t[7],T=t[8],D=t[9],x=t[10],$=t[11]);var P;t[12]!==a?(P=u.jsxs("p",babelHelpers.extends({},D,{children:[x,$,u.jsx("span",babelHelpers.extends({},k,{children:a}))]})),t[12]=a,t[13]=P):P=t[13];var N;t[14]===Symbol.for("react.memo_cache_sentinel")?(N={className:"x972fbf x10w94by x1qhh985 x14e42zd x78zum5 xdt5ytf xln7xf2 xk390pu xdj266r x14z9mp x1lziwak x1yztbdb xexx8yu xyri2b x18d9i69 x1c1uobl x11njtxf"},t[14]=N):N=t[14];var M;t[15]===Symbol.for("react.memo_cache_sentinel")?(M="xdj266r x11gldyt x1iymm2a x11hdunq",t[15]=M):M=t[15];var w;t[16]!==y?(w=u.jsx(r("PolarisSlimTextInput.react"),{"aria-label":f,"aria-required":"true",autoCapitalize:"off",autoCorrect:"off",className:M,name:"newPhoneNumber",onChange:E,placeholder:f,ref:g,type:"tel",value:y}),t[16]=y,t[17]=w):w=t[17];var A;t[18]===Symbol.for("react.memo_cache_sentinel")?(A={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1yztbdb x11gldyt x11hdunq x1n2onr6"},t[18]=A):A=t[18];var F;t[19]===Symbol.for("react.memo_cache_sentinel")?(F=s._(/*BTDS*/"Cambiar"),t[19]=F):F=t[19];var O;t[20]!==R||t[21]!==c?(O=u.jsx("div",babelHelpers.extends({},A,{children:u.jsx(r("PolarisIGCoreButton.react"),{loading:c,onClick:R,children:F})})),t[20]=R,t[21]=c,t[22]=O):O=t[22];var B;t[23]!==R||t[24]!==w||t[25]!==O?(B=u.jsxs("form",babelHelpers.extends({},N,{method:"POST",onSubmit:R,children:[w,O]})),t[23]=R,t[24]=w,t[25]=O,t[26]=B):B=t[26];var W;t[27]!==n?(W=!r("isStringNullOrEmpty")(n)&&u.jsx("div",{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 xkmlbd1 x78zum5 xdt5ytf x2lah0s xln7xf2 x1f6kntn xd4r4e8 xdj266r x11gldyt xyorhqc x11hdunq xexx8yu xyri2b x18d9i69 x1c1uobl x1n2onr6 x2b8uid x11njtxf",children:u.jsx("p",{"aria-atomic":"true",id:_,role:"alert",children:n})}),t[27]=n,t[28]=W):W=t[28];var q;t[29]!==i?(q=u.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:i,children:o("PolarisGenericStrings").GO_BACK}),t[29]=i,t[30]=q):q=t[30];var U;return t[31]!==P||t[32]!==B||t[33]!==W||t[34]!==q?(U=u.jsxs("div",babelHelpers.extends({},I,{children:[T,P,B,W,q]})),t[31]=P,t[32]=B,t[33]=W,t[34]=q,t[35]=U):U=t[35],U}l.default=g}),226);
__d("PolarisPhoneSignupConfirmForm.react",["fbt","IGDSBox.react","IGDSButton.react","IGDSText.react","IGDSTextVariants.react","PolarisGenericStrings","PolarisIGCoreButton.react","PolarisLabeledTextInput.react","PolarisMultiSignupConstants","PolarisReactRedux.react","PolarisRegistrationLogger","PolarisSlimTextInput.react","qex","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e,d=c.useCallback,m=c.useEffect,p=c.useRef,_=c.useState,f="phoneSignupConfirmErrorAlert",g="confirmationCodeDescription",h=s._(/*BTDS*/"Solo un paso m\u00e1s");function y(e){return s._(/*BTDS*/"Ingresa el c\u00f3digo de 6 d\u00edgitos que enviamos al {phone number}.",[s._param("phone number",e)])}function C(e){return s._(/*BTDS*/"Ingresa el c\u00f3digo de 6\u00a0d\u00edgitos que enviamos al {phone number}.",[s._param("phone number",e)])}var b=s._(/*BTDS*/"Reenviar c\u00f3digo"),v=s._(/*BTDS*/"Cambiar n\u00famero"),S=s._(/*BTDS*/"C\u00f3digo de confirmaci\u00f3n"),R="######",L=s._(/*BTDS*/"Confirmar");function E(e,t){return u.jsx("div",{className:t,children:u.jsx("p",{"aria-atomic":"true",id:f,role:"alert",children:e})})}E.displayName=E.name+" [from "+i.id+"]";function k(e){var t=o("react-compiler-runtime").c(72),n=e.errorMessage,a=e.onChangeNumberClick,i=e.onResendClick,l=e.onSubmit,c=e.pageIdentifier,d=e.phoneNumber,f=e.requestInFlight,E=e.shouldShowRedesignedSignup,k=e.successMessage,x=E===void 0?!1:E,$=_(""),P=$[0],N=$[1],M=_(!1),w=M[0],A=M[1],F=p(null),O=_(!1),B=O[0],W=O[1],q,U;t[0]===Symbol.for("react.memo_cache_sentinel")?(q=function(){(F==null?void 0:F.current)!=null&&F.current.focus()},U=[],t[0]=q,t[1]=U):(q=t[0],U=t[1]),m(q,U);var V=D,H=T,G=o("PolarisReactRedux.react").useSelector(I),z;t[2]!==P||t[3]!==l||t[4]!==G?(z=function(){o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:"phone",event_name:"twofac_form_next_clicked"});var e=P.replace(/\s+/g,"");if((G==null?void 0:G.fields)!=null){var t=Object.keys(G.fields).reduce(function(e,t){var n,r=(n=G.fields[t])==null?void 0:n.value;return r!=null&&t!=="optIntoOneTap"&&(e[t]=r),e},{});t.twofac=e,l(t)}},t[2]=P,t[3]=l,t[4]=G,t[5]=z):z=t[5];var j=z,K;t[6]===Symbol.for("react.memo_cache_sentinel")?(K=function(t){var e=t.target.value;e.match(/^[0-9 ]*$/)&&N(e)},t[6]=K):K=t[6];var Q=K,X;t[7]!==P.length||t[8]!==j||t[9]!==w?(X=function(){w||P.length===o("PolarisMultiSignupConstants").TWO_FAC_CODE_MIN_LENGTH&&r("qex")._("2156")===!0&&(A(!0),j())},t[7]=P.length,t[8]=j,t[9]=w,t[10]=X):X=t[10];var Y;t[11]!==P||t[12]!==j||t[13]!==w?(Y=[P,j,w],t[11]=P,t[12]=j,t[13]=w,t[14]=Y):Y=t[14],m(X,Y);var J;t[15]===Symbol.for("react.memo_cache_sentinel")?(J={className:"x889kno xyri2b x1a8lsjc x1c1uobl"},t[15]=J):J=t[15];var Z,ee;t[16]===Symbol.for("react.memo_cache_sentinel")?(ee={className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xziim83 x110972j x1n2onr6"},Z={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1e56ztr x1xmf6yo x1n2onr6"},t[16]=Z,t[17]=ee):(Z=t[16],ee=t[17]);var te;t[18]!==x?(te=u.jsx("div",babelHelpers.extends({},Z,{children:x?u.jsx(r("IGDSText.react"),{color:"primaryText",size:"title",textAlign:"center",weight:"bold",zeroMargin:!1,children:h}):u.jsx(r("IGDSText.react"),{size:"label",textAlign:"center",weight:"semibold",zeroMargin:!1,children:h})})),t[18]=x,t[19]=te):te=t[19];var ne=x?1:4,re=x?2:4,oe;t[20]!==d||t[21]!==x?(oe=x?C(d):y(d),t[20]=d,t[21]=x,t[22]=oe):oe=t[22];var ae;t[23]!==oe?(ae=u.jsx(o("IGDSTextVariants.react").IGDSTextBody,{textAlign:"center",zeroMargin:!1,children:oe}),t[23]=oe,t[24]=ae):ae=t[24];var ie;t[25]!==ne||t[26]!==re||t[27]!==ae?(ie=u.jsx(r("IGDSBox.react"),{marginBottom:ne,marginTop:re,position:"relative",children:ae}),t[25]=ne,t[26]=re,t[27]=ae,t[28]=ie):ie=t[28];var le;t[29]!==i||t[30]!==x?(le=x===!0&&u.jsx("div",{className:"x9f619 x1rg5ohu x1c4vz4f x2lah0s xieb3on x1n2onr6",children:u.jsx(r("IGDSButton.react"),{display:"block",label:b,onClick:function(t){i(t)},variant:"primary_link"})}),t[29]=i,t[30]=x,t[31]=le):le=t[31];var se;t[32]!==te||t[33]!==ie||t[34]!==le?(se=u.jsxs("div",babelHelpers.extends({id:g},ee,{children:[te,ie,le]})),t[32]=te,t[33]=ie,t[34]=le,t[35]=se):se=t[35];var ue;t[36]===Symbol.for("react.memo_cache_sentinel")?(ue={className:"x972fbf x10w94by x1qhh985 x14e42zd x78zum5 xdt5ytf xln7xf2 xk390pu xdj266r x14z9mp x1lziwak x1yztbdb xexx8yu xyri2b x18d9i69 x1c1uobl x11njtxf"},t[36]=ue):ue=t[36];var ce;t[37]!==j?(ce=function(t){t.preventDefault(),j()},t[37]=j,t[38]=ce):ce=t[38];var de;t[39]!==P||t[40]!==B||t[41]!==c||t[42]!==x?(de=x===!0?u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1yztbdb xziim83 x110972j",children:u.jsx("div",babelHelpers.extends({},{0:{className:"x6s0dn4 x7r02ix x1yvgwvq xjd31um x1ixjvfu xwt6s21 x1obq294 x5a5i1n xde0f50 x15x8krk x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu x178xt8z x1lun4ml xso031l xpilrb4 x9f619 x5n08af x78zum5 x1q0g3np xvs91rp x1n2onr6 xh8yej3"},1:{className:"x6s0dn4 x7r02ix x1obq294 x5a5i1n xde0f50 x15x8krk x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu x178xt8z x1lun4ml xso031l xpilrb4 x9f619 x5n08af x78zum5 x1q0g3np xvs91rp x1n2onr6 xh8yej3 x19gtwsn xhpglom x1xp9za0 x1fqc88y"}}[!!B<<0],{children:u.jsx(r("PolarisLabeledTextInput.react"),{"aria-label":S,autoComplete:"off",isRedesignedSignupFieldInput:!0,maxLength:8,name:"phone_confirmation_code",onBlur:function(){return W(!1)},onChange:Q,onFocus:function(){W(!0),o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:"phone",containermodule:c,event_name:"confirmation_interaction"})},placeholder:S,slimTextInputCol:!0,type:"text",value:P})}))}):u.jsx(r("PolarisSlimTextInput.react"),{"aria-describedby":g,"aria-label":R,"aria-required":"true",autoCapitalize:"off",autoCorrect:"off",className:"xdj266r x11gldyt x1iymm2a x11hdunq",maxLength:6,name:"confirmationCode",onChange:Q,onFocus:function(){o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:"phone",containermodule:c,event_name:"confirmation_interaction"})},placeholder:R,ref:F,type:"tel",value:P}),t[39]=P,t[40]=B,t[41]=c,t[42]=x,t[43]=de):de=t[43];var me;t[44]!==P.length||t[45]!==n||t[46]!==j||t[47]!==a||t[48]!==f||t[49]!==x||t[50]!==k?(me=x===!0?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xv54qhq xf7dkkf x1n2onr6 xh8yej3",children:u.jsx(r("IGDSButton.react"),{fullWidth:!0,isDisabled:P.length<o("PolarisMultiSignupConstants").TWO_FAC_CODE_MIN_LENGTH||f,isLoading:f,label:o("PolarisGenericStrings").FINISH,onClick:j})}),u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1xmf6yo xv54qhq xf7dkkf x1n2onr6 xh8yej3",children:u.jsx(r("PolarisIGCoreButton.react"),{borderless:!1,color:"ig-secondary-button",fullWidth:!0,onClick:a,children:v})}),n!=null&&n!==""&&u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xw7yly9 x1n2onr6",children:u.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"errorOrDestructive",textAlign:"center",zeroMargin:!1,children:n})}),k!=null&&k!==""&&u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xw7yly9 x1n2onr6",children:u.jsx(o("IGDSTextVariants.react").IGDSTextBody,{textAlign:"center",zeroMargin:!1,children:k})})]}):u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1yztbdb x11gldyt x11hdunq x1n2onr6",children:u.jsx(r("PolarisIGCoreButton.react"),{loading:f,onClick:j,children:L})}),t[44]=P.length,t[45]=n,t[46]=j,t[47]=a,t[48]=f,t[49]=x,t[50]=k,t[51]=me):me=t[51];var pe;t[52]!==ce||t[53]!==de||t[54]!==me?(pe=u.jsxs("form",babelHelpers.extends({},ue,{method:"POST",onSubmit:ce,children:[de,me]})),t[52]=ce,t[53]=de,t[54]=me,t[55]=pe):pe=t[55];var _e;t[56]!==n||t[57]!==x?(_e=!x&&n!=null&&n!==""&&V(n),t[56]=n,t[57]=x,t[58]=_e):_e=t[58];var fe;t[59]!==x||t[60]!==k?(fe=!x&&k!=null&&k!==""&&H(k),t[59]=x,t[60]=k,t[61]=fe):fe=t[61];var ge;t[62]!==a||t[63]!==i||t[64]!==x?(ge=!x&&u.jsxs("div",{className:"x5n08af x1lliihq x1f6kntn x1fcty0u xd4r4e8 xdj266r x11gldyt x1yztbdb x11hdunq x2b8uid",children:[u.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:a,children:s._(/*BTDS*/"Cambiar n\u00famero")})," | ",u.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:i,children:s._(/*BTDS*/"Solicitar nuevo c\u00f3digo")})]}),t[62]=a,t[63]=i,t[64]=x,t[65]=ge):ge=t[65];var he;return t[66]!==se||t[67]!==pe||t[68]!==_e||t[69]!==fe||t[70]!==ge?(he=u.jsxs("div",babelHelpers.extends({},J,{children:[se,pe,_e,fe,ge]})),t[66]=se,t[67]=pe,t[68]=_e,t[69]=fe,t[70]=ge,t[71]=he):he=t[71],he}function I(e){var t;return(t=e.auth.signup)==null?void 0:t.signupResult}function T(e){return E(e,"x1f6kntn xd4r4e8 xdj266r x11gldyt xyorhqc x11hdunq x2b8uid x5n08af")}function D(e){return E(e,"x1f6kntn xd4r4e8 xdj266r x11gldyt xyorhqc x11hdunq x2b8uid xkmlbd1")}l.default=k}),226);
__d("PolarisPhoneSignupForm.react",["fbt","invariant","FBLogger","PolarisAssetManagerGlyphMapping","PolarisIGCoreIcon.react","PolarisPhoneSignupChangeNumberForm.react","PolarisPhoneSignupConfirmForm.react","PolarisReactRedux.react","PolarisRegistrationLogger","PolarisSignupActions","isStringNullOrEmpty","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s,u){"use strict";var e,c=e||(e=o("react")),d=e.useEffect,m=s._(/*BTDS*/"Confirmaci\u00f3n del tel\u00e9fono");function p(e){var t=o("react-compiler-runtime").c(38),n=e.onSubmit,a=e.pageIdentifier,i=e.requestInFlight,l=e.shouldShowRedesignedSignup,p=l===void 0?!1:l,y=o("PolarisReactRedux.react").useSelector(h),C=o("PolarisReactRedux.react").useSelector(g),b=o("PolarisReactRedux.react").useSelector(f),v=o("PolarisReactRedux.react").useSelector(_),S=o("PolarisReactRedux.react").useDispatch(),R;t[0]!==S?(R=function(){return S(o("PolarisSignupActions").switchPhoneSignupStep("changePhoneNumber"))},t[0]=S,t[1]=R):R=t[1];var L=R,E;t[2]!==S?(E=function(){return S(o("PolarisSignupActions").switchPhoneSignupStep("enterCode"))},t[2]=S,t[3]=E):E=t[3];var k=E,I;t[4]!==S?(I=function(t){return S(o("PolarisSignupActions").rerequestSMSCode(t))},t[4]=S,t[5]=I):I=t[5];var T=I,D;t[6]!==S?(D=function(){return S(o("PolarisSignupActions").rerequestSMSCode())},t[6]=S,t[7]=D):D=t[7];var x=D;!r("isStringNullOrEmpty")(C)||u(0,51615);var $,P;t[8]!==a?($=function(){o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:"phone",containermodule:a,event_name:"form_load",step:"twofac"})},P=[a],t[8]=a,t[9]=$,t[10]=P):($=t[9],P=t[10]),d($,P);var N;if(b==="enterCode"){var M;t[11]!==v?(M=v&&c.jsx("div",{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 x5n08af x78zum5 xdt5ytf x2lah0s xln7xf2 x1f6kntn xd4r4e8 x1anpbxc x3aesyq xyorhqc xqsn43r xexx8yu xyri2b x18d9i69 x1c1uobl x1n2onr6 x2b8uid x11njtxf",children:s._(/*BTDS*/"Se reenvi\u00f3 tu c\u00f3digo.")}),t[11]=v,t[12]=M):M=t[12];var w;t[13]!==L||t[14]!==x||t[15]!==n||t[16]!==a||t[17]!==C||t[18]!==i||t[19]!==p||t[20]!==y?(w=c.jsx(r("PolarisPhoneSignupConfirmForm.react"),{errorMessage:y,onChangeNumberClick:L,onResendClick:x,onSubmit:n,pageIdentifier:a,phoneNumber:C,requestInFlight:i,shouldShowRedesignedSignup:p,successMessage:null}),t[13]=L,t[14]=x,t[15]=n,t[16]=a,t[17]=C,t[18]=i,t[19]=p,t[20]=y,t[21]=w):w=t[21];var A;t[22]!==M||t[23]!==w?(A=c.jsxs("div",{children:[M,w]}),t[22]=M,t[23]=w,t[24]=A):A=t[24],N=A}else if(b==="changePhoneNumber"){var F;t[25]!==T||t[26]!==k||t[27]!==C||t[28]!==i||t[29]!==y?(F=c.jsx(r("PolarisPhoneSignupChangeNumberForm.react"),{errorMessage:y,initialPhoneNumber:C,onGoBackClick:k,onSubmit:T,requestInFlight:i}),t[25]=T,t[26]=k,t[27]=C,t[28]=i,t[29]=y,t[30]=F):F=t[30],N=F}else return r("FBLogger")("ig_web").mustfix("Unexpected phone signup step"),null;var O;t[31]===Symbol.for("react.memo_cache_sentinel")?(O={className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1n2onr6"},t[31]=O):O=t[31];var B;t[32]!==b||t[33]!==p?(B=(!p||b==="changePhoneNumber")&&c.jsx(r("PolarisIGCoreIcon.react"),{alt:m,icon:o("PolarisAssetManagerGlyphMapping").ICONS.PHONE_CONFIRM}),t[32]=b,t[33]=p,t[34]=B):B=t[34];var W;return t[35]!==N||t[36]!==B?(W=c.jsxs("div",babelHelpers.extends({},O,{children:[B,N]})),t[35]=N,t[36]=B,t[37]=W):W=t[37],W}function _(e){var t;return((t=e.auth.signup)==null?void 0:t.resentResetCode)||!1}function f(e){var t;return(t=e.auth.signup)==null?void 0:t.phoneSignupConfirmStep}function g(e){var t;return(t=e.auth.signup)==null||(t=t.signupCredentials)==null?void 0:t.phoneNumber}function h(e){var t;return(t=e.auth.signup)==null?void 0:t.signupNonSpecificError}l.default=p}),226);
__d("PolarisEmailDomainHelpers",["PolarisConfig","memoize"],(function(t,n,r,o,a,i,l){"use strict";var e={"aol.com":{initialSuggestion:!1},"bk.ru":{countryCodeFilter:"RU",initialSuggestion:!1},"gmail.com":{initialSuggestion:!0},"gmx.de":{countryCodeFilter:"DE",initialSuggestion:!1},"hotmail.com":{initialSuggestion:!0},"icloud.com":{initialSuggestion:!1},"inbox.ru":{countryCodeFilter:"RU",initialSuggestion:!1},"list.ru":{countryCodeFilter:"RU",initialSuggestion:!1},"live.com":{initialSuggestion:!1},"mail.ru":{countryCodeFilter:"RU",initialSuggestion:!1},"msn.com":{initialSuggestion:!1},"naver.com":{initialSuggestion:!1},"onet.pl":{countryCodeFilter:"PL",initialSuggestion:!1},"outlook.com":{initialSuggestion:!0},"qq.com":{initialSuggestion:!1},"rambler.ru":{countryCodeFilter:"RU",initialSuggestion:!1},"web.de":{countryCodeFilter:"DE",initialSuggestion:!1},"yahoo.co.jp":{countryCodeFilter:"JP",initialSuggestion:!1},"yahoo.com":{initialSuggestion:!0},"yandex.com":{initialSuggestion:!1},"yandex.ru":{countryCodeFilter:"RU",initialSuggestion:!1}},s=r("memoize")(function(){return Object.keys(e).filter(function(t){var n=e[t];return"countryCodeFilter"in n?n.countryCodeFilter===o("PolarisConfig").getCountryCode():!0})}),u=r("memoize")(function(){return s().reduce(function(t,n){var r=e[n];return r.initialSuggestion?[].concat(t,[n]):t},[])}),c={"gail.com":"gmail.com","gamel.com":"gmail.com","gamil.com":"gmail.com","gamli.com":"gmail.com","gemil.com":"gmail.com","gma.com":"gmail.com","gmail.co":"gmail.com","gmaile.com":"gmail.com","gmali.com":"gmail.com","gmall.com":"gmail.com","gmel.com":"gmail.com","gmeli.com":"gmail.com","gmile.com":"gmail.com"};function d(e){var t=e.split("@"),n=t[0],r=t[1];return r&&Object.prototype.hasOwnProperty.call(c,r)?n+"@"+c[r]:null}l.getPopularDomainList=s,l.getInitialSuggestedPopularDomains=u,l.getSuggestedEmail=d}),98);
__d("PolarisMultiSignupEmailSuggestionDialog.react",["fbt","IGCoreDialog.react","PolarisRegistrationLogger","memoizeStringOnly","react"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=(function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return t=e.call.apply(e,[this].concat(a))||this,t.handleSuggestionClick=function(e){e===t.props.emailSuggestion?o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:e,contactpoint_type:"email",event_name:"typo_fix_accept"}):o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint:e,contactpoint_type:"email",event_name:"typo_fix_skip"}),t.props.onSelection(e)},t.$1=r("memoizeStringOnly")(function(e){return t.handleSuggestionClick.bind(babelHelpers.assertThisInitialized(t),e)}),babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.getEmailDomain=function(t){return t.split("@")[1]},n.render=function(){var e=this.props,t=e.emailSuggestion,n=e.originalEmail;return u.jsxs(o("IGCoreDialog.react").IGCoreDialog,{body:s._(/*BTDS*/"Parece que no escribiste tu direcci\u00f3n de correo electr\u00f3nico correctamente. \u00bfQuer\u00edas usar {filled email domain}?",[s._param("filled email domain",u.jsx("span",{className:"x972fbf x10w94by x1qhh985 x14e42zd xln7xf2 xk390pu xl7tqy7 xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl x11njtxf",children:"@"+this.getEmailDomain(n)}))]),onModalClose:this.props.onClose,title:s._(/*BTDS*/"\u00bfCometiste un error?"),children:[u.jsx(o("IGCoreDialog.react").IGCoreDialogItem,{color:"ig-primary-button",onClick:this.$1(t),children:s._(/*BTDS*/"Usar {email suggestion} en su lugar",[s._param("email suggestion","@"+this.getEmailDomain(t))])}),u.jsx(o("IGCoreDialog.react").IGCoreDialogItem,{onClick:this.$1(n),children:s._(/*BTDS*/"Dejarla igual")})]})},t})(u.Component);l.default=c}),226);
__d("PolarisOrBar.react",["PolarisAuthStrings","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){var t=o("react-compiler-runtime").c(13),n=e.isElevated,r=e.shouldShowRedesignedSignup,a=n===void 0?!1:n,i=r===void 0?!1:r,l;t[0]!==a?(l={0:"x11mr3az x1iyjqo2 xs83m0k xjm9jq1 x1n2onr6 xwtuau4",2:"x1iyjqo2 xs83m0k xjm9jq1 x1n2onr6 xwtuau4 x11mr3az",1:"x1iyjqo2 xs83m0k xjm9jq1 x1n2onr6 xwtuau4 x1e9ncm4",3:"x1iyjqo2 xs83m0k xjm9jq1 x1n2onr6 xwtuau4 x1e9ncm4"}[(a!==!0)<<1|(a===!0)<<0],t[0]=a,t[1]=l):l=t[1];var u=l,c;t[2]===Symbol.for("react.memo_cache_sentinel")?(c={className:"x78zum5 x1q0g3np"},t[2]=c):c=t[2];var d;t[3]!==u?(d=s.jsx("div",{className:u}),t[3]=u,t[4]=d):d=t[4];var m;t[5]!==i?(m=!i&&s.jsx("div",{className:"x1qjc9v5 x972fbf x10w94by x1qhh985 x14e42zd x9f619 x1roi4f4 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nxh6w3 x1s688f x1ly1vsg xdj266r x14iifvp xat24cr xnkmj2t xexx8yu xyri2b x18d9i69 x1c1uobl x1n2onr6 xtvhhri x11njtxf",children:o("PolarisAuthStrings").OR}),t[5]=i,t[6]=m):m=t[6];var p;t[7]!==u?(p=s.jsx("div",{className:u}),t[7]=u,t[8]=p):p=t[8];var _;return t[9]!==d||t[10]!==m||t[11]!==p?(_=s.jsxs("div",babelHelpers.extends({},c,{children:[d,m,p]})),t[9]=d,t[10]=m,t[11]=p,t[12]=_):_=t[12],_}l.default=u}),98);
__d("isEmail",[],(function(t,n,r,o,a,i){var e=/^[\w!#\$%&\'\*\+\/\=\?\^`\{\|\}~\-]+(:?\.[\w!#\$%&\'\*\+\/\=\?\^`\{\|\}~\-]+)*@(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?$/i;function l(t){return e.test(t)}i.default=l}),66);
__d("PolarisSlimSignupUsernameSuggestions.react",["IGDSBox.react","IGDSButton.react","PolarisRegistrationLogger","gkx","isEmail","polarisIsPhoneNumber","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e,c=u.useEffect,d=u.useState,m=38,p=134;function _(e){return e==null||e===""?null:r("isEmail")(e)?"email":r("polarisIsPhoneNumber")(e)?"phone":null}function f(e){var t=o("react-compiler-runtime").c(28),n=e.emailOrPhone,a=e.onUsernameUpdate,i=e.pageIdentifier,l=e.shouldShowUsername,u=e.username,f=e.usernameSuggestions,h=l===void 0?!0:l,y;t[0]!==f?(y=f.filter(g),t[0]=f,t[1]=y):y=t[1];var C=y,b=d(C),v=b[0],S=b[1],R=d(!1),L=R[0],E=R[1],k,I;t[2]!==C||t[3]!==i?(k=function(){C.length>0&&o("PolarisRegistrationLogger").logRegistrationEvent({containermodule:i,event_name:"username_suggestion_fetch_success"}),S(C)},I=[C,i],t[2]=C,t[3]=i,t[4]=k,t[5]=I):(k=t[4],I=t[5]),c(k,I);var T;t[6]!==C[0]||t[7]!==C.length||t[8]!==L||t[9]!==a||t[10]!==h||t[11]!==u?(T=function(){if(!L){if(u!=null&&u!=="")E(!0);else if(C.length>0){var e,t=!h||((e=r("gkx")("3317"))!=null?e:!1);t&&a(C[0]),E(!0)}}},t[6]=C[0],t[7]=C.length,t[8]=L,t[9]=a,t[10]=h,t[11]=u,t[12]=T):T=t[12];var D;if(t[13]!==C||t[14]!==L||t[15]!==a||t[16]!==h||t[17]!==u?(D=[u,C,L,a,h],t[13]=C,t[14]=L,t[15]=a,t[16]=h,t[17]=u,t[18]=D):D=t[18],c(T,D),C.length===0||!h)return null;var x;if(t[19]!==n||t[20]!==a||t[21]!==v){var $;t[23]!==n||t[24]!==a?($=function(t){return s.jsx("div",{className:"x13t61ll x1kchd1x x1u0fnx4 xbxn0j6 x6ikm8r x10wlt62 x1n2onr6",style:{height:m,width:p},children:s.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1e56ztr x2fvf9 x1n2onr6",children:s.jsx(r("IGDSButton.react"),{label:t,onClick:function(){o("PolarisRegistrationLogger").logRegistrationEvent({contactpoint_type:_(n),event_name:"click_username_suggestions"}),a(t)},variant:"secondary"})})},t)},t[23]=n,t[24]=a,t[25]=$):$=t[25],x=v.slice(0,2).map($),t[19]=n,t[20]=a,t[21]=v,t[22]=x}else x=t[22];var P;return t[26]!==x?(P=s.jsx(r("IGDSBox.react"),{direction:"row",height:m,marginEnd:10,marginStart:10,position:"relative",children:x}),t[26]=x,t[27]=P):P=t[27],P}function g(e){return e.length<14}l.default=f}),98);
__d("PolarisTermsPrivacyPolicyBlurb.react",["fbt","IGDSTextVariants.react","PolarisConsentTypes","PolarisExternalRoutes","PolarisFastLink.react","PolarisReactRedux.react","PolarisRoutes","URI","gkx","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u,c=u||(u=o("react"));function d(t,n){return new(e||(e=r("URI")))(t).addQueryData({entry_point:n}).toString()}var m="ig_polaris_email_signup_eu_terms",p="ig_polaris_email_signup_eu_privacy_policy",_="ig_polaris_email_signup_eu_cookies_policy",f="ig_polaris_email_signup_row_terms",g="ig_polaris_email_signup_row_privacy_policy",h="ig_polaris_email_signup_row_cookies_policy";function y(){return r("gkx")("25366")===!0}function C(e){var t=o("react-compiler-runtime").c(3),n=e.className,a;t[0]===Symbol.for("react.memo_cache_sentinel")?(a=c.jsx(o("IGDSTextVariants.react").IGDSTextBody2,{color:"secondaryText",zeroMargin:!1,children:s._(/*BTDS*/"Al registrarte, aceptas nuestras {=Terms} y la {=Privacy Policy}.",[s._param("=Terms",c.jsx(r("PolarisFastLink.react"),{href:"/legal/terms/",target:"_blank",children:s._(/*BTDS*/"Condiciones")})),s._param("=Privacy Policy",c.jsx(r("PolarisFastLink.react"),{href:"/legal/privacy/",target:"_blank",children:s._(/*BTDS*/"Pol\u00edtica de privacidad")}))])}),t[0]=a):a=t[0];var i;return t[1]!==n?(i=c.jsx("p",{className:n,children:a}),t[1]=n,t[2]=i):i=t[2],i}function b(e){return e===void 0&&(e=!0),c.jsxs(c.Fragment,{children:[c.jsx(o("IGDSTextVariants.react").IGDSTextBody2,{color:"secondaryText",zeroMargin:!1,children:s._(/*BTDS*/"Es posible que las personas que usan nuestro servicio hayan subido tu informaci\u00f3n de contacto a Instagram. {Contact uploading for non-users privacy policy}",[s._param("Contact uploading for non-users privacy policy",c.jsx(r("PolarisFastLink.react"),{href:o("PolarisExternalRoutes").FACEBOOK_CONTACT_UPLOADING_AND_NON_USERS,target:"_blank",children:s._(/*BTDS*/"M\u00e1s informaci\u00f3n")}))])}),e&&c.jsxs(c.Fragment,{children:[c.jsx("br",{}),c.jsx("br",{})]})]})}function v(e){var t=o("react-compiler-runtime").c(7),n=e.className,a;t[0]===Symbol.for("react.memo_cache_sentinel")?(a=c.jsxs(o("IGDSTextVariants.react").IGDSTextBody2,{color:"secondaryText",zeroMargin:!1,children:[b(),s._(/*BTDS*/"Al registrarte, aceptas nuestras {=Terms}. Obt\u00e9n informaci\u00f3n sobre c\u00f3mo recopilamos, usamos y compartimos tus datos en la {Privacy Policy}, as\u00ed como el uso que hacemos de las cookies y tecnolog\u00edas similares en la {Cookies Policy}.",[s._param("=Terms",c.jsx(r("PolarisFastLink.react"),{href:d(o("PolarisExternalRoutes").NEW_LEGAL_TERMS_PATH,m),target:"_blank",children:s._(/*BTDS*/"Condiciones")})),s._param("Privacy Policy",c.jsx(r("PolarisFastLink.react"),{href:d(o("PolarisExternalRoutes").NEW_PRIVACY_POLICY_PATH,p),target:"_blank",children:s._(/*BTDS*/"Pol\u00edtica de privacidad")})),s._param("Cookies Policy",c.jsx(r("PolarisFastLink.react"),{href:d(o("PolarisRoutes").NEW_COOKIE_POLICY_PATH,_),target:"_blank",children:s._(/*BTDS*/"Pol\u00edtica de cookies")}))])]}),t[0]=a):a=t[0];var i,l;t[1]!==n?(i=c.jsx("p",{className:n,children:a}),l=y()&&c.jsx("p",{className:n,children:c.jsx(o("IGDSTextVariants.react").IGDSTextBody2,{color:"secondaryText",zeroMargin:!1,children:s._(/*BTDS*/"Nosotros {=fund our services} mediante el uso de tus datos personales para mostrar anuncios.",[s._param("=fund our services",c.jsx(r("PolarisFastLink.react"),{href:d(o("PolarisExternalRoutes").NEW_LEGAL_TERMS_PATH,m),target:"_blank",children:s._(/*BTDS*/"financiamos nuestros servicios")}))])})}),t[1]=n,t[2]=i,t[3]=l):(i=t[2],l=t[3]);var u;return t[4]!==i||t[5]!==l?(u=c.jsxs(c.Fragment,{children:[i,l]}),t[4]=i,t[5]=l,t[6]=u):u=t[6],u}function S(e){var t=o("react-compiler-runtime").c(3),n=e.className,a;t[0]===Symbol.for("react.memo_cache_sentinel")?(a=c.jsxs(o("IGDSTextVariants.react").IGDSTextBody2,{color:"secondaryText",zeroMargin:!1,children:[b(),s._(/*BTDS*/"Al registrarte, aceptas nuestras {=Terms}, la {Privacy Policy} y la {Cookies Policy}.",[s._param("=Terms",c.jsx(r("PolarisFastLink.react"),{href:d(o("PolarisExternalRoutes").NEW_LEGAL_TERMS_PATH,f),target:"_blank",children:s._(/*BTDS*/"Condiciones")})),s._param("Privacy Policy",c.jsx(r("PolarisFastLink.react"),{href:d(o("PolarisExternalRoutes").NEW_PRIVACY_POLICY_PATH,g),target:"_blank",children:s._(/*BTDS*/"Pol\u00edtica de privacidad")})),s._param("Cookies Policy",c.jsx(r("PolarisFastLink.react"),{href:d(o("PolarisRoutes").NEW_COOKIE_POLICY_PATH,h),target:"_blank",children:s._(/*BTDS*/"Pol\u00edtica de cookies")}))])]}),t[0]=a):a=t[0];var i;return t[1]!==n?(i=c.jsx("p",{className:n,children:a}),t[1]=n,t[2]=i):i=t[2],i}function R(e){var t=o("react-compiler-runtime").c(3),n=e.className,r;t[0]===Symbol.for("react.memo_cache_sentinel")?(r=b(!1),t[0]=r):r=t[0];var a;return t[1]!==n?(a=c.jsx("p",{className:n,children:r}),t[1]=n,t[2]=a):a=t[2],a}function L(e){var t=o("react-compiler-runtime").c(8),n=e.className,r=e.cpeOnly,a=e.tosVersion,i=r===void 0?!1:r;if(i){var l;return t[0]!==n?(l=c.jsx(R,{className:n}),t[0]=n,t[1]=l):l=t[1],l}switch(a){case o("PolarisConsentTypes").TosVersion.EU:{var s;return t[2]!==n?(s=c.jsx(v,{className:n}),t[2]=n,t[3]=s):s=t[3],s}case o("PolarisConsentTypes").TosVersion.ROW:{var u;return t[4]!==n?(u=c.jsx(S,{className:n}),t[4]=n,t[5]=u):u=t[5],u}case o("PolarisConsentTypes").TosVersion.DEFAULT:default:{var d;return t[6]!==n?(d=c.jsx(C,{className:n}),t[6]=n,t[7]=d):d=t[7],d}}}function E(e){return{tosVersion:e.signup.tosVersion}}var k=o("PolarisReactRedux.react").connect(E)(L);l.default=k}),226);
__d("whitelistObjectKeys",[],(function(t,n,r,o,a,i){function e(e,t){for(var n={},r=Array.isArray(t)?t:Object.keys(t),o=0;o<r.length;o++)typeof e[r[o]]!="undefined"&&(n[r[o]]=e[r[o]]);return n}i.default=e}),66);
__d("PolarisSlimSignupForm.react",["cx","fbt","IGDSBox.react","IGDSSpinner.react","IGDSText.react","IGDSTextVariants.react","PolarisAgeCollectionHelpers","PolarisAuthConstants","PolarisAuthLimitedRegistrationHelpers","PolarisAuthStrings","PolarisBirthdaysAdditionalInfoModal.react","PolarisDOBFieldSelect.react","PolarisDateHelpers","PolarisDateStrings","PolarisEmailDomainHelpers","PolarisFastLink.react","PolarisGenericStrings","PolarisIGCoreButton.react","PolarisLinkBuilder","PolarisLoggedOutCtaClickLogger","PolarisLoggedOutUpsellStrings","PolarisMultiSignupEmailSuggestionDialog.react","PolarisOrBar.react","PolarisRegistrationLogger","PolarisRelayEnvironment","PolarisSlimSignupUsernameSuggestions.react","PolarisSlimTextInput.react","PolarisTermsPrivacyPolicyBlurb.react","PolarisUA","PolarisWebStorage","fetchPolarisLoggedOutExperiment","gkx","joinClasses","nullthrows","polarisIsPhoneNumber","polarisSignupSelectors","promiseDone","react","whitelistObjectKeys"],(function(t,n,r,o,a,i,l,s,u){"use strict";var e,c=e||(e=o("react")),d=["username","password","emailOrPhone","fullName","optIntoOneTap"],m=(function(e){function t(t){var n,a,i,l,s,u,c;c=e.call(this,t)||this,c.$5=function(){c.setState({emailSuggestion:null})},c.$6=function(e){c.setState({emailOrPhone:e,emailSuggestion:null},function(){c.$7()})},c.$8=function(){var e,t=c.props.usernameSuggestions.indexOf((e=c.state.username)!=null?e:"");c.setState({username:c.props.usernameSuggestions[++t]||c.props.usernameSuggestions[0]}),o("PolarisRegistrationLogger").logRegistrationEvent({containermodule:c.props.pageIdentifier,event_name:"suggested_username_refreshed"})},c.$9=function(e){var t,n=e.target,r=n.name,o=n.value;c.setState((t={},t[r]=o,t))},c.$10=function(){var e=c.state.isPasswordHidden;c.setState({isPasswordHidden:!e}),e?o("PolarisRegistrationLogger").logRegistrationEvent({containermodule:c.props.pageIdentifier,event_name:"show_password_clicked"}):o("PolarisRegistrationLogger").logRegistrationEvent({containermodule:c.props.pageIdentifier,event_name:"hide_password_clicked"})},c.$11=function(e){e.relatedTarget instanceof HTMLElement&&c.$1&&c.$1.contains(e.relatedTarget)||c.$4(c.state,null)},c.$12=function(e,t){var n=e.target.name;c.$4(c.state,n),t&&o("PolarisRegistrationLogger").logRegistrationEvent({containermodule:c.props.pageIdentifier,event_name:t})},c.$14=function(e){var t;e.preventDefault();var n=c.state.emailOrPhone;if(o("PolarisRegistrationLogger").logRegistrationEvent({containermodule:c.props.pageIdentifier,event_name:"base_form_next_clicked"}),n!=null&&!r("polarisIsPhoneNumber")(n)){var a=o("PolarisEmailDomainHelpers").getSuggestedEmail(n);if(a!=null){c.setState({emailSuggestion:a});return}}var i=(t=c.props.signupResult)==null||(t=t.fields)==null||(t=t.username)==null?void 0:t.error;if(i!==void 0||c.state.username==null||c.state.username===""){c.setState({shouldShowUsername:!0});return}c.$7()},c.$15=function(e){e.keyCode===13&&c.$14(e)},c.$22=function(e){c.setState({username:e})},c.$23=function(){var e=c.props.pageIdentifier;o("PolarisLoggedOutCtaClickLogger").logLoggedOutCtaClickEvent("login","auth_form",e)},c.$25=function(e){c.setState({birthday:e}),o("PolarisRegistrationLogger").logRegistrationEvent({containermodule:c.props.pageIdentifier,event_name:"birthday_interaction"})},c.$26=function(){c.setState({showBirthdayAdditionalInfo:!0})},c.$27=function(){c.setState({showBirthdayAdditionalInfo:!1})};var d={birthday:((n=t.signupResult)==null||(n=n.fields)==null||(n=n.birthday)==null?void 0:n.value)!=null?o("PolarisDateHelpers").dateToDateType(new Date(t.signupResult.fields.birthday.value)):o("PolarisDateHelpers").getOneYearAgoDateType(),emailOrPhone:((a=t.signupResult)==null||(a=a.fields)==null||(a=a.emailOrPhone)==null?void 0:a.value)||"",emailSuggestion:null,fullName:(i=(l=(s=t.signupResult)==null||(s=s.fields)==null||(s=s.fullName)==null?void 0:s.value)!=null?l:t.initialFullName)!=null?i:"",isPasswordHidden:!0,optIntoOneTap:!1,shouldShowUsername:t.shouldAutoPickUsername!==!0,showBirthdayAdditionalInfo:!1,username:((u=t.signupResult)==null||(u=u.fields)==null||(u=u.username)==null?void 0:u.value)||""};if(c.props.needEmailOrPhone){var m,p,_;d.emailOrPhone=(m=(p=(_=t.signupResult)==null||(_=_.fields)==null||(_=_.emailOrPhone)==null?void 0:_.value)!=null?p:c.props.prefillPhoneNumber)!=null?m:""}return c.props.needPassword&&(d.password=""),c.state=d,c.$2={},c.$3=!1,c}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this.props.pageIdentifier==="fbSignupPage"?"fb_signup_form_load":"form_load";o("PolarisRegistrationLogger").logRegistrationEvent({containermodule:this.props.pageIdentifier,event_name:e,fb_userid:this.props.fbUserID,fbconnect_status:this.props.fbConnectedStatus})},n.componentDidUpdate=function(t,n){var e,r=this.props;((e=this.state.username)!=null?e:"").length===0&&this.props.usernameSuggestions.length===0&&r.usernameSuggestions.length>=1&&this.setState({username:r.usernameSuggestions[0]});var o=this.state;t.usernameSuggestions.length===0&&r.usernameSuggestions.length>=1&&n.username!==o.username&&this.$4(o,"username")},n.focusUsername=function(){r("nullthrows")(this.$2.username).focus()},n.$4=function(t,n){var e=this.props.onSignupFocusChange;if(e){var o=r("whitelistObjectKeys")(t,d);e(o,n)}},n.$13=function(){var e,t,n,a,i;if(this.props.requestInFlight||this.props.shouldShowBirthdayStepInBaseForm===!0&&o("PolarisAgeCollectionHelpers").isDOBInputAttemptDisabled(this.state.birthday))return!0;var l=(e=this.props.signupResult)==null?void 0:e.fields,s=l==null||(t=l.emailOrPhone)==null?void 0:t.error,u=l==null||(n=l.username)==null?void 0:n.error,c=l==null||(a=l.password)==null?void 0:a.error,d=l==null||(i=l.fullName)==null?void 0:i.error;if(s!==void 0||this.state.shouldShowUsername&&u!==void 0||c!==void 0||d!==void 0){r("promiseDone")(r("fetchPolarisLoggedOutExperiment")(r("PolarisRelayEnvironment"),{name:"ig_web_desktop_signup_disable_next_button_on_error"}));var m=r("gkx")("16475")===!0;return m}var p=this.props,_=p.needEmailOrPhone,f=p.needPassword,g=this.state,h=g.emailOrPhone,y=g.password,C=g.username;return o("polarisSignupSelectors").getSubmitDisabled({needEmailOrPhone:_,needPassword:f},{emailOrPhone:h,password:y,username:C},this.state.shouldShowUsername)},n.$7=function(){var e,t=r("whitelistObjectKeys")(this.state,d);this.props.shouldShowBirthdayStepInBaseForm===!0&&(t.birthday=o("PolarisDateHelpers").dateTypeToString(this.state.birthday),this.props.onBirthdayEntered&&this.props.onBirthdayEntered()),(e=r("PolarisWebStorage").getSessionStorage())==null||e.setItem("nux_username",String(!this.state.shouldShowUsername)),this.$3=!0,this.props.onSubmit(t)},n.$16=function(t){var e;return!!(this.props.signupResult&&(e=this.props.signupResult.fields[t])!=null&&e.validated)},n.$17=function(t){var e,n=(e=this.props.signupResult)==null?void 0:e.fields;if(t==="emailOrPhone"){var r;return(n==null||(r=n.emailOrPhone)==null?void 0:r.value)!==this.state.emailOrPhone}else if(t==="username"){var o;return(n==null||(o=n.username)==null?void 0:o.value)!==this.state.username}else if(t==="password"){var a;return(n==null||(a=n.password)==null?void 0:a.value)!==this.state.password}return!1},n.$18=function(t){var e=this.props,n=e.focusedFields,r=e.signupResult,o=r==null?void 0:r.wasDryRun,a=!o;if(n){var i=n.current===t,l=n.previous.indexOf(t)>-1,s=!i&&l,u=this.$17(t)===!1;a=(s||i)&&u}if(a){var c;return r==null||(c=r.fields)==null||(c=c[t])==null?void 0:c.error}return null},n.$19=function(t){return c.jsx("div",{className:"_aaht",children:c.jsx("p",{"aria-atomic":"true",id:o("PolarisAuthConstants").SLIM_SIGNUP_FORM_ALERT_ID,role:"alert",children:t})})},n.$20=function(){return o("PolarisUA").isMobile()?o("PolarisAuthStrings").FB_CONTINUE_BUTTON_TEXT:o("PolarisAuthStrings").FB_LOGIN_BUTTON_TEXT},n.$21=function(t){var e=this.props.hideHeader;if(e)return null;var n=t===!0?o("PolarisLoggedOutUpsellStrings").DEFAULT_TITLE_SIGN_UP:o("PolarisAuthStrings").SIGN_UP_VALUE_PROP_WITHOUT_GRADIENT;return o("PolarisUA").isMobile()?c.jsx("div",{className:"_aahx",children:c.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"secondaryText",textAlign:"center",zeroMargin:!0,children:n})}):c.jsx("div",{className:"_aahw",children:t===!0?c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1e56ztr x1gslohp",children:c.jsx(r("IGDSText.react"),{color:"primaryText",size:"headline2",textAlign:"center",weight:"semibold",zeroMargin:!1,children:n})}):c.jsx(o("IGDSTextVariants.react").IGDSTextSection,{color:"secondaryText",textAlign:"center",zeroMargin:!0,children:n})})},n.$24=function(){return this.props.shouldShowRedesignedSignup!==!0?null:c.jsx(r("PolarisFastLink.react"),{href:o("PolarisLinkBuilder").buildLoginLink("",{source:"auth_switcher"}),onClick:this.$23,children:c.jsx(o("IGDSTextVariants.react").IGDSTextBodyEmphasized,{color:"primaryButton",textAlign:"center",zeroMargin:!1,children:u._(/*BTDS*/"Iniciar sesi\u00f3n con una cuenta existente")})})},n.$28=function(){return this.props.shouldShowBirthdayStepInBaseForm!==!0?null:c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1e56ztr xpdvgm7 x14vqqas x1n2onr6",children:c.jsx(o("IGDSTextVariants.react").IGDSTextBodyEmphasized,{color:"primaryText",textAlign:"start",zeroMargin:!1,children:o("PolarisAuthStrings").BIRTHDAY_TEXT})}),c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1e56ztr xpdvgm7 x1xmf6yo x1n2onr6",children:c.jsx(r("PolarisDOBFieldSelect.react"),{align:"start",date:this.state.birthday,onDateChange:this.$25,shouldShowRedesignedSignup:!0})}),c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1n2onr6",children:c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1e56ztr x13fj5qh xziim83 x110972j x1n2onr6",children:c.jsxs(o("IGDSTextVariants.react").IGDSTextBody2,{color:"secondaryText",textAlign:"center",zeroMargin:!1,children:[o("PolarisDateStrings").BIRTHDAY_DISCLAIMER_TEXT,c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:this.$26,children:c.jsx(o("IGDSTextVariants.react").IGDSTextBody2,{color:"primaryButton",zeroMargin:!1,children:o("PolarisGenericStrings").LEARN_MORE})})]})})})]})},n.render=function(){var e,t,n=this,a=this.props,i=a.canUsePhone,l=a.shouldShowRedesignedSignup,s=a.signupNonSpecificError,d=a.signupResult,m=this.state.shouldShowUsername,p=!!(this.props.usernameSuggestions.length&&(!this.props.needEmailOrPhone||this.state.emailOrPhone)),_=d==null?void 0:d.otherError;s!=null&&(_=s);var f=_!=null&&(d==null?void 0:d.wasDryRun)===!0,g=this.$18("emailOrPhone"),h=this.$18("fullName"),y=this.$18("username"),C=this.$18("password"),b=l===!0?"_aueq":o("PolarisUA").isMobile()?"_aahv":"_aahy",v=(d==null||(e=d.fields.username)==null?void 0:e.errorCode)==null||(d==null||(t=d.fields.username)==null?void 0:t.errorCode)==="username_is_taken";return c.jsxs("div",{className:r("joinClasses")(this.props.className,"_aahz"),"data-testid":void 0,children:[this.state.emailSuggestion!=null?c.jsx(r("PolarisMultiSignupEmailSuggestionDialog.react"),{emailSuggestion:this.state.emailSuggestion,onClose:this.$5,onSelection:this.$6,originalEmail:r("nullthrows")(this.state.emailOrPhone)}):null,c.jsxs("form",{className:r("joinClasses")("_aah-",l===!0?"_auep":null),method:"post",onBlur:this.$11,onSubmit:this.$14,ref:function(t){return n.$1=t},children:[this.$21(l===!0),!this.props.hideFBOption&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1e56ztr x11gldyt x11hdunq x1xmf6yo x1n2onr6",children:c.jsxs(r("PolarisIGCoreButton.react"),{onClick:this.props.onSignupWithFBClick,showLegacyPrimaryColor:l===!0,children:[c.jsx("span",{className:(l!==!0?"_9zlu":"")+" _aah_"}),this.$20()]})}),c.jsx("div",{className:(l!==!0?"_aai0":"")+(l===!0?" _aueu":""),children:c.jsx(r("PolarisOrBar.react"),{shouldShowRedesignedSignup:l===!0})})]}),this.props.needEmailOrPhone&&c.jsx(r("PolarisSlimTextInput.react"),{accepted:this.$16("emailOrPhone"),"aria-describedby":g!=null&&!f?o("PolarisAuthConstants").SLIM_SIGNUP_FORM_ALERT_ID:void 0,"aria-label":i?o("PolarisAuthStrings").EMAIL_OR_PHONE:o("PolarisAuthStrings").EMAIL,"aria-required":"true",autoCapitalize:"off",autoComplete:"tel",autoCorrect:"off",className:b,errorMessage:g,hasError:!!g,isInputFocused:!0,isRedesignedSignupFieldInput:l,name:"emailOrPhone",onChange:this.$9,onFocus:function(t){return n.$12(t,"contactpoint_interaction")},onKeyDown:this.$15,placeholder:i?o("PolarisAuthStrings").EMAIL_OR_PHONE:o("PolarisAuthStrings").EMAIL,ref:function(t){return n.$2.emailOrPhone=t},value:this.state.emailOrPhone}),this.props.needPassword&&c.jsx(r("PolarisSlimTextInput.react"),{accepted:this.$16("password"),"aria-describedby":C!=null&&!f?o("PolarisAuthConstants").SLIM_SIGNUP_FORM_ALERT_ID:void 0,"aria-label":o("PolarisAuthStrings").PASSWORD,"aria-required":"true",autoCapitalize:"off",autoComplete:"new-password",autoCorrect:"off",className:b,errorMessage:C,hasError:!!C,isInputFocused:!0,isPasswordHidden:this.state.isPasswordHidden,isRedesignedSignupFieldInput:l,name:"password",onChange:this.$9,onFocus:function(t){return n.$12(t,"password_interaction")},onKeyDown:this.$15,onPasswordToggle:this.$10,placeholder:o("PolarisAuthStrings").PASSWORD,ref:function(t){return n.$2.password=t},showPasswordToggleLink:!!this.state.password,type:this.state.isPasswordHidden?"password":"text",value:this.state.password}),this.props.shouldEnableShortFirstStep===!0?null:c.jsx(r("PolarisSlimTextInput.react"),{accepted:this.$16("fullName"),"aria-describedby":h!=null&&!f?o("PolarisAuthConstants").SLIM_SIGNUP_FORM_ALERT_ID:void 0,"aria-label":o("PolarisAuthStrings").FULL_NAME,"aria-required":"false",autoCapitalize:"sentences",autoCorrect:"off",className:b,errorMessage:h,hasError:!!h,isInputFocused:!0,isRedesignedSignupFieldInput:l,name:"fullName",onChange:this.$9,onFocus:function(t){return n.$12(t,"name_interaction_full_name")},onKeyDown:this.$15,placeholder:o("PolarisAuthStrings").FULL_NAME,ref:function(t){return n.$2.fullName=t},value:this.state.fullName}),m&&c.jsx(r("PolarisSlimTextInput.react"),{accepted:this.$16("username"),"aria-describedby":y!=null&&!f?o("PolarisAuthConstants").SLIM_SIGNUP_FORM_ALERT_ID:void 0,"aria-label":o("PolarisAuthStrings").USERNAME,"aria-required":"true",autoCapitalize:"off",autoCorrect:"off",canRefresh:p,className:b,errorMessage:y,hasError:!!y,isInputFocused:!0,isRedesignedSignupFieldInput:l,maxLength:30,name:"username",omitErrorMarginBottom:v,onChange:this.$9,onFocus:function(t){return n.$12(t,"username_interaction")},onKeyDown:this.$15,onRefresh:this.$8,placeholder:o("PolarisAuthStrings").USERNAME,ref:function(t){return n.$2.username=t},value:this.state.username}),v&&c.jsx("div",{className:"xc26acl x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xdwrcjd",children:c.jsx(r("PolarisSlimSignupUsernameSuggestions.react"),{emailOrPhone:this.state.emailOrPhone,onUsernameUpdate:this.$22,pageIdentifier:this.props.pageIdentifier,shouldShowUsername:m,username:this.state.username,usernameSuggestions:this.props.usernameSuggestions})}),this.$28(),o("PolarisUA").isDesktop()&&c.jsx(r("PolarisTermsPrivacyPolicyBlurb.react"),{className:"_aai1",cpeOnly:o("PolarisAuthLimitedRegistrationHelpers").shouldShowSouthKoreaTOS()}),c.jsxs("div",{children:[c.jsx(r("IGDSBox.react"),{marginBottom:l===!0?3:2,marginEnd:10,marginStart:10,marginTop:2,position:"relative",children:c.jsx(r("PolarisIGCoreButton.react"),{disabled:this.$13(),onClick:this.$14,type:"submit",children:!this.props.gdprRequired&&o("PolarisUA").isDesktop()?u._(/*BTDS*/"Registrarte"):u._(/*BTDS*/"Siguiente")})}),this.props.requestInFlight?c.jsx(r("IGDSSpinner.react"),{position:"absolute"}):null]}),this.$24(),_!=null&&!f&&this.$19(_)]}),this.state.showBirthdayAdditionalInfo&&c.jsx(r("PolarisBirthdaysAdditionalInfoModal.react"),{onClose:this.$27})]})},t})(c.Component);m.defaultProps={hideFBOption:!1,hideHeader:!1,needPassword:!0},l.default=m}),226);
__d("polarisIsEligibleForFacebookLogin",["PolarisConfig","PolarisQueryParams"],(function(t,n,r,o,a,i,l){"use strict";var e={CN:!0,CU:!0,IR:!0,KP:!0},s=/^((preprod|business|www)\.)?([a-z0-9-]+\.){0,}instagram\.com$/;function u(t){return!!e[t]}function c(e){return s.test(e)}function d(){return c(window.location.hostname)&&!u(o("PolarisConfig").getCountryCode()||"")&&(!o("PolarisQueryParams").hasForceAuthenticationParam()||o("PolarisQueryParams").hasEnableFBLoginParam())}l.default=d}),98);
__d("PolarisSignupForm.react",["invariant","CometRouteURL","IGCoreDialog.react","PolarisAcceptTermsOfUseForm.react","PolarisAccountPrivacyForm.react","PolarisAgeCollectionHelpers","PolarisAuthStrings","PolarisBirthdaySignupForm.react","PolarisCaptchaSignupForm.react","PolarisEmailConfirmationForm.react","PolarisFBConnectHelpers","PolarisFBConnectStatus","PolarisGenericStrings","PolarisLoggedOutCtaClickLogger","PolarisPhoneSignupForm.react","PolarisReactRedux.react","PolarisRegistrationLogger","PolarisRoutes","PolarisSignupActions","PolarisSignupTypes","PolarisSlimSignupForm.react","PolarisUA","polarisIsEligibleForFacebookLogin","react","vulture"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=(function(e){function t(t){var n;return n=e.call(this,t)||this,n.$1=function(){o("PolarisRegistrationLogger").logRegistrationEvent({containermodule:n.props.pageIdentifier,event_name:"fbconnect_click",fb_userid:n.props.fbUserID,fbconnect_status:n.props.fbConnectedStatus});var e=o("PolarisRoutes").FXCAL_DISCLOSURE_PATH;o("PolarisLoggedOutCtaClickLogger").logLoggedOutCtaClickEvent("fb_connect","auth_form",n.props.pageIdentifier),o("PolarisFBConnectHelpers").redirectToFBOAuth(e,"signupPage")},n.state={showFacebookLogin:r("polarisIsEligibleForFacebookLogin")()},n}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=o("CometRouteURL").getWindowURLParams()||{},t=e.hide_fb_signup;t&&this.setState({showFacebookLogin:!1})},n.$2=function(){return o("PolarisUA").isDesktop()&&!1},n.render=function(){switch(this.props.step){case o("PolarisSignupTypes").STEP.emailConfirmation:return u.jsx(r("PolarisEmailConfirmationForm.react"),{onSubmit:this.props.onSignup,pageIdentifier:this.props.pageIdentifier,requestInFlight:this.props.requestInFlight,shouldShowRedesignedSignup:this.props.shouldShowRedesignedSignup,signupNonSpecificError:this.props.signupNonSpecificError,style:this.props.style});case o("PolarisSignupTypes").STEP.phoneConfirmation:return u.jsx(r("PolarisPhoneSignupForm.react"),{onSubmit:this.props.onSignup,pageIdentifier:this.props.pageIdentifier,requestInFlight:this.props.requestInFlight,shouldShowRedesignedSignup:this.props.shouldShowRedesignedSignup,signupResult:this.props.signupResult,usernameSuggestions:this.props.usernameSuggestions});case o("PolarisSignupTypes").STEP.birthday:return u.jsxs(u.Fragment,{children:[u.jsx(r("PolarisBirthdaySignupForm.react"),{onBirthdayEntered:this.props.onBirthdayEntered,onSignup:this.props.onSignup,pageIdentifier:this.props.pageIdentifier,requestInFlight:this.props.requestInFlight,shouldShowBirthdayTransparency:this.props.shouldShowBirthdayTransparency,shouldShowRedesignedSignup:this.props.shouldShowRedesignedSignup,signupNonSpecificError:this.props.signupNonSpecificError,style:this.props.style}),this.props.signupAgeSpecificError!=null&&u.jsx(o("IGCoreDialog.react").IGCoreDialog,{onModalClose:this.props.onClearAgeError,title:o("PolarisAgeCollectionHelpers").WE_COULDNT_CREATE_AN_ACC,children:u.jsx(o("IGCoreDialog.react").IGCoreDialogItem,{onClick:this.props.onClearAgeError,children:o("PolarisGenericStrings").OK_TEXT})})]});case o("PolarisSignupTypes").STEP.accountPrivacy:return r("vulture")("CSF1e4Q94Qx1U5d393aPFU3T8yY="),u.jsx(r("PolarisAccountPrivacyForm.react"),{buttonLabel:o("PolarisGenericStrings").NEXT,defaultedToPrivate:!1,handleNext:function(){},subtitle:o("PolarisAuthStrings").ACCOUNT_PRIVACY_SUBHEADER_TEXT});case o("PolarisSignupTypes").STEP.acceptTerms:return u.jsx(r("PolarisAcceptTermsOfUseForm.react"),{onSignup:this.props.onSignup,requestInFlight:this.props.requestInFlight,signupNonSpecificError:this.props.signupNonSpecificError,style:this.props.style});case o("PolarisSignupTypes").STEP.captcha:return u.jsx(r("PolarisCaptchaSignupForm.react"),{onSignup:this.props.onSignup,requestInFlight:this.props.requestInFlight,signupNonSpecificError:this.props.signupNonSpecificError,style:this.props.style});case o("PolarisSignupTypes").STEP.base:default:{var e=this.$2()||!this.state.showFacebookLogin;return u.jsxs(u.Fragment,{children:[u.jsx(r("PolarisSlimSignupForm.react"),{canUsePhone:!0,errorNonce:this.props.errorNonce,fbConnectedStatus:this.props.fbConnectedStatus,fbUserID:this.props.fbUserID,focusedFields:this.props.focusedFields,gdprRequired:this.props.gdprRequired,hideFBOption:e,hideHeader:this.props.hideHeader,needEmailOrPhone:!0,onBirthdayEntered:this.props.onBirthdayEntered,onSignupFocusChange:this.props.onSignupFocusChange,onSignupWithFBClick:this.$1,onSubmit:this.props.onSignup,pageIdentifier:this.props.pageIdentifier,requestInFlight:this.props.requestInFlight,shouldAutoPickUsername:this.props.shouldAutoPickUsername,shouldEnableShortFirstStep:this.props.shouldEnableShortFirstStep,shouldShowBirthdayStepInBaseForm:this.props.shouldShowBirthdayStepInBaseForm,shouldShowRedesignedSignup:this.props.shouldShowRedesignedSignup,signupNonSpecificError:this.props.signupNonSpecificError,signupResult:this.props.signupResult,usernameSuggestions:this.props.usernameSuggestions}),this.props.signupAgeSpecificError!=null&&this.props.shouldShowBirthdayStepInBaseForm===!0&&u.jsx(o("IGCoreDialog.react").IGCoreDialog,{onModalClose:this.props.onClearAgeError,title:o("PolarisAgeCollectionHelpers").WE_COULDNT_CREATE_AN_ACC,children:u.jsx(o("IGCoreDialog.react").IGCoreDialogItem,{onClick:this.props.onClearAgeError,children:o("PolarisGenericStrings").OK_TEXT})})]})}}},t})(u.Component);function d(e,t){var n,r=e.auth,a=r.login&&r.login.submissionCount||r.signup&&r.signup.submissionCount||0,i=r.signup&&r.signup.requestInFlight||t.requestInFlight;return{errorNonce:a,fbConnectedStatus:e.fb.status,fbEligible:e.fb.status!==o("PolarisFBConnectStatus").STATUS.ineligible,fbUserID:e==null||(n=e.fb)==null||(n=n.authResponse)==null?void 0:n.userID,focusedFields:r.signup&&r.signup.signupFocusedField,gdprRequired:e.signup.gdprRequired,requestInFlight:i,signupAgeSpecificError:r.signup&&r.signup.signupAgeSpecificError,signupNonSpecificError:r.signup&&r.signup.signupNonSpecificError,signupResult:r.signup&&r.signup.signupResult,step:r.signup&&r.signup.step||o("PolarisSignupTypes").STEP.base,usernameSuggestions:r.signup&&r.signup.usernameSuggestions||[]}}function m(e,t){return{onBirthdayEntered:function(){e(o("PolarisSignupActions").processBirthday())},onClearAgeError:function(){e({errorMessage:void 0,type:"SIGNUP_ERROR"})},onSignup:function(r){r.emailOrPhone!=null||s(0,51567),e(o("PolarisSignupActions").validateFormAndContinue(r,t.pageIdentifier))},onSignupFocusChange:function(n,r){e(o("PolarisSignupActions").changeSignupFormFocus(n,r)),e(o("PolarisSignupActions").performDryRun(n))}}}var p=o("PolarisReactRedux.react").connect(d,m)(c);l.default=p}),98);
__d("PolarisAuthTestIDs",[],(function(t,n,r,o,a,i){"use strict";var e="login-error-message",l="login-info-message",s="login-success-message",u="auth-message-modal";i.DESKTOP_AUTH_ERROR_MESSAGE=e,i.DESKTOP_AUTH_INFO_MESSAGE=l,i.DESKTOP_AUTH_SUCCESS_MESSAGE=s,i.MOBILE_AUTH_MESSAGE_MODAL=u}),66);
__d("PolarisStopDeletionDialogStrings",["fbt","PolarisExternalLink.react","react"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=u.jsx(r("PolarisExternalLink.react"),{href:"https://help.instagram.com/370452623149242",children:s._(/*BTDS*/"M\u00e1s informaci\u00f3n")});function d(e,t){return t?s._(/*BTDS*/"\u00bfReactivar {username}?",[s._param("username",e)]):s._(/*BTDS*/"\u00bfQuieres seguir usando esta cuenta?")}function m(e,t,n){return n?s._(/*BTDS*/"La eliminaci\u00f3n definitiva de {username} est\u00e1 programada para el {date}. Si quieres seguir usando {username2}, puedes cancelar la eliminaci\u00f3n y reactivar el perfil.",[s._param("username",e),s._param("date",t),s._param("username2",e)]):s._(/*BTDS*/"Solicitaste la eliminaci\u00f3n de {username}. Si quieres conservar la cuenta, tienes tiempo hasta el {date} para avisarnos. De lo contrario, se eliminar\u00e1n todas tus publicaciones e informaci\u00f3n. {Learn More}",[s._param("username",e),s._param("date",t),s._param("Learn More",c)])}function p(e){return e?s._(/*BTDS*/"Reactivar perfil"):s._(/*BTDS*/"Conservar cuenta")}function _(e){return e?s._(/*BTDS*/"Ahora no"):s._(/*BTDS*/"Volver al inicio de sesi\u00f3n")}l.getDeletionTitleText=d,l.getDeletionBodyText=m,l.getDeletionKeepAccountText=p,l.getDeletionBackToLoginText=_}),226);
__d("PolarisStopDeletionDialog.react",["IGCoreDialog.react","PolarisLoginLogger","PolarisStopDeletionDialogStrings","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useEffect;function c(e){var t=o("react-compiler-runtime").c(26),n=e.isFeta,r=e.onClose,a=e.onStopDeletion,i=e.stopDeletionDate,l=e.stopDeletionNonce,c=e.username,m=n===void 0?!1:n,p;t[0]===Symbol.for("react.memo_cache_sentinel")?(p=[],t[0]=p):p=t[0],u(d,p);var _;t[1]!==m||t[2]!==i||t[3]!==c?(_=o("PolarisStopDeletionDialogStrings").getDeletionBodyText(c,i,m),t[1]=m,t[2]=i,t[3]=c,t[4]=_):_=t[4];var f;t[5]!==m||t[6]!==c?(f=o("PolarisStopDeletionDialogStrings").getDeletionTitleText(c,m),t[5]=m,t[6]=c,t[7]=f):f=t[7];var g;t[8]!==a||t[9]!==l?(g=function(){return a(l)},t[8]=a,t[9]=l,t[10]=g):g=t[10];var h;t[11]!==m?(h=o("PolarisStopDeletionDialogStrings").getDeletionKeepAccountText(m),t[11]=m,t[12]=h):h=t[12];var y;t[13]!==g||t[14]!==h?(y=s.jsx(o("IGCoreDialog.react").IGCoreDialogItem,{color:"ig-primary-button",onClick:g,children:h}),t[13]=g,t[14]=h,t[15]=y):y=t[15];var C;t[16]!==m?(C=o("PolarisStopDeletionDialogStrings").getDeletionBackToLoginText(m),t[16]=m,t[17]=C):C=t[17];var b;t[18]!==r||t[19]!==C?(b=s.jsx(o("IGCoreDialog.react").IGCoreDialogItem,{onClick:r,children:C}),t[18]=r,t[19]=C,t[20]=b):b=t[20];var v;return t[21]!==_||t[22]!==f||t[23]!==y||t[24]!==b?(v=s.jsxs(o("IGCoreDialog.react").IGCoreDialog,{body:_,title:f,children:[y,b]}),t[21]=_,t[22]=f,t[23]=y,t[24]=b,t[25]=v):v=t[25],v}function d(){o("PolarisLoginLogger").logLoginEvent({event_category:"stop_account_deletion_init",event_flow:"login_manual",event_name:"stop_account_deletion_dialog_shown",event_step:"stop_account_deletion"})}l.default=c}),98);
__d("usePolarisSendAccountRecoveryEmailForBoost",["PolarisAPISendAccountRecoveryEmail","PolarisAuthStrings","PolarisInstajax","PolarisLoginLogger","PolarisReactRedux.react","nullthrows","react-compiler-runtime","useIGDSToaster"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e instanceof o("PolarisInstajax").AjaxError&&e.message?e.message:o("PolarisAuthStrings").SEND_ACCOUNT_RECOVERY_LINK_FAILED_TEXT}function s(){var t=o("react-compiler-runtime").c(6),n=r("useIGDSToaster")(),a=n.add,i=o("PolarisReactRedux.react").useDispatch(),l=o("PolarisReactRedux.react").useSelector(u),s;t[0]!==a?(s=function(t){a({message:t,target:"bottom"},{duration:1e4})},t[0]=a,t[1]=s):s=t[1];var c=s,d;t[2]!==c||t[3]!==i||t[4]!==l?(d=function(){i({type:"ACCOUNT_RECOVERY_MODAL_DISMISSED"});var t=l.accountRecovery,n=t==null?void 0:t.targetUsername,a=n!=null?n:t==null?void 0:t.query,s={event_flow:"account_recovery",login_identifier:a!=null?a:void 0};o("PolarisLoginLogger").logLoginEvent(babelHelpers.extends({event_name:"boost_account_recovery_send_email_submit"},s)),o("PolarisAPISendAccountRecoveryEmail").sendAccountRecoveryEmail(r("nullthrows")(a)).then(function(e){c(e.toast_message),o("PolarisLoginLogger").logLoginEvent(babelHelpers.extends({event_name:"boost_account_recovery_send_email_success"},s))}).catch(function(t){c(e(t)),o("PolarisLoginLogger").logLoginEvent(babelHelpers.extends({event_name:"boost_account_recovery_send_email_error",extra_client_data:{error_message:t.message}},s))})},t[2]=c,t[3]=i,t[4]=l,t[5]=d):d=t[5];var m=d;return m}function u(e){return e.auth}l.default=s}),98);
__d("PolarisSlimLoginForm.react",["fbt","CometImage.react","IGDSBox.react","IGDSButton.react","IGDSCheckbox.react","IGDSIconButton.react","IGDSInfoPanoFilledIcon.react","IGDSText.react","IGDSTextVariants.react","InstagramQueryParamsHelper","PolarisAccountSwitcherActions","PolarisAuthStrings","PolarisAuthTestIDs","PolarisAuthTypeSwitcher.react","PolarisConsentQEHelpers","PolarisConsentStrings.react","PolarisFacebookLoginButtonRevamped","PolarisFastLink.react","PolarisIGCoreButton.react","PolarisIsLoggedIn","PolarisLoggedOutCtaClickLogger","PolarisLoginLogger","PolarisLoginQPL","PolarisOneTapLogin","PolarisOrBar.react","PolarisQueryParams","PolarisReactRedux.react","PolarisRoutes","PolarisSlimTextInput.react","PolarisStopDeletionDialog.react","PolarisThirdPartyAuthHelpers","PolarisTooManyAccountsDialog.react","PolarisUA","gkx","justknobx","qex","react","react-compiler-runtime","usePolarisPageID","usePolarisSendAccountRecoveryEmailForBoost"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e,d=c.useEffect,m=c.useMemo,p=c.useRef,_=c.useState,f="slfErrorAlert",g=6,h={profilePicture:{maxWidth:"x193iq5w",$$css:!0}};function y(e){var t=o("react-compiler-runtime").c(12),n=e.checkboxId,a=e.checkboxOnChange,i=e.checkboxState,l=e.checkboxText,s=e.disabled,c=o("PolarisReactRedux.react").useSelector(C),d=o("PolarisUA").isMobile()&&c&&o("PolarisIsLoggedIn").isLoggedIn()?4:10,m=s?"secondaryText":"primaryText",p;t[0]!==l||t[1]!==m?(p=u.jsx(o("IGDSTextVariants.react").IGDSTextBody2,{color:m,zeroMargin:!1,children:l}),t[0]=l,t[1]=m,t[2]=p):p=t[2];var _;t[3]!==a||t[4]!==i||t[5]!==s||t[6]!==p?(_=u.jsx(r("IGDSCheckbox.react"),{checkboxShape:"square",isChecked:i,isDisabled:s,name:"LoginCheckbox",onChange:a,size:16,zeroPadding:!0,children:p}),t[3]=a,t[4]=i,t[5]=s,t[6]=p,t[7]=_):_=t[7];var f;return t[8]!==n||t[9]!==d||t[10]!==_?(f=u.jsx(r("IGDSBox.react"),{id:n,marginBottom:3,marginEnd:2,marginStart:d,marginTop:3,position:"relative",children:_}),t[8]=n,t[9]=d,t[10]=_,t[11]=f):f=t[11],f}function C(e){return e.navigation.isAccountSwitcherOpen}function b(e){var t=o("react-compiler-runtime").c(23),n=e.fromLoggedOutDialog,a=e.hideForgotPassword,i=e.isThreadsRequest,l=e.newAuthDesign,c=e.onClick,d=n===void 0?!1:n,m=i===void 0?!1:i,p=l===void 0?!1:l,_=o("PolarisReactRedux.react").useDispatch(),f;t[0]!==_?(f=function(){return _(o("PolarisAccountSwitcherActions").closeAccountSwitcher())},t[0]=_,t[1]=f):f=t[1];var g=f,h=o("PolarisReactRedux.react").useSelector(v),y=m?"center":"end";if(a===!0)return null;var C;t[2]!==p?(C=p?s._(/*BTDS*/"\u00bfLa olvidaste?"):s._(/*BTDS*/"\u00bfOlvidaste tu contrase\u00f1a?"),t[2]=p,t[3]=C):C=t[3];var b=C,S=o("PolarisRoutes").PASSWORD_RESET_PATH;if(o("PolarisQueryParams").isFromLoginForAPI()){var R;t[4]===Symbol.for("react.memo_cache_sentinel")?(R=o("InstagramQueryParamsHelper").appendQueryParams(o("PolarisRoutes").PASSWORD_RESET_PATH,{source:"api-login"}),t[4]=R):R=t[4],S=R}else if(o("PolarisQueryParams").isFromFxcal()){var L;t[5]===Symbol.for("react.memo_cache_sentinel")?(L=o("InstagramQueryParamsHelper").appendQueryParams(o("PolarisRoutes").PASSWORD_RESET_PATH,{source:"fxcal"}),t[5]=L):L=t[5],S=L}var E;t[6]!==b||t[7]!==m||t[8]!==p?(E=m?u.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"secondaryText",textAlign:"center",zeroMargin:!1,children:b}):p?u.jsx(o("IGDSTextVariants.react").IGDSTextFootnote,{color:"link",maxLines:1,textAlign:"center",zeroMargin:!1,children:b}):o("PolarisUA").isMobile()?u.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"primaryButton",textAlign:"center",zeroMargin:!1,children:b}):u.jsx(r("IGDSText.react"),{color:"link",zeroMargin:!0,children:b}),t[6]=b,t[7]=m,t[8]=p,t[9]=E):E=t[9];var k=E,I;t[10]!==d||t[11]!==h||t[12]!==c||t[13]!==g?(I=function(t){c==null||c(),o("PolarisLoginLogger").logLoginEvent({event_flow:"login_manual",event_name:"forgot_password_click"}),o("PolarisLoginLogger").logLoginEvent({event_category:"search",event_flow:"account_recovery_start",event_name:"account_recovery_start",event_step:"search",extra_client_data:d?{event_source:"login_logged_out_dialog_forgot"}:null}),h&&g()},t[10]=d,t[11]=h,t[12]=c,t[13]=g,t[14]=I):I=t[14];var T=I,D;return t[15]!==b||t[16]!==T||t[17]!==h||t[18]!==m||t[19]!==y||t[20]!==p||t[21]!==k?(D=o("PolarisUA").isMobile()&&!(h&&o("PolarisIsLoggedIn").isLoggedIn())||m?u.jsx(r("IGDSBox.react"),{direction:"row",justifyContent:y,marginBottom:p?0:2,marginEnd:p?0:10,marginStart:10,paddingY:3,position:"relative",children:u.jsx(r("PolarisFastLink.react"),{href:S,onClick:T,children:k},"reset")}):u.jsx("div",{className:"xc26acl x1qjc9v5 xamitd3 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x14vqqas",children:u.jsx(r("IGDSButton.react"),{href:S,label:b,onClick:T,variant:o("PolarisUA").isMobile()&&h?"primary_link":"secondary_link"},"reset")}),t[15]=b,t[16]=T,t[17]=h,t[18]=m,t[19]=y,t[20]=p,t[21]=k,t[22]=D):D=t[22],D}function v(e){return e.navigation.isAccountSwitcherOpen}function S(e){var t=o("react-compiler-runtime").c(22),n=e.fromLoggedOutDialog,a=e.hideForgotPassword,i=e.isThreadsRequest,l=e.onForgotPasswordClick,s=e.onNavigate,c=n===void 0?!1:n,d=i===void 0?!1:i,m=o("PolarisReactRedux.react").useSelector(R);if(d)return null;if(o("PolarisUA").isMobile()&&!(m&&o("PolarisIsLoggedIn").isLoggedIn())){if(o("PolarisQueryParams").isFromFxcal()||o("PolarisQueryParams").hasDisableSignupParam())return null;var p;t[0]===Symbol.for("react.memo_cache_sentinel")?(p=o("PolarisConsentQEHelpers").shouldShowIPFingerPrintingDisclosure(),t[0]=p):p=t[0];var _=p,f;t[1]===Symbol.for("react.memo_cache_sentinel")?(f={className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xw7yly9 x1n2onr6"},t[1]=f):f=t[1];var g;t[2]!==s?(g=u.jsx(r("PolarisAuthTypeSwitcher.react"),{onNavigate:s}),t[2]=s,t[3]=g):g=t[3];var h;t[4]===Symbol.for("react.memo_cache_sentinel")?(h=_&&u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xq1608w xijc0j3 xktia5q",children:u.jsx(o("IGDSTextVariants.react").IGDSTextBody,{color:"secondaryText",textAlign:"center",zeroMargin:!1,children:o("PolarisConsentStrings.react").INSTAGRAM_TERMS_OF_USE_AND_PRIVACY_POLICY_TEXT})}),t[4]=h):h=t[4];var y;return t[5]!==g?(y=u.jsxs("div",babelHelpers.extends({},f,{children:[g,h]})),t[5]=g,t[6]=y):y=t[6],y}if(o("PolarisUA").isDesktop()&&!(m&&o("PolarisIsLoggedIn").isLoggedIn())&&o("PolarisQueryParams").hasEnableSignupWeb()){var C;t[7]!==c||t[8]!==a||t[9]!==l?(C=u.jsx(b,{fromLoggedOutDialog:c,hideForgotPassword:a,onClick:l}),t[7]=c,t[8]=a,t[9]=l,t[10]=C):C=t[10];var v;t[11]===Symbol.for("react.memo_cache_sentinel")?(v={className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xw7yly9 x1n2onr6"},t[11]=v):v=t[11];var S;t[12]!==c||t[13]!==s?(S=u.jsx("div",babelHelpers.extends({},v,{children:u.jsx(r("PolarisAuthTypeSwitcher.react"),{fromLoggedOutDialog:c,onNavigate:s})})),t[12]=c,t[13]=s,t[14]=S):S=t[14];var L;return t[15]!==C||t[16]!==S?(L=u.jsxs(u.Fragment,{children:[C,S]}),t[15]=C,t[16]=S,t[17]=L):L=t[17],L}var E;return t[18]!==c||t[19]!==a||t[20]!==l?(E=u.jsx(b,{fromLoggedOutDialog:c,hideForgotPassword:a,onClick:l}),t[18]=c,t[19]=a,t[20]=l,t[21]=E):E=t[21],E}function R(e){return e.navigation.isAccountSwitcherOpen}function L(e){var t=o("react-compiler-runtime").c(6),n=e.className,a=e.message,i=e.testid,l;t[0]!==n||t[1]!==a?(l=u.jsx("div",{className:n,children:a}),t[0]=n,t[1]=a,t[2]=l):l=t[2];var s;return t[3]!==l||t[4]!==i?(s=u.jsx(r("IGDSText.react"),{testid:void 0,zeroMargin:!1,children:l}),t[3]=l,t[4]=i,t[5]=s):s=t[5],s}function E(e){var t,n=o("react-compiler-runtime").c(20),a=e.errorMessage,i;n[0]===Symbol.for("react.memo_cache_sentinel")?(i="xkmlbd1 xvs91rp xd4r4e8 x1anpbxc x11gldyt xyorhqc x11hdunq x2b8uid",n[0]=i):i=n[0];var l;n[1]!==a?(l=u.jsx(L,{className:i,message:a,testid:void 0}),n[1]=a,n[2]=l):l=n[2];var s=l,c=r("usePolarisSendAccountRecoveryEmailForBoost")(),m=_(!1),p=m[0],f=m[1],g=a===o("PolarisAuthStrings").ERROR_LOGIN_PASSWORD_BOOST_ACCOUNT_RECOVERY||a===o("PolarisAuthStrings").ERROR_LOGIN_USERNAME_BOOST_ACCOUNT_RECOVERY,h=o("PolarisReactRedux.react").useSelector(k),y=h==null||(t=h.accountRecovery)==null||(t=t.options)==null?void 0:t.is_boost_user_eligible_for_account_recovery,C;n[3]!==p||n[4]!==c?(C=function(){p||(f(!0),c(),o("PolarisLoginLogger").logLoginEvent({event_flow:"account_recovery",event_name:"boost_account_recovery_error_message_click"}))},n[3]=p,n[4]=c,n[5]=C):C=n[5];var b=C,v;n[6]!==g?(v=function(){g&&o("PolarisLoginLogger").logLoginEvent({event_flow:"account_recovery",event_name:"boost_account_recovery_error_message_view"})},n[6]=g,n[7]=v):v=n[7];var S;if(n[8]!==a||n[9]!==g?(S=[g,a],n[8]=a,n[9]=g,n[10]=S):S=n[10],d(v,S),g&&y===!0){var R;n[11]===Symbol.for("react.memo_cache_sentinel")?(R={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1"},n[11]=R):R=n[11];var E;n[12]===Symbol.for("react.memo_cache_sentinel")?(E={className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 xr1yuqi x11t971q x4ii5y1 xvc5jky"},n[12]=E):E=n[12];var I;n[13]===Symbol.for("react.memo_cache_sentinel")?(I=u.jsx(r("IGDSText.react"),{color:"link",maxLines:1,textAlign:"center",zeroMargin:!0,children:o("PolarisAuthStrings").ERROR_LOGIN_BOOST_ACCOUNT_RECOVERY_EMAIL_LINK}),n[13]=I):I=n[13];var T;n[14]!==p||n[15]!==b?(T=u.jsx("div",babelHelpers.extends({},E,{children:u.jsx(r("PolarisFastLink.react"),{disabled:p,onClick:b,children:I})})),n[14]=p,n[15]=b,n[16]=T):T=n[16];var D;return n[17]!==s||n[18]!==T?(D=u.jsxs("div",babelHelpers.extends({},R,{children:[s,T]})),n[17]=s,n[18]=T,n[19]=D):D=n[19],D}return s}function k(e){return e.auth}function I(e){var t,n=o("react-compiler-runtime").c(142),a=e.dialogSource,i=e.errorMessage,l=e.fbConnectStatus,c=e.forceLoginIgId,m=e.forceLoginProfilePicUrl,C=e.forceLoginUsername,v=e.fromLoggedOutDialog,R=e.hideFBLogin,k=e.hideForgotPassword,I=e.infoMessage,M=e.isFBLoggedIn,w=e.isIGSSODisabled,A=e.isThreadsRequest,F=e.nextUrl,O=e.onClearStopDeletionNonce,B=e.onLoginWithFBClick,W=e.onStopAccountDeletion,q=e.onSubmit,U=e.requestInFlight,V=e.stopDeletionDate,H=e.stopDeletionNonce,G=e.style,z=e.successMessage,j=e.usernameHint,K=v===void 0?!1:v,Q=A===void 0?!1:A,X=_((t=C!=null?C:j)!=null?t:""),Y=X[0],J=X[1],Z=_(""),ee=Z[0],te=Z[1],ne=_(!1),re=ne[0],oe=ne[1],ae;n[0]===Symbol.for("react.memo_cache_sentinel")?(ae=o("PolarisOneTapLogin").hasMaxOneTapNonces(),n[0]=ae):ae=n[0];var ie=ae,le=r("usePolarisPageID")(),se=o("PolarisReactRedux.react").useSelector(N),ue;n[1]!==M||n[2]!==w||n[3]!==F||n[4]!==B||n[5]!==le?(ue=function(){o("PolarisLoggedOutCtaClickLogger").logLoggedOutCtaClickEvent("fb_connect","auth_form",le),o("PolarisThirdPartyAuthHelpers").handleLoginOrFacebookAuth(F!=null?F:void 0,B,M,w)},n[1]=M,n[2]=w,n[3]=F,n[4]=B,n[5]=le,n[6]=ue):ue=n[6];var ce=ue,de;n[7]!==K||n[8]!==q||n[9]!==re||n[10]!==ee||n[11]!==Y?(de=function(t){o("PolarisLoginLogger").logLoginEvent({event_category:K?"logged_out_dialog_interaction":null,event_flow:"login_manual",event_name:"login_button_clicked",event_step:K?"logged_out_dialog":null}),t.preventDefault(),re===!0?o("PolarisLoginLogger").logLoginEvent({event_name:"one_tap_login_optin"}):o("PolarisLoginLogger").logLoginEvent({event_name:"one_tap_login_optout"}),r("PolarisLoginQPL").addPointLoginButtonClick(),q(Y,ee,re)},n[7]=K,n[8]=q,n[9]=re,n[10]=ee,n[11]=Y,n[12]=de):de=n[12];var me=de,pe,_e;n[13]===Symbol.for("react.memo_cache_sentinel")?(pe=function(){var e=r("qex")._("871")===!0;oe(e)},_e=[],n[13]=pe,n[14]=_e):(pe=n[13],_e=n[14]),d(pe,_e);var fe;e:{if(o("PolarisQueryParams").isFromFxcal()||o("PolarisIsLoggedIn").isLoggedIn()||Q||o("PolarisQueryParams").isFromBizappIGBoostMsite()||o("PolarisQueryParams").isFromIGBoostSteering()){fe=!1;break e}fe=!R&&r("gkx")("5230")===!1}var ge=fe,he=_(!1),ye=he[0],Ce=he[1],be=_(!0),ve=be[0],Se=be[1],Re=p(null),Le=o("PolarisAuthStrings").PHONE_USERNAME_OR_EMAIL,Ee;e:{if(o("PolarisUA").isMobile()){var ke;n[15]!==se?(ke=se&&o("PolarisIsLoggedIn").isLoggedIn()?"xdj266r x1ys307a xzueoph xyqm7xq":"xdj266r x11gldyt xzueoph x11hdunq",n[15]=se,n[16]=ke):ke=n[16],Ee=ke;break e}var Ie;n[17]===Symbol.for("react.memo_cache_sentinel")?(Ie="xdj266r x11gldyt xzueoph x11hdunq",n[17]=Ie):Ie=n[17],Ee=Ie}var Te=Ee,De,xe;n[18]!==a||n[19]!==l||n[20]!==K?(De=function(){o("PolarisLoginLogger").logLoginEvent({event_name:"login_form_load",fbconnect_status:l}),K?o("PolarisLoginLogger").logLoginEvent({event_category:"logged_out_dialog_init",event_flow:"login_manual",event_name:"login_step_view_loaded",event_step:"logged_out_dialog",extra_client_data:{dialog_source:a!=null?a:""}}):o("PolarisLoginLogger").logLoginEvent({event_flow:"login_manual",event_name:"login_step_view_loaded"}),o("PolarisQueryParams").hasForceAuthenticationParam()&&Re.current!=null&&Re.current.focus()},xe=[a,l,K],n[18]=a,n[19]=l,n[20]=K,n[21]=De,n[22]=xe):(De=n[21],xe=n[22]),d(De,xe);var $e=_(!1),Pe=$e[0],Ne=$e[1],Me;n[23]===Symbol.for("react.memo_cache_sentinel")?(Me=r("justknobx")._("912"),n[23]=Me):Me=n[23];var we=Me,Ae,Fe;n[24]===Symbol.for("react.memo_cache_sentinel")?(Ae=function(){var e=function(){if(we){var e,t=!!((e=document.querySelector("input[name=username]"))!=null&&e.matches("*:-webkit-autofill"));Ne(t)}};e(),window.setTimeout(e,200)},Fe=[we],n[24]=Ae,n[25]=Fe):(Ae=n[24],Fe=n[25]),d(Ae,Fe);var Oe;n[26]!==ve?(Oe=function(t){Se(!ve),t.preventDefault()},n[26]=ve,n[27]=Oe):Oe=n[27];var Be=Oe,We;n[28]!==re?(We=function(){ie?Ce(!0):oe(!re)},n[28]=re,n[29]=We):We=n[29];var qe=We,Ue=P,Ve=$,He;n[30]!==Pe?(He=function(){Pe&&Ne(!1)},n[30]=Pe,n[31]=He):He=n[31];var Ge=He,ze=x,je;n[32]!==se?(je=o("PolarisUA").isMobile()&&se&&o("PolarisIsLoggedIn").isLoggedIn(),n[32]=se,n[33]=je):je=n[33];var Ke=je,Qe;n[34]!==se?(Qe=o("PolarisUA").isMobile()&&!(se&&o("PolarisIsLoggedIn").isLoggedIn()),n[34]=se,n[35]=Qe):Qe=n[35];var Xe=Qe,Ye=!Y&&!ee&&!Pe&&we,Je=!Y||!ee||ee.length<g||Ye,Ze;n[36]!==se?(Ze=se&&o("PolarisIsLoggedIn").isLoggedIn(),n[36]=se,n[37]=Ze):Ze=n[37];var et=Ze,tt=et,nt,rt=i==null||i===""?void 0:f,ot;n[38]!==rt||n[39]!==c||n[40]!==m||n[41]!==C||n[42]!==Ge||n[43]!==Te||n[44]!==Y?(ot=u.jsx(u.Fragment,{children:c!=null&&C!=null&&m!=null?u.jsxs("div",{className:"x6s0dn4 x78zum5 x1q0g3np xdj266r x11gldyt x1fqp7bg x11hdunq",children:[u.jsx("div",{className:"x1ekkm8c x1143rjc xum4auv xj21bgg x972fbf x10w94by x1qhh985 x14e42zd xj87blo xln7xf2 xk390pu xc9qbxq xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl x11njtxf x14qfxbe",children:u.jsx(r("CometImage.react"),{alt:s._(/*BTDS*/"Foto del perfil de {username}",[s._param("username",C)]),src:m,xstyle:h.profilePicture})}),u.jsx("div",{className:"xj87blo x13fj5qh",children:u.jsx(r("IGDSText.react"),{size:"label",textAlign:"start",weight:"normal",zeroMargin:!1,children:C})})]}):u.jsx(r("PolarisSlimTextInput.react"),{"aria-describedby":rt,"aria-label":Le,"aria-required":"true",autoCapitalize:"off",autoCorrect:"off",className:Te,"data-testid":void 0,isInputFocused:ze(),maxLength:75,name:"username",onChange:function(t){var e=t.target,n=e.value;J(n),Ge()},onFocus:D,placeholder:Le,ref:Re,value:Y})}),n[38]=rt,n[39]=c,n[40]=m,n[41]=C,n[42]=Ge,n[43]=Te,n[44]=Y,n[45]=ot):ot=n[45];var at=ot,it=o("PolarisAuthStrings").PASSWORD,lt=o("PolarisAuthStrings").ONE_TAP_CHECKBOX_TEXT,st;n[46]!==c||n[47]!==Ge||n[48]!==ee.length?(st=function(t){var e=t.target,n=e.value;ee.length===0&&n.length>=6&&o("PolarisLoginLogger").logLoginEvent({event_name:"login_form_autofill",ig_userid:c!=null?c:void 0}),te(n),Ge()},n[46]=c,n[47]=Ge,n[48]=ee.length,n[49]=st):st=n[49];var ut=!!ee,ct=ve?"password":"text",dt;n[50]!==rt||n[51]!==Be||n[52]!==Te||n[53]!==ve||n[54]!==ee||n[55]!==st||n[56]!==ut||n[57]!==ct?(dt=u.jsx(r("PolarisSlimTextInput.react"),{"aria-describedby":rt,"aria-label":it,"aria-required":"true",autoCapitalize:"off",autoCorrect:"off",className:Te,"data-testid":void 0,isInputFocused:ze(),isPasswordHidden:ve,name:"password",onChange:st,onFocus:T,onPasswordToggle:Be,placeholder:it,showPasswordToggleLink:ut,type:ct,value:ee}),n[50]=rt,n[51]=Be,n[52]=Te,n[53]=ve,n[54]=ee,n[55]=st,n[56]=ut,n[57]=ct,n[58]=dt):dt=n[58];var mt;n[59]!==qe||n[60]!==re||n[61]!==tt||n[62]!==ye?(mt=tt&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 x1q0g3np x1c4vz4f x2lah0s x1nhvcw1 x1n2onr6",children:[u.jsx(y,{checkboxId:"optIntoOneTap",checkboxOnChange:qe,checkboxState:re,checkboxText:lt,disabled:ie}),ie&&u.jsx(r("IGDSIconButton.react"),{onClick:qe,padding:0,children:u.jsx(r("IGDSInfoPanoFilledIcon.react"),{alt:lt,color:"ig-secondary-text",size:16})})]}),ye&&u.jsx(r("PolarisTooManyAccountsDialog.react"),{onClose:function(){Ce(!1)}})]}),n[59]=qe,n[60]=re,n[61]=tt,n[62]=ye,n[63]=mt):mt=n[63];var pt;n[64]!==k||n[65]!==Xe||n[66]!==Q?(pt=Xe&&!Q&&u.jsx(b,{hideForgotPassword:k,onClick:Ue}),n[64]=k,n[65]=Xe,n[66]=Q,n[67]=pt):pt=n[67];var _t;n[68]!==dt||n[69]!==mt||n[70]!==pt?(_t=u.jsxs(u.Fragment,{children:[dt,mt,pt]}),n[68]=dt,n[69]=mt,n[70]=pt,n[71]=_t):_t=n[71];var ft=_t,gt=Ke?4:10,ht=Ke?4:10,yt=Ke?3:2,Ct=Q?"barcelona-primary-button":"ig-primary-button",bt;n[72]===Symbol.for("react.memo_cache_sentinel")?(bt=u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1n2onr6",children:s._(/*BTDS*/"Iniciar sesi\u00f3n")}),n[72]=bt):bt=n[72];var vt;n[73]!==me||n[74]!==Je||n[75]!==U||n[76]!==Ct?(vt=u.jsx(r("PolarisIGCoreButton.react"),{color:Ct,"data-testid":void 0,disabled:Je,loading:U,onClick:me,type:"submit",children:bt}),n[73]=me,n[74]=Je,n[75]=U,n[76]=Ct,n[77]=vt):vt=n[77];var St;n[78]!==gt||n[79]!==ht||n[80]!==yt||n[81]!==vt?(St=u.jsx(r("IGDSBox.react"),{marginBottom:2,marginEnd:gt,marginStart:ht,marginTop:yt,position:"relative",children:vt}),n[78]=gt,n[79]=ht,n[80]=yt,n[81]=vt,n[82]=St):St=n[82];var Rt;n[83]!==k||n[84]!==Q?(Rt=Q&&u.jsx(b,{hideForgotPassword:k,isThreadsRequest:Q,onClick:Ue}),n[83]=k,n[84]=Q,n[85]=Rt):Rt=n[85];var Lt;n[86]!==St||n[87]!==Rt?(Lt=u.jsxs(u.Fragment,{children:[St,Rt]}),n[86]=St,n[87]=Rt,n[88]=Lt):Lt=n[88];var Et=Lt,kt;n[89]!==at||n[90]!==ft||n[91]!==Et?(kt=u.jsxs(u.Fragment,{children:[at,ft,Et]}),n[89]=at,n[90]=ft,n[91]=Et,n[92]=kt):kt=n[92];var It=kt,Tt;n[93]===Symbol.for("react.memo_cache_sentinel")?(Tt=u.jsx("div",{className:"x1hmvnq2 x11gldyt x91k8ka x11hdunq",children:u.jsx(r("PolarisOrBar.react"),{})}),n[93]=Tt):Tt=n[93];var Dt=Tt;if(!ge)nt=It;else if(o("PolarisUA").isMobile()||se){var xt;n[94]!==se||n[95]!==ce?(xt=u.jsx(r("PolarisFacebookLoginButtonRevamped"),{isAccountSwitcherOpen:se,onClick:ce}),n[94]=se,n[95]=ce,n[96]=xt):xt=n[96];var $t;n[97]!==It||n[98]!==xt?($t=u.jsxs(u.Fragment,{children:[xt,Dt,It]}),n[97]=It,n[98]=xt,n[99]=$t):$t=n[99],nt=$t}else{var Pt;n[100]!==se||n[101]!==ce?(Pt=u.jsx(r("PolarisFacebookLoginButtonRevamped"),{isAccountSwitcherOpen:se,onClick:ce}),n[100]=se,n[101]=ce,n[102]=Pt):Pt=n[102];var Nt;n[103]!==It||n[104]!==Pt?(Nt=u.jsxs(u.Fragment,{children:[It,Dt,Pt]}),n[103]=It,n[104]=Pt,n[105]=Nt):Nt=n[105],nt=Nt}var Mt;n[106]!==I?(Mt=I!=null&&I!==""&&u.jsx(L,{className:"x1roi4f4 xvs91rp xd4r4e8 x1anpbxc x11gldyt x4n8cb0 x11hdunq x2b8uid",message:I,testid:void 0}),n[106]=I,n[107]=Mt):Mt=n[107];var wt;n[108]!==z?(wt=z!=null&&z!==""&&u.jsx(L,{className:"x5n08af xvs91rp xd4r4e8 x1anpbxc x11gldyt x4n8cb0 x11hdunq x2b8uid",message:z,testid:void 0}),n[108]=z,n[109]=wt):wt=n[109];var At;n[110]===Symbol.for("react.memo_cache_sentinel")?(At={className:"x972fbf x10w94by x1qhh985 x14e42zd x78zum5 xdt5ytf xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl x11njtxf"},n[110]=At):At=n[110];var Ft=Ke?3:6,Ot;n[111]!==nt||n[112]!==Ft?(Ot=u.jsx(r("IGDSBox.react"),{marginTop:Ft,position:"relative",children:nt}),n[111]=nt,n[112]=Ft,n[113]=Ot):Ot=n[113];var Bt;n[114]!==i?(Bt=i!=null&&i!==""&&u.jsx(E,{errorMessage:i}),n[114]=i,n[115]=Bt):Bt=n[115];var Wt;n[116]!==K||n[117]!==k||n[118]!==Q?(Wt=u.jsx(S,{fromLoggedOutDialog:K,hideForgotPassword:k,isThreadsRequest:Q,onForgotPasswordClick:Ue,onNavigate:Ve}),n[116]=K,n[117]=k,n[118]=Q,n[119]=Wt):Wt=n[119];var qt;n[120]!==O||n[121]!==W||n[122]!==re||n[123]!==ee||n[124]!==V||n[125]!==H||n[126]!==Y?(qt=H!=null&&V!=null&&u.jsx(r("PolarisStopDeletionDialog.react"),{onClose:O,onStopDeletion:function(t){return W(Y,ee,re,t)},stopDeletionDate:V,stopDeletionNonce:H,username:Y}),n[120]=O,n[121]=W,n[122]=re,n[123]=ee,n[124]=V,n[125]=H,n[126]=Y,n[127]=qt):qt=n[127];var Ut;n[128]!==Ke||n[129]!==G?(Ut=G==="modal"&&!Ke&&u.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1hq5gj4 x1n2onr6"}),n[128]=Ke,n[129]=G,n[130]=Ut):Ut=n[130];var Vt;n[131]!==me||n[132]!==Ot||n[133]!==Bt||n[134]!==Wt||n[135]!==qt||n[136]!==Ut?(Vt=u.jsxs("form",babelHelpers.extends({},At,{"data-testid":void 0,id:"loginForm",method:"post",onSubmit:me,children:[Ot,Bt,Wt,qt,Ut]})),n[131]=me,n[132]=Ot,n[133]=Bt,n[134]=Wt,n[135]=qt,n[136]=Ut,n[137]=Vt):Vt=n[137];var Ht;return n[138]!==Mt||n[139]!==wt||n[140]!==Vt?(Ht=u.jsxs("div",{children:[Mt,wt,Vt]}),n[138]=Mt,n[139]=wt,n[140]=Vt,n[141]=Ht):Ht=n[141],Ht}function T(){return r("PolarisLoginQPL").addPointPasswordFocus()}function D(){return r("PolarisLoginQPL").addPointUsernameFocus()}function x(){return!o("PolarisIsLoggedIn").isLoggedIn()&&!o("PolarisUA").isMobile()}function $(e){e==="signup"&&r("PolarisLoginQPL").endCancelNavigateToSignup()}function P(){r("PolarisLoginQPL").endCancelNavigateToForgotPassword()}function N(e){return e.navigation.isAccountSwitcherOpen}l.default=I}),226);
__d("PolarisStrategicWebTraffic",["ExecutionEnvironment","PolarisConfig","PolarisDismissEntry","PolarisQueryParams","PolarisUA","memoize"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("memoize")(function(){return(e||(e=r("ExecutionEnvironment"))).canUseDOM&&o("PolarisDismissEntry").isDismissed(o("PolarisDismissEntry").PROMOTED_TRAFFIC_TYPE)?!0:(e||(e=r("ExecutionEnvironment"))).canUseDOM&&o("PolarisUA").isMobile()&&o("PolarisQueryParams").parseQueryParams().utm_source&&o("PolarisQueryParams").parseQueryParams().utm_source.includes("_sd")?(o("PolarisDismissEntry").setDismissEntry(o("PolarisDismissEntry").PROMOTED_TRAFFIC_TYPE),!0):!1}),u=r("memoize")(function(){return o("PolarisConfig").isProgressiveWebApp()||s()});l.isStrategicTraffic=u}),98);
__d("PolarisFXAuthActions",["FXAuthenticationLogger","PolarisAPIExtractTwoFactorChallengeIfPresent","PolarisAPIFXCALAuthLogin","PolarisAuthStrings","PolarisNavigationUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r){return function(a,i){return a({appId:n,etoken:r,type:"FX_AUTH_LOGIN_ATTEMPTED"}),o("PolarisAPIFXCALAuthLogin").fxcalAuthLogin(e.replace(/\s+$/,""),t,n,r).then(function(e){e.authenticated?c(String(e.username),String(e.profile_pic_url),String(e.blob),String(e.token))(a,i):a({errorDescription:o("PolarisAuthStrings").ERROR_LOGIN_PASSWORD,type:"FX_AUTH_LOGIN_FAILED"})},function(e){var t=o("PolarisAPIExtractTwoFactorChallengeIfPresent").extractTwoFactorChallengeIfPresent(e);if(t){a(babelHelpers.extends({fromFB:!1,fromFxAuth:!0,timeReceived:Date.now(),type:"TWO_FACTOR_CHALLENGE_RECEIVED"},t)),a({type:"FX_AUTH_TWO_FACTOR_REQUIRED"});return}a({errorDescription:o("PolarisAuthStrings").ERROR_LOGIN_UNKNOWN,type:"FX_AUTH_LOGIN_FAILED"})}).catch()}}function s(){return function(e){e({type:"FX_AUTH_LOGOUT"}),o("FXAuthenticationLogger").logEvent({event:"web_auth_force_logout",target_account_type:1})}}function u(e,t,n){return function(r){if(!(e==null||t==null||n==null)){var a=new URL(e);a.searchParams.append("blob",t),a.searchParams.append("token",n),r({redirectUrl:a.toString(),type:"FX_AUTH_CONFIRMED"}),o("FXAuthenticationLogger").logEvent({event:"web_auth_confirmed_redirect",target_account_type:1});var i=a.toString();o("PolarisNavigationUtils").openURLWithFullPageReload(i),i.startsWith("accountscenter://")&&window.close()}}}function c(e,t,n,r){return function(a){a({blob:n,profilePicUrl:t,token:r,type:"FX_AUTH_LOGIN_SUCCEEDED",username:e}),o("FXAuthenticationLogger").logEvent({event:"web_auth_confirm_page_view",target_account_type:1})}}l.fxAuthLoginAction=e,l.fxAuthLogoutAction=s,l.fxAuthConfirmedAction=u,l.fxAuthSucceededAction=c}),98);
__d("polarisUpdateTwoFactorLoginNoncesFromResponse",["PolarisOneTapLogin","PolarisTrustedDevicesUtils","isStringNullOrEmpty"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.loginNonce,n=e.trustedDeviceNonce,a=e.userId;a!=null&&(r("isStringNullOrEmpty")(n)||o("PolarisTrustedDevicesUtils").addTrustedDevicesNonce(a,n),r("isStringNullOrEmpty")(t)||o("PolarisOneTapLogin").updateLoginNonce(a,t))}l.default=e}),98);
__d("PolarisTwoFactorActions",["invariant","CAAWebLoginLoggingUtils","ErrorCodes","PolarisAPIFxcalAuthTwoFactorLogin","PolarisAPILoginTwoFactor","PolarisAPISendTwoFactorLoginSms","PolarisAPISendTwoFactorLoginWhatsapp","PolarisAuthStrings","PolarisFXAuthActions","PolarisInstajax","PolarisLoginQPL","PolarisOneTapLogin","PolarisQueryParams","PolarisRedirectHelper","polarisGetAppPlatform","polarisLogAction","polarisUpdateTwoFactorLoginNoncesFromResponse"],(function(t,n,r,o,a,i,l,s){"use strict";function e(e){if(e==null)return null;switch(e){case"invalid_verficaition_code":return r("ErrorCodes").TWO_FACTOR_LOGIN__INVALIDCODE;case"sms_code_validation_code_missing":return r("ErrorCodes").LOGIN__TWO_FACTOR_SMS_CODE_REQUIRED;default:return null}}function u(t,n,a,i,l){return l===void 0&&(l=!1),function(u,c){var d=c(),m=d.auth,p=m.dyiJobID,_=m.next,f=m.showOneTap,g=d.auth.twoFactor;g||s(0,51503);var h=g.fromFB,y=g.fromFxAuth,C=g.identifier,b=g.username,v=d.fxAuth,S=v.appId,R=v.etoken;u({type:"TWO_FACTOR_VERIFY_ATTEMPTED"});var L={fb:h,platform:o("polarisGetAppPlatform").getAppPlatform(),source:t},E=y?{}:o("PolarisQueryParams").parseQueryParams(),k=y?o("PolarisAPIFxcalAuthTwoFactorLogin").fxcalAuthTwoFactorLogin(C,n,b,a,i,S!=null?S:"0",R!=null?R:""):o("PolarisAPILoginTwoFactor").loginTwoFactor(C,n,b,a,i,o("PolarisOneTapLogin").queryParamStringWithOneTapInfo(E),l);r("PolarisLoginQPL").isActive()&&r("PolarisLoginQPL").addPointTwoFactorFormSubmit(i),r("polarisLogAction")("twoFacLoginAttempt",L),k.then(function(e){if(e.authenticated)if(u({type:"TWO_FACTOR_VERIFY_SUCCEEDED"}),r("polarisLogAction")("loginSuccess",babelHelpers.extends({},L,{twoFac:!0})),o("CAAWebLoginLoggingUtils").logLoginResult("two_fac_redirect","two_fac",1,!0,null,null,!1,e.cryptedUid),r("PolarisLoginQPL").isActive()&&r("PolarisLoginQPL").endSuccess(),r("polarisUpdateTwoFactorLoginNoncesFromResponse")(e),y&&e.blob!==null)u(o("PolarisFXAuthActions").fxAuthSucceededAction(b,String(e.profile_pic_url),String(e.blob),String(e.token)));else{var t,n=(t=E.dyi_job_id)!=null?t:"";o("PolarisRedirectHelper").redirectAfterLogin(_,!!e.reactivated,f&&!!e.oneTapPrompt,e.nonce!=null&&e.nonce!==""?e.nonce:"",p||n)}else{var a=o("PolarisAuthStrings").ERROR_LOGIN_UNKNOWN;u({message:a,type:"TWO_FACTOR_VERIFY_FAILED"}),r("polarisLogAction")("loginFailure",babelHelpers.extends({},L,{twoFac:!0})),r("PolarisLoginQPL").isActive()&&r("PolarisLoginQPL").addPointUserError("two_factor_failed")}},function(t){var n,a=t instanceof o("PolarisInstajax").AjaxError&&((n=t.responseObject)==null?void 0:n.message)||o("PolarisAuthStrings").ERROR_LOGIN_UNKNOWN,i=t instanceof o("PolarisInstajax").AjaxError?t.errorType:null;u({message:a,type:"TWO_FACTOR_VERIFY_FAILED"}),r("polarisLogAction")("loginFailure",babelHelpers.extends({},L,{twoFac:!0})),o("CAAWebLoginLoggingUtils").logLoginResult("two_fac_redirect","two_fac",1,!1,e(i),String(a),void 0,null,void 0,void 0,i),r("PolarisLoginQPL").isActive()&&r("PolarisLoginQPL").addPointUserError("two_factor_failed")})}}function c(){return{type:"TWO_FACTOR_CODE_REQUESTED"}}function d(e){return{message:e,type:"TWO_FACTOR_CODE_REQUEST_FAILED"}}function m(e,t){return{identifier:e,timeSent:Date.now(),type:"TWO_FACTOR_CODE_SENT",verificationMethod:t}}function p(){return f("SMS")}function _(){return f("WHATSAPP")}function f(e){return function(t,n){t(c());var a=n().auth.twoFactor;a||s(0,51504);var i=a.identifier,l=a.username;return r("PolarisLoginQPL").isActive()&&r("PolarisLoginQPL").addPointTwoFactorRequestNewSMSCode(),e==="SMS"?o("PolarisAPISendTwoFactorLoginSms").sendTwoFactorLoginSms(l,i).then(function(e){t(m(e.two_factor_info.two_factor_identifier,"SMS"))},function(e){var n,a=e instanceof o("PolarisInstajax").AjaxError&&((n=e.responseObject)==null?void 0:n.message)||o("PolarisAuthStrings").TWOFAC_CODE_RESEND_FAILED_TEXT;t(d(a)),r("polarisLogAction")("newCodeSentFailure",{platform:o("polarisGetAppPlatform").getAppPlatform()}),r("PolarisLoginQPL").isActive()&&r("PolarisLoginQPL").markError("request_new_sms_code_failed",e)}):o("PolarisAPISendTwoFactorLoginWhatsapp").sendTwoFactorLoginWhatsapp(l,i).then(function(e){t(m(e.xdt_send_two_factor_login_whatsapp.two_factor_info.two_factor_identifier,"WHATSAPP"))},function(e){var n,a=e instanceof o("PolarisInstajax").AjaxError&&((n=e.responseObject)==null?void 0:n.message)||o("PolarisAuthStrings").TWOFAC_CODE_RESEND_FAILED_TEXT;t(d(a)),r("polarisLogAction")("newCodeSentFailure",{platform:o("polarisGetAppPlatform").getAppPlatform()}),r("PolarisLoginQPL").isActive()&&r("PolarisLoginQPL").markError("request_new_whatsapp_code_failed",e)})}}function g(e){return{eligibleForMultipleTotp:!1,fromFB:!1,fromFxAuth:!1,identifier:e.identifier||"",isInSowaExperience:e.isInSowaExperience,lastFourDigits:e.lastFourDigits||"",maskedPhoneNumber:e.maskedPhoneNumber||"",showTrustedDevice:!1,smsTwoFactorOn:e.smsTwoFactorOn||!1,timeReceived:Date.now(),totpTwoFactorOn:e.totpTwoFactorOn||!1,type:"TWO_FACTOR_CHALLENGE_RECEIVED",username:e.username||""}}l.submitVerificationCode=u,l.requestSMSCode=p,l.requestWhatsappCode=_,l.loadTwoFactorAuthenticationData=g}),98);
__d("PolarisTwoFactorForm.react",["fbt","invariant","IGDSCheckbox.react","IGDSDialogFooter.react","IGDSText.react","PolarisAuthStrings","PolarisGenericStrings","PolarisIGCoreButton.react","PolarisIGCoreText","PolarisIsLoggedIn","PolarisLoginQPL","PolarisNavigationUtils","PolarisReactRedux.react","PolarisSlimTextInput.react","PolarisTwoFactorActions","PolarisUA","react","react-compiler-runtime","vulture"],(function(t,n,r,o,a,i,l,s,u){"use strict";var e,c=e||(e=o("react")),d="twoFactorErrorAlert",m=s._(/*BTDS*/"c\u00f3digos de respaldo"),p=s._(/*BTDS*/"mensaje de texto"),_=s._(/*BTDS*/"app de autenticaci\u00f3n"),f=s._(/*BTDS*/"volver a enviarlo"),g=s._(/*BTDS*/"Enviar c\u00f3digo por SMS"),h=s._(/*BTDS*/"Enviar c\u00f3digo por WhatsApp"),y=s._(/*BTDS*/"Confiar en este dispositivo"),C=s._(/*BTDS*/"No te pediremos ning\u00fan c\u00f3digo la pr\u00f3xima vez que inicies sesi\u00f3n."),b=s._(/*BTDS*/"C\u00f3digo de seguridad"),v=s._(/*BTDS*/"Confirmar"),S=s._(/*BTDS*/"Ingresa el c\u00f3digo de inicio de sesi\u00f3n"),R=s._(/*BTDS*/"Ingresa el c\u00f3digo de 6 d\u00edgitos que gener\u00f3 la app de autenticaci\u00f3n."),L=s._(/*BTDS*/"Ingresa un c\u00f3digo de inicio de sesi\u00f3n de 6 d\u00edgitos generado por una app de autenticaci\u00f3n."),E=s._(/*BTDS*/"Ingresa uno de los c\u00f3digos de 8 d\u00edgitos que se proporcionaron al configurar la autenticaci\u00f3n en dos pasos.");function k(e){var t=o("react-compiler-runtime").c(9),n=e.onClickAuthAppCode,a=e.onClickBackupCode,i=e.verificationMethod,l=o("PolarisReactRedux.react").useSelector(I),u;t[0]!==l?(u={0:{className:"x5n08af x1lliihq x1f6kntn x1fcty0u xd4r4e8 xdj266r x11gldyt xod5an3 x11hdunq x2b8uid"},1:{className:"x5n08af x1lliihq x1f6kntn x1fcty0u xd4r4e8 x2b8uid xdj266r x1ys307a xod5an3 xyqm7xq"}}[!!(o("PolarisUA").isMobile()&&l&&o("PolarisIsLoggedIn").isLoggedIn())<<0],t[0]=l,t[1]=u):u=t[1];var d;t[2]!==n||t[3]!==a||t[4]!==i?(d=i==="TOTP"?s._(/*BTDS*/"Si no puedes recibir el c\u00f3digo de inicio de sesi\u00f3n de la app de autenticaci\u00f3n, usa uno de tus {=backup codes}.",[s._param("=backup codes",c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:a,children:c.jsx(r("PolarisIGCoreText").Body,{color:"ig-primary-action",children:m})}))]):s._(/*BTDS*/"Si no puedes usar uno de tus c\u00f3digos de respaldo, puedes usar uno de tus {=auth app codes}",[s._param("=auth app codes",c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:n,children:_}))]),t[2]=n,t[3]=a,t[4]=i,t[5]=d):d=t[5];var p;return t[6]!==u||t[7]!==d?(p=c.jsx("div",babelHelpers.extends({},u,{children:d})),t[6]=u,t[7]=d,t[8]=p):p=t[8],p}function I(e){return e.navigation.isAccountSwitcherOpen}function T(e){var t=o("react-compiler-runtime").c(9),n=e.onClickBackupCode,a=e.onClickSmsCode,i=e.verificationMethod,l=o("PolarisReactRedux.react").useSelector(D),u;t[0]!==l?(u={0:{className:"x5n08af x1lliihq x1f6kntn x1fcty0u xd4r4e8 xdj266r x11gldyt xod5an3 x11hdunq x2b8uid"},1:{className:"x5n08af x1lliihq x1f6kntn x1fcty0u xd4r4e8 x2b8uid xdj266r x1ys307a xod5an3 xyqm7xq"}}[!!(o("PolarisUA").isMobile()&&l&&o("PolarisIsLoggedIn").isLoggedIn())<<0],t[0]=l,t[1]=u):u=t[1];var d;t[2]!==n||t[3]!==a||t[4]!==i?(d=i==="SMS"||i==="WHATSAPP"?s._(/*BTDS*/"Si no puedes recibir el c\u00f3digo de seguridad, usa uno de tus {=backup codes}.",[s._param("=backup codes",c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:n,children:c.jsx(r("PolarisIGCoreText").Body,{color:"ig-primary-action",children:m})}))]):s._(/*BTDS*/"Si no puedes usar un c\u00f3digo de seguridad de tus c\u00f3digos de respaldo, puedes {=resend it} para obtener otro",[s._param("=resend it",c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:a,children:p}))]),t[2]=n,t[3]=a,t[4]=i,t[5]=d):d=t[5];var _;return t[6]!==u||t[7]!==d?(_=c.jsx("div",babelHelpers.extends({},u,{children:d})),t[6]=u,t[7]=d,t[8]=_):_=t[8],_}function D(e){return e.navigation.isAccountSwitcherOpen}function x(e){var t=o("react-compiler-runtime").c(10),n=e.onClickAuthAppCode,a=e.onClickBackupCode,i=e.onClickSmsCode,l=e.verificationMethod,u=o("PolarisReactRedux.react").useSelector($),d;t[0]!==u?(d={0:{className:"x5n08af x1lliihq x1f6kntn x1fcty0u xd4r4e8 xdj266r x11gldyt xod5an3 x11hdunq x2b8uid"},1:{className:"x5n08af x1lliihq x1f6kntn x1fcty0u xd4r4e8 x2b8uid xdj266r x1ys307a xod5an3 xyqm7xq"}}[!!(o("PolarisUA").isMobile()&&u&&o("PolarisIsLoggedIn").isLoggedIn())<<0],t[0]=u,t[1]=d):d=t[1];var f;t[2]!==n||t[3]!==a||t[4]!==i||t[5]!==l?(f=l==="TOTP"?s._(/*BTDS*/"Si no puedes usar un c\u00f3digo de inicio de sesi\u00f3n de la app de autenticaci\u00f3n, puedes enviar un {=sms code} para obtener uno o usar uno de tus {=backup codes}.",[s._param("=sms code",c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:i,children:p})),s._param("=backup codes",c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:a,children:c.jsx(r("PolarisIGCoreText").Body,{color:"ig-primary-action",children:m})}))]):l==="SMS"?s._(/*BTDS*/"Si no puedes recibir el c\u00f3digo de seguridad por mensaje de texto, usa uno de tus {=auth app codes} o de tus {=backup codes}.",[s._param("=auth app codes",c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:n,children:_})),s._param("=backup codes",c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:a,children:c.jsx(r("PolarisIGCoreText").Body,{color:"ig-primary-action",children:m})}))]):s._(/*BTDS*/"Si no puedes usar un c\u00f3digo de seguridad de tus c\u00f3digos de respaldo, puedes {=resend it} o usar uno de tus {=auth app codes}",[s._param("=resend it",c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:i,children:p})),s._param("=auth app codes",c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:n,children:_}))]),t[2]=n,t[3]=a,t[4]=i,t[5]=l,t[6]=f):f=t[6];var g;return t[7]!==d||t[8]!==f?(g=c.jsx("div",babelHelpers.extends({},d,{children:f})),t[7]=d,t[8]=f,t[9]=g):g=t[9],g}function $(e){return e.navigation.isAccountSwitcherOpen}function P(e){var t=o("react-compiler-runtime").c(8),n=e.onNewCodeClicked,a=o("PolarisReactRedux.react").useSelector(N),i;t[0]!==a?(i={0:{className:"x5n08af x1lliihq x1f6kntn x1fcty0u xd4r4e8 xdj266r x11gldyt xod5an3 x11hdunq x2b8uid"},1:{className:"x5n08af x1lliihq x1f6kntn x1fcty0u xd4r4e8 x2b8uid xdj266r x1ys307a xod5an3 xyqm7xq"}}[!!(o("PolarisUA").isMobile()&&a&&o("PolarisIsLoggedIn").isLoggedIn())<<0],t[0]=a,t[1]=i):i=t[1];var l;if(t[2]!==n){var u;t[4]===Symbol.for("react.memo_cache_sentinel")?(u=c.jsx(r("PolarisIGCoreText").Body,{color:"ig-primary-action",children:f}),t[4]=u):u=t[4],l=s._(/*BTDS*/"\u00bfNo recibiste el c\u00f3digo de seguridad? Podemos {=resend it}.",[s._param("=resend it",c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:n,children:u}))]),t[2]=n,t[3]=l}else l=t[3];var d;return t[5]!==i||t[6]!==l?(d=c.jsx("div",babelHelpers.extends({},i,{children:l})),t[5]=i,t[6]=l,t[7]=d):d=t[7],d}function N(e){return e.navigation.isAccountSwitcherOpen}function M(e){var t=o("react-compiler-runtime").c(13),n=e.onNewCodeClicked,a=e.onOtherMethodCodeClicked,i=e.verificationMethod,l=o("PolarisReactRedux.react").useSelector(w),u;t[0]!==l?(u={0:{className:"x5n08af x1lliihq x1f6kntn x1fcty0u xd4r4e8 xdj266r x11gldyt xod5an3 x11hdunq x2b8uid"},1:{className:"x5n08af x1lliihq x1f6kntn x1fcty0u xd4r4e8 x2b8uid xdj266r x1ys307a xod5an3 xyqm7xq"}}[!!(o("PolarisUA").isMobile()&&l&&o("PolarisIsLoggedIn").isLoggedIn())<<0],t[0]=l,t[1]=u):u=t[1];var d;t[2]!==n||t[3]!==a||t[4]!==i?(d=i==="SMS"&&s._(/*BTDS*/"\u00bfNo recibiste el c\u00f3digo de seguridad? Podemos {=resend it}. {=send WhatsApp instead}",[s._param("=resend it",c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:n,children:c.jsx(r("PolarisIGCoreText").Body,{color:"ig-primary-action",children:f})})),s._param("=send WhatsApp instead",c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:a,children:c.jsx(r("PolarisIGCoreText").Body,{color:"ig-primary-action",children:h})}))]),t[2]=n,t[3]=a,t[4]=i,t[5]=d):d=t[5];var m;t[6]!==a||t[7]!==i?(m=i==="WHATSAPP"&&s._(/*BTDS*/"\u00bfNo recibiste el c\u00f3digo de seguridad? {=send sms instead}",[s._param("=send sms instead",c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:a,children:c.jsx(r("PolarisIGCoreText").Body,{color:"ig-primary-action",children:g})}))]),t[6]=a,t[7]=i,t[8]=m):m=t[8];var p;return t[9]!==u||t[10]!==d||t[11]!==m?(p=c.jsxs("div",babelHelpers.extends({},u,{children:[d,m]})),t[9]=u,t[10]=d,t[11]=m,t[12]=p):p=t[12],p}function w(e){return e.navigation.isAccountSwitcherOpen}var A="verificationCodeDescription";function F(e){switch(e){case"SMS":return 1;case"BACKUP_CODE":return 2;case"TOTP":return 3;case"WHATSAPP":return 6;default:return r("vulture")("yhGvsyGQ7jRu4D6I_6RGJXqrpD8="),0}}var O=(function(e){function t(t){var n;return n=e.call(this,t)||this,n.$3=function(){r("PolarisLoginQPL").isActive()&&r("PolarisLoginQPL").addPointTwoFactorCodeFocus()},n.$4=function(e){r("PolarisLoginQPL").isActive()&&r("PolarisLoginQPL").addPointTwoFactorSubmitButtonClick(),n.$5(e)},n.$5=function(e){e.preventDefault();var t=n.state,r=t.currentVerificationMethod,o=t.trustSignal,a=t.verificationCode,i=a.replace(/\s+/g,""),l=F(r).toString();n.props.onSubmit(o,i,l)},n.$6=function(e){var t=e.target.value;t.match(/^[0-9 ]*$/)&&n.setState({verificationCode:t})},n.state={currentVerificationMethod:t.totpTwoFactorOn?"TOTP":t.isInSowaExperience?"WHATSAPP":"SMS",trustSignal:t.showTrustedDevice,verificationCode:""},n}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.componentDidMount=function(){this.$1&&this.$1.focus(),this.$2()},n.componentDidUpdate=function(){this.$2()},n.$2=function(){this.props.hasTwoFactorState||o("PolarisNavigationUtils").openURL("/")},n.$7=function(t){return this.$8(t,"x1f6kntn xd4r4e8 xdj266r x11gldyt xyorhqc x11hdunq x2b8uid x1atzwio")},n.$9=function(t){return this.$8(t,"x1f6kntn xd4r4e8 xdj266r x11gldyt xyorhqc x11hdunq x2b8uid x5n08af")},n.$8=function(t,n){return c.jsx("div",{className:n,children:c.jsx("p",{"aria-atomic":"true",id:d,role:"alert",size:"footnote",children:t})})},n.getSubTextIndex=function(){var e=this.state.currentVerificationMethod,t=this.props,n=t.eligibleForMultipleTotp,r=t.isInSowaExperience;switch(e){case"TOTP":return n===!0?0:1;case"BACKUP_CODE":return 2;case"WHATSAPP":return 3;case"SMS":return r?4:5}},n.render=function(){var e=this,t=this.props,n=t.errorMessage,a=t.isAccountSwitcherOpen,i=t.showTrustedDevice,l=t.smsTwoFactorOn,d=t.successMessage,m=t.totpTwoFactorOn,p=this.state.currentVerificationMethod;l||m||u(0,51594);var _=s._(/*BTDS*/"Ingresa el c\u00f3digo que enviamos por WhatsApp a tu n\u00famero de celular: {maskedPhoneNumber}.",[s._param("maskedPhoneNumber",this.props.maskedPhoneNumber)]),f=s._(/*BTDS*/"Ingresa el c\u00f3digo que enviamos por SMS a tu n\u00famero de celular: {maskedPhoneNumber}.",[s._param("maskedPhoneNumber",this.props.maskedPhoneNumber)]),g=s._(/*BTDS*/"Ingresa el c\u00f3digo que enviamos al n\u00famero que termina en {lastFourDigits}.",[s._param("lastFourDigits",this.props.lastFourDigits)]),h=[L,R,E,_,f,g];return c.jsxs("div",babelHelpers.extends({},{0:{className:"x889kno xyri2b x1a8lsjc x1c1uobl"},1:{className:"x889kno xyri2b x18d9i69 x1c1uobl"}}[(this.props.style==="modal")<<0],{children:[c.jsx("div",babelHelpers.extends({},{0:{className:"x5n08af x1lliihq x1f6kntn x1fcty0u xd4r4e8 xdj266r x11gldyt xod5an3 x11hdunq x2b8uid"},1:{className:"x5n08af x1lliihq x1f6kntn x1fcty0u xd4r4e8 x2b8uid xdj266r x1ys307a xod5an3 xyqm7xq"}}[!!(o("PolarisUA").isMobile()&&a&&o("PolarisIsLoggedIn").isLoggedIn())<<0],{id:A,children:h[this.getSubTextIndex()]})),c.jsxs("form",{className:"x972fbf x10w94by x1qhh985 x14e42zd x78zum5 xdt5ytf xln7xf2 xk390pu xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl x11njtxf",method:"POST",onSubmit:this.$5,children:[c.jsx(r("PolarisSlimTextInput.react"),{"aria-describedby":A,"aria-label":b,"aria-required":"true",autoCapitalize:"off",autoComplete:"off",autoCorrect:"off",className:{0:"xdj266r x11gldyt xzueoph x11hdunq",1:"x14vqqas x1ys307a x1hq5gj4 xyqm7xq"}[!!(o("PolarisUA").isMobile()&&a&&o("PolarisIsLoggedIn").isLoggedIn())<<0],"data-testid":void 0,maxLength:8,name:"verificationCode",onChange:this.$6,onFocus:this.$3,placeholder:b,ref:function(n){return e.$1=n},type:"tel",value:this.state.verificationCode}),this.props.style==="default"&&c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1yztbdb x11gldyt x11hdunq x1gslohp x1n2onr6",children:c.jsx(r("PolarisIGCoreButton.react"),{loading:this.props.requestInFlight,onClick:this.$4,children:v})}),n!=null&&n!==""&&this.$7(n),d!=null&&d!==""&&this.$9(d),i?c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1hq5gj4 x11gldyt x11hdunq x1xmf6yo x1n2onr6",children:c.jsx(r("IGDSCheckbox.react"),{isChecked:this.state.trustSignal,onChange:function(){var t=e.state.trustSignal;e.setState({trustSignal:!t})},size:16,children:c.jsxs("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1n2onr6",children:[c.jsx(r("IGDSText.react"),{size:"footnote",weight:"semibold",zeroMargin:!1,children:y}),c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1xmf6yo x1n2onr6",children:c.jsx(r("IGDSText.react"),{size:"footnote",zeroMargin:!1,children:C})})]})})}):null,m&&l&&c.jsx(x,{onClickAuthAppCode:function(){e.setState({currentVerificationMethod:"TOTP"})},onClickBackupCode:function(){e.setState({currentVerificationMethod:"BACKUP_CODE"})},onClickSmsCode:function(n){e.props.onNewCodeClicked(n),e.setState({currentVerificationMethod:"SMS"})},verificationMethod:p}),m&&!l&&c.jsx(k,{onClickAuthAppCode:function(){e.setState({currentVerificationMethod:"TOTP"})},onClickBackupCode:function(){e.setState({currentVerificationMethod:"BACKUP_CODE"})},verificationMethod:p}),!m&&p==="WHATSAPP"&&c.jsx(M,{onOtherMethodCodeClicked:function(n){e.props.onNewCodeClicked(n),e.setState({currentVerificationMethod:"SMS"})},verificationMethod:"WHATSAPP"}),!m&&p==="SMS"&&this.props.isInSowaExperience&&c.jsx(M,{onNewCodeClicked:function(n){e.props.onNewCodeClicked(n),e.setState({currentVerificationMethod:"SMS"})},onOtherMethodCodeClicked:function(n){e.props.onNewWhatsappCodeClicked(n),e.setState({currentVerificationMethod:"WHATSAPP"})},verificationMethod:"SMS"}),!m&&p==="SMS"&&!this.props.isInSowaExperience&&c.jsx(P,{onNewCodeClicked:this.props.onNewCodeClicked}),!m&&c.jsx(T,{onClickBackupCode:function(){e.setState({currentVerificationMethod:"BACKUP_CODE"})},onClickSmsCode:function(n){e.props.onNewCodeClicked(n),e.setState({currentVerificationMethod:"SMS"})},verificationMethod:p}),this.props.style==="modal"&&(o("PolarisUA").isMobile()?c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1iymm2a x1ys307a x1diwwjn x14vqqas x1n2onr6",children:c.jsx(r("PolarisIGCoreButton.react"),{loading:this.props.requestInFlight,onClick:this.$5,children:o("PolarisAuthStrings").CONTINUE})}):c.jsx("div",{className:"xqjyukv x1qjc9v5 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1sy10c2 x1n2onr6 xh8yej3",children:c.jsx(r("IGDSDialogFooter.react"),{endAdornment:c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,loading:this.props.requestInFlight,onClick:this.$5,children:o("PolarisAuthStrings").CONTINUE}),startAdornment:this.props.onBackClick!=null?c.jsx("div",{className:"xqjyukv x1cy8zhl x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s xl56j7k xpdmqnj x1g0dm76 x1n2onr6",children:c.jsx(r("PolarisIGCoreButton.react"),{borderless:!0,onClick:this.props.onBackClick,children:o("PolarisGenericStrings").BACK_TEXT})}):null})}))]})]}))},t})(c.Component);O.defaultProps={style:"default"};function B(e,t){var n,r=e.twoFactor,o=r==null?void 0:r.message;return{eligibleForMultipleTotp:(r==null?void 0:r.eligibleForMultipleTotp)||!1,errorMessage:o&&o.isError&&o.text||((n=t.errorMessage)!=null?n:null),hasTwoFactorState:!!r,isAccountSwitcherOpen:e.navigation.isAccountSwitcherOpen,isInSowaExperience:(r==null?void 0:r.isInSowaExperience)||!1,lastFourDigits:r==null?void 0:r.lastFourDigits,maskedPhoneNumber:r==null?void 0:r.maskedPhoneNumber,requestInFlight:(r==null?void 0:r.requestInFlight)||t.requestInFlight,showTrustedDevice:(r==null?void 0:r.showTrustedDevice)||!1,smsTwoFactorOn:(r==null?void 0:r.smsTwoFactorOn)||!1,successMessage:o&&!o.isError?o.text:"",totpTwoFactorOn:(r==null?void 0:r.totpTwoFactorOn)||!1}}function W(e,t){return{onNewCodeClicked:function(n){e(o("PolarisTwoFactorActions").requestSMSCode())},onNewWhatsappCodeClicked:function(n){e(o("PolarisTwoFactorActions").requestWhatsappCode())},onSubmit:function(r,a,i){var n;e(o("PolarisTwoFactorActions").submitVerificationCode(t.pageIdentifier,r,a,i,(n=t.isPrivacyPortalReq)!=null?n:!1))}}}var q=o("PolarisReactRedux.react").connect(B,W)(O);l.default=q}),226);
__d("XPolarisLoginControllerParamsRefineValidator",["coerceRouteParams","refine"],(function(t,n,r,o,a,i,l){var e,s=(e=o("refine")).or(e.literal(null),e.string()),u=e.object({dyi_job_id:s,e_un:s,enable_fb_login:e.bool(),flo:e.bool(),force_authentication:e.bool(),force_login_igid:s,hl:s,is_from_rle:e.bool(),is_initiator_feta:s,is_profile_curation:e.bool(),logged_out_reporting_url:s,mtn:e.bool(),next:s,platform_app_id:s,request_id:s,source:s,target_user_id:s}),c=e.coercion(u),d=Object.freeze({force_authentication:{legacyNames:[],default:!1,coercibleType:"EXISTS"},target_user_id:{legacyNames:[],default:null,coercibleType:"STRING"},force_login_igid:{legacyNames:[],default:null,coercibleType:"STRING"},platform_app_id:{legacyNames:[],default:null,coercibleType:"STRING"},logged_out_reporting_url:{legacyNames:[],default:null,coercibleType:"STRING"},next:{legacyNames:[],default:null,coercibleType:"STRING"},dyi_job_id:{legacyNames:[],default:null,coercibleType:"STRING"},source:{legacyNames:[],default:null,coercibleType:"STRING"},hl:{legacyNames:[],default:null,coercibleType:"STRING"},e_un:{legacyNames:[],default:null,coercibleType:"STRING"},enable_fb_login:{legacyNames:[],default:!1,coercibleType:"EXISTS"},request_id:{legacyNames:[],default:null,coercibleType:"STRING"},is_from_rle:{legacyNames:[],default:!1,coercibleType:"EXISTS"},is_profile_curation:{legacyNames:[],default:!1,coercibleType:"EXISTS"},mtn:{legacyNames:[],default:!1,coercibleType:"EXISTS"},flo:{legacyNames:[],default:!1,coercibleType:"BOOL"},is_initiator_feta:{legacyNames:[],default:null,coercibleType:"STRING"}});function m(e){return c(r("coerceRouteParams")(e,d))}l.refineXPolarisLoginControllerParams=m}),98);
__d("PolarisAuthFormCard.react",["fbt","invariant","ix","CometRouteParams","FBLogger","IGCoreImage.react","IGDSBox.react","IGDSDivider.react","IGDSIgLogoFilledIcon.react","IGDSSpinner.react","IGDSText.react","IGDSTextVariants.react","InstagramQueryParamsHelper","PolarisAppsellUnit.react","PolarisAuthActionConstants","PolarisAuthActions","PolarisAuthTypeSwitcher.react","PolarisBarcelonaAppSVGIcon.react","PolarisConfig","PolarisConsentModal.react","PolarisExternalLink.react","PolarisFBConnectActions","PolarisFBConnectHelpers","PolarisFBConnectV2LoginForm.react","PolarisFacebookAccountPicker.react","PolarisFacebookLoginForm.react","PolarisIsLoggedIn","PolarisLandingForm.react","PolarisLoggedOutContentWallDialogAuthCTAs.react","PolarisLoggedOutCtaClickLogger","PolarisLoggedOutCtaImpressionLogger","PolarisLoggedOutNetzDGReportLink.react","PolarisLoggedOutUpsellStrings","PolarisLoginActionClearStopDeletionNonce","PolarisLoginActionLogin","PolarisLoginActionLoginWithFBAccessToken","PolarisLoginActionLoginWithFBJSSDK","PolarisLoginLogger","PolarisLoginQPL","PolarisOneTapLogin","PolarisOneTapLoginForm.react","PolarisOneTapLoginStorage","PolarisQueryParams","PolarisReactRedux.react","PolarisSenderNameHelpers","PolarisSignupForm.react","PolarisSignupTypes","PolarisSlimLoginForm.react","PolarisStrategicWebTraffic","PolarisTwoFactorForm.react","PolarisUA","PolarisUserAvatar.react","URI","XPolarisLoginControllerParamsRefineValidator","nullthrows","polarisIsEligibleForFacebookLogin","polarisUserSelectors","react","react-compiler-runtime","stylex","usePolarisCentralizedUpsellState","usePolarisLOXMobileHomepageDesign","usePolarisLoggedInFBUserForHomepage","usePolarisPageID","usePolarisRouteConfig","usePrevious","useSinglePartialViewImpression","warning"],(function(t,n,r,o,a,i,l,s,u,c){"use strict";var e,d,m,p=m||(m=o("react")),_=m.useEffect,f=s._(/*BTDS*/"Continuar sin iniciar sesi\u00f3n."),g=s._(/*BTDS*/"Se restableci\u00f3 tu contrase\u00f1a. Intenta iniciar sesi\u00f3n de nuevo."),h=s._(/*BTDS*/"Inicia sesi\u00f3n para seguir a personas en Instagram."),y=s._(/*BTDS*/"\u00cdcono de candado de autenticaci\u00f3n en dos pasos"),C={mobileBrandingForwardPadding:{paddingTop:"xexx8yu",$$css:!0},mobileBrandPadding:{paddingTop:"xnk5j39",$$css:!0},mobileFooterPadding:{paddingBottom:"xefzj8c",$$css:!0},redesignedRoot:{maxWidth:"x1k7vjkh xusnbm3",$$css:!0},root:{color:"x5n08af",display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",justifyContent:"xl56j7k x7qam4e",marginTop:"x14vqqas x15lw1kp",maxWidth:"x1dc814f x1owpceq",width:"xh8yej3",$$css:!0},rootModal:{marginTop:"xdj266r",marginInlineEnd:"x14z9mp",marginBottom:"xat24cr",marginInlineStart:"x1lziwak",maxWidth:"x1319t99",width:"xh8yej3",$$css:!0}};function b(t){var n=o("react-compiler-runtime").c(86),a=t.authTypeOverride,i=t.dialogSource,l=t.forceLoginIgId,s=t.forceLoginProfilePicUrl,c=t.forceLoginUsername,d=t.fromLoggedOutDialog,m=t.hideAppUpsells,f=t.hideBorder,g=t.hideForgotPassword,h=t.intentSource,y=t.isPrivacyPortalReq,b=t.pageIdentifier,S=t.pageType,R=t.shouldAutoPickUsername,L=t.shouldEnableShortFirstStep,E=t.shouldShowBirthdayStepInBaseForm,k=t.shouldShowBirthdayTransparency,I=t.shouldShowRedesignedSignupPage,T=t.showNetzDGReportLink,D=t.style,x=t.useMobileBrandPadding,$=t.useMobileFooterPadding,M=t.usernameHint,w=t.xstyle,F=d===void 0?!1:d,B=m===void 0?!1:m,W=g===void 0?!1:g,q=y===void 0?!1:y,U=E===void 0?!1:E,V=T===void 0?!1:T,H=D===void 0?"default":D,G=x===void 0?!0:x,z=$===void 0?!0:$,j=r("usePolarisPageID")(),K=b!=null?b:j,Q=r("usePolarisLoggedInFBUserForHomepage")(),Y=N();Q=!Y&&o("PolarisUA").isDesktop()?Q:null;var J=o("PolarisReactRedux.react").useSelector(v),Z=J.auth,ee=Z.authType,oe=a!=null?a:ee;oe!=null||u(0,51551);var ae=I===!0&&oe===o("PolarisAuthActionConstants").AUTH.signup,ie=r("usePolarisLOXMobileHomepageDesign")(),le=ie.isLOXMobileHomepageDesign,se=r("usePolarisRouteConfig")(),ue=se.showBrandingPageWithNav,ce=le||ue===!0,de=r("usePrevious")(oe),me,pe;n[0]!==oe||n[1]!==de?(me=function(){!r("PolarisLoginQPL").isActive()&&de!==o("PolarisAuthActionConstants").AUTH.login&&oe===o("PolarisAuthActionConstants").AUTH.login&&r("PolarisLoginQPL").start()},pe=[de,oe],n[0]=oe,n[1]=de,n[2]=me,n[3]=pe):(me=n[2],pe=n[3]),_(me,pe);var _e=o("PolarisReactRedux.react").useStore(),fe,ge;n[4]!==oe||n[5]!==_e?(fe=function(){if(oe===o("PolarisAuthActionConstants").AUTH.login||oe===o("PolarisAuthActionConstants").AUTH.twoFactor)return(function(){var e=_e.getState().auth.authType===o("PolarisAuthActionConstants").AUTH.twoFactor;r("PolarisLoginQPL").isActive()&&!e&&r("PolarisLoginQPL").endCancel()})},ge=[oe,_e],n[4]=oe,n[5]=_e,n[6]=fe,n[7]=ge):(fe=n[6],ge=n[7]),_(fe,ge);var he=o("PolarisReactRedux.react").useDispatch(),ye=P(),Ce;n[8]!==oe||n[9]!==Y||n[10]!==Q||n[11]!==ye?(Ce=function(){var e;Q!=null&&((e=Q)==null?void 0:e.profile_name)!=null&&o("PolarisUA").isDesktop()&&!Y&&oe!==o("PolarisAuthActionConstants").AUTH.fbLogin&&oe!==o("PolarisAuthActionConstants").AUTH.fbAccountPicker&&oe!==o("PolarisAuthActionConstants").AUTH.oneTapLogin&&ye(o("PolarisAuthActionConstants").AUTH.fbConnectV2)},n[8]=oe,n[9]=Y,n[10]=Q,n[11]=ye,n[12]=Ce):Ce=n[12];var be;n[13]!==oe||n[14]!==he||n[15]!==Y||n[16]!==Q||n[17]!==ye||n[18]!==de?(be=[de,oe,Q,Y,he,ye],n[13]=oe,n[14]=he,n[15]=Y,n[16]=Q,n[17]=ye,n[18]=de,n[19]=be):be=n[19],_(Ce,be);var ve;n[20]!==oe||n[21]!==ce||n[22]!==ae||n[23]!==H||n[24]!==G||n[25]!==z||n[26]!==w?(ve=(e||(e=r("stylex"))).props(C.root,H==="modal"&&C.rootModal,ae&&C.redesignedRoot,o("PolarisUA").isMobile()&&!!z&&C.mobileFooterPadding,o("PolarisUA").isMobile()&&oe===o("PolarisAuthActionConstants").AUTH.none&&G&&(ce?C.mobileBrandingForwardPadding:C.mobileBrandPadding),w),n[20]=oe,n[21]=ce,n[22]=ae,n[23]=H,n[24]=G,n[25]=z,n[26]=w,n[27]=ve):ve=n[27];var Se;n[28]!==oe||n[29]!==f||n[30]!==ae||n[31]!==H?(Se={0:{className:"x6s0dn4 xvbhtw8 x1pmru9 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x13fuv20 x1qgpocp x18b5jzi xa0kie1 x1q0q8m5 xxrrrr8 x1t7ytsu x141z70w x178xt8z x1lun4ml xso031l xpilrb4 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu xdj266r x14z9mp x1lziwak xyorhqc xzboxd6 x889kno xyri2b x1a8lsjc x1c1uobl x1n2onr6 x11njtxf"},4:{className:"x6s0dn4 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x13fuv20 x1qgpocp x18b5jzi xa0kie1 x1q0q8m5 xxrrrr8 x1t7ytsu x141z70w x178xt8z x1lun4ml xso031l xpilrb4 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu x1n2onr6 x11njtxf x7r02ix xdj266r x14z9mp xat24cr x1lziwak xyri2b x18d9i69 x1c1uobl xz9dl7a xh8yej3"},2:{className:"x6s0dn4 xvbhtw8 x1pmru9 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu xdj266r x14z9mp x1lziwak xyorhqc xzboxd6 x889kno xyri2b x1a8lsjc x1c1uobl x1n2onr6 x11njtxf x1ejq31n x18oe1m7 x1sy0etr xstzfhl x972fbf x10w94by x1qhh985 x14e42zd"},6:{className:"x6s0dn4 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu x1n2onr6 x11njtxf x7r02ix xdj266r x14z9mp xat24cr x1lziwak xyri2b x18d9i69 x1c1uobl xz9dl7a xh8yej3 x1ejq31n x18oe1m7 x1sy0etr xstzfhl x972fbf x10w94by x1qhh985 x14e42zd"},1:{className:"x6s0dn4 xvbhtw8 x1pmru9 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x13fuv20 x1qgpocp x18b5jzi xa0kie1 x1q0q8m5 xxrrrr8 x1t7ytsu x141z70w x178xt8z x1lun4ml xso031l xpilrb4 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu x1n2onr6 x11njtxf xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl"},5:{className:"x6s0dn4 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x13fuv20 x1qgpocp x18b5jzi xa0kie1 x1q0q8m5 xxrrrr8 x1t7ytsu x141z70w x178xt8z x1lun4ml xso031l xpilrb4 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu x1n2onr6 x11njtxf x7r02ix xh8yej3 xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl"},3:{className:"x6s0dn4 xvbhtw8 x1pmru9 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu x1n2onr6 x11njtxf x1ejq31n x18oe1m7 x1sy0etr xstzfhl x972fbf x10w94by x1qhh985 x14e42zd xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl"},7:{className:"x6s0dn4 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu x1n2onr6 x11njtxf x7r02ix xh8yej3 x1ejq31n x18oe1m7 x1sy0etr xstzfhl x972fbf x10w94by x1qhh985 x14e42zd xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl"}}[(H==="modal")<<2|!!(f===!0||ae)<<1|(oe===o("PolarisAuthActionConstants").AUTH.fbConnectV2&&H!=="modal")<<0],n[28]=oe,n[29]=f,n[30]=ae,n[31]=H,n[32]=Se):Se=n[32];var Re;n[33]!==oe||n[34]!==K||n[35]!==ce||n[36]!==ae?(Re=!ce&&p.jsx(X,{authType:oe,pageID:K,shouldShowRedesignedSignup:ae}),n[33]=oe,n[34]=K,n[35]=ce,n[36]=ae,n[37]=Re):Re=n[37];var Le;n[38]!==oe||n[39]!==i||n[40]!==l||n[41]!==s||n[42]!==c||n[43]!==F||n[44]!==W||n[45]!==h||n[46]!==q||n[47]!==Q||n[48]!==K||n[49]!==S||n[50]!==R||n[51]!==L||n[52]!==U||n[53]!==k||n[54]!==ae||n[55]!==H||n[56]!==M?(Le=p.jsx(O,{authType:oe,dialogSource:i,forceLoginIgId:l,forceLoginProfilePicUrl:s,forceLoginUsername:c,fromLoggedOutDialog:F,hideForgotPassword:W,intentSource:h,isPrivacyPortalReq:q,loggedInFBUser:Q,pageID:K,pageType:S,shouldAutoPickUsername:R,shouldEnableShortFirstStep:L,shouldShowBirthdayStepInBaseForm:U,shouldShowBirthdayTransparency:k,shouldShowRedesignedSignup:ae,style:H,usernameHint:M}),n[38]=oe,n[39]=i,n[40]=l,n[41]=s,n[42]=c,n[43]=F,n[44]=W,n[45]=h,n[46]=q,n[47]=Q,n[48]=K,n[49]=S,n[50]=R,n[51]=L,n[52]=U,n[53]=k,n[54]=ae,n[55]=H,n[56]=M,n[57]=Le):Le=n[57];var Ee;n[58]!==oe||n[59]!==Le?(Ee=p.jsx(A,{authType:oe,children:Le}),n[58]=oe,n[59]=Le,n[60]=Ee):Ee=n[60];var ke;n[61]!==K||n[62]!==V?(ke=p.jsx(te,{pageID:K,showNetzDGReportLink:V}),n[61]=K,n[62]=V,n[63]=ke):ke=n[63];var Ie;n[64]===Symbol.for("react.memo_cache_sentinel")?(Ie=p.jsx(ne,{}),n[64]=Ie):Ie=n[64];var Te;n[65]!==Se||n[66]!==Re||n[67]!==Ee||n[68]!==ke?(Te=p.jsxs("div",babelHelpers.extends({},Se,{"data-testid":void 0,children:[Re,Ee,ke,Ie]})),n[65]=Se,n[66]=Re,n[67]=Ee,n[68]=ke,n[69]=Te):Te=n[69];var De;n[70]===Symbol.for("react.memo_cache_sentinel")?(De=p.jsx(r("PolarisConsentModal.react"),{}),n[70]=De):De=n[70];var xe;n[71]!==oe||n[72]!==l||n[73]!==F||n[74]!==B||n[75]!==f||n[76]!==Q||n[77]!==K||n[78]!==S||n[79]!==ae||n[80]!==H?(xe=ae!==!0&&p.jsx(re,{authType:oe,forceLoginIgId:l,fromLoggedOutDialog:F,hideAppUpsells:B,hideBorder:f,loggedInFBUser:Q,pageId:K,pageType:S,style:H}),n[71]=oe,n[72]=l,n[73]=F,n[74]=B,n[75]=f,n[76]=Q,n[77]=K,n[78]=S,n[79]=ae,n[80]=H,n[81]=xe):xe=n[81];var $e;return n[82]!==ve||n[83]!==Te||n[84]!==xe?($e=p.jsxs("div",babelHelpers.extends({},ve,{children:[Te,De,xe]})),n[82]=ve,n[83]=Te,n[84]=xe,n[85]=$e):$e=n[85],$e}function v(e){return e}function S(e,t,n){var a=o("react-compiler-runtime").c(4),i;return a[0]!==e||a[1]!==t||a[2]!==n?(i={onImpressionStart:function(){e||o("PolarisLoggedOutCtaImpressionLogger").logLoggedOutCtaImpressionEvent("auth_form",n,{},t!=null?t:void 0)}},a[0]=e,a[1]=t,a[2]=n,a[3]=i):i=a[3],r("useSinglePartialViewImpression")(i)}function R(e){var t=r("usePolarisCentralizedUpsellState")(),n=t[0],a=n.isProfileOrPostPage;return e===o("PolarisAuthActionConstants").AUTH.signup&&a}function L(e){var t=o("react-compiler-runtime").c(4),n=o("PolarisReactRedux.react").useSelector(E),a=n.auth,i=a.signup,l=r("usePolarisCentralizedUpsellState")(),s=l[0],u=s.isProfileOrPostPage,c;return t[0]!==e||t[1]!==u||t[2]!==(i==null?void 0:i.step)?(c=!o("PolarisIsLoggedIn").isLoggedIn()&&o("PolarisUA").isDesktop()&&u&&e!==o("PolarisAuthActionConstants").AUTH.fbConnectV2&&(e===o("PolarisAuthActionConstants").AUTH.signup?(i==null?void 0:i.step)===o("PolarisSignupTypes").STEP.base:!0),t[0]=e,t[1]=u,t[2]=i==null?void 0:i.step,t[3]=c):c=t[3],c}function E(e){return e}function k(){var e=o("react-compiler-runtime").c(6),t=o("PolarisReactRedux.react").useSelector(I),n=t.fb,r=n.authResponse,a=n.igProfile,i=n.igProfiles,l=n.igSSODisabled;if(a==null)return null;var s=r==null?void 0:r.userID,u;return e[0]!==a.profilePictureUrl||e[1]!==a.username||e[2]!==i||e[3]!==l||e[4]!==s?(u={fbUserID:s,igSSODisabled:l,linkedIGProfiles:i,profilePictureUrl:a.profilePictureUrl,username:a.username},e[0]=a.profilePictureUrl,e[1]=a.username,e[2]=i,e[3]=l,e[4]=s,e[5]=u):u=e[5],u}function I(e){return e}function T(){var e,t,n=o("PolarisReactRedux.react").useSelector(D),r=n.auth,a=r.login,i=r.twoFactor;return(a==null?void 0:a.errorMessage)!=null?a.errorMessage:(i==null||(e=i.message)==null?void 0:e.isError)===!0&&(i==null||(t=i.message)==null?void 0:t.text)!=null?i.message.text:null}function D(e){return e}function x(){var e,t,n,r=o("PolarisReactRedux.react").useSelector($),a=r.auth,i=a.login,l=a.signup,s=a.twoFactor;return(e=(t=(n=i==null?void 0:i.requestInFlight)!=null?n:l==null?void 0:l.requestInFlight)!=null?t:s==null?void 0:s.requestInFlight)!=null?e:!1}function $(e){return e}function P(){var e=o("react-compiler-runtime").c(2),t=o("PolarisReactRedux.react").useDispatch(),n;return e[0]!==t?(n=function(n){t(o("PolarisAuthActions").switchAuthType(n))},e[0]=t,e[1]=n):n=e[1],n}function N(){var e=o("react-compiler-runtime").c(2),t=o("PolarisReactRedux.react").useSelector(w),n=t.auth,a=n.next,i;if(e[0]!==a){i=Symbol.for("react.early_return_sentinel");e:{var l=new(d||(d=r("URI")))(a),s=l.getPath(),u=l.getDomain();if(u===""&&s==="/oauth/authorize"){var c,m=l.getQueryData(),p=(c=m.scope)==null?void 0:c.split(",");i=(p==null?void 0:p.every(M))===!0;break e}}e[0]=a,e[1]=i}else i=e[1];return i!==Symbol.for("react.early_return_sentinel")?i:!1}function M(e){return e.startsWith("threads_")}function w(e){return e}function A(e){var t=o("react-compiler-runtime").c(1),n=e.authType,a=e.children,i=o("PolarisReactRedux.react").useSelector(F),l=i.auth,s=l.isFBLoggedIn;if((n===o("PolarisAuthActionConstants").AUTH.fbLogin||n===o("PolarisAuthActionConstants").AUTH.fbAccountPicker)&&s==null){var u;return t[0]===Symbol.for("react.memo_cache_sentinel")?(u=p.jsx("div",{className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s xl56j7k x1n2onr6 x1db3i3o",children:p.jsx(r("IGDSSpinner.react"),{size:"small"})}),t[0]=u):u=t[0],u}return a}function F(e){return e}function O(e){var t=o("react-compiler-runtime").c(36),n=e.authType,a=e.dialogSource,i=e.forceLoginIgId,l=e.forceLoginProfilePicUrl,s=e.forceLoginUsername,u=e.fromLoggedOutDialog,c=e.hideForgotPassword,d=e.intentSource,m=e.isPrivacyPortalReq,_=e.loggedInFBUser,f=e.pageID,g=e.pageType,h=e.shouldAutoPickUsername,y=e.shouldEnableShortFirstStep,C=e.shouldShowBirthdayStepInBaseForm,b=e.shouldShowBirthdayTransparency,v=e.shouldShowRedesignedSignup,S=e.style,R=e.usernameHint,L=m===void 0?!1:m,E=h===void 0?!1:h,I=y===void 0?!1:y,T=C===void 0?!1:C,D=v===void 0?!1:v,x=o("PolarisReactRedux.react").useSelector(B),$=x.auth,P=$.isFBLoggedIn,M=k(),w=N(),A=i!=null,F=(n===o("PolarisAuthActionConstants").AUTH.fbLogin||n===o("PolarisAuthActionConstants").AUTH.fbAccountPicker)&&P===!0&&!!M;if(n===o("PolarisAuthActionConstants").AUTH.fbConnectV2&&_!=null&&_.profile_name!=null){var O;return t[0]===Symbol.for("react.memo_cache_sentinel")?(O=p.jsx(z,{}),t[0]=O):O=t[0],O}else if(n===o("PolarisAuthActionConstants").AUTH.signup&&!o("PolarisUA").isMobile()){var V;return t[1]!==n||t[2]!==u||t[3]!==d||t[4]!==f||t[5]!==E||t[6]!==I||t[7]!==T||t[8]!==b||t[9]!==D||t[10]!==S?(V=p.jsx(W,{authType:n,fromLoggedOutDialog:u,intentSource:d,pageID:f,shouldAutoPickUsername:E,shouldEnableShortFirstStep:I,shouldShowBirthdayStepInBaseForm:T,shouldShowBirthdayTransparency:b,shouldShowRedesignedSignup:D,style:S}),t[1]=n,t[2]=u,t[3]=d,t[4]=f,t[5]=E,t[6]=I,t[7]=T,t[8]=b,t[9]=D,t[10]=S,t[11]=V):V=t[11],V}else if(n===o("PolarisAuthActionConstants").AUTH.twoFactor){var H;return t[12]!==L||t[13]!==f||t[14]!==S?(H=p.jsx(q,{isPrivacyPortalReq:L,pageID:f,style:S}),t[12]=L,t[13]=f,t[14]=S,t[15]=H):H=t[15],H}else if(!A&&F&&!w&&(M==null?void 0:M.igSSODisabled)!==!0){var Q;return t[16]!==n||t[17]!==f||t[18]!==g?(Q=p.jsx(U,{authType:n,pageID:f,pageType:g}),t[16]=n,t[17]=f,t[18]=g,t[19]=Q):Q=t[19],Q}else if(!A&&o("PolarisOneTapLogin").isOneTapLoginEligible()&&n===o("PolarisAuthActionConstants").AUTH.oneTapLogin){var X;return t[20]!==n?(X=p.jsx(G,{authType:n}),t[20]=n,t[21]=X):X=t[21],X}else if(o("PolarisUA").isMobile()&&n===o("PolarisAuthActionConstants").AUTH.none){var Y;return t[22]!==f?(Y=p.jsx(j,{pageID:f}),t[22]=f,t[23]=Y):Y=t[23],Y}r("warning")(n===o("PolarisAuthActionConstants").AUTH.login||n===o("PolarisAuthActionConstants").AUTH.oneTapLogin||n===o("PolarisAuthActionConstants").AUTH.multiStepSignup,'Expected authType to be "login or oneTapLogin"; got "%s"',n);var J;return t[24]!==a||t[25]!==i||t[26]!==l||t[27]!==s||t[28]!==u||t[29]!==c||t[30]!==d||t[31]!==L||t[32]!==f||t[33]!==S||t[34]!==R?(J=p.jsx(K,{dialogSource:a,forceLoginIgId:i,forceLoginProfilePicUrl:l,forceLoginUsername:s,fromLoggedOutDialog:u,hideForgotPassword:c,intentSource:d,isPrivacyPortalReq:L,pageID:f,style:S,usernameHint:R}),t[24]=a,t[25]=i,t[26]=l,t[27]=s,t[28]=u,t[29]=c,t[30]=d,t[31]=L,t[32]=f,t[33]=S,t[34]=R,t[35]=J):J=t[35],J}function B(e){return e}function W(e){var t=o("react-compiler-runtime").c(14),n=e.authType,a=e.fromLoggedOutDialog,i=e.intentSource,l=e.pageID,s=e.shouldAutoPickUsername,u=e.shouldEnableShortFirstStep,c=e.shouldShowBirthdayStepInBaseForm,d=e.shouldShowBirthdayTransparency,m=e.shouldShowRedesignedSignup,_=e.style,f=s===void 0?!1:s,g=u===void 0?!1:u,h=c===void 0?!1:c,y=m===void 0?!1:m,C=S(a,i,l),b=x(),v=R(n),L=r("usePolarisCentralizedUpsellState")(),E=L[0],k=E.isProfileOrPostPage;if(v){var I;return t[0]===Symbol.for("react.memo_cache_sentinel")?(I=p.jsx(r("PolarisLoggedOutContentWallDialogAuthCTAs.react"),{}),t[0]=I):I=t[0],I}var T;t[1]!==k||t[2]!==l||t[3]!==b||t[4]!==f||t[5]!==g||t[6]!==h||t[7]!==d||t[8]!==y||t[9]!==_?(T=p.jsx(r("PolarisSignupForm.react"),{hideHeader:k,pageIdentifier:l,requestInFlight:b,shouldAutoPickUsername:f,shouldEnableShortFirstStep:g,shouldShowBirthdayStepInBaseForm:h,shouldShowBirthdayTransparency:d,shouldShowRedesignedSignup:y,style:_}),t[1]=k,t[2]=l,t[3]=b,t[4]=f,t[5]=g,t[6]=h,t[7]=d,t[8]=y,t[9]=_,t[10]=T):T=t[10];var D;return t[11]!==C||t[12]!==T?(D=p.jsx("div",{ref:C,children:T}),t[11]=C,t[12]=T,t[13]=D):D=t[13],D}function q(e){var t=o("react-compiler-runtime").c(6),n=e.isPrivacyPortalReq,a=e.pageID,i=e.style,l=n===void 0?!1:n,s=T(),u=x(),c=s||"",d;return t[0]!==l||t[1]!==a||t[2]!==u||t[3]!==i||t[4]!==c?(d=p.jsx(r("PolarisTwoFactorForm.react"),{errorMessage:c,isPrivacyPortalReq:l,pageIdentifier:a,requestInFlight:u,style:i}),t[0]=l,t[1]=a,t[2]=u,t[3]=i,t[4]=c,t[5]=d):d=t[5],d}function U(e){var t=o("react-compiler-runtime").c(31),n=e.authType,a=e.pageID,i=e.pageType,l=o("PolarisReactRedux.react").useSelector(H),s=l.auth,u=l.fb,c=s.login,d=u.status,m=o("PolarisReactRedux.react").useDispatch(),_=k(),f=T(),g=P(),h=x(),y=L(n),C;if(t[0]!==(_==null?void 0:_.linkedIGProfiles)){var b;C=(b=_==null?void 0:_.linkedIGProfiles)!=null?b:[],t[0]=_==null?void 0:_.linkedIGProfiles,t[1]=C}else C=t[1];var v=C,S;t[2]!==m||t[3]!==a?(S=function(t){t!=null?(o("PolarisLoggedOutCtaClickLogger").logLoggedOutCtaClickEvent("login_with_fb","auth_form",a),m(o("PolarisLoginActionLoginWithFBJSSDK").loginWithFBJSSDK({pageID:a,source:a},t))):(o("PolarisLoggedOutCtaClickLogger").logLoggedOutCtaClickEvent("fb_connect","auth_form",a),o("PolarisFBConnectHelpers").redirectToFBOAuth("/",a).catch(V))},t[2]=m,t[3]=a,t[4]=S):S=t[4];var R=S,E=!!_&&o("PolarisFBConnectHelpers").isFBCUnique(_.username),I=v.length<=1,D=o("PolarisQueryParams").getShouldRefreshFBCookie();if(o("PolarisOneTapLogin").isOneTapLoginEligible()&&n!==o("PolarisAuthActionConstants").AUTH.fbAccountPicker&&(!D||I)){var $;t[5]===Symbol.for("react.memo_cache_sentinel")?($=o("PolarisOneTapLoginStorage").getLoginNonces(),t[5]=$):$=t[5];var N=$;if(Object.values(N).length>=1||E){var M=E&&I?_:null,w=E&&I?R:void 0,A=!y,F;return t[6]!==M||t[7]!==w||t[8]!==A?(F=p.jsx(r("PolarisOneTapLoginForm.react"),{fbConnectedUser:M,loginNonces:N,onRequestFBLogin:w,showSingleAccountProfilePicture:A}),t[6]=M,t[7]=w,t[8]=A,t[9]=F):F=t[9],F}}else if(v.length>1&&E){var O;t[10]!==(c==null?void 0:c.deletionNonce)||t[11]!==m||t[12]!==a?(O=function(t){m(o("PolarisLoginActionLoginWithFBAccessToken").loginWithFBAccessToken({pageID:a,skipped:!1,source:"fbSignupPage"},t,c==null?void 0:c.deletionNonce))},t[10]=c==null?void 0:c.deletionNonce,t[11]=m,t[12]=a,t[13]=O):O=t[13];var B=O,W;return t[14]!==v||t[15]!==B?(W=p.jsx(r("PolarisFacebookAccountPicker.react"),{fbConnectedIgProfiles:v,onRequestFBLogin:B}),t[14]=v,t[15]=B,t[16]=W):W=t[16],W}var q;t[17]!==d||t[18]!==g?(q=function(t){o("PolarisLoginLogger").logLoginEvent({event_name:"fb_switch_accounts_click",fbconnect_status:d}),g(t)},t[17]=d,t[18]=g,t[19]=q):q=t[19];var U=q,G;t[20]!==_?(G=r("nullthrows")(_),t[20]=_,t[21]=G):G=t[21];var z=i!=null?i:void 0,j;return t[22]!==d||t[23]!==U||t[24]!==f||t[25]!==R||t[26]!==a||t[27]!==h||t[28]!==G||t[29]!==z?(j=p.jsx(r("PolarisFacebookLoginForm.react"),{accountInfo:G,errorMessage:f,fbConnectStatus:d,onRequestLogin:R,onSwitchAccountsClick:U,pageID:a,pageType:z,requestInFlight:h}),t[22]=d,t[23]=U,t[24]=f,t[25]=R,t[26]=a,t[27]=h,t[28]=G,t[29]=z,t[30]=j):j=t[30],j}function V(e){return r("FBLogger")("ig_web").catching(e).mustfix("unexpected")}function H(e){return e}function G(e){var t=o("react-compiler-runtime").c(3),n=e.authType,a=L(n),i;t[0]===Symbol.for("react.memo_cache_sentinel")?(i=o("PolarisOneTapLoginStorage").getLoginNonces(),t[0]=i):i=t[0];var l=!a,s;return t[1]!==l?(s=p.jsx(r("PolarisOneTapLoginForm.react"),{loginNonces:i,showSingleAccountProfilePicture:l}),t[1]=l,t[2]=s):s=t[2],s}function z(){var e=o("react-compiler-runtime").c(1),t;return e[0]===Symbol.for("react.memo_cache_sentinel")?(t=p.jsx(r("PolarisFBConnectV2LoginForm.react"),{}),e[0]=t):t=e[0],t}function j(e){var t=o("react-compiler-runtime").c(4),n=e.pageID,a;t[0]!==n?(a={onImpressionStart:function(){o("PolarisLoggedOutCtaImpressionLogger").logLoggedOutCtaImpressionEvent("full_page",n)}},t[0]=n,t[1]=a):a=t[1];var i=r("useSinglePartialViewImpression")(a),l;return t[2]!==i?(l=p.jsx(r("PolarisLandingForm.react"),{ref:i}),t[2]=i,t[3]=l):l=t[3],l}function K(e){var t=o("react-compiler-runtime").c(48),n=e.dialogSource,a=e.forceLoginIgId,i=e.forceLoginProfilePicUrl,l=e.forceLoginUsername,s=e.fromLoggedOutDialog,u=e.hideForgotPassword,c=e.intentSource,d=e.isPrivacyPortalReq,m=e.pageID,_=e.style,f=e.usernameHint,y=d===void 0?!1:d,C=o("PolarisReactRedux.react").useSelector(Q),b=C.auth,v=C.fb,R=b.isFBLoggedIn,L=b.login,E=b.next,I=v.status,D=o("PolarisReactRedux.react").useDispatch(),$=P(),M=S(s,c,m),w=N(),A=k(),F=L&&L.source==="follow"?h:"",O=T(),B=x(),W=L&&L.wasPasswordJustReset?g:"",q;t[0]!==D||t[1]!==s||t[2]!==y||t[3]!==m?(q=function(t,n,r){D(o("PolarisLoginActionLogin").login(t,n,{source:m},r,!1,null,s,y))},t[0]=D,t[1]=s,t[2]=y,t[3]=m,t[4]=q):q=t[4];var U=q,V;t[5]!==D?(V=function(t){D(o("PolarisFBConnectActions").setShowSSODisabledModal(t))},t[5]=D,t[6]=V):V=t[6];var H=V,G;t[7]!==D||t[8]!==s||t[9]!==m?(G=function(t,n,r,a){D(o("PolarisLoginActionLogin").login(t,n,{source:m},r,!1,a,s))},t[7]=D,t[8]=s,t[9]=m,t[10]=G):G=t[10];var z=G,j;t[11]!==D?(j=function(){D(o("PolarisLoginActionClearStopDeletionNonce").clearStopDeletionNonce())},t[11]=D,t[12]=j):j=t[12];var K=j,X;t[13]!==(A==null?void 0:A.igSSODisabled)||t[14]!==(A==null?void 0:A.linkedIGProfiles)||t[15]!==(A==null?void 0:A.username)||t[16]!==H||t[17]!==$?(X=function(){var e,t=(e=A==null?void 0:A.linkedIGProfiles)!=null?e:[];(A==null?void 0:A.igSSODisabled)===!0?($(o("PolarisAuthActionConstants").AUTH.login),H(A==null?void 0:A.username)):t.length>1?$(o("PolarisAuthActionConstants").AUTH.fbAccountPicker):$(o("PolarisAuthActionConstants").AUTH.fbLogin)},t[13]=A==null?void 0:A.igSSODisabled,t[14]=A==null?void 0:A.linkedIGProfiles,t[15]=A==null?void 0:A.username,t[16]=H,t[17]=$,t[18]=X):X=t[18];var Y=X,J;t[19]===Symbol.for("react.memo_cache_sentinel")?(J={className:"xod5an3 x1dc814f xh8yej3"},t[19]=J):J=t[19];var Z;t[20]===Symbol.for("react.memo_cache_sentinel")?(Z=r("polarisIsEligibleForFacebookLogin")(),t[20]=Z):Z=t[20];var ee=!!R,te=(A==null?void 0:A.igSSODisabled)===!0,ne=L==null?void 0:L.deletionDate,re=L==null?void 0:L.deletionNonce,oe=f!=null?f:void 0,ae;t[21]!==n||t[22]!==I||t[23]!==a||t[24]!==i||t[25]!==l||t[26]!==s||t[27]!==Y||t[28]!==u||t[29]!==F||t[30]!==w||t[31]!==O||t[32]!==E||t[33]!==K||t[34]!==U||t[35]!==z||t[36]!==B||t[37]!==_||t[38]!==W||t[39]!==ee||t[40]!==te||t[41]!==ne||t[42]!==re||t[43]!==oe?(ae=p.jsx(r("PolarisSlimLoginForm.react"),{dialogSource:n,errorMessage:O,fbConnectStatus:I,forceLoginIgId:a,forceLoginProfilePicUrl:i,forceLoginUsername:l,fromLoggedOutDialog:s,hideFBLogin:!Z,hideForgotPassword:u,infoMessage:F,isFBLoggedIn:ee,isIGSSODisabled:te,isThreadsRequest:w,nextUrl:E,onClearStopDeletionNonce:K,onLoginWithFBClick:Y,onStopAccountDeletion:z,onSubmit:U,requestInFlight:B,stopDeletionDate:ne,stopDeletionNonce:re,style:_,successMessage:W,usernameHint:oe}),t[21]=n,t[22]=I,t[23]=a,t[24]=i,t[25]=l,t[26]=s,t[27]=Y,t[28]=u,t[29]=F,t[30]=w,t[31]=O,t[32]=E,t[33]=K,t[34]=U,t[35]=z,t[36]=B,t[37]=_,t[38]=W,t[39]=ee,t[40]=te,t[41]=ne,t[42]=re,t[43]=oe,t[44]=ae):ae=t[44];var ie;return t[45]!==M||t[46]!==ae?(ie=p.jsx("div",babelHelpers.extends({},J,{ref:M,children:ae})),t[45]=M,t[46]=ae,t[47]=ie):ie=t[47],ie}function Q(e){return e}function X(e){var t=o("react-compiler-runtime").c(9),n=e.authType,a=e.pageID,i=e.shouldShowRedesignedSignup,l=o("PolarisReactRedux.react").useSelector(Y),s=l.auth,u=s.signup,c=L(n),d=r("usePolarisCentralizedUpsellState")(),m=d[0],_=m.isProfileOrPostPage,f=m.lastViewedOwnerID,g;t[0]!==_||t[1]!==f?(g=function(t){var e;return _&&f!=null?(e=o("polarisUserSelectors").maybeGetUserById(t,f))!=null?e:{}:{}},t[0]=_,t[1]=f,t[2]=g):g=t[2];var h=o("PolarisReactRedux.react").useSelector(g),y=!c&&o("PolarisUA").isDesktop()&&n===o("PolarisAuthActionConstants").AUTH.signup?(u==null?void 0:u.step)===o("PolarisSignupTypes").STEP.base:!0;if(c&&(h==null?void 0:h.username)!=null){var C;return t[3]!==a||t[4]!==h?(C=p.jsx(Z,{pageID:a,user:h}),t[3]=a,t[4]=h,t[5]=C):C=t[5],C}else if(y){var b;return t[6]!==n||t[7]!==i?(b=p.jsx(J,{authType:n,shouldShowRedesignedSignup:i}),t[6]=n,t[7]=i,t[8]=b):b=t[8],b}return null}function Y(e){return e}function J(e){var t=o("react-compiler-runtime").c(8),n=e.authType,a=e.shouldShowRedesignedSignup,i=N(),l=n===o("PolarisAuthActionConstants").AUTH.fbConnectV2?2:3,u=n===o("PolarisAuthActionConstants").AUTH.fbConnectV2||a===!0?2:9,d;t[0]!==n||t[1]!==i||t[2]!==a?(d=i?p.jsx(r("PolarisBarcelonaAppSVGIcon.react"),{fill:"var(--barcelona-logo)",size:34}):n===o("PolarisAuthActionConstants").AUTH.twoFactor?p.jsx(r("IGCoreImage.react"),{alt:y,src:{light:c("222729")}}):a===!0?p.jsx(r("IGDSIgLogoFilledIcon.react"),{alt:s._(/*BTDS*/"Instagram"),size:50}):p.jsx(r("IGCoreImage.react"),{alt:s._(/*BTDS*/"Instagram"),src:{dark:c("222731"),light:c("222730")}}),t[0]=n,t[1]=i,t[2]=a,t[3]=d):d=t[3];var m;return t[4]!==l||t[5]!==u||t[6]!==d?(m=p.jsx(r("IGDSBox.react"),{marginBottom:l,marginTop:u,position:"relative",children:d}),t[4]=l,t[5]=u,t[6]=d,t[7]=m):m=t[7],m}function Z(e){var t,n,a,i,l=o("react-compiler-runtime").c(19),s=e.pageID,u=e.user,c=u.fullName,d=u.profilePictureUrl,m=u.username,_=r("nullthrows")(m),f=o("PolarisReactRedux.react").useSelector(ee),g=f.sharerInformation,h=o("PolarisSenderNameHelpers").shouldShowSenderName(s),y=g!=null&&h?o("PolarisLoggedOutUpsellStrings").seePhotosFromFullNameBodyText((t=g.fullName)!=null?t:g.username):o("PolarisLoggedOutUpsellStrings").seePhotosFromFullNameBodyText(c!=null?c:_),C=g!=null&&h?o("PolarisLoggedOutUpsellStrings").joinSharerHeaderText((n=g.fullName)!=null?n:g.username):o("PolarisLoggedOutUpsellStrings").getSeeMoreFrom(_),b=g!=null&&h&&(a=g.profilePicUrl)!=null?a:d,v;l[0]!==y||l[1]!==C||l[2]!==b?(v={body:y,header:C,sharerProfilePictureUrl:b},l[0]=y,l[1]=C,l[2]=b,l[3]=v):v=l[3];var S=v,R=S.body,L=S.header,E=S.sharerProfilePictureUrl,k,I;l[4]===Symbol.for("react.memo_cache_sentinel")?(k={className:"xqjyukv x6s0dn4 x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s x1nhvcw1 x1yztbdb"},I={className:"xqjyukv x1qjc9v5 x1c9tyrk xeusxvb x1pahc9y x1ertn4p x9f619 x78zum5 xdt5ytf x1c4vz4f x2lah0s xl56j7k x1yztbdb xg87l8a x1yhmmig xpcrz0c xyb01ml x1vpptxl x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu xmn4e3e x1if355w x2x41l1 xct1zlm x1n2onr6 xsbjyhr x19zpy19"},l[4]=k,l[5]=I):(k=l[4],I=l[5]);var T=E!=null?E:d,D=(i=g==null?void 0:g.username)!=null?i:_,x;l[6]!==T||l[7]!==D?(x=p.jsx("div",babelHelpers.extends({},I,{children:p.jsx(r("PolarisUserAvatar.react"),{isLink:!1,profilePictureUrl:T,size:96,username:D})})),l[6]=T,l[7]=D,l[8]=x):x=l[8];var $;l[9]===Symbol.for("react.memo_cache_sentinel")?($={className:"x6s0dn4 x78zum5 xdt5ytf xh8yej3 xieb3on"},l[9]=$):$=l[9];var P;l[10]!==L?(P=p.jsx("div",babelHelpers.extends({},$,{children:p.jsx(r("IGDSText.react"),{color:"primaryText",size:"title",textAlign:"center",weight:"semibold",zeroMargin:!1,children:L})})),l[10]=L,l[11]=P):P=l[11];var N;l[12]===Symbol.for("react.memo_cache_sentinel")?(N={className:"x6s0dn4 x78zum5 xdt5ytf xh8yej3 xp48ta0 xtssl2i"},l[12]=N):N=l[12];var M;l[13]!==R?(M=p.jsx("div",babelHelpers.extends({},N,{children:p.jsx(o("IGDSTextVariants.react").IGDSTextBody,{textAlign:"center",zeroMargin:!1,children:R})})),l[13]=R,l[14]=M):M=l[14];var w;return l[15]!==P||l[16]!==M||l[17]!==x?(w=p.jsxs("div",babelHelpers.extends({},k,{children:[x,P,M]})),l[15]=P,l[16]=M,l[17]=x,l[18]=w):w=l[18],w}function ee(e){return e.upsell}function te(e){var t,n=o("react-compiler-runtime").c(3),a=e.pageID,i=e.showNetzDGReportLink;if(i!==!0||!o("PolarisConfig").isLoggedOutFRXEligible())return null;var l=(t=o("InstagramQueryParamsHelper").getQueryParams(window.location.search))==null?void 0:t.next,s=l!=null?""+window.location.origin+l:a==="StoriesPage"?window.location.href:null,u;n[0]===Symbol.for("react.memo_cache_sentinel")?(u=o("PolarisUA").isMobile()&&p.jsx("div",{className:"x6s0dn4 xvbhtw8 x1pmru9 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x13fuv20 x1qgpocp x18b5jzi xa0kie1 x1q0q8m5 xxrrrr8 x1t7ytsu x141z70w x178xt8z x1lun4ml xso031l xpilrb4 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu xdj266r x14z9mp x1lziwak x889kno xyri2b x1a8lsjc x1c1uobl x11njtxf x1hq5gj4 x1n2onr6",children:p.jsx(r("IGDSDivider.react"),{})}),n[0]=u):u=n[0];var c;return n[1]!==s?(c=p.jsxs(r("IGDSBox.react"),{marginEnd:o("PolarisUA").isMobile()?1:0,marginStart:o("PolarisUA").isMobile()?1:0,paddingX:o("PolarisUA").isMobile()?12:8,paddingY:o("PolarisUA").isMobile()?8:4,position:"relative",children:[u,p.jsx(r("PolarisLoggedOutNetzDGReportLink.react"),{reportedUrlOrContentId:s,textSize:"footnote"})]}),n[1]=s,n[2]=c):c=n[2],c}function ne(){var e=o("react-compiler-runtime").c(3),t=o("CometRouteParams").useCometRefinedRouteParams(o("XPolarisLoginControllerParamsRefineValidator").refineXPolarisLoginControllerParams),n=t==null?void 0:t.logged_out_reporting_url;if(n==null)return null;var a;e[0]===Symbol.for("react.memo_cache_sentinel")?(a=o("PolarisUA").isMobile()&&p.jsx("div",{className:"x6s0dn4 xvbhtw8 x1pmru9 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x13fuv20 x1qgpocp x18b5jzi xa0kie1 x1q0q8m5 xxrrrr8 x1t7ytsu x141z70w x178xt8z x1lun4ml xso031l xpilrb4 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu xdj266r x14z9mp x1lziwak x889kno xyri2b x1a8lsjc x1c1uobl x11njtxf x1hq5gj4 x1n2onr6 xh8yej3",children:p.jsx(r("IGDSDivider.react"),{})}),e[0]=a):a=e[0];var i;return e[1]!==n?(i=p.jsxs(r("IGDSBox.react"),{marginEnd:o("PolarisUA").isMobile()?1:0,marginStart:o("PolarisUA").isMobile()?1:0,paddingX:o("PolarisUA").isMobile()?12:8,paddingY:o("PolarisUA").isMobile()?8:4,position:"relative",children:[a,p.jsx(r("IGDSText.react"),{color:"secondaryText",size:"footnote",textAlign:"center",zeroMargin:!1,children:p.jsx(r("PolarisExternalLink.react"),{href:n,children:f})})]}),e[1]=n,e[2]=i):i=e[2],i}function re(e){var t,n=o("react-compiler-runtime").c(22),a=e.authType,i=e.forceLoginIgId,l=e.fromLoggedOutDialog,s=e.hideAppUpsells,u=e.hideBorder,c=e.loggedInFBUser,d=e.pageId,m=e.pageType,_=e.style,f=o("PolarisReactRedux.react").useSelector(ae),g=f.auth,h=f.navigation,y=g.isFBLoggedIn,C=h.isAccountSwitcherOpen,b=N(),v=R(a),S=k(),L=i!=null,E=(t=S==null?void 0:S.linkedIGProfiles)!=null?t:[],I=(a===o("PolarisAuthActionConstants").AUTH.fbLogin||a===o("PolarisAuthActionConstants").AUTH.fbAccountPicker)&&y===!0&&!!S,T=function(){var e=E.length>1,t=!L&&I&&e;return!b&&o("PolarisUA").isDesktop()&&!o("PolarisQueryParams").hasForceAuthenticationParam()&&(!(a===o("PolarisAuthActionConstants").AUTH.fbLogin&&!o("PolarisOneTapLogin").isOneTapLoginEligible())||t)&&!v};if(!T()||C)return null;var D=oe,x;n[0]!==s?(x=!(s==null||s)&&!o("PolarisStrategicWebTraffic").isStrategicTraffic(),n[0]=s,n[1]=x):x=n[1];var $=x,P;n[2]!==a||n[3]!==u||n[4]!==_?(P={0:{className:"x6s0dn4 xvbhtw8 x1pmru9 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x13fuv20 x1qgpocp x18b5jzi xa0kie1 x1q0q8m5 xxrrrr8 x1t7ytsu x141z70w x178xt8z x1lun4ml xso031l xpilrb4 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu xdj266r x14z9mp x1lziwak xyorhqc xzboxd6 x889kno xyri2b x1a8lsjc x1c1uobl x1n2onr6 x11njtxf"},4:{className:"x6s0dn4 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x13fuv20 x1qgpocp x18b5jzi xa0kie1 x1q0q8m5 xxrrrr8 x1t7ytsu x141z70w x178xt8z x1lun4ml xso031l xpilrb4 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu xdj266r x14z9mp x1lziwak xyorhqc xzboxd6 x889kno xyri2b x1a8lsjc x1c1uobl x1n2onr6 x11njtxf x7r02ix"},2:{className:"x6s0dn4 xvbhtw8 x1pmru9 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu xdj266r x14z9mp x1lziwak xyorhqc xzboxd6 x889kno xyri2b x1a8lsjc x1c1uobl x1n2onr6 x11njtxf x1ejq31n x18oe1m7 x1sy0etr xstzfhl x972fbf x10w94by x1qhh985 x14e42zd"},6:{className:"x6s0dn4 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu xdj266r x14z9mp x1lziwak xyorhqc xzboxd6 x889kno xyri2b x1a8lsjc x1c1uobl x1n2onr6 x11njtxf x7r02ix x1ejq31n x18oe1m7 x1sy0etr xstzfhl x972fbf x10w94by x1qhh985 x14e42zd"},1:{className:"x6s0dn4 xvbhtw8 x1pmru9 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x13fuv20 x1qgpocp x18b5jzi xa0kie1 x1q0q8m5 xxrrrr8 x1t7ytsu x141z70w x178xt8z x1lun4ml xso031l xpilrb4 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu x1n2onr6 x11njtxf xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl"},5:{className:"x6s0dn4 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x13fuv20 x1qgpocp x18b5jzi xa0kie1 x1q0q8m5 xxrrrr8 x1t7ytsu x141z70w x178xt8z x1lun4ml xso031l xpilrb4 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu x1n2onr6 x11njtxf x7r02ix xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl"},3:{className:"x6s0dn4 xvbhtw8 x1pmru9 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu x1n2onr6 x11njtxf x1ejq31n x18oe1m7 x1sy0etr xstzfhl x972fbf x10w94by x1qhh985 x14e42zd xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl"},7:{className:"x6s0dn4 x1yvgwvq xjd31um x1ixjvfu xwt6s21 xkqq1k2 x91jh78 x1xkn691 x4oqio7 x9f619 x78zum5 xjl7jj xdt5ytf x2lah0s xln7xf2 xk390pu x1n2onr6 x11njtxf x7r02ix x1ejq31n x18oe1m7 x1sy0etr xstzfhl x972fbf x10w94by x1qhh985 x14e42zd xdj266r x14z9mp xat24cr x1lziwak xexx8yu xyri2b x18d9i69 x1c1uobl"}}[(_==="modal")<<2|(u===!0)<<1|(a===o("PolarisAuthActionConstants").AUTH.fbConnectV2&&_!=="modal")<<0],n[2]=a,n[3]=u,n[4]=_,n[5]=P):P=n[5];var M;n[6]!==a?(M={0:"x5n08af x1f6kntn xcxhlts xjx09e3 x1fqp7bg xx6jrq6 x2b8uid",1:"x1f6kntn xcxhlts xjx09e3 x1fqp7bg xx6jrq6 x2b8uid x1roi4f4"}[(a===o("PolarisAuthActionConstants").AUTH.oneTapLogin)<<0],n[6]=a,n[7]=M):M=n[7];var w=m!=null?m:void 0,A;n[8]!==l||n[9]!==c||n[10]!==M||n[11]!==w?(A=p.jsx(r("PolarisAuthTypeSwitcher.react"),{className:M,fromLoggedOutDialog:l,loggedInFBUser:c,onNavigate:D,pageType:w,primary:!0}),n[8]=l,n[9]=c,n[10]=M,n[11]=w,n[12]=A):A=n[12];var F;n[13]!==P||n[14]!==A?(F=p.jsx("div",babelHelpers.extends({},P,{children:A})),n[13]=P,n[14]=A,n[15]=F):F=n[15];var O;n[16]!==$||n[17]!==d?(O=$?p.jsx(r("PolarisAppsellUnit.react"),{appInstallCampaign:d,ctaTypeV2:"auth_form"}):null,n[16]=$,n[17]=d,n[18]=O):O=n[18];var B;return n[19]!==F||n[20]!==O?(B=p.jsxs(p.Fragment,{children:[F,O]}),n[19]=F,n[20]=O,n[21]=B):B=n[21],B}function oe(e){r("PolarisLoginQPL").isActive()&&e==="signup"&&r("PolarisLoginQPL").endCancelNavigateToSignup()}function ae(e){return e}l.default=b}),226);
__d("PolarisLiveCreationModalLazy.react",["CometPlaceholder.react","IGCoreModal.react","IGDSBox.react","IGDSSpinner.react","JSResourceForInteraction","PolarisSizing","lazyLoadComponent","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=r("lazyLoadComponent")(r("JSResourceForInteraction")("PolarisLiveCreationModal.react").__setRef("PolarisLiveCreationModalLazy.react"));function c(e){var t=o("react-compiler-runtime").c(3),n;t[0]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx(r("IGCoreModal.react"),{backdropColor:"dark",children:s.jsx(r("IGDSBox.react"),{alignItems:"center",height:112,justifyContent:"center",maxWidth:o("PolarisSizing").FEED_WIDTH_WIDE,position:"relative",width:"100%",children:s.jsx(r("IGDSSpinner.react"),{size:"medium"})})}),t[0]=n):n=t[0];var a;return t[1]!==e?(a=s.jsx(r("CometPlaceholder.react"),{fallback:n,name:i.id,children:s.jsx(u,babelHelpers.extends({},e))}),t[1]=e,t[2]=a):a=t[2],a}l.default=c}),98);
__d("PolarisMobilePostLoginUpsell.react",["fbt","ix","BaseModal.react","IGCoreImage.react","IGDSBox.react","IGDSButton.react","IGDSText.react","PolarisAppInstallStrings","qex","react","react-compiler-runtime","usePolarisOpenApp"],(function(t,n,r,o,a,i,l,s,u){"use strict";var e,c=e||(e=o("react")),d={mobilePostLogin:{bottom:"x1ey2m1c",insetInlineEnd:"xtijo5x",insetInlineStart:"x1o0tod",left:null,right:null,position:"xixxii4",top:"x13vifvy",$$css:!0}},m=s._(/*BTDS*/"\u00bfQuieres tomarte un descanso de la app?"),p=s._(/*BTDS*/"Vuelve a disfrutar de la experiencia cuando quieras con controles de notificaciones y l\u00edmites de tiempo en pantalla adaptados a tus necesidades."),_=s._(/*BTDS*/"Configura los controles de tu experiencia en la app"),f=s._(/*BTDS*/"Ajusta los l\u00edmites de tiempo en pantalla y los controles de notificaciones para que puedas mantenerte al d\u00eda sin distracciones."),g=s._(/*BTDS*/"Obt\u00e9n una mejor experiencia en la app"),h=s._(/*BTDS*/"Toma descansos con l\u00edmites de tiempo de pantalla y controles de notificaciones, solo disponibles en la app.");function y(e){var t=o("react-compiler-runtime").c(12),n=e.handleContinueBrowserClick,a=r("usePolarisOpenApp")(),i;if(t[0]===Symbol.for("react.memo_cache_sentinel")){var l,y=(l=r("qex")._("4280"))!=null?l:"A";i=function(){return y==="A"?{description:p,title:m}:y==="B"?{description:f,title:_}:y==="C"?{description:h,title:g}:void 0},t[0]=i}else i=t[0];var C=i,b;t[1]===Symbol.for("react.memo_cache_sentinel")?(b=c.jsx(r("IGCoreImage.react"),{alt:"Instagram splash glyph Icon",src:{light:u("879111")}}),t[1]=b):b=t[1];var v;if(t[2]===Symbol.for("react.memo_cache_sentinel")){var S;v=c.jsx(r("IGDSText.react"),{color:"webAlwaysBlack",size:"headline1",textAlign:"center",weight:"semibold",zeroMargin:!0,children:(S=C())==null?void 0:S.title}),t[2]=v}else v=t[2];var R;if(t[3]===Symbol.for("react.memo_cache_sentinel")){var L;R=c.jsxs(r("IGDSBox.react"),{rowGap:2,children:[v,c.jsx(r("IGDSText.react"),{color:"webAlwaysBlack",textAlign:"center",zeroMargin:!0,children:(L=C())==null?void 0:L.description})]}),t[3]=R}else R=t[3];var E;t[4]!==a?(E=c.jsx(r("IGDSButton.react"),{fullWidth:!0,label:o("PolarisAppInstallStrings").OPEN_APP,onClick:function(){return a()},size:"large"}),t[4]=a,t[5]=E):E=t[5];var k;t[6]===Symbol.for("react.memo_cache_sentinel")?(k=s._(/*BTDS*/"Continuar en el navegador"),t[6]=k):k=t[6];var I;t[7]!==n?(I=c.jsx(r("IGDSButton.react"),{display:"block",label:k,onClick:n,variant:"primary_link"}),t[7]=n,t[8]=I):I=t[8];var T;return t[9]!==E||t[10]!==I?(T=c.jsx(r("BaseModal.react"),{stackingBehavior:"above-everything",children:c.jsx(r("IGDSBox.react"),{alignItems:"center",color:"alwaysWhite",height:"100%",justifyContent:"center",width:"100%",xstyle:d.mobilePostLogin,children:c.jsxs(r("IGDSBox.react"),{alignItems:"center",rowGap:6,width:320,children:[b,R,c.jsxs(r("IGDSBox.react"),{rowGap:4,width:"100%",children:[E,I]})]})})}),t[9]=E,t[10]=I,t[11]=T):T=t[11],T}l.default=y}),226);
__d("PolarisXESwitcherUtil",["qex"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("qex")._("4847")===!0}function s(){return r("qex")._("4848")===!0}l.shouldEnableIGWebXMDSSwitcher=e,l.shouldEnableIGWebXMDSSwitcherTitle=s}),98);
__d("PolarisXESwitcherDialogQuery_instagramRelayOperation",[],(function(t,n,r,o,a,i){a.exports="24200373556213830"}),null);
__d("PolarisXESwitcherDialogQuery$Parameters",["PolarisXESwitcherDialogQuery_instagramRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e={kind:"PreloadableConcreteRequest",params:{id:n("PolarisXESwitcherDialogQuery_instagramRelayOperation"),metadata:{},name:"PolarisXESwitcherDialogQuery",operationKind:"query",text:null}};a.exports=e}),null);
__d("PolarisXESwitcherDialog.entrypoint",["JSResourceForInteraction","PolarisXESwitcherDialogQuery$Parameters"],(function(t,n,r,o,a,i,l){"use strict";var e={getPreloadProps:function(t){return{queries:{polarisXESwitcherDialogQuery:{parameters:r("PolarisXESwitcherDialogQuery$Parameters"),variables:{accounts:t.routeParams.accounts}}}}},root:r("JSResourceForInteraction")("PolarisXESwitcherDialog.react").__setRef("PolarisXESwitcherDialog.entrypoint")};l.default=e}),98);
__d("usePolarisXESwitcherDialog",["PolarisSwitchAccountsUtil","PolarisXESwitcherDialog.entrypoint","react","react-compiler-runtime","useCometEntryPointDialog"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useCallback;function u(){var e=o("react-compiler-runtime").c(9),t=o("PolarisSwitchAccountsUtil").useXESwitcherIgAccounts(),n;e[0]!==t?(n=t.map(c),e[0]=t,e[1]=n):n=e[1];var a;e[2]!==n?(a={accounts:n},e[2]=n,e[3]=a):a=e[3];var i;e[4]===Symbol.for("react.memo_cache_sentinel")?(i={},e[4]=i):i=e[4];var l;e[5]!==a?(l={routeParams:a,routeProps:i},e[5]=a,e[6]=l):l=e[6];var s=r("useCometEntryPointDialog")(r("PolarisXESwitcherDialog.entrypoint"),l),u=s[0],d;return e[7]!==u?(d=function(){return u({})},e[7]=u,e[8]=d):d=e[8],d}function c(e){return{badge_count_message:e.badgeCountMessage,profile_pic_url:e.profilePicUrl,user_id:e.userId,username:e.username}}l.default=u}),98);
__d("PolarisGlobalUIComponents.react",["CometErrorBoundary.react","CometPlaceholder.react","CometRouteURL","IGWebPreCallProvider.react","PolarisAppStoreLauncher.react","PolarisCallGatingHelpers","PolarisConfig","PolarisIsLiveProducerEnabled","PolarisIsLoggedIn","PolarisLiveCreationModalLazy.react","PolarisMobilePostLoginUpsell.react","PolarisOneTapLogin","PolarisQPConstants","PolarisReactRedux.react","PolarisSwitchAccountsModalLazy.react","PolarisToastWrapper.react","PolarisUA","PolarisXESwitcherUtil","cr:1609","cr:3106","cr:4779","cr:4839","cr:7274","cr:8738","cr:9681","polarisNavigationSelectors","qex","react","react-compiler-runtime","usePolarisXESwitcherDialog"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useState;function c(e){var t=o("react-compiler-runtime").c(36),a=e.hasMobileNavs,l=e.pageIdentifier,c=e.viewer,p=o("PolarisReactRedux.react").useSelector(o("polarisNavigationSelectors").getHideNavQueryParam),_=o("PolarisReactRedux.react").useSelector(m),f=_.isAccountSwitcherOpen,g=_.isLiveCreationModalOpen,h;t[0]===Symbol.for("react.memo_cache_sentinel")?(h=o("PolarisUA").isMobile()&&o("PolarisOneTapLogin").isCAASpiDialogEligible(),t[0]=h):h=t[0];var y=h,C;t[1]===Symbol.for("react.memo_cache_sentinel")?(C=r("qex")._("4280"),t[1]=C):C=t[1];var b=C,v=b!==null&&b!=="",S=o("CometRouteURL").useRouteURL(),R=S!=="/activate",L;if(t[2]!==S){var E=["/b/","/ad_tools/"];L=!E.some(function(e){return S.startsWith(e)})&&r("qex")._("4106")===!1,t[2]=S,t[3]=L}else L=t[3];var k=L,I=u(y&&v&&R&&k),T=I[0],D=I[1],x;t[4]!==g?(x=!o("PolarisUA").isMobile()&&g&&o("PolarisIsLiveProducerEnabled").isLiveProducerEnabled()?s.jsx(r("PolarisLiveCreationModalLazy.react"),{}):null,t[4]=g,t[5]=x):x=t[5];var $=x,P=null;if(y){if(n("cr:7274")){var N;t[6]===Symbol.for("react.memo_cache_sentinel")?(N=s.jsx(n("cr:7274"),{}),t[6]=N):N=t[6],P=N}else if(n("cr:8738")){var M;t[7]===Symbol.for("react.memo_cache_sentinel")?(M=s.jsx(n("cr:8738"),{}),t[7]=M):M=t[7],P=M}}var w;t[8]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsx("div",{children:s.jsx(r("PolarisSwitchAccountsModalLazy.react"),{})}),t[8]=w):w=t[8];var A=w,F=r("usePolarisXESwitcherDialog")(),O;t[9]!==a||t[10]!==c?(O={0:"",1:"xx7atzb"}[!!(a&&c)<<0],t[9]=a,t[10]=c,t[11]=O):O=t[11];var B;t[12]!==O?(B=s.jsx(r("PolarisToastWrapper.react"),{className:O}),t[12]=O,t[13]=B):B=t[13];var W;t[14]===Symbol.for("react.memo_cache_sentinel")?(W=n("cr:9681")!=null&&s.jsx(n("cr:9681"),{slot:o("PolarisQPConstants").SLOTS.app_start}),t[14]=W):W=t[14];var q;t[15]!==T?(q=T?s.jsx(r("PolarisMobilePostLoginUpsell.react"),{handleContinueBrowserClick:function(){return D(!1)}}):P,t[15]=T,t[16]=q):q=t[16];var U;t[17]!==q?(U=s.jsx(r("CometErrorBoundary.react"),{fallback:d,type:"warn",children:q}),t[17]=q,t[18]=U):U=t[18];var V;t[19]!==f||t[20]!==F?(V=f&&o("PolarisIsLoggedIn").isLoggedIn()&&(o("PolarisXESwitcherUtil").shouldEnableIGWebXMDSSwitcher()?F():A),t[19]=f,t[20]=F,t[21]=V):V=t[21];var H;t[22]===Symbol.for("react.memo_cache_sentinel")?(H=s.jsx(r("CometErrorBoundary.react"),{type:"warn",children:n("cr:4779")!=null&&o("PolarisCallGatingHelpers").isIncomingCallEnabled()?s.jsx(r("IGWebPreCallProvider.react"),{children:s.jsx(n("cr:4779"),{})}):null}),t[22]=H):H=t[22];var G;t[23]===Symbol.for("react.memo_cache_sentinel")?(G=n("cr:3106")&&s.jsx(n("cr:3106"),{}),t[23]=G):G=t[23];var z;t[24]!==p||t[25]!==l||t[26]!==c?(z=!v&&o("PolarisConfig").probablyHasApp()&&!p&&n("cr:1609")&&s.jsx("div",{children:s.jsx(n("cr:1609"),{pageID:l,viewer:c})}),t[24]=p,t[25]=l,t[26]=c,t[27]=z):z=t[27];var j,K;t[28]===Symbol.for("react.memo_cache_sentinel")?(j=s.jsx(r("PolarisAppStoreLauncher.react"),{}),K=n("cr:4839")!=null?s.jsx(r("CometPlaceholder.react"),{fallback:null,name:i.id,children:s.jsx(n("cr:4839"),{})}):null,t[28]=j,t[29]=K):(j=t[28],K=t[29]);var Q;return t[30]!==$||t[31]!==U||t[32]!==V||t[33]!==z||t[34]!==B?(Q=s.jsxs(s.Fragment,{children:[B,W,U,V,H,$,G,z,j,K]}),t[30]=$,t[31]=U,t[32]=V,t[33]=z,t[34]=B,t[35]=Q):Q=t[35],Q}function d(){return s.jsx("div",{})}d.displayName=d.name+" [from "+i.id+"]";function m(e){return e.navigation}l.default=c}),98);
__d("PolarisNotificationBannerIcon.react",["fbt","$InternalEnum","IGDSBox.react","IGDSText.react","Locale","PolarisAssetManagerGlyphMapping","PolarisIGCoreIcon.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=n("$InternalEnum")({COMMENTS:"comments",LIKES:"likes",RELATIONSHIPS:"relationships",USERTAGS:"usertags"});function d(e){switch(e){case c.COMMENTS:return{alt:s._(/*BTDS*/"Comentarios"),icon:o("PolarisAssetManagerGlyphMapping").ICONS.COMMENT_FILLED_16_WHITE};case c.LIKES:return{alt:s._(/*BTDS*/"Me gusta"),icon:o("PolarisAssetManagerGlyphMapping").ICONS.HEART_FILLED_16_WHITE};case c.RELATIONSHIPS:return{alt:s._(/*BTDS*/"Relaciones"),icon:o("PolarisAssetManagerGlyphMapping").ICONS.USER_FILLED_16_WHITE};case c.USERTAGS:return{alt:s._(/*BTDS*/"Etiquetas del usuario"),icon:o("PolarisAssetManagerGlyphMapping").ICONS.TAG_UP_FILLED_16_WHITE}}}function m(e){var t=o("react-compiler-runtime").c(11),n=e.count,a=e.countType,i;t[0]!==a?(i=d(a),t[0]=a,t[1]=i):i=t[1];var l=i,s=l.alt,c=l.icon,m;t[2]===Symbol.for("react.memo_cache_sentinel")?(m={className:"x6s0dn4 x78zum5 x1diwwjn x1n2onr6"},t[2]=m):m=t[2];var p;t[3]!==s||t[4]!==c?(p=u.jsx(r("PolarisIGCoreIcon.react"),{alt:s,icon:c}),t[3]=s,t[4]=c,t[5]=p):p=t[5];var _;t[6]!==n?(_=u.jsx(r("IGDSBox.react"),{alignItems:"center",marginStart:1,position:"relative",children:u.jsx(r("IGDSText.react"),{color:"webAlwaysWhite",size:"label",zeroMargin:!0,children:n})}),t[6]=n,t[7]=_):_=t[7];var f;return t[8]!==p||t[9]!==_?(f=u.jsxs("div",babelHelpers.extends({},m,{dir:o("Locale").isRTL()?"rtl":"ltr",children:[p,_]})),t[8]=p,t[9]=_,t[10]=f):f=t[10],f}l.CountBadgeType=c,l.PolarisNotificationBannerIcon=m}),226);
__d("PolarisNotificationsBannerV2_badgeCount.graphql",[],(function(t,n,r,o,a,i){"use strict";var e={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"PolarisNotificationsBannerV2_badgeCount",selections:[{alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null},{alias:null,args:null,concreteType:"XDTNotificationActivityBadgeCounts",kind:"LinkedField",name:"activity_badge_counts",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"comments",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"likes",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"relationships",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usertags",storageKey:null}],storageKey:null}],type:"XDTNotificationBadgeCount",abstractKey:null};a.exports=e}),null);
__d("PolarisNotificationsBannerV2.react",["CometRelay","PolarisDisappearingTooltip.react","PolarisNotificationBannerIcon.react","PolarisNotificationsBannerV2_badgeCount.graphql","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=s||(s=o("react")),c=s.useMemo;function d(t){var a,i=o("react-compiler-runtime").c(23),l=t.align,s=t.autoHideAfter,c=t.badgeCount,d=t.children,m=t.onClick,p=t.onTooltipHide,_=t.position,f=o("CometRelay").useFragment(e!==void 0?e:e=n("PolarisNotificationsBannerV2_badgeCount.graphql"),c),g=f==null?void 0:f.activity_badge_counts,h=(a=f==null?void 0:f.total_count)!=null?a:0,y;e:{var C,b=(C=Object.keys(g).reduce(function(e,t){var n;return e+((n=g[t])!=null?n:0)},0))!=null?C:0;if(b===0){y=null;break e}var v;i[0]===Symbol.for("react.memo_cache_sentinel")?(v={className:"xuk3077 x972fbf x10w94by x1qhh985 x14e42zd x9f619 x78zum5 x1q0g3np x2lah0s xln7xf2 xk390pu xdj266r x14z9mp xat24cr x18xomjl xexx8yu xyri2b x18d9i69 x1c1uobl x1n2onr6 x11njtxf"},i[0]=v):v=i[0];var S;i[1]!==g?(S=(g==null?void 0:g.comments)!=null&&g.comments!==0&&u.jsx(o("PolarisNotificationBannerIcon.react").PolarisNotificationBannerIcon,{count:g.comments,countType:o("PolarisNotificationBannerIcon.react").CountBadgeType.COMMENTS}),i[1]=g,i[2]=S):S=i[2];var R;i[3]!==g?(R=(g==null?void 0:g.likes)!=null&&g.likes!==0&&u.jsx(o("PolarisNotificationBannerIcon.react").PolarisNotificationBannerIcon,{count:g.likes,countType:o("PolarisNotificationBannerIcon.react").CountBadgeType.LIKES}),i[3]=g,i[4]=R):R=i[4];var L;i[5]!==g?(L=(g==null?void 0:g.relationships)!=null&&g.relationships!==0&&u.jsx(o("PolarisNotificationBannerIcon.react").PolarisNotificationBannerIcon,{count:g.relationships,countType:o("PolarisNotificationBannerIcon.react").CountBadgeType.RELATIONSHIPS}),i[5]=g,i[6]=L):L=i[6];var E;i[7]!==g?(E=(g==null?void 0:g.usertags)!=null&&g.usertags!==0&&u.jsx(o("PolarisNotificationBannerIcon.react").PolarisNotificationBannerIcon,{count:g.usertags,countType:o("PolarisNotificationBannerIcon.react").CountBadgeType.USERTAGS}),i[7]=g,i[8]=E):E=i[8];var k;i[9]!==S||i[10]!==R||i[11]!==L||i[12]!==E?(k=u.jsxs("div",babelHelpers.extends({},v,{children:[S,R,L,E]})),i[9]=S,i[10]=R,i[11]=L,i[12]=E,i[13]=k):k=i[13],y=k}var I=y,T;return i[14]!==l||i[15]!==s||i[16]!==d||i[17]!==I||i[18]!==m||i[19]!==p||i[20]!==_||i[21]!==h?(T=h>0&&I!=null?u.jsx(r("PolarisDisappearingTooltip.react"),{align:l,autoHideAfter:s,color:"red",disableTooltipHideOnDismount:!1,isActivity:!0,onClick:m,onTooltipHide:p,position:_,tooltip:I,children:d}):u.jsx(u.Fragment,{children:d}),i[14]=l,i[15]=s,i[16]=d,i[17]=I,i[18]=m,i[19]=p,i[20]=_,i[21]=h,i[22]=T):T=i[22],T}l.default=d}),98);
__d("usePolarisNotificationsNavItemQuery.graphql",["relay-runtime"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"device_id"}],t=[{kind:"Variable",name:"device_id",variableName:"device_id"}],n={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"usePolarisNotificationsNavItemQuery",selections:[{alias:null,args:t,concreteType:"XDTNotificationBadgeResponse",kind:"LinkedField",name:"xdt_notification_badge",plural:!1,selections:[{alias:null,args:null,concreteType:"XDTNotificationBadgeCount",kind:"LinkedField",name:"badge_count",plural:!1,selections:[n,{args:null,kind:"FragmentSpread",name:"PolarisNotificationsBannerV2_badgeCount"}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"usePolarisNotificationsNavItemQuery",selections:[{alias:null,args:t,concreteType:"XDTNotificationBadgeResponse",kind:"LinkedField",name:"xdt_notification_badge",plural:!1,selections:[{alias:null,args:null,concreteType:"XDTNotificationBadgeCount",kind:"LinkedField",name:"badge_count",plural:!1,selections:[n,{alias:null,args:null,concreteType:"XDTNotificationActivityBadgeCounts",kind:"LinkedField",name:"activity_badge_counts",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"comments",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"likes",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"relationships",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usertags",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:"29759241103722430",metadata:{is_distillery:!0,root_field_name:["xdt_notification_badge"]},name:"usePolarisNotificationsNavItemQuery",operationKind:"query",text:null}}})();n("relay-runtime").PreloadableQueryRegistry.set(e.params.id,e),a.exports=e}),null);
__d("usePolarisNotificationsNavItemQuery",["CometRelay","PolarisConfig","usePolarisNotificationsNavItemQuery.graphql"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){var t=o("CometRelay").useLazyLoadQuery(e!==void 0?e:e=n("usePolarisNotificationsNavItemQuery.graphql"),{device_id:o("PolarisConfig").getDeviceId()});return t}var u=s;l.default=u}),98);
__d("PolarisNotificationsNavBadge.react",["PolarisActivityStorySelectors","PolarisNotificationsNavItemBadge.react","PolarisReactRedux.react","cr:10762","cr:10763","react","react-compiler-runtime","usePolarisNotificationsNavItemQuery"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useEffect;function c(e){var t,a,i=o("react-compiler-runtime").c(10),l=e.onBadgeStateChange,c=r("usePolarisNotificationsNavItemQuery")(),d=c==null||(t=c.xdt_notification_badge)==null?void 0:t.badge_count,m=(a=d==null?void 0:d.total_count)!=null?a:0,p=n("cr:10763")(),_=o("PolarisReactRedux.react").useSelector(o("PolarisActivityStorySelectors").showBanner),f=m+p>0,g,h;i[0]!==f||i[1]!==l||i[2]!==_?(g=function(){return l(f||_)},h=[l,f,_],i[0]=f,i[1]=l,i[2]=_,i[3]=g,i[4]=h):(g=i[3],h=i[4]),u(g,h);var y;i[5]!==f?(y=f?s.jsx(r("PolarisNotificationsNavItemBadge.react"),{}):null,i[5]=f,i[6]=y):y=i[6];var C;i[7]===Symbol.for("react.memo_cache_sentinel")?(C=n("cr:10762")&&s.jsx(n("cr:10762"),{}),i[7]=C):C=i[7];var b;return i[8]!==y?(b=s.jsxs(s.Fragment,{children:[y,C]}),i[8]=y,i[9]=b):b=i[9],b}l.default=c}),98);
__d("PolarisNotificationsNavBannerWrapper.react",["PolarisIGCoreConstants","PolarisNavigationHelpers","PolarisNotificationsBannerV2.react","react","react-compiler-runtime","useMatchMedia","usePolarisNotificationsNavItemQuery"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){var t,n=o("react-compiler-runtime").c(6),a=e.children,i=e.onClick,l=e.onTooltipHide,u=r("usePolarisNotificationsNavItemQuery")(),c=u==null||(t=u.xdt_notification_badge)==null?void 0:t.badge_count,d=r("useMatchMedia")("(max-width: "+o("PolarisNavigationHelpers").BOTTOM_STYLING_MAX_WIDTH+"px)"),m;return n[0]!==c||n[1]!==a||n[2]!==d||n[3]!==i||n[4]!==l?(m=c==null?null:s.jsx(r("PolarisNotificationsBannerV2.react"),{align:d?"end":"middle",autoHideAfter:r("PolarisIGCoreConstants").TOOLTIP.AUTO_HIDE_MS,badgeCount:c,onClick:i,onTooltipHide:l,position:d?"below":"end",children:a}),n[0]=c,n[1]=a,n[2]=d,n[3]=i,n[4]=l,n[5]=m):m=n[5],m}l.default=u}),98);/*FB_PKG_DELIM*/
__d("LatencySensitiveType",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum")({NORMAL:0,LOW:1,ULTRA_LOW:2}),l=e;i.default=l}),66);
__d("MaybeNativePromise",["Promise"],(function(t,n,r,o,a,i){"use strict";var e,l=t.Promise||e||(e=n("Promise"));(e||(e=n("Promise"))).resolve();var s=l;i.default=s}),66);
__d("OzActiveActiveFailoverNetworkRequestStreamHandler",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){this.$1=e}var t=e.prototype;return t.onResponse=function(t,n){var e=t.headers;return e&&e.has("x-fb-video-replica")&&this.$1(t,n),null},t.onError=function(t,n){return null},e})();i.default=e}),66);
__d("OzBufferVTTCaptionsVisibleStrategy",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){this.$1=e}var t=e.prototype;return t.isActive=function(){return!this.$1()},t.getBufferTarget=function(){return 0},e})();i.default=e}),66);
__d("OzCDNSignedQueryParams",["ConstUriUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){this.$1={}}var t=e.prototype;return t.$2=function(t,n,r){this.$1[t]==null&&(this.$1[t]={}),this.$1[t][n]=r},t.get=function(t){var e=this.$1[t];return e==null?null:e},t.update=function(t){var e=o("ConstUriUtils").getUri(t);if(e!=null){var n=e.getQueryParams(),r=e.getDomain()+e.getPath(),a=n.get("oe");a!=null&&this.$2(r,"oe",String(n.get("oe"))),n.get("oh")!=null&&this.$2(r,"oh",String(n.get("oh")))}},e})();l.default=e}),98);
__d("OzCustomParsers",[],(function(t,n,r,o,a,i){function e(){return new Map([["fbProjection",function(e){try{return e.Period[0].AdaptationSet[0].$.FBProjection||null}catch(e){return null}}],["hasInbandCaptionsFromAccessibility",function(e){var t=e.Period[0],n=t&&t.AdaptationSet[0].Accessibility;return n&&n[0]?n[0].$.schemeIdUri==="urn:scte:dash:cc:cea-608:2015":!1}],["hasInbandCaptionsFromUsingASRCaptions",function(e){var t=Number.parseInt(e.$.usingASRCaptions,0);return!isNaN(t)&&t!=0}],["hasInbandCaptionsFromIsUsingAsrCaptionsEmployeeDogfooding",function(e){var t=Number.parseInt(e.$.isUsingAsrCaptionsEmployeeDogfooding,0);return!isNaN(t)&&t!=0}],["hasVTTRepresentationCaptions",function(e){return e.Period[0].AdaptationSet.find(function(e){var t;return((t=e.$.mimeType)==null?void 0:t.startsWith("application"))&&e.$.lang!=null})!=null}],["isLiveTemplated",function(e){return e.$.FBIsLiveTemplated==="true"}],["isFBMS",function(e){return e.$.FBMS==="true"}],["isFBWasLive",function(e){return e.$.FBWasLive==="true"}],["loapStreamType",function(e){return e.$.loapStreamType?parseInt(e.$.loapStreamType,10):0}],["fbManifestIdentifier",function(e){var t;return(t=e.$.FBManifestIdentifier)!=null?t:""}],["lastVideoFrameTs",function(e){return e.$.lastVideoFrameTs?Number.parseInt(e.$.lastVideoFrameTs,10):null}],["currentServerTimeMs",function(e){return e.$.currentServerTimeMs?Number.parseInt(e.$.currentServerTimeMs,10):null}],["validationErrors",function(e){var t;return(t=e.$.validationErrors)!=null?t:""}]])}i.createOzCustomParser=e}),66);
__d("oz-player/manifests/OzSegmentOptions",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(){this.$1=!1,this.$2=null}var t=e.prototype;return t.setSegmentNumDecisionTime=function(t){this.$2=t},t.getSegmentNumDecisionTime=function(){return this.$2},t.setIsDVLEnabled=function(t){this.$1=t},t.isDVLEnabled=function(){return this.$1},e})();i.default=e}),66);
__d("oz-player/shims/www/OzURIWWWImplConstUri",["ConstUriUtils","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.getQueryParams(),n={};return t.forEach(function(e,t){typeof e=="string"||typeof e=="number"?n[t]=e:n[t]=String(e)}),n}var s=(function(){function t(t){if(this.$1=o("ConstUriUtils").getUri(t),this.$1==null)throw r("err")("Invalid URI passed to OzURI");this.$2=e(this.$1)}var n=t.prototype;return n.addQueryData=function(n,r){var t=this.$1;if(typeof n=="string"){var o;t=(o=t)==null?void 0:o.addQueryParam(n,r===void 0?"":r)}else{var a,i=new Map;Object.keys(n).forEach(function(e){i.set(e,n[e])}),t=(a=t)==null?void 0:a.addQueryParams(i)}t!=null&&(this.$1=t,this.$2=e(this.$1))},n.getQueryData=function(){return this.$2},n.getDomain=function(){var e,t;return(e=(t=this.$1)==null?void 0:t.getDomain())!=null?e:""},n.toString=function(){var e,t;return(e=(t=this.$1)==null?void 0:t.toString())!=null?e:""},n.getPath=function(){var e,t;return(e=(t=this.$1)==null?void 0:t.getPath())!=null?e:""},t})();l.default=s}),98);
__d("oz-player/shims/www/OzURIWWW",["oz-player/shims/www/OzURIWWWImplConstUri"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/OzURIWWWImplConstUri")}),98);
__d("oz-player/shims/OzURI",["oz-player/shims/www/OzURIWWW"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/OzURIWWW")}),98);
__d("oz-player/utils/ozConcatUint8Arrays",["oz-player/utils/OzErrorUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){for(var t=0,n=0;n<e.length;++n)t+=e[n].byteLength;var r,a;try{r=new ArrayBuffer(t),a=new Uint8Array(r)}catch(e){throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_ALLOCATION_FAILURE",description:e.name+": "+e.message})}for(var i=0,l=0;l<e.length;++l){var s=e[l];a.set(s,i),i+=s.byteLength}return{buffer:r,view:a}}l.default=e}),98);
__d("oz-player/utils/OzReadableStreamUtils",["oz-player/utils/ozConcatUint8Arrays"],(function(t,n,r,o,a,i,l){"use strict";var e=typeof TextDecoder!="undefined"?function(e){return new TextDecoder("utf-8").decode(new Uint8Array(e))}:function(e){return String.fromCharCode.apply(null,e)};function s(e){var t=[],n=function(){return e.read().then(function(e){var r=e.done,o=e.value;return r||!o?null:(t.push(o),n())})};return n().then(function(){var e=r("oz-player/utils/ozConcatUint8Arrays")(t),n=e.view;return n})}function u(t){return s(t).then(function(t){return e(t)})}function c(e){var t=new Uint8Array(e.length);return t.map(function(t,n){return e.charCodeAt(n)})}l.pumpAllData=s,l.pumpString=u,l.stringToUint8Array=c}),98);
__d("OzCustomRepresentationParsers",["oz-player/manifests/OzSegmentOptions","oz-player/shims/OzURI","oz-player/utils/OzReadableStreamUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=e.ozConfig,n=e.startTimestamp,a={timescale:function(t){var e=t.SegmentTemplate;if(e&&e.length>0){var n=e[0].$;if(n)return Number.parseInt(n.timescale,0)||null}return null}};return t.getBool("parse_initialization_binary",!1)&&(a.initializationBinary=function(e){try{var t=window.atob(e.FBInitializationBinary[0]._);return o("oz-player/utils/OzReadableStreamUtils").stringToUint8Array(t)}catch(e){return null}}),a.playbackResolutionMos=function(e){try{return e.$.FBPlaybackResolutionMos}catch(e){return null}},a.playbackResolutionCsvqm=function(e){try{return e.$.FBPlaybackResolutionCsvqm}catch(e){return null}},a.qualityLabel=function(e){try{return e.$.FBQualityLabel}catch(e){return null}},t.getBool("parse_first_segment",!1)&&(a.firstSegmentParser=function(e){if(n!=null&&n>0)return null;try{var t=e.SegmentBase[0].$.FBFirstSegmentRange.split("-").map(Number),o={startByte:t[0],endByte:t[1]},a=e.BaseURL[0]._,i=new(r("oz-player/shims/OzURI"))(a),l=new(r("oz-player/manifests/OzSegmentOptions"));return{getData:function(){return null},getURI:function(){return i},getByteRange:function(){return o},getTimeRange:function(){return{startTime:0,endTime:2}},getSequenceNumber:function(){return null},getOptions:function(){return l}}}catch(e){return null}}),a}l.createOzCustomRepresentationParsers=e}),98);
__d("OzDOMEventListenerImpl",["CometEventListener"],(function(t,n,r,o,a,i,l){"use strict";var e={listenDOMEvent:r("CometEventListener").listen,captureDOMEvent:r("CometEventListener").capture,suppressDOMEvent:r("CometEventListener").suppress},s=e;l.default=s}),98);
__d("OzMinimumSmallestDimensionRestriction",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){this.$1=e}var t=e.prototype;return t.applyRestriction=function(t){var e=this;if(t.length===0)return[];var n=t.filter(function(t){var n=t.getWidth(),r=t.getHeight(),o=n<r?n:r;return o>=e.$1});return n.length>0?n:[t[t.length-1]]},e})();i.default=e}),66);
__d("OzMosThresholdRestriction",["MosUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$3=new Map,this.$4=e,this.$1=e.getNumber("mos_upper_threshold",0),this.$2=e.getNumber("mos_lower_threshold",0)}var t=e.prototype;return t.$5=function(){return this.$4.getBool("cache_mos_threshold",!1)?{mosUpperThreshold:this.$1,mosLowerThreshold:this.$2}:{mosUpperThreshold:this.$4.getNumber("mos_upper_threshold",0),mosLowerThreshold:this.$4.getNumber("mos_lower_threshold",0)}},t.$6=function(t,n){var e=null;if(this.$3.get(t))e=this.$3.get(t);else{var r=t.getCustomField("playbackResolutionMos");r!=null&&(e=o("MosUtils").parsePlaybackMos(String(r)),e&&this.$3.set(t,e))}return e!=null?o("MosUtils").getMosValue(e,o("MosUtils").getQualityLabel(n.width,n.height)):null},t.$7=function(t,n){var e=this,r=null,o=this.$5(),a=o.mosUpperThreshold;return t.forEach(function(t){var o=e.$6(t,n);o!=null&&o>a&&(r==null||r>o)&&(r=o)}),r==null?t.slice():t.filter(function(t){var o=e.$6(t,n);return o==null?!0:o<=a||o===r})},t.$8=function(t,n){var e=this,r=[],o=this.$5(),a=o.mosLowerThreshold;return t.forEach(function(t){var o=e.$6(t,n);o!=null&&o>a&&r.push(t)}),r.length===0&&r.push(t[t.length-1]),r},t.applyRestriction=function(t,n){if(t.length===0)return[];var e=this.$5(),r=e.mosLowerThreshold,o=e.mosUpperThreshold,a=void 0;return o>0&&(a=this.$7(a!=null?a:t,n)),r>0&&(a=this.$8(a!=null?a:t,n)),a!=null?a:t.slice()},e})();l.default=e}),98);
__d("OzOneSemanticHandlerUtils",["ConstUriUtils","FBLogger","qex"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){t!=null&&t.indexOf("+RE")>=0&&e.retry(),n!=null&&n()}function s(t,n){var o=n.error,a=o.getExtra(),i=a.code,l=a.headers,s=null;if(i==null&&r("FBLogger")("comet_video_player").mustfix("A ONE Semantic error response must have an error code."),l==null&&r("FBLogger")("comet_video_player").mustfix("A ONE Semantic error response must contain response Headers."),l!=null){var u=l.get("x-fb-one-variant");s=u!=null?u:null}var c=JSON.parse(t.getString("network_retry_intervals_json","{}")),d=c[i];switch(i){case"410":n.endStream();break;case"404":e(n,s,function(){n.retry({behavior:"recover_failed_request"})});break;case"429":n.retry(d);break;case"403":default:}}function u(e){if(e!=null){var t=parseInt(e,10);return!isNaN(t)&&t>0&&t<=3}return!1}function c(e,t){if(e!=null&&t!=null){var n=parseInt(e,10),r=parseInt(t,10);return!isNaN(n)&&!isNaN(r)&&n>0&&n<=r}return!1}function d(e){if(e!=null){var t=o("ConstUriUtils").getUri(e);if(t){var n=t.getQueryParam("os_param");return n?String(n).toString():null}}return null}function m(e,t){var n=e!=null;return u(t)||(n||!!r("qex")._("1636"))&&c(t,e)}function p(e){var t=e.getExtra(),n=t.headers,o=_(n),a=e.getExtra(),i=a.code,l=a.url;if(o!=null&&i==null)return r("FBLogger")("comet_video_player").mustfix("A ONE Semantic error response must have an error code."),!1;var s=d(l);return m(s,o)}function _(e){if(e){var t=e.get("x-fb-one");if(t!=null)return parseInt(t,10)>0?t:null}return null}function f(e,t,n){var r=null,o=null;t!=null&&(r=d(t),r!=null&&e.setOneReqWave(parseInt(r,10)));var a=n==null?void 0:n.headers;a&&(o=_(a),o!=null&&e.setOneResWave(parseInt(o,10))),e.setOneObserved(m(r,o))}l.maybeRetryForVariant=e,l.evaluateOneSemanticsResponse=s,l.isOneSemanticsForcedForResponseWave=u,l.isOneSemanticsEnabledForWave=c,l.getOneSemanticRequestWave=d,l.shouldRespondWithOneSemantics=p,l.getOneSemanticResponseWave=_,l.setOneSemanticFetchStreamLoggingAttributes=f}),98);
__d("handleOzManifestFetchErrorEvent",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){var n=e.getNumber("initial_manifest_request_retry_count",0),r=JSON.parse(e.getString("network_retry_intervals_json","{}")),o=e.getNumber("live_max_try_attempts_on_404",1),a=["404","503"];e.getBool("live_gracefully_handle_no_network",!1)&&a.push("0"),e.getBool("live_gracefully_handle_410",!1)&&a.push("410"),e.getBool("live_gracefully_handle_502",!1)&&a.push("502"),e.getBool("live_gracefully_handle_429",!1)&&a.push("429"),e.getBool("live_gracefully_handle_504",!1)&&a.push("504"),e.getBool("normalize_mpd_fetch_errors",!1)&&a.push("20");var i=t.error.getExtra().code;if(!(e.getBool("no_retry_on_empty_string_error_code",!1)&&i==="")){e.getBool("handle_mpd_null_error_codes",!1)&&(i=i!=null?i:null);var l=r[i];if(t.isInitialRequest)typeof l=="number"&&l>0&&t.retryAttemptCount<n&&t.retry({waitMs:l});else if(i!=null&&a.indexOf(i)>-1)switch(i){case"410":t.endStream();break;case"404":o<t.consecutiveFailuresForErrorCode&&t.retry();break;case"504":case"502":case"503":case"20":case"0":t.retry();break;case"429":typeof l=="number"&&l>0&&t.retry({waitMs:l});break;default:break}else i===null&&e.getBool("handle_mpd_null_error_codes",!1)&&t.retry()}}i.default=e}),66);
__d("handleOzStreamErrorEvent",[],(function(t,n,r,o,a,i){"use strict";var e=[0,1,1,2,3,5,8,13,21,34];function l(t,n){var r=n.error.getExtra().code;if(!(t.getBool("no_retry_on_empty_string_error_code",!1)&&r==="")){if(t.getBool("retry_null_error_code_in_stream",!1)&&r==null){n.retry();return}var o=JSON.parse(t.getString("network_end_broadcasts_json","[]"));if(r!=null&&o.includes(r)){n.endStream();return}var a=JSON.parse(t.getString("network_skip_json","[]"));if(r!=null&&a.includes(r)){n.retry();return}var i=t.getBool("back_off_pdash_504_retry",!0)?e[n.retryAttemptCount]:0,l=JSON.parse(t.getString("network_reload_mpd_json","[]")),s=t.getBool("fix_reload_manifest_retry",!1);if(!(t.getBool("back_off_pdash_504_retry",!0)&&i==null&&(!s||r!=null&&l.includes(r)))){if(i!=null&&r!=null&&l.includes(r)){t.getBool("network_reload_mpd_json_retry",!1)?n.retry({behavior:"recover_failed_request",waitMs:i*1e3}):n.retry({waitMs:i*1e3});return}var u=JSON.parse(t.getString("network_retry_intervals_json",'{"0": 1000, "404": 2000, "502": 1000, "503": 1000, "504": 1000}')),c=r!=null?u[r]:null;if(c!=null){t.getBool("network_retry_intervals_json_retry",!1)?n.retry({behavior:"retry_failed_request",waitMs:c}):n.retry({waitMs:c});return}}}}i.default=l}),66);
__d("OzOneSemanticHandler",["OzOneSemanticHandlerUtils","handleOzManifestFetchErrorEvent","handleOzStreamErrorEvent"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=t.error;o("OzOneSemanticHandlerUtils").shouldRespondWithOneSemantics(n)?o("OzOneSemanticHandlerUtils").evaluateOneSemanticsResponse(e,t):r("handleOzManifestFetchErrorEvent")(e,t)}function s(e,t){var n=t.error;o("OzOneSemanticHandlerUtils").shouldRespondWithOneSemantics(n)?o("OzOneSemanticHandlerUtils").evaluateOneSemanticsResponse(e,t):r("handleOzStreamErrorEvent")(e,t)}l.handleManifestFetchErrorEvent=e,l.handleStreamErrorEvent=s}),98);
__d("oz-player/shims/www/ozvariantWWW",["invariant"],(function(t,n,r,o,a,i,l,s){var e=s;l.default=e}),98);
__d("oz-player/shims/ozvariant",["oz-player/shims/www/ozvariantWWW"],(function(t,n,r,o,a,i,l){l.default=r("oz-player/shims/www/ozvariantWWW")}),98);
__d("oz-player/utils/OzNumericalHelper",[],(function(t,n,r,o,a,i){"use strict";var e=1e-5;function l(t,n,r){return r===void 0&&(r=e),Math.abs(n-t)<=r}function s(t,n,r){return r===void 0&&(r=e),t>n&&!l(t,n,r)}function u(t,n,r){return r===void 0&&(r=e),t<n&&!l(t,n,r)}function c(t,n,r){return r===void 0&&(r=e),u(t,n,r)||l(t,n,r)}function d(t,n,r){return r===void 0&&(r=e),s(t,n,r)||l(t,n,r)}i.equalTo=l,i.greaterThan=s,i.lessThan=u,i.lessThanOrEqual=c,i.greaterThanOrEqual=d}),66);
__d("oz-player/utils/OzNumericalRangeUtil",["oz-player/utils/OzNumericalHelper"],(function(t,n,r,o,a,i,l){"use strict";var e=.01;function s(t,n){var r=n.rangeEnd;return r==null?!1:Math.abs(t.rangeStart-r)>e&&t.rangeStart>r}function u(t,n){var r=t.rangeEnd,o=n.rangeEnd;return r==null?!0:o==null?!1:Math.abs(r-o)>e&&r>o}function c(t,n,r,o){var a=r.rangeEnd;return a==null?!1:n===a||Math.abs(n-a)>(o!=null?o:e)&&n>a}function d(t,n,r){var o=n.rangeEnd;if(o==null)return!1;var a=r!=null?r:e;return t-n.rangeStart>=a&&o-t>=a}function m(t,n){return t>n-e}function p(e){if(!e.length)return[];var t=[],n=e[0];t.push(n);for(var r=1;r<e.length;r++){var o=e[r];if(u(o,n))s(o,n)?(n={rangeStart:o.rangeStart,rangeEnd:o.rangeEnd},t.push(n)):n.rangeEnd=o.rangeEnd;else continue}return t}function _(e,t,n){return t.reduceRight(function(t,r){if(c(e,r.rangeStart,n)||c(e,n.rangeStart,r))t.push(r);else{var o=n.rangeEnd;o!=null&&(r.rangeEnd==null||c(e,r.rangeEnd,n))&&t.push({rangeStart:o,rangeEnd:r.rangeEnd}),m(n.rangeStart,r.rangeStart)&&t.push({rangeStart:r.rangeStart,rangeEnd:n.rangeStart})}return t},[]).filter(function(e){return e.rangeEnd==null||e.rangeStart<e.rangeEnd}).reverse()}function f(t,n,r,o){o===void 0&&(o=e);for(var a=0;a<r.length;a++){var i=r[a],l=i.rangeStart;if(m(n,l)&&!c(t,n,i,o))return a}return-1}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n],o=r.rangeStart;if(!m(e,o))return n}return-1}function h(e,t,n){return e>=t?0:n.reduceRight(function(n,r){var o=r.rangeEnd,a=r.rangeStart;return t<a||o!=null&&e>o?n:o==null||t<=o?Math.min(t-a,t-e)+n:e>=a?Math.min(o-e,t-e)+n:o-a+n},0)}function y(e,t){for(var n,r=e.length===0&&(n=t[t.length-1])!=null?n:null,a=0;a<e.length;a++){for(var i=e[a],l=a;l<t.length;l++){var s=t[l];if(o("oz-player/utils/OzNumericalHelper").equalTo(i.rangeStart,s.rangeStart)&&i.rangeEnd!=null&&s.rangeEnd!=null&&o("oz-player/utils/OzNumericalHelper").equalTo(i.rangeEnd,s.rangeEnd))break;if(s.rangeEnd!=null&&i.rangeEnd!=null&&!o("oz-player/utils/OzNumericalHelper").equalTo(i.rangeStart,s.rangeStart)){r={rangeStart:s.rangeStart,rangeEnd:s.rangeEnd};break}else if(s.rangeEnd!=null&&i.rangeEnd!=null&&o("oz-player/utils/OzNumericalHelper").equalTo(i.rangeStart,s.rangeStart)&&!o("oz-player/utils/OzNumericalHelper").equalTo(i.rangeEnd,s.rangeEnd)){r={rangeStart:i.rangeEnd,rangeEnd:s.rangeEnd};break}}if(r!==null)break}return r}function C(e){for(var t=[],n=0;n<e.length;n++)t.push({rangeStart:e[n].startTime,rangeEnd:e[n].endTime});return t}l.isAfter=c,l.isWithin=d,l.isLargerThan=m,l.mergeSortedRanges=p,l.diffSortedRanges=_,l.findCurrentRangeIndex=f,l.findNextRangeIndex=g,l.findDiffCoveredByRanges=h,l.firstAddedInSortedRanges=y,l.convertFromTimeRanges=C}),98);
__d("oz-player/manifests/SegmentTemplateSegmentsContainer",["oz-player/manifests/OzSegmentOptions","oz-player/shims/OzEventEmitter","oz-player/shims/OzURI","oz-player/shims/ozvariant","oz-player/utils/OzNumericalHelper","oz-player/utils/OzNumericalRangeUtil"],(function(t,n,r,o,a,i,l){"use strict";var e=1e-4,s=(function(){function t(e,t,n,o,a,i){i===void 0&&(i=!1),this.$7=new(r("oz-player/shims/OzEventEmitter")),this.$10=null,this.$8=e,this.$2=t,this.$3=n,this.$1=a,this.$4=o,this.$5=this.$11(this.$4),this.$6=i,this.$9=this.$8.getNumber("live_numerical_error_epsilon")}var n=t.prototype;return n.getSegmentByTime=function(t){for(var e=this.$12(t),n=e*this.$3,r=null,a=this.$4.length-1;a>=0;a--){var i=this.$4[a];if(o("oz-player/utils/OzNumericalHelper").lessThanOrEqual(i.t+i.d*(i.r+1),n,this.$9))break;r=i}if(r===null||o("oz-player/utils/OzNumericalHelper").greaterThan(r.t,n,this.$9))return null;var l=Math.max(0,Math.floor((n-r.t+this.$9)/r.d));return this.$13(r,l)},n.getSegment=function(t){for(var e=0,n=t;n>=0&&e<this.$4.length;){var r=this.$4[e],o=r.r,a=o+1;if(n>=a){n-=a,e++;continue}break}var i=this.$4[e];return i?this.$13(i,n):null},n.getSegmentAfter=function(t){var e=t.getTimeRange().endTime;return this.getSegmentByTime(e)},n.getPredictedSegmentAfter=function(t){return null},n.canPredict=function(){return!1},n.canApproximateId=function(){return!1},n.isEndingSegment=function(n){if(!this.$4||!this.$4.length||!this.$6)return!1;var t=this.$4[this.$4.length-1],r=t.r,o=this.$13(t,r);return Math.abs(o.getTimeRange().startTime-n.getTimeRange().startTime)+Math.abs(o.getTimeRange().endTime-n.getTimeRange().endTime)<e},n.updateWith=function(n){n instanceof t||r("oz-player/shims/ozvariant")(0,646),this.$6=n.$6,this.$14(n.$4),this.$15(n.$4),this.$7.emit("segment_updated")},n.getTimeRanges=function(){return this.$10?this.$16(this.$5,this.$10):this.$5},n.blockTimeRange=function(t){this.$10=t},n.$16=function(t,n){return o("oz-player/utils/OzNumericalRangeUtil").diffSortedRanges(this.$8,t.map(function(e){return{rangeStart:e.startTime,rangeEnd:e.endTime}}),{rangeStart:n.startTime,rangeEnd:n.endTime}).map(function(e){return{startTime:e.rangeStart,endTime:e.rangeEnd==null?1/0:e.rangeEnd}})},n.addUpdateListener=function(t){return this.$7.addListener("segment_updated",t)},n.$12=function(t){var e=t,n=o("oz-player/utils/OzNumericalRangeUtil").findCurrentRangeIndex(this.$8,t,this.getTimeRanges().map(function(e){return{rangeStart:e.startTime,rangeEnd:e.endTime}}));if(n===-1){var r=o("oz-player/utils/OzNumericalRangeUtil").findNextRangeIndex(t,this.getTimeRanges().map(function(e){return{rangeStart:e.startTime,rangeEnd:e.endTime}}));r!==-1&&(e=this.getTimeRanges()[r].startTime)}return e},n.$14=function(t){var e;(e=this.$4).splice.apply(e,[0,this.$4.length].concat(t))},n.$15=function(t){var e=this.$11(t),n=o("oz-player/utils/OzNumericalRangeUtil").mergeSortedRanges(this.$5.map(function(e){return{rangeStart:e.startTime,rangeEnd:e.endTime}}).concat(e.map(function(e){return{rangeStart:e.startTime,rangeEnd:e.endTime}})));this.$5=n.map(function(e){return{startTime:e.rangeStart,endTime:e.rangeEnd==null?1/0:e.rangeEnd}})},n.$11=function(t){var e=this,n=o("oz-player/utils/OzNumericalRangeUtil").mergeSortedRanges(this.$4.map(function(t){var n=e.$13(t,0).getTimeRange().startTime,r=e.$13(t,t.r).getTimeRange().endTime;return{rangeStart:n,rangeEnd:r}}));return n.map(function(e){var t=e.rangeEnd,n=e.rangeStart;return t=t==null?1/0:t,{startTime:n,endTime:t}})},n.$13=function(t,n){var e=this;n===void 0&&(n=0);var o=t.d,a=t.id,i=t.r,l=t.t,s=l+o*n,u=this.$8.getBool("use_scf_timebased_segments"),c=a!=null?a-(i-n):null,d=new(r("oz-player/manifests/OzSegmentOptions"));return{getData:function(){return null},getURI:function(){var t="";e.$1!=null&&c!=null?t=e.$1.replace("$Number$",c.toString()):c!=null&&e.$2.indexOf("$Number$")!==-1&&e.$8.getBool("parse_number_templated_uri")?t=e.$2.replace("$Number$",c.toString()):t=e.$2.replace("$Time$",s.toString());var n=new(r("oz-player/shims/OzURI"))(t);return u&&n.addQueryData("_nc_scf",1),n},getTimeRange:function(){return{startTime:s/e.$3,endTime:(s+o)/e.$3}},getByteRange:function(){return null},getSequenceNumber:function(){return null},getOptions:function(){return d}}},n.getSegmentGroups=function(){return this.$4},n.getEndingSegment=function(){if(this.$4.length===0)return null;var e=this.$4[this.$4.length-1],t=e.r;return this.$13(e,t)},n.forceParseIfNotParsed=function(){},n.getMaxGopSec=function(){return null},t})();l.default=s}),98);
__d("oz-player/utils/OzUrlHelper",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=e,n=t.indexOf("://"),r=t.indexOf("/",n+3);return r>n&&(t=t.substring(r)),t}function l(e){var t=e,n=t.lastIndexOf("/"),r=t.lastIndexOf("://");return n>r+2&&(t=t.substring(0,n+1)),t}function s(e){var t=e;return t=l(t),t.endsWith("/")?l(t.substring(0,t.length-1)):t}function u(e,t){for(var n=l(e),r=t;r.length;)if(r.startsWith("./"))r=r.substring(2);else if(r.startsWith("../"))r=r.substring(3),n=s(n),n.endsWith("/")&&(n=n.substring(0,n.length-1));else if(r.startsWith(".."))r=r.substring(2),n=s(n);else if(r.startsWith("."))r=r.substring(1);else break;return r&&r.length&&(n.endsWith("/")||(n+="/"),n+=r),n}function c(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!t||!t.length)return"";if(t.length===1)return t[0];for(var r=t.shift();t.length>0;)r=u(r,t.shift());return r}function d(e,t){return m(t)?t:c(e,t)}function m(e){var t=/^https?:\/\//i;return t.test(e)}i.stripToPathAndQueryOnly=e,i.joinRelativeUrlPaths=c,i.joinUrlPaths=d}),66);
__d("PredictedSegmentTemplateSegmentsContainer",["oz-player/manifests/OzSegmentOptions","oz-player/manifests/SegmentTemplateSegmentsContainer","oz-player/shims/OzURI","oz-player/shims/ozvariant","oz-player/utils/OzNumericalHelper","oz-player/utils/OzNumericalRangeUtil","oz-player/utils/OzUrlHelper"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n,r,o,a,i,l,s,u,c){var d;c===void 0&&(c=!1),d=e.call(this,t,n,o,a,null,c)||this,d.$PredictedSegmentTemplateSegmentsContainer$p_9=0,d.$PredictedSegmentTemplateSegmentsContainer$p_11=null,d.$PredictedSegmentTemplateSegmentsContainer$p_10=r,d.$PredictedSegmentTemplateSegmentsContainer$p_8=c,d.$PredictedSegmentTemplateSegmentsContainer$p_12=a,d.$PredictedSegmentTemplateSegmentsContainer$p_7=t,d.$PredictedSegmentTemplateSegmentsContainer$p_5=o,d.$PredictedSegmentTemplateSegmentsContainer$p_1=i,d.$PredictedSegmentTemplateSegmentsContainer$p_3=s,d.$PredictedSegmentTemplateSegmentsContainer$p_2=l,d.$PredictedSegmentTemplateSegmentsContainer$p_4=u,d.$PredictedSegmentTemplateSegmentsContainer$p_6=t.getNumber("live_numerical_error_epsilon");for(var m=0;m<d.$PredictedSegmentTemplateSegmentsContainer$p_12.length;m++)d.$PredictedSegmentTemplateSegmentsContainer$p_9=Math.max(d.$PredictedSegmentTemplateSegmentsContainer$p_12[m].d,d.$PredictedSegmentTemplateSegmentsContainer$p_9);return d}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.$PredictedSegmentTemplateSegmentsContainer$p_13=function(){return this.$PredictedSegmentTemplateSegmentsContainer$p_2!=null&&this.$PredictedSegmentTemplateSegmentsContainer$p_4!=null?{predictedAverageDuration:this.$PredictedSegmentTemplateSegmentsContainer$p_4,predictedMediaStartNumber:this.$PredictedSegmentTemplateSegmentsContainer$p_2}:null},n.$PredictedSegmentTemplateSegmentsContainer$p_14=function(t,n,a){var e=this;!Number.isNaN(a)||r("oz-player/shims/ozvariant")(0,54238);var i=this.$PredictedSegmentTemplateSegmentsContainer$p_1.indexOf("%24Number%24")===-1?this.$PredictedSegmentTemplateSegmentsContainer$p_1.replace("$Number$",a.toString()):this.$PredictedSegmentTemplateSegmentsContainer$p_1.replace("%24Number%24",a.toString()),l=this.$PredictedSegmentTemplateSegmentsContainer$p_7.getLegacyConfig().getString("cdn_experiment_id",""),s=this.$PredictedSegmentTemplateSegmentsContainer$p_7.getLegacyConfig().getNumber("use_dvl_with_timeout_ms",0),u=new(r("oz-player/manifests/OzSegmentOptions"));return{getByteRange:function(){return null},getData:function(){return null},getOptions:function(){return u},getSequenceNumber:function(){return a},getTimeRange:function(){return{endTime:n,startTime:t}},getURI:function(){var t=new(r("oz-player/shims/OzURI"))(i);l.length!==0&&t.addQueryData("_nc_expid",l);var n=u.isDVLEnabled();return n&&s>0&&e.$PredictedSegmentTemplateSegmentsContainer$p_10!=null&&(t.addQueryData("_nc_dinfo-manifest-url",o("oz-player/utils/OzUrlHelper").stripToPathAndQueryOnly(e.$PredictedSegmentTemplateSegmentsContainer$p_10)),t.addQueryData("_nc_dinfo-timeout",s)),t}}},n.updateWith=function(o){o instanceof t||r("oz-player/shims/ozvariant")(0,646),this.$PredictedSegmentTemplateSegmentsContainer$p_3=o.$PredictedSegmentTemplateSegmentsContainer$p_3,this.$PredictedSegmentTemplateSegmentsContainer$p_1=o.$PredictedSegmentTemplateSegmentsContainer$p_1,e.prototype.updateWith.call(this,o),this.$PredictedSegmentTemplateSegmentsContainer$p_12=o.$PredictedSegmentTemplateSegmentsContainer$p_12,this.$PredictedSegmentTemplateSegmentsContainer$p_8=o.$PredictedSegmentTemplateSegmentsContainer$p_8;for(var n=0;n<this.$PredictedSegmentTemplateSegmentsContainer$p_12.length;n++)this.$PredictedSegmentTemplateSegmentsContainer$p_9=Math.max(this.$PredictedSegmentTemplateSegmentsContainer$p_12[n].d,this.$PredictedSegmentTemplateSegmentsContainer$p_9)},n.getSegmentByTime=function(t){return this.canApproximateId()?this.$PredictedSegmentTemplateSegmentsContainer$p_15(t):this.$PredictedSegmentTemplateSegmentsContainer$p_16(t)},n.getPredictedSegmentAfter=function(t){var e=t!=null?t.getSequenceNumber():null;return e!=null&&this.canPredict()?this.$PredictedSegmentTemplateSegmentsContainer$p_14(0,0,e+1):null},n.blockTimeRange=function(n){this.$PredictedSegmentTemplateSegmentsContainer$p_11=n,e.prototype.blockTimeRange.call(this,n)},n.getTimeRanges=function(){var t=this.$PredictedSegmentTemplateSegmentsContainer$p_13();if(t){var n=[{endTime:(this.$PredictedSegmentTemplateSegmentsContainer$p_12[this.$PredictedSegmentTemplateSegmentsContainer$p_12.length-1].t+this.$PredictedSegmentTemplateSegmentsContainer$p_12[this.$PredictedSegmentTemplateSegmentsContainer$p_12.length-1].d)/this.$PredictedSegmentTemplateSegmentsContainer$p_5,startTime:(this.$PredictedSegmentTemplateSegmentsContainer$p_12[0].t-t.predictedAverageDuration-(this.$PredictedSegmentTemplateSegmentsContainer$p_3-this.$PredictedSegmentTemplateSegmentsContainer$p_12.length-Number(this.$PredictedSegmentTemplateSegmentsContainer$p_2))*Number(t.predictedAverageDuration))/this.$PredictedSegmentTemplateSegmentsContainer$p_5}],r=this.$PredictedSegmentTemplateSegmentsContainer$p_11;return r==null?n:o("oz-player/utils/OzNumericalRangeUtil").diffSortedRanges(this.$PredictedSegmentTemplateSegmentsContainer$p_7,n.map(function(e){return{rangeEnd:e.endTime,rangeStart:e.startTime}}),{rangeEnd:r.endTime,rangeStart:r.startTime}).map(function(e){return{endTime:e.rangeEnd==null?1/0:e.rangeEnd,startTime:e.rangeStart}})}else return e.prototype.getTimeRanges.call(this)},n.canPredict=function(){return!0},n.canApproximateId=function(){var e=this.$PredictedSegmentTemplateSegmentsContainer$p_13();return e!=null},n.$PredictedSegmentTemplateSegmentsContainer$p_16=function(t){var e=null,n=t*this.$PredictedSegmentTemplateSegmentsContainer$p_5,a=this.$PredictedSegmentTemplateSegmentsContainer$p_12.length>0?this.$PredictedSegmentTemplateSegmentsContainer$p_12[this.$PredictedSegmentTemplateSegmentsContainer$p_12.length-1].t+this.$PredictedSegmentTemplateSegmentsContainer$p_12[this.$PredictedSegmentTemplateSegmentsContainer$p_12.length-1].d:null,i=this.$PredictedSegmentTemplateSegmentsContainer$p_7.getLegacyConfig().getNumber("pdash_future_edgelatency_gops",0);if(a!=null&&a<=n&&i!==0&&n<a+this.$PredictedSegmentTemplateSegmentsContainer$p_9*i){var l=n-(this.$PredictedSegmentTemplateSegmentsContainer$p_12[this.$PredictedSegmentTemplateSegmentsContainer$p_12.length-1].t+this.$PredictedSegmentTemplateSegmentsContainer$p_12[this.$PredictedSegmentTemplateSegmentsContainer$p_12.length-1].d),s=this.$PredictedSegmentTemplateSegmentsContainer$p_9?0:Math.floor(l/this.$PredictedSegmentTemplateSegmentsContainer$p_9);return this.$PredictedSegmentTemplateSegmentsContainer$p_14(0,0,this.$PredictedSegmentTemplateSegmentsContainer$p_3+1+s)}for(var u=0,c=0;this.$PredictedSegmentTemplateSegmentsContainer$p_12.length-1-c>=0;c++){var d=this.$PredictedSegmentTemplateSegmentsContainer$p_12[this.$PredictedSegmentTemplateSegmentsContainer$p_12.length-1-c];if(d.r===0||r("oz-player/shims/ozvariant")(0,18769),o("oz-player/utils/OzNumericalHelper").lessThanOrEqual(d.t+d.d*(d.r+1),n,this.$PredictedSegmentTemplateSegmentsContainer$p_6))break;e=d,u=c}return e===null||i>0&&n<e.t?null:this.$PredictedSegmentTemplateSegmentsContainer$p_14(e.t/this.$PredictedSegmentTemplateSegmentsContainer$p_5,(e.t+e.d)/this.$PredictedSegmentTemplateSegmentsContainer$p_5,this.$PredictedSegmentTemplateSegmentsContainer$p_3-u)},n.$PredictedSegmentTemplateSegmentsContainer$p_15=function(t){var e=t*this.$PredictedSegmentTemplateSegmentsContainer$p_5,n=this.getTimeRanges();if(o("oz-player/utils/OzNumericalHelper").greaterThan(n[0].startTime,t))return null;if(o("oz-player/utils/OzNumericalHelper").lessThanOrEqual(this.$PredictedSegmentTemplateSegmentsContainer$p_12[0].t,e))return this.$PredictedSegmentTemplateSegmentsContainer$p_16(t);var r=Math.ceil((this.$PredictedSegmentTemplateSegmentsContainer$p_12[0].t-e)/Number(this.$PredictedSegmentTemplateSegmentsContainer$p_4)),a=Math.max(Number(this.$PredictedSegmentTemplateSegmentsContainer$p_2),this.$PredictedSegmentTemplateSegmentsContainer$p_3-this.$PredictedSegmentTemplateSegmentsContainer$p_12.length+1-r);return this.$PredictedSegmentTemplateSegmentsContainer$p_14(t,t+Number(this.$PredictedSegmentTemplateSegmentsContainer$p_4)/this.$PredictedSegmentTemplateSegmentsContainer$p_5,a)},n.isEndingSegment=function(n){if(!this.$PredictedSegmentTemplateSegmentsContainer$p_8)return!1;var t=n.getSequenceNumber();return t!=null?t>=this.$PredictedSegmentTemplateSegmentsContainer$p_3:e.prototype.isEndingSegment.call(this,n)},n.getEndingSegment=function(){if(this.$PredictedSegmentTemplateSegmentsContainer$p_12.length===0)return null;var e=this.$PredictedSegmentTemplateSegmentsContainer$p_12[this.$PredictedSegmentTemplateSegmentsContainer$p_12.length-1];return this.$PredictedSegmentTemplateSegmentsContainer$p_14(e.t/this.$PredictedSegmentTemplateSegmentsContainer$p_5,(e.t+e.d)/this.$PredictedSegmentTemplateSegmentsContainer$p_5,this.$PredictedSegmentTemplateSegmentsContainer$p_3)},n.getMaxGopSec=function(){return this.$PredictedSegmentTemplateSegmentsContainer$p_9/this.$PredictedSegmentTemplateSegmentsContainer$p_5},t})(r("oz-player/manifests/SegmentTemplateSegmentsContainer"));l.default=e}),98);
__d("oz-player/parsers/OzDefaultSegmentTimelineParser",["oz-player/manifests/SegmentTemplateSegmentsContainer","oz-player/utils/OzUrlHelper"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){}e.parseSegments=function(t,n){var e=[];return n.SegmentTimeline[0].S&&(e=n.SegmentTimeline[0].S.map(function(e){return{t:Number.parseInt(e.$.t,10),d:Number.parseInt(e.$.d,10),r:Number.parseInt(e.$.r||"0",10),id:e.$.id?Number.parseInt(e.$.id,10):void 0}})),e};var t=e.prototype;return t.parseSegmentsContainer=function(n,a,i){return new(r("oz-player/manifests/SegmentTemplateSegmentsContainer"))(n,o("oz-player/utils/OzUrlHelper").joinUrlPaths(a.baseUrl,i.$.media),Number.parseInt(i.$.timescale,10),e.parseSegments(n,i),null,a.isStaticMpd)},e})();l.default=e}),98);
__d("OzPredictedSegmentTimelineParser",["PredictedSegmentTemplateSegmentsContainer","oz-player/manifests/SegmentTemplateSegmentsContainer","oz-player/parsers/OzDefaultSegmentTimelineParser","oz-player/shims/OzURI","oz-player/utils/OzUrlHelper"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){}var t=e.prototype;return t.parseSegmentsContainer=function(t,n,a){var e;if(a.SegmentTimeline[0].$.FBPredictedMedia){e=o("oz-player/utils/OzUrlHelper").joinUrlPaths(n.baseUrl,a.SegmentTimeline[0].$.FBPredictedMedia);var i=new(r("oz-player/shims/OzURI"))(e);i.addQueryData("_nc_sc",1),e=i.toString()}var l;a.SegmentTimeline[0].$.FBPredictedMediaStartNumber&&(l=Number.parseInt(a.SegmentTimeline[0].$.FBPredictedMediaStartNumber,0));var s;a.SegmentTimeline[0].$.FBPredictedMediaEndNumber&&(s=Number.parseInt(a.SegmentTimeline[0].$.FBPredictedMediaEndNumber,0));var u;a.SegmentTimeline[0].$.FBAverageDuration&&(u=Number.parseInt(a.SegmentTimeline[0].$.FBAverageDuration,0));var c=r("oz-player/parsers/OzDefaultSegmentTimelineParser").parseSegments(t,a);return(n.isTemplatedMpd&&l!=null&&u!=null||!n.isTemplatedMpd)&&e!=null&&s!=null?new(r("PredictedSegmentTemplateSegmentsContainer"))(t,o("oz-player/utils/OzUrlHelper").joinUrlPaths(n.baseUrl,a.$.media),n.mpdUrl,Number.parseInt(a.$.timescale,10),c,e,l,s,u,n.isStaticMpd):new(r("oz-player/manifests/SegmentTemplateSegmentsContainer"))(t,o("oz-player/utils/OzUrlHelper").joinUrlPaths(n.baseUrl,a.$.media),Number.parseInt(a.$.timescale,10),c,e,n.isStaticMpd)},e})();l.default=e}),98);
__d("oz-player/utils/OzAbrUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n,r){if(r.resolutionConstraintFactor===0)return e.slice();var o=e.filter(function(e){var o=e.getWidth()<=t.width*n*r.resolutionConstraintFactor,a=e.getHeight()<=t.height*n*r.resolutionConstraintFactor;return o&&a});return o.length?o:[e[0]]}function l(e,t,n,r,o,a){var i=t?e.getNumber("min_switch_interval"):e.getNumber("initial_switch_interval"),l=r>=e.getNumber("abr_min_bandwidth_samples"),s=e.getNumber("abr_eval_buffer_threshold"),u=!s||n>=s,c=null;return o+e.getNumber("min_eval_interval")>Date.now()?c="min_eval_interval":a+i>Date.now()?c="min_switch_interval":l?u||(c="buffer_threshold_not_satisfied"):c="min_bandwidth_samples",c}i.excludeLargeRepresentations=e,i.getReasonToPreventEvaluation=l}),66);
__d("oz-player/utils/OzPlaybackRestrictionsUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n){if(n.length===0)return[];var r=e.reduce(function(e,n){return n.applyRestriction(e,t)},n);return r}i.applyVideoPlaybackRestrictions=e}),66);
__d("OzSystemicRiskABRUtils",["OzSystemicRiskUtils","QualityScoreUtils","oz-player/utils/OzAbrUtils","oz-player/utils/OzBufferingUtils","oz-player/utils/OzPlaybackRestrictionsUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=30,s=5e3;function u(e,t,n){var r=t.getQualityScoreCurveString(e),a=o("QualityScoreUtils").parseQualityScoreCurve(String(r));return a!=null?o("QualityScoreUtils").calculateQualityScore(a,n,!0):null}function c(e){var t=s;if(e!=null&&e.length>0){var n=e[0].getTimeRange().startTime,r=e[e.length-1].getTimeRange().endTime;r-n>0&&(t=(r-n)*1e3)}return t}function d(e,t,n,r,a){if(!r.shouldApplyRepresentationRestrictions)return a.slice();var i,l=function(){i=o("oz-player/utils/OzAbrUtils").excludeLargeRepresentations(i!=null?i:a,t,n,{resolutionConstraintFactor:r.resolutionConstraintFactor})},s=function(){i=o("oz-player/utils/OzPlaybackRestrictionsUtils").applyVideoPlaybackRestrictions(e,t,i!=null?i:a)};return r.excludeLargeRepresentationsAfterRestrictions||(l(),s()),r.excludeLargeRepresentationsAfterRestrictions&&(s(),l()),i!=null?i:a.slice()}var m={BANDWIDTH:"br",BUFFER:"vb",ENCODING:"er",LOW_MOS:"lm",MULTIPLIER:"m",PREVIOUS_MOS:"pm",PREVIOUS_RESOLUTION:"pr"};function p(e,t,n){if(t==null)return e;var r=n.isSystemicRiskABREnabled,o=n.noRepresentationSelected,a=n.representationCount,i=[[m.LOW_MOS,t.lowMos],[m.ENCODING,t.encoding],[m.BANDWIDTH,t.bandwidth],[m.MULTIPLIER,t.multiplier],[m.BUFFER,t.buffer],[m.PREVIOUS_MOS,t.previousMos],[m.PREVIOUS_RESOLUTION,t.previousResolution]].reduce(function(e,t){var n=t[1],r="";switch(typeof n){case"number":r=n.toFixed(1);break;case"boolean":r=n?"1":"0";break;default:r="null"}return e+(t[0]+": "+r+";")},"");return r||(i+="disabled;"),o&&(i+="none-selected-of-"+a+";"),i}function _(t){var n=t.videoRepresentations;if(n.length===0)return babelHelpers.extends({},t.abrState,{lastEvaluationReason:"no available representations"});var r=o("oz-player/utils/OzBufferingUtils").getBufferAheadFromCurrentTime(t.playheadMediaTimeSec,t.sourceBufferBufferedRangesSec),a=t.mediaDurationSec;a=isNaN(a)||!isFinite(a)?e:a;var i=t.durationMode==="static"?(a-t.playheadMediaTimeSec)*1e3:e*1e3,l=t.systemicRiskConfig.segmentFetchRangeDurationEnabled?c(t.segments):s,m=t.bandwidthDiagnostics;if(m==null)return babelHelpers.extends({},t.abrState,{lastEvaluationReason:"missing bandwidth diagnostics"});var _=d(t.videoRepresentationRestrictions,t.playerDimensions,t.devicePixelRatio,t.systemicRiskConfig,n).slice().sort(function(e,t){return e.getBandwidth()-t.getBandwidth()});if(_.length===0)return babelHelpers.extends({},t.abrState,{lastEvaluationReason:"no representations after applying restrictions"});for(var f=null,g=null,h=null,y=0;y<_.length;y++){var C,b,v=_[Math.max(y-1,0)],S=_[y],R=(C=u(t.qualityScoreType,S,t.playerDimensions))!=null?C:0,L=(b=u(t.qualityScoreType,v,t.playerDimensions))!=null?b:0,E=Math.min(v.getHeight(),v.getWidth()),k=E*t.devicePixelRatio;g=o("OzSystemicRiskUtils").getRiskFactorsForRepresentation({bandwidthDiagnostics:m,bitrate:S.getBandwidth(),bufferAheadSec:r,defaultRiskFactor:t.systemicRiskConfig.defaultRiskFactor,documentHiddenRiskFactor:t.systemicRiskConfig.documentHiddenRiskFactor,hasMadeInitialDecision:t.abrState.hasMadeInitialDecision,highEstimateConfidence:t.systemicRiskConfig.highEstimateConfidence,initialRiskFactor:t.systemicRiskConfig.initialRiskFactor,isDocumentHidden:t.isDocumentHidden,lowMosResolution:t.systemicRiskConfig.lowMosResolution,lowMosRiskFactor:t.systemicRiskConfig.lowMosRiskFactor,minWatchableMos:t.systemicRiskConfig.minWatchableMos,previousMos:L,previousResolution:k,remainingVideoDurationMs:i,segmentFetchRangeDurationMs:l});var I=g,T=I.multiplier;if(isNaN(T)){h=g,f=t.abrState.bestRepresentation;break}var D=o("OzSystemicRiskUtils").isEffectiveBitrateBelowBandwidthEstimate(S.getBandwidth(),g.multiplier,l,m);if(D&&R>=L)h=g,f=S;else continue}var x;f==null?x=t.systemicRiskConfig.respectPlaybackRestrictionsInABRFallback&&_.length>0?_[0]:n[0]:x=f;var $=p(t.abrState.lastEvaluationReason,h!=null?h:g,{isSystemicRiskABREnabled:t.systemicRiskConfig.isSystemicRiskABREnabled,noRepresentationSelected:f==null,representationCount:_.length});return{bestRepresentation:x,hasMadeInitialDecision:!0,lastEvaluationReason:$}}l.evaluateSystemicRiskABR=_}),98);
__d("OzSystemicRiskABRManager",["OzSystemicRiskABRUtils","OzSystemicRiskUtils","VideoPlayerOzWWWConfig","oz-player/networks/OzBandwidthEstimator"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n,r,o,a,i,l,s){this.$1=e,this.$2=n,this.$3=r,this.$4=o,this.$6=a,this.$7=i,this.$8=l,this.$9={bestRepresentation:t,hasMadeInitialDecision:!1,lastEvaluationReason:void 0},this.$10=s,this.$1.getBool("enable_abr_logging")&&this.$10.getOperationLogger("abr_initialized").setResult("success").setUserInfo({codecs:n.map(function(e){return e.getCodecs()}).join("|"),displayLabels:n.map(function(e){return e.getDisplayLabel()}).join(","),representationIds:n.map(function(e){return e.getID()}).join(",")}).setRepresentationID(t.getID()).setType("video").setInitiator("OzSystemicRiskABRManager").log()}var t=e.prototype;return t.setSourceBuffer=function(t){this.$5=t},t.updateRepresentations=function(t){var e=this,n=this.$2;this.$2=t;var r=this.$9.bestRepresentation,o=this.$2.find(function(t){return t.getDisplayLabel()===e.$9.bestRepresentation.getDisplayLabel()});this.$9=babelHelpers.extends({},this.$9,{bestRepresentation:o!=null?o:this.$2[0]}),this.$1.getBool("enable_abr_logging")&&this.$10.getOperationLogger("abr_representations_updated").setResult("success").setRepresentationID(this.$9.bestRepresentation.getID()).setPreviousRepresentationID(r.getID()).setUserInfo({newCodecs:t.map(function(e){return e.getCodecs()}).join("|"),newDisplayLabels:t.map(function(e){return e.getDisplayLabel()}).join(","),previousRepresentationIds:n.map(function(e){return e.getID()}).join(",")}).setType("video").setInitiator("OzSystemicRiskABRManager").log()},t.getBestRepresentation=function(t){var e,n,a=this.$1.getLegacyConfig(),i="mos";if(a instanceof r("VideoPlayerOzWWWConfig")){var l=a.getAllContexts(),s=String(l.quality_score_type);i=s==="csvqm"?"csvqm":"mos"}var u=(e=(n=this.$5)==null?void 0:n.getSourceBufferState().getBufferedRanges())!=null?e:null,c=this.$4.getCurrentTime(),d=this.$4.getDuration(),m=this.$9.bestRepresentation,p=a.getBool("use_bandwidth_estimate_from_headers_in_abr",!1)?r("oz-player/networks/OzBandwidthEstimator").getBandwidthDiagnosticsFromHeaders(a):r("oz-player/networks/OzBandwidthEstimator").getBandwidthDiagnostics(a);return this.$9=o("OzSystemicRiskABRUtils").evaluateSystemicRiskABR({abrState:this.$9,bandwidthDiagnostics:p,devicePixelRatio:this.$6,durationMode:this.$8,isDocumentHidden:document.hidden,mediaDurationSec:d,playerDimensions:this.$7(),playheadMediaTimeSec:c,qualityScoreType:i,segments:t,sourceBufferBufferedRangesSec:u,systemicRiskConfig:o("OzSystemicRiskUtils").getSystemicRiskConfigFromOzPlayerConfig(a),videoRepresentationRestrictions:this.$3,videoRepresentations:this.$2}),this.$1.getBool("enable_abr_logging")&&this.$9.bestRepresentation!==m&&this.$10.getOperationLogger("abr_best_representation_selected").setResult("success").setReason(this.$9.lastEvaluationReason).setRepresentationID(this.$9.bestRepresentation.getID()).setPreviousRepresentationID(m==null?void 0:m.getID()).setUserInfo({bandwidthEstimate:String(p==null?void 0:p.bandwidthEstimate),qualityScoreType:i}).setType("video").setInitiator("OzSystemicRiskABRManager").log(),this.$9.bestRepresentation},t.getLastEvaluationReason=function(){return this.$9.lastEvaluationReason},e})();l.default=e}),98);
__d("oz-player/shims/www/OzStreamsWWW",["cr:927622","cr:927623"],(function(t,n,r,o,a,i,l){"use strict";var e=!!n("cr:927622"),s=!!n("cr:927623"),u=n("cr:927622")?n("cr:927622").ReadableStream:t.ReadableStream,c=n("cr:927623")?n("cr:927623").WritableStream:t.WritableStream;l.OzReadableStream=u,l.OzReadableStreamIsPolyfilled=e,l.OzWritableStream=c,l.OzWritableStreamIsPolyfilled=s}),98);
__d("oz-player/shims/OzStreams",["oz-player/shims/www/OzStreamsWWW"],(function(t,n,r,o,a,i,l){"use strict";var e;l.OzReadableStream=(e=o("oz-player/shims/www/OzStreamsWWW")).OzReadableStream,l.OzReadableStreamIsPolyfilled=e.OzReadableStreamIsPolyfilled,l.OzWritableStream=e.OzWritableStream,l.OzWritableStreamIsPolyfilled=e.OzWritableStreamIsPolyfilled}),98);
__d("oz-player/networks/OzTransformStream",["oz-player/shims/OzEventEmitter","oz-player/shims/OzStreams","oz-player/utils/OzErrorUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t){var n,r;r=e.call(this)||this;var a=(n=t==null?void 0:t.errorTransform)!=null?n:function(e){return e},i,l;return r.writable=new(o("oz-player/shims/OzStreams")).OzWritableStream({start:function(t){l=t},write:function(t){r.emit("writableWrite",t);try{r.onDataWritten(t)}catch(e){i.error(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_STREAM",description:"Error from write handler: "+r.constructor.name,extra:{code:"OZ_S-0",originalError:e}}))}i.enqueue(t)},close:function(){r.emit("writableClose");try{r.onClose()}catch(e){i.error(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_STREAM",description:"Error from close handler: "+r.constructor.name,extra:{code:"OZ_S-1",originalError:e}}))}i.close()},abort:function(t){var e=a(t);i.error(e)}}),r.readable=new(o("oz-player/shims/OzStreams")).OzReadableStream({start:function(t){i=t},cancel:function(t){r.emit("readableCancel",t),l.error(t)}}),r}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.onDataWritten=function(t){},n.onClose=function(){},t})(r("oz-player/shims/OzEventEmitter"));l.default=e}),98);
__d("oz-player/shims/www/OzPerformanceWWW",["performance","performanceNow"],(function(t,n,r,o,a,i,l){var e,s,u={now:function(){return(e||(e=r("performanceNow")))()},getEntriesByName:function(t,n){return typeof(s||(s=r("performance"))).getEntriesByName=="function"?(s||(s=r("performance"))).getEntriesByName(t,n):[]}},c=u;l.default=c}),98);
__d("oz-player/shims/OzPerformance",["oz-player/shims/www/OzPerformanceWWW"],(function(t,n,r,o,a,i,l){l.default=r("oz-player/shims/www/OzPerformanceWWW")}),98);
__d("oz-player/utils/OzResourceTimingUtils",["oz-player/shims/OzPerformance"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){var e=r("oz-player/shims/OzPerformance").getEntriesByName(t,"resource");return e.reduce(function(e,t){return e==null?t:t.responseEnd<e.responseEnd?e:t},null)};l.getLatestResourceTimingEntry=e}),98);
__d("OzVideoLiveTraceNetworkRequestStreamHandler",["oz-player/networks/OzTransformStream","oz-player/utils/OzResourceTimingUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){t===void 0&&(t=!1),this.$2=!1,this.$1=e,this.$2=t}var t=e.prototype;return t.onResponse=function(t,n){var e=this,a=t.headers,i=null;if(!this.$1)return null;var l=new(r("oz-player/networks/OzTransformStream"));return l.addListener("writableClose",function(){var t={},r=o("oz-player/utils/OzResourceTimingUtils").getLatestResourceTimingEntry(n);r&&(t.lat=Math.round(r.responseStart-r.requestStart).toString()),e.$1&&a&&e.$1(a,i,t)}),this.$2&&l.addListener("writableWrite",function(e){i===null?i=[e]:i.push(e)}),l},t.onError=function(t,n){return null},e})();l.default=e}),98);
__d("oz-player/drm/OzDrmUtils",[],(function(t,n,r,o,a,i){"use strict";var e=function(t){return Uint8Array.from(window.atob(t),function(e){return e.charCodeAt(0)})},l=function(t){return window.btoa(String.fromCharCode.apply(null,new Uint8Array(t)))};i.base64ToUint8Array=e,i.arrayBufferToBase64=l}),66);
__d("OzWidevineDrmProvider",["ConstUriUtils","FBLogger","getErrorSafe","oz-player/drm/OzDrmUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n,a,i){if(this.$2=[],this.$4=!0,this.$5=!1,i!=null&&i!==""&&(this.$1=o("oz-player/drm/OzDrmUtils").base64ToUint8Array(i)),t!=null&&a!=null){var l,s=(l=o("ConstUriUtils").getUri(t))==null?void 0:l.addQueryParam("access_token",a);if(s==null)throw r("FBLogger")("comet_video_player").mustfixThrow("Invalid Graph API license uri for video: %s",e);this.$3=s.toString(),this.$5=!0,this.$4=!1}else{var u=n[0];if(u==null){var c;u="/video/drm/getlicense";var d=(c=o("ConstUriUtils").getUri(u))==null?void 0:c.addQueryParam("video_id",e);if(d==null)throw r("FBLogger")("comet_video_player").mustfixThrow("Invalid server license uri for video: %s",e);this.$3=d.toString()}else this.$3=u}}var t=e.prototype;return t.getKeySystem=function(){return"com.widevine.alpha"},t.getSchemeId=function(){return"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"},t.getInitDatas=function(){return this.$2},t.setInitDatas=function(t){this.$2=t},t.getRequireDistinctiveIdentifier=function(){return"optional"},t.getRequirePersistentState=function(){return"optional"},t.getInitDataTypes=function(){},t.getDrmSessionTypes=function(){return["temporary"]},t.getAudioRobustness=function(){return""},t.getVideoRobustness=function(){return""},t.getServerCertificate=function(){return this.$1},t.getLicenseRequestInfo=function(t){var e={url:this.$3,method:"POST",body:"",headers:{},credentials:void 0};this.$4&&(e.credentials="include");var n=o("oz-player/drm/OzDrmUtils").arrayBufferToBase64(t);if(this.$5){var r={request:n};e.body=JSON.stringify(r),e.headers["Content-Type"]="application/json"}else e.body=n,e.headers["Content-Type"]="application/text";return e},t.parseLicenseResponse=function(t){var e=String.fromCharCode.apply(null,t),n;try{n=JSON.parse(e)}catch(e){n=void 0}var a;if(n!==void 0&&n.data!==void 0&&n.data.length===1){var i=n.data[0];i.error!=null||(a=i.license)}else a=e;if(a!=null&&a!=="")try{return o("oz-player/drm/OzDrmUtils").base64ToUint8Array(a)}catch(e){var l=r("getErrorSafe")(e);throw l.name==="InvalidCharacterError"?new Error("Endpoint returned error: "+a):l}return null},e})();l.default=e}),98);
__d("TimeRanges",["invariant"],(function(t,n,r,o,a,i,l,s){var e=(function(){function e(e){this.$1=[],this.$1=e}var t=e.prototype;return t.start=function(t){return this.$1[t]||s(0,2205),this.$1[t].startTime},t.end=function(t){return this.$1[t]||s(0,2205),this.$1[t].endTime},t.length=function(){return this.$1.length},e})();l.default=e}),98);
__d("VideoPlayerImplementationLoadSequenceManager",["setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){this.$1=[],this.$2=[]}var t=e.prototype;return t.schedule=function(t,n,o){var e=this,a={load:o,maximumBlockTimeMs:t.getNumber("load_sequence_max_delay_ms",0),sequence:n},i=!1,l=t.getNumber("load_sequence_only_prioritize_first_count",0);return l>0?i=!this.$2.find(function(e){return e.sequence<l}):i=!this.$2.find(function(e){return e.sequence<n}),i?this.$3(a):(this.$1.push(a),r("setTimeout")(function(){return e.$4(a)},a.maximumBlockTimeMs)),function(){return e.$5(a)}},t.$4=function(t){var e=this.$1.find(function(e){return e===t});e&&(this.$1=this.$1.filter(function(e){return e!==t}),this.$3(e))},t.$3=function(t){var e=this;this.$2.push(t),t.load().then(function(){return e.$6(t)}).catch(function(n){throw e.$6(t),n}),r("setTimeout")(function(){return e.$6(t)},t.maximumBlockTimeMs)},t.$7=function(){var e=this,t=Math.min.apply(Math,this.$1.map(function(e){return e.sequence})),n=this.$1.filter(function(e){return e.sequence===t});n.forEach(function(t){return e.$4(t)})},t.$5=function(t){this.$1=this.$1.filter(function(e){return e!==t})},t.$6=function(t){if(this.$2.find(function(e){return e===t})){this.$2=this.$2.filter(function(e){return e!==t});var e=!!this.$2.find(function(e){return e.sequence===t.sequence});e&&this.$7()}},e})(),s=new e,u=s;l.default=u}),98);
__d("handleVideoPlayerLatencyLevelChange",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n,r){if(e&&t&&n){var o=e.getAllContexts().latency_level,a=[];try{a=JSON.parse(e.getString("seek_on_latency_level_change_allowed","[]"))}catch(e){}var i=a.some(function(e){return e.length===2&&e[0]===o&&e[1]===r});if(e.setContext("latency_level",r),!i)return;var l=t.getDuration(),s=l!=null?l+e.getNumber("live_initial_playback_position",0):null;s!=null&&t.setPlayheadPosition(s)}}i.default=e}),66);
__d("VideoPlayerOzImplementationEngineExtrasAPI",["VideoPlayerOzWWWGlobalConfig","emptyFunction","gkx","handleVideoPlayerLatencyLevelChange","oz-player/networks/OzBandwidthEstimator"],(function(t,n,r,o,a,i,l){"use strict";var e=r("emptyFunction");function s(e){var t;return(t=e.getSelectedVideoQuality())!=null?t:""}function u(e){var t=e.getCurrentPlayingAudioTrackID();return t==null?null:t}function c(e){var t=e.getCurrentVideoRepresentation();return t==null?"":t.getDisplayLabel()}function d(e){var t,n=e.getIsVideoQualityAdaptationEnabled()?"auto":(t=e.getSelectedVideoQuality())!=null?t:"auto";return n}function m(e){return e.getTargetAudioTrack()}function p(e){var t,n;return(t=(n=e.getMpd())==null?void 0:n.getCustomField("fbProjection"))!=null?t:null}function _(e,t){var n=d(e);if(t==="notselected"||t===n)return!1;if(t==="auto")return e.enableVideoQualityAdaptation(),!0;if(t!==e.getSelectedVideoQuality()){var r=t;return e.switchToVideoQuality(r),!0}else return!1}function f(e,t){var n=t;e.switchToVideoVariant(n)}function g(e){var t=e.getConfig,n=e.getOzPlayer,o=e.getVideoElementAPI,a={getApproximateFBLSToPlayerDisplayLatency:function(){var e,t;return(e=(t=n())==null?void 0:t.getApproximateFBLSToPlayerDisplayLatency())!=null?e:null},getAvailableAudioTracks:function(){var e,t=(e=n())==null?void 0:e.getAudioTracks();if(!t)return[];var r=t.map(function(e){return{displayLabel:e.displayLabel,id:e.id,lang:e.lang,mimeCodecs:e.mimeCodecs,role:e.role,variantKey:e.variantKey}});return r},getAvailableVideoQualities:function(){var e,t;return(e=(t=n())==null?void 0:t.getVideoQualities())!=null?e:[]},getAvailableVideoTracks:function(){var e,t=(e=n())==null?void 0:e.getVideoTracks();if(!t)return[];var r=t.map(function(e){return{codec:e.codec,codecFamily:e.codecFamily,displayLabel:e.displayLabel,height:e.height,id:e.id,lang:e.lang,mimeCodecs:e.mimeCodecs,qualityLabel:e.qualityLabel,role:e.role,variantKey:e.variantKey,width:e.width}});return r},getCurrentAudioRepresentation:function(){var e,t;return(e=(t=n())==null?void 0:t.getCurrentAudioRepresentation())!=null?e:null},getCurrentPlayingAudioRepresentationID:function(){var e=n();return e?u(e):null},getCurrentPlayingAudioTrackID:function(){var e=n();return e?u(e):null},getCurrentPlayingVideoQuality:function(){var e=n();return e?c(e):""},getCurrentPlayingVideoRepresentationID:function(){var e,t;return(e=(t=n())==null||(t=t.getCurrentVideoRepresentation())==null?void 0:t.getID())!=null?e:null},getCurrentTargetVideoQuality:function(){var e=n();return e?s(e):""},getCurrentVideoRepresentation:function(){var e,t;return(e=(t=n())==null?void 0:t.getCurrentVideoRepresentation())!=null?e:null},getEstimatedBandwidth:function(){return r("oz-player/networks/OzBandwidthEstimator").getBandwidth(r("VideoPlayerOzWWWGlobalConfig"))},getInbandCaptionsAutogeneratedFromManifest:function(){var e,t=(e=n())==null?void 0:e.getMpd();return!!(t!=null&&t.getCustomField("hasInbandCaptionsFromUsingASRCaptions"))},getInbandCaptionsExpectedFromManifest:function(){var e,t=(e=n())==null?void 0:e.getMpd();return!!(t!=null&&t.getCustomField("hasInbandCaptionsFromUsingASRCaptions"))||!!(t!=null&&t.getCustomField("hasInbandCaptionsFromAccessibility"))},getManifestIdentifier:function(){var e,t=(e=n())==null||(e=e.getMpd())==null?void 0:e.getCustomField("fbManifestIdentifier");return t!=null?String(t):null},getMpdValidationErrors:function(){var e,t=(e=n())==null||(e=e.getMpd())==null?void 0:e.getCustomField("validationErrors");return t!=null?String(t):null},getPerfLoggerProvider:function(){var e=n();return e?e.getPerfLoggerProvider():null},getRepresentationCaptionsExpectedFromManifest:function(){var e,t=(e=n())==null?void 0:e.getMpd();return!!(t!=null&&t.getCustomField("hasVTTRepresentationCaptions"))},getStreamType:function(){return"dash"},getTargetAudioTrack:function(){var e=n();return e?m(e):null},getUserSelectedVideoQuality:function(){var e=n();return e?d(e):""},getUserSelectedVideoVariant:function(){var e,t=n();return(e=t==null?void 0:t.getTargetVideoVariant())!=null?e:null},getVideoProjectionType:function(){var e=n();return e!=null?p(e):null},getVideoRepresentations:function(){var e,t;return(e=(t=n())==null||(t=t.getMpd())==null?void 0:t.getVideoRepresentations())!=null?e:null},isDrm:function(){var e;return!!((e=n())!=null&&e.isDrm())},isFBIsLiveTemplated:function(){var e,t=(e=n())==null?void 0:e.getMpd();return!!(t!=null&&t.getCustomField("isLiveTemplated"))},isFBMS:function(){var e,t=(e=n())==null?void 0:e.getMpd();return!!(t!=null&&t.getCustomField("isFBMS"))},isFBWasLive:function(){var e,t=(e=n())==null?void 0:e.getMpd();return!!(t!=null&&t.getCustomField("isFBWasLive"))},isLiveRewindAvailable:function(){var e,t,r=(e=(t=n())==null?void 0:t.getMpdUrl())!=null?e:"";try{var o,a;return(o=(a=new URL(r).searchParams.get("ms"))==null?void 0:a.includes("m_CT"))!=null?o:!1}catch(e){}return!1},isMixedCodecManifest:function(){var e,t,r,o,a=(e=n())==null?void 0:e.getMpd();if(a==null)return null;var i=(t=a.getVideoRepresentations())!=null?t:[],l=new Set(i.map(function(e){return/codecs=\"([^\".]+)/i.exec(e.getMimeCodecs())})),s=(r=(o=n())==null||(o=o.getMpd())==null?void 0:o.getAudioRepresentations())!=null?r:[],u=new Set(s.map(function(e){return/codecs=\"([^\".]+)/i.exec(e.getMimeCodecs())}));return l.size>1||u.size>1},isPredictiveDash:function(){var e,t,r=(e=(t=n())==null||(t=t.getMpd())==null?void 0:t.getVideoRepresentations()[0])!=null?e:null;return r!==null&&r.canPredict()},setDimensions:function(t){},setEnableLiveheadCatchup:function(t){var e=n();e!=null&&e.setEnableLiveheadCatchup(t)},setLatencyLevel:function(a){r("handleVideoPlayerLatencyLevelChange")(t(),o(),n(),a)},setUserSelectedVideoQuality:function(t){var e=n();e!=null&&_(e,t)},setUserSelectedVideoVariant:function(t){var e=n();e!=null&&t!=null&&f(e,t)}};return a}l.createVideoPlayerOzImplementationEngineExtrasAPI=g}),98);
__d("oz-player/shims/www/OzDOMEventListenerWWW",["OzDOMEventListenerImpl"],(function(t,n,r,o,a,i){"use strict";var e=n("OzDOMEventListenerImpl");i.default=e}),66);
__d("oz-player/shims/OzDOMEventListener",["oz-player/shims/www/OzDOMEventListenerWWW"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/OzDOMEventListenerWWW")}),98);
__d("oz-player/shims/www/OzSubscriptionsHandlerWWW",["SubscriptionsHandler"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("SubscriptionsHandler")}),98);
__d("oz-player/shims/OzSubscriptionsHandler",["oz-player/shims/www/OzSubscriptionsHandlerWWW"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/OzSubscriptionsHandlerWWW")}),98);
__d("oz-player/shims/www/ozThrottleWWW",["throttle"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("throttle")}),98);
__d("oz-player/shims/ozThrottle",["oz-player/shims/www/ozThrottleWWW"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/ozThrottleWWW")}),98);
__d("oz-player/strategies/OzBufferingDetectorStates",["oz-player/utils/OzBufferingUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n){this.$1=e,this.$2=t,this.$3=n}var t=e.prototype;return t.handleEvent=function(t,n,r){if(t.type==="pause"||n.paused)return new s(this.$1,this.$2);var e=this.$3 instanceof u?this.$1.getInPlayBufferOverflowTarget():this.$1.getStartBufferUnderflowTarget();return o("oz-player/utils/OzBufferingUtils").hasEnoughBuffer(n,e,r)?new u(this.$1,this.$2):this},e})(),s=(function(){function t(e,t){this.$1=e,this.$2=t}var n=t.prototype;return n.handleEvent=function(n,r,a){return n.type==="play"||n.type==="playing"||!r.paused?o("oz-player/utils/OzBufferingUtils").hasEnoughBuffer(r,this.$1.getStartBufferUnderflowTarget(),a)?new u(this.$1,this.$2):new e(this.$1,this.$2,this):this},t})(),u=(function(){function t(e,t){this.$1=e,this.$2=t,this.$3=t.getString("stream_types_eligible_for_partial_playback","").split(",")}var n=t.prototype;return n.handleEvent=function(n,r,a,i){return i===void 0&&(i=new Map),n.type==="pause"||r.paused?new s(this.$1,this.$2):!o("oz-player/utils/OzBufferingUtils").hasEnoughBuffer(r,this.$1.getInPlayBufferUnderflowTarget(),a)&&!this.$4(n,r.currentTime,i)?new e(this.$1,this.$2,this):this},n.$4=function(t,n,r){return t.type==="waiting"?!1:o("oz-player/utils/OzBufferingUtils").hasEnoughPartialBuffer(n,r,this.$3,this.$2.getNumber("partial_playback_buffer_overflow",0))},t})();l.OzVideoBufferingState=e,l.OzVideoPausedState=s,l.OzVideoPlayingState=u}),98);
__d("oz-player/strategies/OzBufferingStateThresholdManager",["oz-player/shims/OzPerformance","oz-player/utils/OzBufferingUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$2=!1,this.$3=-1/0,this.$4=-1/0,this.$1=e}var t=e.prototype;return t.getInPlayBufferUnderflowTarget=function(){return this.$1.getNumber("in_play_buffer_underflow_target",o("oz-player/utils/OzBufferingUtils").BUFFER_UNDERFLOW_THRESHOLD)},t.getInPlayBufferOverflowTarget=function(){return this.$5()?this.$1.getNumber("stream_interrupt_in_play_buffer_overflow_target",o("oz-player/utils/OzBufferingUtils").BUFFER_UNDERFLOW_THRESHOLD):r("oz-player/shims/OzPerformance").now()-this.$4<this.$1.getNumber("recent_buffer_timeout_ms",0)?this.$1.getNumber("recent_buffer_in_play_buffer_overflow_target",o("oz-player/utils/OzBufferingUtils").BUFFER_UNDERFLOW_THRESHOLD):this.$1.getNumber("in_play_buffer_overflow_target",o("oz-player/utils/OzBufferingUtils").BUFFER_OVERFLOW_THRESHOLD)},t.getStartBufferUnderflowTarget=function(){return this.$1.getNumber("start_buffer_underflow_target",o("oz-player/utils/OzBufferingUtils").BUFFER_UNDERFLOW_THRESHOLD)},t.notifyBufferingEnd=function(){this.$4=r("oz-player/shims/OzPerformance").now()},t.notifyStreamInterrupted=function(){this.$2=!0},t.notifyStreamResumed=function(){this.$2=!1,this.$3=r("oz-player/shims/OzPerformance").now()},t.$5=function(){var e=this.$1.getNumber("stream_interrupt_buffer_target_timeout_ms",0);return e===0?!1:this.$2||r("oz-player/shims/OzPerformance").now()-this.$3<e},e})();l.default=e}),98);
__d("oz-player/strategies/OzBufferingDetector",["oz-player/shims/OzDOMEventListener","oz-player/shims/OzEventEmitter","oz-player/shims/OzSubscriptionsHandler","oz-player/shims/ozThrottle","oz-player/strategies/OzBufferingDetectorStates","oz-player/strategies/OzBufferingStateThresholdManager","oz-player/utils/OzBufferingUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=150,s=(function(t){function n(n,a,i){var l;return l=t.call(this)||this,l.$OzBufferingDetector$p_3=new(r("oz-player/shims/OzSubscriptionsHandler")),l.$OzBufferingDetector$p_6=new Map,l.$OzBufferingDetector$p_8=null,l.$OzBufferingDetector$p_9=function(e){l.$OzBufferingDetector$p_11(e)},l.$OzBufferingDetector$p_2=n,l.$OzBufferingDetector$p_4=a,l.$OzBufferingDetector$p_5=i,l.$OzBufferingDetector$p_7=new(r("oz-player/strategies/OzBufferingStateThresholdManager"))(a),l.$OzBufferingDetector$p_2.paused?l.$OzBufferingDetector$p_1=new(o("oz-player/strategies/OzBufferingDetectorStates")).OzVideoPausedState(l.$OzBufferingDetector$p_7,l.$OzBufferingDetector$p_4):l.$OzBufferingDetector$p_1=o("oz-player/utils/OzBufferingUtils").hasEnoughBuffer(l.$OzBufferingDetector$p_2,l.$OzBufferingDetector$p_7.getInPlayBufferUnderflowTarget(),l.$OzBufferingDetector$p_5())?new(o("oz-player/strategies/OzBufferingDetectorStates")).OzVideoPlayingState(l.$OzBufferingDetector$p_7,l.$OzBufferingDetector$p_4):new(o("oz-player/strategies/OzBufferingDetectorStates")).OzVideoBufferingState(l.$OzBufferingDetector$p_7,l.$OzBufferingDetector$p_4,null),l.$OzBufferingDetector$p_3.addSubscriptions(r("oz-player/shims/OzDOMEventListener").listenDOMEvent(l.$OzBufferingDetector$p_2,"pause",l.$OzBufferingDetector$p_9),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(l.$OzBufferingDetector$p_2,"play",l.$OzBufferingDetector$p_9),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(l.$OzBufferingDetector$p_2,"progress",r("oz-player/shims/ozThrottle")(l.$OzBufferingDetector$p_9,e)),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(l.$OzBufferingDetector$p_2,"timeupdate",r("oz-player/shims/ozThrottle")(l.$OzBufferingDetector$p_9,e)),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(l.$OzBufferingDetector$p_2,"seeked",l.$OzBufferingDetector$p_9),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(l.$OzBufferingDetector$p_2,"seeking",l.$OzBufferingDetector$p_9),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(l.$OzBufferingDetector$p_2,"waiting",l.$OzBufferingDetector$p_9)),l.$OzBufferingDetector$p_3.addSubscriptions(r("oz-player/shims/OzDOMEventListener").listenDOMEvent(l.$OzBufferingDetector$p_2,"canplay",l.$OzBufferingDetector$p_9),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(l.$OzBufferingDetector$p_2,"canplaythrough",l.$OzBufferingDetector$p_9)),l}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.$OzBufferingDetector$p_10=function(){var e=this,t="unavailable",n=this.$OzBufferingDetector$p_7.getInPlayBufferUnderflowTarget();return this.$OzBufferingDetector$p_6.forEach(function(r,a){var i=e.$OzBufferingDetector$p_2.currentTime;o("oz-player/utils/OzBufferingUtils").hasBuffer(i,n,r)||(t=t==="unavailable"?a:"audio/video")}),t},a.setSourceBufferState=function(t,n){this.$OzBufferingDetector$p_6.set(t,n)},a.$OzBufferingDetector$p_11=function(t){var e=this.$OzBufferingDetector$p_1.handleEvent(t,this.$OzBufferingDetector$p_2,this.$OzBufferingDetector$p_5(),this.$OzBufferingDetector$p_6),n=this.$OzBufferingDetector$p_1;this.$OzBufferingDetector$p_1=e;var r=e instanceof o("oz-player/strategies/OzBufferingDetectorStates").OzVideoBufferingState,a=n instanceof o("oz-player/strategies/OzBufferingDetectorStates").OzVideoBufferingState;if(e===n)return r&&this.$OzBufferingDetector$p_8&&this.$OzBufferingDetector$p_8.cloneContext().getOperationLogger("buffering_handle_event").setInitiator(t.type).log(),e;if(r){var i=n instanceof o("oz-player/strategies/OzBufferingDetectorStates").OzVideoPlayingState?"in_play":"start/unpause";this.$OzBufferingDetector$p_8&&this.$OzBufferingDetector$p_8.cloneContext().getOperationLogger("enter_buffering").setState("buffering").setType(i).setReason(this.$OzBufferingDetector$p_10()).setInitiator(t.type).log(),this.emit("enterBuffering",i)}else a&&(this.$OzBufferingDetector$p_8&&this.$OzBufferingDetector$p_8.cloneContext().getOperationLogger("leave_buffering").setInitiator(t.type).log(),this.$OzBufferingDetector$p_7.notifyBufferingEnd(),this.emit("leaveBuffering",{domEventPerfTimestamp:t.timeStamp}));return e},a.notifyStreamInterrupted=function(){this.$OzBufferingDetector$p_7.notifyStreamInterrupted()},a.notifyStreamResumed=function(){this.$OzBufferingDetector$p_7.notifyStreamResumed()},a.attachPerfLoggerProvider=function(t){this.$OzBufferingDetector$p_8=t},a.destroy=function(){this.$OzBufferingDetector$p_3.release()},n})(r("oz-player/shims/OzEventEmitter"));l.default=s}),98);
__d("VideoPlayerOzImplementationEnginePartsImplUtils",["OzSystemicRiskABRManager","OzWidevineDrmProvider","cr:2964","gkx","justknobx","oz-player/networks/OzBandwidthEstimator","oz-player/strategies/OzBufferingDetector"],(function(t,n,r,o,a,i,l){"use strict";var e=/(livestream-)?lookaside\.(facebook|workplace)\.com$/;function s(t){return e.test(t.getDomain())}function u(e,t,n,o,a,i){if(a.current==null){var l=!0,s=function(){if(l)return!1;var e=a.current!==u;return!1},u=new(r("oz-player/strategies/OzBufferingDetector"))(e,n,function(){var e=o.getCurrentState(),n=e.controlledState;return n.streamEnded?t.getDuration():1/0});a.current=u,l=!1;var c=function(t){if(!s()){o.dispatch({payload:{bufferingType:t},type:"buffering_begin_requested"});var e=n.getNumber("ull_fallback_stall_count",0);if(e>0){var r=i.getLoggerState().stallCountTotal;n.getBool("fix_ull_fallback_stall_count",!1)&&(r=i.getLoggerState().inPlayStallCount200ms),o.getCurrentState().controlledState.latencyLevel==="ultra-low"&&r>e&&o.dispatch({payload:{latencyLevel:"low",ullIneligibilityReason:null},type:"implementation_set_latency_level_requested"})}}},d=function(t){s()||o.dispatch({payload:{domEventPerfTimestamp:t.domEventPerfTimestamp},type:"buffering_end_requested"})};u.addListener("enterBuffering",c),u.addListener("leaveBuffering",d)}}function c(e){var t=e.accessToken,n=e.graphQLVideoDRMInfo,o=e.videoFBID,a=[];if(n&&o!=null){var i=r("justknobx")._("717")?null:n.widevineCert;a.push(new(r("OzWidevineDrmProvider"))(o,n.graphApiVideoLicenseUri,n.videoLicenseUriMap,t,i!=null?i:null))}return a}function d(e){var t=e.VideoPlayerShakaPerformanceLoggerClass,n=e.accessToken,r=e.disableLogging,o=e.getApproximateFBLSToPlayerDisplayLatency,a=e.getBandwidthEstimate,i=e.getPlayerDimensions,l=e.getPlayerFormat,s=e.playbackIsLiveStreaming,u=e.playerInstanceCount,c=e.playerInstanceKey,d=e.playerSuborigin,m=e.playerVersion,p=e.videoElement,_=e.videoFBID,f=e.videoPlayerShakaPerformanceLoggerBuilder;if(r||!f&&(!t||!t.shouldInitialize()))return[];var g={accessToken:n,getApproximateFBLSToPlayerDisplayLatency:o,getBandwidthEstimate:a,getPlayerDimensions:i,getPlayerFormat:l,isLive:s,isServableViaFbms:!1,playerInstanceCount:u,playerOrigin:null,playerSuborigin:d,playerVersion:m,representationId:null,uniqueID:c,video:p,videoID:_!=null?_:""};return f!=null?[f.build(g)]:t?[new t(g)]:[]}function m(e,t){return t>0?t/1e3*-1:e.getNumber("live_initial_playback_position",0)}function p(e,t,n){return t>0&&n>0?(t+n)/1e3:e.getNumber("livehead_fall_behind_block_threshold",0)}function _(e,t){return t>0?t/2/1e3:e.getNumber("live_time_range_block_margin",0)}function f(e){return function(t,o,a,i,l,s,u,c,d){return!e&&n("cr:2964")!=null?new(n("cr:2964"))(t,o,a,i,l,s,u,c,d):t.getLegacyConfig().getBool("use_systemic_risk_abr",!1)?new(r("OzSystemicRiskABRManager"))(t,o,a,i,l,s,u,c,d):null}}function g(e,t){var n=t.experimentationConfig,o=t.getCurrentVideoRepresentation,a=t.getOzCDNSignedQueryParams,i=t.isClientTriggeredTraceEnabled,l=t.playbackIsLiveStreaming,s=t.playbackSessionId,u=t.shouldRefresh403,c=e.getQueryData(),d;if(l&&(d={},n.getBool("server_side_abr_send_client_estimates",!1))){var m=r("oz-player/networks/OzBandwidthEstimator").getBandwidthDiagnostics(n);m&&(d=babelHelpers.extends({},d,{_nc_bwe:String(m.bandwidthEstimate),_nc_bwe_std:String(m.bandwidthStandardDeviation),_nc_ttfb:String(m.timeToFirstByteMsEstimate),_nc_ttfb_std:String(m.timeToFirstByteMsStandardDeviation)}));var p=o();p&&(d=babelHelpers.extends({},d,{_nc_abr_bitrate:String(p.getBandwidth()),_nc_abr_qlabel:p.getDisplayLabel()}))}var _=n.getNumber("live_video_chunk_duration",0),f=n.getBool("use_bandwidth_estimate_from_headers_in_abr",!1),g=f?r("oz-player/networks/OzBandwidthEstimator").hasRecentBandwidthEstimateFromHeader():!1;if(l&&_>0&&g&&(d=babelHelpers.extends({},d,{chk_dur:_.toString(10)})),r("gkx")("24354")&&c.uss!=null&&c.odm!=null&&(d=babelHelpers.extends({},d,{manual_redirect:"1"})),i&&(d=babelHelpers.extends({},d,{_nc_psid:s})),u){var h=a();if(h!=null){var y=e.getDomain()+e.getPath(),C=h.get(y);if(C!=null)for(var b in C){var v;d=babelHelpers.extends({},d,(v={},v[b]=C[b],v))}}}return d}l.checkShouldIncludeCredentials=s,l.createOzBufferingDetector=u,l.createOzDrmProviders=c,l.createOzPerfLoggerProviders=d,l.calculateInitialPlaybackPositionForDynamicMpd=m,l.calculateLiveheadFallBehindBlockThreshold=p,l.calculateLiveheadFallBehindBlockMargin=_,l.getVideoAbrManagerFactory=f,l.getCustomRequestParametersForURI=g}),98);
__d("getOzPlaybackRestrictions",["OzMinimumSmallestDimensionRestriction","OzMosThresholdRestriction","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=[];switch(e){case"HD":n.push(new(r("OzMinimumSmallestDimensionRestriction"))(720));break;case"UHD":r("gkx")("24263")&&n.push(new(r("OzMinimumSmallestDimensionRestriction"))(1080));break;default:break}var o=t.getNumber("mos_upper_threshold",0),a=t.getNumber("mos_lower_threshold",0);return(o>0||a>0)&&n.push(new(r("OzMosThresholdRestriction"))(t)),n}l.default=e}),98);
__d("oz-player/configs/OzPlayerConfigDefaults",[],(function(t,n,r,o,a,i){var e={bandwidth_ignore_on_stream_write_samples:!1,bandwidth_use_response_time_adjustment:!1,catchup_use_timeline_range_end_time_as_end:!1,clear_on_seek:!0,debug_live_replay:!1,do_not_end_stream:!1,enable_abr_logging:!1,enable_alternative_audio_tracks:!1,enable_lip_sync_abr_select_quality:!1,enable_managed_media_source:!1,enable_revoke_object_url_on_destroy:!1,fix_live_rewind_user_selected_playback_speed:!0,ignore_reset_after_seek_if_bufferahead:!1,latencymanager_stalled_edgelatency_sec_on:!1,msm_refactor_wait_for_sourceopen:!1,ms_promise_for_null:!1,no_rep_to_switch_fallback_progressive:!1,normalize_mpd_fetch_errors:!0,parse_number_templated_uri:!0,pdash_use_pdash_segmentlocator:!1,playback_speed_latency_adjustment_disabled:!1,player_emit_mpdparsed_early:!1,playhead_manager_buffered_timerange_update_on_timeupdate:!0,playhead_manager_clamp_initial_playback_position:!1,reset_catchup_timeout_after_play_sec_on_overwrite:!0,retry_video_element_error:!0,sidx_parser_memory_optimization:!0,skip_videobuffer_gaps:!0,skip_videobuffer_gaps_on_buffer_updated:!0,use_live_latency_manager:!1,use_scf_timebased_segments:!1,video_cdn_url_refresh:!1,vtt_caption_representation:!0},l={abr_confidence_threshold:.9,abr_eval_buffer_threshold:0,abr_min_bandwidth_samples:0,abr_prevent_down_switch_buffer_threshold:11,abr_restrict_from_index:0,abr_restrict_to_index:0,append_byte_target_without_range:1e5,appends_per_segment:6,auto_seek_playhead_slack:.5,bandwidth_boundary_standard_deviation_factor:1,bandwidth_estimator_half_life:6,bandwidth_estimator_outlier_exclusion_factor:50,bandwidth_estimator_std_dev_penalty_factor:0,bandwidth_header_expire_threshold:0,bandwidth_response_time_handicap:0,bandwidth_ttfb_samples_to_save:5,buffer_ahead_target:22,buffer_target_constraint_append_succeeded_reward:.2,buffer_target_constraint_minimum_sec:2,buffer_target_constraint_quota_exceeded_penalty:.3,byte_count_per_sample:2e5,catchup_timeout_after_buffering_sec:0,catchup_timeout_after_play_sec:0,clear_buffer_around_playhead_boundary_ms:5e3,clear_buffer_on_seek_epsilon_s:0,clear_buffer_on_seek_nudge_s:0,default_bandwidth_estimate:1e6,download_cursor_buffer_ahead_time_max_sec:0,download_cursor_total_buffer_max_sec:0,dvl_initial_segment_ignore_count:1,dvl_update_interval_ms:0,dynamic_mpd_initial_playback_position_offset_modifier:4,initial_manifest_request_retry_count:3,initial_switch_interval:0,in_play_buffer_overflow_target:1,in_play_buffer_underflow_target:.1,latencymanager_stalled_edgelatency_sec:0,live_audio_ibr_bandwidth_percentage:.05,live_numerical_error_epsilon:1e-4,loop_body_handle_error_interval_ms:1,low_buffer_bandwidth_target_increase_factor:0,low_buffer_bandwidth_target_threshold:10,low_segment_stream_playhead_threshold:0,manifest_initial_update_delay_ms:0,manifest_update_frequency_ms:0,max_bandwidth_sample_count:30,maximum_bandwidth_sample_bandwidth:1e8,max_start_eme_attempts:3,min_eval_interval:100,minimum_bandwidth_sample_duration:10,minimum_bytes_to_sample_on_close:25e3,min_switch_interval:100,mpd_updater_network_request_timeout_ms:2e4,ms_promise_for_null_ms:0,network_seg_timeout_ms:0,overwrite_livehead_fall_behind_block_threshold:0,overwrite_live_time_range_block_margin:0,partial_playback_buffer_overflow:.75,paused_stream_segments_count:2,pdash_download_cursor_between_catchups_seg:0,pdash_download_cursor_catchup_threshold_gop_multiplier:0,pdash_download_cursor_catchup_threshold_sec:0,pdash_download_cursor_catchup_tolerance_sec:0,per_stream_duration_target:0,pixels_above_viewport_to_observe:0,pixels_below_viewport_to_observe:0,playback_speed_enabled_delay_sec:4,playback_speed_latency_adjustment_rate:0,playback_speed_latency_slowdown_adjustment_rate:0,playback_speed_latency_speedup_adjustment_rate:0,playback_speed_min_buffer_sec:1,playback_speed_min_duration_sec:2,playback_speed_min_sharpness_factor:3,playback_speed_restore_min_duration_sec:1,playhead_manager_buffered_auto_seek_playhead_slack:.5,playhead_manager_buffered_is_near_gap_threshold:1.5,playhead_manager_buffered_numerical_error:.01,playhead_manager_timeupdate_throttle_ms:1e3,pre_start_buffer_ahead_target:16.924449682236,prioritize_by_viewport_static_penalty:0,recent_buffer_in_play_buffer_overflow_target:3,recent_buffer_timeout_ms:1e4,resolution_constraint_factor:2,seconds_to_stream:10,seconds_to_stream_near_bandwidth_boundary:10,seek_ahead_epsilon:.05,segments_to_stream:5,segments_to_stream_near_bandwidth_boundary:5,segments_to_stream_under_playhead_threshold:0,sidx_segment_retry_attempts:9999,sidx_segment_retry_interval_ms:100,skip_videobuffer_gaps_max_gap_size_sec:0,stale_mpd_buffer_ahead_target:0,start_buffer_underflow_target:.1,steadystate_minbuffer_buckets:0,steadystate_minbuffer_buckets_sec:1,steadystate_minbuffer_sec:0,stream_interrupt_buffer_target_timeout_ms:1e4,stream_interrupt_check_mpd_stale_count_threshold:6,stream_interrupt_in_play_buffer_overflow_target:1,stream_reader_max_buffer_len:0,timeline_offset_threshold:10,time_to_first_byte_estimate_half_life_ms:500,time_to_first_byte_ignore_above_threshold_ms:0},s={bandwidth_estimate_header_key:"",bandwidth_estimate_key:"",block_representation_status_codes_json:"[500, 503]",block_representation_status_codes_temporarily_json:"{}",cdn_experiment_id:"",stream_types_eligible_for_partial_playback:""};a.exports={defaultBools:e,defaultNumbers:l,defaultStrings:s}}),null);
__d("oz-player/configs/OzPlayerConfig",["oz-player/configs/OzPlayerConfigDefaults"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){e===void 0&&(e={}),this.$1=e}var t=e.prototype;return t.getBool=function(t){return typeof this.$1[t]=="boolean"?this.$1[t]:o("oz-player/configs/OzPlayerConfigDefaults").defaultBools[t]},t.getNumber=function(t){return typeof this.$1[t]=="number"?this.$1[t]:o("oz-player/configs/OzPlayerConfigDefaults").defaultNumbers[t]},t.getString=function(t){return typeof this.$1[t]=="string"?this.$1[t]:o("oz-player/configs/OzPlayerConfigDefaults").defaultStrings[t]},t.getLegacyConfig=function(){var e=this;return{getBool:function(n,r){var t;return typeof e.$1[n]=="boolean"?e.$1[n]:(t=o("oz-player/configs/OzPlayerConfigDefaults").defaultBools[n])!=null?t:r},getNumber:function(n,r){var t;return typeof e.$1[n]=="number"?e.$1[n]:(t=o("oz-player/configs/OzPlayerConfigDefaults").defaultNumbers[n])!=null?t:r},getString:function(n,r){var t;return typeof e.$1[n]=="string"?e.$1[n]:(t=o("oz-player/configs/OzPlayerConfigDefaults").defaultStrings[n])!=null?t:r}}},e})();l.default=e}),98);
__d("oz-player/configs/OzConfigUtils",["oz-player/configs/OzPlayerConfig"],(function(t,n,r,o,a,i,l){"use strict";var e=new(r("oz-player/configs/OzPlayerConfig")),s=function(n){return{getBool:function(r){return n.getBool(r,e.getBool(r))},getNumber:function(r){return n.getNumber(r,e.getNumber(r))},getString:function(r){return n.getString(r,e.getString(r))},getLegacyConfig:function(){return n}}};l.provideConfigWithDefaults=s}),98);
__d("oz-player/networks/OzClientClock",["oz-player/shims/OzPerformance","oz-player/utils/OzResourceTimingUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(e!==null){var t=parseInt(e,10);if(!isNaN(t))return t}return null}var s=(function(){function t(){this.$1=null,this.$2=0,this.$2=Date.now()-r("oz-player/shims/OzPerformance").now()}var n=t.prototype;return n.updateOffsetFromHeaderResponse=function(n,r){var t=e(r.get("x-fb-dynamic-server-wallclock-ms")),a=e(r.get("x-fb-dynamic-rtt-ms")),i=o("oz-player/utils/OzResourceTimingUtils").getLatestResourceTimingEntry(n);if(t!==null&&a!==null&&i!=null&&i.responseStart>0&&i.duration>10){var l=i.requestStart+this.$2,s=t-l-a/2;this.$1=s}},n.now=function(){var e;return r("oz-player/shims/OzPerformance").now()+this.$2+((e=this.$1)!=null?e:0)},n.getClientClockOffsetMs=function(){return this.$1},t})(),u=new s;l.default=u}),98);
__d("oz-player/networks/OzClockSyncNetworkRequestStreamHandler",["oz-player/networks/OzClientClock","oz-player/networks/OzTransformStream"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){}var t=e.prototype;return t.onResponse=function(t,n){var e=t.headers;if(!e)return null;var o=new(r("oz-player/networks/OzTransformStream"));return o.addListener("writableClose",function(){r("oz-player/networks/OzClientClock").updateOffsetFromHeaderResponse(n,e)}),o},t.onError=function(t,n){return null},e})();l.default=e}),98);
__d("VideoPlayerOzImplementationEnginePartsImplFunction",["CometThrottle","ConstUriUtils","Deferred","FBLogger","JSResourceForInteraction","NetworkStatus","OzActiveActiveFailoverNetworkRequestStreamHandler","OzBufferVTTCaptionsVisibleStrategy","OzCDNSignedQueryParams","OzCustomParsers","OzCustomRepresentationParsers","OzOneSemanticHandler","OzOneSemanticHandlerUtils","OzPredictedSegmentTimelineParser","OzVideoLiveTraceNetworkRequestStreamHandler","Promise","QE2Logger","TimeRanges","VideoPlayerConnectionQuality","VideoPlayerImplementationErrors","VideoPlayerODS","VideoPlayerOzImplementationEnginePartsImplUtils","clearTimeout","cr:1836099","cr:1871597","cr:1947728","cr:1993377","getErrorSafe","getOzPlaybackRestrictions","gkx","justknobx","md5","oz-player/configs/OzConfigUtils","oz-player/networks/OzBandwidthEstimator","oz-player/networks/OzClockSyncNetworkRequestStreamHandler","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("JSResourceForInteraction")("VideoPlayerEmsg").__setRef("VideoPlayerOzImplementationEnginePartsImplFunction"),u=1e4,c=null,d=null;n("cr:1836099")&&(c=n("cr:1836099").getHiveConfig(),d=n("cr:1836099").HiveOz);function m(t){var a,i,l=t.OzPlayerClass,m=t.callChain,p=t.destroyOzPlayerPartsRef,_=t.engineDebugAPI,f=t.engineExtrasAPI,g=t.getCaptionsInfo,h=t.getLatencyLevelManager,y=t.getVideoLiveTrace,C=t.handleCaptionsInfoChange,b=t.handleFatalImplementationError,v=t.hivePluginRef,S=t.initialProps,R=t.initiateLivePlaybackFromStart,L=t.loggerToVPL,E=t.machine,k=t.overrideOzRequestImplementationRef,I=t.ozBufferingDetectorRef,T=t.ozPlayerRef,D=t.p2pSessionLoggerRef,x=t.playerFormatForDPLRef,$=t.playerVersion,P=t.resolvedVideoInfo,N=t.videoElement,M=t.videoElementAPI,w={current:!1},A={current:null},F={current:null};p.current=function(t){var e=I.current;e&&(I.current=null,e.destroy());var n=T.current;if(n){_&&_.handleOzPlayerChanged(null,M),T.current=null;try{n.destroy([].concat(t,["destroyOzPlayerParts"]).join(":")).catch(function(e){var t=r("getErrorSafe")(e);r("FBLogger")("comet_video_player").catching(t).mustfix("Error in ozPlayer.destroy (async): %s",t.message)})}catch(e){var o=r("getErrorSafe")(e);r("FBLogger")("comet_video_player").catching(o).mustfix("Error in ozPlayer.destroy: %s",o.message)}}var a=A.current;a&&(A.current=null,a()),F.current&&(F.current=null),Ue(),v.current!=null&&(v.current=null),D.current&&(D.current=null),k.current&&(k.current=null)};var O=P.accessToken,B=P.audioOnly,W=P.experimentationConfig,q=P.graphQLVideoDRMInfo,U=P.graphQLVideoP2PSettings,V=P.manifestUrl,H=P.manifestXmlStringResolved,G=P.minQualityPreference,z=P.ozPrefetchCache,j=P.videoFBID,K=S.coreVideoPlayerMetaData.loggingConfig,Q=K.disableLogging===!0?null:P.VideoPlayerShakaPerformanceLoggerClass,X=!!S.coreVideoPlayerMetaData.isLiveStreaming,Y=!!((a=S.coreVideoPlayerMetaData.isClientTriggeredTraceEnabled)!=null&&a),J=function(t){return f.getEstimatedBandwidth()},Z=function(){return f.getApproximateFBLSToPlayerDisplayLatency()},ee=function(){W.setContext("connection_quality",o("VideoPlayerConnectionQuality").evaluate(function(){return J(X)}))},te=function(){var e=W.getNumber("connection_quality_context_throttle_frequency",0);if(e===0)return null;var t=r("CometThrottle")(ee,e),n=r("oz-player/networks/OzBandwidthEstimator").addListener("bandwidth_sampled",t);return function(){n.remove(),t.cancel()}};A.current=te();var ne=o("VideoPlayerOzImplementationEnginePartsImplUtils").createOzDrmProviders({accessToken:O,graphQLVideoDRMInfo:q,videoFBID:j}),re=function(){return E.getCurrentState().controlledState.captionsVisible},oe=[];W.getBool("use_vtt_captions_visible_buffer_strategy",!0)&&oe.push(new(r("OzBufferVTTCaptionsVisibleStrategy"))(re));var ae=function(){return E.getCurrentState().controlledState.dimensions},ie=function(){var e;return(e=x.current)!=null?e:"unknown"},le=o("VideoPlayerOzImplementationEnginePartsImplUtils").createOzPerfLoggerProviders({VideoPlayerShakaPerformanceLoggerClass:Q,accessToken:O,disableLogging:K.disableLogging===!0,getApproximateFBLSToPlayerDisplayLatency:Z,getBandwidthEstimate:J,getPlayerDimensions:ae,getPlayerFormat:ie,playbackIsLiveStreaming:X,playerInstanceCount:S.loggingMetaData.playerImplementationInstanceCountRef.current,playerInstanceKey:S.loggingMetaData.instanceKey,playerSuborigin:S.coreVideoPlayerMetaData.subOrigin,playerVersion:$,videoElement:N,videoFBID:j,videoPlayerShakaPerformanceLoggerBuilder:P.videoPlayerShakaPerformanceLoggerBuilder});if(F.current==null&&(F.current=new(r("OzCDNSignedQueryParams"))),U&&j!=null){var se,ue=U.community_info,ce=U.config,de=U.hive_initialization_options,me=D.current=(se=D.current)!=null?se:n("cr:1871597")?new(n("cr:1871597"))(j,ue):null;try{if(v.current==null){me&&me.logEnableP2P();var pe=function(t){D.current&&D.current.logHiveError(t)},_e=function(t){var e=T.current;e&&e.injectExternalDebugEvent("P2PTech",t.tech),D.current&&D.current.logSessionActive(t.tech)},fe=function(t){var e=T.current;e&&e.injectExternalDebugEvent("P2PStats",t),D.current&&D.current.setCurrentHiveStats(t)},ge=function(t){var e=t.state,n=E.getCurrentState(),r=n.controlledState,o=r.playbackState;if(v.current!=null&&e==="CLOSED"){Ue();var a=T.current;a&&o!=="ended"&&(w.current&&V!=null?a.updatePlayerRunTimeConfig({manifestUrl:V}):a.load(V))}},he={HiveJava:{},HiveJS:{maximumTrimming:{dash:void 0,hls:void 0},renderStatsCallback:fe},debugLevel:"off",hiveTechOrder:["HiveJS","StatsJS","HiveJava"],onActiveSession:_e,onError:pe,onSessionStateChange:ge,telemetryId:me?me.getSessionID():0},ye=W.getNumber("hive_maximum_trimming_seconds",0);if(ye>0&&(he.HiveJS.maximumTrimming={dash:ye,hls:ye}),de){var Ce=de.HiveJava,be=de.debugLevel,ve=de.hiveTechOrder;he.hiveTechOrder=ve.slice(),he.HiveJava=Ce?{minVersion:Ce.minVersion}:{},he.debugLevel=be!=null?be:he.debugLevel}if(ce.disable_hivejava_for_livevc===!0&&V!=null&&V.startsWith("https://livestream-lookaside")){var Se=he.hiveTechOrder.indexOf("HiveJava");Se>=0&&he.hiveTechOrder.splice(Se,1)}if(c)c.SensitiveInfo.restrictedConnectivityInfo=!0;else throw r("FBLogger")("comet_video_player").mustfixThrow("HiveConfig does not exist");if(d)v.current=new d(he);else throw r("FBLogger")("comet_video_player").mustfixThrow("HiveOz does not exist");if(v.current!=null){if(!n("cr:1947728"))throw r("FBLogger")("comet_video_player").mustfixThrow("OzConfigurableRequestImplementation does not exist");k.current=n("cr:1947728")(v.current.getRequestImplementation(),{inferResponseStatusIsOK:!0,inferResponseStatusIsOk2xx:!1})}}}catch(e){var Re=r("getErrorSafe")(e);me&&me.logError(Re),Ue()}}var Le=[new(r("OzVideoLiveTraceNetworkRequestStreamHandler"))(function(e,t,n){var r=y();r!=null&&r.handleHeadersAndBody(e,t,n)},W.getBool("live_trace_parse_emsg",!1)),new(r("oz-player/networks/OzClockSyncNetworkRequestStreamHandler"))];r("OzActiveActiveFailoverNetworkRequestStreamHandler")&&Le.push(new(r("OzActiveActiveFailoverNetworkRequestStreamHandler"))(function(e,t){var n=T.current,r=e.headers;if(n&&r){var a=parseInt(r.get("x-fb-video-replica"),10);L.logVPLEvent({eventType:"replica_switch",logDataOverrides:{error_code:e.status.toString(),error_user_info:JSON.stringify({failover_response_code:e.status.toString(),replica:a,url:t})},state:E.getCurrentState()});var i=n.getMpdUrl();if(i!=null){var l=o("ConstUriUtils").getUri(i);if(l){var s=l.addQueryParam("replica",a);s&&(Ue(),n.updatePlayerRunTimeConfig({manifestUrl:s.toString(),resetStreamAnchor:!0}))}}}}));var Ee=S.coreVideoPlayerMetaData.expiredVideoUrlRefreshHandler,ke=S.loggingMetaData.instanceKey,Ie=r("gkx")("24353"),Te=r("gkx")("24354")||r("gkx")("24355"),De=X?Ie:Te,xe=r("gkx")("4927");W.getBool("log_exposure_on_oz_initialization",!1)&&o("QE2Logger").logExposureForUser("www_videos_html5_mpeg_dash");var $e={audioOnly:B!=null?B:!1,bufferEndLimit:S.coreVideoPlayerMetaData.bufferEndLimit!=null?S.coreVideoPlayerMetaData.bufferEndLimit:null,bufferingDetector:(i=I.current)!=null?i:void 0,config:o("oz-player/configs/OzConfigUtils").provideConfigWithDefaults(W),configureCustomRequestParametersForSegment:function(t){var e=null;if(X&&Y){var n=t.getByteRange(),o=n?n.startByte+", "+(n.endByte!=null?n.endByte:"null"):"null",a=r("md5")(t.getURI().toString()+o);e=e!=null?e:{},a!=null&&(e=babelHelpers.extends({},e,{_nc_tsid:a})),e=babelHelpers.extends({},e,{_nc_e2e:"live"})}return e},customParsers:o("OzCustomParsers").createOzCustomParser(),customRepresentationParsers:o("OzCustomRepresentationParsers").createOzCustomRepresentationParsers({ozConfig:W}),customSegmentTimelineParser:W.getBool("enable_predictive_dash",!1)?new(r("OzPredictedSegmentTimelineParser")):void 0,customVTTBufferTargetStrategies:oe,debugCreateInitiator:[].concat(m,["proceedWithOzPlayerCreation"]).join(":"),drmProviders:ne,getCustomRequestParametersForURI:function(t){return o("VideoPlayerOzImplementationEnginePartsImplUtils").getCustomRequestParametersForURI(t,{experimentationConfig:W,getCurrentVideoRepresentation:function(){var e=T.current;return e==null?void 0:e.getCurrentVideoRepresentation()},getOzCDNSignedQueryParams:function(){return F.current},isClientTriggeredTraceEnabled:Y,playbackIsLiveStreaming:X,playbackSessionId:ke,shouldRefresh403:De})},getOverrideOzRequestImplementation:function(){return k.current},getShouldIncludeCredentials:W.getBool("use_oz_credentials_provider",!1)?o("VideoPlayerOzImplementationEnginePartsImplUtils").checkShouldIncludeCredentials:null,getUserSelectedPlaybackRate:function(){return E.getCurrentState().controlledState.targetPlaybackRate},getVideoDimensions:ae,initialPlaybackPositionForDynamicMpd:o("VideoPlayerOzImplementationEnginePartsImplUtils").calculateInitialPlaybackPositionForDynamicMpd(W,S.coreVideoPlayerMetaData.desiredLatencyMs),initialRepresentationIDs:S.coreVideoPlayerMetaData.initialRepresentationIds,initiateLivePlaybackFromStart:R,isClientTriggeredTraceEnabled:Y,liveheadFallBehindBlockMargin:o("VideoPlayerOzImplementationEnginePartsImplUtils").calculateLiveheadFallBehindBlockMargin(W,S.coreVideoPlayerMetaData.desiredLatencyMs),liveheadFallBehindBlockThreshold:o("VideoPlayerOzImplementationEnginePartsImplUtils").calculateLiveheadFallBehindBlockThreshold(W,S.coreVideoPlayerMetaData.desiredLatencyMs,S.coreVideoPlayerMetaData.latencyToleranceMs),loggerConfig:{isOzDevConsoleEnabled:r("gkx")("24356"),observedOperationLoggers:[],perfLoggerProviders:le},mpdUrl:V,networkRequestFetchPriority:"high",networkRequestStreamHandlers:Le,networkRequestStreamRetryHandler:De?function(t,o,a){var i=t.headers,l=i==null?void 0:i.get("x-fb-url-refresh"),s=F.current;if(t.status===403&&s!=null){L.logVPLEvent({eventType:"video_cdn_url_expired",logDataOverrides:{error_user_info:JSON.stringify({expired_url:a})},state:E.getCurrentState()});var u=l!=null&&n("cr:1993377")!=null?{name:"refreshShortExpiryVideoUrl",promise:n("cr:1993377")(l)}:Ee!=null?{name:"expiredVideoUrlRefreshHandler",promise:Ee(a)}:null;if(u!=null)return u.promise.then(function(e){var t,n,a=(t=e.refreshedUrl)!=null?t:null,i=(n=e.reason)!=null?n:null;if(a!=null&&a!=="")return L.logVPLEvent({eventType:"video_cdn_url_refreshed",logDataOverrides:{error_user_info:JSON.stringify({refresh_handler:u.name,refreshed_url:a})},state:E.getCurrentState()}),s.update(a),o(a);throw r("FBLogger")("comet_video_player").mustfixThrow("%s refreshedUrl is %s, reason: %s",u.name,a===""?"an empty string":"null",i!=null?i:"null")}).catch(function(e){var t=r("getErrorSafe")(e);throw L.logVPLEvent({eventType:"video_cdn_url_refresh_error",logDataOverrides:{error_description:t.message,error_user_info:JSON.stringify({expired_url:a,refresh_handler:u.name,refresh_url:l})},state:E.getCurrentState()}),t})}return(e||(e=n("Promise"))).resolve(t)}:null,networkRequestUrlRefreshHandler:xe?S.coreVideoPlayerMetaData.expiredVideoUrlRefreshHandler:null,prefetchCache:W.getBool("use_prefetch_cache",!1)?z:null,rawMpdXml:v.current!=null?void 0:H,seekHandler:null,setCustomFetchStreamLoggingAttributes:function(t,n,a){t.setIsOnline(r("NetworkStatus").isOnline());var e=a==null?void 0:a.headers;if(e)try{t.setProxyStatusHeader(e.get("proxy-status")),t.setDynamicStatusHeader(e.get("x-fb-dynamic-status"))}catch(e){}o("OzOneSemanticHandlerUtils").setOneSemanticFetchStreamLoggingAttributes(t,n,a)},shouldBlockStatusCode5xx:!X,startTimeStamp:W.getBool("fix_start_timestamp",!1)?S.coreVideoPlayerMetaData.startTimestamp:0,userPreferenceLang:S.initialAudioUserPreferredLanguage,videoAbrManagerFactory:o("VideoPlayerOzImplementationEnginePartsImplUtils").getVideoAbrManagerFactory(X),videoNode:N,videoPlaybackRestrictions:r("getOzPlaybackRestrictions")(G,W)},Pe=new l($e);T.current=Pe,I.current&&I.current.attachPerfLoggerProvider(Pe.getPerfLoggerProvider());var Ne=S.loggingMetaData.playerImplementationInstanceCountRef;Ne.current++,Pe.onError(function(e){Q&&Q.flushQueuedLogs(),b(e,"oz_player_error")}),r("justknobx")._("3727")||Pe.onWarning(function(e){Q&&Q.flushQueuedLogs();var t=o("VideoPlayerImplementationErrors").createVideoPlayerErrorFromOzImplementationError(e,"oz_player_warning");E.dispatch({payload:{warningError:t},type:"implementation_warning"})}),Pe.addListener("switchVideoRepresentation",function(){E.dispatch({payload:{},type:"representation_changed"})});var Me=function(t){if(W.getBool("enable_error_recovery_attempt_logging",!1)){var e=o("VideoPlayerImplementationErrors").createVideoPlayerErrorFromOzImplementationError(t,"oz_player_stream_error_retry");E.dispatch({payload:{recoverableError:e},type:"error_recovery_attempt"})}};Pe.addListener("manifestFetchError",function(e){o("OzOneSemanticHandler").handleManifestFetchErrorEvent(W,e)}),Pe.addListener("manifestFetchErrorRetry",function(e){Me(e)}),Pe.addListener("streamError",function(e){return o("OzOneSemanticHandler").handleStreamErrorEvent(W,e)}),Pe.addListener("streamErrorRetry",function(e){var t;(((t=e.getExtra())==null?void 0:t.mimeType)!=="application"||W.getBool("enable_era_logging_for_application_stream",!0))&&Me(e)}),Pe.addListener("streamInterruptAt",function(){E.dispatch({type:"stream_interrupted"})}),Pe.addListener("streamResumedAt",function(){E.dispatch({type:"stream_resumed"})}),Pe.addListener("streamGoneBeforeStart",function(){Ue(),E.dispatch({type:"stream_gone_before_start"})}),Pe.addListener("streamEnd",function(){Ue(),E.dispatch({type:"stream_ended"})}),Pe.addListener("videoNodeErrorRetry",function(e){if(W.getBool("enable_error_recovery_attempt_logging",!1)){var t=o("VideoPlayerImplementationErrors").createVideoPlayerErrorFromOzImplementationVideoNodeError(e,"oz_player_stream_error_retry");E.dispatch({payload:{recoverableError:t},type:"error_recovery_attempt"})}}),Pe.addListener("enterBuffering",function(e){E.dispatch({payload:{bufferingType:e},type:"buffering_begin_requested"})}),Pe.addListener("leaveBuffering",function(e){E.dispatch({payload:{domEventPerfTimestamp:e.domEventPerfTimestamp},type:"buffering_end_requested"})}),_&&_.handleOzPlayerChanged(Pe,M);var we=function(){var e=g(),t={inbandCaptionsAutogeneratedFromManifest:f.getInbandCaptionsAutogeneratedFromManifest(),inbandCaptionsExpectedFromManifest:f.getInbandCaptionsExpectedFromManifest(),inbandCaptionsExpectedFromProps:e==null?void 0:e.inbandCaptionsExpectedFromProps,representationCaptionsExpectedFromManifest:f.getRepresentationCaptionsExpectedFromManifest(),sideLoadCaptionsExpectedFromProps:e==null?void 0:e.sideLoadCaptionsExpectedFromProps,sideLoadCaptionsUrlFromProps:e==null?void 0:e.sideLoadCaptionsUrlFromProps},n=E.getCurrentState(),r=n.controlledState;(t.inbandCaptionsExpectedFromManifest!==r.captionsLoaded||t.inbandCaptionsAutogeneratedFromManifest!==r.inbandCaptionsAutogenerated)&&C(t)},Ae=function(t,n){var e=t.getCustomField("timescale"),r=typeof e=="number"?e:0;E.dispatch({payload:{timescale:r,videoBytes:n},type:"cea608_bytes_received"})},Fe=function(){var e=f.getVideoRepresentations();if(e!=null&&e.length>0){var t=e[0].getTimeRanges();if(t!=null&&t.length>0){var n=t[0].startTime,o=Math.max(t[t.length-1].endTime-W.getNumber("live_rewind_seek_to_live_delta",8),n);E.dispatch({payload:{seekableRanges:new(r("TimeRanges"))([{endTime:o,startTime:n}])},type:"seekable_ranges_changed"})}}},Oe=function(){var e=Pe.getMpd();if(e){var t=e.getCustomField("loapStreamType"),n=y();typeof t=="number"&&n!=null&&n.setStreamType(t)}},Be=function(t){if(t!=null){var e=o("ConstUriUtils").getUri(t);if(e){var n=e.getQueryParam("lvp");return n==="1"}}return!1},We=function(t){var e=function(){Fe(),we(),Oe()};t.addListener("updated",e),e();var n=[],a=function(t){L.logVPLEvent({eventType:"imf",logDataOverrides:t,state:E.getCurrentState()})},i=function(t,n,r){var e=t.parseEmsgBoxesFromMP4Segment,o=e(r,j,n.getID(),N.currentTime,a);o.length>0&&E.dispatch({payload:{emsgBoxes:o},type:"emsg_boxes_parsed"})},l=function(t){for(var e=n.shift();e;)i.apply(void 0,[t].concat(e)),e=n.shift()};if(Pe.updatePlayerRunTimeConfig({audioStreamDataHandler:function(){var e=E.getCurrentState();if(e.controlledState.emsgObserverTokens.size>0){for(var t=s.getModuleIfRequireable(),o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];t!=null?(l(t),i.apply(void 0,[t].concat(a))):(n.push(a),s.load().then(function(e){l(e)}).catch(function(e){r("FBLogger")("comet_video_player").catching(r("getErrorSafe")(e)).warn("Failed to load VideoPlayerEmsg"),n.length=0}))}},videoStreamDataHandler:Ae}),f.isPredictiveDash()){W.setContext("streaming_implementation","pdash");var u=h();u&&u.maybeUpdateLatencyLevel()}var c="mos",d=W.getBool("is_csvqm_enabled",!1);if(d&&!X){var m=f.getVideoRepresentations(),p=m==null?void 0:m.every(function(e){return e.getQualityScoreCurveString("csvqm")!=null});p===!0&&(c="csvqm")}W.setContext("quality_score_type",c),o("VideoPlayerODS").bumpEntityKey("comet_video_player",c==="csvqm"?"OzImplementation.quality_score_type_csvqm":"OzImplementation.quality_score_type_mos",14);{var _=g();C({inbandCaptionsAutogeneratedFromManifest:f.getInbandCaptionsAutogeneratedFromManifest(),inbandCaptionsExpectedFromManifest:f.getInbandCaptionsExpectedFromManifest(),inbandCaptionsExpectedFromProps:_==null?void 0:_.inbandCaptionsExpectedFromProps,representationCaptionsExpectedFromManifest:f.getRepresentationCaptionsExpectedFromManifest(),sideLoadCaptionsExpectedFromProps:_==null?void 0:_.sideLoadCaptionsExpectedFromProps,sideLoadCaptionsUrlFromProps:_==null?void 0:_.sideLoadCaptionsUrlFromProps})}};Pe.addListener("vttCaptionsUpdated",function(e,t){var n="webvtt",r=E.getCurrentState().controlledState.captionFormat;n!==r&&E.dispatch({payload:{captionFormat:n},type:"controller_set_caption_format_requested"}),E.dispatch({payload:{activeCaptions:e,captionsLocale:t},type:"controller_set_active_captions_requested"})}),Pe.addListener("mpdParsed",function(e){f.isPredictiveDash()&&W.setContext("streaming_implementation","pdash")}),Pe.addListener("mpdReady",function(e){w.current=!0,We(e),E.dispatch({payload:{selectedVideoQuality:f.getUserSelectedVideoQuality()},type:"implementation_engine_initialized"})}),Pe.addListener("representationBlocked",function(e){E.dispatch({payload:{blockedRepresentationID:e},type:"implementation_engine_representation_blocked"})});var qe=null;function Ue(){r("clearTimeout")(qe);var e=v.current,t=D.current;if(e!=null){v.current=null,D.current=null,k.current=null;try{e!=null&&e.closeHiveSession(),t&&t.logEndSession()}catch(e){var n=r("getErrorSafe")(e);t&&t.logError(n)}}}var Ve=v.current,He=U==null?void 0:U.ticket;if(V!=null&&U&&Ve!=null&&He!=null){var Ge=Pe.getPerfLoggerProvider();Ge&&Ge.setIsP2pPlayback(!0);var ze=V.substring(V.indexOf("?")),je=Ve.initSession(He+ze,Pe,N),Ke=new(r("Deferred"));qe=r("setTimeout")(function(){Ke.reject(new Error("Hive initialization timed out after "+u+"ms"))},u),je.then(function(e){Ke.resolve(e)}).catch(function(e){Ke.reject(e)}),Ke.getPromise().then(function(e){r("clearTimeout")(qe);var t=e.manifest,n=e.tech,o=D.current;t!==V&&o&&o.logManifestMismatch(t,V),o&&o.logSessionInit(n,t),L.setLoggingToVPLAdditionalData("is_p2p_playback",!0),L.setLoggingToVPLAdditionalData("is_live_preview",Be(t)),Pe.load(t)}).catch(function(e){r("clearTimeout")(qe);var t=D.current;t&&t.logError(e),Ue(),L.setLoggingToVPLAdditionalData("is_live_preview",Be(V)),Pe.load(V)})}else L.setLoggingToVPLAdditionalData("is_p2p_playback",!1),L.setLoggingToVPLAdditionalData("is_live_preview",Be(V)),Pe.load(V)}l.proceedWithOzPlayerCreation=m}),98);
__d("VideoPlayerOzImplementationLatencyLevelManager",[],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n){this.$2="normal",this.$4=null,this.$1=e,this.$3=t,this.$6=n}var t=e.prototype;return t.updatePlayerFormat=function(t){this.$4!==t&&(this.$4=t,this.maybeUpdateLatencyLevel())},t.updateBroadcastLatencySensitivity=function(t){this.$5!==t&&(this.$5=t,this.maybeUpdateLatencyLevel())},t.maybeUpdateLatencyLevel=function(){var e=this.$7(this.$5);e!==this.$2&&(this.$2=e,this.$1.getBool("set_latency_context_immediately",!1)&&this.$1.setContext("latency_level",e),this.$3.dispatch({payload:{latencyLevel:e,ullIneligibilityReason:this.$8()},type:"implementation_set_latency_level_requested"}))},t.$8=function(){var e=this.$1.getNumber("ultra_low_latency_bandwidth_threshold",0),t=this.$6.getEstimatedBandwidth();return t!==null&&e>0&&t<e?"low_bandwidth_estimate":null},t.$7=function(t){if(t==null)return"normal";switch(t){case 1:return"low";case 2:return this.$8()!==null?this.$1.getBool("fall_back_to_low_latency_in_ull",!1)?"low":"normal":"ultra-low";case 0:return"normal"}},e})();l.default=e}),98);
__d("VideoPlayerOzPlayerModuleLoaderDeferredForDisplay",["requireDeferredForDisplay"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferredForDisplay")("oz-player").__setRef("VideoPlayerOzPlayerModuleLoaderDeferredForDisplay");function s(){return{getModuleIfRequireable:function(){return e.getModuleIfRequireable()||null},load:function(){return e.load()}}}l.default=s}),98);
__d("VideoPlayerOzImplementationEngine",["CometDASHPrefetchCacheManager","ErrorMetadata","VideoPlayerImplementationEngineAPI","VideoPlayerImplementationEngineVideoElementAPI","VideoPlayerImplementationErrors","VideoPlayerImplementationLoadSequenceManager","VideoPlayerODS","VideoPlayerOzImplementationEngineExtrasAPI","VideoPlayerOzImplementationEnginePartsImplFunction","VideoPlayerOzImplementationEnginePartsImplUtils","VideoPlayerOzImplementationLatencyLevelManager","VideoPlayerOzPlayerModuleLoaderDeferredForDisplay","cr:1157","err","gkx","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e=!1;function s(e){var t=e.initialProps,a={current:null},i={current:null},l={current:null},s={current:null},u={current:null},c={current:null},d={current:null},m={current:null},p={current:null},_={current:null},f={current:null},g={current:null},h={current:null},y={current:null};function C(){var e;return(e=d.current)!=null?e:null}function b(){var e;return(e=c.current)!=null?e:null}function v(){var e,t;return(e=(t=i.current)==null?void 0:t.experimentationConfig)!=null?e:null}function S(){var e;return(e=X.current)!=null?e:null}function R(){var e;return(e=h.current)!=null?e:null}var L;n("cr:1157")&&(L=new(n("cr:1157")));var E="comet_oz",k=t.loggingMetaData.instanceKey,I=t.initiateLivePlaybackFromStart,T=function(t,n){return n.manifestXmlStringInitial!==null?t.manifestXmlStringInitial!==n.manifestXmlStringInitial:t.manifestUrl!==n.manifestUrl},D=function(t,n){return t.videoFBID!==n.videoFBID},x=function(t){return t.getBool("use_full_player_if_cached",!1)&&r("VideoPlayerOzPlayerModuleLoaderDeferredForDisplay")?r("VideoPlayerOzPlayerModuleLoaderDeferredForDisplay")().getModuleIfRequireable():null},$=function(t,n,r){n!=null?i.current=babelHelpers.extends({},t,{manifestXmlStringResolved:n}):i.current=t,Q.dispatch({type:"implementation_engine_oz_manifest_downloading"}),u.current=x(t.experimentationConfig),M(u.current,[].concat(r,["proceedWithOzManifestDownloading"]))},P=function(t){var e,n,i,l=t.manifestUrl,s=t.manifest,u=null;r("CometDASHPrefetchCacheManager")&&t.coreVideoPlayerMetaData.videoFBID!=null&&(u=r("CometDASHPrefetchCacheManager").get(t.coreVideoPlayerMetaData.videoFBID));var c={VideoPlayerShakaPerformanceLoggerClass:t.coreVideoPlayerMetaData.VideoPlayerShakaPerformanceLoggerClass,accessToken:t.loggingMetaData.accessToken,audioOnly:t.coreVideoPlayerMetaData.audioOnly,experimentationConfig:t.experimentationConfig,graphQLVideoDRMInfo:t.coreVideoPlayerMetaData.graphQLVideoDRMInfo,graphQLVideoP2PSettings:t.coreVideoPlayerMetaData.graphQLVideoP2PSettings,initialAudioUserPreferredLanguage:t.initialAudioUserPreferredLanguage,manifestUrl:l!=null?l:null,manifestXmlStringInitial:s!=null?s:null,minQualityPreference:t.minQualityPreference,ozPrefetchCache:u,videoFBID:t.coreVideoPlayerMetaData.videoFBID,videoPlayerShakaPerformanceLoggerBuilder:t.coreVideoPlayerMetaData.videoPlayerShakaPerformanceLoggerBuilder},d=a.current,m=(e=h.current)!=null?e:new(r("VideoPlayerOzImplementationLatencyLevelManager"))(t.experimentationConfig,Q,B);h.current=m,y.current=(n=t.coreVideoPlayerMetaData.playerFormat)!=null?n:null,m.updatePlayerFormat((i=t.coreVideoPlayerMetaData.playerFormat)!=null?i:null),m.updateBroadcastLatencySensitivity(t.coreVideoPlayerMetaData.broadcastLatencySensitivity);var p=!1;if(d==null)p=!0;else if(d!=null&&!D(c,d)&&T(c,d)){var _=14;o("VideoPlayerODS").bumpEntityKey("OzImplementation","manifest_reloaded",_),p=!1}else if(d!=null&&D(c,d)){var f,g=r("err")("videoFBID changed after player initialization: %s",JSON.stringify({subOrigin:t.coreVideoPlayerMetaData.subOrigin,toVideoFBID:c.videoFBID}));g.name="VideoPlayerOzImplementationVideoFBIDChanged";var C=(f=g.metadata)!=null?f:new(r("ErrorMetadata"));throw d.videoFBID!=null&&C.addEntry("COMET_VIDEO","VIDEO_ID",d.videoFBID),g.metadata=C,g.project="comet_video_player",g}if(!p)return!1;if(l=c.manifestUrl,s=c.manifestXmlStringInitial,s==null&&l==null){var b,v=r("err")("Empty manifestXmlStringInitial and manifestUrl: %s",JSON.stringify({manifestUrl:l,manifestXmlStringInitial:s,subOrigin:t.coreVideoPlayerMetaData.subOrigin}));v.name="VideoPlayerOzImplementationManifestEmpty";var S=(b=v.metadata)!=null?b:new(r("ErrorMetadata"));throw c.videoFBID!=null&&S.addEntry("COMET_VIDEO","VIDEO_ID",c.videoFBID),v.metadata=S,v.project="comet_video_player",v}return a.current=c,$(c,s,["handleVideoInfoChangeForOzImplementation","downloadManifestInOz"]),!0},N=function(t,n){var e=function(r){s.current===t&&(u.current=r,M(r,[].concat(n,["handleOzPlayerModuleLoadSuccess"])))},o=function(n){s.current===t&&j(n,"oz_player_module_load_failed")};s.current=t,r("promiseDone")(t,e,o)},M=function(t,n){var e=H(),a=i.current;if(!(e==null||a==null)){var l=r("gkx")("18183")?o("VideoPlayerImplementationEngineAPI").ensureVideoElementAPI(X):X.current=o("VideoPlayerImplementationEngineVideoElementAPI").createVideoPlayerImplementationEngineVideoElementAPI(e),s=a.experimentationConfig;t?w(t,e,l,a,[].concat(n,["proceedWithResolvedVideoInfo","OzPlayerModuleFromRef"])):(s.getBool("instantiate_buffering_detector_before_quick_starter",!1)&&o("VideoPlayerOzImplementationEnginePartsImplUtils").createOzBufferingDetector(e,l,a.experimentationConfig,Q,d,K),N(r("VideoPlayerOzPlayerModuleLoaderDeferredForDisplay")().load(),[].concat(n,["proceedWithResolvedVideoInfo","VideoPlayerOzPlayerModuleLoaderAsync"])))}},w=function(n,a,i,s,u){try{var e={OzPlayerClass:n,callChain:[].concat(u,["proceedWithResolvedVideoInfoAndOzPlayerModuleSync"]),destroyOzPlayerPartsRef:g,engineDebugAPI:L,engineExtrasAPI:B,getCaptionsInfo:V,getLatencyLevelManager:R,getVideoLiveTrace:G,handleCaptionsInfoChange:z,handleFatalImplementationError:j,initialProps:t,loggerToVPL:K,machine:Q,ozBufferingDetectorRef:d,playerFormatForDPLRef:y,playerVersion:E,resolvedVideoInfo:s,videoElement:a},h=v(),C=t.coreVideoPlayerMetaData.loadSequence;h&&h.getNumber("load_sequence_max_delay_ms",0)>0&&C!=null?f.current=r("VideoPlayerImplementationLoadSequenceManager").schedule(h,C,function(){return o("VideoPlayerOzImplementationEnginePartsImplFunction").proceedWithOzPlayerCreation(babelHelpers.extends({},e,{hivePluginRef:m,initiateLivePlaybackFromStart:I,overrideOzRequestImplementationRef:_,ozPlayerRef:c,p2pSessionLoggerRef:p,videoElementAPI:i})),i.getCanPlayPromise()}):o("VideoPlayerOzImplementationEnginePartsImplFunction").proceedWithOzPlayerCreation(babelHelpers.extends({},e,{hivePluginRef:m,initiateLivePlaybackFromStart:I,overrideOzRequestImplementationRef:_,ozPlayerRef:c,p2pSessionLoggerRef:p,videoElementAPI:i})),l.current=s}catch(e){j(e,"oz_player_create_exception")}};function A(e){var t=g.current;t!=null&&(g.current=null,t(e)),f.current!=null&&(f.current(),f.current=null)}function F(){}function O(){s.current=null,u.current=null}var B=o("VideoPlayerOzImplementationEngineExtrasAPI").createVideoPlayerOzImplementationEngineExtrasAPI({getConfig:v,getOzPlayer:b,getVideoElementAPI:S}),W=o("VideoPlayerImplementationEngineAPI").createVideoPlayerImplementationEngine({createDebugAPI:function(t){var e=t.getVideoElementAPI,n=t.loggerToVPL;return L?L.createDebugAPI({engineExtrasAPI:B,getConfig:function(){var e,t;return(e=(t=l.current)==null?void 0:t.experimentationConfig)!=null?e:null},getManifest:function(){var e,t;return(e=(t=l.current)==null?void 0:t.manifestXmlStringResolved)!=null?e:null},getManifestUrl:function(){var e,t;return(e=(t=l.current)==null?void 0:t.manifestUrl)!=null?e:null},getOzBufferingDetector:C,getOzPlayer:b,getVideoElementAPI:e,loggerToVPL:n}):null},createVideoPlayerError:o("VideoPlayerImplementationErrors").createVideoPlayerErrorFromOzImplementationError,destroyEngineParts:function(t){A([].concat(t,["destroyEngineParts"])),O()},engineCreateArgs:e,engineExtrasAPI:B,engineMetadata:{isAbrEnabled:!0,playerInstanceKey:k,playerVersion:E,streamingFormat:"dash"},handleVideoElementChanged:function(t,n){t!=null&&M(u.current,[].concat(n,["handleVideoElementMounted"]))},handleVideoInfoChange:P}),q=W.debugLog,U=W.engine,V=W.getCaptionsInfo,H=W.getVideoElement,G=W.getVideoLiveTrace,z=W.handleCaptionsInfoChange,j=W.handleFatalImplementationError,K=W.loggerToVPL,Q=W.machine,X=W.videoElementAPIRef;return U}l.createVideoPlayerOzImplementationEngine=s}),98);
__d("VideoPlayerOzImplementationIGLazyConditional.react",["cr:1635"],(function(t,n,r,o,a,i,l){"use strict";l.default=n("cr:1635")}),98);
__d("VideoPlayerOzImplementationV2.react",["VideoPlayerImplementationEngineAPI","VideoPlayerOzImplementationEngine"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=o("VideoPlayerImplementationEngineAPI").useVideoPlayerImplementationEngine(e,o("VideoPlayerOzImplementationEngine").createVideoPlayerOzImplementationEngine),n=t.reactVideoFrameAndComponents;return n}l.default=e}),98);
__d("oz-player/shims/ozReportUnexpectedError",["oz-player/shims/www/ozReportUnexpectedErrorWWW"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/ozReportUnexpectedErrorWWW")}),98);
__d("oz-player/loggings/OzLoggingUtils",["oz-player/shims/ozReportUnexpectedError"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var r=e.getOperationLogger(t).start();try{return n(r)}catch(e){throw r.setError(e),e}finally{r.log()}}function s(e,t,n,o,a){o===void 0&&(o=function(){}),a===void 0&&(a=function(){});var i=t.getOperationLogger(n).start();o(i),e.then(function(e){a(i),i.log()},function(e){a(i),i.setError(e),i.log()}).catch(function(e){r("oz-player/shims/ozReportUnexpectedError")(e,n+" logger")})}l.executeOperationAndLog=e,l.monitorPromiseAndLogOperation=s}),98);
__d("oz-player/loggings/OzOperationLoggerBase",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){this.$52=new Map,this.$1=e}var t=e.prototype;return t.start=function(){var e=Date.now();return this.setClientTimeBegin(e),this.setClientTimeEnd(null),this.setClientTimeDuration(null),this},t.log=function(){var e=Date.now(),t=this.getClientTimeBegin(),n=this.getClientTimeEnd();(t==null||t===0)&&(t=e,this.setClientTimeBegin(t)),(n==null||n===0)&&(n=e,this.setClientTimeEnd(n)),this.setClientTimeDuration(n-t)},t.setError=function(t){return this.$2=t,this},t.setPerSessionSampleRate=function(t){return this.$3=t,this},t.setAppendTarget=function(t){return this.$47=t,this},t.setOneObserved=function(t){return this.$44=t,this},t.setOneReqWave=function(t){return this.$45=t,this},t.setOneResWave=function(t){return this.$46=t,this},t.setIsP2pPlayback=function(t){return this.$43=t,this},t.setResult=function(t){return this.$4=t,this},t.setType=function(t){return this.$5=t,this},t.setClientTimeBegin=function(t){return this.$6=t,this},t.setClientTimeDuration=function(t){return this.$7=t,this},t.setClientTimeEnd=function(t){return this.$8=t,this},t.setSegmentCount=function(t){return this.$15=t,this},t.setTimeToFirstByte=function(t){return this.$9=t,this},t.setTimeToLastByte=function(t){return this.$10=t,this},t.setTimeToRequestStart=function(t){return this.$11=t,this},t.setTimeToRequestSent=function(t){return this.$12=t,this},t.setReason=function(t){return this.$13=t,this},t.setResource=function(t){return this.$14=t,this},t.setSegmentStartTime=function(t){return this.$16=t,this},t.setSegmentEndTime=function(t){return this.$17=t,this},t.setLength=function(t){return this.$18=t,this},t.setLiveheadPosition=function(t){return this.$19=t,this},t.setLiveheadSeqNumHeader=function(t){return this.$20=t,this},t.setLiveheadSeqNumMpd=function(t){return this.$21=t,this},t.setManifestType=function(t){return this.$22=t,this},t.setMediaSourceNewDuration=function(t){return this.$23=t,this},t.setMediaSourcePreviousDuration=function(t){return this.$24=t,this},t.setPriorityFloat=function(t){return this.$25=t,this},t.setAppendedBufferMs=function(t){return this.$26=t,this},t.setInitiator=function(t){return this.$27=t,this},t.setPreloadTime=function(t){return this.$28=t,this},t.setConcluder=function(t){return this.$29=t,this},t.setPreviousRepresentationID=function(t){return this.$30=t,this},t.setRepresentationID=function(t){return this.$31=t,this},t.setStreamSwitchReason=function(t){return this.$32=t,this},t.setState=function(t){return this.$33=t,this},t.setContentLengthHeader=function(t){return this.$34=t,this},t.setOriginHitHeader=function(t){return this.$36=t,this},t.setEdgeHitHeader=function(t){return this.$37=t,this},t.setFNAHitHeader=function(t){return this.$38=t,this},t.setCode=function(t){return this.$35=t,this},t.setResponseTimeMsHeader=function(t){return this.$39=t,this},t.setIsTemplatedManifest=function(t){return this.$40=t,this},t.setIsLatencyCachupEnabled=function(t){return this.$41=t,this},t.setPlayerFormat=function(t){return this.$42=t,this},t.setIsRingBufferSample=function(t){return this.$48=t,this},t.setIsOnline=function(t){return this.$49=t,this},t.setProxyStatusHeader=function(t){return this.$50=t,this},t.setPlaybackFbmsParam=function(t){return this},t.setPreferredEdgeLatency=function(t){return this.$51=t,this},t.setUserInfo=function(t){return this},t.setDynamicStatusHeader=function(t){return this},t.setIsMixedCodecManifest=function(t){return this.$53=t,this},t.getPerSessionSampleRate=function(){return this.$3},t.setMediaSourceSourceBuffer=function(t,n){return this.$52.set(t,n),this},t.unsetMediaSourceSourceBuffers=function(){return this.$52.clear(),this},t.getError=function(){return this.$2},t.getResult=function(){return this.$4},t.getType=function(){return this.$5},t.getClientTimeBegin=function(){return this.$6},t.getClientTimeEnd=function(){return this.$7!=null?this.$6!=null?this.$6+this.$7:null:this.$8},t.getTimeToRequestStart=function(){return this.$11},t.getTimeToRequestSent=function(){return this.$12},t.getReason=function(){return this.$13},t.getResource=function(){return this.$14},t.getOperationName=function(){return this.$1},t.getSegmentStartTime=function(){return this.$16},t.getSegmentEndTime=function(){return this.$17},t.getLength=function(){return this.$18},t.getLiveheadPosition=function(){return this.$19},t.getManifestType=function(){return this.$22},t.getIsMixedCodecManifest=function(){return this.$53},t.getPriorityFloat=function(){return this.$25},t.getAppendedBufferMs=function(){return this.$26},t.getInitiator=function(){return this.$27},t.getPreloadTime=function(){return this.$28},t.getConcluder=function(){return this.$29},t.getContentLengthHeader=function(){return this.$34},t.getOriginHitHeader=function(){return this.$36},t.getEdgeHitHeader=function(){return this.$37},t.getFNAHitHeader=function(){return this.$38},t.getCode=function(){return this.$35},t.getResponseTimeMsHeader=function(){return this.$39},t.getIsTemplatedManifest=function(){return this.$40},t.getOneObserved=function(){return this.$44},t.getOneReqWave=function(){return this.$45},t.getOneResWave=function(){return this.$46},t.getAppendTarget=function(){return this.$47},t.getIsRingBufferSample=function(){return this.$48},t.getIsOnline=function(){return this.$49},t.getProxyStatusHeader=function(){return this.$50},t.getMediaSourceSourceBuffers=function(){return this.$52},e})();i.default=e}),66);
__d("oz-player/shims/www/OzMaybeNativePromiseWWW",["cr:3014"],(function(t,n,r,o,a,i,l){"use strict";l.default=n("cr:3014")}),98);
__d("oz-player/shims/OzMaybeNativePromise",["oz-player/shims/www/OzMaybeNativePromiseWWW"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/OzMaybeNativePromiseWWW")}),98);
__d("oz-player/utils/OzErrorEmitter",["oz-player/shims/OzEventEmitter","oz-player/shims/ozvariant"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t){var n;return t===void 0&&(t=!1),n=e.call(this)||this,n.$OzErrorEmitter$p_1=!1,n.$OzErrorEmitter$p_2=!1,n.$OzErrorEmitter$p_3=[],n.emitError=function(e){n.$OzErrorEmitter$p_1?n.emit("error",e):n.$OzErrorEmitter$p_2?n.$OzErrorEmitter$p_3.push(e):n.$OzErrorEmitter$p_1||r("oz-player/shims/ozvariant")(0,14038)},n.$OzErrorEmitter$p_2=t,n}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.onError=function(t){this.$OzErrorEmitter$p_1=!0;var e=this.addListener("error",t);return this.$OzErrorEmitter$p_2&&this.$OzErrorEmitter$p_3.length>0&&this.$OzErrorEmitter$p_3.forEach(this.emitError),e},t})(r("oz-player/shims/OzEventEmitter"));l.default=e}),98);
__d("oz-player/drm/OzDrmManager",["oz-player/drm/OzDrmUtils","oz-player/loggings/OzLoggingUtils","oz-player/loggings/OzOperationLoggerBase","oz-player/shims/OzDOMEventListener","oz-player/shims/OzMaybeNativePromise","oz-player/shims/OzSubscriptionsHandler","oz-player/utils/OzErrorEmitter","oz-player/utils/OzErrorUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n){var a=this;n===void 0&&(n=null),this.$1=null,this.$2=new Map,this.$4=!1,this.$6=new(r("oz-player/shims/OzSubscriptionsHandler")),this.$7=new(r("oz-player/utils/OzErrorEmitter")),this.$8=!1,this.$9=null,this.$10=0,this.$11=[],this.$12=[],this.$22=function(e,t){e instanceof r("oz-player/loggings/OzOperationLoggerBase")&&e.getError()&&e.setResult("failed"),t!=null&&e.setReason(t)},this.$19=function(e){if(a.$4)return r("oz-player/shims/OzMaybeNativePromise").reject(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_DRM_MANAGER",description:"OzDrmManager destroyed before call to mediaKeySystemAccess.createMediaKeys()."}));var t=a.$5.mediaKeys!=null?r("oz-player/shims/OzMaybeNativePromise").resolve(a.$5.mediaKeys):e.createMediaKeys(),n=t.then(function(t){return{mediaKeySystemAccess:e,mediaKeys:t}});return o("oz-player/loggings/OzLoggingUtils").monitorPromiseAndLogOperation(n,a.$3,"drm_create_media_keys",function(){},a.$22),n},this.$20=function(e){if(a.$4)return r("oz-player/shims/OzMaybeNativePromise").reject(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_DRM_MANAGER",description:"OzDrmManager destroyed before call to setMediaKeys()"}));var t=e.mediaKeys,n=e.mediaKeySystemAccess;if(!t)throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_DRM_MANAGER",description:"No mediaKeys for mediaKeySystemAccess"});var i=a.$5.setMediaKeys(t).then(function(){if(a.$4)return r("oz-player/shims/OzMaybeNativePromise").reject(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_DRM_MANAGER",description:"OzDrmManager destroyed after setMediaKeys() called."}));var e=Array.from(a.$2.values()).find(function(e){return e.getKeySystem()===n.keySystem});if(!e)throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_DRM_MANAGER",description:"Can't find OzDrmProvider for keySystem "+n.keySystem});var i=e.getServerCertificate();return i?t.setServerCertificate(i).then(function(){return{mediaKeys:t,provider:e}}):{mediaKeys:t,provider:e}});return o("oz-player/loggings/OzLoggingUtils").monitorPromiseAndLogOperation(i,a.$3,"drm_set_media_keys",function(){},a.$22),i},this.$21=function(e){var t=e.mediaKeys,n=e.provider,i=n.getInitDatas();if(i.length===0)return a.$6.addSubscriptions(r("oz-player/shims/OzDOMEventListener").listenDOMEvent(a.$5,"encrypted",function(e){a.$23(t,n,e).catch(function(e){a.$14(o("oz-player/utils/OzErrorUtils").convertPromiseRejectionReasonToOzError(e,{type:"OZ_DRM_MANAGER",description:"DRM encrypted rejection"}))})})),r("oz-player/shims/OzMaybeNativePromise").resolve([]);var l=i.map(function(e){return a.$23(t,n,{initData:e.data,initDataType:e.type})}),s=r("oz-player/shims/OzMaybeNativePromise").all(l);return o("oz-player/loggings/OzLoggingUtils").monitorPromiseAndLogOperation(s,a.$3,"drm_request_license",function(){},a.$22),s},this.$5=t,this.$1=n,this.$3=e.cloneContext().setType("drm_manager")}var t=e.prototype;return t.hasContentProtections=function(){return this.$9},t.onError=function(t){return this.$7.onError(t)},t.$13=function(t){this.$7.emitError(t)},t.$14=function(t){var e,n,r=(e=(n=this.$1)==null?void 0:n.maxStartEMEAttempts)!=null?e:-1;this.$10<r?this.$15():this.$13(t)},t.addProvider=function(t){this.$2.set(t.getSchemeId(),t)},t.getProviderForSchemeId=function(t){return this.$2.get(t)},t.$16=function(t){if(!t)return null;for(var e=[],n=0;n<t.length;n++){var r=t[n],a=r.$.schemeIdUri,i=this.getProviderForSchemeId(a);if(i){var l=i.getInitDatas();if(l.length===0&&r["cenc:pssh"]&&r["cenc:pssh"].length===1){var s,u=(s=r["cenc:pssh"][0]._)!=null?s:"",c=o("oz-player/drm/OzDrmUtils").base64ToUint8Array(u.replace(/-/g,"+").replace(/_/g,"/"));l=[{data:c,type:"cenc"}],i.setInitDatas(l)}e.push({provider:i,initDatas:l})}}return e},t.$15=function(){try{this.$8=!1,this.startEME(this.$11,this.$12)}catch(t){var e=t;this.$13(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_DRM_MANAGER",description:"Restart EME failed with: "+String(e),extra:{}}))}},t.startEME=function(t,n){var e=this;if(!this.$8){this.$8=!0,this.$10+=1,this.$11=t,this.$12=n;var r=new Map;this.$17(n,r,"audio"),this.$17(t,r,"video");var a;if(r.forEach(function(t,n){a?a=a.catch(function(){return e.$18(n,t)}):a=e.$18(n,t)}),!a){this.$9=!1;return}var i=a;this.$9=!0;var l=this.$3.getOperationLogger("drm_setup").start();i.then(this.$19).then(this.$20).then(this.$21).then(function(){return l.log()},function(t){var n=o("oz-player/utils/OzErrorUtils").convertPromiseRejectionReasonToOzError(t,{type:"OZ_DRM_MANAGER",description:"DRM definedKeyPromiseChain rejection"});e.$13(n),l.setResult("failed").setError(n).log()})}},t.$17=function(t,n,r){var e=this;t.forEach(function(t){var o=e.$16(t.getContentProtectionXml()),a=t.getMimeCodecs();o!=null&&o.forEach(function(e){var t=e.provider,o=t.getKeySystem(),i=n.get(o);i||(i={audioCapabilities:new Map,videoCapabilities:new Map,distinctiveIdentifier:t.getRequireDistinctiveIdentifier(),persistentState:t.getRequirePersistentState(),sessionTypes:t.getDrmSessionTypes(),initDataTypes:t.getInitDataTypes()},n.set(o,i)),r==="audio"&&!i.audioCapabilities.has(a)&&i.audioCapabilities.set(a,{contentType:a,robustness:t.getAudioRobustness()}),r==="video"&&!i.videoCapabilities.has(a)&&i.videoCapabilities.set(a,{contentType:a,robustness:t.getVideoRobustness()})})})},t.destroy=function(){this.$6.release(),this.$4=!0},t.$18=function(t,n){var e=this,a={audioCapabilities:Array.from(n.audioCapabilities.values()),videoCapabilities:Array.from(n.videoCapabilities.values()),distinctiveIdentifier:n.distinctiveIdentifier,persistentState:n.persistentState,sessionTypes:n.sessionTypes,initDataTypes:n.initDataTypes},i=window.navigator.requestMediaKeySystemAccess(t,[a]);return o("oz-player/loggings/OzLoggingUtils").monitorPromiseAndLogOperation(i,this.$3,"drm_request_media_key_system_access",function(){},function(n){var o=null;return n instanceof r("oz-player/loggings/OzOperationLoggerBase")&&n.getError()&&(o="keySystem: "+t+";domConfig: "+JSON.stringify(a)),e.$22(n,o)}),i},t.$23=function(t,n,a){var e=this,i=t.createSession();return this.$6.addSubscriptions(r("oz-player/shims/OzDOMEventListener").listenDOMEvent(i,"message",function(t){e.$24(i,n,t).catch(function(t){e.$14(o("oz-player/utils/OzErrorUtils").convertPromiseRejectionReasonToOzError(t,{type:"OZ_DRM_MANAGER",description:"DRM message rejection"}))})}),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(i,"keystatuseschange",function(t){e.$25(i).catch(function(t){e.$14(o("oz-player/utils/OzErrorUtils").convertPromiseRejectionReasonToOzError(t,{type:"OZ_DRM_MANAGER",description:"DRM keystatuseschange rejection"}))})})),i.generateRequest(a.initDataType,a.initData)},t.$24=function(t,n,r){var e=this,a=n.getLicenseRequestInfo(r.message.slice(0)),i=this.$3.getOperationLogger("drm_fetch_license").setResource(a.url).start();return window.fetch(a.url,a).then(function(r){return r.ok?i.setResult("success").setCode(r.status).log():i.setResult("failed").setCode(r.status).setError(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_DRM_MANAGER",description:"DRM license fetch HTTP status not OK ("+r.status+")",extra:{code:r.status.toString()}})).log(),r.arrayBuffer().then(function(a){var i=new Uint8Array(a),l=n.parseLicenseResponse(i);if(l==null||l.byteLength===0){var s,u,c=l==null?"License is null or undefined.":"License is 0 bytes.";r.ok?a.byteLength===0&&(c+=" HTTP status OK ("+r.status+"), but response body is 0 bytes"):c+=" HTTP status not OK ("+r.status+")";var d=o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_DRM_MANAGER",description:"No license for "+n.getKeySystem()+" - "+c,extra:{code:r.status.toString(),headers:r.headers,url:r.url}}),m=(s=(u=e.$1)==null?void 0:u.throwNoLicenseError)!=null?s:!1;if(m)throw d;e.$13(d)}else t.update(l)})})},t.$25=function(t){return t.expiration<Date.now()?t.close():r("oz-player/shims/OzMaybeNativePromise").resolve()},e})();l.OzDrmManager=e}),98);
__d("oz-player/loggings/OzPerfLoggerProviderBase",["oz-player/utils/OzErrorUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){}var t=e.prototype;return t.cloneContext=function(){var e=this.createLoggerProvider();return this.$11(e),e},t.setType=function(t){return this.$1=t,this},t.setInitiator=function(t){return this.$2=t,this},t.setResource=function(t){return this.$4=t,this},t.setRepresentationID=function(t){return this.$3=t,this},t.setSegmentStartTime=function(t){return this.$5=t,this},t.setSegmentEndTime=function(t){return this.$6=t,this},t.setStreamSwitchReason=function(t){return this.$7=t,this},t.setIsP2pPlayback=function(t){return this.$8=t,this},t.setIsRingBufferSample=function(t){return this.$9=t,this},t.setPerSessionSampleRate=function(t){return this.$10=t,this},t.getType=function(){return this.$1},t.getInitiator=function(){return this.$2},t.getRepresentationID=function(){return this.$3},t.getStreamSwitchReason=function(){return this.$7},t.getResource=function(){return this.$4},t.getSegmentStartTime=function(){return this.$5},t.getSegmentEndTime=function(){return this.$6},t.getIsP2pPlayback=function(){return this.$8},t.getIsRingBufferSample=function(){return this.$9},t.getOperationLogger=function(t){var e=this.createOperationLogger(t);return this.setOperationContext(e)},t.setOperationContext=function(t){return this.$11(t),t},t.createOperationLogger=function(t){throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_NOT_IMPLEMENTED_ERROR",description:"Not implemented: createOperationLogger"})},t.createLoggerProvider=function(){throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_NOT_IMPLEMENTED_ERROR",description:"Not implemented: createLoggerProvider"})},t.$11=function(t){this.getType()&&t.setType(this.getType()),this.getInitiator()&&t.setInitiator(this.getInitiator()),this.getResource()&&t.setResource(this.getResource()),this.getRepresentationID()&&t.setRepresentationID(this.getRepresentationID()),this.getStreamSwitchReason()&&t.setStreamSwitchReason(this.getStreamSwitchReason()),typeof this.getSegmentStartTime()=="number"&&t.setSegmentStartTime(this.getSegmentStartTime()),typeof this.getSegmentEndTime()=="number"&&t.setSegmentEndTime(this.getSegmentEndTime()),typeof this.getIsP2pPlayback()=="boolean"&&t.setIsP2pPlayback(this.getIsP2pPlayback()),typeof this.getIsRingBufferSample()=="boolean"&&t.setIsRingBufferSample(this.getIsRingBufferSample())},e})();l.default=e}),98);
__d("oz-player/loggings/OzDevConsolePerfLogger",["oz-player/loggings/OzOperationLoggerBase","oz-player/loggings/OzPerfLoggerProviderBase"],(function(t,n,r,o,a,i,l){"use strict";function e(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).debug.apply(e,["[oz]"].concat(n))}function s(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).error.apply(e,["[oz]"].concat(n))}function u(e,t){return Math.floor(e).toString().padStart(t,"0")}function c(e,t){t===void 0&&(t=null);var n=function(t){return u(t.getHours(),2)+":"+u(t.getMinutes(),2)+":"+u(t.getSeconds(),2)+" "+u(t.getMilliseconds(),3)},r=t?t.getTime()-e.getTime():0;return"["+n(e)+(t?" - "+n(t):"")+" ("+r+" ms)]"}function d(t){return t==="failed"?s:e}function m(e){return e==null||e===0?null:e.toFixed(2)}var p=(function(e){function t(){return e.apply(this,arguments)||this}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.createOperationLogger=function(t){return new _(t)},n.createLoggerProvider=function(){return new t},t})(r("oz-player/loggings/OzPerfLoggerProviderBase")),_=(function(e){function t(){return e.apply(this,arguments)||this}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.log=function(){e.prototype.log.call(this);var t=this.getClientTimeBegin()||0,n=this.getClientTimeEnd(),r=n!=null&&n!==0?new Date(n):null,o=this.getResult()||"success",a=this.getType(),i=this.getInitiator(),l=this.getResource(),s=m(this.getSegmentStartTime()),u=m(this.getSegmentEndTime());d(o)("["+o+"]",this.getOperationName()+": "+c(new Date(t),r),a!=null&&a!==""?"["+a+"]":"",s!=null&&s!==""&&u!=null&&u!==""?"[segment time range: "+s+" - "+u+"]":"",i||"",l||"")},t})(r("oz-player/loggings/OzOperationLoggerBase"));l.OzDevConsolePerfLoggerProvider=p,l.OzDevConsoleOperationLogger=_}),98);
__d("oz-player/loggings/OzMultiDestinationPerfLogger",["oz-player/loggings/OzOperationLoggerBase","oz-player/loggings/OzPerfLoggerProviderBase"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t){var n;return n=e.call(this)||this,n.$OzMultiDestinationPerfLoggerProvider$p_1=t,n}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.createOperationLogger=function(t){return new s(t,this.$OzMultiDestinationPerfLoggerProvider$p_1.map(function(e){return e.getOperationLogger(t)}))},n.createLoggerProvider=function(){return new t(this.$OzMultiDestinationPerfLoggerProvider$p_1)},t})(r("oz-player/loggings/OzPerfLoggerProviderBase")),s=(function(e){function t(t,n){var r;return r=e.call(this,t)||this,r.$OzMultiDestinationOperationLogger$p_1=n,r}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.start=function(){return e.prototype.start.call(this),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.start()}),this},n.setPerSessionSampleRate=function(n){return e.prototype.setPerSessionSampleRate.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setPerSessionSampleRate(n)}),this},n.setResult=function(n){return e.prototype.setResult.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setResult(n)}),this},n.setError=function(n){return e.prototype.setError.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setError(n)}),this},n.setType=function(n){return e.prototype.setType.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setType(n)}),this},n.setMediaSourcePreviousDuration=function(n){return e.prototype.setMediaSourcePreviousDuration.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setMediaSourcePreviousDuration(n)}),this},n.setMediaSourceNewDuration=function(n){return e.prototype.setMediaSourceNewDuration.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setMediaSourceNewDuration(n)}),this},n.setClientTimeBegin=function(n){return e.prototype.setClientTimeBegin.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setClientTimeBegin(n)}),this},n.setClientTimeDuration=function(n){return e.prototype.setClientTimeDuration.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setClientTimeDuration(n)}),this},n.setClientTimeEnd=function(n){return e.prototype.setClientTimeEnd.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setClientTimeEnd(n)}),this},n.setSegmentCount=function(n){return e.prototype.setSegmentCount.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setSegmentCount(n)}),this},n.setTimeToFirstByte=function(n){return e.prototype.setTimeToFirstByte.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setTimeToFirstByte(n)}),this},n.setTimeToLastByte=function(n){return e.prototype.setTimeToLastByte.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setTimeToLastByte(n)}),this},n.setTimeToRequestStart=function(n){return e.prototype.setTimeToRequestStart.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setTimeToRequestStart(n)}),this},n.setTimeToRequestSent=function(n){return e.prototype.setTimeToRequestSent.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setTimeToRequestSent(n)}),this},n.setReason=function(n){return e.prototype.setReason.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setReason(n)}),this},n.setResource=function(n){return e.prototype.setResource.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setResource(n)}),this},n.setSegmentStartTime=function(n){return e.prototype.setSegmentStartTime.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setSegmentStartTime(n)}),this},n.setSegmentEndTime=function(n){return e.prototype.setSegmentEndTime.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setSegmentEndTime(n)}),this},n.setAppendedBufferMs=function(n){return e.prototype.setAppendedBufferMs.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setAppendedBufferMs(n)}),this},n.setLength=function(n){return e.prototype.setLength.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setLength(n)}),this},n.setLiveheadPosition=function(n){return e.prototype.setLiveheadPosition.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setLiveheadPosition(n)}),this},n.setLiveheadSeqNumHeader=function(n){return e.prototype.setLiveheadSeqNumHeader.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setLiveheadSeqNumHeader(n)}),this},n.setLiveheadSeqNumMpd=function(n){return e.prototype.setLiveheadSeqNumMpd.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setLiveheadSeqNumMpd(n)}),this},n.setManifestType=function(n){return e.prototype.setManifestType.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setManifestType(n)}),this},n.setPriorityFloat=function(n){return e.prototype.setPriorityFloat.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setPriorityFloat(n)}),this},n.setInitiator=function(n){return e.prototype.setInitiator.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setInitiator(n)}),this},n.setPreloadTime=function(n){return e.prototype.setPreloadTime.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setPreloadTime(n)}),this},n.setConcluder=function(n){return e.prototype.setConcluder.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setConcluder(n)}),this},n.setPreviousRepresentationID=function(n){return e.prototype.setPreviousRepresentationID.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setPreviousRepresentationID(n)}),this},n.setRepresentationID=function(n){return e.prototype.setRepresentationID.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setRepresentationID(n)}),this},n.setState=function(n){return e.prototype.setState.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setState(n)}),this},n.setContentLengthHeader=function(n){return e.prototype.setContentLengthHeader.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setContentLengthHeader(n)}),this},n.setEdgeHitHeader=function(n){return e.prototype.setEdgeHitHeader.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setEdgeHitHeader(n)}),this},n.setFNAHitHeader=function(n){return e.prototype.setFNAHitHeader.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setFNAHitHeader(n)}),this},n.setOriginHitHeader=function(n){return e.prototype.setOriginHitHeader.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setOriginHitHeader(n)}),this},n.setCode=function(n){return e.prototype.setCode.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setCode(n)}),this},n.setResponseTimeMsHeader=function(n){return e.prototype.setResponseTimeMsHeader.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setResponseTimeMsHeader(n)}),this},n.setIsTemplatedManifest=function(n){return e.prototype.setIsTemplatedManifest.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setIsTemplatedManifest(n)}),this},n.setIsLatencyCachupEnabled=function(n){return e.prototype.setIsLatencyCachupEnabled.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setIsLatencyCachupEnabled(n)}),this},n.setPlayerFormat=function(n){return e.prototype.setPlayerFormat.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setPlayerFormat(n)}),this},n.setIsP2pPlayback=function(n){return e.prototype.setIsP2pPlayback.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setIsP2pPlayback(n)}),this},n.setOneObserved=function(n){return e.prototype.setOneObserved.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setOneObserved(n)}),this},n.setOneReqWave=function(n){return e.prototype.setOneReqWave.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setOneReqWave(n)}),this},n.setOneResWave=function(n){return e.prototype.setOneResWave.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setOneResWave(n)}),this},n.setAppendTarget=function(n){return e.prototype.setAppendTarget.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setAppendTarget(n)}),this},n.setIsRingBufferSample=function(n){return e.prototype.setIsRingBufferSample.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setIsRingBufferSample(n)}),this},n.setIsOnline=function(n){return e.prototype.setIsOnline.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setIsOnline(n)}),this},n.setIsMixedCodecManifest=function(n){return e.prototype.setIsMixedCodecManifest.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setIsMixedCodecManifest(n)}),this},n.setProxyStatusHeader=function(n){return e.prototype.setProxyStatusHeader.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setProxyStatusHeader(n)}),this},n.setPlaybackFbmsParam=function(n){return e.prototype.setPlaybackFbmsParam.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setPlaybackFbmsParam(n)}),this},n.setPreferredEdgeLatency=function(n){return e.prototype.setPreferredEdgeLatency.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setPreferredEdgeLatency(n)}),this},n.setUserInfo=function(n){return e.prototype.setUserInfo.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setUserInfo(n)}),this},n.setDynamicStatusHeader=function(n){return e.prototype.setDynamicStatusHeader.call(this,n),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setDynamicStatusHeader(n)}),this},n.setMediaSourceSourceBuffer=function(n,r){return e.prototype.setMediaSourceSourceBuffer.call(this,n,r),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.setMediaSourceSourceBuffer(n,r)}),this},n.unsetMediaSourceSourceBuffers=function(){return e.prototype.unsetMediaSourceSourceBuffers.call(this),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.unsetMediaSourceSourceBuffers()}),this},n.log=function(){e.prototype.log.call(this),this.$OzMultiDestinationOperationLogger$p_1.forEach(function(e){return e.log()})},t})(r("oz-player/loggings/OzOperationLoggerBase"));l.OzMultiDestinationPerfLoggerProvider=e}),98);
__d("oz-player/loggings/OzOperationLoggerObserver",["oz-player/shims/OzSubscriptionsHandler"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){this.$1=new(r("oz-player/shims/OzSubscriptionsHandler"))}var t=e.prototype;return t.observe=function(t,n){var e,r=t.map(function(e){var t=e.setOperationLoggedListener(function(e){var t=e.getClientTimeBegin()||0,r=e.getClientTimeEnd()||0;n.getOperationLogger(e.getOperationName()).setClientTimeBegin(t).setClientTimeDuration(r-t).setClientTimeEnd(r).setLength(e.getLength()).setResult(e.getResult()||"success").setInitiator(e.getInitiator()).setType(e.getType()).log()});return e.activate(),t});(e=this.$1).addSubscriptions.apply(e,r)},t.destroy=function(){this.$1.release()},e})();l.default=e}),98);
__d("oz-player/shims/www/OzNetworkDiagnosticsWWW",["VideoPlayerOzWWWGlobalConfig"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){if(!e)return null;var n=parseInt(e.get(t),10);return!isNaN(n)&&isFinite(n)?n:null}function s(e,t,n){var r;if(!e||t===""||n==="")return null;for(var o=(r=e.get(t))!=null?r:"",a=o.split(";"),i=0;i<a.length;i++){var l=a[i].split(":");if(l.length===2&&l[0]===n){var s=parseInt(l[1],10);return isFinite(s)?s:null}}return null}var u={getNextValidSegmentId:function(n){return e(n,"x-fb-next-valid-segment-id")},getResponseTimeMs:function(n){return e(n,"x-fb-response-time-ms")},getDvlSegmentPTS:function(n){return e(n,"x-fb-segment-pts-start")},getDvlStatus:function(t){return t==null?void 0:t.get("x-fb-dynamic-status")},getUsableResponseSizeForBandwidthEstimation:function(n){return e(n,"x-fb-dynamic-predictive-response-chunk-size")},getBandwidthMeanEstimate:function(t){var e=r("VideoPlayerOzWWWGlobalConfig").getString("bandwidth_estimate_header_key",""),n=r("VideoPlayerOzWWWGlobalConfig").getString("bandwidth_estimate_key","");return s(t,e,n)},getBandwidthStandardDeviationEstimate:function(n){return e(n,"x-bwe-std-dev")},getTimeToFirstByteMsEstimate:function(n){return e(n,"x-mrtt-ms")}},c=u;l.default=c}),98);
__d("oz-player/shims/OzNetworkDiagnostics",["oz-player/shims/www/OzNetworkDiagnosticsWWW"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/OzNetworkDiagnosticsWWW")}),98);
__d("oz-player/manifests/OzDynamicVideoLibrary",["oz-player/shims/OzNetworkDiagnostics"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$4=null,this.$5=null,this.$6=new RegExp(/(.*)\.(m4v|m4a)(\?|$)/),this.$7={m4a:{time:0},m4v:{time:0}},this.$8={audio:"m4a",video:"m4v"},this.$9={};var t=e.config;this.$3=t}var t=e.prototype;return t.getLastSegmentStartPTS=function(){return this.$1},t.getLast200RequestedTime=function(){return this.$5},t.getLast200RequestedUrlDecisionMinTime=function(){var e=[];for(var t in this.$7)e.push(this.$7[t].time);return Math.min.apply(Math,e)},t.getLast200RequestedUrlDecisionTimeByMimeType=function(t){var e;return(e=this.$7[this.$8[t]])==null?void 0:e.time},t.updateWithResponse=function(t,n,o,a){var e;!a.headers||a.status!=200||(this.$5=n,this.$1=(e=r("oz-player/shims/OzNetworkDiagnostics").getDvlSegmentPTS(a.headers))!=null?e:this.$1,this.$2=r("oz-player/shims/OzNetworkDiagnostics").getDvlStatus(a.headers),this.$10(t,o),(this.$2!=null||this.$2==="200")&&(this.$4=n))},t.$10=function(t,n){var e=this.$6.exec(t);if(e!=null){var r=e[2];n!=null&&(this.$7[r]={time:n})}},t.shouldRequestDynamicInfo=function(t){if(t!=="video")return!1;this.$11(t);var e=this.$12(t);return e!=null&&e<=this.$3.getNumber("dvl_initial_segment_ignore_count")?!1:this.$3.getNumber("dvl_update_interval_ms")==0||this.$4==null||this.$4+this.$3.getNumber("dvl_update_interval_ms")<=Date.now()},t.$11=function(t){return this.$9[t]==null&&(this.$9[t]={segmentCount:0}),this.$9[t].segmentCount=this.$9[t].segmentCount!=null?this.$9[t].segmentCount+1:0},t.$12=function(t){return this.$9[t].segmentCount},e})();l.default=e}),98);
__d("oz-player/manifests/OzRepresentationBase",["oz-player/parsers/getMIMECodecs","oz-player/shims/ozvariant","oz-player/utils/OzErrorUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n,r,o,a,i,l,s,u,c,d,m){this.$1=e,this.$2=t,this.$11=n,this.$6=i,this.$3=r,this.$4=o,this.$5=a,this.$7=l,this.$8=s,this.$9=u,this.$10=c,this.$12=d,this.$13=m}var t=e.prototype;return t.getContentProtectionXml=function(){return this.$2},t.getID=function(){return this.$11},t.getBandwidth=function(){return this.$10},t.getMimeCodecs=function(){return r("oz-player/parsers/getMIMECodecs")(this.$3,this.$4)},t.getMimeType=function(){return this.$3},t.getCodecs=function(){return this.$4},t.getVariantKey=function(){return this.$5},t.getLang=function(){return this.$6},t.getRole=function(){return this.$7},t.getDisplayLabel=function(){return this.$11},t.getInitSegment=function(){return this.$8},t.getCustomFieldFirstSegment=function(){return this.$12},t.getCustomField=function(t){if(this.$13==null||!this.$13[t])throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_REPRESENTATION_PARSER",description:"Custom field "+t+" is not specified by caller",extra:{code:"OZ_RP-8"}});var e=this.$13[t];try{return e(this.$1)}catch(e){return null}},t.updateWith=function(n){n instanceof e||r("oz-player/shims/ozvariant")(0,229),this.$9.updateWith(n.$9)},t.getSegmentByTime=function(t){return this.$9.getSegmentByTime(t)},t.getSegment=function(t){return this.$9.getSegment(t)},t.getPredictedSegmentAfter=function(t){return this.$9.getPredictedSegmentAfter(t)},t.canPredict=function(){return this.$9.canPredict()},t.canApproximateId=function(){return this.$9.canApproximateId()},t.getSegmentAfter=function(t){return this.$9.getSegmentAfter(t)},t.isEndingSegment=function(t){return this.$9.isEndingSegment(t)},t.addUpdateListener=function(t){return this.$9.addUpdateListener(t)},t.getTimeRanges=function(){return this.$9.getTimeRanges()},t.blockTimeRange=function(t){this.$9.blockTimeRange(t)},t.getEndingSegment=function(){return this.$9.getEndingSegment()},t.getMaxGopSec=function(){return this.$9.getMaxGopSec()},e})();l.default=e}),98);
__d("oz-player/manifests/OzVideoRepresentation",["oz-player/manifests/OzRepresentationBase"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n,r,o,a,i,l,s,u,c,d,m,p,_,f){var g;if(g=e.call(this,t,n,r,o,a,i,l,s,u,c,d,m,p)||this,g.$OzVideoRepresentation$p_5=null,g.$OzVideoRepresentation$p_6=null,g.$OzVideoRepresentation$p_7=null,g.$OzVideoRepresentation$p_1=_,g.$OzVideoRepresentation$p_2=f,g.$OzVideoRepresentation$p_4=p,g.$OzVideoRepresentation$p_3=t,p!=null){if(p.playbackResolutionMos!=null){var h=g.getCustomField("playbackResolutionMos");g.$OzVideoRepresentation$p_7=h!=null?String(h):null}if(p.playbackResolutionCsvqm!=null){var y=g.getCustomField("playbackResolutionCsvqm");g.$OzVideoRepresentation$p_6=y!=null?String(y):null}}return g}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.getQualityScoreCurveString=function(t){return t==="csvqm"?this.$OzVideoRepresentation$p_6:this.$OzVideoRepresentation$p_7},n.getWidth=function(){return this.$OzVideoRepresentation$p_1},n.getHeight=function(){return this.$OzVideoRepresentation$p_2},n.getDisplayLabel=function(){if(this.$OzVideoRepresentation$p_5!=null)return this.$OzVideoRepresentation$p_5;var e=this.$OzVideoRepresentation$p_4?this.$OzVideoRepresentation$p_4.qualityLabel:null;return e&&(this.$OzVideoRepresentation$p_5=e(this.$OzVideoRepresentation$p_3)),(this.$OzVideoRepresentation$p_5==null||this.$OzVideoRepresentation$p_5=="")&&(this.$OzVideoRepresentation$p_5=this.getHeight().toString()+"p"),this.$OzVideoRepresentation$p_5||""},t})(r("oz-player/manifests/OzRepresentationBase"));l.default=e}),98);
__d("oz-player/utils/OzMimeUtil",[],(function(t,n,r,o,a,i){"use strict";function e(e){return(e.split("/")[0]||"").trim()}function l(e){var t=(e.split(";")[0]||"").trim(),n=(t.split("/")[1]||"").trim();return n}function s(e){var t=e.split('codecs="').pop();return t.split(".")[0].trim()}i.getMimeType=e,i.getContainerType=l,i.getParsedCodecFamily=s}),66);
__d("oz-player/media_source/OzMSESourceBufferImpl",["oz-player/shims/OzDOMEventListener","oz-player/utils/OzErrorUtils","oz-player/utils/OzMimeUtil"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n,r){this.$1=e,this.$2=n,this.$3=t,this.$4=r}var t=e.prototype;return t.registerOnUpdateStartListener=function(t){return r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$1,"updatestart",t)},t.registerOnUpdateEndListener=function(t){return r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$1,"updateend",t)},t.registerOnUpdateListener=function(t){return r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$1,"update",t)},t.registerOnErrorListener=function(t){return r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$1,"error",t)},t.getIsUpdating=function(){return this.$1.updating},t.getBuffered=function(){return this.$1.buffered},t.setAppendWindowEnd=function(t){this.$1.appendWindowEnd=t},t.appendBuffer=function(t,n){var e,r=(e=o("oz-player/utils/OzMimeUtil")).getMimeType(n)!==e.getMimeType(this.$3),a=e.getContainerType(n)!==e.getContainerType(this.$3),i=e.getParsedCodecFamily(n)!==e.getParsedCodecFamily(this.$3);if(r||a||i)if(this.$4){try{this.$1.changeType(n)}catch(e){throw o("oz-player/utils/OzErrorUtils").createOzError({description:'SourceBufferChangeTypeError: Failed to changeType("'+n+'"): '+String(e)+" current MIME Codecs: "+this.$3,type:"OZ_SOURCE_BUFFER_CHANGE_TYPE"})}this.$3=n}else throw o("oz-player/utils/OzErrorUtils").createOzError({description:"SourceBufferChangeTypeError: attempted to call changeType() on a SourceBuffer that does not support it.",type:"OZ_SOURCE_BUFFER_CHANGE_TYPE_UNAVAILABLE"});this.$1.appendBuffer(t)},t.abort=function(){this.$1.abort()},t.remove=function(t,n){this.$1.remove(t,n)},e})();l.default=e}),98);
__d("oz-player/media_source/OzMediaErrorProvider",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){this.$1=e}var t=e.prototype;return t.hasError=function(){return this.$1.error!==null},t.getMediaErrorName=function(){var e=this.$1.error;return e!=null&&e.message!=null&&e.message!==""?this.$2(e.message):null},t.getErrorCode=function(){var e=this.$1.error;return e&&e.code?e.code:null},t.getVideoNode=function(){return this.$1},t.$2=function(t){return t.replace(/([0-9]{2,})/g,function(e){for(var t="";t.length<e.length;)t+="#";return t})},e})();i.default=e}),66);
__d("oz-player/utils/OzSourceBufferUtil",["oz-player/utils/OzNumericalRangeUtil"],(function(t,n,r,o,a,i,l){"use strict";function e(e){for(var t=0,n=0;n<e.getBuffered().length;n++)t+=e.getBuffered().end(n)-e.getBuffered().start(n);return t}function s(e){return e.reduce(function(e,t){return e+(t.endTime-t.startTime)},0)}function u(e){return e.getBuffered().length===0?0:e.getBuffered().start(0)}function c(e){var t=null;try{t=e.getBuffered()}catch(e){return 0}return t.length===0?0:t.end(t.length-1)}function d(e){for(var t=[],n=0;n<e.length;n++)t.push({startTime:e.start(n),endTime:e.end(n)});return t}function m(e,t,n){var r=o("oz-player/utils/OzNumericalRangeUtil").findCurrentRangeIndex(n,t,e.map(function(e){return{rangeStart:e.startTime,rangeEnd:e.endTime}})),a=r>=0?parseFloat((e[r].endTime-t).toFixed(3)):0,i=r>=0?e.length-1-r:-1;return{bufferAheadSec:a,bufferedOffset:i}}function p(e,t,n){var r=e.map(function(e){return{rangeStart:e.startTime,rangeEnd:e.endTime}}),a=o("oz-player/utils/OzNumericalRangeUtil").findCurrentRangeIndex(n,t,r),i=parseFloat(r.reduce(function(e,n){var r=n.rangeEnd;return r==null?e:e+(o("oz-player/utils/OzNumericalRangeUtil").isWithin(t,n)?r-t:o("oz-player/utils/OzNumericalRangeUtil").isLargerThan(n.rangeStart,t)?r-n.rangeStart:0)},0).toFixed(3)),l=a>=0?e.length-1-a:-1;return{bufferAheadSec:i,bufferedOffset:l}}l.getTotalBufferedTime=e,l.getTotalInBufferedRanges=s,l.getStartBufferedTime=u,l.getEndBufferedTime=c,l.convertToBufferedTimeRangeArray=d,l.getBufferAheadInBufferedRanges=m,l.getTotalBufferAheadOfPosition=p}),98);
__d("oz-player/media_source/SourceBufferManagerUtils",["oz-player/utils/OzSourceBufferUtil"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var r=o("oz-player/utils/OzSourceBufferUtil").getEndBufferedTime(t);return function(){var e=o("oz-player/utils/OzSourceBufferUtil").getEndBufferedTime(t);return{startTime:r,endTime:e}}}l.startMeasuringAppendedBuffer=e}),98);
__d("oz-player/shims/www/OzDeferredWWW",["Deferred"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("Deferred")}),98);
__d("oz-player/shims/OzDeferred",["oz-player/shims/www/OzDeferredWWW"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/OzDeferredWWW")}),98);
__d("oz-player/utils/OzFakeEventTarget",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(){this.$1={}}var t=e.prototype;return t.dispatchEvent=function(t){this.$1[t]!=null&&this.$1[t].forEach(function(e){return e()})},t.addEventListener=function(t,n){var e=this;return this.$1[t]===void 0&&(this.$1[t]=new Set),this.$1[t].add(n),{remove:function(){e.removeEventListener(t,n)}}},t.removeEventListener=function(t,n){this.$1[t]&&this.$1[t].delete(n)},t.destroy=function(){this.$1={}},e})();i.default=e}),66);
__d("oz-player/states/OzObservedSourceBufferState",["oz-player/shims/OzSubscriptionsHandler","oz-player/utils/OzFakeEventTarget"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n){var o;return o=e.call(this)||this,o.$OzObservedSourceBufferState$p_2=new(r("oz-player/shims/OzSubscriptionsHandler")),o.$OzObservedSourceBufferState$p_3=[],o.$OzObservedSourceBufferState$p_6=function(){var e;try{e=o.$OzObservedSourceBufferState$p_1.getBuffered()}catch(e){if(e instanceof Error&&e.name==="InvalidStateError"){o.$OzObservedSourceBufferState$p_3=[];return}else throw e}for(var t=[],n=0;n<e.length;n++)t.push({startTime:e.start(n),endTime:e.end(n)});o.$OzObservedSourceBufferState$p_3=t},o.$OzObservedSourceBufferState$p_1=t,o.$OzObservedSourceBufferState$p_4=n,o.$OzObservedSourceBufferState$p_5(),o}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.$OzObservedSourceBufferState$p_5=function(){var e=this;this.$OzObservedSourceBufferState$p_2.release(),this.$OzObservedSourceBufferState$p_2=new(r("oz-player/shims/OzSubscriptionsHandler")),this.$OzObservedSourceBufferState$p_2.addSubscriptions(this.$OzObservedSourceBufferState$p_1.registerOnUpdateEndListener(function(){e.$OzObservedSourceBufferState$p_6(),e.dispatchEvent("buffer_updated")}),this.$OzObservedSourceBufferState$p_1.registerOnErrorListener(this.$OzObservedSourceBufferState$p_6))},n.setSourceBuffer=function(t){this.$OzObservedSourceBufferState$p_1=t,this.$OzObservedSourceBufferState$p_5(),this.$OzObservedSourceBufferState$p_6()},n.getBufferedRanges=function(){return this.$OzObservedSourceBufferState$p_3},n.destroy=function(){e.prototype.destroy.call(this),this.$OzObservedSourceBufferState$p_2.release(),this.$OzObservedSourceBufferState$p_2.engage()},t})(r("oz-player/utils/OzFakeEventTarget"));l.default=e}),98);
__d("oz-player/utils/OzCustomErrorCode",[],(function(t,n,r,o,a,i){"use strict";var e={APPEND_BUFFER_UNKNOWN_ERROR:"21539",APPEND_BUFFER_INVALID_STATE_ERROR_SOURCE_BUFFER_HAS_BEEN_REMOVED:"21540",APPEND_BUFFER_MEDIA_ERROR_ATTRIBUTE_NOT_NULL:"21541",APPEND_BUFFER_SOURCE_BUFFER_UPDATING_ATTRIBUTE_IS_TRUE:"21542",SOURCE_BUFFER_MANAGER_ADD_SOURCE_BUFFER_ERROR:"21543",SOURCE_BUFFER_MANAGER_CREATE_ERROR:"21544",SETUP_STREAMS_PROMISE_REJECTION:"21545",APPEND_BUFFER_QUOTA_EXCEEDED_ERROR:"21546",APPEND_BUFFER_INVALID_STATE_ERROR:"21547",SOURCE_BUFFER_MANAGER_UPDATEEND_UNKNOWN_ERROR:"21548",NETWORK_REQUEST_STREAM_RETRY_HANDLER_ERROR:"21549",STREAM_APPEND_QUOTA_EXCEEDED_HANDLER_ERROR:"21550",SOURCE_BUFFER_MANAGER_CLEAR_RANGE_FAILED:"21551",WEBVTT_CAPTION_PARSE_ERROR:"21552"},l=e;i.default=l}),66);
__d("oz-player/media_source/SourceBufferManager",["Promise","oz-player/loggings/OzLoggingUtils","oz-player/media_source/SourceBufferManagerUtils","oz-player/shims/OzDOMEventListener","oz-player/shims/OzDeferred","oz-player/shims/OzMaybeNativePromise","oz-player/shims/OzStreams","oz-player/shims/OzSubscriptionsHandler","oz-player/states/OzObservedSourceBufferState","oz-player/utils/OzCustomErrorCode","oz-player/utils/OzErrorUtils","oz-player/utils/ozConcatUint8Arrays"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(e,t,n,a,i,l){var s=this;l===void 0&&(l=null),this.$4=null,this.$5=new(r("oz-player/shims/OzSubscriptionsHandler")),this.$7=!1,this.$8=[],this.$12=!1,this.$13=!1,this.$14=0,this.$26=function(){if(s.$10.hasError()){s.$13=!1,s.$12=!1;var e=s.$10.getMediaErrorName(),t=e!=null?e:"An unknown source buffer error occurred.",n=s.$10.getErrorCode(),a=n!=null?String(n):r("oz-player/utils/OzCustomErrorCode").SOURCE_BUFFER_MANAGER_UPDATEEND_UNKNOWN_ERROR,i=o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SOURCE_BUFFER",description:t,extra:{code:a}});s.$4&&s.$4.reject(i),s.$4=null,s.cancelOperationAndCleanQueue()}else if(!s.$13){s.$13=!0;var l=s.$10.getVideoNode(),u=s.$26,c=r("oz-player/shims/OzDOMEventListener").listenDOMEvent(l,"error",u);s.$5.addSubscriptions(c)}},this.$17=function(){var e=s.$2;if(e!=null){var t;e.getOperationLogger("source_buffer_updateend").setError((t=s.$10.getMediaErrorName())!=null?t:void 0).setCode(s.$10.getErrorCode()).setResult(s.$12?"failed":"success").log()}var n=s.$4;n&&(s.$12?s.$26():(n.resolve(),s.$4&&(s.$4=null)))},this.$18=function(){var e=s.$2;if(e!=null){var t;e.getOperationLogger("source_buffer_error").setError((t=s.$10.getMediaErrorName())!=null?t:void 0).setCode(s.$10.getErrorCode()).setResult("failed").log()}s.$12=!0},this.$1=e,this.$2=l,this.$3=t,this.$11=n,this.$16(),this.$9=new(r("oz-player/states/OzObservedSourceBufferState"))(this.$3,this.$11),this.$10=a,this.$15=i}var a=t.prototype;return a.$16=function(){this.$5.release(),this.$5=new(r("oz-player/shims/OzSubscriptionsHandler")),this.$5.addSubscriptions(this.$3.registerOnUpdateEndListener(this.$17),this.$3.registerOnErrorListener(this.$18))},a.setSourceBuffer=function(t){t!=null&&(this.cancelOperationAndCleanQueue(),this.$3=t,this.$16(),this.$9.setSourceBuffer(t))},a.queueData=function(t,n,o,a,i){a===void 0&&(a=null),i===void 0&&(i=0);var e=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise"));this.$8.push({data:t,deferred:e,loggerProvider:a,appendTarget:i,mimeCodecs:n,clearSourceBufferRange:o});var l=e.getPromise();return this.$7||this.$19().catch(function(e){}),l},a.cancelOperationAndCleanQueue=function(t){t===void 0&&(t=null),t&&t.cloneContext().getOperationLogger("source_buffer_cancel_and_clean").log();var e=o("oz-player/utils/OzErrorUtils").createOzCancelledError("SBM cancel and clean");this.$8.forEach(function(t){var n=t.deferred;n.reject(e)}),this.$8=[];try{this.$11.getBool("enable_alternative_audio_tracks")?this.$15()==="open"&&(this.$10.hasError()||this.$3.abort()):this.$15()!=="closed"&&(this.$10.hasError()||this.$3.abort())}catch(e){var n=e;t&&t.cloneContext().getOperationLogger("cancel_operation_abort_failed").setError(n).setReason(this.$15?this.$15():null).log()}var r=this.$4;r&&r.reject(e),this.$6&&(this.$6.reject(e),this.$6=null)},a.getSourceBufferState=function(){return this.$9},a.$20=function(t,n){var e=Math.max(t,0);n>0&&n>e&&this.$3.remove(e,n)},a.$21=function(t,n){var e=Math.max(t,0);if(n>0&&n>e){var o=this.$22();return this.$20(e,n),o}return r("oz-player/shims/OzMaybeNativePromise").resolve()},a.clearRangeWithWait=function(r){var t=this;return this.cancelOperationAndCleanQueue(),r.reduce(function(e,n){var r=n.fromTime,o=n.toTime;return e.then(function(){return t.$21(r,o)})},(e||(e=n("Promise"))).resolve())},a.$22=function(t){var e=this.$4=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise")),n=e.getPromise();return t&&o("oz-player/loggings/OzLoggingUtils").monitorPromiseAndLogOperation(n,t,"wait_for_source_buffer"),n},a.$23=function(t,n,a,i){var e=this,l=function(){var l=e.$4=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise")),s=!1,u=!0;try{u=!!e.$3.getBuffered()}catch(e){u=!1}try{if(s=e.$3.getIsUpdating(),u)e.$3.appendBuffer(t,n);else return l.resolve(),l.getPromise()}catch(t){var c=t,d=r("oz-player/utils/OzCustomErrorCode").APPEND_BUFFER_UNKNOWN_ERROR,m=c.name,p=c.message;m==="QuotaExceededError"?d=r("oz-player/utils/OzCustomErrorCode").APPEND_BUFFER_QUOTA_EXCEEDED_ERROR:e.$10.hasError()?d=r("oz-player/utils/OzCustomErrorCode").APPEND_BUFFER_MEDIA_ERROR_ATTRIBUTE_NOT_NULL:s?d=r("oz-player/utils/OzCustomErrorCode").APPEND_BUFFER_SOURCE_BUFFER_UPDATING_ATTRIBUTE_IS_TRUE:m==="InvalidStateError"&&typeof p=="string"&&/SourceBuffer has been removed/.test(p)?d=r("oz-player/utils/OzCustomErrorCode").APPEND_BUFFER_INVALID_STATE_ERROR_SOURCE_BUFFER_HAS_BEEN_REMOVED:m==="InvalidStateError"&&(d=r("oz-player/utils/OzCustomErrorCode").APPEND_BUFFER_INVALID_STATE_ERROR);var _=o("oz-player/utils/OzErrorUtils").createOzError({type:o("oz-player/utils/OzErrorUtils").isOzError(c)?c.getType():m==="QuotaExceededError"?"OZ_SOURCE_BUFFER_QUOTA_EXCEEDED":m==="OZ_SOURCE_BUFFER_CHANGE_TYPE"?"OZ_SOURCE_BUFFER_CHANGE_TYPE":"OZ_SOURCE_BUFFER",description:"SBM#"+e.$1+" appendBuffer("+n+") failed: "+String(p),extra:o("oz-player/utils/OzErrorUtils").isOzError(c)?c.getExtra():{originalError:c,code:d}});e.$4=null,l.reject(_)}var f=l.getPromise();return a&&o("oz-player/loggings/OzLoggingUtils").monitorPromiseAndLogOperation(f,a,"append",function(e){var n;e.setLength(t.byteLength);var r=(n=i==null?void 0:i.appendTarget)!=null?n:null;e.setAppendTarget(r)}),f};return this.$3.getIsUpdating()?this.$22(a).then(l).catch(function(e){throw e}):(this.$14+=t.byteLength,l())},a.$19=function(){var e=this;if(this.$7)return r("oz-player/shims/OzMaybeNativePromise").reject(this.$24("Another unit of queued data is being appended."));var t=this.$8.shift();if(!t)return this.$7=!1,r("oz-player/shims/OzMaybeNativePromise").resolve();var n=t.appendTarget,a=t.clearSourceBufferRange,i=t.data,l=t.deferred,s=t.loggerProvider,u=t.mimeCodecs;this.$7=!0;var c,d=function(){return i instanceof o("oz-player/shims/OzStreams").OzReadableStream?e.$25(i,u,s,n):e.$23(i,u,s,{appendTarget:n})};a?(c=this.$3.getIsUpdating()?this.$22(s):r("oz-player/shims/OzMaybeNativePromise").resolve(),c=c.then(function(){return e.clearRangeWithWait([{fromTime:a[0],toTime:a[1]}])}).then(d)):c=d();var m=o("oz-player/media_source/SourceBufferManagerUtils").startMeasuringAppendedBuffer(this.$11,this.$3,this.$9);return c.catch(function(e){l.reject(e)}).then(function(){var t=m(),n=t.endTime,r=t.startTime;l.resolve({startTime_UNSAFE:r,endTime_UNSAFE:n,appendedSec:n-r}),e.$7=!1,e.$19().catch(function(e){})})},a.$25=function(t,n,a,i){var e=this,l=[],s=0,u=t.getReader(),c=function(){var t=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise"));return e.$6=t,u.read().then(function(n){t.resolve(n),e.$6=null}).catch(function(n){t.reject(n),e.$6=null}),t.getPromise().then(function(t){if(t.done){var o=r("oz-player/utils/ozConcatUint8Arrays")(l),u=o.buffer;return l.length=0,s=0,u.byteLength>0?e.$23(u,n,a,{appendTarget:i}):r("oz-player/shims/OzMaybeNativePromise").resolve()}var d=t.value,m=d;if(i>0){var p=d instanceof Uint8Array?d:new Uint8Array(d);if(l.push(p),s+=p.byteLength,s>=i){var _=r("oz-player/utils/ozConcatUint8Arrays")(l),f=_.buffer;l.length=0,s=0,m=f}}return m&&m.byteLength>=i?e.$23(m,n,a,{appendTarget:i}).then(function(){return c()}):c()},function(t){if(e.$11.getBool("enable_alternative_audio_tracks"))try{e.$15()==="open"&&(e.$10.hasError()||e.$3.abort())}catch(e){var a=e}else try{e.$3.abort()}catch(e){var i=e}if(typeof t=="object"&&o("oz-player/utils/OzErrorUtils").isOzError(t))return r("oz-player/shims/OzMaybeNativePromise").reject(t);if(typeof t=="object"&&t!=null&&typeof t.name=="string"&&t.name==="TypeError"&&typeof t.message=="string"&&t.message.includes("network error")){var l=o("oz-player/utils/OzErrorUtils").convertPromiseRejectionReasonToOzError(t,{description:"SBM#"+e.$1+" appendReadableStream("+n+") failed: Stream read is interrupted (previously TypeError network error)}",extra:{originalError:t},type:"OZ_NETWORK"});return r("oz-player/shims/OzMaybeNativePromise").reject(l)}var s=o("oz-player/utils/OzErrorUtils").convertPromiseRejectionReasonToOzError(t,{description:"SBM#"+e.$1+" appendReadableStream("+n+") failed: Unexpected error while reading from stream: "+String(t),extra:{originalError:t},type:"OZ_NETWORK"});return r("oz-player/shims/OzMaybeNativePromise").reject(s)})};return c()},a.$24=function(t){var e=this.$2;return e!=null&&e.getOperationLogger("source_buffer_invariant").setError(t).setResult("failed").log(),o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SOURCE_BUFFER",description:"SBM invariant: "+t})},a.destroy=function(){var e=this,t=this.$2;t&&t.cloneContext().getOperationLogger("source_buffer_destroy").log();var n=this.$4;n&&(this.$13?n.getPromise().catch(function(){e.$4=null,e.$5.release(),e.$5=new(r("oz-player/shims/OzSubscriptionsHandler"))}):(n.reject(o("oz-player/utils/OzErrorUtils").createOzCancelledError("SBM destroyed")),this.$4=null,this.$5.release(),this.$5=new(r("oz-player/shims/OzSubscriptionsHandler")))),this.$9.destroy()},a.getDebug=function(){return{SourceBuffer:this.$3}},t})();l.default=s}),98);
__d("oz-player/shims/www/getOzVTTSourceBufferImplLazyWWW",["JSResourceForInteraction"],(function(t,n,r,o,a,i,l){"use strict";var e=r("JSResourceForInteraction")("OzVTTSourceBufferImpl").__setRef("oz-player/shims/www/getOzVTTSourceBufferImplLazyWWW");function s(){return e.load()}l.default=s}),98);
__d("oz-player/shims/www/getOzVTTSourceBufferImplWWW",["oz-player/shims/www/getOzVTTSourceBufferImplLazyWWW"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/getOzVTTSourceBufferImplLazyWWW")}),98);
__d("oz-player/shims/getOzVTTSourceBufferImpl",["oz-player/shims/www/getOzVTTSourceBufferImplWWW"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/getOzVTTSourceBufferImplWWW")}),98);
__d("oz-player/shims/www/ozClearTimeoutWWW",["clearTimeout"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("clearTimeout")}),98);
__d("oz-player/shims/ozClearTimeout",["oz-player/shims/www/ozClearTimeoutWWW"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/ozClearTimeoutWWW")}),98);
__d("oz-player/shims/www/ozSetTimeoutAcrossTransitionsWWW",["setTimeoutAcrossTransitions"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("setTimeoutAcrossTransitions")}),98);
__d("oz-player/shims/ozSetTimeoutAcrossTransitions",["oz-player/shims/www/ozSetTimeoutAcrossTransitionsWWW"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/ozSetTimeoutAcrossTransitionsWWW")}),98);
__d("oz-player/utils/ozGetErrorNameFromMediaErrorCode",[],(function(t,n,r,o,a,i){"use strict";function e(e){switch(e){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:}return"MEDIA_ERR_UNKNOWN"}i.default=e}),66);
__d("oz-player/media_source/MediaSourceManager",["oz-player/loggings/OzMultiDestinationPerfLogger","oz-player/media_source/OzMSESourceBufferImpl","oz-player/media_source/OzMediaErrorProvider","oz-player/media_source/SourceBufferManager","oz-player/shims/OzDOMEventListener","oz-player/shims/OzDeferred","oz-player/shims/OzMaybeNativePromise","oz-player/shims/OzSubscriptionsHandler","oz-player/shims/getOzVTTSourceBufferImpl","oz-player/shims/ozClearTimeout","oz-player/shims/ozReportUnexpectedError","oz-player/shims/ozSetTimeoutAcrossTransitions","oz-player/shims/ozThrottle","oz-player/utils/OzCustomErrorCode","oz-player/utils/OzErrorEmitter","oz-player/utils/OzErrorUtils","oz-player/utils/OzMimeUtil","oz-player/utils/ozGetErrorNameFromMediaErrorCode"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){var t=this,n=e.videoNode,a=e.config,i=e.perfLoggerProvider,l=i===void 0?new(o("oz-player/loggings/OzMultiDestinationPerfLogger")).OzMultiDestinationPerfLoggerProvider([]):i,s=e.isChangeTypeSupported,u=e.useManagedMediaSource,c=e.handleVttCaptionsUpdated,d=e.onClearVideoNodeError,m=e.onRetryVideoElementError;this.$3=new(r("oz-player/shims/OzSubscriptionsHandler")),this.$4=new(r("oz-player/shims/OzSubscriptionsHandler")),this.$6=[],this.$7=new Map,this.$8=[],this.$10=!1,this.$12=!1,this.$13=!1,this.$14=!1,this.$15=!1,this.$18=null,this.$19=null,this.$20=new(r("oz-player/utils/OzErrorEmitter")),this.$22="undetected",this.$23=!1,this.$24=!1,this.$31=function(){if(t.$34()||(t.$10=!1),!!t.$35()){var e=t.$8.shift();e&&(e(t.$2),t.$10=!0)}},this.$5=l,this.$11=a,this.$1=n,this.$21=c,this.$16=d,this.$17=m,this.$23=s,this.$24=u,this.$9=new(r("oz-player/media_source/OzMediaErrorProvider"))(this.$1),this.$3.addSubscriptions(r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$1,"error",function(){var e;t.$5.getOperationLogger("media_element_error").setError((e=t.$9.getMediaErrorName())!=null?e:void 0).setCode(t.$9.getErrorCode()).setResult("failed").setUserInfo({av1HardwareSupport:t.$22}).log(),t.$8=[],t.$6=[],t.$4.release(),t.$4=new(r("oz-player/shims/OzSubscriptionsHandler")),t.$15=t.$15||t.$14||t.$13;var n=t.$1.error,a=(n==null?void 0:n.code)||0,i=!n&&t.$1.poster!=null&&t.$1.poster!=="",l=o("oz-player/utils/OzErrorUtils").createOzError({type:i?"OZ_POSSIBLE_POSTER_LOAD_FAILURE":r("oz-player/utils/ozGetErrorNameFromMediaErrorCode")(a),description:(n==null?void 0:n.message)!=null?n.message:"",extra:{originalError:n,code:String(a)}});if(t.$19!=null){t.$5.getOperationLogger("media_element_error").setError(n).setCode(a).setReason("mitigation_failed").setResult("failed").setUserInfo({av1HardwareSupport:t.$22}).log(),t.$20.emitError(l);return}t.$19=t.$1.currentTime,t.$18==null&&(t.$18=r("oz-player/shims/ozSetTimeoutAcrossTransitions")(function(){t.$18=null,t.$11.getBool("retry_video_element_error")&&(t.$17!=null&&t.$17(l),t.$25())},0))}),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$1,"play",function(){t.$14=!0}),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$1,"playing",function(){t.$14=!1,t.$15=!1,t.$19=null,t.$13=!0}),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$1,"pause",function(){t.$14=!1,t.$13=!1,t.$15=!!t.$1.error}),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$1,"ended",function(){t.$14=!1,t.$13=!1})),this.$2=this.$26(),this.$5.getOperationLogger("media_source_new").log(),this.$3.addSubscriptions(r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$2,"sourceopen",function(){t.$5.getOperationLogger("media_source_open").log()}),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$2,"sourceended",function(){t.$5.getOperationLogger("media_source_ended").log()}),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$2,"sourceclose",function(){t.$5.getOperationLogger("media_source_close").log()})),this.$27(this.$2)}var t=e.prototype;return t.$26=function(){return this.$24?new ManagedMediaSource:new MediaSource},t.$27=function(t){var e=this.$1,n=e.src;n!==""&&URL.revokeObjectURL(n),t?(this.$24&&(e.disableRemotePlayback=!0),e.src=URL.createObjectURL(t)):(e.removeAttribute("src"),e.removeAttribute("srcObject"))},t.$25=function(){var e=this;this.$7.forEach(function(e){e.cancelOperationAndCleanQueue()}),this.$2=this.$26(),this.$27(this.$2),this.$7.forEach(function(e,t){e.setSourceBuffer(null)});var t=this.$28().then(function(){var t=[];return e.$7.forEach(function(n,r){var o=e.$29(r).then(function(t){n.setSourceBuffer(t),e.$30(t,r)});t.push(o)}),r("oz-player/shims/OzMaybeNativePromise").all(t)});t.then(function(){if(e.$16&&e.$16(),e.$19!=null&&(e.$1.currentTime=e.$19),e.$15){var t=e.$1.play();return t==null?void 0:t.catch(function(){})}}).catch(function(t){e.$20.emitError(t)})},t.$28=function(){var e=this;if(this.$11.getBool("msm_refactor_wait_for_sourceopen")){if(this.$2.readyState==="open")return r("oz-player/shims/OzMaybeNativePromise").resolve();var t=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise")),n=r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$2,"sourceopen",function(){n.remove(),t.resolve(),e.$31()});return this.$3.addSubscriptions(n),t.getPromise()}else{if(this.$2.readyState==="open")return r("oz-player/shims/OzMaybeNativePromise").resolve();var o=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise"));return this.$3.addSubscriptions(r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$2,"sourceopen",function(){o.resolve(),e.$31()})),o.getPromise()}},t.$29=function(t){var e=this;if(this.$11.getBool("msm_refactor_wait_for_sourceopen"))return r("oz-player/shims/OzMaybeNativePromise").resolve().then(function(){return e.$32(t)}).catch(function(e){var n=o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SOURCE_BUFFER",description:'Failed to addSourceBuffer("'+t+'"): '+String(e),extra:{originalError:e,code:r("oz-player/utils/OzCustomErrorCode").SOURCE_BUFFER_MANAGER_ADD_SOURCE_BUFFER_ERROR.toString()}});throw n});try{return this.$32(t)}catch(e){var n=o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SOURCE_BUFFER",description:'Failed to addSourceBuffer("'+t+'"): '+(e.message||String(e)),extra:{originalError:e,code:r("oz-player/utils/OzCustomErrorCode").SOURCE_BUFFER_MANAGER_ADD_SOURCE_BUFFER_ERROR.toString()}});throw n}},t.$32=function(t){var e=this;{var n;return t.includes("vtt")?n=this.$33(t):n=this.$28().then(function(){return new(r("oz-player/media_source/OzMSESourceBufferImpl"))(e.$2.addSourceBuffer(t),t,e.$11,e.$23)}),n.then(function(n){return e.$6.push(n),n.registerOnUpdateListener(function(){e.$5.cloneContext().getOperationLogger("source_buffer_update_start").setType(o("oz-player/utils/OzMimeUtil").getMimeType(t)).setMediaSourceSourceBuffer(o("oz-player/utils/OzMimeUtil").getMimeType(t),n).setType(o("oz-player/utils/OzMimeUtil").getMimeType(t)).log()}),e.$5.getOperationLogger("add_source_buffer").setMediaSourceSourceBuffer(o("oz-player/utils/OzMimeUtil").getMimeType(t),n).log(),n})}},t.$30=function(t,n){var e=this;this.$4.addSubscriptions(t.registerOnUpdateEndListener(function(){e.$31()}))},t.$33=function(t){var e=this;return r("oz-player/shims/getOzVTTSourceBufferImpl")().then(function(n){if(e.$21!=null){var a=new n({onCaptionsChanged:e.$21,config:e.$11}),i=r("oz-player/shims/ozThrottle")(function(){a.setCurrentVideoTime(e.$1.currentTime)},200);return e.$3.addSubscriptions(r("oz-player/shims/OzDOMEventListener").listenDOMEvent(e.$1,"timeupdate",function(){i()}),{remove:function(){i=function(){}}}),a}else throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SOURCE_BUFFER",description:'Failed to addSourceBuffer("'+t+'"): No handleVttCaptionsUpdated callback provided',extra:{code:r("oz-player/utils/OzCustomErrorCode").SOURCE_BUFFER_MANAGER_ADD_SOURCE_BUFFER_ERROR.toString()}})})},t.createSourceBufferManager=function(t,n,a,i){var e=this;return(this.$11.getBool("msm_refactor_wait_for_sourceopen")?this.$29(n).then(function(e){return[void 0,e]}):r("oz-player/shims/OzMaybeNativePromise").all([this.$28(),this.$29(n)])).then(function(a){var i=a[0],l=a[1],s=new(r("oz-player/media_source/SourceBufferManager"))(t,l,e.$11,e.$9,function(){return e.$2.readyState},e.$5.cloneContext().setType(o("oz-player/utils/OzMimeUtil").getMimeType(n)));return e.$30(l,n),e.$7.set(n,s),s}).catch(function(n){var a=o("oz-player/utils/OzErrorUtils").isOzError(n)?n.getExtra():void 0,i=a==null?void 0:a.code,l=o("oz-player/utils/OzErrorUtils").isOzError(n)?""+n.getType()+(i!=null?"#"+i:"")+": "+n.getDescription():String(n),s=o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SOURCE_BUFFER",description:"Failed to create SBM#"+t+": "+l+", support AAC-LC="+(e.$2.constructor.isTypeSupported("audio/mp4; codecs=mp4a.40.2")?"true":"false")+", readyState="+e.$2.readyState,extra:babelHelpers.extends({},a,{originalError:n,code:r("oz-player/utils/OzCustomErrorCode").SOURCE_BUFFER_MANAGER_CREATE_ERROR.toString()})});throw s})},t.getReadyState=function(){return this.$2.readyState},t.getMediaSource=function(){return this.$2},t.notifyEndOfStream=function(t,n){var e=this,o=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise"));return this.$3.addSubscriptions(r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$2,"sourceended",function(){o.resolve()})),this.$8.push(function(r){if(r.readyState==="open"){var o=e.$5.getOperationLogger("end_of_stream");o.setInitiator(t).setReason(n),o.log(),r.endOfStream()}}),this.$31(),o.getPromise()},t.updateDuration=function(t,n){var e=this,a=this.$2.duration;Number.isFinite(a)&&(!n||a>=t)||(this.$8.push(function(n){n.duration!==a&&!(isNaN(n.duration)&&isNaN(a))&&r("oz-player/shims/ozReportUnexpectedError")(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SOURCE_BUFFER",description:"mediaSource duration discrepancy: "+n.duration+" != "+a}),"MediaSourceManager updateDuration","warn");var i=e.$11.getBool("msm_refactor_wait_for_sourceopen")?n.duration!==1/0&&t<n.duration:t<n.duration;if(i){e.$5.getOperationLogger("media_source_update_duration").setMediaSourcePreviousDuration(n.duration).setMediaSourceNewDuration(t).setResult("failed").log();return}e.$5.getOperationLogger("media_source_update_duration").setMediaSourcePreviousDuration(n.duration).setMediaSourceNewDuration(t).log(),n.duration=t}),this.$31())},t.detach=function(){this.$18&&(r("oz-player/shims/ozClearTimeout")(this.$18),this.$18=null),this.$5.getOperationLogger("source_buffer_detach").unsetMediaSourceSourceBuffers(),this.$27(null);for(var e=0;e<this.$2.sourceBuffers.length;e++){var t=this.$2.sourceBuffers[e];this.$2.removeSourceBuffer(t)}this.$3.release(),this.$3.engage(),this.$4.release(),this.$4.engage(),this.$8=[],this.$10=!1,this.$12=!0},t.$35=function(){return!this.$34()&&this.$2.readyState==="open"&&!this.$10&&!this.$12},t.$34=function(){return this.$6.some(function(e){return e.getIsUpdating()})},t.onError=function(t){return this.$20.onError(t)},e})();l.default=e}),98);
__d("oz-player/media_source/OzMediaSeekableRangeManager",["oz-player/shims/OzSubscriptionsHandler"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){var n=this;this.$5=function(e){e===void 0&&(e=!0);var t=n.$2;if(t){var r=t.getTimeRanges();if(r.length){var o=r[r.length-1];n.$1.updateDuration(o.endTime,e)}}},this.$1=e,this.$3=new(r("oz-player/shims/OzSubscriptionsHandler")),this.$4=t}var t=e.prototype;return t.setTimeRangeProvider=function(t){this.$3.release(),this.$3.engage(),this.$3.addSubscriptions(t.addUpdateListener(this.$5)),this.$2=t},t.listenToMediaStreamInitAppended=function(t){var e=this;return t.addListener("initAppended",function(){e.$5(!1)})},t.destroy=function(){this.$3.release()},e})();l.default=e}),98);
__d("oz-player/networks/OzCreateErrorStream",["oz-player/shims/OzStreams"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return new(o("oz-player/shims/OzStreams")).OzReadableStream({pull:function(n){n.error(e)}})}l.default=e}),98);
__d("oz-player/shims/OzFetchAPI",[],(function(t,n,r,o,a,i){"use strict";var e=function(n,r){return t.fetch(n,r)},l=function(n,r){return new t.Response(n,r)};i.fetch=e,i.Response=l}),66);
__d("oz-player/networks/FetchWithTimeout",["oz-player/shims/OzFetchAPI","oz-player/shims/ozClearTimeout","oz-player/shims/ozSetTimeoutAcrossTransitions"],(function(t,n,r,o,a,i,l){"use strict";function e(e,n,a,i){var l=null,s;if("AbortController"in t&&a!=null&&a!=0){var u=new AbortController;l=r("oz-player/shims/ozSetTimeoutAcrossTransitions")(function(){return u.abort()},a),s=babelHelpers.extends({},n,{signal:u.signal})}else s=babelHelpers.extends({},n);return i!=null&&(s=babelHelpers.extends({},s,{referrer:i})),o("oz-player/shims/OzFetchAPI").fetch(e,s).then(function(e){return r("oz-player/shims/ozClearTimeout")(l),e})}l.default=e}),98);
__d("oz-player/networks/OzHTTPHeaders",["oz-player/shims/ozvariant"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){this.$1=new Map}var t=e.prototype;return t.append=function(t,n){var e=t.toLowerCase(),r=this.$1.get(e);r!=null?this.$1.set(e,r+", "+n):this.$1.set(e,n)},t.get=function(t){var e=t.toLowerCase(),n=this.$1.get(e);return n!=null?n:null},t.entries=function(){return this.$1.entries()},t.has=function(t){return this.get(t)!==null},e})(),s=t.Headers,u=s&&s.prototype,c=s&&u&&typeof u.append=="function"&&typeof u.entries=="function"&&typeof u.get=="function"&&typeof u.has=="function"?s:e;function d(e){if(e==null)return null;if(typeof e=="object"&&typeof e.append=="function"&&typeof e.get=="function"&&typeof e.has=="function"){if(typeof e.entries=="function")return e;if(typeof e.forEach=="function"){var t=new c;return e.forEach(function(e,n){t.append(n,e)}),t}}return r("oz-player/shims/ozvariant")(!1,"Malformed Headers object: %s %s",typeof e,String(e)),null}l.OzHTTPHeaders=c,l.maybeConvertHeadersToOzHTTPHeaders=d}),98);
__d("oz-player/utils/arrayBuffer2OzReadableStream",["oz-player/shims/OzStreams"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return new(o("oz-player/shims/OzStreams")).OzReadableStream({start:function(n){var t=new Uint8Array(e);n.enqueue(t),n.close()}})}l.default=e}),98);
__d("oz-player/utils/maybeConvertReadableStreamToOzReadableStream",["oz-player/shims/OzStreams"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(!o("oz-player/shims/OzStreams").OzReadableStreamIsPolyfilled)return e;var t=e.getReader();return new(o("oz-player/shims/OzStreams")).OzReadableStream({start:async function(n){for(;;){var e=await t.read();if(e.done)break;n.enqueue(e.value)}n.close()}})}l.default=e}),98);
__d("oz-player/utils/processFetchResponse",["oz-player/networks/OzHTTPHeaders","oz-player/shims/OzMaybeNativePromise","oz-player/utils/arrayBuffer2OzReadableStream","oz-player/utils/maybeConvertReadableStreamToOzReadableStream"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.body,n=e.headers,a=e.ok,i=e.status;return t!=null?r("oz-player/shims/OzMaybeNativePromise").resolve({ok:a,status:i,headers:o("oz-player/networks/OzHTTPHeaders").maybeConvertHeadersToOzHTTPHeaders(n),body:r("oz-player/utils/maybeConvertReadableStreamToOzReadableStream")(t),arrayBuffer:function(){return e.arrayBuffer()}}):e.arrayBuffer().then(function(e){return{ok:a,status:i,headers:o("oz-player/networks/OzHTTPHeaders").maybeConvertHeadersToOzHTTPHeaders(n),body:r("oz-player/utils/arrayBuffer2OzReadableStream")(e),arrayBuffer:function(){return r("oz-player/shims/OzMaybeNativePromise").resolve(e)}}})}l.default=e}),98);
__d("oz-player/networks/OzFetchRequestImplementation",["oz-player/networks/FetchWithTimeout","oz-player/utils/processFetchResponse"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,o,a,i,l,s){var u=n?n.networkTimeoutMs:null,c=r("oz-player/networks/FetchWithTimeout")(e,t,u);return c.then(function(e){var t=e.headers,n=e.ok,a=e.status;return o!=null&&!n&&typeof e.text=="function"?e.text().then(function(r){return{ok:n,status:a,headers:t,body:r,arrayBuffer:function(){return e.arrayBuffer()}}}):r("oz-player/utils/processFetchResponse")(e)})}var s=e,u=s;l.default=u}),98);
__d("oz-player/networks/withRetries",["oz-player/shims/ozSetTimeoutAcrossTransitions"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return new Promise(function(o,a){async function i(l){try{o(await e())}catch(e){if(l>0){var s=typeof n=="function"?n(t-l):n;r("oz-player/shims/ozSetTimeoutAcrossTransitions")(function(){i(l-1)},s)}else a(e)}}i(t)})}l.default=e}),98);
__d("oz-player/networks/OzFetchWithCache",["oz-player/networks/OzFetchRequestImplementation","oz-player/networks/withRetries","oz-player/shims/OzMaybeNativePromise","oz-player/utils/OzErrorUtils","oz-player/utils/arrayBuffer2OzReadableStream","oz-player/utils/processFetchResponse"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.config,n=e.dataAppendedCallback,a=e.dataAppendedErrorCallback,i=e.http,l=e.mediaStreamType,s=e.onPerfEntryAvailable,u=e.options,c=e.overrideOzRequestImplementation,d=e.prefetchCache,m=e.url,p=c!=null?function(){return c.apply(void 0,arguments)}:r("oz-player/networks/OzFetchRequestImplementation"),_=d?d.getCacheValue(m):null,f=_,g=!1,h;if(f)g=!0,h=f.then(function(e){if(e.initiator==="FETCH"){var t=e.response,n=t.headers,a=t.ok,i=t.status;return!a&&typeof e.response.text=="function"?e.response.text().then(function(t){return{ok:!1,status:i,headers:n,body:t,arrayBuffer:function(){return e.response.arrayBuffer()}}}):r("oz-player/utils/processFetchResponse")(e.response)}else if(e.initiator==="XHR_REQUEST"){var l=r("oz-player/utils/arrayBuffer2OzReadableStream")(e.response);return{body:l,status:200,headers:null,ok:!0,arrayBuffer:function(){return r("oz-player/shims/OzMaybeNativePromise").resolve(e.response)}}}else throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_UNEXPECTED_CACHE_INITIATOR",description:"Unable to handle request initiator: "+e.initiator})}).catch(function(e){return p(m,i,null,null,l,s,n,a)});else{var y,C=(y=u==null?void 0:u.retryAttempts_SIDX_USE_ONLY)!=null?y:0;if(C>0){var b,v=(b=u==null?void 0:u.retryTimeoutMs_SIDX_USE_ONLY)!=null?b:100;h=r("oz-player/networks/withRetries")(function(){return p(m,i,u,t,l,s,n,a)},C,v)}else h=p(m,i,u,t,l,s,n,a)}return{promise:h,retrievedFromCache:g}}l.default=e}),98);
__d("oz-player/utils/OzVideoUrlUtils",[],(function(t,n,r,o,a,i){"use strict";var e=-2147483648,l=~e,s=e+1;function u(e){var t=e|0;return Math.max(s,Math.min(t,l))}function c(e){var t=Number.parseInt(e,16);return Number.isFinite(t)?new Date(u(t)*1e3):null}function d(){return u(Date.now()/1e3)}var m={OE:"oe",OE2:"oe2",ODM:"odm",USS:"uss"};function p(e){var t=e instanceof URL?e.searchParams:new URL(e).searchParams,n=t.get(m.OE),r=n==null?void 0:c(n);return{expirationDate:r}}function _(e){var t=e instanceof URL?e.searchParams:new URL(e).searchParams;return t.get(m.OE2)!==null||t.get(m.ODM)!==null||t.get(m.USS)!==null}function f(e){var t=p(e),n=t.expirationDate;return n!=null&&n<=new Date(d()*1e3)}i.DEFAULT_UNIXTIME=e,i.MAX_INT=l,i.parseCdnUrlParams=p,i.isShortenedExpiryTimestampCdnUrl=_,i.isCdnUrlExpired=f}),66);
__d("oz-player/networks/OzNetworkRequestStream",["Promise","oz-player/networks/OzCreateErrorStream","oz-player/networks/OzFetchWithCache","oz-player/shims/OzURI","oz-player/shims/ozvariant","oz-player/utils/OzCustomErrorCode","oz-player/utils/OzErrorUtils","oz-player/utils/OzResourceTimingUtils","oz-player/utils/OzVideoUrlUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(e){this.$8=!1,this.$10="auto";var t=e.baseUri,n=e.baseUriDecisionTime,r=e.config,o=e.dataAppendedCallback,a=e.dataAppendedErrorCallback,i=e.debugName,l=e.dynamicVideoLibrary,s=e.mediaStreamType,u=e.networkRequestFetchPriority,c=e.networkRequestStreamHandlers,d=e.networkRequestStreamRetryHandler,m=e.networkRequestUrlRefreshHandler,p=e.options,_=e.overrideOzRequestImplementation,f=e.prefetchCache,g=e.requestParamCreator;this.$1=i,this.$2=t,this.$3=p,this.$4=g,this.$11=c!=null?c:[],this.$10=u,this.$12=d,this.$13=m,this.$9=_,this.$14=f,this.$15=r,this.$16=l,this.$17=n,this.$18=s,this.$19=o,this.$20=a}var a=t.prototype;return a.$21=function(t){var e=this,n=this.$4.createRequestParam(this.$2,t,this.$10),o=n.http,a=n.uri,i=a.toString();this.$5=i;var l=r("oz-player/networks/OzFetchWithCache")({config:this.$15,url:i,http:o,overrideOzRequestImplementation:this.$9,options:this.$3,prefetchCache:this.$14,mediaStreamType:this.$18,onPerfEntryAvailable:function(n){e.$22(n)},dataAppendedCallback:this.$19,dataAppendedErrorCallback:this.$20}),s=l.promise,u=l.retrievedFromCache;return this.$8=u,{requestPromise:s,requestUrl:i}},a.startStream=function(t){var e=this;return this.$23().then(function(){if(e.$15.getBool("video_cdn_url_refresh")&&!o("oz-player/utils/OzVideoUrlUtils").isShortenedExpiryTimestampCdnUrl(e.$2.toString())&&o("oz-player/utils/OzVideoUrlUtils").isCdnUrlExpired(e.$2.toString()))return r("oz-player/networks/OzCreateErrorStream")(o("oz-player/utils/OzErrorUtils").createOzNetworkError({description:"OzNetworkRequestStream("+e.$1+") CDN URL expired.",responseStatus:0,responseHeaders:null,requestUrl:e.$2.toString()}));var n=e.$21(t),a=n.requestPromise,i=n.requestUrl,l=i,s=Date.now();return a.then(function(n){var a;return(a=e.$16)==null||a.updateWithResponse(i,s,e.$17,n),e.$7=n,e.$12!=null&&n.ok===!1?e.$12(n,function(){var n=e.$21(t),r=n.requestPromise,o=n.requestUrl;return l=o,r},l).catch(function(e){throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_NETWORK_REQUEST_STREAM_RETRY_HANDLER_ERROR",description:String(e),extra:{originalError:e,code:r("oz-player/utils/OzCustomErrorCode").NETWORK_REQUEST_STREAM_RETRY_HANDLER_ERROR,url:l}})}):n}).then(function(t){for(var n=[],a=0;a<e.$11.length;a++)try{var i=e.$11[a].onResponse(t,l);i&&n.push(i)}catch(e){var s=e;return r("oz-player/networks/OzCreateErrorStream")(s)}var u=t.body,c=t.headers,d=t.ok,m=t.status;if(!d)return r("oz-player/networks/OzCreateErrorStream")(o("oz-player/utils/OzErrorUtils").createOzNetworkError({description:"OzNetworkRequestStream("+e.$1+") HTTP status not OK",responseStatus:m,responseHeaders:c,requestUrl:l,responseBody:typeof u=="string"?u:void 0}));typeof u!="string"&&typeof u.getReader=="function"||r("oz-player/shims/ozvariant")(0,3287);for(var p=u,_=0;_<n.length;_++)p=p.pipeThrough(n[_]);return p},function(t){for(var n=[],a=0;a<e.$11.length;a++)try{var i=e.$11[a].onError(t,l);i&&n.push(i)}catch(e){var s=e;return r("oz-player/networks/OzCreateErrorStream")(s)}if(t instanceof TypeError){for(var u=r("oz-player/networks/OzCreateErrorStream")(o("oz-player/utils/OzErrorUtils").createOzNetworkError({description:"OzNetworkRequestStream("+e.$1+") TypeError: "+t.message,responseStatus:0,responseHeaders:null,requestUrl:l})),c=0;c<n.length;c++)u=u.pipeThrough(n[c]);return u}throw t}).catch(function(e){if(o("oz-player/utils/OzErrorUtils").isOzError(e)&&e.getType()==="OZ_NETWORK_REQUEST_STREAM_RETRY_HANDLER_ERROR")throw e;if(e.name==="AbortError"){var t=e.message;return r("oz-player/networks/OzCreateErrorStream")({type:e.name,status:e.code,url:l,message:t})}return r("oz-player/networks/OzCreateErrorStream")({type:"stream_processing",status:0,url:l,message:"Stream processing error. "+e})})})},a.$22=function(t){this.$6=t},a.getLastPerformanceEntry=function(){return this.$6!=null?this.$6:this.$5==null?null:o("oz-player/utils/OzResourceTimingUtils").getLatestResourceTimingEntry(this.$5)},a.getLastRequestUrl=function(){return this.$5},a.getLastResponse=function(){return this.$7},a.retrievedFromCache=function(){return this.$8},a.$23=function(){var t=this;return this.$15.getBool("video_cdn_url_refresh")&&!o("oz-player/utils/OzVideoUrlUtils").isShortenedExpiryTimestampCdnUrl(this.$2.toString())&&o("oz-player/utils/OzVideoUrlUtils").isCdnUrlExpired(this.$2.toString())&&this.$13?this.$13(this.$2.toString()).then(function(e){e.refreshedUrl!=null&&e.reason==="OK"&&(t.$2=new(r("oz-player/shims/OzURI"))(e.refreshedUrl))}):(e||(e=n("Promise"))).resolve()},t})();l.default=s}),98);
__d("oz-player/manifests/OzByteRange",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return e.startByte===t.startByte}function l(e,t){return t.endByte===null?!1:e.startByte===t.endByte+1}function s(e,t){return e.startByte<t.startByte?!1:t.endByte==null||t.endByte>=e.startByte}function u(e,t){var n=e,r=t;if(r.startByte<n.startByte){var o=n;n=r,r=o}if(n.endByte==null)return{startByte:n.startByte,endByte:null};if(r.startByte>n.endByte+1)return null;var a=r.endByte==null||r.endByte>n.endByte?r.endByte:n.endByte;return{startByte:n.startByte,endByte:a}}function c(e,t){return t.endByte==null?null:e.startByte>t.endByte?{startByte:e.startByte,endByte:e.endByte}:e.endByte!=null&&e.endByte<=t.endByte?null:{startByte:t.endByte+1,endByte:e.endByte}}function d(e){return e.endByte==null?null:e.endByte-e.startByte+1}i.startsAtSame=e,i.startsImmediateAfter=l,i.startsDuring=s,i.union=u,i.disjoinAfter=c,i.getLength=d}),66);
__d("oz-player/networks/OzProducerInterruptedError",[],(function(t,n,r,o,a,i){"use strict";var e=(function(e){function t(){return e.apply(this,arguments)||this}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error));i.default=e}),66);
__d("oz-player/networks/OzDeferredBuffer",["oz-player/networks/OzProducerInterruptedError","oz-player/shims/OzDeferred","oz-player/shims/OzMaybeNativePromise","oz-player/utils/OzErrorUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){e===void 0&&(e={}),this.$2=[],this.$3=!1,this.$5=0;var t=e,n=t.disableArrayShift;this.$1=!!n}var t=e.prototype;return t.produce=function(t){this.$6(t)},t.signalProducerInterruption=function(){this.$6(new(r("oz-player/networks/OzProducerInterruptedError"))("producer interrupted"))},t.consume=function(t){var e=this;if(this.$3)throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_DEFERRED_BUFFER",description:"A buffer can only be consumed by one client at a time"});this.$3=!0;var n=r("oz-player/shims/OzMaybeNativePromise").resolve();return this.isEmpty()&&(this.$4=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise")),n=this.$4.getPromise()),n.then(function(){if(e.$1){if(e.$2[e.$5]===void 0)throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_DEFERRED_BUFFER",description:"buffer has no value at position "+e.$5})}else if(e.$2.length===0)throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_DEFERRED_BUFFER",description:"buffer length must not be 0"});e.$4=null,e.$3=!1;var n=e.$1?e.$7(t):e.$8(t);if(n instanceof Uint8Array)return n;throw n})},t.$6=function(t){this.$2.push(t),this.$4&&this.$4.resolve()},t.$7=function(t){var e=this.$2[this.$5];if(e===void 0)return new Uint8Array([]);var n=e;if(!(n instanceof Uint8Array))return this.$2[this.$5]=void 0,this.$5++,n;if(t!==void 0&&n.length>t){var r=n.slice(t);n=n.slice(0,t),this.$2[this.$5]=r}else this.$2[this.$5]=void 0,this.$5++;return n},t.$8=function(t){if(this.$2.length===0)return new Uint8Array([]);var e=this.$2[0];if(!(e instanceof Uint8Array))return this.$2.shift(),e;if(t!==void 0&&e.length>t){var n=e.slice(t);e=e.slice(0,t),this.$2[0]=n}else this.$2.shift();return e},t.isEmpty=function(){return this.$1?this.$2[this.$5]===void 0:this.$2.length===0},e})();l.default=e}),98);
__d("oz-player/utils/ozPipeErrorTo",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){try{e==null||e.error(t)}catch(e){}}i.default=e}),66);
__d("oz-player/networks/OzPausableRangeStream",["oz-player/manifests/OzByteRange","oz-player/networks/OzDeferredBuffer","oz-player/shims/OzDeferred","oz-player/shims/OzMaybeNativePromise","oz-player/utils/OzErrorUtils","oz-player/utils/ozPipeErrorTo"],(function(t,n,r,o,a,i,l){"use strict";function e(){return o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_STREAM",description:"Upstream has an inconsistent range"})}var s=(function(){function e(){this.$1=0}var t=e.prototype;return t.setBytesToSkip=function(t){this.$1=t},t.setBytesSkipped=function(t){this.$1-=t},t.getBytesToSkip=function(){return this.$1},t.hasMoreBytesToSkip=function(){return this.$1>0},e})(),u=(function(){function t(n,o,a,i,l){var u=this;this.$5=!1,this.$7=0,this.$8=0,this.$13=!1,this.$14=new s,this.$15=!1,this.$16=!1,this.$17=!1,this.startStream=function(){u.$13=!0;var e={startByte:u.$1.startByte,endByte:u.$1.endByte};u.$15?u.$8&&(u.$3.produce("skip_buffered_bytes"),u.$8=0):e.startByte+=u.$8;var n=u.$4;return u.$2.startStream(e).then(function(e){return e.pipeTo(u.$16?n:u.$4).then(function(){u.$12&&u.$12.resolve("stream_done")}).catch(function(e){u.$12&&!u.$12.isSettled()&&(u.$16&&e===t.STREAM_PAUSED?u.$12.resolve("stream_paused"):u.$12.reject(e))}),u.$12=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise")),{statusPromise:u.$12.getPromise()}})},this.$18=n,this.$19=o,this.$1=a,this.$2=i;var c=l||{},d=c.disableDeferredBufferArrayShift,m=c.enablePausableStreamResumeFromStartDangerously,p=c.fixPausePreReadableStream,_=c.fixStreamingUndefinedEndByte,f=c.throwErrorWhenAborted;this.$11=!!_,this.$15=!!m,this.$16=!!p,this.$17=!!f,this.$3=new(r("oz-player/networks/OzDeferredBuffer"))({disableArrayShift:!!d}),this.$6=new this.$18({start:function(t){u.$10=t},pull:function(n){if((u.$11&&u.$1.endByte===null&&u.$5||u.$7===u.$20())&&u.$3.isEmpty())return n.close(),r("oz-player/shims/OzMaybeNativePromise").resolve();var t=function(){var o=u.$14.hasMoreBytesToSkip()?u.$14.getBytesToSkip():void 0;return u.$3.consume(o).then(function(o){if(u.$14.hasMoreBytesToSkip())return u.$14.setBytesSkipped(o.length),t();u.$7+=o.length;var a=u.$20();a!==null&&u.$7>(a||0)&&r("oz-player/utils/ozPipeErrorTo")(u.$10,e()),n.enqueue(o)}).catch(function(e){if(e==="skip_buffered_bytes")return u.$14.setBytesToSkip(u.$7),t();throw e})};return t()},cancel:function(t){u.$12&&u.$12.resolve("stream_cancelled"),r("oz-player/utils/ozPipeErrorTo")(u.$9,t)}}),this.$4=this.$21()}var n=t.prototype;return n.$20=function(){var e=this.$1,t=e.endByte,n=e.startByte;return t!=null?t-n+1:null},n.$21=function(){var t=this;return new this.$19({start:function(n){t.$9=n},write:function(n){t.$3.produce(n),t.$8+=n.length},close:function(){t.$5=!0;var n=t.$1,o=n.endByte,a=n.startByte;t.$11&&o===null&&t.$3.produce(new Uint8Array([])),o!==null&&t.$8!==(o||0)-a+1&&r("oz-player/utils/ozPipeErrorTo")(t.$10,e())},abort:function(n){t.$12&&(t.$17?t.$12.reject(n):t.$12.resolve("stream_aborted")),r("oz-player/utils/ozPipeErrorTo")(t.$10,n)}})},n.getStream=function(){return this.$6},n.pauseStream=function(){r("oz-player/utils/ozPipeErrorTo")(this.$9,t.STREAM_PAUSED),this.$12&&this.$12.resolve("stream_paused"),this.$4=this.$21()},n.getByteRange=function(){return this.$1},n.getBytesStreamed=function(){return this.$7},n.tryConcatByteRange=function(t){return this.$13||!o("oz-player/manifests/OzByteRange").startsImmediateAfter(t,this.$1)?!1:(this.$1={startByte:this.$1.startByte,endByte:t.endByte},!0)},t})();u.STREAM_PAUSED="streamPaused",l.default=u}),98);
__d("oz-player/networks/RequestParamCreator",["oz-player/shims/OzURI"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n){var e=this;this.createRequestParam=function(t,n,o){var a=new(r("oz-player/shims/OzURI"))(t.toString());if(n){var i=n.endByte,l=n.startByte;l===0&&i==null||(a.addQueryData({bytestart:n.startByte}),i!=null&&a.addQueryData({byteend:i}))}if(e.$2){var s=e.$2(a);s&&Object.keys(s).forEach(function(e){var t=s[e];a.addQueryData(e,t)})}var u=e.$1&&e.$1(a)?"include":"same-origin";return{uri:a,http:{credentials:u,priority:o}}},this.$1=t,this.$2=n};l.default=e}),98);
__d("oz-player/networks/getOzSegmentStreamableRange",[],(function(t,n,r,o,a,i){"use strict";function e(e){if(!e.length)return null;var t=e[0].getURI().toString(),n=e[0].getByteRange();if(!n)return null;for(var r=n,o=1;o<e.length;o++){var a=e[o];if(a.getURI().toString()!==t)return null;var i=a.getByteRange();if(!r||!i||r.endByte===null||i.startByte!==r.endByte+1)return null;r=i}return{startByte:n.startByte,endByte:r.endByte}}i.default=e}),66);
__d("oz-player/utils/OzNetworkRequestLoggingUtils",["oz-player/shims/OzNetworkDiagnostics","oz-player/utils/OzResourceTimingUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return t?parseInt(t.get("content-length"),10):null},s=function(t){return t?t.get("x-fb-fna-hit"):null},u=function(t){return t?t.get("x-fb-edge-hit"):null},c=function(t){return t?t.get("x-fb-origin-hit"):null},d=function(t){return t?parseInt(t.get("x-fb-dynamic-latest-segment-id"),10):null},m=function(t,n){var e=o("oz-player/utils/OzResourceTimingUtils").getLatestResourceTimingEntry(n);e&&t.setTimeToFirstByte(Math.round(e.responseStart-e.startTime)).setTimeToLastByte(Math.round(e.responseEnd-e.startTime)).setTimeToRequestStart(Math.round(e.requestStart-e.startTime))},p=function(n,o,a,i,l,p){a.length&&n.setSegmentCount(a.length),o!=null&&o!==""&&m(n,String(o)),n.setResource(o!=null&&o!==""?o:null).setInitiator("fetch").setTimeToRequestSent(Math.round(Math.floor(i))).setLiveheadSeqNumHeader(d(p==null?void 0:p.headers)).setContentLengthHeader(e(p==null?void 0:p.headers)).setEdgeHitHeader(u(p==null?void 0:p.headers)).setOriginHitHeader(c(p==null?void 0:p.headers)).setFNAHitHeader(s(p==null?void 0:p.headers)).setResponseTimeMsHeader(r("oz-player/shims/OzNetworkDiagnostics").getResponseTimeMs(p==null?void 0:p.headers)).setUserInfo({segmentPTSHeader:String(r("oz-player/shims/OzNetworkDiagnostics").getDvlSegmentPTS(p==null?void 0:p.headers))}).setCode(p==null?void 0:p.status).setLength(l)},_=function(n,o,a,i,l,s,p){o!=null&&o!==""&&m(n,String(o)),n.setResource(o!=null&&o!==""?o:null).setLiveheadSeqNumHeader(d(i==null?void 0:i.headers)).setContentLengthHeader(e(i==null?void 0:i.headers)).setEdgeHitHeader(u(i==null?void 0:i.headers)).setOriginHitHeader(c(i==null?void 0:i.headers)).setResponseTimeMsHeader(r("oz-player/shims/OzNetworkDiagnostics").getResponseTimeMs(i==null?void 0:i.headers)).setCode(i==null?void 0:i.status).setLength(a).setClientTimeBegin(l).setClientTimeDuration(s-l).setClientTimeEnd(s).setUserInfo(p!=null&&p>0?{chunkSize:String(p)}:null)};l.setPerformanceLoggingAttributes=m,l.setFetchStreamLoggingAttributes=p,l.setBandwidthSampledLoggingAttributes=_}),98);
__d("oz-player/networks/OzNetworkManager",["oz-player/loggings/OzLoggingUtils","oz-player/networks/OzNetworkRequestStream","oz-player/networks/OzPausableRangeStream","oz-player/networks/RequestParamCreator","oz-player/networks/getOzSegmentStreamableRange","oz-player/shims/OzStreams","oz-player/shims/OzURI","oz-player/shims/ozvariant","oz-player/utils/OzNetworkRequestLoggingUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$10=null,this.$15="auto";var t=e.bandwidthEstimator,n=e.config,o=e.configureCustomRequestParametersForSegment,a=e.dynamicVideoLibrary,i=e.getCustomRequestParametersForURI,l=e.getOverrideOzRequestImplementation,s=e.getShouldIncludeCredentials,u=e.networkRequestFetchPriority,c=u===void 0?"auto":u,d=e.networkRequestStreamHandlers,m=e.networkRequestStreamRetryHandler,p=e.networkRequestUrlRefreshHandler,_=e.onResourceTimingBufferFull,f=e.prefetchCache,g=e.setCustomFetchStreamLoggingAttributes;this.$2=n,this.$8=s,this.$9=i,this.$1=new(r("oz-player/networks/RequestParamCreator"))(this.$8,this.$9),this.$3=f,this.$4=d,this.$5=m,this.$6=p,this.$7=l,this.$10=g,this.$11=a,this.$12=o,this.$13=_,this.$14=t,this.$15=c}var t=e.prototype;return t.destroy=function(){},t.request=function(t){var e=t.dataAppendedCallback,n=t.dataAppendedErrorCallback,o=t.debugName,a=t.loggerProvider,i=t.mediaStreamType,l=t.pipeThroughRangeStreamProviders,s=t.requestOptions,u=t.segments;u.length>0||r("oz-player/shims/ozvariant")(0,212);var c=r("oz-player/networks/getOzSegmentStreamableRange")(u)||{startByte:0,endByte:null},d=this.$7?this.$7():null,m=this.$16(u[0]),p=new(r("oz-player/networks/OzNetworkRequestStream"))({debugName:o,config:this.$2,baseUri:m,baseUriDecisionTime:null,options:s,requestParamCreator:this.$1,networkRequestFetchPriority:this.$15,networkRequestStreamHandlers:this.$4,networkRequestUrlRefreshHandler:this.$6,overrideOzRequestImplementation:d,prefetchCache:this.$3,networkRequestStreamRetryHandler:this.$5,mediaStreamType:i,dataAppendedCallback:e,dataAppendedErrorCallback:n});return this.$17(c,p,l,a,u)},t.createPausableStream=function(t){var e=t.dataAppendedCallback,n=t.dataAppendedErrorCallback,o=t.debugName,a=t.loggerProvider,i=t.mediaStreamType,l=t.pipeThroughRangeStreamProviders,s=t.segments;s.length>0||r("oz-player/shims/ozvariant")(0,212);var u=r("oz-player/networks/getOzSegmentStreamableRange")(s)||{startByte:0,endByte:null},c=null,d=this.$2.getNumber("network_seg_timeout_ms");d>0&&(c={networkTimeoutMs:d});var m=this.$7?this.$7():null,p=new(r("oz-player/networks/OzNetworkRequestStream"))({debugName:o,config:this.$2,baseUri:this.$16(s[0]),baseUriDecisionTime:s[0].getOptions().getSegmentNumDecisionTime(),options:c,requestParamCreator:this.$1,networkRequestFetchPriority:this.$15,networkRequestStreamHandlers:this.$4,networkRequestUrlRefreshHandler:this.$6,overrideOzRequestImplementation:m,prefetchCache:this.$3,networkRequestStreamRetryHandler:this.$5,dynamicVideoLibrary:this.$11,mediaStreamType:i,dataAppendedCallback:e,dataAppendedErrorCallback:n});return{pausableStream:this.$18(u,p,l||null,a),loggingPayloads:{getRequestUrl:function(){return p.getLastRequestUrl()||null},segments:s,getResponse:function(){return p.getLastResponse()}}}},t.requestRawUrl=function(t){var e=t.debugName,n=t.loggerProvider,o=t.options,a=t.url,i=this.$7?this.$7():null,l=new(r("oz-player/networks/OzNetworkRequestStream"))({debugName:e,config:this.$2,baseUri:new(r("oz-player/shims/OzURI"))(a),baseUriDecisionTime:null,options:o,networkRequestFetchPriority:this.$15,requestParamCreator:this.$1,networkRequestStreamHandlers:this.$4,networkRequestUrlRefreshHandler:this.$6,overrideOzRequestImplementation:i,prefetchCache:this.$3,networkRequestStreamRetryHandler:this.$5,dynamicVideoLibrary:this.$11,mediaStreamType:null,dataAppendedCallback:null,dataAppendedErrorCallback:null}),s={startByte:0,endByte:null};return this.$17(s,l,[],n)},t.$18=function(t,n,a,i){var e=n;if(a!=null)for(var l=0;l<a.length;l++){var s=a[l];e=s(this.$2,e,i,this.$13)}return new(r("oz-player/networks/OzPausableRangeStream"))(o("oz-player/shims/OzStreams").OzReadableStream,o("oz-player/shims/OzStreams").OzWritableStream,t,e,{fixStreamingUndefinedEndByte:!0,enablePausableStreamResumeFromStartDangerously:!0,fixPausePreReadableStream:!0,throwErrorWhenAborted:!0})},t.$17=function(t,n,r,a,i){var e=this;i===void 0&&(i=[]);var l=this.$18(t,n,r,a),s=l.startStream(),u=this.$19(s);if(a){var c=function(r){o("oz-player/utils/OzNetworkRequestLoggingUtils").setFetchStreamLoggingAttributes(r,n.getLastRequestUrl(),i,0,l.getBytesStreamed(),n.getLastResponse());var t=e.$10;t&&t(r,n.getLastRequestUrl(),n.getLastResponse())};o("oz-player/loggings/OzLoggingUtils").monitorPromiseAndLogOperation(u,a,"fetch_stream",c,c)}return{getStream:function(){return l.getStream()},cancel:function(){return l.pauseStream()},getStatusChangePromise:function(){return u}}},t.$19=function(t){return t.then(function(e){var t=e.statusPromise;return t.then(function(e){return"done"})})},t.$16=function(t){var e=this.$12,n=new(r("oz-player/shims/OzURI"))(t.getURI().toString());if(e){var o=e(t);o&&Object.keys(o).forEach(function(e){var t=o[e];n.addQueryData(e,t)})}return n},t.getBandwidthEstimator=function(){return this.$14},e.getStreamableSegmentsRange=function(t){return t.length?r("oz-player/networks/getOzSegmentStreamableRange")(t)?t.slice(0):[t[0]]:[]},e})();l.default=e}),98);
__d("oz-player/manifests/Mpd",["oz-player/shims/OzEventEmitter","oz-player/utils/OzErrorUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n,r,o,a,i,l,s){var u;return u=e.call(this)||this,u.$Mpd$p_9=!1,u.$Mpd$p_1=t,u.$Mpd$p_5=i,u.$Mpd$p_2=n,u.$Mpd$p_3=r,u.$Mpd$p_4=o,u.$Mpd$p_6=a,u.$Mpd$p_7=l,u.$Mpd$p_8=s,u}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.markRefreshed=function(){this.$Mpd$p_10=Date.now()},n.getRefreshDate=function(){return this.$Mpd$p_10},n.updateLocation=function(t){this.$Mpd$p_6=t,this.$Mpd$p_9=!0,this.emit("locationUpdated")},n.getLocation=function(){return this.$Mpd$p_6},n.getMinimumUpdatePeriod=function(){return this.$Mpd$p_5},n.getVideoRepresentations=function(){return this.$Mpd$p_2},n.getVideoRepresentationsByVariant=function(t){return t.lang===null?this.$Mpd$p_2.filter(function(e){return e.getLang()===t.lang&&e.getRole()===t.role}):this.$Mpd$p_2.filter(function(e){return e.getLang()===t.lang&&e.getRole()===t.role})},n.getAudioRepresentationsByVariant=function(t){return t.lang===null?this.$Mpd$p_3.filter(function(e){return e.getLang()===t.lang&&e.getRole()===t.role}):this.$Mpd$p_3.filter(function(e){return e.getLang()===t.lang&&e.getRole()===t.role})},n.getAudioRepresentations=function(){return this.$Mpd$p_3},n.getApplicationRepresentations=function(){return this.$Mpd$p_4},n.getCustomField=function(t){var e=this.$Mpd$p_7.get(t);if(!e)throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_MPD_PARSER",description:"Custom parser not specified for field "+t});try{return e(this.$Mpd$p_1)}catch(e){return null}},n.isStaticMpd=function(){return this.$Mpd$p_8},n.updateWith=function(t){this.$Mpd$p_9&&(this.$Mpd$p_9=!1,this.$Mpd$p_2.splice(0,this.$Mpd$p_2.length),this.$Mpd$p_3.splice(0,this.$Mpd$p_3.length),this.$Mpd$p_4.splice(0,this.$Mpd$p_4.length)),this.$Mpd$p_1=t.$Mpd$p_1,this.$Mpd$p_11(this.$Mpd$p_2,t.getVideoRepresentations()),this.$Mpd$p_11(this.$Mpd$p_3,t.getAudioRepresentations()),this.$Mpd$p_11(this.$Mpd$p_4,t.getApplicationRepresentations()),this.$Mpd$p_8=t.isStaticMpd(),this.$Mpd$p_5=t.getMinimumUpdatePeriod(),this.emit("updated")},n.blockTimeRange=function(t){this.$Mpd$p_2.forEach(function(e){return e.blockTimeRange(t)}),this.$Mpd$p_3.forEach(function(e){return e.blockTimeRange(t)}),this.$Mpd$p_4.forEach(function(e){return e.blockTimeRange(t)})},n.unblockTimeRange=function(){this.blockTimeRange({startTime:0,endTime:0})},n.$Mpd$p_11=function(t,n){for(var e=0;e<n.length;e++){for(var r=n[e],o=!1,a=0;a<t.length;a++){var i=t[a];if(r.getID()===i.getID()){i.updateWith(r),o=!0;break}}o||t.push(r)}},t})(r("oz-player/shims/OzEventEmitter"));l.default=e}),98);
__d("oz-player/manifests/OzApplicationRepresentation",["oz-player/manifests/OzRepresentationBase"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(){return e.apply(this,arguments)||this}return babelHelpers.inheritsLoose(t,e),t})(r("oz-player/manifests/OzRepresentationBase"));l.default=e}),98);
__d("oz-player/parsers/OzSegmentTemplateParser",["oz-player/manifests/OzSegmentOptions","oz-player/parsers/OzDefaultSegmentTimelineParser","oz-player/shims/OzURI","oz-player/utils/OzUrlHelper"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){this.$3=new(r("oz-player/manifests/OzSegmentOptions")),this.$2=e,this.$1=t}var t=e.prototype;return t.getData=function(){return this.$1},t.getTimeRange=function(){return{startTime:0,endTime:0}},t.getByteRange=function(){return null},t.getURI=function(){return this.$2},t.getSequenceNumber=function(){return null},t.getOptions=function(){return this.$3},e})(),s=(function(){function t(e,t,n,o,a){this.$2=n,this.$1=t,this.$3=e,o?this.$4=o:this.$4=new(r("oz-player/parsers/OzDefaultSegmentTimelineParser")),this.$5=a}var n=t.prototype;return n.parseInitializationSegment=function(){var t=o("oz-player/utils/OzUrlHelper").joinUrlPaths(this.$2.baseUrl,this.$1.$.initialization);return new e(new(r("oz-player/shims/OzURI"))(t),this.$5)},n.parseSegmentsContainer=function(){return this.$4.parseSegmentsContainer(this.$3,this.$2,this.$1)},t})();l.default=s}),98);
__d("oz-player/manifests/OzZeroTimeRangeSegment",["oz-player/manifests/OzSegmentOptions"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n){this.$4=new(r("oz-player/manifests/OzSegmentOptions")),this.$1=e,this.$2=t,this.$3=n}var t=e.prototype;return t.getData=function(){return null},t.getURI=function(){return this.$1},t.getTimeRange=function(){return{startTime:0,endTime:0}},t.getByteRange=function(){return{startByte:this.$2,endByte:this.$3}},t.getSequenceNumber=function(){return null},t.getOptions=function(){return this.$4},e})();l.default=e}),98);
__d("oz-player/networks/OzNetworkRequestStreamBandwidthReporter",["oz-player/networks/OzTransformStream","oz-player/shims/OzNetworkDiagnostics","oz-player/utils/OzNetworkRequestLoggingUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){var n=this;this.$8=Date.now(),this.$9=Date.now(),this.$10=0,this.$11=0,this.$12=function(){},this.$13=function(){},this.$14=function(){},this.$16=new(r("oz-player/networks/OzTransformStream")),this.$19=!1,this.$20=!1,this.$21=null,this.$22=function(e){n.$25(),e.length!=null&&(n.$11+=e.length),n.$26(),!n.$18&&n.$27()},this.$23=function(){if(!(n.$21!=null&&n.$21>0)){var e=Date.now()-n.$8,r=n.$1.getLastPerformanceEntry();r&&n.$13(r.responseStart-r.requestStart,r.responseEnd-r.requestStart,n.$11),!r&&t.__isresourcetimingbufferfull&&n.$15&&n.$15(),n.$3>0&&e>0&&n.$10===0&&n.$11>=n.$3&&n.$28(n.$11,e)}};var o=e.byteCountPerSample,a=e.ignoreOnStreamWriteSamples,i=e.loggerProvider,l=e.maximumSampleBandwidth,s=e.minimumBytesToSampleOnClose,u=e.minimumSampleDuration,c=e.onResourceTimingBufferFull,d=e.responseTimeHandicapMs,m=e.stream,p=e.useResponseTimeMs;this.$1=m,this.$17=i,this.$2=o,this.$3=s,this.$4=u,this.$5=l,this.$6=p,this.$7=d,this.$18=a,this.$16.addListener("writableWrite",this.$22),this.$16.addListener("writableClose",this.$23),this.$15=c}var n=e.prototype;return n.getTransformStream=function(){return this.$16},n.onBandwidthSample=function(t){this.$12=t},n.onNavigationTimingSample=function(t){this.$13=t},n.onEstimateFromHeaders=function(t){this.$14=t},n.$24=function(t,n,r){var e=n-r,a=this.$17?this.$17.getOperationLogger("bandwidth_sampled"):null;if(a){var i=Date.now(),l=i-e;o("oz-player/utils/OzNetworkRequestLoggingUtils").setBandwidthSampledLoggingAttributes(a,this.$1.getLastRequestUrl(),t,this.$1.getLastResponse(),l,i,this.$21),a.log()}this.$12(t,e)},n.$29=function(t,n,r){if(n-r<=0)return!0;var e=t*8/(n/1e3);return n<this.$4&&e>this.$5},n.$28=function(t,n){var e=this.$1.getLastResponse(),o=this.$6&&r("oz-player/shims/OzNetworkDiagnostics").getResponseTimeMs(e==null?void 0:e.headers)||0;this.$29(t,n,o)||this.$24(t,n,Math.max(o-this.$7,0))},n.$25=function(){var e,t=(e=this.$1.getLastResponse())==null?void 0:e.headers;if(!(this.$20||t==null)){this.$20=!0;var n=r("oz-player/shims/OzNetworkDiagnostics").getBandwidthMeanEstimate(t);n!=null&&this.$14(n)}},n.$26=function(){if(!this.$19){if(this.$21==null){var e=this.$1.getLastResponse();this.$21=r("oz-player/shims/OzNetworkDiagnostics").getUsableResponseSizeForBandwidthEstimation(e==null?void 0:e.headers)||0}this.$21!=null&&this.$21>0&&this.$11>=this.$21&&(this.$19=!0,this.$28(this.$11,Date.now()-this.$9))}},n.$27=function(){var e=Date.now(),t=e-this.$8;this.$2>0&&this.$11>=this.$10+this.$2&&!this.$29(this.$11,t,0)&&(this.$24(this.$11-this.$10,t,0),this.$8=e,this.$10=this.$11)},e})();l.default=e}),98);
__d("oz-player/networks/bandwidth/pipeStreamThroughBandwidthEstimator",["oz-player/networks/OzNetworkRequestStreamBandwidthReporter"],(function(t,n,r,o,a,i,l){"use strict";var e=2e5;function s(t,n,o,a,i){return{startStream:function(s){var l=new(r("oz-player/networks/OzNetworkRequestStreamBandwidthReporter"))({stream:n,loggerProvider:o,byteCountPerSample:t.getNumber("byte_count_per_sample",e),minimumBytesToSampleOnClose:t.getNumber("minimum_bytes_to_sample_on_close",25e3),minimumSampleDuration:t.getNumber("minimum_bandwidth_sample_duration",10),maximumSampleBandwidth:t.getNumber("maximum_bandwidth_sample_bandwidth",1e8),useResponseTimeMs:t.getBool("bandwidth_use_response_time_adjustment",!1),responseTimeHandicapMs:t.getNumber("bandwidth_response_time_handicap",0),ignoreOnStreamWriteSamples:t.getBool("bandwidth_ignore_on_stream_write_samples",!1),onResourceTimingBufferFull:i});return l.onBandwidthSample(function(e,t){a.addBandwidthSample(e,t)}),l.onNavigationTimingSample(function(e,n,r){var o=t.getNumber("time_to_first_byte_ignore_above_threshold_ms",0);(o===0||e<=o)&&a.addNavigationTimingSample(e,n,r)}),l.onEstimateFromHeaders(function(e){a.setBandwidthEstimateFromHeaders({meanEstimate:e})}),n.startStream(s).then(function(e){return n.retrievedFromCache()?e:e.pipeThrough(l.getTransformStream())})}}}l.pipeStreamThroughBandwidthEstimator=s}),98);
__d("oz-player/networks/getOzBandwidthEstimatorPipeThroughReporter",["oz-player/networks/OzNetworkRequestStream","oz-player/networks/bandwidth/pipeStreamThroughBandwidthEstimator"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return function(n,a,i,l){var s=e==="video";return a instanceof r("oz-player/networks/OzNetworkRequestStream")&&s?o("oz-player/networks/bandwidth/pipeStreamThroughBandwidthEstimator").pipeStreamThroughBandwidthEstimator(n.getLegacyConfig(),a,i,t,l):a}}l.default=e}),98);
__d("oz-player/manifests/OzDataSegment",["oz-player/manifests/OzSegmentOptions"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n,o,a){this.$6=new(r("oz-player/manifests/OzSegmentOptions")),this.$1=e,this.$2=t,this.$3=n,this.$4=o,this.$5=a}var t=e.prototype;return t.getData=function(){return null},t.getURI=function(){return this.$1},t.getTimeRange=function(){return{startTime:this.$2,endTime:this.$3}},t.getByteRange=function(){return{startByte:this.$4,endByte:this.$5}},t.getSequenceNumber=function(){return null},t.getOptions=function(){return this.$6},e})();l.default=e}),98);
__d("oz-player/shims/www/OzDataViewReaderWWW",["DataViewReader"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("DataViewReader")}),98);
__d("oz-player/shims/OzDataViewReader",["oz-player/shims/www/OzDataViewReaderWWW"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/OzDataViewReaderWWW")}),98);
/**
 * License: https://www.facebook.com/legal/license/k5cmJzUOK4Y/
 */
__d("oz-player/parsers/OzMp4SidxParser",["oz-player/manifests/OzDataSegment","oz-player/manifests/OzSegmentOptions","oz-player/shims/OzDataViewReader","oz-player/utils/OzErrorUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=1936286840;function s(t,n,a,i){var l=new(r("oz-player/shims/OzDataViewReader"))(new DataView(i.buffer)),s=l.readUint32(),u=l.readUint32();if(u!==e)throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SIDX_PARSER",description:'Invalid box type, expected "sidx".'});s==1&&(s=l.readUint64());var c=l.readUint8();l.skip(3),l.skip(4);var d=l.readUint32();if(!d)throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SIDX_PARSER",description:"Invalid timescale."});var m,p;c==0?(m=l.readUint32(),p=l.readUint32()):(m=l.readUint64(),p=l.readUint64()),l.skip(2);for(var _=l.readUint16(),f=m,g=a+s+p,h=0,y=t.getBool("sidx_parser_memory_optimization"),C=[],b=function(){var e=l.readUint32(),t=(e&2147483648)>>>31,a=e&2147483647,i=l.readUint32();if(e=l.readUint32(),t==1)throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SIDX_PARSER",description:"Heirarchical SIDXs are not supported."});var s=f/d,u=(f+i)/d;v===0&&(h=s);var c=g,m=c+a-1,p=new(r("oz-player/manifests/OzSegmentOptions"));C.push(y?new(r("oz-player/manifests/OzDataSegment"))(n,s-h,u-h,c,m):{getData:function(){return null},getURI:function(){return n},getTimeRange:function(){return{startTime:s-h,endTime:u-h}},getByteRange:function(){return{startByte:c,endByte:m}},getSequenceNumber:function(){return null},getOptions:function(){return p}}),f+=i,g+=a},v=0;v<_;v++)b();return C}l.parse=s}),98);
__d("oz-player/parsers/OzSidxSegmentsContainer",["oz-player/utils/OzErrorUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){this.$1=e,this.$2=t}var t=e.prototype;return t.getSegmentByTime=function(t){for(var e=this.$1(),n=0;n<e.length;n++){var r=e[n],o=r.getTimeRange();if(o.startTime<=t&&o.endTime>t)return r}return null},t.getSegmentAfter=function(t){var e=this.$1(),n=e.findIndex(function(e){return e.getTimeRange().startTime===t.getTimeRange().startTime&&e.getTimeRange().endTime===t.getTimeRange().endTime});return n>=0&&n+1<e.length?e[n+1]:null},t.getPredictedSegmentAfter=function(t){return null},t.canPredict=function(){return!1},t.canApproximateId=function(){return!1},t.isEndingSegment=function(t){var e=this.$1();if(!e||!e.length)return!1;var n=e[e.length-1].getTimeRange(),r=t.getTimeRange();return n.startTime===r.startTime&&n.endTime===r.endTime},t.getSegment=function(t){return this.$1()[t]||null},t.updateWith=function(t){throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_NOT_IMPLEMENTED_ERROR",description:"Not implemented: updatedWith"})},t.addUpdateListener=function(t){return this.$2.addListener("segment_updated",t)},t.getTimeRanges=function(){var e=this.$1();if(e.length===0)return[];var t=e[0],n=e[e.length-1];return[{startTime:t.getTimeRange().startTime,endTime:n.getTimeRange().endTime}]},t.blockTimeRange=function(){},t.getEndingSegment=function(){var e=this.$1();return e.length>0?e[e.length-1]:null},t.getMaxGopSec=function(){return null},e})();l.default=e}),98);
/**
 * License: https://www.facebook.com/legal/license/k5cmJzUOK4Y/
 */
__d("oz-player/parsers/OzWebmSidxParser",["oz-player/manifests/OzDataSegment","oz-player/shims/OzDataViewReader","oz-player/shims/ozvariant"],(function(t,n,r,o,a,i,l){"use strict";var e=440786851,s=408125543,u=357149030,c=2807729,d=17545,m=475249515,p=187,_=179,f=183,g=241,h=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])];function y(e,t){if(!e&&!t)return!0;if(!e||!t||e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!=t[n])return!1;return!0}var C=(function(){function e(e,t){this.id=e,this.$1=t}var t=e.prototype;return t.getOffset=function(){return this.$1.byteOffset},t.createParser=function(){return new b(this.$1)},t.getUint=function(){if(this.$1.byteLength>8)throw new RangeError("EbmlElement: Unsigned integer has too many bytes.");if(this.$1.byteLength==8&&this.$1.getUint8(0)&224)throw new RangeError("EbmlParser: Unsigned integer must be at most 53 bits.");for(var e=0,t=0;t<this.$1.byteLength;t++){var n=this.$1.getUint8(t);e=256*e+n}return e},t.getFloat=function(){if(this.$1.byteLength==4)return this.$1.getFloat32(0);if(this.$1.byteLength==8)return this.$1.getFloat64(0);throw new RangeError("EbmlElement: floating point numbers must be 4 or 8 bytes.")},e})(),b=(function(){function e(e){this.$1=e,this.$2=new(r("oz-player/shims/OzDataViewReader"))(this.$1)}var t=e.prototype;return t.hasMoreData=function(){return this.$2.hasMoreData()},t.parseElement=function(){var t=this.$3(),n=this.$4(),r;e.$5(n)?r=this.$1.byteLength-this.$2.getCursor():r=e.$6(n);var o=this.$2.getCursor()+r<=this.$1.byteLength?r:this.$1.byteLength-this.$2.getCursor(),a=new DataView(this.$1.buffer,this.$1.byteOffset+this.$2.getCursor(),o);return this.$2.skip(o),new C(t,a)},t.$3=function(){var e=this.$4();if(e.length>7)throw new RangeError("EbmlParser: EBML ID must be at most 7 bytes.");for(var t=0,n=0;n<e.length;n++)t=256*t+e[n];return t},t.$4=function(){var e=this.$2.readUint8(),t;for(t=1;t<=8;t++){var n=1<<8-t;if(e&n)break}if(t>8)throw new RangeError("EbmlParser: Variable sized integer must fit within 8 bytes.");var r=new Uint8Array(t);r[0]=e;for(var o=1;o<t;o++)r[o]=this.$2.readUint8();return r},e.$6=function(t){if(t.length===8&&t[1]&224)throw new RangeError("EbmlParser: Variable sized integer value must be at most 53 bits.");for(var e=1<<8-t.length,n=t[0]&e-1,r=1;r<t.length;r++)n=256*n+t[r];return n},e.$5=function(t){for(var e=0;e<h.length;e++)if(y(t,h[e]))return!0;return!1},e})();function v(e){for(var t=e.createParser(),n=1e6,r=null;t.hasMoreData();){var o=t.parseElement();o.id==c?n=o.getUint():o.id==d&&(r=o.getFloat())}if(r==null)return null;var a=n/1e9,i=r*a;return{timecodeScale:a,duration:i}}function S(e,t,n,o,a,i){for(var l=[],s=t.createParser(),u=-1,c=-1;s.hasMoreData();){var d=s.parseElement();if(d.id==p){var m=R(d);if(m){var _=o*m.unscaledTime,f=n+m.relativeOffset;u>=0&&(c>=0||r("oz-player/shims/ozvariant")(0,4010),l.push(new(r("oz-player/manifests/OzDataSegment"))(i,u,_,c,f-1))),u=_,c=f}}}if(u>=0){c>=0||r("oz-player/shims/ozvariant")(0,4010);var g=a;l.push(new(r("oz-player/manifests/OzDataSegment"))(i,u,g,c,null))}return l}function R(e){var t=e.createParser(),n=t.parseElement();if(n.id!=_)return null;var r=n.getUint(),o=t.parseElement();if(o.id!=f)return null;for(var a=o.createParser(),i=0;a.hasMoreData();){var l=a.parseElement();if(l.id==g){i=l.getUint();break}}return{unscaledTime:r,relativeOffset:i}}function L(e){for(var t=e.createParser(),n=null;t.hasMoreData();){var r=t.parseElement();if(r.id==u){n=r;break}}return n?v(n):null}function E(t){var n=new b(t),r=n.parseElement();if(r.id!=e)return null;var o=n.parseElement();if(o.id!=s)return null;var a=o.getOffset(),i=L(o);return i?{segmentOffset:a,timecodeScale:i.timecodeScale,duration:i.duration}:null}function k(e,t,n,r){var o=new DataView(r.buffer),a=new DataView(n.buffer),i=E(o);if(!i)return[];var l=new b(a),s=l.parseElement();return s.id!=m?[]:S(e,s,i.segmentOffset,i.timecodeScale,i.duration,t)}l.parse=k}),98);
__d("oz-player/parsers/OzSidxSegmentsParser",["oz-player/loggings/OzLoggingUtils","oz-player/manifests/OzSegmentOptions","oz-player/manifests/OzZeroTimeRangeSegment","oz-player/networks/getOzBandwidthEstimatorPipeThroughReporter","oz-player/parsers/OzMp4SidxParser","oz-player/parsers/OzSidxSegmentsContainer","oz-player/parsers/OzWebmSidxParser","oz-player/shims/OzEventEmitter","oz-player/shims/OzMaybeNativePromise","oz-player/shims/OzURI","oz-player/utils/OzErrorEmitter","oz-player/utils/OzReadableStreamUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.split("-");return{startByte:Number.parseInt(t[0],10),endByte:Number.parseInt(t[1],10)}}var s=(function(){function t(e,t,n,o,a,i,l){this.$6=new(r("oz-player/utils/OzErrorEmitter")),this.$7=[],this.$9=new(r("oz-player/shims/OzEventEmitter")),this.$1=t,this.$2=new(r("oz-player/shims/OzURI"))(n),this.$3=o,this.$5=a,this.$4=i,this.$8=l.cloneContext().setType(a==="video"||a==="audio"?a+";sidx":"sidx"),this.$10=e}var n=t.prototype;return n.onError=function(t){return this.$6.onError(t)},n.parseInitializationSegment=function(){var t=this,n=this.$1.Initialization[0].$.range,o=e(n),a=new(r("oz-player/manifests/OzSegmentOptions"));return this.$10.getBool("sidx_parser_memory_optimization")?new(r("oz-player/manifests/OzZeroTimeRangeSegment"))(this.$2,o.startByte,o.endByte):{getData:function(){return null},getURI:function(){return t.$2},getTimeRange:function(){return{startTime:0,endTime:0}},getByteRange:function(){return o},getSequenceNumber:function(){return null},getOptions:function(){return a}}},n.parseSegmentsContainer=function(){var e=this,t=this.$11();return o("oz-player/loggings/OzLoggingUtils").monitorPromiseAndLogOperation(t,this.$8,"process_sidx"),t.catch(function(t){e.$6.emitError(t)}),new(r("oz-player/parsers/OzSidxSegmentsContainer"))(function(){return e.$7},this.$9)},n.$12=function(t,n,a){var e=new(r("oz-player/manifests/OzZeroTimeRangeSegment"))(t,n.startByte,n.endByte),i=this.$5+";sidx",l=this.$4.request({debugName:"OzSidxSegmentsParser/sidx/"+this.$5,segments:[e],pipeThroughRangeStreamProviders:[r("oz-player/networks/getOzBandwidthEstimatorPipeThroughReporter")(i,this.$4.getBandwidthEstimator())],loggerProvider:this.$8,requestOptions:{networkTimeoutMs:null,retryAttempts_SIDX_USE_ONLY:this.$10.getNumber("sidx_segment_retry_attempts"),retryTimeoutMs_SIDX_USE_ONLY:this.$10.getNumber("sidx_segment_retry_interval_ms")},mediaStreamType:a}),s=l.getStream().getReader();return o("oz-player/utils/OzReadableStreamUtils").pumpAllData(s)},n.$11=function(){var t=this,n=this.$1.$.indexRange,a=e(n),i=[this.$12(this.$2,a,null)],l;if(this.$3==="webm"){var s=e(this.$1.Initialization[0].$.range);i.push(this.$12(this.$2,s,null)),l=r("oz-player/shims/OzMaybeNativePromise").all(i).then(function(e){var n=e[0],r=e[1];t.$7=o("oz-player/parsers/OzWebmSidxParser").parse(t.$10,t.$2,n,r)})}else l=i[0].then(function(e){t.$7=o("oz-player/parsers/OzMp4SidxParser").parse(t.$10,t.$2,a.startByte,e)});return l.then(function(){t.$9.emit("segment_updated")})},t})();l.default=s}),98);
__d("oz-player/parsers/OzVideoContainerType",[],(function(t,n,r,o,a,i){"use strict";function e(e){return(e.split("/")[1]||"").trim()}i.parse=e}),66);
__d("oz-player/parsers/OzRepresentationParserBase",["oz-player/manifests/OzRepresentationBase","oz-player/parsers/OzSegmentTemplateParser","oz-player/parsers/OzSidxSegmentsParser","oz-player/parsers/OzVideoContainerType","oz-player/utils/OzErrorEmitter","oz-player/utils/OzErrorUtils","oz-player/utils/OzMimeUtil"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n,o,a,i,l,s,u,c,d,m,p,_,f){this.$9=new(r("oz-player/utils/OzErrorEmitter")),this.$1=t,this.$2=n,this.$10=a,this.$11=i,this.$13=o,this.$14=e,this.$15=l,this.$3=s,this.$4=u,this.$5=c,this.$6=d!=null?d:null,this.$7=m!=null?m:null,this.$8=p!=null?p:null,this.$16=_,this.$17=f;try{this.$11=this.$11.cloneContext().setRepresentationID(this.parseID())}catch(e){}}var t=e.prototype;return t.$18=function(){var e=this,t=this.$12;if(t)return t;if(this.$1.SegmentBase){var n=this.$1.SegmentBase[0],a=this.$1.BaseURL[0]._;if(typeof a!="string")throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_REPRESENTATION_PARSER",description:"Missing representation BaseURL",extra:{code:"OZ_RP-9"}});t=new(r("oz-player/parsers/OzSidxSegmentsParser"))(this.$14,n,a,o("oz-player/parsers/OzVideoContainerType").parse(this.$1.$.mimeType),o("oz-player/utils/OzMimeUtil").getMimeType(this.$1.$.mimeType),this.$10,this.$11),t.onError(function(t){var n;if(!((n=e.$17)!=null&&n.handleError(e.parseID(),t)))return e.$9.emitError(t)})}else if(this.$1.SegmentTemplate)t=this.$19(this.$1.SegmentTemplate[0],{isShared:!1});else if(this.$3)t=this.$19(this.$3[0],{isShared:!0});else throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_REPRESENTATION_PARSER",description:"Unrecognized representation type",extra:{code:"OZ_RP-7"}});return this.$12=t,t},t.$19=function(t,n){var e,a=t;n.isShared&&(a=babelHelpers.extends({},a,{$:babelHelpers.extends({},a.$,{initialization:a.$.initialization.replace("$RepresentationID$",this.$1.$.id),media:a.$.media.replace("$RepresentationID$",this.$1.$.id)})}));var i=this.$13.mpdUrl,l=this.$1.BaseURL&&this.$1.BaseURL[0]?this.$1.BaseURL[0]._:null,s=l!=null?l:i;if(s==null)throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_REPRESENTATION_PARSER",description:"Missing mpd url for template manifest",extra:{code:"OZ_RP-6"}});var u=this.$13.customSegmentTimelineParser,c=(e=this.$13.customRepresentationParsers)==null?void 0:e.initializationBinary,d=c?c(this.$1):null;return new(r("oz-player/parsers/OzSegmentTemplateParser"))(this.$14,a,{baseUrl:s,mpdUrl:i,isStaticMpd:this.$15.manifestType==="static",isTemplatedMpd:this.$15.manifestIsTemplated},u,d)},t.onError=function(t){return this.$9.onError(t)},t.parseInitSegment=function(){return this.$18().parseInitializationSegment()},t.parseBandwidth=function(){return Number(this.$1.$.bandwidth)},t.parseMimeType=function(){var e,t;return(e=(t=this.$1.$.mimeType)!=null?t:this.$4)!=null?e:""},t.parseCodecs=function(){var e,t;return(e=(t=this.$1.$.codecs)!=null?t:this.$5)!=null?e:""},t.parseVariantKey=function(){return this.$6},t.parseLang=function(){return this.$7},t.parseRole=function(){return this.$8},t.parseSegmentsContainer=function(){return this.$18().parseSegmentsContainer()},t.parseID=function(){return""+this.$1.$.id},t.parseCustomFieldFirstSegment=function(){var e=this.$13.customRepresentationParsers?this.$13.customRepresentationParsers.firstSegmentParser:null;return e?e(this.$1):null},t.parse=function(){return new(r("oz-player/manifests/OzRepresentationBase"))(this.$1,this.$2,this.parseID(),this.parseMimeType(),this.parseCodecs(),this.parseVariantKey(),this.parseLang(),this.parseRole(),this.parseInitSegment(),this.parseSegmentsContainer(),this.parseBandwidth(),this.parseCustomFieldFirstSegment(),this.$13.customRepresentationParsers)},e})();l.default=e}),98);
__d("oz-player/parsers/OzApplicationRepresentationParser",["oz-player/manifests/OzApplicationRepresentation","oz-player/parsers/OzRepresentationParserBase"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n,r,o,a,i,l,s,u,c,d,m,p,_){var f;return f=e.call(this,t,n,r,o,a,i,l,s,u,c,d,m,p,_)||this,f.$OzApplicationRepresentationParser$p_1=n,f.$OzApplicationRepresentationParser$p_3=o,f}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.parse=function(){var e=this.$OzApplicationRepresentationParser$p_3.customRepresentationParsers;return new(r("oz-player/manifests/OzApplicationRepresentation"))(this.$OzApplicationRepresentationParser$p_1,this.$OzApplicationRepresentationParser$p_2,this.parseID(),this.parseMimeType(),this.parseCodecs(),this.parseVariantKey(),this.parseLang(),this.parseRole(),this.parseInitSegment(),this.parseSegmentsContainer(),this.parseBandwidth(),this.parseCustomFieldFirstSegment(),e)},t})(r("oz-player/parsers/OzRepresentationParserBase"));l.default=e}),98);
__d("oz-player/manifests/OzAudioRepresentation",["oz-player/manifests/OzRepresentationBase"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n,r,o,a,i,l,s,u,c,d,m,p){var _;return _=e.call(this,t,n,r,o,a,i,l,s,u,c,d,m,p)||this,_.$OzAudioRepresentation$p_1=r,_.$OzAudioRepresentation$p_2=d,_.$OzAudioRepresentation$p_3={id:r,displayLabel:_.getDisplayLabel(),mimeCodecs:_.getMimeCodecs(),variantKey:i,lang:l,role:s},_}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.getBitrateKbps=function(){var e=1024;return(this.$OzAudioRepresentation$p_2/e).toFixed(1)+"Kbps"},n.getDisplayLabel=function(){var t=e.prototype.getLang.call(this),n=e.prototype.getRole.call(this),r=t==null?"Default":t;return n==null?r:r+" - "+n},n.getAudioTrack=function(){return this.$OzAudioRepresentation$p_3},t})(r("oz-player/manifests/OzRepresentationBase"));l.default=e}),98);
__d("oz-player/parsers/OzAudioRepresentationParser",["oz-player/manifests/OzAudioRepresentation","oz-player/parsers/OzRepresentationParserBase"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n,r,o,a,i,l,s,u,c,d,m,p,_){var f;return f=e.call(this,t,n,r,o,a,i,l,s,u,c,d,m,p,_)||this,f.$OzAudioRepresentationParser$p_1=n,f.$OzAudioRepresentationParser$p_3=o,f}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.parse=function(){var e=this.$OzAudioRepresentationParser$p_3.customRepresentationParsers;return new(r("oz-player/manifests/OzAudioRepresentation"))(this.$OzAudioRepresentationParser$p_1,this.$OzAudioRepresentationParser$p_2,this.parseID(),this.parseMimeType(),this.parseCodecs(),this.parseVariantKey(),this.parseLang(),this.parseRole(),this.parseInitSegment(),this.parseSegmentsContainer(),this.parseBandwidth(),this.parseCustomFieldFirstSegment(),e)},t})(r("oz-player/parsers/OzRepresentationParserBase"));l.default=e}),98);
__d("oz-player/parsers/OzVideoRepresentationParser",["oz-player/manifests/OzVideoRepresentation","oz-player/parsers/OzRepresentationParserBase"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n,r,o,a,i,l,s,u,c,d,m,p,_,f){var g;return g=e.call(this,t,n,r,o,a,i,l,s,u,c,d,m,p,_,f)||this,g.$OzVideoRepresentationParser$p_1=n,g.$OzVideoRepresentationParser$p_2=r,g.$OzVideoRepresentationParser$p_3=o,g}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.parse=function(){var e=Number.parseInt(this.$OzVideoRepresentationParser$p_1.$.height,10),t=Number.parseInt(this.$OzVideoRepresentationParser$p_1.$.width,10),n=this.$OzVideoRepresentationParser$p_3.customRepresentationParsers;return new(r("oz-player/manifests/OzVideoRepresentation"))(this.$OzVideoRepresentationParser$p_1,this.$OzVideoRepresentationParser$p_2,this.parseID(),this.parseMimeType(),this.parseCodecs(),this.parseVariantKey(),this.parseLang(),this.parseRole(),this.parseInitSegment(),this.parseSegmentsContainer(),this.parseBandwidth(),this.parseCustomFieldFirstSegment(),n,t,e)},t})(r("oz-player/parsers/OzRepresentationParserBase"));l.default=e}),98);
__d("oz-player/utils/OzIbrUtils",["oz-player/networks/OzBandwidthEstimator"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,n,o){var e=r("oz-player/networks/OzBandwidthEstimator").getAdjustedBandwidth(n.getLegacyConfig()),a=t.slice(0);a.sort(function(e,t){return e.getBandwidth()-t.getBandwidth()});for(var i=n.getNumber("live_audio_ibr_bandwidth_percentage"),l=e*i,s=a.length-1;s>=0;s--)if(a[s].getBandwidth()<=l)return o.getOperationLogger("audio_ibr_success").setRepresentationID(a[s].getID()).setReason(e.toString()).log(),a[s];return o.getOperationLogger("audio_ibr_no_op").setReason(e.toString()).log(),null};l.getInitialAudioRepresentation=e}),98);
__d("oz-player/parsers/OzMpdParser",["oz-player/manifests/Mpd","oz-player/parsers/OzApplicationRepresentationParser","oz-player/parsers/OzAudioRepresentationParser","oz-player/parsers/OzVideoRepresentationParser","oz-player/utils/OzErrorEmitter","oz-player/utils/OzErrorUtils","oz-player/utils/OzIbrUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){var t=e.blockedRepresentationsManager,n=e.config,o=e.drmManager,a=e.enableAlternativeAudioTracks,i=e.initialRepresentationIDs,l=e.networkManager,s=e.ozParserContext,u=e.perfLoggerProvider,c=e.useManagedMediaSource;this.$2=new(r("oz-player/utils/OzErrorEmitter")),this.$5=n,this.$1=l,this.$3=u,this.$4=s,this.$6=o,this.$7=i!=null?i:[],this.$8=t!=null?t:null,this.$9=a,this.$10=c!=null?c:!1,this.$11=!0}var t=e.prototype;return t.onError=function(t){return this.$2.onError(t)},t.parse=function(t){var e=this,n=[],a=t,i=this.$4.createXmlParser().parse(a),l=i.MPD&&i.MPD.length>0?i.MPD[0]:null;if(!l){var s=2e3;throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_MPD_PARSER",description:"parsed manifest XML missing MPD node; truncated xml ("+Math.min(s,a.length)+"/"+a.length+"): "+a.substring(0,s)})}var u=l.Period&&l.Period.length>0?l.Period[0]:null;if(!u){var c=2e3;throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_MPD_PARSER",description:"parsed manifest XML missing Period node; truncated xml ("+Math.min(c,a.length)+"/"+a.length+"): "+a.substring(0,c)})}var d=u.AdaptationSet||[],m=this.$12(l);this.$11=m==="static";var p=this.$13(l),_=this.$14(this.$15(d,"video"),{manifestType:m,manifestIsTemplated:p},n),f;this.$9?f=this.$16(this.$15(d,"audio"),{manifestType:m,manifestIsTemplated:p},n).sort(function(e,t){return e.getBandwidth()-t.getBandwidth()}):f=this.$17(this.$18(d,"audio"),r("oz-player/parsers/OzAudioRepresentationParser"),{manifestType:m,manifestIsTemplated:p},n).sort(function(e,t){return e.getBandwidth()-t.getBandwidth()});var g=[];if(this.$5.getBool("vtt_caption_representation")){var h=this.$15(d,"application");g=this.$17(h[0],r("oz-player/parsers/OzApplicationRepresentationParser"),{manifestType:m,manifestIsTemplated:p},n)}var y=this.$4.mpdUrl,C=new(r("oz-player/manifests/Mpd"))(l,_,f,g,y,this.$19(l),this.$4.customParsers||new Map,this.$11);if(this.$6){var b=this.$6;b.startEME(_,f)}return n.forEach(function(t){t.onError(e.$2.emitError)}),C},t.$19=function(t){var e=t.$.minimumUpdatePeriod||"",n=/\d+/g.exec(e);if(n&&n.length){var r=n[0];return r?Number.parseInt(r,10):null}return null},t.$12=function(t){return t.$.type||"static"},t.$13=function(t){var e,n=(e=this.$4.customParsers)==null?void 0:e.get("isLiveTemplated");if(!n)return!1;var r=n(t);return typeof r=="boolean"&&r},t.$18=function(t,n){return t.find(this.$20(n))},t.$15=function(t,n){return t.filter(this.$20(n))},t.$20=function(t){return function(e){if(e.$.mimeType!=null)return e.$.mimeType.indexOf(t)!==-1;var n=e.Representation;return n&&n.length>0&&n[0].$.mimeType.indexOf(t)!==-1}},t.$17=function(t,n,r,o){var e=this;if(!t)return[];var a=t.Role,i=a!=null?a:[],l=i[0],s=l?l.$.value:null,u=t.$.lang,c=u==="und"?null:u,d=t.$.FBVariantKey,m=d==="und"?null:d!=null?d:null;return t.Representation.map(function(a){var i,l=new n(e.$5,a,(i=a.ContentProtection)!=null?i:t.ContentProtection,e.$4,e.$1,e.$3,r,t.SegmentTemplate,t.$.mimeType,t.$.codecs,m,c,s,e.$7,e.$8),u=l.parse();return o.push(l),u})},t.$21=function(t){return this.$10?ManagedMediaSource.isTypeSupported(t):MediaSource.isTypeSupported(t)},t.$14=function(t,n,o){var e=this,a=[],i=new Set;return t.filter(Boolean).forEach(function(t,l,s){var u=l===s.length-1;for(var c of t.Representation){var d,m;if(!((d=c.$.FBAbrPolicyTags)!=null&&d.includes("avoid_on_abr")&&!u)){var p=t.Role,_=p!=null?p:[],f=_[0],g=f?f.$.value:null,h=t.$.lang,y=h==="und"?null:h,C=t.$.FBVariantKey,b=C==="und"?null:C!=null?C:null,v=new(r("oz-player/parsers/OzVideoRepresentationParser"))(e.$5,c,(m=c.ContentProtection)!=null?m:t.ContentProtection,e.$4,e.$1,e.$3,n,t.SegmentTemplate,t.$.mimeType,t.$.codecs,b,y,g,e.$7,e.$8),S=v.parse();if(o.push(v),!e.$21(S.getMimeCodecs())){i.add(S.getMimeCodecs());continue}a.push(S)}}}),a.filter(Boolean)},t.$16=function(t,n,a){var e=this,i=[],l=new Set,s=t.filter(Boolean).map(function(t){var o=t.Role,i=o!=null?o:[],s=i[0],u=s?s.$.value:null,c=t.$.lang,d=c==="und"?null:c,m=t.$.FBVariantKey,p=m==="und"?null:m!=null?m:null,_=[];for(var f of t.Representation){var g,h=new(r("oz-player/parsers/OzAudioRepresentationParser"))(e.$5,f,(g=f.ContentProtection)!=null?g:t.ContentProtection,e.$4,e.$1,e.$3,n,t.SegmentTemplate,t.$.mimeType,t.$.codecs,p,d,u,e.$7),y=h.parse();if(a.push(h),!e.$21(y.getMimeCodecs())){l.add(y.getMimeCodecs());continue}_.push(y)}return _});return s.forEach(function(t){if(t.length>1){var n=o("oz-player/utils/OzIbrUtils").getInitialAudioRepresentation(t,e.$5,e.$3);i.push(n!=null?n:t[0])}else i.push.apply(i,t)}),i.filter(Boolean)},e})();l.default=e}),98);
__d("oz-player/utils/OzMpdUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=null;return e.forEach(function(e){if(e){var n,r,o=e.endTime;o<((n=(r=t)==null?void 0:r.endTime)!=null?n:1/0)&&(t=e)}}),t}function l(t,n){var r=[];if(r.push.apply(r,t.getVideoRepresentations().concat(t.getAudioRepresentations())),r.length){var o=r.map(function(e){var t=e.getEndingSegment();return t?t.getTimeRange():null});return e(o)}return null}function s(e){var t=[];if(t.push.apply(t,e.getVideoRepresentations().concat(e.getAudioRepresentations())),t.length){var n=t[0].getEndingSegment();if(n)return n.getSequenceNumber()}return null}i.getLeastEndTimeTimeRange=e,i.getMpdLastTimeRange=l,i.getMpdLastSequenceNumber=s}),66);
__d("oz-player/utils/OzStreamInterruptChecker",["oz-player/shims/OzEventEmitter","oz-player/utils/OzMpdUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n){var r;return r=e.call(this)||this,r.$OzStreamInterruptChecker$p_4=0,r.$OzStreamInterruptChecker$p_5=null,r.$OzStreamInterruptChecker$p_6=!1,r.$OzStreamInterruptChecker$p_2=t,r.$OzStreamInterruptChecker$p_3=n,r.$OzStreamInterruptChecker$p_1=r.$OzStreamInterruptChecker$p_3.getNumber("live_numerical_error_epsilon"),r}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.notifyMpdUpdated=function(){var e=o("oz-player/utils/OzMpdUtils").getMpdLastTimeRange(this.$OzStreamInterruptChecker$p_2,this.$OzStreamInterruptChecker$p_3),t=e?e.endTime:null,n=!1;t!==null&&(n=t===this.$OzStreamInterruptChecker$p_5),n?this.$OzStreamInterruptChecker$p_4++:(this.$OzStreamInterruptChecker$p_4=0,this.$OzStreamInterruptChecker$p_6&&this.$OzStreamInterruptChecker$p_5!==null&&this.$OzStreamInterruptChecker$p_5!==void 0&&e!==null&&e!==void 0&&this.emit("streamResumedAt",e.startTime),this.$OzStreamInterruptChecker$p_6=!1);var r=this.$OzStreamInterruptChecker$p_3.getNumber("stream_interrupt_check_mpd_stale_count_threshold");!this.$OzStreamInterruptChecker$p_6&&r>0&&this.$OzStreamInterruptChecker$p_4>=r&&t!==null&&t!==void 0&&(this.emit("streamInterruptAt",t),this.$OzStreamInterruptChecker$p_6=!0),this.$OzStreamInterruptChecker$p_5=t},t})(r("oz-player/shims/OzEventEmitter"));l.default=e}),98);
__d("oz-player/parsers/OzMpdUpdater",["oz-player/parsers/OzMpdParser","oz-player/shims/OzEventEmitter","oz-player/shims/OzSubscriptionsHandler","oz-player/shims/OzURI","oz-player/shims/ozClearTimeout","oz-player/shims/ozSetTimeoutAcrossTransitions","oz-player/utils/OzErrorEmitter","oz-player/utils/OzErrorUtils","oz-player/utils/OzMpdUtils","oz-player/utils/OzReadableStreamUtils","oz-player/utils/OzStreamInterruptChecker"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n,a,i,l,s,u,c,d){var m;m=e.call(this)||this,m.$OzMpdUpdater$p_8=new(r("oz-player/utils/OzErrorEmitter")),m.$OzMpdUpdater$p_10=new(r("oz-player/shims/OzSubscriptionsHandler")),m.$OzMpdUpdater$p_11=!1,m.$OzMpdUpdater$p_16=0,m.$OzMpdUpdater$p_18=0,m.$OzMpdUpdater$p_19=null,m.$OzMpdUpdater$p_21=!0,m.$OzMpdUpdater$p_22=0,m.$OzMpdUpdater$p_26=function(){var e,t,n=m.$OzMpdUpdater$p_2.getLocation();if(m.$OzMpdUpdater$p_21=!1,!(n==null||n==="")){var a=new(r("oz-player/shims/OzURI"))(n),i=String((e=(t=a.getQueryData().ms)!=null?t:a.getQueryData().msdev)!=null?e:a.getQueryData().mstest);if(!m.$OzMpdUpdater$p_12.isPlaying()){m.setupUpdateLoop();return}var l=m.$OzMpdUpdater$p_5.getOperationLogger("update_manifest").start();m.$OzMpdUpdater$p_28(n).then(function(e){var t,a,s,u,c,d,p,_;if(m.$OzMpdUpdater$p_18=0,m.$OzMpdUpdater$p_29(),m.$OzMpdUpdater$p_7=0,!m.$OzMpdUpdater$p_21){var f=babelHelpers.extends({},m.$OzMpdUpdater$p_13,{mpdUrl:n}),g=new(r("oz-player/parsers/OzMpdParser"))({config:m.$OzMpdUpdater$p_6,ozParserContext:f,networkManager:m.$OzMpdUpdater$p_1,perfLoggerProvider:m.$OzMpdUpdater$p_5,drmManager:m.$OzMpdUpdater$p_14,initialRepresentationIDs:[],blockedRepresentationsManager:null,enableAlternativeAudioTracks:!1,useManagedMediaSource:m.$OzMpdUpdater$p_23});g.onError(function(e){m.$OzMpdUpdater$p_8.emitError(e),l.setError(e).log()});var h=g.parse(e),y=m.$OzMpdUpdater$p_2.isStaticMpd();m.$OzMpdUpdater$p_2.updateWith(h),m.$OzMpdUpdater$p_2.markRefreshed(),h.isStaticMpd()&&!y&&m.emit("streamTransitionToStatic");var C=o("oz-player/utils/OzMpdUtils").getMpdLastTimeRange(m.$OzMpdUpdater$p_2,m.$OzMpdUpdater$p_6),b=C&&C.endTime!=0?C.endTime:null,v=String((t=(a=m.$OzMpdUpdater$p_2)==null?void 0:a.getCustomField("currentServerTimeMs"))!=null?t:""),S=String((s=(u=m.$OzMpdUpdater$p_2)==null?void 0:u.getCustomField("lastVideoFrameTs"))!=null?s:""),R={currentServerTimeMs:v,ingestLastVideoFrameTs:S,nowMs:String(Date.now())},L=new Set(((c=(d=m.$OzMpdUpdater$p_2)==null?void 0:d.getVideoRepresentations())!=null?c:[]).map(function(e){return e.getCodecs()})).size>1,E=new Set(((p=(_=m.$OzMpdUpdater$p_2)==null?void 0:_.getAudioRepresentations())!=null?p:[]).map(function(e){return e.getCodecs()})).size>1;l.setLiveheadPosition(b).setLiveheadSeqNumMpd(o("oz-player/utils/OzMpdUtils").getMpdLastSequenceNumber(m.$OzMpdUpdater$p_2)).setManifestType(m.$OzMpdUpdater$p_2.isStaticMpd()?"static":"dynamic").setIsMixedCodecManifest(L||E).setIsTemplatedManifest(!!m.$OzMpdUpdater$p_2.getCustomField("isLiveTemplated")).setPlaybackFbmsParam(i).setUserInfo(R).log(),m.$OzMpdUpdater$p_9.notifyMpdUpdated(),m.setupUpdateLoop()}}).catch(function(e){m.$OzMpdUpdater$p_29(),l.setError(e).log();var t=null;if(o("oz-player/utils/OzErrorUtils").isOzError(e))t=e;else{var r,a=null,i="Caught an unknown error when fetching the manifest.";if(e!=null)if(m.$OzMpdUpdater$p_6.getBool("normalize_mpd_fetch_errors")){var s=o("oz-player/utils/OzErrorUtils").getNormalizedErrorAndCode(e),u=s[0],c=s[1];t=u}else r=e,a=r.code!=null?String(r.code):null,i=r.name+"; "+r.message+"; "+r.description+";";if(t==null){var d={originalError:r,url:n};a!==null&&(d.code=a),t=o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_NETWORK",description:i,extra:d})}}m.$OzMpdUpdater$p_27(t,n)})}};var p=n.getMinimumUpdatePeriod();return m.$OzMpdUpdater$p_7=0,m.$OzMpdUpdater$p_1=a,m.$OzMpdUpdater$p_2=n,m.$OzMpdUpdater$p_12=i,m.$OzMpdUpdater$p_3=p,m.$OzMpdUpdater$p_5=l.cloneContext().setType("manifest"),m.$OzMpdUpdater$p_6=t,m.$OzMpdUpdater$p_13=s,m.$OzMpdUpdater$p_14=u,m.$OzMpdUpdater$p_15=c,m.$OzMpdUpdater$p_23=d,m.$OzMpdUpdater$p_2.addListener("locationUpdated",function(){m.$OzMpdUpdater$p_24(),m.setupUpdateLoop()}),m.$OzMpdUpdater$p_9=new(r("oz-player/utils/OzStreamInterruptChecker"))(m.$OzMpdUpdater$p_2,m.$OzMpdUpdater$p_6),m.$OzMpdUpdater$p_10.addSubscriptions(m.$OzMpdUpdater$p_9.addListener("streamResumedAt",function(e){m.emit("streamResumedAt",e)}),m.$OzMpdUpdater$p_9.addListener("streamInterruptAt",function(e){m.emit("streamInterruptAt",e)})),m}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.$OzMpdUpdater$p_24=function(){r("oz-player/shims/ozClearTimeout")(this.$OzMpdUpdater$p_4),this.$OzMpdUpdater$p_4=null,this.$OzMpdUpdater$p_25(),this.$OzMpdUpdater$p_21=!0},n.setupUpdateLoop=function(){var e,t=!this.$OzMpdUpdater$p_11;t&&(t=!this.$OzMpdUpdater$p_2.isStaticMpd(),this.$OzMpdUpdater$p_3=this.$OzMpdUpdater$p_2.getMinimumUpdatePeriod());var n=this.$OzMpdUpdater$p_17==null&&this.$OzMpdUpdater$p_6.getNumber("manifest_initial_update_delay_ms")>0?this.$OzMpdUpdater$p_6.getNumber("manifest_initial_update_delay_ms"):this.$OzMpdUpdater$p_6.getNumber("manifest_update_frequency_ms")||((e=this.$OzMpdUpdater$p_3)!=null?e:0)*1e3;t&&n&&this.$OzMpdUpdater$p_2.getLocation()&&(this.$OzMpdUpdater$p_4=r("oz-player/shims/ozSetTimeoutAcrossTransitions")(this.$OzMpdUpdater$p_26,n))},n.onError=function(t){return this.$OzMpdUpdater$p_8.onError(t)},n.$OzMpdUpdater$p_27=function(t,n){var e=this,r=!0,o=this.$OzMpdUpdater$p_18-1,a=t.getExtra().code;this.$OzMpdUpdater$p_19!==a?(this.$OzMpdUpdater$p_19=a,this.$OzMpdUpdater$p_16=1):this.$OzMpdUpdater$p_16++;var i=function(){r=!1},l={endStream:function(){i(),e.$OzMpdUpdater$p_11=!0,e.emit("streamGone")},consecutiveFailuresForErrorCode:this.$OzMpdUpdater$p_16,error:t,isInitialRequest:!1,retry:function(r){e.emit("manifestFetchErrorRetry",t),i(),e.setupUpdateLoop()},retryAttemptCount:o};this.emit("manifestFetchError",l),r&&this.$OzMpdUpdater$p_8.emitError(t)},n.$OzMpdUpdater$p_30=function(t,n){var e=new(r("oz-player/shims/OzURI"))(t);return e.addQueryData("_nc_expid",n),e.toString()},n.$OzMpdUpdater$p_31=function(t){if(!this.$OzMpdUpdater$p_15)return t;var e=new(r("oz-player/shims/OzURI"))(t);return e.addQueryData("_nc_tsid","mpd-"+this.$OzMpdUpdater$p_22++),e.toString()},n.$OzMpdUpdater$p_28=function(t){this.$OzMpdUpdater$p_25(),this.$OzMpdUpdater$p_18++;var e=this.$OzMpdUpdater$p_6.getString("cdn_experiment_id"),n=e.length===0?t:this.$OzMpdUpdater$p_30(t,e);n=this.$OzMpdUpdater$p_31(n);var r=this.$OzMpdUpdater$p_1.requestRawUrl({debugName:"OzMpdUpdater/requestMpd/mpd",url:n,options:{networkTimeoutMs:this.$OzMpdUpdater$p_6.getNumber("mpd_updater_network_request_timeout_ms")},loggerProvider:this.$OzMpdUpdater$p_5});this.$OzMpdUpdater$p_17=Date.now(),this.$OzMpdUpdater$p_20=r;var a=r.getStream().getReader();return o("oz-player/utils/OzReadableStreamUtils").pumpString(a)},n.$OzMpdUpdater$p_25=function(){this.$OzMpdUpdater$p_20&&(this.$OzMpdUpdater$p_20.cancel(),this.$OzMpdUpdater$p_18=0),this.$OzMpdUpdater$p_29()},n.$OzMpdUpdater$p_29=function(){this.$OzMpdUpdater$p_20=null},n.destroy=function(){this.$OzMpdUpdater$p_4&&r("oz-player/shims/ozClearTimeout")(this.$OzMpdUpdater$p_4),this.$OzMpdUpdater$p_10.release()},t})(r("oz-player/shims/OzEventEmitter"));l.default=e}),98);
__d("oz-player/shims/OzXmlParserTrustedTypesHTMLPolicy",["oz-player/shims/www/OzXmlParserTrustedTypesHTMLPolicyWWW"],(function(t,n,r,o,a,i,l){"use strict";l.createTrustedHTMLForDOMParser=o("oz-player/shims/www/OzXmlParserTrustedTypesHTMLPolicyWWW").createTrustedHTMLForDOMParser}),98);
__d("oz-player/parsers/OzXmlParserImplDOMParser",["oz-player/shims/OzXmlParserTrustedTypesHTMLPolicy","oz-player/utils/OzErrorUtils"],(function(t,n,r,o,a,i,l){function e(){return{$:{}}}function s(t){for(var n=e(),r=t.attributes,o=0;o<r.length;++o){var a=r[o];n.$[a.name]=a.value}for(var i=t.childNodes,l=0;l<i.length;++l){var u=i[l];if(u instanceof Element){var c=u.nodeName;Object.prototype.hasOwnProperty.call(n,c)||(n[c]=[]),n[c].push(s(u))}else{var d=u.nodeValue.trim();d&&(n._=d)}}return n}var u=(function(){function t(){this.$1=new DOMParser}var n=t.prototype;return n.parse=function(n){try{var t=e(),r=o("oz-player/shims/OzXmlParserTrustedTypesHTMLPolicy").createTrustedHTMLForDOMParser(n),a=this.$1.parseFromString(r,"application/xml"),i=a.querySelector("parsererror");if(i){var l=i.querySelector("h3"),u=l?l.nextElementSibling:null,c=u?u.innerHTML:i.innerHTML,d=2e3;throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_XML_PARSER",description:"DOMParser parsererror: "+String(c).trim()+"; truncated xml ("+Math.min(d,n.length)+"/"+n.length+"): "+n.substring(0,d),extra:{}})}var m=a.documentElement;return m!=null&&(t[m.nodeName]=[s(m)]),t}catch(e){if(o("oz-player/utils/OzErrorUtils").isOzError(e))throw e;var p=2e3;throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_XML_PARSER",description:"XML parse exception: "+String(e)+"; truncated xml ("+Math.min(p,n.length)+"/"+n.length+"): "+n.substring(0,p),extra:{originalError:e}})}},t})();l.default=u}),98);
__d("oz-player/playback_controls/OzClearSourceBufferOnSeekManager",["oz-player/shims/OzDeferred","oz-player/shims/OzMaybeNativePromise","oz-player/utils/OzCustomErrorCode","oz-player/utils/OzErrorEmitter","oz-player/utils/OzErrorUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n,o){o===void 0&&(o=null),this.$3=new(r("oz-player/utils/OzErrorEmitter")),this.$4=new Map,this.$5=!1,this.$6=!1,this.$7=!1,this.$8=null,this.$9=[],this.$10=null,this.$11=null,this.$1=e,this.$2=t,this.$4=n,this.$11=o}var t=e.prototype;return t.$12=function(t){var e;return this.$5=!0,(e=this.$8)!=null?e:t.call(this.$1)},t.$13=function(t,n){this.$6=!0,this.$9.push({t:n}),this.$8=n,this.$9.length===1&&this.$14(t)},t.$15=function(t){return this.$7=!0,this.$8!=null?!0:t.call(this.$1)},t.$16=function(t,n){var e=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise")),o=[];this.$4.forEach(function(e,r){var a=e.clearSourceBufferRange(t,n);o.push(a)});var a=r("oz-player/shims/OzMaybeNativePromise").all(o);return a.then(function(){e.resolve()}).catch(function(t){e.reject(t)}),e.getPromise()},t.$14=function(t){var e=this,n=this.$9.length>0?this.$9[0]:null,a=this.$2.getNumber("clear_buffer_on_seek_epsilon_s");if(n){for(var i=n.t,l=this.$1.buffered,s=l.length,u=l.length<=0,c=-1,d=!1,m=0;c<0&&m<s;++m)c=i-a>=l.start(m)&&i+a<l.end(m)?m:c,d=i<l.start(m)-a;var p=c>-1,_=this.$2.getNumber("clear_buffer_on_seek_nudge_s");if(p&&c>=0&&c<s&&_>0&&(i=Math.min(i,l.end(c)-_),i=Math.max(i,l.start(c)+_)),u||p||!d)this.$11&&this.$11.getOperationLogger("seek_to_next_time").setLength(Math.round(i*1e3)).setInitiator("no_clear").log(),t.call(this.$1,i),this.$9.shift(),this.$14(t);else{var f=null;this.$11&&(f=this.$11.getOperationLogger("clear_buffer_before_seek").setLength(Math.round(i*1e3)).setUserInfo({bufferRangesLength:String(s),nudgeSec:String(_)}).start());var g=this.$16(Math.max(i-a,0),l.end(s-1)+a);g.then(function(){f&&f.log(),e.$11&&e.$11.getOperationLogger("seek_to_next_time").setLength(Math.round(i*1e3)).setInitiator("after_clear").log(),t.call(e.$1,i),e.$9.shift(),e.$14(t)}).catch(function(t){f&&f.setError(t).log(),e.$3.emitError(o("oz-player/utils/OzErrorUtils").isOzError(t)?t:o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SOURCE_BUFFER",description:t?t.name+": "+t.message:"Unknown error while clearing the buffer.",extra:{code:r("oz-player/utils/OzCustomErrorCode").SOURCE_BUFFER_MANAGER_CLEAR_RANGE_FAILED,originalError:t}}))})}}else this.$8=null},t.maybeOverwriteVideoCurrentTimeProperty=function(){var e=this,t=Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(this.$1,"currentTime");t=t!=null?t:Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"currentTime");var n=Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(this.$1,"seeking");n=n!=null?n:Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"seeking");var r=t&&typeof t.get=="function"?t.get:null,o=t&&typeof t.set=="function"?t.set:null,a=n&&typeof n.get=="function"?n.get:null;if(r&&o&&a&&Object.defineProperty){try{Object.defineProperty(this.$1,"currentTime",{get:function(){return e.$12(r)},set:function(n){e.$13(o,n)},configurable:!0,enumerable:!0}),Object.defineProperty(this.$1,"seeking",{get:function(){return e.$15(a)},configurable:!0,enumerable:!0});var i=this.$1.currentTime;this.$1.currentTime=i,this.$1.seeking}catch(e){}this.$17(function(){e.getCurrentTimePropertyOverwriteSuccess()&&Object.defineProperty(e.$1,"currentTime",{get:r,set:o,configurable:!0,enumerable:!0}),e.getSeekingPropertyOverwriteSuccess()&&Object.defineProperty(e.$1,"seeking",{get:a,configurable:!0,enumerable:!0})})}},t.getCurrentTimePropertyOverwriteSuccess=function(){return this.$5&&this.$6},t.getSeekingPropertyOverwriteSuccess=function(){return this.$7},t.$17=function(t){this.$10=t},t.onError=function(t){return this.$3.onError(t)},t.destroy=function(){try{this.$10&&this.$10()}catch(e){}},e})();l.default=e}),98);
__d("oz-player/playback_controls/OzSteadyStateManager",["oz-player/shims/ozvariant"],(function(t,n,r,o,a,i,l){"use strict";function e(e){throw new TypeError('"'+e+'" is read-only')}var s=(function(){function e(e,t){this.$1=[],this.$2=e,this.$3=t}var t=e.prototype;return t.addSample=function(t){var e,n,r=Math.floor(Date.now()/(1e3*this.$3)),o=r%this.$2;((e=this.$1[o])==null?void 0:e.bucketNumber)!=r&&(this.$1[o]={bucketNumber:0,val:null}),this.$1[o]={bucketNumber:r,val:Math.min(t,(n=this.$1[o].val)!=null?n:t)}},t.min=function(){var e=this,t,n=Date.now(),o=this.$1.filter(function(t){return t!=null&&t.val!=null&&n-e.$2*1e3*e.$3<t.bucketNumber*1e3*e.$3});if(o.length<this.$2)return null;var a=o.reduce(function(e,t){if(e==null)return t;var n=t.val;n!=null||r("oz-player/shims/ozvariant")(0,56011);var o=e.val;return o!=null||r("oz-player/shims/ozvariant")(0,56011),n<o?t:e},null);return(t=a)==null?void 0:t.val},t.reset=function(){this.$1=[]},e})();l.default=s}),98);
__d("oz-player/playback_controls/OzLiveLatencyManager",["oz-player/playback_controls/OzSteadyStateManager","oz-player/shims/OzDOMEventListener","oz-player/shims/OzSubscriptionsHandler","oz-player/shims/ozThrottle","oz-player/utils/OzSourceBufferUtil"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){var t=this;this.$8=new(r("oz-player/shims/OzSubscriptionsHandler")),this.$9=null,this.$10=!1,this.$11=null,this.$12=null,this.$13=null,this.$14=!0;var n=e.bufferingDetector,o=e.config,a=e.getUserSelectedPlaybackRate,i=e.loggerProvider,l=e.mpd,s=e.playbackState,u=e.video;if(this.$1=o,this.$2=l,this.$3=s,this.$15=a,o.getNumber("steadystate_minbuffer_buckets")>0&&(this.$7=new(r("oz-player/playback_controls/OzSteadyStateManager"))(this.$1.getNumber("steadystate_minbuffer_buckets"),this.$1.getNumber("steadystate_minbuffer_buckets_sec"))),n!=null&&(this.$8.addSubscriptions(n.addListener("enterBuffering",function(e){var n;if(e==="in_play"){var r;t.$9=0,(r=t.$7)==null||r.reset()}t.$10=!1,(n=t.$6)==null||n.log(),t.$6=null})),this.$8.addSubscriptions(n.addListener("leaveBuffering",function(){t.$9===0&&(t.$9=Date.now()),t.$10=!1}))),this.$4=u,this.$5=i,this.$16()){var c;this.$8.addSubscriptions((c=r("oz-player/shims/OzDOMEventListener")).listenDOMEvent(this.$4,"timeupdate",r("oz-player/shims/ozThrottle")(function(){t.$17(),t.$18()},this.$1.getNumber("playhead_manager_timeupdate_throttle_ms"))),c.listenDOMEvent(this.$4,"waiting",function(){t.$17()}),c.listenDOMEvent(this.$4,"durationchange",function(){t.$17()}),c.listenDOMEvent(this.$4,"seeking",function(){var e;t.$13=Date.now(),t.$11=null,(e=t.$7)==null||e.reset()}),c.listenDOMEvent(this.$4,"playing",function(){t.$13=Date.now(),t.$11=null}),c.listenDOMEvent(u,"pause",function(){var e;return(e=t.$7)==null?void 0:e.reset()}))}}var t=e.prototype;return t.enabled=function(){var e=this.$1.getNumber("catchup_timeout_after_buffering_sec");return e===0||this.$9==null||this.$9!==0&&this.$9+e*1e3<=Date.now()},t.isBehindPreferredLiveHeadLatencyWithTolerance=function(){return this.$3.getCurrentTime()<this.getInitialPlayHeadPosition()-this.getPreferredLiveHeadLatencyToleranceSec()},t.$19=function(){return this.$3.getCurrentTime()<this.getInitialPlayHeadPosition()},t.$20=function(){var e,t=(e=this.$7)==null?void 0:e.min();return!this.$21()&&t!=null&&t>this.$1.getNumber("steadystate_minbuffer_sec")},t.getInitialPlayHeadPosition=function(){return this.getLiveHeadTimeSec()-this.getPreferredLiveHeadLatencySec()},t.getLiveHeadTimeSec=function(){var e,t=this.$22();return(t==null||(e=t.getEndingSegment())==null?void 0:e.getTimeRange().endTime)||0},t.$21=function(){return this.$9!=null&&this.$1.getBool("latencymanager_stalled_edgelatency_sec_on")},t.getPreferredLiveHeadLatencySec=function(){var e=this.$21()?this.$1.getNumber("latencymanager_stalled_edgelatency_sec"):this.$1.getNumber("pdash_download_cursor_catchup_threshold_sec"),t=this.$23(e);return this.$5.getOperationLogger("latency_manager").setPreferredEdgeLatency(t*1e3),t},t.getPreferredLiveHeadLatencyToleranceSec=function(){return this.$1.getNumber("pdash_download_cursor_catchup_tolerance_sec")},t.shouldEnableManifestTimeRangeCatchup=function(){return!this.$1.getNumber("pdash_download_cursor_catchup_threshold_sec")},t.shouldEnableCursorBasedCatchup=function(){var e=this.$2.getVideoRepresentations()[0],t=e&&e.canPredict();return t&&this.$1.getNumber("pdash_download_cursor_catchup_threshold_sec")>0},t.setEnableCatchup=function(t){var e=this.$14;!this.$14&&t===!0&&(this.$9=null),this.$14=t,this.$1.getBool("fix_live_rewind_user_selected_playback_speed")&&t!==e&&this.$18()},t.$24=function(t,n,r){var e=this.$1.getNumber("playback_speed_min_sharpness_factor"),o=t*2/(1+Math.pow(Math.E,-(r-n)*e));return 1-t+o},t.$16=function(){return!this.$1.getBool("playback_speed_latency_adjustment_disabled")&&(this.$1.getNumber("playback_speed_latency_adjustment_rate")>0||this.$1.getNumber("playback_speed_latency_slowdown_adjustment_rate")>0||this.$1.getNumber("playback_speed_latency_speedup_adjustment_rate")>0)},t.$17=function(){var e,t=o("oz-player/utils/OzSourceBufferUtil").getBufferAheadInBufferedRanges(o("oz-player/utils/OzSourceBufferUtil").convertToBufferedTimeRangeArray(this.$4.buffered),this.$3.getCurrentTime(),this.$1).bufferAheadSec;(e=this.$7)==null||e.addSample(t)},t.$18=function(){var e=o("oz-player/utils/OzSourceBufferUtil").getBufferAheadInBufferedRanges(o("oz-player/utils/OzSourceBufferUtil").convertToBufferedTimeRangeArray(this.$4.buffered),this.$3.getCurrentTime(),this.$1),t=e.bufferAheadSec,n=e.bufferedOffset;this.$25(t,n)},t.$25=function(t,n){var e=this.$1.getNumber("playback_speed_enabled_delay_sec"),r=this.$1.getNumber("playback_speed_min_buffer_sec");t>r&&(this.$10=!0);var o=this.$1.getNumber("playback_speed_min_duration_sec"),a=this.$1.getNumber("playback_speed_restore_min_duration_sec"),i=this.$1.getNumber("playback_speed_latency_adjustment_rate"),l=this.$1.getNumber("playback_speed_latency_slowdown_adjustment_rate"),s=this.$1.getNumber("playback_speed_latency_speedup_adjustment_rate");if(this.$4.playbackRate===0){var u;(u=this.$6)==null||u.log(),this.$6=null}else if(this.$14&&this.$10&&t<r&&(i>0||l>0)&&n===0&&(e===0||this.$13!=null&&this.$13+e*1e3<Date.now())){var c=l>0?1-l:this.$24(i,r,t);this.$6==null&&(this.$6=this.$5.getOperationLogger("latency_manager").start().setInitiator("speed_adjustment").setReason("slow").setUserInfo({newPlaybackRate:String(c),oldPlaybackRate:String(this.$4.playbackRate)})),this.$26(c)}else if(this.$14&&this.$10&&(this.$19()||this.$20())&&s>0&&n===0&&(this.$12==null||this.$12+a*1e3<Date.now())&&(e===0||this.$13!=null&&this.$13+e*1e3<Date.now())){var d=1+s;this.$6==null&&(this.$6=this.$5.getOperationLogger("latency_manager").start().setInitiator("speed_adjustment").setReason("fast").setUserInfo({newPlaybackRate:String(d),oldPlaybackRate:String(this.$4.playbackRate)})),this.$26(d)}else if(this.$14===!1||this.$11==null||this.$11+o*1e3<Date.now()){var m,p=this.$4.playbackRate;this.$1.getBool("fix_live_rewind_user_selected_playback_speed")?this.$4.playbackRate=this.$14===!1?this.$15():1:this.$4.playbackRate=1,(m=this.$6)==null||m.log(),this.$6=null,p!==this.$4.playbackRate&&(this.$12=Date.now())}},t.$26=function(t){try{this.$4.playbackRate=t,this.$11=Date.now()}catch(t){var e;(e=this.$6)==null||e.setError(t).setResult("failed").log(),this.$6=null}},t.$22=function(){var e=this.$2.getVideoRepresentations().concat(this.$2.getAudioRepresentations());return e.length===0?null:e.reduce(function(e,t){var n,r;return(((n=e.getEndingSegment())==null?void 0:n.getTimeRange().endTime)||0)>(((r=t.getEndingSegment())==null?void 0:r.getTimeRange().endTime)||0)?e:t})},t.$23=function(t){var e,n;if(t<=0)return t;var r=this.$22(),o=r==null||(e=r.getEndingSegment())==null?void 0:e.getTimeRange();if(!o)return t;var a=r==null||(n=r.getSegmentByTime((o==null?void 0:o.endTime)-t))==null?void 0:n.getTimeRange();return a?(o==null?void 0:o.endTime)-(a==null?void 0:a.startTime):t},t.destroy=function(){this.$8.release()},e})();l.default=e}),98);
__d("oz-player/playback_controls/OzPlaybackTimeRangeManager",["oz-player/shims/OzSubscriptionsHandler","oz-player/utils/OzBufferingUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){var t=this;this.$4=null,this.$5=0,this.$6=0,this.$7=!0,this.$8=0,this.$9=0,this.$10=!1,this.$12=0,this.$13=0,this.$15=new(r("oz-player/shims/OzSubscriptionsHandler")),this.$17=function(){t.$10!=t.$14.isPlaying()&&(t.$14.isPlaying()&&(t.$11=Date.now()),t.$10=t.$14.isPlaying())};var n=e.config,o=e.liveheadFallBehindBlockMargin,a=e.liveheadFallBehindBlockThreshold,i=e.mpd,l=e.perfLoggerProvider,s=e.playbackState,u=e.video;this.$1=n,this.$2=u,this.$3=i,this.$8=a,this.$9=o,this.$14=s,this.$16=l,this.$1.getNumber("catchup_timeout_after_play_sec")!==0&&this.$15.addSubscriptions(this.$14.addEventListener("play",this.$17),this.$14.addEventListener("pause",this.$17))}var t=e.prototype;return t.setTimelineBlockingEnabled=function(t){this.$7=t,this.$7||this.$3.unblockTimeRange()},t.setTimeRangeProvider=function(t){var e=this;this.$4!=null&&this.$4.remove(),this.$4=t.addUpdateListener(function(){var n=t.getTimeRanges(),r=0;if(n.length!==0){var o=n[n.length-1];r=o.endTime}e.$18(r)})},t.$18=function(t){var e;if(this.$7&&this.$5!==t&&(this.$5=t,!(this.$2.currentTime<=this.$6))){var n=this.$1.getBool("catchup_use_timeline_range_end_time_as_end")?t:this.$2.duration,r=this.$1.getNumber("overwrite_livehead_fall_behind_block_threshold")!==0?this.$1.getNumber("overwrite_livehead_fall_behind_block_threshold"):this.$8,a=this.$1.getNumber("overwrite_live_time_range_block_margin")!==0?this.$1.getNumber("overwrite_live_time_range_block_margin"):this.$9;this.$17(),this.$1.getBool("reset_catchup_timeout_after_play_sec_on_overwrite")&&(this.$13!=a||this.$12!=r)&&(this.$13=a,this.$12=r,this.$11=Date.now());var i=this.$1.getNumber("catchup_timeout_after_play_sec")===0||Date.now()-((e=this.$11)!=null?e:0)<this.$1.getNumber("catchup_timeout_after_play_sec")*1e3;if(i&&this.$1.getNumber("pdash_download_cursor_catchup_threshold_sec")===0&&a!==0&&r!==0&&n-this.$2.currentTime>r){for(var l=[],s=0;s<this.$2.buffered.length;s++)l.push({startTime:this.$2.buffered.start(s),endTime:this.$2.buffered.end(s)});var u=o("oz-player/utils/OzBufferingUtils").getBufferAheadFromCurrentTime(this.$2.currentTime,l);this.$6=this.$2.currentTime+Math.min(u,a);var c={startTime:this.$6,endTime:n-a};this.$16.getOperationLogger("latency_manager").setInitiator("time_range_manager").setReason("blocked_range").setLength(c.endTime-c.startTime).setUserInfo({blockedRangeStart:String(c.startTime),blockedRangeEnd:String(c.endTime)}).log(),this.$3.blockTimeRange(c)}}},t.destroy=function(){this.$4!=null&&(this.$4.remove(),this.$4=null),this.$15.release()},e})();l.default=e}),98);
__d("oz-player/strategies/LiveheadSeekaheadStrategy",[],(function(t,n,r,o,a,i){"use strict";var e=.05;function l(t,n){var r=Math.max.apply(Math,n.map(function(e){return e.startTime}));return r-t>0?r-t+e:0}i.computeSeekAhead=l}),66);
__d("oz-player/utils/OzTimelineGapUtil",["oz-player/utils/OzNumericalHelper","oz-player/utils/OzNumericalRangeUtil"],(function(t,n,r,o,a,i,l){"use strict";var e=1.5;function s(e,t,n,r){var a=t.map(function(e){return{rangeStart:e.startTime,rangeEnd:e.endTime}});return o("oz-player/utils/OzNumericalRangeUtil").findCurrentRangeIndex(n,e,a,r)===-1}function u(t,n,r,a,i){i===void 0&&(i=e);var l=n.map(function(e){return{rangeStart:e.startTime,rangeEnd:e.endTime}}),s=o("oz-player/utils/OzNumericalRangeUtil").findCurrentRangeIndex(r,t,l,a);if(s!==-1){var u=n[s];return o("oz-player/utils/OzNumericalHelper").lessThanOrEqual(t,u.endTime)&&u.endTime-t<i}return!1}l.isInGap=s,l.isNearGap=u}),98);
__d("oz-player/playback_controls/OzPlayheadManager",["oz-player/shims/OzDOMEventListener","oz-player/shims/OzEventEmitter","oz-player/shims/OzSubscriptionsHandler","oz-player/shims/ozThrottle","oz-player/shims/ozvariant","oz-player/strategies/LiveheadSeekaheadStrategy","oz-player/utils/OzNumericalRangeUtil","oz-player/utils/OzSourceBufferUtil","oz-player/utils/OzTimelineGapUtil"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$1=e.perfLoggerProvider,this.$2=e.video,this.$4=e.config}var t=e.prototype;return t.markState=function(t,n){var e=o("oz-player/utils/OzSourceBufferUtil").convertToBufferedTimeRangeArray(this.$2.buffered),r=this.$3;if(r==null){this.$3=e;return}var a=o("oz-player/utils/OzSourceBufferUtil").getBufferAheadInBufferedRanges(e,n.getCurrentTime(),this.$4),i=o("oz-player/utils/OzSourceBufferUtil").getBufferAheadInBufferedRanges(r,n.getCurrentTime(),this.$4);i.bufferedOffset!==-1&&a.bufferedOffset===-1&&this.$1.getOperationLogger("playhead_adjustment").setError("buffer_deleted").setResult("failed").setUserInfo({vidSeeking:String(this.$2.seeking),vidErrCode:this.$2.error?String(this.$2.error.code):null}).setInitiator(t).log(),this.$3=e},e})(),s=(function(){function e(e){this.$5=!1,this.$6={},this.$1=e.perfLoggerProvider,this.$2=e.video}var t=e.prototype;return t.markState=function(t,n){var e=this;if(this.$2.paused){this.$3=null,this.$4=null,this.$5=!1,this.$6={};return}(this.$3==null||this.$2.currentTime>this.$3)&&(this.$4=Date.now(),this.$3=this.$2.currentTime,this.$5=!1,this.$6={}),this.$6[t]=this.$6[t]==null?1:this.$6[t]+1;var r=this.$4;if(!this.$5&&!this.$2.paused&&r!=null&&r+1e4<Date.now()){this.$5=!0;var o={};Object.keys(this.$6).forEach(function(t){o[t]=String(e.$6[t])}),this.$1.getOperationLogger("playhead_adjustment").setError("not_advancing").setResult("failed").setLength(Date.now()-r).setUserInfo(babelHelpers.extends({},o,n,{lastCurrentTime:String(this.$3),lastCurrentTimeChanged:String(r-Date.now()),vidSeeking:String(this.$2.seeking),vidErrCode:this.$2.error?String(this.$2.error.code):null})).setInitiator(t).log()}},e})(),u=(function(t){function n(n){var a;a=t.call(this)||this,a.$OzPlayheadManager$p_2=new(r("oz-player/shims/OzSubscriptionsHandler")),a.$OzPlayheadManager$p_3=new(r("oz-player/shims/OzSubscriptionsHandler")),a.$OzPlayheadManager$p_4=new Set,a.$OzPlayheadManager$p_10=new Set,a.$OzPlayheadManager$p_12=function(e){a.$OzPlayheadManager$p_1.currentTime=e},a.$OzPlayheadManager$p_14=!1,a.$OzPlayheadManager$p_15=!1,a.$OzPlayheadManager$p_16=!0,a.$OzPlayheadManager$p_17=!1,a.$OzPlayheadManager$p_23=function(e,t){if(t===void 0&&(t=null),!(a.$OzPlayheadManager$p_20!=null&&!a.$OzPlayheadManager$p_20.shouldEnableManifestTimeRangeCatchup())){var n=a.$OzPlayheadManager$p_9;if(n&&n.isEnabled(a.$OzPlayheadManager$p_1,a.$OzPlayheadManager$p_8)){var r=n.computeNewPlayheadPosition(a.$OzPlayheadManager$p_1,a.$OzPlayheadManager$p_8);if(typeof r=="number"){a.$OzPlayheadManager$p_27(r,"live_catch_up_strategy",e,t);return}}var i=a.$OzPlayheadManager$p_6.getNumber("auto_seek_playhead_slack");if(i!==0){var l=a.$OzPlayheadManager$p_5;if(l){var s=a.$OzPlayheadManager$p_7.getCurrentTime(),u=l.getTimeRanges().map(function(e){return{rangeStart:e.startTime,rangeEnd:e.endTime}}),c=o("oz-player/utils/OzNumericalRangeUtil").findNextRangeIndex(s,u);if((o("oz-player/utils/OzTimelineGapUtil").isNearGap(s,l.getTimeRanges(),a.$OzPlayheadManager$p_6)||o("oz-player/utils/OzTimelineGapUtil").isInGap(s,l.getTimeRanges(),a.$OzPlayheadManager$p_6))&&c!==-1){var d=u[c];a.$OzPlayheadManager$p_27(d.rangeStart+i,"jump_over_timeline_gap",e,t)}}}}};var i=n.canSupportSkipVideobufferGaps,l=n.config,u=n.dynamicVideoLibrary,c=n.initialPlaybackPosition,d=n.liveLatencyManager,m=n.mpd,p=n.perfLoggerProvider,_=n.playbackState,f=n.playheadCatchup,g=n.seekHandler,h=n.video;return a.$OzPlayheadManager$p_1=h,a.$OzPlayheadManager$p_6=l,a.$OzPlayheadManager$p_7=_,a.$OzPlayheadManager$p_8=m,a.$OzPlayheadManager$p_9=f,a.$OzPlayheadManager$p_11=p,g&&(a.$OzPlayheadManager$p_12=g),a.$OzPlayheadManager$p_17=i,a.$OzPlayheadManager$p_20=d,a.$OzPlayheadManager$p_13=c,a.$OzPlayheadManager$p_21=u,a.$OzPlayheadManager$p_18=new s({video:h,perfLoggerProvider:p}),a.$OzPlayheadManager$p_19=new e({video:h,perfLoggerProvider:p,config:l}),a.$OzPlayheadManager$p_2.addSubscriptions(r("oz-player/shims/OzDOMEventListener").listenDOMEvent(a.$OzPlayheadManager$p_1,"durationchange",function(){a.setPlaybackPositionOnFirstDurationChange("durationchange",a.$OzPlayheadManager$p_1.duration),a.$OzPlayheadManager$p_23("durationchange"),a.$OzPlayheadManager$p_24("durationchange")}),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(a.$OzPlayheadManager$p_1,"pause",function(){a.$OzPlayheadManager$p_23("pause")}),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(a.$OzPlayheadManager$p_1,"play",function(){a.$OzPlayheadManager$p_23("play")}),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(a.$OzPlayheadManager$p_1,"playing",function(){a.$OzPlayheadManager$p_23("playing")}),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(a.$OzPlayheadManager$p_1,"waiting",function(){a.$OzPlayheadManager$p_24("waiting")}),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(a.$OzPlayheadManager$p_1,"timeupdate",r("oz-player/shims/ozThrottle")(function(){a.$OzPlayheadManager$p_23("timeupdate"),a.$OzPlayheadManager$p_6.getBool("playhead_manager_buffered_timerange_update_on_timeupdate")&&a.$OzPlayheadManager$p_24("timeupdate")},a.$OzPlayheadManager$p_6.getNumber("playhead_manager_timeupdate_throttle_ms"))),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(a.$OzPlayheadManager$p_1,"seeking",function(){a.$OzPlayheadManager$p_22=Date.now()})),a}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.$OzPlayheadManager$p_25=function(){return this.$OzPlayheadManager$p_1.playbackRate===0},a.observeSourceBufferState=function(t,n){var e=this;!this.$OzPlayheadManager$p_4.has(t)||r("oz-player/shims/ozvariant")(0,4179),this.$OzPlayheadManager$p_4.add(t),this.$OzPlayheadManager$p_2.addSubscriptions(t.addEventListener("buffer_updated",function(){e.$OzPlayheadManager$p_26(t,n),e.$OzPlayheadManager$p_6.getBool("skip_videobuffer_gaps_on_buffer_updated")&&e.$OzPlayheadManager$p_17&&e.$OzPlayheadManager$p_24("buffer_updated")}))},a.$OzPlayheadManager$p_26=function(t,n){var e=[];this.$OzPlayheadManager$p_4.forEach(function(t){var n=t.getBufferedRanges();n.length&&e.push(n[0])}),e.length>0&&this.$OzPlayheadManager$p_10.add(t);var r=this.$OzPlayheadManager$p_1.currentTime,a=o("oz-player/strategies/LiveheadSeekaheadStrategy").computeSeekAhead(r,e),i=this.$OzPlayheadManager$p_6.getNumber("timeline_offset_threshold");a>0&&(i===0||a<i)&&this.$OzPlayheadManager$p_27(this.$OzPlayheadManager$p_1.currentTime+a,"first_available_buffer","source_buffer",n)},a.setTimeRangeProvider=function(t){var e=this;this.$OzPlayheadManager$p_3.release(),this.$OzPlayheadManager$p_3.engage(),this.$OzPlayheadManager$p_3.addSubscriptions(t.addUpdateListener(function(){e.$OzPlayheadManager$p_23("time_range_updated")})),this.$OzPlayheadManager$p_5=t,this.$OzPlayheadManager$p_23("time_range_set")},a.resetCurrentTime=function(){this.$OzPlayheadManager$p_15=!1,this.setPlaybackPositionOnFirstDurationChange("reset",this.$OzPlayheadManager$p_1.duration)},a.setPlaybackPositionOnFirstDurationChange=function(t,n){if(this.$OzPlayheadManager$p_13!==0&&!this.$OzPlayheadManager$p_15&&!isNaN(n)&&n!==1/0){var e=this.$OzPlayheadManager$p_13>0?this.$OzPlayheadManager$p_13:n+this.$OzPlayheadManager$p_13;if(this.$OzPlayheadManager$p_20!=null){var r;e=(r=this.$OzPlayheadManager$p_20)==null?void 0:r.getInitialPlayHeadPosition()}if(this.$OzPlayheadManager$p_15=!0,this.$OzPlayheadManager$p_6.getBool("playhead_manager_clamp_initial_playback_position")){var o,a=(o=this.$OzPlayheadManager$p_5)==null?void 0:o.getTimeRanges();a!=null&&a.length>0&&a[0].startTime>e&&(e=a[0].startTime)}this.$OzPlayheadManager$p_27(e,"initial_playback_position",t),this.emit("initialPlaybackPositionSet",e)}},a.$OzPlayheadManager$p_24=function(t){var e,n,r=this;if(this.$OzPlayheadManager$p_6.getBool("skip_videobuffer_gaps")&&this.$OzPlayheadManager$p_17){var a=this.$OzPlayheadManager$p_6.getNumber("playhead_manager_buffered_auto_seek_playhead_slack");if(a!==0){for(var i=this.$OzPlayheadManager$p_7.getCurrentTime(),l=[],s=0;s<this.$OzPlayheadManager$p_1.buffered.length;s++)l.push({startTime:this.$OzPlayheadManager$p_1.buffered.start(s),endTime:this.$OzPlayheadManager$p_1.buffered.end(s)});var u=l.map(function(e){return{rangeStart:e.startTime,rangeEnd:e.endTime}});this.$OzPlayheadManager$p_19&&this.$OzPlayheadManager$p_19.markState(t,this.$OzPlayheadManager$p_7);var c=o("oz-player/utils/OzNumericalRangeUtil").findNextRangeIndex(i,u),d=o("oz-player/utils/OzNumericalRangeUtil").findCurrentRangeIndex(this.$OzPlayheadManager$p_6,i,u),m=this.$OzPlayheadManager$p_16?0:this.$OzPlayheadManager$p_6.getNumber("skip_videobuffer_gaps_max_gap_size_sec"),p=this.$OzPlayheadManager$p_6.getNumber("playhead_manager_buffered_is_near_gap_threshold"),_=this.$OzPlayheadManager$p_6.getNumber("playhead_manager_buffered_numerical_error"),f=(e=this.$OzPlayheadManager$p_21)==null?void 0:e.getLastSegmentStartPTS(),g=f!=null?f/1e3:null,h=(n=this.$OzPlayheadManager$p_21)==null?void 0:n.getLast200RequestedUrlDecisionMinTime(),y=g!=null?o("oz-player/utils/OzNumericalRangeUtil").findCurrentRangeIndex(this.$OzPlayheadManager$p_6,g,u):-1,C=y>=0?u[y]:null,b=function(n){var e=r.$OzPlayheadManager$p_22==null||h==null||r.$OzPlayheadManager$p_22<h;return!e&&n!=null&&r.$OzPlayheadManager$p_11.getOperationLogger("playhead_adjustment").setError("ignore_before_seek_main_"+n).setResult("failed").setInitiator(t).setUserInfo({last200RequestedUrlDecisionMinTime:String(h),lastSeekTime:String(r.$OzPlayheadManager$p_22)}).log(),e};if(g!=null&&this.$OzPlayheadManager$p_25()&&this.$OzPlayheadManager$p_16==!1&&b("buf")){if(g<i&&C!=null&&C.rangeStart<=g&&C.rangeEnd!=null&&C.rangeEnd>g){this.$OzPlayheadManager$p_27(g,"reverse_jump_over_buffer_gap",t,null,{lastSegmentStartPTS:String(f),last200RequestedUrlDecisionMinTime:String(h),lastSeekTime:String(this.$OzPlayheadManager$p_22)});return}if(C!=null&&y!=d){this.$OzPlayheadManager$p_27(C.rangeStart,"jump_over_buffer_gap_last_dl_range",t,null,{lastSegmentStartPTS:String(f),last200RequestedUrlDecisionMinTime:String(h),lastSeekTime:String(this.$OzPlayheadManager$p_22)});return}}if((o("oz-player/utils/OzTimelineGapUtil").isNearGap(i,l,this.$OzPlayheadManager$p_6,_,p)||o("oz-player/utils/OzTimelineGapUtil").isInGap(i,l,this.$OzPlayheadManager$p_6,_))&&c!==-1&&(m===0||u[c].rangeStart-i<m)&&(this.$OzPlayheadManager$p_16==!0||b("main"))){var v=u[c];this.$OzPlayheadManager$p_6.getBool("enable_alternative_audio_tracks")&&this.$OzPlayheadManager$p_8.isStaticMpd()&&v.rangeStart!==0&&v.rangeEnd===this.$OzPlayheadManager$p_7.getDuration()?this.$OzPlayheadManager$p_27(0,"do_not_jump_over_buffer_gap",t,null,{lastSegmentStartPTS:String(f),last200RequestedUrlDecisionMinTime:String(h),lastSeekTime:String(this.$OzPlayheadManager$p_22)}):this.$OzPlayheadManager$p_27(v.rangeStart+a,"jump_over_buffer_gap",t,null,{lastSegmentStartPTS:String(f),last200RequestedUrlDecisionMinTime:String(h),lastSeekTime:String(this.$OzPlayheadManager$p_22)});return}this.$OzPlayheadManager$p_18&&this.$OzPlayheadManager$p_18.markState(t,{nextBufferedRangeIndex:String(c),limitMaxGapSize:String(m),rangeStart:c!==-1?String(u[c].rangeStart):null,isNearGapThreshold:String(p),numericalError:String(_)})}}},a.setEnableLiveheadCatchup=function(t){this.$OzPlayheadManager$p_16=t},a.destroy=function(){this.$OzPlayheadManager$p_2.release(),this.$OzPlayheadManager$p_3.release(),this.$OzPlayheadManager$p_4.clear()},a.$OzPlayheadManager$p_27=function(t,n,r,o,a){var e=t-this.$OzPlayheadManager$p_1.currentTime,i=this.$OzPlayheadManager$p_6.getNumber("seek_ahead_epsilon");i>0&&Math.abs(e)<=i||(this.$OzPlayheadManager$p_11.getOperationLogger("playhead_adjustment").setLength(Math.round(t*1e3)).setReason(n).setInitiator(r).setType(o).setUserInfo(babelHelpers.extends({},a,{seekAdjustment:String(Math.round(e*1e3))})).log(),this.$OzPlayheadManager$p_12(t),n==="initial_playback_position"&&(this.$OzPlayheadManager$p_14=!0))},n})(r("oz-player/shims/OzEventEmitter"));l.default=u}),98);
__d("oz-player/shims/www/OzUuidWWW",["uuidv4"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("uuidv4")}),98);
__d("oz-player/shims/OzUuid",["oz-player/shims/www/OzUuidWWW"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/shims/www/OzUuidWWW")}),98);
__d("oz-player/states/OzObservedPlaybackState",["oz-player/loggings/OzMultiDestinationPerfLogger","oz-player/shims/OzDOMEventListener","oz-player/shims/OzSubscriptionsHandler"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n){var a=this;n===void 0&&(n=new(o("oz-player/loggings/OzMultiDestinationPerfLogger")).OzMultiDestinationPerfLoggerProvider([])),this.$2=new(r("oz-player/shims/OzSubscriptionsHandler")),this.$4=function(){a.$3.getOperationLogger("pause").setState("paused").log()},this.$5=function(){a.$3.getOperationLogger("playing").setState("playing").log()},this.$1=t,this.$3=n,this.$2.addSubscriptions(r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$1,"pause",this.$4),r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$1,"playing",this.$5))}var t=e.prototype;return t.isPlaying=function(){return!this.$1.paused},t.getCurrentTime=function(){return this.$1.currentTime},t.getCurrentTimeUpdateTime=function(){return Date.now()},t.getDuration=function(){return this.$1.duration},t.addEventListener=function(t,n){return r("oz-player/shims/OzDOMEventListener").listenDOMEvent(this.$1,t,n)},t.destroy=function(){this.$2.release()},e})();l.default=e}),98);
__d("oz-player/utils/OzPositionToViewportUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n){var r=t.filter(function(e){var t=e.position;if(t==null)return!1;var r=t.y-window.scrollY;return r>=0||(t.height+r)/t.height>n}).sort(function(e,t){return e.position==null||t.position==null?0:e.position.y-t.position.y});return r.findIndex(function(t){return t.video===e})}function l(e){return e.isIntersecting!=null?e.isIntersecting:e.intersectionRatio>0||e.intersectionRect&&(e.intersectionRect.height>0||e.intersectionRect.width>0)}i.determinePositionIndexOfVideoFromViewportVertically=e,i.intersectionObserverEntryIsIntersecting=l}),66);
__d("oz-player/states/OzPositionToViewportTracker",["oz-player/shims/OzEventEmitter","oz-player/utils/OzPositionToViewportUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=null,s=.5,u=(function(t){function n(e){var n;return n=t.call(this)||this,n.$OzPositionToViewportTracker$p_1=[],n.$OzPositionToViewportTracker$p_5=function(e){e.forEach(function(e){var t=n.$OzPositionToViewportTracker$p_1.find(function(t){return e.target===t.video});t!=null&&(o("oz-player/utils/OzPositionToViewportUtils").intersectionObserverEntryIsIntersecting(e)?t.position=n.$OzPositionToViewportTracker$p_7(e):n.$OzPositionToViewportTracker$p_1.map(function(t){e.target===t.video&&(t.position=null)})),n.$OzPositionToViewportTracker$p_1.forEach(function(e){e.positionIndexToViewportVertically=n.$OzPositionToViewportTracker$p_6(e.video)})}),n.emit("state_changed")},n.$OzPositionToViewportTracker$p_2=e,n}babelHelpers.inheritsLoose(n,t);var r=n.prototype;return r.$OzPositionToViewportTracker$p_4=function(){this.$OzPositionToViewportTracker$p_3==null&&(this.$OzPositionToViewportTracker$p_3=new IntersectionObserver(this.$OzPositionToViewportTracker$p_5,{rootMargin:this.$OzPositionToViewportTracker$p_2.getNumber("pixels_above_viewport_to_observe")+"px 0px "+this.$OzPositionToViewportTracker$p_2.getNumber("pixels_below_viewport_to_observe")+"px 0px",threshold:0}))},r.registerVideo=function(t){this.$OzPositionToViewportTracker$p_1.push({video:t,position:null,positionIndexToViewportVertically:-1}),this.$OzPositionToViewportTracker$p_4(),this.$OzPositionToViewportTracker$p_3!=null&&this.$OzPositionToViewportTracker$p_3.observe(t)},r.getPositionIndexOfVideoFromViewportVertically=function(t){var e=this.$OzPositionToViewportTracker$p_1.find(function(e){return e.video===t});return e!=null?e.positionIndexToViewportVertically:-1},r.$OzPositionToViewportTracker$p_6=function(t){return o("oz-player/utils/OzPositionToViewportUtils").determinePositionIndexOfVideoFromViewportVertically(t,this.$OzPositionToViewportTracker$p_1,s)},r.$OzPositionToViewportTracker$p_7=function(t){var e=t.boundingClientRect;return{x:e.x+window.scrollX,y:e.y+window.scrollY,width:e.width,height:e.height}},n.getInstance=function(r){return e==null&&(e=new n(r)),e},r.unregisterVideo=function(t){var e=this,n=[];this.$OzPositionToViewportTracker$p_1.forEach(function(r){r.video===t&&e.$OzPositionToViewportTracker$p_3!=null?e.$OzPositionToViewportTracker$p_3.unobserve(t):n.push(r)}),this.$OzPositionToViewportTracker$p_1=n,this.$OzPositionToViewportTracker$p_1.length===0&&this.$OzPositionToViewportTracker$p_3!=null&&(this.$OzPositionToViewportTracker$p_3.disconnect(),this.$OzPositionToViewportTracker$p_3=null)},n})(r("oz-player/shims/OzEventEmitter"));l.default=u}),98);
__d("oz-player/states/OzPositionToViewport",["oz-player/shims/OzEventEmitter","oz-player/shims/OzSubscriptionsHandler","oz-player/states/OzPositionToViewportTracker"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n){var o;return o=e.call(this)||this,o.$OzPositionToViewport$p_1=new(r("oz-player/shims/OzSubscriptionsHandler")),o.$OzPositionToViewport$p_3=t,o.$OzPositionToViewport$p_2=r("oz-player/states/OzPositionToViewportTracker").getInstance(n),o.$OzPositionToViewport$p_2.registerVideo(t),o.$OzPositionToViewport$p_1.addSubscriptions(o.$OzPositionToViewport$p_2.addListener("state_changed",function(){o.emit("state_changed")})),o}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.getPositionIndexOfVideoFromViewportVertically=function(){return this.$OzPositionToViewport$p_3!=null?this.$OzPositionToViewport$p_2.getPositionIndexOfVideoFromViewportVertically(this.$OzPositionToViewport$p_3):-1},n.destroy=function(){this.$OzPositionToViewport$p_3!=null&&this.$OzPositionToViewport$p_2.unregisterVideo(this.$OzPositionToViewport$p_3),this.$OzPositionToViewport$p_3=null},t})(r("oz-player/shims/OzEventEmitter"));l.default=e}),98);
__d("oz-player/strategies/OzPlaybackConfidenceUtils",[],(function(t,n,r,o,a,i){"use strict";var e=.8;function l(t,n,r,o,a,i){var l=Math.min(1,r/o),s=1+(1-l)*a,u=t.getBandwidth()*s;return u>n?e*(n/u):1-(1-e)*u/n}i.getPlaybackConfidence=l}),66);
__d("oz-player/strategies/OzAbrManager",["oz-player/networks/OzBandwidthEstimator","oz-player/strategies/OzPlaybackConfidenceUtils","oz-player/utils/OzAbrUtils","oz-player/utils/OzBufferingUtils","oz-player/utils/OzPlaybackRestrictionsUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n,r,o,a,i,l,s){this.$2=0,this.$3=Date.now(),this.$4=!1,this.$10=null,this.$1=e,this.$5=t,this.$6=this.$15(t,n),this.$7=r,this.$8=o,this.$11=a,this.$12=i,this.$13=l,this.$14=s,this.$1.getBool("enable_abr_logging")&&this.$14.getOperationLogger("abr_initialized").setResult("success").setUserInfo({newRepresentationIds:n.map(function(e){return e.getID()}).join(","),newCodecs:n.map(function(e){return e.getCodecs()}).join("|"),newDisplayLabels:n.map(function(e){return e.getDisplayLabel()}).join(",")}).setRepresentationID(t.getID()).setType("video").setInitiator("OzAbrManager").log()}var t=e.prototype;return t.setSourceBuffer=function(t){this.$9=t},t.$15=function(t,n){var e=this.$1.getNumber("abr_restrict_from_index"),r=this.$1.getNumber("abr_restrict_to_index");if(r===0&&e===0)return n;var o=n.findIndex(function(e){return t.getID()===e.getID()});return o===-1?n:n.filter(function(t,n){return n-o>=e&&n-o<=r})},t.$16=function(t){var e=o("oz-player/utils/OzAbrUtils").excludeLargeRepresentations(t,this.$12(),this.$11,{resolutionConstraintFactor:this.$1.getNumber("resolution_constraint_factor")});return e=o("oz-player/utils/OzPlaybackRestrictionsUtils").applyVideoPlaybackRestrictions(this.$7,this.$12(),e),e},t.getBestRepresentation=function(t){var e,n,a,i=(e=t==null?void 0:t.length)!=null?e:null,l=(n=(a=this.$9)==null?void 0:a.getSourceBufferState().getBufferedRanges())!=null?n:null,s=this.$8.getCurrentTime(),u=o("oz-player/utils/OzBufferingUtils").getBufferAheadFromCurrentTime(s,l),c=o("oz-player/utils/OzAbrUtils").getReasonToPreventEvaluation(this.$1,this.$4,u,r("oz-player/networks/OzBandwidthEstimator").getSampleCount(),this.$2,this.$3);if(c!=null)return this.$10=c,this.$1.getBool("enable_abr_logging")&&this.$14.getOperationLogger("abr_best_representation_selected").setResult("failed").setReason(this.$10).setType("video").setInitiator("OzAbrManager").log(),this.$5;var d=Date.now();this.$2=d;var m=r("oz-player/networks/OzBandwidthEstimator").getAdjustedBandwidth(this.$1.getLegacyConfig()),p=this.$16(this.$6),_=this.$17(p,m,u,i),f=p[0];if(_=_||f,this.$18(u,_))return this.$10="high_buffer",this.$1.getBool("enable_abr_logging")&&this.$14.getOperationLogger("abr_best_representation_selected").setResult("failed").setUserInfo({filteredRepresentationIds:p.map(function(e){return e.getID()}).join(",")}).setPreviousRepresentationID(this.$5.getID()).setReason(this.$10).setType("video").setInitiator("OzAbrManager").log(),this.$5;var g=this.$5;return g!==_&&(this.$4=!0,this.$3=d,this.$5=_),this.$10="bandwidth",this.$1.getBool("enable_abr_logging")&&this.$14.getOperationLogger("abr_best_representation_selected").setResult("success").setUserInfo({filteredRepresentationIds:p.map(function(e){return e.getID()}).join(",")}).setRepresentationID(_.getID()).setPreviousRepresentationID(g==null?void 0:g.getID()).setReason(this.$10).setType("video").setInitiator("OzAbrManager").log(),_},t.$17=function(t,n,r,a){a===void 0&&(a=null);for(var e=null,i=0;i<t.length;i++){var l=o("oz-player/strategies/OzPlaybackConfidenceUtils").getPlaybackConfidence(t[i],n,r,this.$1.getNumber("low_buffer_bandwidth_target_threshold"),this.$1.getNumber("low_buffer_bandwidth_target_increase_factor"),a);l>this.$1.getNumber("abr_confidence_threshold")&&(!e||e.getBandwidth()<t[i].getBandwidth())&&(e=t[i])}return e},t.$18=function(t,n){var e=this.$1.getNumber("abr_prevent_down_switch_buffer_threshold");return e>0&&t>=e&&this.$5.getBandwidth()>n.getBandwidth()},t.getLastEvaluationReason=function(){return this.$10},t.updateRepresentations=function(t){var e=this,n=this.$6;this.$6=t;var r=this.$6.find(function(t){return t.getDisplayLabel()===e.$5.getDisplayLabel()}),o=this.$5;this.$5=r!=null?r:this.$6[0],this.$1.getBool("enable_abr_logging")&&this.$14.getOperationLogger("abr_representations_updated").setResult("success").setUserInfo({previousRepresentationIds:n.map(function(e){return e.getID()}).join(","),newRepresentationIds:t.map(function(e){return e.getID()}).join(","),newCodecs:t.map(function(e){return e.getCodecs()}).join("|"),newDisplayLabels:t.map(function(e){return e.getDisplayLabel()}).join(",")}).setRepresentationID(this.$5.getID()).setPreviousRepresentationID(o==null?void 0:o.getID()).setReason(this.$10).setType("video").setInitiator("OzAbrManager").log()},e})();l.default=e}),98);
__d("oz-player/strategies/getSegmentsCount",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n,r){for(var o=0,a=e.getTimeRange().startTime,i=e,l=i.getTimeRange().startTime;i!==null&&l<n+a;){var s=l;if(o++,i=t.getSegmentAfter(i),i)l=i.getTimeRange().startTime;else break;if(l<=s)return r}return Math.max(o,1)}i.default=e}),66);
__d("oz-player/strategies/OzStaticStreamSegmentsStrategy",["oz-player/strategies/getSegmentsCount"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$1=e}var t=e.prototype;return t.isActive=function(){return!0},t.getSegmentsCount=function(t,n,o){var e=this.$1.getNumber("seconds_to_stream"),a=this.$1.getNumber("segments_to_stream");return e>0&&(a=r("oz-player/strategies/getSegmentsCount")(n,o,e,a)),a},e})();l.default=e}),98);
__d("oz-player/strategies/OzBandwidthBoundaryStreamSegmentsCountStrategy",["oz-player/networks/OzBandwidthEstimator","oz-player/strategies/OzStaticStreamSegmentsStrategy","oz-player/strategies/getSegmentsCount"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){this.$1=e,this.$2=t,this.$3=new(r("oz-player/strategies/OzStaticStreamSegmentsStrategy"))(e)}var t=e.prototype;return t.isActive=function(t){return!0},t.getSegmentsCount=function(t,n,o){var e=r("oz-player/networks/OzBandwidthEstimator").getBandwidth(this.$1.getLegacyConfig()),a=r("oz-player/networks/OzBandwidthEstimator").getStandardDeviationOfBandwidth(),i=this.$1.getNumber("bandwidth_boundary_standard_deviation_factor"),l=this.$2.some(function(t){var n=t.getBandwidth();return Math.abs(n-e)<a*i}),s=l?this.$4(t,n,o):this.$3.getSegmentsCount(t,n,o),u=this.$5(n,e);return Math.min(s,u)},t.$4=function(t,n,o){var e=this.$1.getNumber("seconds_to_stream_near_bandwidth_boundary"),a=this.$1.getNumber("segments_to_stream_near_bandwidth_boundary");return e>0&&(a=r("oz-player/strategies/getSegmentsCount")(n,o,e,a)),a},t.$5=function(t,n){var e=1/0,r=t.getByteRange();if(r){var o=r.endByte;if(o!=null){var a=this.$1.getNumber("per_stream_duration_target"),i=o-r.startByte;a>1e-5&&i!==0&&(e=Math.ceil(a*n/(i*8)))}}return e},e})();l.default=e}),98);
__d("oz-player/strategies/OzBlockedRepresentationsManager",["oz-player/shims/OzEventEmitter","oz-player/shims/ozClearTimeout","oz-player/shims/ozSetTimeoutAcrossTransitions","oz-player/utils/OzErrorUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){this.$2=new Map,this.$3=new Set,this.$4=new Set,this.$5=new(r("oz-player/shims/OzEventEmitter")),this.$6=t===!0,this.$7(e),this.$8(e)}var t=e.prototype;return t.isBlocked=function(t){return this.$3.has(t)},t.handleError=function(t,n){if(this.$1!=null&&this.$3.size===this.$1-1)return!1;if(o("oz-player/utils/OzErrorUtils").isOzError(n)&&n.getType()==="OZ_NETWORK"){var e=Number(n.getExtra().code);if(!isNaN(e)&&this.$2.has(e))return this.$3.has(t)||this.$9(t,e),!0}return!1},t.$9=function(t,n){var e,o=this;this.$3.add(t),(e=this.$5)==null||e.emit("representation_blocked",t);var a=this.$2.get(n)||0;if(a>0){var i=r("oz-player/shims/ozSetTimeoutAcrossTransitions")(function(){o.$3.delete(t),o.$4.delete(i)},a);this.$4.add(i)}},t.applyRestriction=function(t){var e=this;return t.filter(function(t){return!e.$3.has(t.getID())})},t.onRepresentationBlocked=function(t){return this.$5?this.$5.addListener("representation_blocked",t):{remove:function(){}}},t.setAvailableRepresentationsCount=function(t){this.$1=t},t.destroy=function(){var e;(e=this.$5)==null||e.removeAllListeners(),this.$5=null;for(var t of this.$4)r("oz-player/shims/ozClearTimeout")(t);this.$4.clear()},t.$7=function(t){var e=this;try{var n=JSON.parse(t.getString("block_representation_status_codes_json"));if(Array.isArray(n)&&(n.forEach(function(t){var n=parseInt(t,10);isNaN(n)||e.$2.set(n,-1)}),this.$6))for(var r=500;r<=599;r++)this.$2.set(r,-1)}catch(e){}},t.$8=function(t){var e=this;try{var n=JSON.parse(t.getString("block_representation_status_codes_temporarily_json"));Object.entries(n).forEach(function(t){var n=t[0],r=t[1],o=parseInt(n,10),a=parseInt(r,10);!isNaN(o)&&!isNaN(a)&&e.$2.set(o,a)})}catch(e){}},e})();l.default=e}),98);
__d("oz-player/strategies/OzBufferAheadPriorityStrategy",["oz-player/shims/OzEventEmitter","oz-player/shims/OzSubscriptionsHandler","oz-player/shims/ozThrottle","oz-player/utils/OzBufferingUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=6,s=1e3,u=(function(t){function n(e,n){var o;return o=t.call(this)||this,o.$OzBufferAheadPriorityStrategy$p_3=new(r("oz-player/shims/OzSubscriptionsHandler")),o.$OzBufferAheadPriorityStrategy$p_5=function(){o.emit("state_changed")},o.$OzBufferAheadPriorityStrategy$p_4=e,o.$OzBufferAheadPriorityStrategy$p_1=n,o.$OzBufferAheadPriorityStrategy$p_3.addSubscriptions(o.$OzBufferAheadPriorityStrategy$p_1.addEventListener("progress",r("oz-player/shims/ozThrottle")(o.$OzBufferAheadPriorityStrategy$p_5,s)),o.$OzBufferAheadPriorityStrategy$p_1.addEventListener("timeupdate",r("oz-player/shims/ozThrottle")(o.$OzBufferAheadPriorityStrategy$p_5,s))),o}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.getName=function(){return"buffer_ahead"},a.setSourceBufferState=function(t){this.$OzBufferAheadPriorityStrategy$p_2||(this.$OzBufferAheadPriorityStrategy$p_2=t,this.$OzBufferAheadPriorityStrategy$p_3.addSubscriptions(t.addEventListener("buffer_updated",r("oz-player/shims/ozThrottle")(this.$OzBufferAheadPriorityStrategy$p_5,s))))},a.isActive=function(){return!0},a.getPriority=function(){var t=this.$OzBufferAheadPriorityStrategy$p_2;if(!t)return 1;var n=this.$OzBufferAheadPriorityStrategy$p_1.getCurrentTime(),r=t.getBufferedRanges(),a=o("oz-player/utils/OzBufferingUtils").getBufferAheadFromCurrentTime(n,r);return a>=e?0:1},a.destroy=function(){this.$OzBufferAheadPriorityStrategy$p_3.release()},n})(r("oz-player/shims/OzEventEmitter"));l.default=u}),98);
__d("oz-player/strategies/OzBufferAheadTargetStrategy",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){this.$1=e}var t=e.prototype;return t.isActive=function(){return!0},t.getBufferTarget=function(){return this.$1.getNumber("buffer_ahead_target")},e})();i.default=e}),66);
__d("oz-player/strategies/OzBufferEndLimitStrategy",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e,t){this.$1=e,this.$2=t}var t=e.prototype;return t.isActive=function(){return!0},t.getBufferTarget=function(){var e=this.$3();return this.$2>=e?this.$2-e:0},t.$3=function(){return this.$1.buffered.length===0?0:this.$1.buffered.end(0)},e})();i.default=e}),66);
__d("oz-player/strategies/OzBufferTargetBoundedStreamSegmentsCountStrategy",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e,t){this.$1=e,this.$2=t}var t=e.prototype;return t.isActive=function(t){return!t.isPlaying()},t.getSegmentsCount=function(t,n,r){for(var e=t.getCurrentTime(),o=this.$1.computeBufferTarget(),a=1,i=n,l=n.getTimeRange().startTime;i!==null&&l<o+e&&(i=r.getSegmentAfter(i),!!i);)l=i.getTimeRange().startTime,a++;return a},e})();i.default=e}),66);
__d("oz-player/strategies/OzBufferTargetCalculator",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e,t){this.$1=0,this.$2=e,this.$3=t}var t=e.prototype;return t.computeBufferTarget=function(){var e=this.$1;for(var t of this.$2)if(t.isActive()){e=t.getBufferTarget();break}for(var n of this.$3)e=n.adjustBufferTargetInSeconds(e);return this.$1=e,e},t.handleEvent=function(t){for(var e of this.$3)e.handleEvent(t)},e})();i.default=e}),66);
__d("oz-player/strategies/OzBufferTargetCalculatorQuotaExceededConstraint",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){var t=e.config,n=e.minimumBufferTargetSec;this.$2=1,this.$1=t,this.$3=n}var t=e.prototype;return t.adjustBufferTargetInSeconds=function(t){var e;return Math.max((e=this.$3)!=null?e:this.$1.getNumber("buffer_target_constraint_minimum_sec"),t*this.$2)},t.handleEvent=function(t){var e=this.$2;switch(t){case"append_succeeded":e=Math.max(0,Math.min(1,e+this.$1.getNumber("buffer_target_constraint_append_succeeded_reward")));break;case"append_quota_exceeded":e=Math.max(0,Math.min(1,e-this.$1.getNumber("buffer_target_constraint_quota_exceeded_penalty")));break;default:}this.$2=e},e})();i.default=e}),66);
__d("oz-player/strategies/OzPausedStreamSegmentsCountStrategy",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e,t){this.$1=e,this.$2=t}var t=e.prototype;return t.isActive=function(){return!this.$1.isPlaying()},t.getSegmentsCount=function(t,n,r){return this.$2.getNumber("paused_stream_segments_count")},e})();i.default=e}),66);
__d("oz-player/strategies/OzPlayheadAtInterruptionDetector",["oz-player/shims/OzDOMEventListener","oz-player/shims/OzEventEmitter","oz-player/shims/OzSubscriptionsHandler"],(function(t,n,r,o,a,i,l){"use strict";var e=1,s=(function(t){function n(e,n){var o;o=t.call(this)||this,o.$OzPlayheadAtInterruptionDetector$p_2=null,o.$OzPlayheadAtInterruptionDetector$p_3=new(r("oz-player/shims/OzSubscriptionsHandler")),o.$OzPlayheadAtInterruptionDetector$p_4=null,o.$OzPlayheadAtInterruptionDetector$p_1=e;var a=n?n.addListener("enterBuffering",function(){o.$OzPlayheadAtInterruptionDetector$p_5()}):r("oz-player/shims/OzDOMEventListener").listenDOMEvent(o.$OzPlayheadAtInterruptionDetector$p_1,"waiting",function(){o.$OzPlayheadAtInterruptionDetector$p_5()});return o.$OzPlayheadAtInterruptionDetector$p_3.addSubscriptions(a),o.$OzPlayheadAtInterruptionDetector$p_4=n,o}babelHelpers.inheritsLoose(n,t);var o=n.prototype;return o.notifyStreamInterrupted=function(t){this.$OzPlayheadAtInterruptionDetector$p_2=t,this.$OzPlayheadAtInterruptionDetector$p_5()},o.notifyStreamResumed=function(){this.$OzPlayheadAtInterruptionDetector$p_2=null},o.$OzPlayheadAtInterruptionDetector$p_5=function(){if(this.$OzPlayheadAtInterruptionDetector$p_2!=null){var t=this.$OzPlayheadAtInterruptionDetector$p_2||0;Math.abs(this.$OzPlayheadAtInterruptionDetector$p_1.currentTime-t)<e&&this.emit("playheadAtInterruption",t)}},o.destroy=function(){this.$OzPlayheadAtInterruptionDetector$p_3.release(),this.$OzPlayheadAtInterruptionDetector$p_4=null},n})(r("oz-player/shims/OzEventEmitter"));l.default=s}),98);
__d("oz-player/strategies/OzPlayingStatePriorityStrategy",["oz-player/shims/OzEventEmitter","oz-player/shims/OzSubscriptionsHandler"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t){var n;return n=e.call(this)||this,n.$OzPlayingStatePriorityStrategy$p_1=new(r("oz-player/shims/OzSubscriptionsHandler")),n.$OzPlayingStatePriorityStrategy$p_3=function(){n.emit("state_changed")},n.$OzPlayingStatePriorityStrategy$p_2=t,n.$OzPlayingStatePriorityStrategy$p_1.addSubscriptions(n.$OzPlayingStatePriorityStrategy$p_2.addEventListener("playing",n.$OzPlayingStatePriorityStrategy$p_3),n.$OzPlayingStatePriorityStrategy$p_2.addEventListener("play",n.$OzPlayingStatePriorityStrategy$p_3),n.$OzPlayingStatePriorityStrategy$p_2.addEventListener("pause",n.$OzPlayingStatePriorityStrategy$p_3)),n}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.isActive=function(){return!0},n.getName=function(){return"playing_state"},n.setSourceBufferState=function(t){},n.getPriority=function(){return this.$OzPlayingStatePriorityStrategy$p_2.isPlaying()?1:0},n.destroy=function(){this.$OzPlayingStatePriorityStrategy$p_1.release()},t})(r("oz-player/shims/OzEventEmitter"));l.default=e}),98);
__d("oz-player/strategies/OzPositionToViewportPriorityStrategy",["oz-player/shims/OzEventEmitter","oz-player/shims/OzSubscriptionsHandler"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n){var o;return o=e.call(this)||this,o.$OzPositionToViewportPriorityStrategy$p_3=new(r("oz-player/shims/OzSubscriptionsHandler")),o.$OzPositionToViewportPriorityStrategy$p_4=function(){o.emit("state_changed")},o.$OzPositionToViewportPriorityStrategy$p_2=t,o.$OzPositionToViewportPriorityStrategy$p_1=n,o.$OzPositionToViewportPriorityStrategy$p_3.addSubscriptions(t.addListener("state_changed",o.$OzPositionToViewportPriorityStrategy$p_4)),o}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.isActive=function(){return!0},n.getName=function(){return"position_to_viewport"},n.setSourceBufferState=function(t){},n.getPriority=function(){var e=this.$OzPositionToViewportPriorityStrategy$p_1.getNumber("prioritize_by_viewport_static_penalty"),t=this.$OzPositionToViewportPriorityStrategy$p_2.getPositionIndexOfVideoFromViewportVertically();return e>0?t===-1?e*-1:0:t===-1?-1/0:-1*t},n.destroy=function(){this.$OzPositionToViewportPriorityStrategy$p_3.release()},t})(r("oz-player/shims/OzEventEmitter"));l.default=e}),98);
__d("oz-player/strategies/OzPriorityCalculator",["oz-player/shims/OzEventEmitter","oz-player/shims/OzSubscriptionsHandler"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t){var n,o;return o=e.call(this)||this,o.$OzPriorityCalculator$p_2=new(r("oz-player/shims/OzSubscriptionsHandler")),o.$OzPriorityCalculator$p_1=t,(n=o.$OzPriorityCalculator$p_2).addSubscriptions.apply(n,o.$OzPriorityCalculator$p_1.map(function(e){return e.addListener("state_changed",function(){o.emit("state_changed",o.compute(),e.getName())})})),o}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.setSourceBufferState=function(t){this.$OzPriorityCalculator$p_1.forEach(function(e){return e.setSourceBufferState(t)}),this.emit("state_changed",this.compute(),"source_buffer")},n.compute=function(){var e=this.$OzPriorityCalculator$p_1.reduce(function(e,t){var n=t.isActive()?t.getPriority():0;return e+n},0);return Math.max(e,0)},n.destroy=function(){this.$OzPriorityCalculator$p_2.release()},t})(r("oz-player/shims/OzEventEmitter"));l.default=e}),98);
__d("oz-player/strategies/OzSingleCodecRestriction",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(){}var t=e.prototype;return t.applyRestriction=function(t){if(t.length<=0)return t.slice();var e=new Set(t.map(function(e){return l(e)})),n="av01",r=e.has(n)?n:e.values().next().value;return r==null?t.slice():t.filter(function(e){return l(e)===r})},e})();function l(e){return e.getMimeCodecs().replace(/\..*$/,"")}i.default=e}),66);
__d("oz-player/strategies/OzStaleManifestBufferTargetStrategy",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e,t){this.$1=t,this.$2=e}var t=e.prototype;return t.isActive=function(){return this.$2.getRefreshDate()==null&&this.$1.getNumber("stale_mpd_buffer_ahead_target")>0},t.getBufferTarget=function(){return this.$1.getNumber("stale_mpd_buffer_ahead_target")},e})();i.default=e}),66);
__d("oz-player/strategies/OzStartupBufferTargetStrategy",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e,t){this.$1=e,this.$3=t}var t=e.prototype;return t.isActive=function(){var e=this.$1.isPlaying();return e&&(this.$2=!0),!this.$2},t.getBufferTarget=function(){return this.$3.getNumber("pre_start_buffer_ahead_target")},e})();i.default=e}),66);
__d("oz-player/strategies/OzStreamSegmentsCountCalculator",[],(function(t,n,r,o,a,i){"use strict";var e=1,l=(function(){function t(e){this.$1=e}var n=t.prototype;return n.computeMin=function(n,r,o){var t=Number.MAX_VALUE;for(var a of this.$1)a.isActive(n)&&(t=Math.min(t,a.getSegmentsCount(n,r,o)));return t===Number.MAX_VALUE?e:Math.max(t,e)},t})();i.default=l}),66);
__d("oz-player/strategies/OzSupportedMimeCodecsRestriction",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){this.$1=e}var t=e.prototype;return t.applyRestriction=function(t){var e=this;return t.filter(function(t){var n=e.$1?ManagedMediaSource.isTypeSupported(t.getMimeCodecs()):MediaSource.isTypeSupported(t.getMimeCodecs());return!!n})},e})();i.default=e}),66);
__d("oz-player/streams/OzEndOfStreamWatcher",["oz-player/shims/OzEventEmitter","oz-player/shims/ozvariant"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n){var r;return r=e.call(this)||this,r.$OzEndOfStreamWatcher$p_1=new Map,r.$OzEndOfStreamWatcher$p_4=!1,r.$OzEndOfStreamWatcher$p_2=t,r.$OzEndOfStreamWatcher$p_3=n,r}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.registerMediaStream=function(t){!this.$OzEndOfStreamWatcher$p_1.has(t)||r("oz-player/shims/ozvariant")(0,5191),this.$OzEndOfStreamWatcher$p_1.set(t,!1)},n.notifyRepresentationSwitched=function(t){this.$OzEndOfStreamWatcher$p_1.has(t)||r("oz-player/shims/ozvariant")(0,5192),this.$OzEndOfStreamWatcher$p_1.get(t)===!0&&this.$OzEndOfStreamWatcher$p_1.set(t,!1),this.$OzEndOfStreamWatcher$p_5("end_of_stream_watcher","representation_switched")},n.notifyMediaStreamEnded=function(t,n){this.$OzEndOfStreamWatcher$p_1.has(t)||r("oz-player/shims/ozvariant")(0,5192),this.$OzEndOfStreamWatcher$p_1.set(t,!0),this.$OzEndOfStreamWatcher$p_5("end_of_stream_watcher","media_stream_ended:"+n)},n.$OzEndOfStreamWatcher$p_5=function(t,n){var e=this;if(this.$OzEndOfStreamWatcher$p_3.getBool("do_not_end_stream")){!this.$OzEndOfStreamWatcher$p_4&&this.$OzEndOfStreamWatcher$p_6()&&(this.$OzEndOfStreamWatcher$p_4=!0,this.emit("streamEnd"));return}var r=this.$OzEndOfStreamWatcher$p_2.getReadyState();r==="open"&&this.$OzEndOfStreamWatcher$p_6()&&this.$OzEndOfStreamWatcher$p_2.notifyEndOfStream(t,n).then(function(){e.emit("streamEnd")}).catch(function(){e.emit("streamEnd")})},n.$OzEndOfStreamWatcher$p_6=function(){if(this.$OzEndOfStreamWatcher$p_1.size===0)return!1;for(var e of this.$OzEndOfStreamWatcher$p_1.values())if(!e)return!1;return!0},n.destroy=function(){this.$OzEndOfStreamWatcher$p_1.clear()},t})(r("oz-player/shims/OzEventEmitter"));l.default=e}),98);
__d("oz-player/streams/OzHandleUserRepresentationSwitch",["oz-player/shims/OzSubscriptionsHandler","oz-player/shims/ozReportUnexpectedError","oz-player/utils/OzErrorEmitter"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n,o,a,i){var l=this;this.$2=new(r("oz-player/utils/OzErrorEmitter")),this.$5=null,this.$6=new(r("oz-player/shims/OzSubscriptionsHandler")),this.$1=e,this.$3=t,this.$4=n,this.$7=o,this.$8=i,a.then(function(e){l.$5=e},function(){}).catch(function(e){r("oz-player/shims/ozReportUnexpectedError")(e,"OzHandleUserRepresentationSwitch SBM promise then - create")}),this.$6.addSubscriptions(o.addListener("switchRepresentation",function(e,t){l.$9(e,t)}))}var t=e.prototype;return t.destroy=function(){this.$6.release(),this.$6.engage()},t.onError=function(t){return this.$2.onError(t)},t.$9=function(t,n){if(t==="user"){var e=this.$5;if(e!=null){for(var o=this.$7.getRepresentationIDAtTime(this.$3.getCurrentTime()),a,i=0;i<this.$4.length;i++)this.$4[i].getID()===o&&(a=this.$4[i]);if(a&&n&&(this.$8||a.getBandwidth()<n.getBandwidth())){var l=a.getSegmentByTime(this.$3.getCurrentTime());l&&e.clearRangeWithWait([{fromTime:this.$3.getCurrentTime(),toTime:this.$3.getDuration()}]).catch(function(e){r("oz-player/shims/ozReportUnexpectedError")(e,"OzHandleUserRepresentationSwitch clearRangeWithWait catch")})}}}},e})();l.default=e}),98);
__d("oz-player/manifests/IOzSegment",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return((e==null?void 0:e.getSequenceNumber())||0)===((t==null?void 0:t.getSequenceNumber())||0)}function l(e,t){return((e==null?void 0:e.getSequenceNumber())||0)>=((t==null?void 0:t.getSequenceNumber())||0)}i.isSequenceNumberEqual=e,i.isSequenceNumberGreaterOrEqual=l}),66);
__d("oz-player/networks/OzReadableStreamDataReader",["oz-player/networks/OzTransformStream","oz-player/utils/ozConcatUint8Arrays"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n){var r;if(n===void 0&&(n=null),r=e.call(this)||this,r.$OzReadableStreamDataReader$p_1=[],r.$OzReadableStreamDataReader$p_3=1/0,r.$OzReadableStreamDataReader$p_4=0,r.$OzReadableStreamDataReader$p_2=t,n!=null){var o=n.getNumber("stream_reader_max_buffer_len");r.$OzReadableStreamDataReader$p_3=o>0?o:1/0}return r}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.onDataWritten=function(t){if(this.$OzReadableStreamDataReader$p_4+t.byteLength>=this.$OzReadableStreamDataReader$p_3){var e=r("oz-player/utils/ozConcatUint8Arrays")(this.$OzReadableStreamDataReader$p_1),n=e.buffer;this.$OzReadableStreamDataReader$p_2(n),this.$OzReadableStreamDataReader$p_1.length=0,this.$OzReadableStreamDataReader$p_4=0}this.$OzReadableStreamDataReader$p_1.push(t),this.$OzReadableStreamDataReader$p_4+=t.byteLength},n.onClose=function(){var e=this.$OzReadableStreamDataReader$p_1,t=r("oz-player/utils/ozConcatUint8Arrays")(e),n=t.buffer;e.length=0,this.$OzReadableStreamDataReader$p_4=0,this.$OzReadableStreamDataReader$p_2(n)},t})(r("oz-player/networks/OzTransformStream"));l.default=e}),98);
__d("oz-player/networks/OzStreamingTask",["oz-player/loggings/OzLoggingUtils","oz-player/shims/OzDeferred","oz-player/shims/OzMaybeNativePromise","oz-player/shims/OzPerformance","oz-player/utils/OzErrorUtils","oz-player/utils/OzNetworkRequestLoggingUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n){this.$3=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise")),this.$5=!1,this.$9=null,this.$1=this.$2=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise")),this.$6=r("oz-player/shims/OzPerformance").now(),this.$7=t,this.$8=e,this.$9=n}var t=e.prototype;return t.run=function(){var e=this.$3.getPromise(),t=this.$7;if(t){var n=r("oz-player/shims/OzPerformance").now()-this.$6;o("oz-player/loggings/OzLoggingUtils").monitorPromiseAndLogOperation(e,t,"streaming_task",function(){},function(e){e.setTimeToRequestSent(Math.floor(n))})}return this.$2.resolve(),e},t.getPromise=function(){return this.$3.getPromise()},t.cancel=function(){this.$3.getPromise().catch(function(){}),this.$3.reject(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_STREAMING_TASK",description:"task cancelled",extra:{code:"OZ_ST-1"}})),this.$5=!0},t.finish=function(){this.$3.resolve()},t.isCancelled=function(){return this.$5},t.addStreamDeferred=function(t,n){var e=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise")),o=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise"));this.$10({createStreamResult:t,changeStatusDeferred:e,createStreamDeferred:o,loggerProviderWithStreamContext:n});var a=function(){return o.getPromise()};return{genStream:a,cancel:function(){if(t){var e=t.pausableStream;return e.pauseStream()}},getStatusChangePromise:function(){return e.getPromise()}}},t.$10=function(t){var e=this,n=t.changeStatusDeferred,a=t.createStreamDeferred,i=t.createStreamResult,l=t.loggerProviderWithStreamContext,s=t.loggingPayloads,u=this.$1.getPromise(),c=r("oz-player/shims/OzPerformance").now(),d=this.$1=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise"));d.getPromise().catch(function(){}),u.then(function(){if(i){var t=i.pausableStream;i.loggingPayloads&&(s=i.loggingPayloads),a.resolve(t.getStream()),e.$4=t;var n=r("oz-player/shims/OzPerformance").now(),u=e.$11(t.startStream());if(l){var d=function(a){var r=s;if(r){o("oz-player/utils/OzNetworkRequestLoggingUtils").setFetchStreamLoggingAttributes(a,r.getRequestUrl(),r.segments,n-c,t.getBytesStreamed(),r.getResponse());var i=e.$9;i&&i(a,r.getRequestUrl(),r.getResponse())}};o("oz-player/loggings/OzLoggingUtils").monitorPromiseAndLogOperation(u,l,"fetch_stream",d,d)}return u}return null}).then(function(t){e.$4=null,d.resolve(),n.resolve(t||"cancelled")}).catch(function(t){e.$4=null,e.$3.reject(t),d.reject(t),n.reject(t)})},t.$11=function(t){return t.then(function(e){var t=e.statusPromise;return t.then(function(e){return e==="stream_done"?"done":"error"})})},e})();l.default=e}),98);
__d("oz-player/scheduling/OzRoundRobinPriorityTaskQueue",["oz-player/shims/ozReportUnexpectedError"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){t===void 0&&(t=-1),this.$3=function(){},this.$4=[],this.$5=new Map,this.$1=e,this.$2=t}var t=e.prototype;return t.getHighestPriority=function(){return Math.max.apply(Math,this.$4.map(function(e){return e.queue.length?e.priority:-1/0}))},t.enqueue=function(t,n){var e=this,o=n;o=this.$6(o);var a=this.$5.get(t);if(a!==o){this.$5.has(t)&&this.remove(t);var i=this.$7(o),l=this.$4[i];l&&l.priority===o||(l={priority:o,queue:[]},this.$4.splice(i,0,l)),this.$5.set(t,o),l.queue.push(t),t.getPromise().then(function(){e.remove(t)},function(){e.remove(t)}).catch(function(e){r("oz-player/shims/ozReportUnexpectedError")(e,"OzRoundRobinPriorityTaskQueue remove after task run")}),this.$3(t,o>=this.$1?"immediate":"normal")}},t.updatePriority=function(t,n){this.$5.has(t)&&this.enqueue(t,n)},t.dequeue=function(){for(var e=0;e<this.$4.length;e++){var t=this.$4[e];if(t.queue.length){var n=t.queue.shift();return this.$5.delete(n),n}}return null},t.remove=function(t){var e=this.$5.get(t);if(e!==void 0){var n=this.$7(e),r=this.$4[n];if(r&&r.queue){var o=r.queue.findIndex(function(e){return e===t});o>-1&&r.queue.splice(o,1)}this.$5.delete(t)}},t.setOnTaskUpdated=function(t){this.$3=t},t.clearOnTaskUpdated=function(){this.setOnTaskUpdated(function(){})},t.getLength=function(){return this.$5.size},t.test_isEmpty=function(){return this.$5.size===0&&this.$4.every(function(e){return e.queue.length===0})},t.$7=function(t){var e=t;e=this.$6(e);var n;for(n=0;n<this.$4.length;n++)if(e>=this.$4[n].priority)return n;return n},t.$6=function(t){var e=t;return this.$2>=0&&(e=Number.parseFloat(e.toFixed(this.$2))),e},e})();l.default=e}),98);
__d("oz-player/scheduling/OzSequentialTaskScheduler",["oz-player/shims/OzMaybeNativePromise","oz-player/shims/ozReportUnexpectedError","oz-player/shims/ozSetTimeoutAcrossTransitions"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){this.$3=0,this.$1=e;var n=t||{},r=n.taskTimeout;this.$4=r||0}var t=e.prototype;return t.start=function(){var e=this;this.$1.setOnTaskUpdated(function(t,n){return e.$5(t,n)});var t=this.$1.dequeue();t&&this.$6(t,"immediate")},t.destroy=function(){this.$2&&this.$2.cancel(),this.$1.clearOnTaskUpdated()},t.$5=function(t,n){var e=this.$6(t,n);e&&this.$1.remove(t)},t.$6=function(t,n){var e=this;if(this.$2&&n!=="immediate")return!1;this.$2&&this.$2.cancel();var o=t.run().catch(function(e){});return this.$4>0&&(o=r("oz-player/shims/OzMaybeNativePromise").race([o,new(r("oz-player/shims/OzMaybeNativePromise"))(function(t,n){r("oz-player/shims/ozSetTimeoutAcrossTransitions")(t,e.$4)})])),this.$3++,this.$2=t,o=o.then(function(){if(e.$3--,e.$2===t&&(e.$2=null),e.$3===0){var n=e.$1.dequeue();n&&e.$6(n,"immediate")}}),o.catch(function(e){r("oz-player/shims/ozReportUnexpectedError")(e,"OzSequentialTaskScheduler task complete")}),!0},e})();l.default=e}),98);
__d("oz-player/networks/OzStreamingTaskQueueProvider",["oz-player/scheduling/OzRoundRobinPriorityTaskQueue","oz-player/scheduling/OzSequentialTaskScheduler"],(function(t,n,r,o,a,i,l){"use strict";var e=new Map,s=new Map,u=2,c=2,d=6e4;function m(t){var n=e.get(t);if(!n){n=new(r("oz-player/scheduling/OzRoundRobinPriorityTaskQueue"))(u,c);var o=new(r("oz-player/scheduling/OzSequentialTaskScheduler"))(n,{taskTimeout:d});e.set(t,n),s.set(t,o),o.start()}return n}l.OZ_QUEUE_MAX_PRIORITY=u,l.getQueue=m}),98);
__d("oz-player/networks/OzStreamingTaskStateManager",["Promise","oz-player/networks/OzStreamingTask","oz-player/networks/OzStreamingTaskQueueProvider","oz-player/networks/getOzBandwidthEstimatorPipeThroughReporter","oz-player/shims/OzSubscriptionsHandler"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(e){var t=this;this.$3=new(r("oz-player/shims/OzSubscriptionsHandler")),this.$4=0,this.$9=!1,this.$10=null;var n=e.bandwidthEstimator,a=e.config,i=e.loggerProvider,l=e.mimeType,s=e.priorityCalculator,u=e.setCustomFetchStreamLoggingAttributes;this.$5=l,this.$1=s,this.$6=o("oz-player/networks/OzStreamingTaskQueueProvider").getQueue(this.$5),this.$7=i,this.$8=a,this.$11=n!=null?n:null,this.$10=u,this.$3.addSubscriptions(this.$1.addListener("state_changed",function(e,n){t.$12(e,n),t.$2&&t.$6.updatePriority(t.$2,t.$4)}))}var a=t.prototype;return a.$13=function(){var e=[];return e.push(r("oz-player/networks/getOzBandwidthEstimatorPipeThroughReporter")(this.$5,this.$11)),e},a.startStreamDeferred=function(t){var e=t.dataAppendedCallback,n=t.dataAppendedErrorCallback,r=t.debugName,o=t.mediaStreamType,a=t.networkManager,i=t.segments,l=t.segmentsLoggerProvider,s=this.$14(l),u=this.$13(),c;i.length>0?c=a.createPausableStream({debugName:r,segments:i,pipeThroughRangeStreamProviders:u,loggerProvider:l,mediaStreamType:o,dataAppendedCallback:e,dataAppendedErrorCallback:n}):c=null,this.$9=!0;var d=s.addStreamDeferred(c,l);return{genStream:d.genStream,cancel:d.cancel,getStatusChangePromise:this.$15(d.getStatusChangePromise)}},a.$14=function(t){var e=this.$2;return this.$12(this.$1.compute(),"start_stream"),!e||e.isCancelled()?(e=this.$2=new(r("oz-player/networks/OzStreamingTask"))(this.$8,t,this.$10),this.$6.enqueue(e,this.$4)):this.$6.updatePriority(e,this.$4),e},a.$15=function(r){var t=this;return function(){return r().then(function(e){return t.$16(),e}).catch(function(r){return t.$16(),(e||(e=n("Promise"))).reject(r)})}},a.finishTaskIfNoOngoingStream=function(){this.$9||this.$17()},a.destroy=function(){this.$3.release();var e=this.$2;this.$2=null,e&&this.$6.remove(e)},a.$16=function(){this.$9=!1,this.$12(this.$1.compute(),"end_stream"),this.$4<o("oz-player/networks/OzStreamingTaskQueueProvider").OZ_QUEUE_MAX_PRIORITY&&this.$17()},a.$17=function(){this.$2&&(this.$2.finish(),this.$2=null)},a.$12=function(t,n){t!==this.$4&&(this.$4=t,this.$7&&this.$7.getOperationLogger("priority_changed").setPriorityFloat(this.$4).setInitiator(n).log())},t})();l.default=s}),98);
__d("oz-player/strategies/OzStreamLengthStrategy",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n,r,o){var a=t,i=o,l=e.getNumber("segments_to_stream_under_playhead_threshold"),s=e.getNumber("low_segment_stream_playhead_threshold");l>0&&r.getCurrentTime()<s&&(a=l);var u=[];u.push(i);for(var c=1;c<a;c++){var d=n.getSegmentAfter(i);if(!d)break;i=d,u.push(i)}return u}i.getStreamingSegments=e}),66);
__d("oz-player/streams/OzMediaStreamLoopDriver",["oz-player/shims/ozClearTimeout","oz-player/shims/ozSetTimeoutAcrossTransitions","oz-player/utils/OzErrorUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){var n=this;this.$2=null,this.$3=!1,this.$6=function(){var e;if(n.$7(),!n.$3){(e=n.$5)==null||e.start();var t=n.$1.execute(),o=n.$1.getLoopInterval();o&&(n.$2=r("oz-player/shims/ozSetTimeoutAcrossTransitions")(function(){n.$6()},o)),t&&t.then(n.$6).catch(function(e){n.$7();var t=n.$1.handleError(e);if(t)n.$2=r("oz-player/shims/ozSetTimeoutAcrossTransitions")(n.$6,t);else{var o,a;(o=n.$5)==null||o.setError(e),(a=n.$5)==null||a.log(),n.$5=null,n.$3=!0}})}},this.$1=e,this.$4=t}var t=e.prototype;return t.start=function(){if(this.$3)throw o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_NOT_IMPLEMENTED_ERROR",description:"restart is not implemented"});this.$5=this.$4.getOperationLogger("media_stream").start(),this.$6()},t.stop=function(){var e;this.$7(),this.$3=!0,(e=this.$5)==null||e.log(),this.$5=null},t.$7=function(){this.$2&&(r("oz-player/shims/ozClearTimeout")(this.$2),this.$2=null)},e})();l.default=e}),98);
__d("oz-player/utils/OzRangeUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){var n=t.filter(function(t){return t.startTime<=e&&t.endTime>=e});return n!=null&&n.length>0?n[0]:null}i.getRangeForTime=e}),66);
__d("oz-player/streams/OzSegmentLocator",["oz-player/utils/OzNumericalRangeUtil","oz-player/utils/OzRangeUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.getEndingSegment();return t!=null&&t.getSequenceNumber()!=null?t.getSequenceNumber():0}var s=function(t,n){var e=t.getCurrentTime();return n?o("oz-player/utils/OzRangeUtils").getRangeForTime(e,n.getBufferedRanges()):null},u=function(t,n,r){var e=s(t,n),o=r?r.getTimeRange().endTime:0,a=t.getCurrentTime()||0;return o?a=o:e&&(a=e.endTime),a},c=function(t,n,r,a,i,l,s,c){var e=t.getPredictedSegmentAfter(l);if(e&&n.isPlaying())return e;var d=u(n,a,l),m=i.getTimeRanges(),p=o("oz-player/utils/OzNumericalRangeUtil").findDiffCoveredByRanges(n.getCurrentTime(),d,m.map(function(e){return{rangeStart:e.startTime,rangeEnd:e.endTime}}));if(p>r)return null;var _=t.getSegment(0);return _&&_.getTimeRange().startTime>d&&(d=_.getTimeRange().startTime),t.getSegmentByTime(d)};l.getEndingSequenceNumber=e,l.getTimeToQuery=u,l.getSegment=c}),98);
__d("oz-player/streams/OzSegmentUtils",["oz-player/manifests/OzSegmentOptions","oz-player/shims/OzURI"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e.reduce(function(e,t){var n,r;return((n=t==null?void 0:t.getSequenceNumber())!=null?n:0)>((r=e==null?void 0:e.getSequenceNumber())!=null?r:0)?t:e})}function s(e,t){var n=new(r("oz-player/manifests/OzSegmentOptions"));return e.getPredictedSegmentAfter({getData:function(){return null},getByteRange:function(){return null},getSequenceNumber:function(){return t-1},getTimeRange:function(){return{endTime:0,startTime:0}},getURI:function(){return new(r("oz-player/shims/OzURI"))("")},getOptions:function(){return n}})}function u(e){return e.getOptions().setSegmentNumDecisionTime(Date.now()),e}l.getMaxSegment=e,l.getSegmentForSequenceNumber=s,l.markSegmentCreateTime=u}),98);
__d("oz-player/utils/OzTaggedTimeRanges",[],(function(t,n,r,o,a,i){var e=(function(){function e(e){this.$1=[],this.$2=0,this.$3=0,this.$4=e||function(e,t){return e===t}}var t=e.prototype;return t.add=function(t,n,r){if(!(n<t)&&n!==t){if(this.$1.length===0){this.$1.push({startTime:t,endTime:n,tag:r});return}for(var e=0,o=0,a=0;a<this.$1.length;a++){if(t===this.$1[a].startTime&&n===this.$1[a].endTime){e=a,o=a+1;break}if(t>=this.$1[a].startTime&&(e=a+1),n<=this.$1[a].endTime&&(o=a),n<this.$1[a].startTime)break}this.$1.splice(e,o-e,{startTime:t,endTime:n,tag:r}),this.$5(e)}},t.$5=function(t){var e=t,n=this.$1[e],r=null;e!==0&&(r=this.$1[e-1]),r!==null&&(this.$4(r.tag,n.tag)?r.endTime>=n.startTime&&(this.$1.splice(e-1,2,{startTime:r.startTime,endTime:Math.max(n.endTime,r.endTime),tag:n.tag}),e--):(r.endTime>n.startTime&&r.startTime===n.startTime?(this.$1.splice(e-1,1),e--):r.endTime>n.startTime&&this.$1.splice(e-1,1,{startTime:r.startTime,endTime:n.startTime,tag:r.tag}),r.endTime>n.endTime&&this.$1.splice(e+1,0,{startTime:n.endTime,endTime:r.endTime,tag:r.tag})));var o=null;e!==this.$1.length-1&&(o=this.$1[e+1]),o&&(this.$4(o.tag,n.tag)?o.startTime<=n.endTime&&this.$1.splice(e,2,{startTime:n.startTime,endTime:Math.max(o.endTime,n.endTime),tag:n.tag}):o.startTime<=n.endTime&&(o.endTime<n.endTime?(this.$1.splice(e,1,{startTime:n.startTime,endTime:o.startTime,tag:n.tag}),this.$1.push({startTime:o.endTime,endTime:n.endTime,tag:n.tag})):this.$1.splice(e+1,1,{startTime:n.endTime,endTime:o.endTime,tag:o.tag})))},t.get=function(t){for(var e=t>=this.$3?this.$2:0,n=null,r=e;r<this.$1.length;r++)if(this.$1[r].startTime<=t&&t<this.$1[r].endTime){n=r;break}return this.$2=n===null?0:n,this.$3=t,n===null?null:this.$1[n].tag},t.getLength=function(){return this.$1.length},e})();i.default=e}),66);
__d("oz-player/streams/OzMediaStream",["oz-player/manifests/IOzSegment","oz-player/networks/OzNetworkManager","oz-player/networks/OzReadableStreamDataReader","oz-player/networks/OzStreamingTaskStateManager","oz-player/networks/getOzBandwidthEstimatorPipeThroughReporter","oz-player/shims/OzDeferred","oz-player/shims/OzEventEmitter","oz-player/shims/OzMaybeNativePromise","oz-player/shims/OzNetworkDiagnostics","oz-player/shims/OzSubscriptionsHandler","oz-player/shims/ozClearTimeout","oz-player/shims/ozReportUnexpectedError","oz-player/shims/ozSetTimeoutAcrossTransitions","oz-player/shims/ozvariant","oz-player/strategies/OzStreamLengthStrategy","oz-player/streams/OzMediaStreamLoopDriver","oz-player/streams/OzSegmentLocator","oz-player/streams/OzSegmentUtils","oz-player/utils/OzBufferingUtils","oz-player/utils/OzCustomErrorCode","oz-player/utils/OzErrorEmitter","oz-player/utils/OzErrorUtils","oz-player/utils/OzMimeUtil","oz-player/utils/OzTaggedTimeRanges"],(function(t,n,r,o,a,i,l){"use strict";var e=1e3,s=.2,u={AUDIO:1,CAPTION:3,VIDEO:0},c=(function(t){function n(e){var n,a;a=t.call(this)||this,a.$OzMediaStream$p_2=0,a.$OzMediaStream$p_3=0,a.$OzMediaStream$p_4=null,a.$OzMediaStream$p_13=null,a.$OzMediaStream$p_15=!1,a.$OzMediaStream$p_16=null,a.$OzMediaStream$p_17=new(r("oz-player/shims/OzSubscriptionsHandler")),a.$OzMediaStream$p_19=[],a.$OzMediaStream$p_22=0,a.$OzMediaStream$p_29=!0,a.$OzMediaStream$p_31=!1,a.$OzMediaStream$p_32=null,a.$OzMediaStream$p_33=new(r("oz-player/utils/OzErrorEmitter")),a.$OzMediaStream$p_35=!0,a.$OzMediaStream$p_38=0,a.$OzMediaStream$p_39=null,a.$OzMediaStream$p_40=null;var i=e.abrManager,l=e.blockedRepresentationsManager,s=e.bufferTargetCalculator,u=e.config,c=e.dynamicVideoLibrary,d=e.endOfStreamWatcher,m=e.loggerProvider,p=e.mediaStreamType,_=e.mpd,f=e.networkManager,g=e.playbackState,h=e.priorityCalculator,y=e.representation,C=e.segmentLocator,b=e.setCustomFetchStreamLoggingAttributes,v=e.shouldAppendOncePerStream,S=e.sourceBufferManagerPromise,R=e.streamSegmentsCountCalculator,L=e.warningEmitter;return a.$OzMediaStream$p_1=u,a.$OzMediaStream$p_5=S,a.$OzMediaStream$p_5.then(function(e){a.$OzMediaStream$p_6=e,a.$OzMediaStream$p_16&&a.$OzMediaStream$p_16.setSourceBuffer(e),a.$OzMediaStream$p_27.setSourceBufferState(e.getSourceBufferState()),a.$OzMediaStream$p_47()},function(){}).catch(function(e){r("oz-player/shims/ozReportUnexpectedError")(e,"OzMediaStream SBM promise then - create")}),a.$OzMediaStream$p_12=f,a.$OzMediaStream$p_7=g,a.$OzMediaStream$p_14=d,(n=a.$OzMediaStream$p_14)==null||n.registerMediaStream(a),a.$OzMediaStream$p_26=s,a.$OzMediaStream$p_27=h,a.$OzMediaStream$p_28=R,a.$OzMediaStream$p_16=i,a.$OzMediaStream$p_18=m.cloneContext(),a.$OzMediaStream$p_36=C,a.$OzMediaStream$p_25=new(r("oz-player/utils/OzTaggedTimeRanges"))(function(e,t){return e.id===t.id}),a.$OzMediaStream$p_39=b,a.$OzMediaStream$p_40=l,a.$OzMediaStream$p_42=c,a.$OzMediaStream$p_43=v,a.$OzMediaStream$p_44=p,a.$OzMediaStream$p_45=L,a.$OzMediaStream$p_46=_,a.$OzMediaStream$p_17.addSubscriptions(a.$OzMediaStream$p_7.addEventListener("seeking",function(){var e,t=g.getCurrentTime(),n=null;a.$OzMediaStream$p_1.getBool("ignore_reset_after_seek_if_bufferahead")&&a.$OzMediaStream$p_8.canPredict()&&(a.$OzMediaStream$p_6&&o("oz-player/utils/OzBufferingUtils").getBufferAheadFromCurrentTime(t,a.$OzMediaStream$p_6.getSourceBufferState().getBufferedRanges())>0)?n="no_reset_anchor":(n="reset_anchor",a.$OzMediaStream$p_41=Date.now(),a.$OzMediaStream$p_9!=null&&(a.$OzMediaStream$p_48(),a.$OzMediaStream$p_31=!1,a.$OzMediaStream$p_24&&a.$OzMediaStream$p_24.resolve())),a.$OzMediaStream$p_18.cloneContext().getOperationLogger("media_element_event").setInitiator("seeking").setLength(t*1e3).setReason(n).setUserInfo({streamAnchorSegmentNumber:String((e=a.$OzMediaStream$p_9)==null?void 0:e.getSequenceNumber())}).log()})),a.$OzMediaStream$p_40!=null&&a.$OzMediaStream$p_17.addSubscriptions(a.$OzMediaStream$p_40.onRepresentationBlocked(function(e){return a.$OzMediaStream$p_49(e)})),a.$OzMediaStream$p_21=o("oz-player/utils/OzMimeUtil").getMimeType(y.getMimeCodecs()),a.$OzMediaStream$p_30=new(r("oz-player/networks/OzStreamingTaskStateManager"))({mimeType:a.$OzMediaStream$p_21,priorityCalculator:a.$OzMediaStream$p_27,loggerProvider:a.$OzMediaStream$p_18,setCustomFetchStreamLoggingAttributes:a.$OzMediaStream$p_39,config:a.$OzMediaStream$p_1,bandwidthEstimator:a.$OzMediaStream$p_12.getBandwidthEstimator()}),a.$OzMediaStream$p_23=new(r("oz-player/streams/OzMediaStreamLoopDriver"))(a,a.$OzMediaStream$p_18),a.$OzMediaStream$p_50(y),a}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.start=function(){this.$OzMediaStream$p_23.start()},a.getCurrentRepresentation=function(){return this.$OzMediaStream$p_8},a.switchRepresentation=function(t,n){n===void 0&&(n=null),this.$OzMediaStream$p_50(t,"user",n)},a.onError=function(t){return this.$OzMediaStream$p_33.onError(t)},a.updateRunTimeConfigs=function(t){var e=t.resetStreamAnchor,n=t.streamDataHandler;n!==void 0&&(this.$OzMediaStream$p_34=n),e===!0&&this.$OzMediaStream$p_8.canApproximateId()&&(this.$OzMediaStream$p_48(),this.$OzMediaStream$p_10=null)},a.$OzMediaStream$p_50=function(t,n,a){var e,i=this;if(n===void 0&&(n="internal"),a===void 0&&(a=null),t==null){if(this.$OzMediaStream$p_1.getBool("no_rep_to_switch_fallback_progressive")){var l=o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_NO_AVAILABLE_REP_TO_SWITCH",description:"No available representation to switch to because all are blocked"});this.$OzMediaStream$p_33.emitError(l)}return}n==="user"&&this.$OzMediaStream$p_48(),(e=this.$OzMediaStream$p_20)==null||e.remove(),this.$OzMediaStream$p_20=null;var s=this.$OzMediaStream$p_18.cloneContext().setType(this.$OzMediaStream$p_21+";init"),u=s.cloneContext().setRepresentationID(t.getID()),c=t.getInitSegment(),d=c.getData(),m=s.getOperationLogger("stream_switch").setPreviousRepresentationID(this.$OzMediaStream$p_8?this.$OzMediaStream$p_8.getID():null).setInitiator(n).setRepresentationID(t.getID()).setReason(n==="internal"?this.$OzMediaStream$p_16&&this.$OzMediaStream$p_16.getLastEvaluationReason():n).start();this.$OzMediaStream$p_8=t;var p=function(){var e;m.log(),i.$OzMediaStream$p_26.handleEvent("append_succeeded"),i.emit("initAppended"),(e=i.$OzMediaStream$p_14)==null||e.notifyRepresentationSwitched(i)},_=function(n){var e;if(m.setError(n).log(),i.$OzMediaStream$p_51(n),(e=i.$OzMediaStream$p_40)==null||e.handleError(t.getID(),n),t.getID()!==i.$OzMediaStream$p_8.getID()){var r;(r=i.$OzMediaStream$p_24)==null||r.resolve()}};if(d==null){var f=this.$OzMediaStream$p_12.request({debugName:"OzMediaStream/init/"+this.$OzMediaStream$p_44,segments:[c],pipeThroughRangeStreamProviders:[r("oz-player/networks/getOzBandwidthEstimatorPipeThroughReporter")(this.$OzMediaStream$p_21,this.$OzMediaStream$p_12.getBandwidthEstimator())],loggerProvider:u,requestOptions:null,mediaStreamType:this.$OzMediaStream$p_44,dataAppendedCallback:p,dataAppendedErrorCallback:_});d=f.getStream()}if(this.emit("switchRepresentation",n,t),this.$OzMediaStream$p_52({data:d,mimeCodecs:t.getMimeCodecs(),clearSourceBufferRange:a,dataAppendedCallback:p,dataAppendedErrorCallback:_,loggerProvider:u.cloneContext(),appendTarget:0}),a){var g=t.getSegmentByTime(a[0]);if(g){var h=this.$OzMediaStream$p_12.request({debugName:"OzMediaStream/startingSegment/"+this.$OzMediaStream$p_44,segments:[g],pipeThroughRangeStreamProviders:[r("oz-player/networks/getOzBandwidthEstimatorPipeThroughReporter")(this.$OzMediaStream$p_21,this.$OzMediaStream$p_12.getBandwidthEstimator())],loggerProvider:u,requestOptions:null,mediaStreamType:this.$OzMediaStream$p_44,dataAppendedCallback:p,dataAppendedErrorCallback:_}),y=h.getStream();this.$OzMediaStream$p_52({data:y,mimeCodecs:t.getMimeCodecs(),clearSourceBufferRange:null,dataAppendedCallback:p,dataAppendedErrorCallback:_,loggerProvider:u.cloneContext(),appendTarget:1})}}},a.getLoopInterval=function(){return this.$OzMediaStream$p_22},a.execute=function(){var e=this.$OzMediaStream$p_53();if(e){var t=this.$OzMediaStream$p_24=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise"));return e.then(function(){return t.resolve()}).catch(function(e){return t.reject(e)}),t.getPromise()}return null},a.$OzMediaStream$p_54=function(t){if(this.$OzMediaStream$p_16&&this.$OzMediaStream$p_29&&this.$OzMediaStream$p_15){var e=this.$OzMediaStream$p_16.getBestRepresentation(t);if(this.$OzMediaStream$p_8!==e)return e}return null},a.$OzMediaStream$p_55=function(t){var e=this.$OzMediaStream$p_6?this.$OzMediaStream$p_6.getSourceBufferState():null,n=this.$OzMediaStream$p_26.computeBufferTarget();if(n<=0)return null;var r=null;if(t&&(r=this.$OzMediaStream$p_8.getCustomFieldFirstSegment()),!r&&this.$OzMediaStream$p_8.canPredict()&&this.$OzMediaStream$p_36!=null){var a=this.$OzMediaStream$p_35&&this.$OzMediaStream$p_7.isPlaying();return this.$OzMediaStream$p_36.getSegment(this.$OzMediaStream$p_8,this.$OzMediaStream$p_7,n,e,this.$OzMediaStream$p_9,this.$OzMediaStream$p_10,this.$OzMediaStream$p_1,a,this.$OzMediaStream$p_21)}else if(r||(r=o("oz-player/streams/OzSegmentLocator").getSegment(this.$OzMediaStream$p_8,this.$OzMediaStream$p_7,n,e,this.$OzMediaStream$p_8,this.$OzMediaStream$p_9,this.$OzMediaStream$p_1,this.$OzMediaStream$p_32)),this.$OzMediaStream$p_8.canPredict()){var i=this.$OzMediaStream$p_10&&this.$OzMediaStream$p_10.getSequenceNumber()||0,l=r&&r.getSequenceNumber()||0;if(r&&this.$OzMediaStream$p_10&&i>=l){var s=o("oz-player/streams/OzSegmentLocator").getEndingSequenceNumber(this.$OzMediaStream$p_8);return(s||0)>=i?this.$OzMediaStream$p_10:null}}if(!r&&!this.$OzMediaStream$p_56()){var u=this.$OzMediaStream$p_8.getEndingSegment();if(u&&this.$OzMediaStream$p_8.isEndingSegment(u)){var c=u.getTimeRange().endTime,d=o("oz-player/streams/OzSegmentLocator").getTimeToQuery(this.$OzMediaStream$p_7,e,this.$OzMediaStream$p_9);d>=c&&!this.$OzMediaStream$p_56()&&(r=u)}}return r},a.$OzMediaStream$p_57=function(){return!this.$OzMediaStream$p_15},a.$OzMediaStream$p_58=function(t,n){var e,a,i=(e=n.fetchSingleSegment)!=null?e:!1,l=(a=n.preventRepresentationSwitch)!=null?a:!1,s=[];if(i)s=[t];else{var u=this.$OzMediaStream$p_28.computeMin(this.$OzMediaStream$p_7,t,this.$OzMediaStream$p_8);if(s=o("oz-player/strategies/OzStreamLengthStrategy").getStreamingSegments(this.$OzMediaStream$p_1,u,this.$OzMediaStream$p_8,this.$OzMediaStream$p_7,t),s=r("oz-player/networks/OzNetworkManager").getStreamableSegmentsRange(s),!l){var c=this.$OzMediaStream$p_54(s);if(c){this.$OzMediaStream$p_50(c);var d=this.$OzMediaStream$p_55(!1);return d?this.$OzMediaStream$p_58(d,{fetchSingleSegment:!1,preventRepresentationSwitch:!0}):[]}}}return s},a.$OzMediaStream$p_59=function(){var e=this,t=function(n){n==null||n.remove(),e.$OzMediaStream$p_20===n&&(e.$OzMediaStream$p_20=null)};t(this.$OzMediaStream$p_20);var n=null;return new(r("oz-player/shims/OzMaybeNativePromise"))(function(r,o){n=e.getCurrentRepresentation().addUpdateListener(function(){t(n),r()}),e.$OzMediaStream$p_20=n}).catch(function(e){throw t(n),e})},a.$OzMediaStream$p_53=function(){var t=this,n=this.$OzMediaStream$p_6?this.$OzMediaStream$p_6.getSourceBufferState():null;if(this.$OzMediaStream$p_8.canPredict()&&this.$OzMediaStream$p_10&&this.$OzMediaStream$p_8.isEndingSegment(this.$OzMediaStream$p_10)){this.endStream("pdash_ending_segment_had_error"),this.$OzMediaStream$p_18.cloneContext().getOperationLogger("media_loop_end").setInitiator("end1").setRepresentationID(this.$OzMediaStream$p_8.getID()).log();return}if(this.$OzMediaStream$p_8.canPredict()&&this.$OzMediaStream$p_9&&this.$OzMediaStream$p_8.isEndingSegment(this.$OzMediaStream$p_9)){this.endStream("pdash_anchor_segment_is_ending_segment"),this.$OzMediaStream$p_18.cloneContext().getOperationLogger("media_loop_end").setInitiator("end2").setRepresentationID(this.$OzMediaStream$p_8.getID()).log();return}var a=this.$OzMediaStream$p_57(),i=this.$OzMediaStream$p_55(a);if(this.$OzMediaStream$p_8.canPredict()&&this.$OzMediaStream$p_11!=null&&o("oz-player/manifests/IOzSegment").isSequenceNumberGreaterOrEqual(i,this.$OzMediaStream$p_11)){this.$OzMediaStream$p_18.cloneContext().getOperationLogger("media_loop_end").setInitiator("segment_end").setRepresentationID(this.$OzMediaStream$p_8.getID()).log();return}if(o("oz-player/manifests/IOzSegment").isSequenceNumberEqual(i,this.$OzMediaStream$p_37)?this.$OzMediaStream$p_38++:this.$OzMediaStream$p_38=0,this.$OzMediaStream$p_37=i,this.$OzMediaStream$p_7.isPlaying()&&this.$OzMediaStream$p_38>0&&this.$OzMediaStream$p_18.cloneContext().getOperationLogger("get_segment_to_stream_same_segment").setReason((i==null?void 0:i.getSequenceNumber())!=null?String(i==null?void 0:i.getSequenceNumber()):null).setLength(this.$OzMediaStream$p_38).setRepresentationID(this.$OzMediaStream$p_8.getID()).setSegmentStartTime(i==null?void 0:i.getTimeRange().startTime).setSegmentEndTime(i==null?void 0:i.getTimeRange().endTime).log(),this.$OzMediaStream$p_31){var l,s;return this.$OzMediaStream$p_22=e,this.$OzMediaStream$p_18.cloneContext().getOperationLogger("media_loop_end").setInitiator("ongoing_stream").setReason(((l=this.$OzMediaStream$p_9)==null?void 0:l.getSequenceNumber())!=null?String((s=this.$OzMediaStream$p_9)==null?void 0:s.getSequenceNumber()):null).setRepresentationID(this.$OzMediaStream$p_8.getID()).log(),null}if(!i||this.$OzMediaStream$p_31){if(this.$OzMediaStream$p_8.canPredict()&&this.$OzMediaStream$p_1.getBool("ms_promise_for_null")){var u=this.$OzMediaStream$p_1.getNumber("ms_promise_for_null_ms");return new(r("oz-player/shims/OzMaybeNativePromise"))(function(e,n){var o=r("oz-player/shims/ozSetTimeoutAcrossTransitions")(function(){r("oz-player/shims/ozClearTimeout")(o),e()},u||(t.$OzMediaStream$p_8.getMaxGopSec()||1)*1e3)})}return this.$OzMediaStream$p_22=e,this.$OzMediaStream$p_31||this.$OzMediaStream$p_30.finishTaskIfNoOngoingStream(),this.$OzMediaStream$p_59()}this.$OzMediaStream$p_22=0;var c=this.$OzMediaStream$p_58(i,{fetchSingleSegment:a});if(c.length===0){var d,m;return this.$OzMediaStream$p_18.cloneContext().getOperationLogger("media_loop_end").setInitiator("no_stream_segments").setReason(((d=this.$OzMediaStream$p_9)==null?void 0:d.getSequenceNumber())!=null?String((m=this.$OzMediaStream$p_9)==null?void 0:m.getSequenceNumber()):null).setRepresentationID(this.$OzMediaStream$p_8.getID()).log(),this.$OzMediaStream$p_59()}this.$OzMediaStream$p_15=!0;var p=c[c.length-1]||null,_=this.$OzMediaStream$p_8,f=function(){return _.isEndingSegment(p)};c.length!==0||r("oz-player/shims/ozvariant")(0,23148);var g=c[0],h=g.getTimeRange().startTime,y=p.getTimeRange().endTime,C={startTime:h,endTime:y,tag:{id:this.$OzMediaStream$p_8.getID()}},b=function(n){k.setAppendedBufferMs(Math.round(n.appendedSec*1e3)),k.log(),t.$OzMediaStream$p_26.handleEvent("append_succeeded"),c.forEach(function(e){t.emit("SegmentAppended",t.$OzMediaStream$p_60(e,C))}),f()&&t.endStream("appended_ending_segment"),t.$OzMediaStream$p_61(C,n)},v=function(n){k.setError(n).log();var e=L||R;e&&e.cancel(),t.$OzMediaStream$p_51(n)},S=this.$OzMediaStream$p_18.cloneContext();S.setRepresentationID(this.$OzMediaStream$p_8.getID()),S.setSegmentStartTime(h).setSegmentEndTime(y);var R,L;a?(R=this.$OzMediaStream$p_12.request({debugName:"OzMediaStream/streamableSegments/"+this.$OzMediaStream$p_44+"/prefetch",segments:c,pipeThroughRangeStreamProviders:[r("oz-player/networks/getOzBandwidthEstimatorPipeThroughReporter")(this.$OzMediaStream$p_21,this.$OzMediaStream$p_12.getBandwidthEstimator())],loggerProvider:S.cloneContext(),requestOptions:null,mediaStreamType:this.$OzMediaStream$p_44,dataAppendedCallback:b,dataAppendedErrorCallback:v}),this.$OzMediaStream$p_13=R):(L=this.$OzMediaStream$p_30.startStreamDeferred({debugName:"OzMediaStream/streamableSegments/"+this.$OzMediaStream$p_44,segments:c,networkManager:this.$OzMediaStream$p_12,sourceBufferState:n,playbackState:this.$OzMediaStream$p_7,segmentsLoggerProvider:S.cloneContext(),mediaStreamType:this.$OzMediaStream$p_44,dataAppendedCallback:b,dataAppendedErrorCallback:v}),this.$OzMediaStream$p_13=R),this.$OzMediaStream$p_31=!0;var E=this.$OzMediaStream$p_62(g,p,c.length),k=S.getOperationLogger("queued_append");k.start().setReason(this.$OzMediaStream$p_16&&this.$OzMediaStream$p_16.getLastEvaluationReason());var I=function(n,r){t.$OzMediaStream$p_52({data:n,mimeCodecs:r,clearSourceBufferRange:null,dataAppendedCallback:b,dataAppendedErrorCallback:v,loggerProvider:S.cloneContext(),appendTarget:E})},T;L||R||r("oz-player/shims/ozvariant")(0,23147);var D=this.$OzMediaStream$p_8.getMimeCodecs();L?(L.genStream().then(function(e){return I(e,D)}).catch(function(e){return t.$OzMediaStream$p_33.emitError(e)}),T=L.getStatusChangePromise()):R&&(I(R.getStream(),D),T=R.getStatusChangePromise()),T||r("oz-player/shims/ozvariant")(0,51928);var x=T.then(function(e){return t.$OzMediaStream$p_63(e,p),t.$OzMediaStream$p_64()}).then(function(){t.$OzMediaStream$p_2=0});return x.catch(function(e){var n,r=t.$OzMediaStream$p_9;return t.$OzMediaStream$p_65(p),(n=t.$OzMediaStream$p_40)==null||n.handleError(_.getID(),e),t.$OzMediaStream$p_66(e,p,r)})},a.handleError=function(t){var e=this.$OzMediaStream$p_18.getOperationLogger("media_stream_loop_error");return e.setError(t).setResult("failed").log(),this.$OzMediaStream$p_1.getNumber("loop_body_handle_error_interval_ms")},a.$OzMediaStream$p_66=function(t,n,a){var e=this;this.$OzMediaStream$p_31=!1;var i=new(r("oz-player/shims/OzDeferred"))(r("oz-player/shims/OzMaybeNativePromise")),l=o("oz-player/utils/OzErrorUtils").getNormalizedErrorAndCode(t),s=l[0],u=l[1],c=o("oz-player/utils/OzErrorUtils").getOzErrorWithMIMEType(s,this.$OzMediaStream$p_21),d=function(l){if(e.$OzMediaStream$p_2++,e.$OzMediaStream$p_18.getOperationLogger("media_stream").setInitiator("fetch_stream_"+(l.behavior!=null?l.behavior:"default")).setLength(l.timeoutMs).setReason(""+c.getDescription()).setError(c).setCode(u.length>0?Number.parseInt(u,10):null).setType(e.$OzMediaStream$p_21).log(),l.behavior==="retry_failed_request")e.$OzMediaStream$p_9=a;else if(l.behavior==="recover_failed_request"&&o("oz-player/utils/OzErrorUtils").isOzError(t)){var n,s=(n=t.getExtra())==null?void 0:n.headers,d=r("oz-player/shims/OzNetworkDiagnostics").getNextValidSegmentId(s);d!=null&&(e.$OzMediaStream$p_9=o("oz-player/streams/OzSegmentUtils").getSegmentForSequenceNumber(e.$OzMediaStream$p_8,d-1))}r("oz-player/shims/ozSetTimeoutAcrossTransitions")(function(){return e.emit("streamErrorRetry",c),i.resolve()},l.timeoutMs)};this.$OzMediaStream$p_4!==u?(this.$OzMediaStream$p_4=u,this.$OzMediaStream$p_3=1):this.$OzMediaStream$p_3++;var m=!0,p=function(){m=!1},_={consecutiveFailuresForErrorCode:this.$OzMediaStream$p_3,endStream:function(){p(),e.$OzMediaStream$p_10=n,e.$OzMediaStream$p_11=n,e.endStream("streamError_event_object"),i.resolve()},error:c,isInitialRequest:!1,retry:function(t){var e;p(),d({timeoutMs:(e=t==null?void 0:t.waitMs)!=null?e:0,behavior:t==null?void 0:t.behavior})},retryAttemptCount:this.$OzMediaStream$p_2};return this.emit("streamError",_),m&&(this.$OzMediaStream$p_33.emitError(c),this.$OzMediaStream$p_2=0,i.resolve()),i.getPromise()},a.$OzMediaStream$p_65=function(t){this.$OzMediaStream$p_48(),this.$OzMediaStream$p_10=t,this.$OzMediaStream$p_30.finishTaskIfNoOngoingStream();var e=this.$OzMediaStream$p_6;e&&e.cancelOperationAndCleanQueue(this.$OzMediaStream$p_18)},a.$OzMediaStream$p_63=function(t,n){t==="done"&&(this.$OzMediaStream$p_9=n)},a.$OzMediaStream$p_64=function(){this.$OzMediaStream$p_31=!1},a.$OzMediaStream$p_52=function(t){this.$OzMediaStream$p_19.push(t),this.$OzMediaStream$p_6&&this.$OzMediaStream$p_47()},a.$OzMediaStream$p_61=function(t,n){t!=null&&(this.$OzMediaStream$p_8.canPredict()&&n.startTime_UNSAFE&&n.endTime_UNSAFE?this.$OzMediaStream$p_25.add(n.startTime_UNSAFE,n.endTime_UNSAFE,t.tag):this.$OzMediaStream$p_25.add(t.startTime,t.endTime,t.tag))},a.$OzMediaStream$p_47=function(){var e=this;this.$OzMediaStream$p_19.forEach(function(t){var n=t.appendTarget,o=t.clearSourceBufferRange,a=t.data,i=t.dataAppendedCallback,l=t.dataAppendedErrorCallback,s=t.loggerProvider,u=t.mimeCodecs,c=a instanceof Uint8Array||e.$OzMediaStream$p_34==null?a:a.pipeThrough(new(r("oz-player/networks/OzReadableStreamDataReader"))(e.$OzMediaStream$p_34.bind(e,e.$OzMediaStream$p_8),e.$OzMediaStream$p_1));e.$OzMediaStream$p_6&&e.$OzMediaStream$p_6.queueData(c,u,o,s,n).then(function(e){e&&i(e)}).catch(function(e){l(e)})}),this.$OzMediaStream$p_19=[]},a.$OzMediaStream$p_67=function(){var e=this.$OzMediaStream$p_6;if(!e)return r("oz-player/shims/OzMaybeNativePromise").resolve();var t=this.$OzMediaStream$p_7.getCurrentTime(),n=[{fromTime:0,toTime:t}],o=this.$OzMediaStream$p_1.getNumber("clear_buffer_around_playhead_boundary_ms");if(o>0){var a=o/1e3,i=e.getSourceBufferState(),l=i.getBufferedRanges(),s=l.length>=1?l[l.length-1].endTime:t;n=[{fromTime:0,toTime:Math.max(0,t-a)}],t+a<s&&n.push({fromTime:t+a,toTime:s})}return e.clearRangeWithWait(n)},a.$OzMediaStream$p_68=function(t){return!1},a.$OzMediaStream$p_51=function(t){var e=this;if(o("oz-player/utils/OzErrorUtils").isOzError(t)&&t.getType()==="OZ_SOURCE_BUFFER_QUOTA_EXCEEDED"){this.emit("streamErrorRetry",o("oz-player/utils/OzErrorUtils").getOzErrorWithMIMEType(t,this.$OzMediaStream$p_21)),this.$OzMediaStream$p_26.handleEvent("append_quota_exceeded");var n=this.$OzMediaStream$p_67();n.then(function(){e.restartLoopBody()}).catch(function(t){var n=o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_STREAM_APPEND_QUOTA_EXCEEDED_HANDLER_ERROR",description:"Stream append quota exceeded: "+String(t),extra:{originalError:t,code:r("oz-player/utils/OzCustomErrorCode").STREAM_APPEND_QUOTA_EXCEEDED_HANDLER_ERROR}});e.$OzMediaStream$p_33.emitError(n)})}else{if(o("oz-player/utils/OzErrorUtils").isOzError(t)&&t.getType()==="OZ_CANCELLED")return;if(o("oz-player/utils/OzErrorUtils").isOzError(t)&&t.getType()==="OZ_SOURCE_BUFFER_CHANGE_TYPE")this.$OzMediaStream$p_33.emitError(t);else if(o("oz-player/utils/OzErrorUtils").isOzError(t)&&t.getType()==="OZ_SOURCE_BUFFER_CHANGE_TYPE_UNAVAILABLE")this.$OzMediaStream$p_33.emitError(t);else if(o("oz-player/utils/OzErrorUtils").isOzError(t)&&t.getType()==="OZ_WEBVTT_CAPTION_PARSE_ERROR"){var a;r("oz-player/shims/ozReportUnexpectedError")(t,"OzMediaStream append error callback: OZ_WEBVTT_CAPTION_PARSE_ERROR branch","warn"),(a=this.$OzMediaStream$p_45)==null||a.emitError(t)}else r("oz-player/shims/ozReportUnexpectedError")(t,"OzMediaStream append error callback","warn"),this.$OzMediaStream$p_68(t)&&this.$OzMediaStream$p_33.emitError(t)}},a.$OzMediaStream$p_62=function(t,n,r){var e=0;if(this.$OzMediaStream$p_43)return 1/0;var o=this.$OzMediaStream$p_1.getNumber("appends_per_segment");if(o>0){var a=t.getByteRange(),i=n.getByteRange();a&&i&&i.endByte!=null&&(e=Math.ceil((i.endByte-a.startByte+1)/(r*o)))}return e===0&&(e=this.$OzMediaStream$p_1.getNumber("append_byte_target_without_range")),e},a.getIsAdaptationEnabled=function(){return this.$OzMediaStream$p_29},a.enableAdaptation=function(){this.$OzMediaStream$p_29=!0},a.disableAdaptation=function(){this.$OzMediaStream$p_29=!1},a.destroy=function(){this.$OzMediaStream$p_23.stop(),this.$OzMediaStream$p_5.then(function(e){e.destroy()},function(){}).catch(function(e){r("oz-player/shims/ozReportUnexpectedError")(e,"OzMediaStream SBM promise then - destroy")}),this.$OzMediaStream$p_30.destroy(),this.$OzMediaStream$p_17.release(),this.$OzMediaStream$p_17.engage(),this.removeAllListeners(),this.$OzMediaStream$p_20&&(this.$OzMediaStream$p_20.remove(),this.$OzMediaStream$p_20=null)},a.getRepresentationIDAtTime=function(t){var e=this.$OzMediaStream$p_25.get(t);if(!e){var n=this.$OzMediaStream$p_8.getTimeRanges(),r=n[n.length-1],o=.001;r&&t>=r.endTime&&t<=this.$OzMediaStream$p_7.getDuration()+o&&(e=this.$OzMediaStream$p_25.get(r.endTime-o))}return e?e.id:null},a.endStream=function(t){var e;(e=this.$OzMediaStream$p_14)==null||e.notifyMediaStreamEnded(this,t),this.$OzMediaStream$p_69()},a.endStreamIfBufferedToEndTime=function(){var e=this.$OzMediaStream$p_8.getTimeRanges();if(e.length>0){var t=e[e.length-1].endTime;if(this.$OzMediaStream$p_6){var n=this.$OzMediaStream$p_6.getSourceBufferState().getBufferedRanges();n.length>0&&Math.abs(n[n.length-1].endTime-t)<s&&this.endStream("buffered_to_end_time")}}},a.$OzMediaStream$p_60=function(t,n){var e,r;return{type:this.$OzMediaStream$p_21.indexOf("audio")===0?u.AUDIO:this.$OzMediaStream$p_21.indexOf("video")===0?u.VIDEO:u.CAPTION,segment:t,sourceBuffer:(e=(r=this.$OzMediaStream$p_6)==null||(r=r.getDebug())==null?void 0:r.SourceBuffer)!=null?e:null,timeRange:n}},a.$OzMediaStream$p_48=function(){this.$OzMediaStream$p_9=null},a.restartLoopBody=function(){this.$OzMediaStream$p_48(),this.$OzMediaStream$p_31=!1,this.$OzMediaStream$p_13&&this.$OzMediaStream$p_13.cancel(),this.$OzMediaStream$p_22!==0&&this.$OzMediaStream$p_24&&this.$OzMediaStream$p_24.resolve()},a.$OzMediaStream$p_69=function(){if(this.$OzMediaStream$p_6){var e=this.$OzMediaStream$p_6.getSourceBufferState().getBufferedRanges();e.length>0&&(this.$OzMediaStream$p_32=e[e.length-1].endTime)}},a.$OzMediaStream$p_56=function(){return this.$OzMediaStream$p_32!==null},a.$OzMediaStream$p_49=function(t){this.$OzMediaStream$p_8.getID()===t&&this.$OzMediaStream$p_16!=null&&this.$OzMediaStream$p_50(this.$OzMediaStream$p_16.getBestRepresentation())},a.setEnableLiveheadCatchup=function(t){this.$OzMediaStream$p_35=t},a.clearSourceBufferRange=function(t,n){var e=this.$OzMediaStream$p_6;return e?e.clearRangeWithWait([{fromTime:t,toTime:n}]):r("oz-player/shims/OzMaybeNativePromise").resolve()},a.getDebug=function(){return{SourceBufferManager:this.$OzMediaStream$p_6,MediaStreamAbrManager:this.$OzMediaStream$p_16}},n})(r("oz-player/shims/OzEventEmitter"));l.default=c}),98);
__d("oz-player/streams/OzPredictedSegmentLocator",["oz-player/streams/OzSegmentLocator","oz-player/streams/OzSegmentUtils","oz-player/utils/OzSourceBufferUtil"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=0;for(var r in e){var o;r!==t&&(n=Math.max(n,(o=e[r].lastSkippedToSegmentNumber)!=null?o:0))}return n}function s(e,t){var n=null;for(var r in e)r!==t&&e[r].inBufferAheadTimeSince!=null&&(n=n!=null?Math.min(n,e[r].inBufferAheadTimeSince):e[r].inBufferAheadTimeSince);return n}var u=(function(){function t(e){this.$5={};var t=e.dynamicVideoLibrary,n=e.liveLatencyManager,r=e.loggerProvider,o=e.videoNode;this.$1=o,this.$2=n,this.$3=r,this.$4=t}var n=t.prototype;return n.getSegment=function(t,n,r,o,a,i,l,s,u){var e,c;this.$5[u]==null&&(this.$5[u]={lastSkippedToSegmentNumber:null,inBufferAheadTimeSince:null}),(e=this.$2)==null||e.setEnableCatchup(s);var d=this.$6(t,n,r,o,a,i,l,s,u);(c=d.segment)==null||c.getOptions().setSegmentNumDecisionTime(Date.now()),d.segment===null&&this.$3.getOperationLogger("segment_locator").setInitiator(d.initiator).setReason(d.reason).setType(u).setUserInfo(d.userInfo).log();var m=this.$4;if(d.segment&&m!=null){var p=d.segment.getOptions();p.setIsDVLEnabled(m.shouldRequestDynamicInfo(u))}return d.segment},n.$6=function(n,r,a,i,l,u,c,d,m){var t,p,_,f,g,h=r.getCurrentTime(),y=this.$2==null?!1:this.$2.shouldEnableCursorBasedCatchup(),C=i!=null?o("oz-player/utils/OzSourceBufferUtil").getTotalBufferAheadOfPosition(i.getBufferedRanges(),r.getCurrentTime(),c):{bufferAheadSec:0,bufferedOffset:0},b=C.bufferAheadSec,v=C.bufferedOffset,S=null,R=null,L=this.$2?this.$2.enabled():!0,E=n.getPredictedSegmentAfter(l),k=o("oz-player/streams/OzSegmentUtils").getSegmentForSequenceNumber(n,c.getNumber("pdash_download_cursor_between_catchups_seg")>0?e(this.$5):e(this.$5,m)),I=!0,T=null;if(y&&d&&((t=E)==null?void 0:t.getSequenceNumber())!=null&&((p=(_=E)==null?void 0:_.getSequenceNumber())!=null?p:0)<=((f=k==null?void 0:k.getSequenceNumber())!=null?f:0)){var D,x,$;E=k,S="paired_catchup",this.$3.getOperationLogger("segment_locator").setInitiator(S).setUserInfo({bufferAheadSec:String(b),bufferedOffset:String(v)}).setLength(((D=k==null?void 0:k.getSequenceNumber())!=null?D:0)-((x=($=E)==null?void 0:$.getSequenceNumber())!=null?x:0)).setType(m).log(),I=!1,T=S}else if(y&&d&&L&&E!=null&&(g=this.$2)!=null&&g.isBehindPreferredLiveHeadLatencyWithTolerance()){var P,N;if(this.$2&&b>this.$2.getPreferredLiveHeadLatencySec()&&v==0)return{segment:null,initiator:"catchup_pause",userInfo:{bufferAheadSec:String(b),bufferedOffset:String(v)}};var M=n.getEndingSegment(),w=o("oz-player/streams/OzSegmentUtils").getMaxSegment([M,E]),A=c.getNumber("pdash_download_cursor_between_catchups_seg")===0||((P=k==null?void 0:k.getSequenceNumber())!=null?P:0)+c.getNumber("pdash_download_cursor_between_catchups_seg")<((N=M==null?void 0:M.getSequenceNumber())!=null?N:0);if(A){var F,O,B;if(((F=w==null?void 0:w.getSequenceNumber())!=null?F:0)>((O=(B=E)==null?void 0:B.getSequenceNumber())!=null?O:0)){var W,q,U,V;this.$5[m].lastSkippedToSegmentNumber=(W=w==null?void 0:w.getSequenceNumber())!=null?W:0,this.$3.getOperationLogger("segment_locator").setInitiator("catchup").setUserInfo({bufferAheadSec:String(b),bufferedOffset:String(v)}).setLength(((q=w==null?void 0:w.getSequenceNumber())!=null?q:0)-((U=(V=E)==null?void 0:V.getSequenceNumber())!=null?U:0)).setType(m).log()}E=w,S="catchup",I=!1,T=S}}else if(l==null){var H,G;E=n.getSegmentByTime(h),S="1st_run";var z=n.getTimeRanges();R={approx:String(n.canApproximateId()),ranges:String(z.length),mpdStartTime:z.length>0?String(z[z.length-1].startTime):null,mpdEndTime:z.length>0?String(z[z.length-1].endTime):null},this.$5[m].lastSkippedToSegmentNumber=(H=(G=E)==null?void 0:G.getSequenceNumber())!=null?H:0}if(I&&(I=L,T="stream_state"),I&&b>a)return this.$5[m].inBufferAheadTimeSince==null&&(this.$5[m].inBufferAheadTimeSince=Date.now()),{segment:null,initiator:"buffer_ahead_rule",userInfo:{bufferAheadSec:String(b),bufferedOffset:String(v),lastMaxSegNum:String(e(this.$5,m)),segment:E?String(E.getSequenceNumber()):null,computedBufferAheadTarget:String(a)}};!I&&b>a&&this.$3.getOperationLogger("segment_locator").setUserInfo({bufferAheadSec:String(b),bufferedOffset:String(v),computedBufferAheadTarget:String(a)}).setReason("disabled_buffer_ahead_rule:"+(T||"")).setType(m).log();var j=u&&u.getSequenceNumber()||0,K=E&&E.getSequenceNumber()||0;if(E&&u&&j>=K){var Q=o("oz-player/streams/OzSegmentLocator").getEndingSequenceNumber(n);return(Q||0)>=j?{segment:u}:{segment:null,initiator:"mpd_refresh",userInfo:{leSegNum:String(j)}}}var X=i?o("oz-player/utils/OzSourceBufferUtil").getTotalInBufferedRanges(i.getBufferedRanges()):0,Y=i?o("oz-player/utils/OzSourceBufferUtil").getTotalBufferAheadOfPosition(i.getBufferedRanges(),r.getCurrentTime(),c).bufferAheadSec:0,J=s(this.$5,m),Z=Date.now();if(c.getNumber("download_cursor_total_buffer_max_sec")!=0&&c.getNumber("download_cursor_total_buffer_max_sec")<Y||c.getNumber("download_cursor_buffer_ahead_time_max_sec")!=0&&J!=null&&c.getNumber("download_cursor_buffer_ahead_time_max_sec")<(Z-J)/1e3){var ee,te;this.$5[m].lastSkippedToSegmentNumber=(ee=(te=E)==null?void 0:te.getSequenceNumber())!=null?ee:0,this.$3.getOperationLogger("segment_locator").setUserInfo({bufferAheadSec:String(b),bufferedOffset:String(v),totalBufferedSec:String(X),computedBufferAheadTarget:String(a),inBufferAheadElapsedTime:String((Z-(J!=null?J:0))/1e3)}).setReason("force_paired_catchup").setType(m).log()}return this.$5[m].inBufferAheadTimeSince=null,{segment:E,initiator:S||void 0,userInfo:R||void 0}},t})();l.OzPredictedSegmentLocator=u}),98);
__d("oz-player/utils/getRepresentationInCache",["oz-player/networks/RequestParamCreator"],(function(t,n,r,o,a,i,l){"use strict";var e=new(r("oz-player/networks/RequestParamCreator"));function s(t,n){return n===void 0&&(n=null),t.find(function(t){var r=t.getInitSegment(),o=r&&r.getByteRange();return r&&o&&n?n.hasCacheValue(e.createRequestParam(r.getURI(),o,"auto").uri.toString()):!1})||null}l.default=s}),98);
__d("oz-player/Player",["Promise","oz-player/configs/OzPlayerConfig","oz-player/drm/OzDrmManager","oz-player/loggings/OzDevConsolePerfLogger","oz-player/loggings/OzLoggingUtils","oz-player/loggings/OzMultiDestinationPerfLogger","oz-player/loggings/OzOperationLoggerObserver","oz-player/manifests/OzDynamicVideoLibrary","oz-player/manifests/OzVideoRepresentation","oz-player/media_source/MediaSourceManager","oz-player/media_source/OzMediaSeekableRangeManager","oz-player/networks/OzBandwidthEstimator","oz-player/networks/OzClientClock","oz-player/networks/OzNetworkManager","oz-player/parsers/OzMpdParser","oz-player/parsers/OzMpdUpdater","oz-player/parsers/OzXmlParserImplDOMParser","oz-player/playback_controls/OzClearSourceBufferOnSeekManager","oz-player/playback_controls/OzLiveLatencyManager","oz-player/playback_controls/OzPlaybackTimeRangeManager","oz-player/playback_controls/OzPlayheadManager","oz-player/shims/OzEventEmitter","oz-player/shims/OzMaybeNativePromise","oz-player/shims/OzPerformance","oz-player/shims/OzSubscriptionsHandler","oz-player/shims/OzUuid","oz-player/shims/ozClearTimeout","oz-player/shims/ozReportUnexpectedError","oz-player/shims/ozSetTimeoutAcrossTransitions","oz-player/shims/ozvariant","oz-player/states/OzObservedPlaybackState","oz-player/states/OzPositionToViewport","oz-player/strategies/OzAbrManager","oz-player/strategies/OzBandwidthBoundaryStreamSegmentsCountStrategy","oz-player/strategies/OzBlockedRepresentationsManager","oz-player/strategies/OzBufferAheadPriorityStrategy","oz-player/strategies/OzBufferAheadTargetStrategy","oz-player/strategies/OzBufferEndLimitStrategy","oz-player/strategies/OzBufferTargetBoundedStreamSegmentsCountStrategy","oz-player/strategies/OzBufferTargetCalculator","oz-player/strategies/OzBufferTargetCalculatorQuotaExceededConstraint","oz-player/strategies/OzBufferingDetector","oz-player/strategies/OzPausedStreamSegmentsCountStrategy","oz-player/strategies/OzPlayheadAtInterruptionDetector","oz-player/strategies/OzPlayingStatePriorityStrategy","oz-player/strategies/OzPositionToViewportPriorityStrategy","oz-player/strategies/OzPriorityCalculator","oz-player/strategies/OzSingleCodecRestriction","oz-player/strategies/OzStaleManifestBufferTargetStrategy","oz-player/strategies/OzStartupBufferTargetStrategy","oz-player/strategies/OzStaticStreamSegmentsStrategy","oz-player/strategies/OzStreamSegmentsCountCalculator","oz-player/strategies/OzSupportedMimeCodecsRestriction","oz-player/streams/OzEndOfStreamWatcher","oz-player/streams/OzHandleUserRepresentationSwitch","oz-player/streams/OzMediaStream","oz-player/streams/OzPredictedSegmentLocator","oz-player/utils/OzCustomErrorCode","oz-player/utils/OzErrorEmitter","oz-player/utils/OzErrorUtils","oz-player/utils/OzIbrUtils","oz-player/utils/OzMimeUtil","oz-player/utils/OzMpdUtils","oz-player/utils/OzPlaybackRestrictionsUtils","oz-player/utils/OzReadableStreamUtils","oz-player/utils/getRepresentationInCache"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){return e||r("oz-player/shims/ozvariant")(0,21876),e}var u="av01",c="vp09",d="avc1",m=(function(t){function a(e){var n;n=t.call(this)||this,n.$Player$p_5=new Map,n.$Player$p_6=new Map,n.$Player$p_9=void 0,n.$Player$p_10=new(r("oz-player/shims/OzSubscriptionsHandler")),n.$Player$p_11=new(r("oz-player/utils/OzErrorEmitter")),n.$Player$p_12=new(r("oz-player/utils/OzErrorEmitter")),n.$Player$p_19=void 0,n.$Player$p_25=[],n.$Player$p_26=void 0,n.$Player$p_27=void 0,n.$Player$p_32=null,n.$Player$p_33=null,n.$Player$p_43=null,n.$Player$p_51=!1,n.$Player$p_54=0,n.$Player$p_55=null,n.$Player$p_56=null,n.$Player$p_57=0,n.$Player$p_58=null,n.$Player$p_59=null,n.$Player$p_60=!1,n.$Player$p_63=null,n.$Player$p_64=null,n.$Player$p_70=!1,n.$Player$p_71=!1,n.$Player$p_76=!1,n.$Player$p_77=null,n.$Player$p_78=!1,n.$Player$p_89=function(){var e=new(r("oz-player/parsers/OzXmlParserImplDOMParser"));return e},n.$Player$p_91=function(){n.$Player$p_5.forEach(function(e){return e.endStreamIfBufferedToEndTime()})},n.$Player$p_92=function(){n.$Player$p_5.forEach(function(e){return e.endStream("streamGone")})};var a=e.audioOnly,i=a===void 0?!1:a,l=e.bufferingDetector,s=e.videoNode,u=e.config,c=e.configMap,d=e.rawMpdXml,m=e.mpdUrl,p=m===void 0?null:m,_=e.loggerConfig,f=_===void 0?{perfLoggerProviders:[],observedOperationLoggers:[],isOzDevConsoleEnabled:!1}:_,g=e.bandwidthEstimatorOverride,h=g===void 0?null:g,y=e.customVTTBufferTargetStrategies,C=y===void 0?null:y,b=e.shouldBlockStatusCode5xx,v=b===void 0?!1:b,S=e.prefetchCache,R=S===void 0?null:S,L=e.getOverrideOzRequestImplementation,E=L===void 0?null:L,k=e.getUserSelectedPlaybackRate,I=e.networkRequestStreamHandlers,T=e.networkRequestStreamRetryHandler,D=e.networkRequestUrlRefreshHandler,x=e.getShouldIncludeCredentials,$=x===void 0?null:x,P=e.getCustomRequestParametersForURI,N=P===void 0?null:P,M=e.initialRepresentationIDs,w=M===void 0?[]:M,A=e.debugCreateInitiator,F=A===void 0?null:A,O=e.customParsers,B=O===void 0?new Map:O,W=e.videoPlaybackRestrictions,q=W===void 0?[]:W,U=e.customSegmentTimelineParser,V=U===void 0?null:U,H=e.customRepresentationParsers,G=H===void 0?{}:H,z=e.networkRequestFetchPriority,j=z===void 0?"auto":z,K=e.videoAbrManagerFactory,Q=K===void 0?null:K,X=e.seekHandler,Y=X===void 0?null:X,J=e.initialPlaybackPositionForDynamicMpd,Z=J===void 0?-20:J,ee=e.liveheadFallBehindBlockThreshold,te=ee===void 0?30:ee,ne=e.liveheadFallBehindBlockMargin,re=ne===void 0?5.9:ne,oe=e.startTimeStamp,ae=oe===void 0?0:oe,ie=e.drmProviders,le=ie===void 0?[]:ie,se=e.getVideoDimensions,ue=se===void 0?null:se,ce=e.setCustomFetchStreamLoggingAttributes,de=ce===void 0?null:ce,me=e.bufferEndLimit,pe=me===void 0?null:me,_e=e.configureCustomRequestParametersForSegment,fe=_e===void 0?null:_e,ge=e.isClientTriggeredTraceEnabled,he=ge===void 0?!1:ge,ye=e.enableImmediateQualityDownSwitch,Ce=ye===void 0?!1:ye,be=e.userPreferenceLang,ve=be===void 0?null:be,Se=e.initiateLivePlaybackFromStart,Re=Se===void 0?!1:Se;n.$Player$p_1=C,n.$Player$p_49=F;var Le=f.observedOperationLoggers,Ee=f.perfLoggerProviders,ke=f.isOzDevConsoleEnabled;if(n.$Player$p_17=ke||!1,n.$Player$p_16=new(o("oz-player/loggings/OzMultiDestinationPerfLogger")).OzMultiDestinationPerfLoggerProvider(n.$Player$p_79().concat(Ee)),n.$Player$p_2=i,n.$Player$p_4=u!=null?u:new(r("oz-player/configs/OzPlayerConfig"))(c!=null?c:{}),n.$Player$p_78=n.$Player$p_4.getBool("enable_managed_media_source")&&!!window.ManagedMediaSource,n.$Player$p_75=n.$Player$p_78?"changeType"in window.ManagedSourceBuffer.prototype:"changeType"in window.SourceBuffer.prototype,n.$Player$p_12.onError(function(){}),n.$Player$p_22=new(r("oz-player/loggings/OzOperationLoggerObserver")),n.$Player$p_22.observe(Le,n.$Player$p_16),n.$Player$p_16.getOperationLogger("player_initialization").setInitiator("player-"+r("oz-player/shims/OzUuid")()).log(),n.$Player$p_53=E,n.$Player$p_28=B,n.$Player$p_67=new(r("oz-player/strategies/OzBlockedRepresentationsManager"))(n.$Player$p_4,v),n.$Player$p_10.addSubscriptions(n.$Player$p_67.onRepresentationBlocked(function(e){n.emit("representationBlocked",e)})),n.$Player$p_31=[n.$Player$p_67,new(r("oz-player/strategies/OzSupportedMimeCodecsRestriction"))(n.$Player$p_78)].concat(q),n.$Player$p_75||n.$Player$p_31.push(new(r("oz-player/strategies/OzSingleCodecRestriction"))),n.$Player$p_29=G,n.$Player$p_30=V,n.$Player$p_35=Q,n.$Player$p_36=Y,n.$Player$p_37=ae,n.$Player$p_38=Re?ae:Z,n.$Player$p_41=k!=null?k:function(){return 1},n.$Player$p_39=te,n.$Player$p_42=re,n.$Player$p_66=pe,n.$Player$p_69=he,n.$Player$p_71=Ce,n.$Player$p_47=le,n.$Player$p_63=de,n.$Player$p_3=s,n.$Player$p_7=new(r("oz-player/media_source/MediaSourceManager"))({videoNode:n.$Player$p_3,config:n.$Player$p_4,perfLoggerProvider:n.$Player$p_16,isChangeTypeSupported:n.$Player$p_75,useManagedMediaSource:n.$Player$p_78,handleVttCaptionsUpdated:function(t){var e,r=(e=n.$Player$p_5.get("caption"))==null||(e=e.getCurrentRepresentation())==null?void 0:e.getLang();n.emit("vttCaptionsUpdated",t,r)},onClearVideoNodeError:function(){n.$Player$p_80()},onRetryVideoElementError:function(t){n.emit("videoNodeErrorRetry",t)}}),n.$Player$p_7.onError(function(e){n.$Player$p_11.emitError(e)}),n.$Player$p_4.getBool("clear_on_seek")){var Ie=new(r("oz-player/playback_controls/OzClearSourceBufferOnSeekManager"))(n.$Player$p_3,n.$Player$p_4,n.$Player$p_5,n.$Player$p_16);Ie.maybeOverwriteVideoCurrentTimeProperty(),n.$Player$p_10.addSubscriptions(Ie.onError(n.$Player$p_11.emitError)),n.$Player$p_64=Ie}n.$Player$p_24=R;var Te=n.$Player$p_24&&n.$Player$p_24.getCachedRepresentations();return n.$Player$p_25=Te||w,n.$Player$p_65=new(r("oz-player/manifests/OzDynamicVideoLibrary"))({config:n.$Player$p_4}),n.$Player$p_44=I,n.$Player$p_45=$,n.$Player$p_46=N,n.$Player$p_68=fe,n.$Player$p_77=h!=null?h:r("oz-player/networks/OzBandwidthEstimator"),n.$Player$p_13=new(r("oz-player/networks/OzNetworkManager"))({config:n.$Player$p_4,prefetchCache:n.$Player$p_24,networkRequestStreamHandlers:n.$Player$p_44,getOverrideOzRequestImplementation:n.$Player$p_53,getShouldIncludeCredentials:n.$Player$p_45,getCustomRequestParametersForURI:n.$Player$p_46,networkRequestFetchPriority:j,networkRequestStreamRetryHandler:T,networkRequestUrlRefreshHandler:D,setCustomFetchStreamLoggingAttributes:n.$Player$p_63,dynamicVideoLibrary:n.$Player$p_65,configureCustomRequestParametersForSegment:n.$Player$p_68,onResourceTimingBufferFull:function(){n.$Player$p_81()},bandwidthEstimator:n.$Player$p_77}),n.$Player$p_18=p,n.$Player$p_8=d,n.$Player$p_14=new(r("oz-player/states/OzObservedPlaybackState"))(n.$Player$p_4,n.$Player$p_3,n.$Player$p_16),n.$Player$p_52=ue,n.$Player$p_15=new(r("oz-player/streams/OzEndOfStreamWatcher"))(n.$Player$p_7,n.$Player$p_4),n.$Player$p_10.addSubscriptions(n.$Player$p_15.addListener("streamEnd",function(){n.$Player$p_51=!0,n.emit("streamEnd")})),n.$Player$p_50=l!=null?l:n.$Player$p_82(),n.$Player$p_4.getNumber("pixels_below_viewport_to_observe")>0&&(n.$Player$p_61=new(r("oz-player/states/OzPositionToViewport"))(n.$Player$p_3,n.$Player$p_4)),n.$Player$p_72=ve,n.$Player$p_73=null,n.$Player$p_74={lang:null,role:null},n}babelHelpers.inheritsLoose(a,t);var i=a.prototype;return i.$Player$p_81=function(){this.$Player$p_70||(r("oz-player/shims/ozReportUnexpectedError")(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_JAVASCRIPT_NATIVE",description:"ResourceTiming buffer is full"}),"ResourceTiming buffer is full","warn"),this.$Player$p_70=!0)},i.$Player$p_83=function(t){var e=this;this.$Player$p_84();var n=o("oz-player/loggings/OzLoggingUtils").executeOperationAndLog(this.$Player$p_16.cloneContext().setInitiator(this.$Player$p_49),"parse_manifest",function(n){var r,a,i=e.$Player$p_85(t),l=String((r=i.getCustomField("currentServerTimeMs"))!=null?r:""),s=String((a=i.getCustomField("lastVideoFrameTs"))!=null?a:""),u={currentServerTimeMs:l,ingestLastVideoFrameTs:s,nowMs:String(Date.now())},c=o("oz-player/utils/OzMpdUtils").getMpdLastTimeRange(i,e.$Player$p_4),d=c&&c.endTime!=0?c.endTime:null;return n.setLiveheadPosition(d).setLiveheadSeqNumMpd(o("oz-player/utils/OzMpdUtils").getMpdLastSequenceNumber(i)).setManifestType(i.isStaticMpd()?"static":"dynamic").setIsMixedCodecManifest(e.$Player$p_76).setIsTemplatedManifest(!!i.getCustomField("isLiveTemplated")).setUserInfo(u),i});this.$Player$p_86(n)},i.$Player$p_86=function(t){var e=this,n,a;if(this.$Player$p_9=s(t),this.$Player$p_4.getBool("player_emit_mpdparsed_early")&&this.emit("mpdParsed",t),this.$Player$p_26=this.$Player$p_87(),this.$Player$p_27=this.$Player$p_88(),this.$Player$p_67.setAvailableRepresentationsCount(t.getVideoRepresentations().length),this.$Player$p_18!=null){var i=new(r("oz-player/parsers/OzMpdUpdater"))(this.$Player$p_4,t,this.$Player$p_13,this.$Player$p_14,this.$Player$p_16,{mpdUrl:null,createXmlParser:this.$Player$p_89,customParsers:this.$Player$p_28,customRepresentationParsers:this.$Player$p_29,customSegmentTimelineParser:this.$Player$p_30},this.$Player$p_48,this.$Player$p_69,this.$Player$p_78);this.$Player$p_90(i),this.$Player$p_10.addSubscriptions(i.onError(this.$Player$p_11.emitError),i.addListener("manifestFetchError",function(t){return e.emit("manifestFetchError",t)}),i.addListener("manifestFetchErrorRetry",function(t){return e.emit("manifestFetchErrorRetry",t)}),i.addListener("streamTransitionToStatic",this.$Player$p_91),i.addListener("streamGone",this.$Player$p_92)),i.setupUpdateLoop(),this.$Player$p_21=i}this.$Player$p_4.getBool("use_live_latency_manager")?t.isStaticMpd()?this.$Player$p_37=this.$Player$p_37:(this.$Player$p_40=new(r("oz-player/playback_controls/OzLiveLatencyManager"))({config:this.$Player$p_4,mpd:t,playbackState:this.$Player$p_14,bufferingDetector:this.$Player$p_50,video:this.$Player$p_3,loggerProvider:this.$Player$p_16,getUserSelectedPlaybackRate:this.$Player$p_41}),this.$Player$p_37=this.$Player$p_40.getPreferredLiveHeadLatencySec()*-1):this.$Player$p_37=t.isStaticMpd()?this.$Player$p_37:this.$Player$p_93(t),this.$Player$p_19=new(r("oz-player/playback_controls/OzPlayheadManager"))({video:this.$Player$p_3,mpd:t,dynamicVideoLibrary:this.$Player$p_65,playheadCatchup:this.$Player$p_34,playbackState:this.$Player$p_14,config:this.$Player$p_4,perfLoggerProvider:this.$Player$p_16,seekHandler:this.$Player$p_36,initialPlaybackPosition:this.$Player$p_37,canSupportSkipVideobufferGaps:(n=(a=this.$Player$p_64)==null?void 0:a.getCurrentTimePropertyOverwriteSuccess())!=null?n:!1,liveLatencyManager:this.$Player$p_40}),this.$Player$p_20=new(r("oz-player/playback_controls/OzPlaybackTimeRangeManager"))({config:this.$Player$p_4,video:this.$Player$p_3,mpd:t,liveheadFallBehindBlockThreshold:this.$Player$p_39,liveheadFallBehindBlockMargin:this.$Player$p_42,playbackState:this.$Player$p_14,perfLoggerProvider:this.$Player$p_16}),this.$Player$p_94().catch(function(t){var n=o("oz-player/utils/OzErrorUtils").isOzError(t)?t:null;e.$Player$p_11.emitError(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_INITIALIZATION",description:"Failed to setup streams: "+String(t),extra:babelHelpers.extends({},n==null?void 0:n.getExtra(),{originalError:t,code:r("oz-player/utils/OzCustomErrorCode").SETUP_STREAMS_PROMISE_REJECTION.toString()})}))}),this.emit("mpdReady",t)},i.load=function(t){var e=this;this.$Player$p_18=t;try{var n=this.$Player$p_8;n!=null?this.$Player$p_83(n):t!=null?this.$Player$p_95(t).then(function(t){if(e.$Player$p_60){e.$Player$p_60=!1,e.load(e.$Player$p_18);return}e.$Player$p_8=t,e.$Player$p_54=0,e.$Player$p_83(t)}).catch(function(n){if(e.$Player$p_60){e.$Player$p_60=!1,e.load(e.$Player$p_18);return}var r=o("oz-player/utils/OzErrorUtils").isOzError(n)?n:null,a=o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_INITIALIZATION",description:"Failed to setup player with fetched MPD: "+String(n),extra:babelHelpers.extends({},r==null?void 0:r.getExtra(),{originalError:n,url:t})});e.$Player$p_96(a,t)}):this.$Player$p_11.emitError(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_INITIALIZATION",description:"Cannot start Oz without a raw mpd xml or mpd url"}))}catch(e){var r=o("oz-player/utils/OzErrorUtils").isOzError(e)?e:null;this.$Player$p_11.emitError(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_INITIALIZATION",description:"Failed to setup player: "+String(e),extra:babelHelpers.extends({},r==null?void 0:r.getExtra(),{originalError:e})}))}},i.$Player$p_93=function(t){var e,n,r=(e=t.getVideoRepresentations()[0].getMaxGopSec())!=null?e:0,o=(n=t.getVideoRepresentations()[0].getEndingSegment())==null?void 0:n.getTimeRange(),a=o!=null?o.endTime-o.startTime:0;return a>0&&(r=a),Math.min(this.$Player$p_38+this.$Player$p_4.getNumber("dynamic_mpd_initial_playback_position_offset_modifier"),-1*r*this.$Player$p_4.getNumber("pdash_download_cursor_catchup_threshold_gop_multiplier"))},i.$Player$p_95=function(t){this.$Player$p_54++;var e=this.$Player$p_13.requestRawUrl({debugName:"OzPlayer/fetchMpdXml/mpd",url:t,options:null,loggerProvider:this.$Player$p_16}),n=e.getStream().getReader();return o("oz-player/utils/OzReadableStreamUtils").pumpString(n)},i.$Player$p_97=function(){this.$Player$p_55!=null&&(r("oz-player/shims/ozClearTimeout")(this.$Player$p_55),this.$Player$p_55=null)},i.$Player$p_96=function(t,n){var e=this,o=!0,a=this.$Player$p_54-1,i=t.getExtra().code;this.$Player$p_56!==i?(this.$Player$p_56=i,this.$Player$p_57=1):this.$Player$p_57++;var l=function(){o=!1},s={endStream:function(){l(),e.$Player$p_51=!0,e.emit("streamGoneBeforeStart")},consecutiveFailuresForErrorCode:this.$Player$p_57,error:t,isInitialRequest:!0,retry:function(o){l(),e.$Player$p_97(),e.$Player$p_55=r("oz-player/shims/ozSetTimeoutAcrossTransitions")(function(){e.$Player$p_97(),e.load(n)},(o==null?void 0:o.waitMs)!=null?o==null?void 0:o.waitMs:1e3)},retryAttemptCount:a};this.$Player$p_4.getNumber("initial_manifest_request_retry_count")>0&&this.emit("manifestFetchError",s),o&&this.$Player$p_11.emitError(t)},i.updatePlayerRunTimeConfig=function(t){var e=t.applicationStreamDataHandler,n=t.audioStreamDataHandler,r=t.manifestUrl,o=t.resetStreamAnchor,a=t.videoStreamDataHandler;if(a!==void 0){var i=this.$Player$p_5.get("video");i&&i.updateRunTimeConfigs({streamDataHandler:a})}if(o!==void 0){var l,s=this.$Player$p_5.get("video");s&&s.updateRunTimeConfigs({resetStreamAnchor:o});var u=this.$Player$p_5.get("audio");u&&u.updateRunTimeConfigs({resetStreamAnchor:o}),(l=this.$Player$p_19)==null||l.resetCurrentTime()}if(n!==void 0){var c=this.$Player$p_5.get("audio");c&&c.updateRunTimeConfigs({streamDataHandler:n})}if(e!==void 0){var d=this.$Player$p_5.get("caption");d&&d.updateRunTimeConfigs({streamDataHandler:e,resetStreamAnchor:o})}r!=null&&r!==""&&this.$Player$p_98(r)},i.$Player$p_99=function(t,n){var e=this,r=t.getMimeCodecs(),a=this.$Player$p_7.createSourceBufferManager(n+"/"+t.getMimeType()+"/"+t.getCodecs(),r,n,t.getInitSegment().getData());this.$Player$p_100(a,n,t);var i=a.then(function(t){return e.$Player$p_50&&n!=="caption"&&e.$Player$p_50.setSourceBufferState(n,t.getSourceBufferState()),t});return o("oz-player/loggings/OzLoggingUtils").monitorPromiseAndLogOperation(i,this.$Player$p_16,"source_attach",function(e){e.setType(n)}),i.then(function(t){if(n!=="caption"){var r;(r=e.$Player$p_19)==null||r.observeSourceBufferState(t.getSourceBufferState(),n)}})},i.isDrm=function(){var e=this.$Player$p_48;if(e!=null){var t=e.hasContentProtections();return t!=null?t:!1}return!1},i.$Player$p_84=function(){var e=this.$Player$p_47;if(e.length>0){var t=this.$Player$p_48=new(o("oz-player/drm/OzDrmManager")).OzDrmManager(this.$Player$p_16,this.$Player$p_3,{maxStartEMEAttempts:this.$Player$p_4.getNumber("max_start_eme_attempts"),throwNoLicenseError:!0});e.forEach(function(e){t.addProvider(e)}),this.$Player$p_10.addSubscriptions(t.onError(this.$Player$p_11.emitError))}},i.$Player$p_101=function(t){var e=this,n=s(this.$Player$p_9),o=[this.$Player$p_4,t,this.$Player$p_102(),this.$Player$p_31,this.$Player$p_14,window.devicePixelRatio||1,function(){return e.$Player$p_103()},n.isStaticMpd()?"static":"dynamic",this.$Player$p_16],a=this.$Player$p_35&&this.$Player$p_35.apply(this,o);return a!=null?a:babelHelpers.construct(r("oz-player/strategies/OzAbrManager"),o)},i.$Player$p_104=function(t){return t==="caption"},i.$Player$p_100=function(t,n,a){var e=this,i=s(this.$Player$p_9),l=this.$Player$p_6.get(n),u=new(r("oz-player/streams/OzMediaStream"))({config:this.$Player$p_4,sourceBufferManagerPromise:t,networkManager:this.$Player$p_13,playbackState:this.$Player$p_14,endOfStreamWatcher:n!=="caption"?this.$Player$p_15:null,bufferTargetCalculator:this.$Player$p_105(n),priorityCalculator:this.$Player$p_106(),streamSegmentsCountCalculator:this.$Player$p_107(n),abrManager:l,representation:a,loggerProvider:this.$Player$p_16.cloneContext().setType(n),segmentLocator:this.$Player$p_62,setCustomFetchStreamLoggingAttributes:this.$Player$p_63,blockedRepresentationsManager:this.$Player$p_67,dynamicVideoLibrary:this.$Player$p_65,shouldAppendOncePerStream:this.$Player$p_104(n),mediaStreamType:n,warningEmitter:this.$Player$p_12,mpd:i});this.$Player$p_37===0?u.start():(s(this.$Player$p_9),this.$Player$p_19&&this.$Player$p_10.addSubscriptions(this.$Player$p_19.addListener("initialPlaybackPositionSet",function(){u.start()}))),this.$Player$p_10.addSubscriptions(u.onError(this.$Player$p_11.emitError)),this.$Player$p_23&&this.$Player$p_10.addSubscriptions(this.$Player$p_23.listenToMediaStreamInitAppended(u)),n==="video"&&(this.$Player$p_33=new(r("oz-player/streams/OzHandleUserRepresentationSwitch"))(this.$Player$p_4,this.$Player$p_14,o("oz-player/utils/OzPlaybackRestrictionsUtils").applyVideoPlaybackRestrictions(this.$Player$p_31,this.$Player$p_103(),this.$Player$p_102()),u,t,this.$Player$p_71),this.$Player$p_10.addSubscriptions(this.$Player$p_33.onError(this.$Player$p_11.emitError))),this.$Player$p_5.set(n,u),this.$Player$p_10.addSubscriptions(u.addListener("switchRepresentation",function(){var t,r,o,a=u.getCurrentRepresentation();(t=e.$Player$p_23)==null||t.setTimeRangeProvider(a),(r=e.$Player$p_19)==null||r.setTimeRangeProvider(a),(o=e.$Player$p_20)==null||o.setTimeRangeProvider(a),n==="video"&&e.emit("switchVideoRepresentation")}),u.addListener("SegmentAppended",function(t){e.$Player$p_108("SegmentAppended",t)}),u.addListener("streamError",function(t){e.emit("streamError",t)}),u.addListener("streamErrorRetry",function(t){e.emit("streamErrorRetry",t)}))},i.$Player$p_109=function(){return this.$Player$p_66!=null?[new(r("oz-player/strategies/OzBufferEndLimitStrategy"))(this.$Player$p_3,this.$Player$p_66)]:[new(r("oz-player/strategies/OzStaleManifestBufferTargetStrategy"))(s(this.$Player$p_9),this.$Player$p_4),new(r("oz-player/strategies/OzStartupBufferTargetStrategy"))(this.$Player$p_14,this.$Player$p_4),new(r("oz-player/strategies/OzBufferAheadTargetStrategy"))(this.$Player$p_4)]},i.$Player$p_110=function(){return this.$Player$p_66==null?[new(r("oz-player/strategies/OzBufferTargetCalculatorQuotaExceededConstraint"))({config:this.$Player$p_4,minimumBufferTargetSec:this.$Player$p_4.getNumber("buffer_target_constraint_minimum_sec")})]:[]},i.$Player$p_111=function(){return this.$Player$p_66==null?[new(r("oz-player/strategies/OzBufferTargetCalculatorQuotaExceededConstraint"))({config:this.$Player$p_4,minimumBufferTargetSec:0})]:[]},i.$Player$p_87=function(){return new(r("oz-player/strategies/OzBufferTargetCalculator"))(this.$Player$p_109(),this.$Player$p_110())},i.$Player$p_88=function(){return this.$Player$p_1!=null?new(r("oz-player/strategies/OzBufferTargetCalculator"))([].concat(this.$Player$p_1,this.$Player$p_109()),this.$Player$p_111()):this.$Player$p_87()},i.$Player$p_105=function(t){var e=t==="caption"?this.$Player$p_27:this.$Player$p_26;return e||r("oz-player/shims/ozvariant")(0,76764,t),e},i.$Player$p_90=function(t){var e=this;if(this.$Player$p_4.getNumber("stream_interrupt_check_mpd_stale_count_threshold")>0){var n=this.$Player$p_50,o=new(r("oz-player/strategies/OzPlayheadAtInterruptionDetector"))(this.$Player$p_3,n);this.$Player$p_10.addSubscriptions(o.addListener("playheadAtInterruption",function(t){e.$Player$p_16.getOperationLogger("stream_interrupted").log(),e.emit("streamInterruptAt",t)}),t.addListener("streamInterruptAt",function(t){var n;(n=e.$Player$p_50)==null||n.notifyStreamInterrupted(),o.notifyStreamInterrupted(t)}),t.addListener("streamResumedAt",function(t){var n;e.$Player$p_16.getOperationLogger("stream_resumed").log(),(n=e.$Player$p_50)==null||n.notifyStreamResumed(),o.notifyStreamResumed(),e.emit("streamResumedAt",t)})),this.$Player$p_32=o}},i.$Player$p_106=function(){var e=[new(r("oz-player/strategies/OzPlayingStatePriorityStrategy"))(this.$Player$p_14),new(r("oz-player/strategies/OzBufferAheadPriorityStrategy"))(this.$Player$p_4,this.$Player$p_14)].concat(this.$Player$p_4.getNumber("pixels_below_viewport_to_observe")>0&&this.$Player$p_61!=null?new(r("oz-player/strategies/OzPositionToViewportPriorityStrategy"))(this.$Player$p_61,this.$Player$p_4):[]);return new(r("oz-player/strategies/OzPriorityCalculator"))(e)},i.$Player$p_107=function(t){var e=[new(r("oz-player/strategies/OzStaticStreamSegmentsStrategy"))(this.$Player$p_4),new(r("oz-player/strategies/OzBufferTargetBoundedStreamSegmentsCountStrategy"))(this.$Player$p_105(t),this.$Player$p_4)];return this.$Player$p_4.getNumber("paused_stream_segments_count")!==0&&e.push(new(r("oz-player/strategies/OzPausedStreamSegmentsCountStrategy"))(this.$Player$p_14,this.$Player$p_4)),t==="video"&&e.push(new(r("oz-player/strategies/OzBandwidthBoundaryStreamSegmentsCountStrategy"))(this.$Player$p_4,this.$Player$p_102())),new(r("oz-player/strategies/OzStreamSegmentsCountCalculator"))(e)},i.onError=function(t){return this.$Player$p_11.onError(t)},i.onWarning=function(t){return this.$Player$p_12.onError(t)},i.getSelectedVideoQuality=function(){var e=this.$Player$p_9;if(!e||this.$Player$p_2)return null;var t=this.$Player$p_5.get("video"),n=t&&t.getCurrentRepresentation();if(n instanceof r("oz-player/manifests/OzVideoRepresentation"))return n.getDisplayLabel();var o=this.$Player$p_102(),a=o[0];return a?a.getDisplayLabel():null},i.getTargetAudioTrack=function(){var e=this.$Player$p_9;if(!e)return null;var t=this.$Player$p_5.get("audio"),n=t&&t.getCurrentRepresentation();if(n){var r;return{id:n.getID(),displayLabel:n.getDisplayLabel(),lang:(r=n.getLang())!=null?r:null,role:n.getRole(),mimeCodecs:n.getMimeCodecs(),variantKey:n.getVariantKey()}}var o=this.$Player$p_112(),a=o[0];return a?a.getAudioTrack():null},i.getCurrentPlayingVideoVariant=function(){return this.$Player$p_73},i.getTargetVideoVariant=function(){return this.$Player$p_74},i.switchToVideoQuality=function(t){var e=this.$Player$p_102().find(function(e){return e.getDisplayLabel()===t});if(e){var n=this.$Player$p_5.get("video");n&&(n.switchRepresentation(e),n.disableAdaptation())}},i.switchToVideoVariant=function(t){var e,n,a,i;if(this.$Player$p_74=t===null?{lang:null,role:null}:t,this.$Player$p_74.lang===((e=(n=this.$Player$p_73)==null?void 0:n.lang)!=null?e:null)&&this.$Player$p_74.role===((a=(i=this.$Player$p_73)==null?void 0:i.role)!=null?a:null)){var l,s,u,c;r("oz-player/shims/ozReportUnexpectedError")(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SWITCH_VARIANT",description:"switchToVideoVariant switch to the same lang: "+((l=this.$Player$p_74.lang)!=null?l:"default lang")+", same role: "+((s=this.$Player$p_74.role)!=null?s:"default role")}),"switchToVideoVariant switch to the same lang: "+((u=this.$Player$p_74.lang)!=null?u:"default lang")+", same role: "+((c=this.$Player$p_74.role)!=null?c:"default role"),"warn");return}else if(this.$Player$p_9){if(!this.$Player$p_113(this.$Player$p_74.lang)){var d,m,p,_;r("oz-player/shims/ozReportUnexpectedError")(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SWITCH_VARIANT",description:"switchToVideoVariant lang not exist in mpd: "+((d=this.$Player$p_74.lang)!=null?d:"default lang")+", same role: "+((m=this.$Player$p_74.role)!=null?m:"default role")}),"switchToVideoVariant lang not exist in mpd: "+((p=this.$Player$p_74.lang)!=null?p:"default lang")+", same role: "+((_=this.$Player$p_74.role)!=null?_:"default role"),"warn");return}}else{r("oz-player/shims/ozReportUnexpectedError")(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SWITCH_VARIANT",description:"switchToVideoVariant mpd is void"}),"switchToVideoVariant mpd is void","warn");return}this.$Player$p_114(),this.$Player$p_4.getBool("enable_lip_sync_abr_select_quality")&&this.$Player$p_4.getBool("enable_alternative_audio_tracks")&&this.$Player$p_75&&this.$Player$p_115(),this.$Player$p_73=this.$Player$p_74},i.$Player$p_114=function(){var e=this.$Player$p_112()[0];if(e){var t=this.$Player$p_5.get("audio");t&&(t.switchRepresentation(e,[0,this.$Player$p_14.getDuration()]),t.disableAdaptation())}},i.$Player$p_115=function(){var e=this.$Player$p_5.get("video");if(e){var t=e.getCurrentRepresentation();if(!(t.getLang()===this.$Player$p_74.lang&&t.getRole()===this.$Player$p_74.role)){var n=this.$Player$p_102();if(n.length===0){r("oz-player/shims/ozReportUnexpectedError")(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SWITCH_VARIANT",description:"switchVideoByTargetVariant no representations with target variant: "+JSON.stringify(this.$Player$p_74)}),"switchVideoByTargetVariant no representations with target variant: "+JSON.stringify(this.$Player$p_74),"warn");return}var a,i=this.$Player$p_6.get("video");if(i?(i.updateRepresentations(n),a=i.getBestRepresentation()):a=n[0],!a){r("oz-player/shims/ozReportUnexpectedError")(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_SWITCH_VARIANT",description:"switchVideoByTargetVariant unable to update representations given target variant: "+JSON.stringify(this.$Player$p_74)}),"switchVideoByTargetVariant unable to update representations given target variant: "+JSON.stringify(this.$Player$p_74));return}e.switchRepresentation(a,[0,this.$Player$p_14.getDuration()])}}},i.getIsVideoQualityAdaptationEnabled=function(){var e=this.$Player$p_5.get("video");return e?e.getIsAdaptationEnabled():!1},i.enableVideoQualityAdaptation=function(){var e=this.$Player$p_5.get("video");e&&e.enableAdaptation()},i.getVideoQualities=function(){var e=this,t=this.$Player$p_9;if(!t)return[];var n=this.$Player$p_102().filter(function(t){var n;return!((n=e.$Player$p_67)!=null&&n.isBlocked(t.getID()))}),r=n.some(function(e){return o("oz-player/utils/OzMimeUtil").getParsedCodecFamily(e.getCodecs())===u}),a=n.some(function(e){return o("oz-player/utils/OzMimeUtil").getParsedCodecFamily(e.getCodecs())===c}),i=r?n.filter(function(e){return o("oz-player/utils/OzMimeUtil").getParsedCodecFamily(e.getCodecs())===u}):a?n.filter(function(e){return o("oz-player/utils/OzMimeUtil").getParsedCodecFamily(e.getCodecs())===c}):n.filter(function(e){return o("oz-player/utils/OzMimeUtil").getParsedCodecFamily(e.getCodecs())===d});return i.sort(function(e,t){return e.getBandwidth()-t.getBandwidth()}).map(function(e){return e.getDisplayLabel()})},i.getVideoTracks=function(){var e=this,t=this.$Player$p_9;return t?this.$Player$p_102().filter(function(t){var n;return!((n=e.$Player$p_67)!=null&&n.isBlocked(t.getID()))}).map(function(e){return{mimeCodecs:e.getMimeCodecs(),codec:e.getCodecs(),codecFamily:o("oz-player/utils/OzMimeUtil").getParsedCodecFamily(e.getMimeCodecs()),displayLabel:e.getDisplayLabel(),qualityLabel:e.getDisplayLabel(),height:e.getHeight(),id:e.getID(),qualityScoreCurveString:e.getQualityScoreCurveString("csvqm"),width:e.getWidth(),lang:e.getLang(),role:e.getRole(),variantKey:e.getVariantKey()}}):[]},i.getAudioTracks=function(){var e=this,t=this.$Player$p_9;return t?t.getAudioRepresentations().filter(function(t){var n;return!((n=e.$Player$p_67)!=null&&n.isBlocked(t.getID()))}).map(function(e){return e.getAudioTrack()}):[]},i.setEnableLiveheadCatchup=function(t){var e;if(this.$Player$p_20){var n;t?this.$Player$p_16.getOperationLogger("live_catchup_enabled").setIsLatencyCachupEnabled(!0).log():this.$Player$p_16.getOperationLogger("live_catchup_disabled").setIsLatencyCachupEnabled(!1).log(),(n=this.$Player$p_20)==null||n.setTimelineBlockingEnabled(t)}this.$Player$p_5.forEach(function(e){e.setEnableLiveheadCatchup(t)}),(e=this.$Player$p_19)==null||e.setEnableLiveheadCatchup(t)},i.$Player$p_94=function(){var t=this;if(this.$Player$p_4.getBool("enable_alternative_audio_tracks")&&this.$Player$p_113(this.$Player$p_72)){var r;this.$Player$p_74=babelHelpers.extends({},this.$Player$p_74,{lang:(r=this.$Player$p_72)!=null?r:null,role:this.$Player$p_72!=null?"dub":null})}var a=this.$Player$p_102()[0];this.$Player$p_62=a&&a.canPredict()&&this.$Player$p_4.getBool("pdash_use_pdash_segmentlocator")||a&&a.canApproximateId()?new(o("oz-player/streams/OzPredictedSegmentLocator")).OzPredictedSegmentLocator({videoNode:this.$Player$p_3,liveLatencyManager:this.$Player$p_40,loggerProvider:this.$Player$p_16,dynamicVideoLibrary:this.$Player$p_65}):null;var i=this.$Player$p_2?[this.$Player$p_116({liveConfigsFromAudioStream:!0}),this.$Player$p_117()]:[this.$Player$p_118(),this.$Player$p_116({liveConfigsFromAudioStream:!1}),this.$Player$p_117()],l=[];return(e||(e=n("Promise"))).all(i).then(function(){var e=t.$Player$p_5.get("video"),n=t.$Player$p_5.get("audio"),r=t.$Player$p_5.get("caption");e&&l.push(e.getCurrentRepresentation()),n&&l.push(n.getCurrentRepresentation()),r&&l.push(r.getCurrentRepresentation()),l.forEach(function(e){t.$Player$p_10.addSubscriptions(e.addUpdateListener(function(){t.$Player$p_108("SegmentIndexesUpdated",l)}))}),t.$Player$p_108("InitialSegmentIndexes",l),t.$Player$p_3&&t.$Player$p_3.style&&(t.$Player$p_3.style.display=t.$Player$p_2?"none":"block"),t.$Player$p_73=t.$Player$p_74,t.emit("initialized")})},i.$Player$p_119=function(t){if(!t.getTimeRanges().length){this.$Player$p_16.getOperationLogger("playhead_adjustment").setInitiator("setup_initial_duration").setResult("failed").log();return}var e=t.getTimeRanges()[t.getTimeRanges().length-1].endTime;this.$Player$p_7.updateDuration(e,!0)},i.$Player$p_120=function(t){var e,n,o;this.$Player$p_23=new(r("oz-player/media_source/OzMediaSeekableRangeManager"))(this.$Player$p_7,this.$Player$p_4),this.$Player$p_119(t),(e=this.$Player$p_23)==null||e.setTimeRangeProvider(t),(n=this.$Player$p_19)==null||n.setTimeRangeProvider(t),(o=this.$Player$p_20)==null||o.setTimeRangeProvider(t)},i.$Player$p_118=function(){var e=this.$Player$p_102();if(!e.length)return r("oz-player/shims/OzMaybeNativePromise").reject(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_INITIALIZATION",description:"No video representations in the manifest",extra:{code:r("oz-player/utils/OzCustomErrorCode").SETUP_STREAMS_PROMISE_REJECTION.toString()}}));var t=o("oz-player/utils/OzPlaybackRestrictionsUtils").applyVideoPlaybackRestrictions(this.$Player$p_31,this.$Player$p_103(),e);if(!t.length){var n=e.map(function(e){return e.getDisplayLabel()+"@"+e.getWidth()+"x"+e.getHeight()+"("+e.getMimeCodecs()+")"});return r("oz-player/shims/OzMaybeNativePromise").reject(o("oz-player/utils/OzErrorUtils").createOzError({type:"OZ_INITIALIZATION",description:"Restricted all video representations: "+n.join(", "),extra:{code:r("oz-player/utils/OzCustomErrorCode").SETUP_STREAMS_PROMISE_REJECTION.toString()}}))}this.$Player$p_120(t[0]);var a=this.$Player$p_121(t);a&&this.$Player$p_4.getBool("enable_abr_logging")&&this.$Player$p_16.getOperationLogger("video_stream_setup_initial_representation_from_prefetch").setResult("success").setReason("player_initialized").setRepresentationID(a.getID()).setPreviousRepresentationID(null).setUserInfo({initialRepresentationIDs:JSON.stringify(this.$Player$p_25)}).setType("video").setInitiator("Player").log();var i=this.$Player$p_101(a||t[0]);return this.$Player$p_6.set("video",i),a||(a=i.getBestRepresentation()),this.$Player$p_99(a||t[0],"video")},i.$Player$p_102=function(){var e=this.$Player$p_9;if(!e)return[];var t=e.getVideoRepresentations();if(this.$Player$p_4.getBool("enable_lip_sync_abr_select_quality")&&this.$Player$p_4.getBool("enable_alternative_audio_tracks")&&this.$Player$p_75){var n=e.getVideoRepresentationsByVariant(this.$Player$p_74);t=n.length>0?n:e.getVideoRepresentationsByVariant({lang:null,role:null})}var r=o("oz-player/utils/OzPlaybackRestrictionsUtils").applyVideoPlaybackRestrictions(this.$Player$p_31,this.$Player$p_103(),t);return t.filter(function(e){return r.includes(e)})},i.$Player$p_112=function(){var e=this.$Player$p_9;return e?this.$Player$p_4.getBool("enable_alternative_audio_tracks")?e.getAudioRepresentationsByVariant(this.$Player$p_74):e.getAudioRepresentations():[]},i.$Player$p_113=function(t){var e=this.$Player$p_9;if(!e)return!1;var n=e.getAudioRepresentations();if(t==null)return!0;if(this.$Player$p_4.getBool("enable_alternative_audio_tracks")&&e.isStaticMpd()){var r=-1;return r=n.findIndex(function(e){return e.getLang()===t}),r>-1}return!1},i.$Player$p_116=function(t){var e=this,n=t.liveConfigsFromAudioStream,o=n===void 0?!1:n,a=s(this.$Player$p_9),i=a.getAudioRepresentations();o&&this.$Player$p_120(i[0]);var l=-1;if(this.$Player$p_4.getBool("enable_alternative_audio_tracks")&&i.length>1&&a.isStaticMpd()&&this.$Player$p_72!=null&&(l=i.findIndex(function(t){return t.getLang()===e.$Player$p_72})),i.length){var u=l>-1?l:i.findIndex(function(e){return e.getLang()==null&&e.getRole()==null}),c=u>-1?u:0;return this.$Player$p_99(l>=0&&l<i.length?i[l]:this.$Player$p_122(i)||i[c],"audio")}return r("oz-player/shims/OzMaybeNativePromise").resolve()},i.$Player$p_117=function(){var e=s(this.$Player$p_9),t=e.getApplicationRepresentations();return t.length?this.$Player$p_99(t[0],"caption"):r("oz-player/shims/OzMaybeNativePromise").resolve()},i.getMpd=function(){return this.$Player$p_9},i.destroy=function(o){var t,a,i=this,l=this.$Player$p_16.getOperationLogger("unload").setInitiator(o).start();(t=this.$Player$p_64)==null||t.destroy(),this.$Player$p_97(),this.$Player$p_5.forEach(function(e){e.destroy()}),this.$Player$p_33&&(this.$Player$p_33.destroy(),this.$Player$p_33=null),this.$Player$p_5=new Map,this.$Player$p_10.release(),this.$Player$p_10.engage(),this.$Player$p_14.destroy(),this.$Player$p_19&&this.$Player$p_19.destroy(),this.$Player$p_40&&(this.$Player$p_40.destroy(),this.$Player$p_40=null),this.$Player$p_20&&(this.$Player$p_20.destroy(),this.$Player$p_20=null),this.$Player$p_48&&this.$Player$p_48.destroy(),this.$Player$p_61&&this.$Player$p_61.destroy(),this.$Player$p_13&&this.$Player$p_13.destroy(),this.$Player$p_52&&(this.$Player$p_52=null),this.$Player$p_7&&this.$Player$p_7.detach(),this.$Player$p_3.pause(),this.$Player$p_4.getBool("enable_revoke_object_url_on_destroy")&&URL.revokeObjectURL(this.$Player$p_3.src),this.$Player$p_3.setAttribute("src",""),this.$Player$p_3.removeAttribute("src"),this.$Player$p_3.removeAttribute("srcObject");var s=(e||(e=n("Promise"))).resolve();return typeof this.$Player$p_3.setMediaKeys=="function"&&(s=this.$Player$p_3.setMediaKeys(null)),this.$Player$p_21&&this.$Player$p_21.destroy(),this.$Player$p_32&&this.$Player$p_32.destroy(),this.$Player$p_22.destroy(),(a=this.$Player$p_23)==null||a.destroy(),this.$Player$p_50&&this.$Player$p_50.destroy(),this.$Player$p_67&&this.$Player$p_67.destroy(),l.log(),this.emit("destroyed"),s.catch(function(e){r("oz-player/shims/ozReportUnexpectedError")(e,"Player.destroy","warn")}).then(function(){i.$Player$p_3.load()})},i.$Player$p_121=function(t){var e=this,n=t.find(function(t){return e.$Player$p_25.indexOf(t.getID())!==-1});return n||(n=r("oz-player/utils/getRepresentationInCache")(t,this.$Player$p_24)),n||null},i.$Player$p_122=function(t){var e=this,n,a=t.find(function(t){return e.$Player$p_25.indexOf(t.getID())!==-1});return a||(a=r("oz-player/utils/getRepresentationInCache")(t,this.$Player$p_24)),!a&&!((n=this.$Player$p_9)!=null&&n.isStaticMpd())&&t.length>1&&(a=o("oz-player/utils/OzIbrUtils").getInitialAudioRepresentation(t,this.$Player$p_4,this.$Player$p_16)),a||null},i.$Player$p_123=function(t){return null},i.$Player$p_85=function(t){var e=new(r("oz-player/parsers/OzMpdParser"))({config:this.$Player$p_4,ozParserContext:{mpdUrl:this.$Player$p_18,createXmlParser:this.$Player$p_89,customParsers:this.$Player$p_28,customRepresentationParsers:this.$Player$p_29,customSegmentTimelineParser:this.$Player$p_30},networkManager:this.$Player$p_13,perfLoggerProvider:this.$Player$p_16,drmManager:this.$Player$p_48,initialRepresentationIDs:this.$Player$p_25,blockedRepresentationsManager:this.$Player$p_67,enableAlternativeAudioTracks:this.$Player$p_4.getBool("enable_alternative_audio_tracks"),useManagedMediaSource:this.$Player$p_78}),n=e.parse(t);this.$Player$p_10.addSubscriptions(e.onError(this.$Player$p_11.emitError));var a=o("oz-player/utils/OzPlaybackRestrictionsUtils").applyVideoPlaybackRestrictions(this.$Player$p_31,this.$Player$p_103(),n.getVideoRepresentations());if(a.length>1){var i=o("oz-player/utils/OzMimeUtil").getParsedCodecFamily(a[0].getMimeCodecs());this.$Player$p_76=!a.reduce(function(e,t){return e&&o("oz-player/utils/OzMimeUtil").getParsedCodecFamily(t.getMimeCodecs())===i},!0)}return n},i.$Player$p_79=function(){var e=[];return this.$Player$p_17&&e.push(new(o("oz-player/loggings/OzDevConsolePerfLogger")).OzDevConsolePerfLoggerProvider),e},i.$Player$p_124=function(t,n){var e=this.$Player$p_5.get(n);return e?e.getRepresentationIDAtTime(t):null},i.getAudioRepresentationIDAtTime=function(t){return this.$Player$p_124(t,"audio")},i.getVideoRepresentationIDAtTime=function(t){return this.$Player$p_124(t,"video")},i.getCurrentVideoRepresentation=function(){return this.$Player$p_125("video")},i.getCurrentAudioRepresentation=function(){return this.$Player$p_125("audio")},i.getCurrentPlayingAudioTrackID=function(){var e=this.getCurrentAudioRepresentation();return e==null?void 0:e.getID()},i.$Player$p_125=function(t){var e,n=this.$Player$p_124(this.$Player$p_14.getCurrentTime(),t),r=this.$Player$p_9;if(!r)return null;var o=[];return t==="audio"?o=this.$Player$p_112():t==="video"&&(o=this.$Player$p_102()),(e=o.find(function(e){return e.getID()===n}))!=null?e:null},i.getSelectedVideoRepresentation=function(){var e=this.$Player$p_5.get("video");return e!=null?e.getCurrentRepresentation():null},i.getSelectedAudioRepresentation=function(){var e=this.$Player$p_5.get("audio");return e!=null?e.getCurrentRepresentation():null},i.getDebug=function(){var e=this,t=this.$Player$p_5.get("video"),n=this.$Player$p_5.get("audio"),r=this.$Player$p_5.get("caption"),o,a,i,l,u,c,d;if(t){var m,p;if(o=(m=t.getDebug())==null?void 0:m.MediaStreamAbrManager,a=(p=t.getDebug())==null?void 0:p.SourceBufferManager,a){var _;i=(_=a.getDebug())==null?void 0:_.SourceBuffer}}if(n){var f;if(l=(f=n.getDebug())==null?void 0:f.SourceBufferManager,l){var g;u=(g=l.getDebug())==null?void 0:g.SourceBuffer}}if(r){var h;if(c=(h=r.getDebug())==null?void 0:h.SourceBufferManager,c){var y;d=(y=c.getDebug())==null?void 0:y.SourceBuffer}}return{getManifest:function(){return s(e.$Player$p_9)},DashManifestParsed:this.$Player$p_9,VideoSourceStream:t,VideoAbrManager:o,VideoBufferManager:a,VideoSourceBuffer:i,AudioSourceStream:n,AudioBufferManager:l,AudioSourceBuffer:u,CaptionSourceStream:r,CaptionBufferManager:c,CaptionSourceBuffer:d}},i.injectExternalDebugEvent=function(t,n){this.$Player$p_108(t,n)},i.$Player$p_108=function(t,n){this.emit("debug/dashPlayerEvent",{detail:{type:t,event:n}})},i.$Player$p_82=function(){var e=this,t=new(r("oz-player/strategies/OzBufferingDetector"))(this.$Player$p_3,this.$Player$p_4.getLegacyConfig(),function(){return e.$Player$p_51?e.$Player$p_3.duration:1/0});return t.attachPerfLoggerProvider(this.$Player$p_16),this.$Player$p_10.addSubscriptions(t.addListener("enterBuffering",function(t){e.emit("enterBuffering",t)}),t.addListener("leaveBuffering",function(t){e.emit("leaveBuffering",t)})),t},i.$Player$p_103=function(){var e=this.$Player$p_52?this.$Player$p_52():{width:this.$Player$p_3.offsetWidth,height:this.$Player$p_3.offsetHeight};return e},i.getMpdUrl=function(){return this.$Player$p_18},i.$Player$p_98=function(t){var e=this;this.$Player$p_18=t;var n=this.$Player$p_9;if(n){n.updateLocation(t),this.$Player$p_43&&(this.$Player$p_10.releaseOne(this.$Player$p_43),this.$Player$p_43=null);var r=function(){e.$Player$p_43&&(e.$Player$p_10.releaseOne(e.$Player$p_43),e.$Player$p_43=null),e.$Player$p_5.forEach(function(t,r){var o=t.getCurrentRepresentation(),a=o.getDisplayLabel(),i=(r==="video"?e.$Player$p_102():n.getAudioRepresentations()).slice();if(r==="video"){var l=e.$Player$p_6.get(r);l&&l.updateRepresentations(e.$Player$p_102())}var s=i[0];i.forEach(function(e){var t=e.getDisplayLabel();t===a&&(s=e)}),t.switchRepresentation(s),t.restartLoopBody()})};this.$Player$p_43=n.addListener("updated",r),this.$Player$p_10.addSubscriptions(this.$Player$p_43)}else{this.$Player$p_60=!0;return}},i.getPerfLoggerProvider=function(){return this.$Player$p_16},i.getApproximateFBLSToPlayerDisplayLatency=function(){var e,t,n,r,o=Number((e=(t=this.$Player$p_9)==null?void 0:t.getCustomField("lastVideoFrameTs"))!=null?e:void 0),a=Number((n=(r=this.$Player$p_9)==null?void 0:r.getCustomField("currentServerTimeMs"))!=null?n:void 0),i=this.$Player$p_126(o,a),l=this.$Player$p_127(o,a);return{latencyFromClockSync:l,latencyFromMpdUpdate:i}},i.$Player$p_126=function(t,n){if(!this.$Player$p_14.getCurrentTime()||isNaN(t)||isNaN(n))return null;var e=0;this.$Player$p_58===t?e=(r("oz-player/shims/OzPerformance").now()-Number(this.$Player$p_59))/1e3:(this.$Player$p_59=r("oz-player/shims/OzPerformance").now(),this.$Player$p_58=t);var o=t/1e3+e-this.$Player$p_14.getCurrentTime();return o},i.$Player$p_127=function(t,n){var e;if(!this.$Player$p_14.getCurrentTime()||isNaN(t)||isNaN(n)||r("oz-player/networks/OzClientClock").getClientClockOffsetMs()==null||!r("oz-player/networks/OzClientClock").getClientClockOffsetMs())return null;var o=this.$Player$p_14.getCurrentTimeUpdateTime()+((e=r("oz-player/networks/OzClientClock").getClientClockOffsetMs())!=null?e:0),a=n,i=this.$Player$p_14.getCurrentTime()*1e3,l=t,s=(o-a-(i-l))/1e3;return s},i.$Player$p_80=function(){this.$Player$p_5.forEach(function(e){e.restartLoopBody();var t=e.getCurrentRepresentation();e.switchRepresentation(t)})},a})(r("oz-player/shims/OzEventEmitter"));l.default=m}),98);
__d("oz-player",["oz-player/Player"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("oz-player/Player")}),98);/*FB_PKG_DELIM*/
__d("ACTSanitizerApiTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({Valid:0,UrlFailure:1,MessageTextFailure:2,CtaFailure:3});i.ACTSanitizerValidationResult=e}),66);
__d("ACTSanitizerApiWasm",["ACTSanitizerApiTypes","FBLogger","WAArmadilloXMA.pb","WAResolvable","WATagsLogger","WAWasmModuleCache","actsanitizer_api_v2","bx","encodeProtobuf","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=r("bx").getURL(r("bx")("30948")),f=o("WATagsLogger").TAGS(["ACTSanitizerWasm"]);async function g(){var t=new(o("WAResolvable")).Resolvable,n=r("actsanitizer_api_v2")({instantiateWasm:function(a,i){return o("WAWasmModuleCache").loadWasmModule(_).then(function(e){return WebAssembly.instantiate(e,a)}).then(function(n){f.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["instantiateWasm succeeded"]))),i(n),t.resolve()}).catch(function(e){f.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["WebAssembly.instantiate failed with error: ",""])),r("getErrorSafe")(e).toString()),t.reject(e)}),{}}}).catch(function(e){throw f.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["initWasm failed with error: ",""])),r("getErrorSafe")(e).toString()),t.reject(e),e}),a=await t.promise.then(function(){return n});return{getWasmMemorySize:function(){var e;return(e=a.wasmMemory)==null?void 0:e.buffer.byteLength},isMessageTextValid:function(t){try{var e=new TextEncoder,n=e.encode(t),i=a._malloc(n.byteLength);a.HEAPU8.set(n,i);var l=a._ACTSanitizer_isMessageTextValid(i,n.byteLength);a._free(i);var s=o("ACTSanitizerApiTypes").ACTSanitizerValidationResult.cast(l);if(s==null)throw r("FBLogger")("messenger_web").mustfixThrow("ACT Sanitizer WASM module returned invalid validation result");return s}catch(e){throw f.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["isMessageTextValid runtime error: ",""])),r("getErrorSafe")(e).toString()),e}},isXMAValid:function(t){var e,n;try{n=o("encodeProtobuf").encodeProtobuf(o("WAArmadilloXMA.pb").ExtendedContentMessageSpec,t).readByteArrayView(),e=a._malloc(n.byteLength),a.HEAPU8.set(n,e);var i=a._ACTSanitizer_isXMAValid(e,n.byteLength),l=o("ACTSanitizerApiTypes").ACTSanitizerValidationResult.cast(i);if(l==null)throw f.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["module returned invalid validation result: ",""])),l),r("FBLogger")("messenger_web").mustfixThrow("ACTSanitizerWasm module returned invalid validation result");return f.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["isXMAValid succeeded with result: ",""])),l),l}catch(e){var s,u,c,_;throw f.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["isXMAValid runtime error: ",". Final memory allocation: ",". input page size: ",". xma target type: ",""])),r("getErrorSafe")(e).toString(),(s=h((u=a.wasmMemory)==null?void 0:u.buffer.byteLength))!=null?s:"unknown",(c=h((_=n)==null?void 0:_.byteLength))!=null?c:"unknown",t.targetType),e}finally{e!=null&&a._free(e)}}}}function h(e){return e==null?null:Math.ceil(e/65536)}l.ACTSanitizerWasm=g}),98);
__d("ACTSanitizerApiLazyLoader",["ACTSanitizerApiWasm"],(function(t,n,r,o,a,i,l){"use strict";var e=null,s=1024*1024;function u(){e==null&&(e=o("ACTSanitizerApiWasm").ACTSanitizerWasm());var t=e;return t.then(function(t){var n=t.getWasmMemorySize();n!=null&&n>=s&&(e=o("ACTSanitizerApiWasm").ACTSanitizerWasm())}),t}l.loadACTSanitizerApi=u}),98);
__d("Cache",["TimeSlice"],(function(t,n,r,o,a,i,l){"use strict";var e=6e4,s=(function(){function t(){this.$1=new Map}var n=t.prototype;return n.has=function(t){return this.$1.has(t)},n.get=function(t,n){var e=this.__getRaw(t);return e?e.$2:n},n.getAll=function(t,n){var e=this,r=new Map;return t.forEach(function(t){return r.set(t,e.get(t,n))}),r},n.delete=function(t){var e=this.__getRaw(t);return e&&e.$3&&clearTimeout(e.$3),this.$1.delete(t)},n.clear=function(){this.$1.forEach(function(e){e&&e.$3&&clearTimeout(e.$3)}),this.$1.clear()},n.set=function(n,o,a,i){if(!this.shouldUpdate(n,a))return!1;var t=this.__getRaw(n);return t||(t=this.__getNewRawObject()),delete t.$2,delete t.$4,t.$3&&clearTimeout(t.$3),delete t.$3,t.$2=o,a!=null&&(t.$4=a),i!=null&&i>=0&&(t.$3=setTimeout(r("TimeSlice").guard(this.delete.bind(this,n),"Cache expiration timeout"),i*e)),this.__setRaw(n,t),!0},n.shouldUpdate=function(t,n){var e=this.__getRaw(t);return e==null||e.$4==null||n==null||n>e.$4},n.size=function(){return this.$1.size},n.__getRaw=function(t){return this.$1.get(t)},n.__setRaw=function(t,n){this.$1.set(t,n)},n.__getNewRawObject=function(){return{$2:null,$3:null,$4:null,$5:null,$6:null}},n.__keys=function(){return this.$1.keys()},t})();l.default=s}),98);
__d("EBAPIConvertNativeToLS",["I64","LSDict","LSShape","LSVec"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){return{decrypted_protobuf:t.decryptedProtobuf,protobuf_timestamp_ms:(e||(e=o("I64"))).of_float(t.protobufTimestampMs)}}function u(e,t){var n=r("LSVec").ofArray(e.map(function(e){return e.value}).filter(Boolean)),o=r("LSVec").ofArray(t.map(function(e){return c(e)}).filter(Boolean));return{echo:n,protobuf:o}}function c(e){var t=e.topLevelProtobuf,n=e.supplementalProtobufs,a=e.otid;if(a!=null){var i=new Map;n.forEach(function(e,t){var n=o("LSShape").ofRecord(s(e));i.set(t,n)});var l={otid:a,supplemental_protobufs:new(r("LSDict"))(i),tags:e.messageTags.map(function(e){return e}),toplevel_protobuf:o("LSShape").ofRecord(s(t))};return o("LSShape").ofRecord(l)}}l.convertNativeProtobufToLSType=s,l.convertNativeDecryptionResponseToDecryptedMessageType=u,l.convertDecryptedProtobufMessageToLSNativeType=c}),98);
__d("MEBEncryptionVersion",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,ENCRYPTION_KDF_WITH_VERSION:2,ENCRYPTION_KDF_WITH_NULL_SALT:3,ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY:4,TEST_VERSION:99});i.default=e}),66);
__d("EBCryptoUtils",["Base64Utils","EncryptedBackupsSymmetricEncryptionUtils","HChaCha20","MEBEncryptionVersion","SymmetricEncryptionCreateEncryptedData","SymmetricEncryptionPaddingUtils","XPlatReactCrypto","err"],(function(t,n,r,o,a,i,l){"use strict";var e=32,s=2147483647,u="message_key_in_epoch",c="_",d="cipher_version",m="thread",p="message_thread",_="supplemental_enc_aad",f="kdf_info:mailbox_root_key_v2>supplemental_enc_key";function g(t,n,o,a,i){var l=o>=r("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT?null:h(a),s=y(t,o,a);if(s==null)throw i.endFailWithError("failed_to_derive_message_symmetric_key"),r("err")("Error in derive message symmetric key. info is null");return b(s,l,n,[e],i)}function h(e){try{return new TextEncoder().encode(e).buffer}catch(e){throw r("err")("Error in get blob from string with exception: ",e)}}function y(e,t,n){var r=C(e,t,n);return h(r)}function C(e,t,n){return t>=r("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY||t>=r("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT?[u,new TextDecoder().decode(e),d,t,m,n].join(c):t>=r("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_VERSION?[u,new TextDecoder().decode(e),d,t].join(c):[u,new TextDecoder().decode(e)].join(c)}function b(e,t,n,a,i){if(a.length<1||a.some(function(e){return e>s}))throw i==null||i.endFailWithError("invalid_key_lengths_for_derive_keys"),r("err")("Invalid key lengths for derive keys");var l=a.reduce(function(e,t){return e+t},0)*8;return o("XPlatReactCrypto").subtleImportKey("raw",n,"HKDF",!1,["deriveBits"]).then(function(n){return o("XPlatReactCrypto").subtleDeriveBits({hash:"SHA-256",info:e,name:"HKDF",salt:t!=null?t:new Uint8Array(10).buffer},n,l)}).then(function(e){for(var t=new Uint8Array(e),n=[],r=0,o=0,i=a.length;o<i;++o){var l=r+a[o];n.push(t.slice(r,l).buffer),r=l}return n}).catch(function(e){throw i==null||i.endFailWithError("exception_in_create_derived_keys",e),r("err")("Exception in create derived keys",e)})}function v(e,t,n,a,i){var l=o("Base64Utils").toArrayBuffer(n);return S(e,t,l).then(function(e){if(e==null)throw a==null||a.endFailWithError("symmetric_string_decryption_with_null_result"),r("err")("symmetric string decryption with null result");return e}).catch(function(e){throw a==null||a.endFailWithError("symmetric_string_decryption_failed_with_error",e),r("err")("symmetric string decryption failed with encryption version: "+(i!=null?i:"null")+" and error",e)})}function S(e,t,n){if(n.byteLength<o("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes+o("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLengthInBytes)throw r("err")("cipher text is invalid");var a=new Uint8Array(n),i=a.slice(0,o("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes),l=new(o("HChaCha20")).HChaCha20,s=a.slice(o("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes).buffer,u=l.hChaCha20Bytes(i.slice(0,o("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer,e);return o("XPlatReactCrypto").subtleImportKey("raw",u,"AES-GCM",!1,["decrypt"]).then(function(e){return o("XPlatReactCrypto").subtleDecrypt({additionalData:t,iv:new Uint8Array(i.slice(o("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer),name:"AES-GCM",tagLength:o("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLength},e,s)}).then(function(e){var t=o("SymmetricEncryptionPaddingUtils").stripPadding(e);if(t==null)throw r("err")("Failed to strip padding for symmetric decryption");return t}).catch(function(e){throw r("err")("symmetric data decryption failed with error",e)})}async function R(e,t,n){var a=await r("SymmetricEncryptionCreateEncryptedData")(t,new TextEncoder().encode([p,n].join(c)).buffer,e),i=a[0];return i!=null?o("Base64Utils").fromArrayBuffer(i):null}l.KEY_LEN=e,l.MAX_INT_32=s,l.STRING_JOIN_SEPARATOR=c,l.MESSAGE_ENCYPTION_AAD=p,l.SUPPLEMENTAL_ENC_AAD=_,l.SUPPLEMENTAL_ENC_KEY_INFO=f,l.deriveMessageSymmetricKey=g,l.getBlobFromString=h,l.getInfoByEncryptionVersion=C,l.createDerivedKeys=b,l.symmetricEncryptionCreateDecryptedString=v,l.encryptThenBase64EncodeBlob=R}),98);
__d("EBDecryptQplFlow",["QPLUserFlow","Random","gkx","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.annotations,n=e.decryptionType,a=e.entryPoint,i=e.isMinos,l=e.source,u=e.threadId,c=r("qpl")._(521485751,"1118"),d=o("Random").uint32();return r("QPLUserFlow").start(c,{annotations:babelHelpers.extends({},t,{bool:babelHelpers.extends({},t==null?void 0:t.bool,{is_wasm_serializer_on:r("gkx")("18428"),isMinos:i,minos_rollout_enabled:r("gkx")("20911"),occam_only_mailbox_users:r("gkx")("16674")}),int:babelHelpers.extends({},t==null?void 0:t.int,{instanceKey:d,retryCount:0}),string:babelHelpers.extends({},t==null?void 0:t.string,{decryptionType:n,queryType:a,source:l!=null?l:"unknown",threadId:u})}),instanceKey:d}),s(c,d)}function s(e,t){return{addAnnotations:function(o){r("QPLUserFlow").addAnnotations(e,o,{instanceKey:t})},addPoint:function(o,a){a&&r("QPLUserFlow").addAnnotations(e,a,{instanceKey:t}),r("QPLUserFlow").addPoint(e,o,{instanceKey:t})},endFailWithError:function(o,a,i){var n=babelHelpers.extends({},i,{string:babelHelpers.extends({},i==null?void 0:i.string,{failReason:a})});r("QPLUserFlow").endFailure(e,o,{annotations:n,instanceKey:t})},endSuccess:function(o){r("QPLUserFlow").endSuccess(e,{annotations:o,instanceKey:t})},getInstanceKey:function(){return t}}}l.startDecryptQplFlow=e}),98);
__d("EBEchoMessageDecryptor",["EBCryptoUtils","EBDecryptQplFlow","I64","LSAuthorityLevel","LSIntEnum","MEBEncryptionVersion","ReQL","WACryptoUtils","WALogger","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p;async function _(t,n,a){if(n==null)throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No backup id provided"]))),r("err")("no-backup-id-provided");var i=await o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.tables.secure_encrypted_backups_epochs));if(i.length===0)throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] SecureEncryptedBackupsEpoch table is empty"]))),r("err")("secure-epochs-table-empty");return i.filter(function(e){return(m||(m=o("I64"))).equal(e.authorityLevel,(p||(p=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))&&(m||(m=o("I64"))).equal(e.backupId,(m||(m=o("I64"))).of_string(n))&&a.equals(e[a.key])})}function f(e,t){var n=t.epoch_id;return n!=null?_(e,t.backup_id,{equals:function(t){return t instanceof ArrayBuffer?!1:(m||(m=o("I64"))).equal(n,t)},key:"epochId",value:n}):_(e,t.backup_id,{equals:function(n){return n instanceof ArrayBuffer?o("WACryptoUtils").arrayBuffersEqual(t.epoch_anon_id,n):!1},key:"epochAnonIdBlob",value:t.epoch_anon_id})}var g=(function(){function e(){}var t=e.prototype;return t.decrypt=function(t,n,a,i,l){var e=a.map(async function(e){var a,s,m=o("EBDecryptQplFlow").startDecryptQplFlow({decryptionType:"echo_message_decryptor",entryPoint:l,isMinos:!1,source:i,threadId:n});if(e.value==null)return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Empty echo message string - cannot decrypt"]))),m.endFailWithError("empty_echo_message_string"),{otid:e.otid,value:void 0};var p=e.value;m.addPoint("get_epoch_keys_by_id_start");var _=await f(t,e);if(_.length===0)return o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No epoch keys found for message"]))),m.endFailWithError("no_epoch_keys_found_for_message"),{otid:e.otid,value:void 0};m.addPoint("get_epoch_keys_by_id_end"),m.addPoint("derive_message_symmetric_key_start");var g=await o("EBCryptoUtils").deriveMessageSymmetricKey(_[0].epochAnonIdBlob,_[0].epochRootKeyBlob,(a=e.encryption_version)!=null?a:r("MEBEncryptionVersion").UNKNOWN,n,m);if(g==null||g.length===0)return o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to derive symmetric key for message"]))),m.endFailWithError("failed_to_derive_symmetric_key"),{otid:e.otid,value:void 0};m.addPoint("derive_message_symmetric_key_end"),m.addPoint("symmetric_encryption_create_decrypted_string_start");var h=await o("EBCryptoUtils").symmetricEncryptionCreateDecryptedString(g[0],new TextEncoder().encode([o("EBCryptoUtils").MESSAGE_ENCYPTION_AAD,n].join(o("EBCryptoUtils").STRING_JOIN_SEPARATOR)).buffer,p,m,(s=e.encryption_version)!=null?s:r("MEBEncryptionVersion").UNKNOWN);return m.addPoint("symmetric_encryption_create_decrypted_string_end"),m.endSuccess(),{otid:e.otid,value:h!=null?new TextDecoder().decode(h):void 0}});return Promise.all(e)},e})();l.getEpochKeysByID=f,l.EchoMessageDecryptor=g}),98);
__d("EBTypes",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}i.unsafeCastToDecryptedLabyrinthMessage=e}),66);
__d("EBProtobufMessageDecryptor",["Base64Utils","EBCryptoUtils","EBDecryptQplFlow","EBEchoMessageDecryptor","EBTypes","MEBEncryptionVersion","MpsTypes","WALogger","WALongInt","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g=(function(){function t(){}var n=t.prototype;return n.$1=async function(n,a,i,l,m){var t,p,_=o("EBDecryptQplFlow").startDecryptQplFlow({decryptionType:"protobuf_message_decryptor",entryPoint:m,isMinos:!1,source:l,threadId:a});_.addAnnotations({string:{message_id:i.otid}}),_.addPoint("get_epoch_keys_by_id_start");var f=await o("EBEchoMessageDecryptor").getEpochKeysByID(n,i);if(f.length===0){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No epoch keys found for message"]))),_.endFailWithError("no_epoch_keys_found_for_message");return}_.addPoint("get_epoch_keys_by_id_end");var g=f[0];_.addPoint("derive_message_symmetric_key_start");var h=await o("EBCryptoUtils").deriveMessageSymmetricKey(g.epochAnonIdBlob,g.epochRootKeyBlob,(t=i.encryption_version)!=null?t:r("MEBEncryptionVersion").UNKNOWN,a,_);if(h==null||h.length===0){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to derive symmetric key for message"]))),_.endFailWithError("failed_to_derive_symmetric_key");return}if(_.addPoint("derive_message_symmetric_key_end"),_.addPoint("symmetric_encryption_create_decrypted_string_start"),i.encryptedProtobufContent==null){o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] encrypted protobuf content is null"]))),_.endFailWithError("encrypted_protobuf_content_is_null");return}var y=i.encryptedProtobufContent,C=await o("EBCryptoUtils").symmetricEncryptionCreateDecryptedString(h[0],new TextEncoder().encode([o("EBCryptoUtils").MESSAGE_ENCYPTION_AAD,a].join(o("EBCryptoUtils").STRING_JOIN_SEPARATOR)).buffer,y,_,(p=i.encryption_version)!=null?p:r("MEBEncryptionVersion").UNKNOWN),b;if(i.skCipherText!=null){var v,S,R=i.skCipherText,L=await(S=o("EBCryptoUtils")).createDerivedKeys(new TextEncoder().encode(S.SUPPLEMENTAL_ENC_KEY_INFO).buffer,void 0,g.epochRootKeyBlob,[S.KEY_LEN],_);b=await S.symmetricEncryptionCreateDecryptedString(L[0],new TextEncoder().encode(S.SUPPLEMENTAL_ENC_AAD).buffer,R,_,(v=i.encryption_version)!=null?v:r("MEBEncryptionVersion").UNKNOWN)}if(C==null){_.endFailWithError("failed_to_decrypt_protobuf"),o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to decrypt protobuf"])));return}_.addPoint("symmetric_encryption_create_decrypted_string_end"),_.addPoint("decrypt_supplemental_key_start");var E=b!=null?o("MpsTypes").toSupplementalKey(new TextDecoder().decode(b)):void 0;if(_.addPoint("decrypt_supplemental_key_end"),i.protobufTimestampMs==null){_.endFailWithError("protobuf_timestamp_is_null"),o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] protobuf timestamp is null"])));return}var k=o("WATimeUtils").castLongIntToMillisTime(o("WALongInt").decimalStringToLongInt(i.protobufTimestampMs));return _.endSuccess(),{decryptedProtobuf:o("EBTypes").unsafeCastToDecryptedLabyrinthMessage(C),decryptedSupplementalKey:E,protobufTimestampMs:k}},n.$2=function(t){var e=t.topLevelProtobuf.encryptedProtobufContent,n=t.topLevelProtobuf.protobufTimestampMs,r=t.topLevelProtobuf.otid;if(!(e==null||n==null||r==null))return{messageTags:t.messageTags,otid:o("MpsTypes").toMessageId(r),supplementalProtobufs:new Map,topLevelProtobuf:{decryptedProtobuf:o("EBTypes").unsafeCastToDecryptedLabyrinthMessage(o("Base64Utils").toArrayBuffer(e)),decryptedSupplementalKey:void 0,protobufTimestampMs:o("WATimeUtils").castLongIntToMillisTime(o("WALongInt").decimalStringToLongInt(n))}}},n.$3=async function(t,n,r,a,i){var e=this,l=r.topLevelProtobuf,s=r.supplementalProtobufs,u=await this.$1(t,n,l,a,i);if(u==null){o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to decrypt top level protobuf"])));return}var c=new Map;return await Promise.all(s.map(async function(r){var l=await e.$1(t,n,r,a,i);if(l==null){o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to decrypt supplemental protobuf"])));return}var s=l.decryptedSupplementalKey;if(s==null){o("WALogger").ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] decrypted supplemental key is null"])));return}c.set(s,l)})),{messageTags:r.messageTags,otid:r.topLevelProtobuf.otid!=null?o("MpsTypes").toMessageId(r.topLevelProtobuf.otid):void 0,supplementalProtobufs:c,topLevelProtobuf:u}},n.decrypt=async function(t,n,r,a,i){var e=this,l=[];return await Promise.all(r.map(async function(r){if(r.isUnencrypted===!0){var s=e.$2(r);s!=null&&l.push(s);return}var u=await e.$3(t,n,r,a,i);if(u==null){o("WALogger").ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to decrypt protobuf message for message with otid ",""])),r.topLevelProtobuf.otid);return}l.push(u)})),l},t})();l.ProtobufMessageDecryptor=g}),98);
__d("EBAPIDecryptionModule",["EBEchoMessageDecryptor","EBProtobufMessageDecryptor","WALogger","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(t,n,r,a,i,l){o("WALogger").DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Running native decryption"])));var u=new(o("EBEchoMessageDecryptor")).EchoMessageDecryptor,c=new(o("EBProtobufMessageDecryptor")).ProtobufMessageDecryptor;try{var d=a.length>0?await u.decrypt(t,n,a,i,l):[],m=r.length>0?await c.decrypt(t,n,r,i,l):[];return o("WAResultOrError").makeResult({decryptedEchoMessages:d,decryptedProtobufs:m})}catch(e){return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Error thrown when running native decryption: ",""])),e),o("WAResultOrError").makeError(e)}}l.decryptUsingNativeJS=u}),98);
__d("EBAPISharedTypes",[],(function(t,n,r,o,a,i){"use strict";var e=["ebls-not-initialized","no-client-state","runtime-error","invalid-client-state","invalid-graphql-response","empty-decryption-response","delete-mailbox","unsupported-context","eb-not-enabled","echo-to-protobuf-conversion-error","called-from-main-thread","missing-message-range-info","server-side-exception","thread-not-found-in-mi-act-mapping-table","thread-not-found-on-server","echo-decryption-failure","protobuf-decryption-failure","decryption-error","null-chat-jid","native-decryption-error","invalid-parameters","secure-epochs-table-empty","no-backup-id-provided"],l=new Set(e);i.EBAPIRestoreErrorValues=e,i.errorSet=l}),66);
__d("EBBase64Decode",["Base64Utils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\./g,"=").replace("/,/","="),n=4-t.length%4;if(n<4)for(var r=0;r<n;r++)t+="=";return t}function s(t){return o("Base64Utils").toArrayBuffer(e(t))}l.default=s}),98);
__d("EBConvertMinosProtobufShape",["EBTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t;return{messageTags:e.messageTags,otid:(t=e.otid)!=null?t:void 0,supplementalProtobufs:s(e.supplementalProtobufs),topLevelProtobuf:{decryptedProtobuf:o("EBTypes").unsafeCastToDecryptedLabyrinthMessage(e.topLevelProtobuf.decryptedProtobuf),decryptedSupplementalKey:e.topLevelProtobuf.decryptedSupplementalKey,protobufTimestampMs:e.topLevelProtobuf.protobufTimestampMs}}}function s(e){var t=new Map;return e.forEach(function(e,n){var r={decryptedProtobuf:o("EBTypes").unsafeCastToDecryptedLabyrinthMessage(e.decryptedProtobuf),decryptedSupplementalKey:n,protobufTimestampMs:e.protobufTimestampMs};t.set(n,r)}),t}l.convertMinosProtobufShape=e}),98);
__d("EBDBConsistencyApi",["$InternalEnum","EBDB","FBLogger","I64","QPLUserFlow","ReQL","getErrorSafe","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s=["encrypted_backups_virtual_devices","secure_encrypted_backups_recovery_code_status","device_metadata","secure_encrypted_backups_epochs","secure_encrypted_backups_client_state","encrypted_backups","experiences_shared_state","auto_restore_opt_out"],u=null;function c(){return u}async function d(t,n){try{var a=await o("EBDB").getEBDB(),l=BigInt((e||(e=o("I64"))).to_string(n));await a.runInTransaction(["device_state"],"readwrite",function(e){return e.stores.device_state.bulkPut([{deviceId:l,env:t}])},"EBDB - AddDevice",i.id+":54"),u=l}catch(e){r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Error on EBDB - AddDevice")}}function m(e){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.secure_encrypted_backups_client_state)).then(function(e){return e==null?void 0:e.deviceId})}async function p(e,t,n){if(n!=null)return d(t,n);try{var o=await m(e);return o==null?void 0:d(t,o)}catch(e){r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Error on fetching secure_encrypted_backups_client_state")}}async function _(e,t){r("QPLUserFlow").addPoint(t,"track_overprompting_start");try{var n=await o("EBDB").getEBDB(),a=!1;await n.runInTransaction(["device_state"],"readwrite",async function(t){var n=await t.stores.device_state.get(e);(n==null?void 0:n.deviceId)!=null&&(a=!0)},"EBDB - AddDevice",i.id+":107"),r("QPLUserFlow").addAnnotations(t,{bool:{overprompting:a}}),r("QPLUserFlow").addPoint(t,"track_overprompting_end")}catch(e){r("QPLUserFlow").addPoint(t,"track_overprompting_fail"),r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Error on track overpropting")}}var f=n("$InternalEnum")({Disabled:0,EbsmInconsistent:1,EbdbInconsistent:2,Enabled:3,Inconsistent:4});async function g(t){var n=await m(t),r=n!=null?BigInt((e||(e=o("I64"))).to_string(n)):null;return r==null&&u==null?f.Disabled:r==null&&u!=null?f.EbsmInconsistent:r!=null&&u==null?f.EbdbInconsistent:r===u?f.Enabled:f.Inconsistent}async function h(e,t,n,o){var a=1/r("justknobx")._("3914");if(!(Math.random()>=a)){var i=r("qpl")._(521471316,"2831");try{r("QPLUserFlow").start(i);var l=await g(e);o!=null&&r("QPLUserFlow").addAnnotations(i,o()),r("QPLUserFlow").endSuccess(i,{annotations:{int:{consistency:l,env:t,operation:n}}})}catch(e){r("QPLUserFlow").endFailure(i,"error"),r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Error on trackConsistency in %s",t)}}}async function y(){await o("EBDB").clearDeviceState(),u=null}var C;async function b(t,n){C!=null&&C(),await o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.encrypted_backups)).then(function(e){e!=null&&((e==null?void 0:e.backupId)==null||(e==null?void 0:e.isUserOptedOut)===!0)&&y()}).catch(function(e){r("FBLogger")("wmi_eb").catching(e).mustfix("EBDBApi: EBLS error on fetching data from encrypted_backups")}),C=t.tables.encrypted_backups.subscribe(function(e,t){t.operation!=="delete"&&(t.value.backupId==null||t.value.isUserOptedOut===!0)&&y()});var a=await o("EBDB").getEBDB(),l=await a.runInTransaction(["device_state"],"readonly",function(e){return e.stores.device_state.get(n)},"EBDB - readDeviceState",i.id+":250").catch(function(e){r("FBLogger")("wmi_eb").catching(e).mustfix("EBDB error: fetching device_state")});if(u=v(l==null?void 0:l.deviceId),u==null){var s=await m(t);if(s==null)return;var c=BigInt((e||(e=o("I64"))).to_string(s));u=c,await a.runInTransaction(["device_state"],"readwrite",function(e){return e.stores.device_state.bulkPut([{deviceId:c,env:n}])},"EBDB - writeDeviceState",i.id+":272").catch(function(e){r("FBLogger")("wmi_eb").catching(e).mustfix("EBDB error: write device_state")})}}function v(t){if(t!=null){if(typeof t=="bigint")return t;if(typeof t=="number")return BigInt(t);if(typeof t=="string")try{return BigInt(t)}catch(e){r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("EBDBApi: Parsing string as BigInt"),y();return}if(Array.isArray(t))try{return BigInt((e||(e=o("I64"))).to_string(t))}catch(e){r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("EBDBApi: Parsing I64 as BigInt"),y();return}r("FBLogger")("wmi_eb").mustfix("EBDBApi: Parsing unknown as BigInt %s",String(t)),y()}}l.EB_STORES=s,l.getDeviceId=c,l.addNewDevice=p,l.trackOverprompting=_,l.EBConsistencyResult=f,l.checkRegistrationConsistency=g,l.trackConsistency=h,l.clearDeviceState=y,l.startListeningDeviceRegistrations=b}),98);
__d("EBDedupeEncryptedLabyrinthMessages",["MpsTypes"],(function(t,n,r,o,a,i,l){"use strict";var e=["supplemental_protobufs","supplemental_protobufs_v2","top_level_protobuf","top_level_protobuf_unencrypted","top_level_protobuf_v2"];function s(t,n,r){return t.map(function(t){var a,i,l=t.protobuf_stanzas,s=t.otid;if(!l||s==null)return t;var u=l.supplemental_protobufs,c=l.supplemental_protobufs_v2,d=l.top_level_protobuf,m=l.top_level_protobuf_unencrypted,p=l.top_level_protobuf_v2,_=babelHelpers.objectWithoutPropertiesLoose(l,e),f=o("MpsTypes").toMessageId(s),g=n.get(f);if(g==null)return t;var h=(a=u==null?void 0:u.length)!=null?a:0,y=(i=c==null?void 0:c.length)!=null?i:0,C=!0;if(h>0||y>0){var b=u==null?void 0:u.map(function(e){return e.supplemental_otid}).filter(function(e){return e!=null}),v=new Map;if(c)for(var S of c)S.supplemental_otid!=null&&S.supplemental_key!=null&&v.set(S.supplemental_otid,S.supplemental_key);for(var R of b){var L=v.get(R);if(L==null){C=!1;break}var E=g.supplementalProtobufs.get(o("MpsTypes").toSupplementalKey(L));if(g.supplementalProtobufs.size>0&&E==null){C=!1;break}}}if(C){var k=d==null;return r.addAnnotations({bool:{missing_message_minos_restore:k}}),babelHelpers.extends({},t,{protobuf_stanzas:babelHelpers.extends({},_,{supplemental_protobufs:[],supplemental_protobufs_v2:c,top_level_protobuf:null,top_level_protobuf_unencrypted:null,top_level_protobuf_v2:p})})}return t})}l.dedupeEncryptedLabyrinthMessages=s}),98);
__d("EBDedupeLabyrinthMessages",["EBConvertMinosProtobufShape","MpsTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=new Map;return e.forEach(function(e,n){var r=o("EBConvertMinosProtobufShape").convertMinosProtobufShape(e);t.set(n,r)}),t}function s(t,n){if(n==null)return t;var r=e(n),a=[];t.forEach(function(e){if(e.otid!=null){var t=o("MpsTypes").toMessageId(e.otid),n=r.get(t);if(n!=null){var i=u(e.supplementalProtobufs,n.supplementalProtobufs);n.supplementalProtobufs=i,a.push(n),r.delete(t)}else a.push(e)}});for(var i of r.values())a.push(i);return a}function u(e,t){var n=new Map;return e.forEach(function(e,r){var o=t.get(r);o!=null?(n.set(r,o),t.delete(r)):n.set(r,e)}),t.forEach(function(e,t){n.set(t,e)}),n}l.dedupeLabyrinthMessages=s}),98);
__d("PublicKeyEncryptionUtils",["Promise","UInt8Array","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){}function u(e){return e!=null?e:new Uint8Array(0).buffer}function c(e,t,n,r,a){return o("UInt8Array").concatBytes([e,t,n,r,a]).buffer}function d(e,t,n,r){return o("XPlatReactCrypto").subtleImportKey("raw",e.buffer,"HKDF",!1,["deriveKey"]).then(function(e){return o("XPlatReactCrypto").subtleDeriveKey({hash:"SHA-256",info:n,name:"HKDF",salt:t},e,{length:256,name:"AES-GCM"},!1,[r])})}var m="key length is not 32";function p(e,t){if(e.length!==32)return t(m)}function _(t){return new(e||(e=n("Promise")))(function(e,n){return p(t,n),e()})}var f=32;l.assertValidCurvePoint=s,l.getSalt=u,l.concatAad=c,l.getAesKey=d,l.testKeyLength=p,l.assertKeyLength=_,l.keyLength=f}),98);
__d("PublicEncryptionCreateDecryptedData",["CryptoLogger","Promise","PublicKeyEncryptionUtils","RetUtil","XPlatReactCrypto","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("PublicKeyCrypto").__setRef("PublicEncryptionCreateDecryptedData"),u=r("requireDeferred")("X25519").__setRef("PublicEncryptionCreateDecryptedData");function c(e,t){var n=1+o("PublicKeyEncryptionUtils").keyLength+16,r=e.length;r<1+o("PublicKeyEncryptionUtils").keyLength+16&&t("CipherText length is "+r+", < "+n)}function d(e,t,n){var r=t[0];if(r!==e)return n("Unexpected version "+r)}function m(t){return new(e||(e=n("Promise")))(function(e,n){return d(1,t,n),c(t,n),e()})}function p(t,r){return new(e||(e=n("Promise")))(function(e,n){return o("PublicKeyEncryptionUtils").assertValidCurvePoint(t,n),o("PublicKeyEncryptionUtils").assertValidCurvePoint(r,n),e()})}function _(t,r,a,i,l,c){var d,_=new Uint8Array(l),f=new Uint8Array([1]),g=(d=o("PublicKeyEncryptionUtils")).getSalt(i),h=new Uint8Array(t),y=new Uint8Array(a),C=new Uint8Array(r),b=new Uint8Array(c);return(e||(e=n("Promise"))).all([o("PublicKeyEncryptionUtils").assertKeyLength(h),o("PublicKeyEncryptionUtils").assertKeyLength(C),o("PublicKeyEncryptionUtils").assertKeyLength(y)]).then(function(){return m(b)}).then(function(){return u.load()}).then(function(t){var r=b.slice(1,o("PublicKeyEncryptionUtils").keyLength+1),a=t.publicKeyFromBytes(r,t.KeyPurpose.Encryption);return p(a,y).then(function(){var i=o("PublicKeyEncryptionUtils").concatAad(f,y,h,r,_),l=function(o,i,l){var r=t.publicKeyFromBytes(o,t.KeyPurpose.Encryption),s=t.publicKeyFromBytes(i,t.KeyPurpose.Encryption),u=t.secretKeyFromBytes(l,t.KeyPurpose.Encryption);return r==null||s==null||u==null||a==null?(e||(e=n("Promise"))).resolve():(e||(e=n("Promise"))).resolve([r,s,u,a])};return l(h,y,C).then(function(e){if(e!=null)return{ephemeralPub:e[3],innerAad:i,receiverPriv:e[2],receiverPub:e[0],senderPub:e[1]}})})}).then(function(e){if(e!=null){var t=e.ephemeralPub,n=e.receiverPriv,r=e.senderPub,a=e.innerAad;return s.load().then(function(e){return e.receiverDeriveSharedSecret(n,t,r)}).then(function(e){return e==null?null:o("PublicKeyEncryptionUtils").getAesKey(e,g,a,"decrypt")}).then(function(e){if(e!=null){var t=new Uint8Array(12).buffer,n=b.slice(o("PublicKeyEncryptionUtils").keyLength+1).buffer;return o("XPlatReactCrypto").subtleDecrypt({additionalData:a,iv:new Uint8Array(t),name:"AES-GCM",tagLength:128},e,n)}})}}).then(function(t){return(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult(t))}).catch(function(t){var r=o("CryptoLogger").CryptoLogger("public_encryption_create_decrypted_data");return o("CryptoLogger").captureError(r,t).mustfix("Creation of decrypted data for public encryption failed"),(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult(void 0))})}l.default=_}),98);
__d("PublicEncryptionCreateEncryptedData",["CryptoLogger","Promise","PublicKeyEncryptionUtils","RetUtil","UInt8Array","XPlatReactCrypto","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("PublicKeyCrypto").__setRef("PublicEncryptionCreateEncryptedData"),u=r("requireDeferred")("X25519").__setRef("PublicEncryptionCreateEncryptedData");function c(e,t){if(e.byteLength>32)return t("PSK is too long")}function d(t,r){return new(e||(e=n("Promise")))(function(e,n){return o("PublicKeyEncryptionUtils").assertValidCurvePoint(r,n),c(t,n),e()})}function m(t,r,a,i,l,c){var m,p=new Uint8Array([1]),_=new Uint8Array(l),f=(m=o("PublicKeyEncryptionUtils")).getSalt(i),g=new Uint8Array(t),h=new Uint8Array(r),y=new Uint8Array(a);return(e||(e=n("Promise"))).all([o("PublicKeyEncryptionUtils").assertKeyLength(g),o("PublicKeyEncryptionUtils").assertKeyLength(h),o("PublicKeyEncryptionUtils").assertKeyLength(y)]).then(function(){return d(f,g)}).then(function(){return u.load()}).then(function(t){var r=t.generateKeys(t.KeyPurpose.Encryption),a=r.pk,i=o("PublicKeyEncryptionUtils").concatAad(p,h,g,a,_),l=function(o,a,i){var r=t.publicKeyFromBytes(o,t.KeyPurpose.Encryption),l=t.publicKeyFromBytes(a,t.KeyPurpose.Encryption),s=t.secretKeyFromBytes(i,t.KeyPurpose.Encryption);return r==null||l==null||s==null?(e||(e=n("Promise"))).resolve():(e||(e=n("Promise"))).resolve([r,l,s])};return l(g,h,y).then(function(e){return e==null?null:{ephemeralPriv:r.sk,ephemeralPubBytes:r.pk,innerAad:i,receiverPub:e[0],senderPriv:e[2],senderPub:e[1]}})}).then(function(e){if(e!=null){var t=e.ephemeralPubBytes,n=e.ephemeralPriv,r=e.senderPriv,a=e.receiverPub,i=e.innerAad;return s.load().then(function(e){return e.senderDeriveSharedSecret(r,n,a)}).then(function(e){if(e!=null)return o("PublicKeyEncryptionUtils").getAesKey(e,f,i,"encrypt")}).then(function(e){if(e!=null){var t=new Uint8Array(12).buffer;return o("XPlatReactCrypto").subtleEncrypt({additionalData:i,iv:new Uint8Array(t),name:"AES-GCM",tagLength:128},e,c)}}).then(function(e){if(e!=null){var n=new Uint8Array(e);return o("UInt8Array").concatBytes([p,t,n]).buffer}})}}).then(function(t){return(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult(t))}).catch(function(t){var r=o("CryptoLogger").CryptoLogger("public_encryption_create_encrypted_data");return o("CryptoLogger").captureError(r,t).mustfix("Creation of encrypted data for public encryption failed"),(e||(e=n("Promise"))).resolve(o("RetUtil").getNullableRetResult(void 0))})}l.default=m}),98);
__d("EBEpochUtils",["Base64Utils","EBCryptoUtils","FBLogger","I64","PublicEncryptionCreateDecryptedData","PublicEncryptionCreateEncryptedData"],(function(t,n,r,o,a,i,l){"use strict";var e,s="epoch_chaining",u="epoch_root_key",c="epoch_data_storage",d="epoch_data_metadata",m=18;function p(e){var t=new TextEncoder().encode("0").buffer;if(e==null||e.byteLength===0)return t;var n=new TextDecoder,o=n.decode(e),a=Number.parseInt(o,10);if(Number.isNaN(a))throw r("FBLogger")("messenger_web").mustfixThrow("currentEpochInt is NaN");var i=a+1;return new TextEncoder().encode(i.toString()).buffer}async function _(t,n,a){var i,l=[(i=o("EBCryptoUtils")).KEY_LEN,i.KEY_LEN],u=i.getBlobFromString([s,t,(e||(e=o("I64"))).to_string(n)].join(o("EBCryptoUtils").STRING_JOIN_SEPARATOR));if(u==null)throw r("FBLogger")("messenger_web").mustfixThrow("infoForEpochChaining is empty");var c=await o("EBCryptoUtils").createDerivedKeys(u,null,a,l);return{epoch_chaining_key:c[0],epoch_distribution_pre_shared_key:c[1]}}async function f(e,t,n,o,a,i){var l=await r("PublicEncryptionCreateDecryptedData")(e,t,n,o,h(a),i);return l[0]}async function g(e,t,n,o,a,i){var l=await r("PublicEncryptionCreateEncryptedData")(e,t,n,o,h(a),i);return l[0]}function h(e){return new TextEncoder().encode(["epoch_",e].join(o("EBCryptoUtils").STRING_JOIN_SEPARATOR)).buffer}async function y(e,t,n,r){var a=await o("EBCryptoUtils").createDerivedKeys(e,t,n,r);return a[0]}function C(e,t){var n=o("EBCryptoUtils").getBlobFromString(u);if(n==null)throw r("FBLogger")("messenger_web").mustfixThrow("epochRootKey is empty");return y(n,e,t,[o("EBCryptoUtils").KEY_LEN])}function b(e,t){var n=new TextEncoder().encode("meb/debug/fingerprint/"+t).buffer;if(n==null)throw r("FBLogger")("messenger_web").mustfixThrow("blob type for which fingerprints are supported is empty");return y(n,null,e,[m])}async function v(e,t,n){var r=[o("EBCryptoUtils").KEY_LEN],a=o("Base64Utils").fromArrayBuffer(t),i=[e,a].join(o("EBCryptoUtils").STRING_JOIN_SEPARATOR),l=await o("EBCryptoUtils").createDerivedKeys(new TextEncoder().encode(i).buffer,null,n,r);return l.length===0?Promise.resolve():l[0]}function S(e){return v(c,e.epochAnonIdBlob,e.epochRootKeyBlob)}async function R(e,t){var n=await L(t,e,d);if(n==null)throw r("FBLogger")("messenger_web").mustfixThrow("symmetricDecryptAndBase64Decode output is empty while decrypting backward edge");return o("Base64Utils").toArrayBuffer(n)}async function L(e,t,n){var a=new TextEncoder().encode(n).buffer;if(a==null)throw r("FBLogger")("messenger_web").mustfixThrow("aadBuffer is empty");var i=await o("EBCryptoUtils").symmetricEncryptionCreateDecryptedString(t,a,e);if(i==null)throw r("FBLogger")("messenger_web").mustfixThrow("decrypted_arraybuffer is empty");return new TextDecoder().decode(i)}l.getNextEpochId=p,l.generateEpochChainingAndDistributionPreSharedKey=_,l.decryptEpochKey=f,l.generateEncryptedEpochKey=g,l.deriveKey=y,l.generateEpochRootKey=C,l.getFingerPrint=b,l.createDerivedKeysForEpoch=v,l.deriveBackwardEdgeKey=S,l.decryptBackwardEdge=R}),98);
__d("LSEpochStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({ES_OPEN:1,ES_CLOSE:2});i.default=e}),66);
__d("MEBEpochDerivationResult",[],(function(t,n,r,o,a,i){var e=Object.freeze({SUCCESS:0,UNKNOWN_ERROR:1,EDGE_NEITHER_FORWARD_NOR_BACKWARD:2,FORWARD_DECRYPTION_FAILED:3,FORWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED:4,BACKWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED:5,BACKWARD_DECRYPTION_FAILED:6,MISSING_CLIENT_STATE:7,DEVICE_ID_MISMATCH:8,SOURCE_FINGERPRINT_MISMATCH:9,DEST_FINGERPRINT_MISMATCH:10,STORAGE_KEY_MISMATH:11,PSK_FINGERPRINT_MISMATCH:12,SOURCE_EPOCH_NOT_FOUND:13,FORWARD_EDGE_NOT_CONSECUTIVE:14,BACKWARD_EDGE_NOT_CONSECUTIVE:15,DERIVATION_DEST_EXISTS:16,DERIVATION_DEST_ANON_ID_EXISTS:17});i.default=e}),66);
__d("EBDeriveAndStoreEpochs",["Base64Utils","EBBase64Decode","EBEpochUtils","I64","LSAuthorityLevel","LSEpochStatus","MEBEpochDerivationResult","ReQL","WACryptoUtils","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t,n,a,i){var l,s,u,c,d=await o("EBEpochUtils").getNextEpochId(i.epochAnonIdBlob),m=a==null||(l=a.to_epoch)==null?void 0:l.epoch_anon_id;if(m==null)return o("WAResultOrError").makeError({errorMessage:"epoch forward edge target epoch anon id is null",resultCode:r("MEBEpochDerivationResult").FORWARD_EDGE_NOT_CONSECUTIVE});var p=r("EBBase64Decode")(m);if(new TextDecoder().decode(d)!==new TextDecoder().decode(p))return o("WAResultOrError").makeError({errorMessage:"epoch forward edge not consecutive",resultCode:r("MEBEpochDerivationResult").FORWARD_EDGE_NOT_CONSECUTIVE});var _=a==null||(s=a.from_epoch)==null?void 0:s.epoch_id,f=a==null||(u=a.from_epoch)==null?void 0:u.epoch_anon_id;if(_==null||f==null)return o("WAResultOrError").makeError({errorMessage:"fromEpochId or fromEpochAnonId is null",resultCode:r("MEBEpochDerivationResult").SOURCE_EPOCH_NOT_FOUND});var g=r("EBBase64Decode")(f),h=new TextDecoder().decode(g),y=await o("EBEpochUtils").generateEpochChainingAndDistributionPreSharedKey(h,(e||(e=o("I64"))).of_string(_),i.epochRootKeyBlob),C=y.epoch_distribution_pre_shared_key,b=await o("EBEpochUtils").getFingerPrint(C,"MEBCryptoPreSharedKey");if((n==null?void 0:n.psk_fingerprint)!==o("Base64Utils").fromArrayBuffer(b))return o("WAResultOrError").makeError({errorMessage:"epoch forward edge psk fingerprint mismatch",resultCode:r("MEBEpochDerivationResult").PSK_FINGERPRINT_MISMATCH});var v=n==null?void 0:n.epoch_storage_public_key;if(o("Base64Utils").fromArrayBuffer(t.epochStoragePublicKeyBlob)!==v)return o("WAResultOrError").makeError({errorMessage:"epoch forward edge storage key mismatch",resultCode:r("MEBEpochDerivationResult").STORAGE_KEY_MISMATH});var S=n==null?void 0:n.auth_public_key;if(S==null)return o("WAResultOrError").makeError({errorMessage:"epoch forward edge auth public key is null",resultCode:r("MEBEpochDerivationResult").FORWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});var R=a==null||(c=a.to_epoch)==null?void 0:c.epoch_anon_id;if(R==null)return o("WAResultOrError").makeError({errorMessage:"epoch forward edge target epoch anon id is null",resultCode:r("MEBEpochDerivationResult").FORWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});var L=n==null?void 0:n.encrypted_entropy;if(L==null)return o("WAResultOrError").makeError({errorMessage:"epoch forward edge encrypted entropy is null",resultCode:r("MEBEpochDerivationResult").FORWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});var E=r("EBBase64Decode")(S);if(E==null)return o("WAResultOrError").makeError({errorMessage:"epoch forward edge auth public key is null",resultCode:r("MEBEpochDerivationResult").FORWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});var k=r("EBBase64Decode")(L);if(k==null)return o("WAResultOrError").makeError({errorMessage:"epoch forward edge encrypted entropy is null",resultCode:r("MEBEpochDerivationResult").FORWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});var I=r("EBBase64Decode")(R),T=new TextDecoder().decode(I),D=await o("EBEpochUtils").decryptEpochKey(t.epochStoragePublicKeyBlob,t.epochStoragePrivateKeyBlob,E,C,T,k);return D==null?o("WAResultOrError").makeError({errorMessage:"epoch forward edge entropy is null",resultCode:r("MEBEpochDerivationResult").FORWARD_DECRYPTION_FAILED}):o("WAResultOrError").makeResult(await o("EBEpochUtils").generateEpochRootKey(y.epoch_chaining_key,D))}async function u(e,t,n){var a,i=t==null||(a=t.to_epoch)==null?void 0:a.epoch_anon_id;if(i==null)return o("WAResultOrError").makeError({errorMessage:"toEpochId is null",resultCode:r("MEBEpochDerivationResult").BACKWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});var l=o("EBEpochUtils").getNextEpochId(r("EBBase64Decode")(i));if(!o("WACryptoUtils").arrayBuffersEqual(l,e.epochAnonIdBlob))return o("WAResultOrError").makeError({errorMessage:"epoch backward edge not consecutive",resultCode:r("MEBEpochDerivationResult").BACKWARD_EDGE_NOT_CONSECUTIVE});var s=await o("EBEpochUtils").deriveBackwardEdgeKey(e);return s==null?o("WAResultOrError").makeError({errorMessage:"epoch backward edge storage key is null",resultCode:r("MEBEpochDerivationResult").STORAGE_KEY_MISMATH}):o("WAResultOrError").makeResult(await o("EBEpochUtils").decryptBackwardEdge(s,n))}async function c(t,n){var a,l,c,d,m=await t.runInTransaction(function(e){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.secure_encrypted_backups_client_state))},"readwrite",void 0,void 0,i.id+":224");if(m==null)return o("WAResultOrError").makeError({errorMessage:"client state is missing",resultCode:r("MEBEpochDerivationResult").MISSING_CLIENT_STATE});var p=n==null||(a=n.from_epoch)==null?void 0:a.epoch_id;if(p==null)return o("WAResultOrError").makeError({errorMessage:"fromEpochId is null",resultCode:r("MEBEpochDerivationResult").SOURCE_EPOCH_NOT_FOUND});var _=await t.runInTransaction(function(t){return t.secure_encrypted_backups_epochs.get((e||(e=o("I64"))).of_string(p))},"readwrite",void 0,void 0,i.id+":242");if(_==null)return o("WAResultOrError").makeError({errorMessage:"source epoch is missing",resultCode:r("MEBEpochDerivationResult").SOURCE_EPOCH_NOT_FOUND});var f=n==null||(l=n.from_epoch)==null?void 0:l.epoch_anon_id;if(f==null)return o("WAResultOrError").makeError({errorMessage:"fromEpochId or fromEpochAnonId is null",resultCode:r("MEBEpochDerivationResult").SOURCE_EPOCH_NOT_FOUND});var g=r("EBBase64Decode")(f);if(new TextDecoder().decode(_.epochAnonIdBlob)!==new TextDecoder().decode(g))return o("WAResultOrError").makeError({errorMessage:"epoch derivation source epoch anon id mismatch",resultCode:r("MEBEpochDerivationResult").SOURCE_FINGERPRINT_MISMATCH});var h=n==null?void 0:n.from_epoch_fingerprint,y=await o("EBEpochUtils").getFingerPrint(_.epochRootKeyBlob,"MEBEpochRootKey");if(o("Base64Utils").fromArrayBuffer(y)!==h)return o("WAResultOrError").makeError({errorMessage:"epoch derivation source epoch fingerprint mismatch",resultCode:r("MEBEpochDerivationResult").SOURCE_FINGERPRINT_MISMATCH});var C=n==null?void 0:n.forward_edge,b;if(C!=null)b=await s(m,C,n,_);else{var v=n==null?void 0:n.backward_edge;if(v==null)return o("WAResultOrError").makeError({errorMessage:"backward edge is null",resultCode:r("MEBEpochDerivationResult").BACKWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});b=await u(_,n,v)}var S=n==null?void 0:n.to_epoch_fingerprint,R=b.value,L=n==null||(c=n.to_epoch)==null?void 0:c.epoch_id,E=n==null||(d=n.to_epoch)==null?void 0:d.epoch_anon_id;if(L==null||E==null)return o("WAResultOrError").makeError({errorMessage:"target epoch id or anon id is null",resultCode:r("MEBEpochDerivationResult").FORWARD_SOURCE_EPOCH_NOT_FOUND_DEPRECATED});if(R==null)return b;var k=await o("EBEpochUtils").getFingerPrint(R,"MEBEpochRootKey");if(S!==o("Base64Utils").fromArrayBuffer(k))return o("WAResultOrError").makeError({errorMessage:"epoch derivation target epoch fingerprint mismatch",resultCode:r("MEBEpochDerivationResult").DEST_FINGERPRINT_MISMATCH});var I=r("EBBase64Decode")(E);return await t.runInTransaction(function(t){return t.secure_encrypted_backups_epochs.put({authorityLevel:(e||(e=o("I64"))).of_float(r("LSAuthorityLevel").AUTHORITATIVE),backupId:m.backupId,epochAnonIdBlob:I,epochId:e.of_string(L),epochRootKeyBlob:R,epochStatus:e.of_float(r("LSEpochStatus").ES_CLOSE)})},"readwrite",void 0,void 0,i.id+":331"),o("WAResultOrError").makeResult(R)}async function d(e,t){if((t==null?void 0:t.epoch_edges)==null)return[];var n=[];for(var o of t.epoch_edges){var a,i,l,s,u,d=await c(e,o),m={resultForEpochSync:{error_message:(a=d.error)==null?void 0:a.errorMessage,from:{epoch_anon_id:(i=o.from_epoch)==null?void 0:i.epoch_anon_id,epoch_id:o==null||(l=o.from_epoch)==null?void 0:l.epoch_id},has_backward_edge:(o==null?void 0:o.backward_edge)!=null,has_forward_edge:(o==null?void 0:o.forward_edge)!=null,result_code:d.success?r("MEBEpochDerivationResult").SUCCESS:d.error.resultCode,to:{epoch_anon_id:o==null||(s=o.to_epoch)==null?void 0:s.epoch_anon_id,epoch_id:o==null||(u=o.to_epoch)==null?void 0:u.epoch_id}}};n.push(m)}return n}l.deriveAndStoreEpochsNonLS=d}),98);
__d("EBEpochChangeListener",["EBIsEbEnabled","EBIsEbEnabledSubscriber","ReQL","WAPubSub","err"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$1=o("WAPubSub").simplePubSub(),this.$3=e}var t=e.prototype;return t.initialize=async function(){var e=this;await o("EBIsEbEnabled").isEbEnabledLS(this.$3.tables)&&this.$4(this.$3),await o("EBIsEbEnabledSubscriber").isEbEnabledSubscriber().then(function(t){t.subscribe(function(t){t?e.$4(e.$3):e.$2==null||e.$2()})})},t.$4=function(t){var e=this;return this.$2==null&&(this.$2=o("ReQL").fromTableAscending(t.tables.secure_encrypted_backups_epochs).subscribe(function(t,n){e.$1.publish(n)})),this.$2},t.subscribe=function(t){return this.$1.subscribe(t)},e})(),s;async function u(t){if(s!=null)return Promise.resolve();s=new e(t),await s.initialize()}function c(e){if(s==null)throw r("err")("EBEpochChangeListener is not initialized");return s.subscribe(e)}l.initEBEpochChangeListener=u,l.subscribeToEpochChanges=c}),98);
__d("EBMinosEncryptedMekVersion",["$InternalEnum","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum")({V1:1,V2:2}),s=e.V1,u=r("gkx")("19417")?e.V2:e.V1;l.MinosEncryptedMekVersion=e,l.INITIAL_VERSION=s,l.MINOS_ENCRYPTED_MEK_CURRENT_VERSION=u}),98);
__d("EBMinosClientConfig",["EBMinosEncryptedMekVersion","EBMinosMessageEncryptionVersion"],(function(t,n,r,o,a,i,l){"use strict";var e={preferredMekEncryptionVersion:o("EBMinosEncryptedMekVersion").MINOS_ENCRYPTED_MEK_CURRENT_VERSION,preferredMessageEncryptionVersion:o("EBMinosMessageEncryptionVersion").MINOS_MESSAGE_ENCRYPTION_CURRENT_VERSION};l.MINOS_CLIENT_CONFIG=e}),98);
__d("EBMinosWasmEncryptMekForDistribution",["EBMinosClientConfig","EBMinosEncryptedMekVersion","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WALongInt","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){function t(t){var n=t.ciphertext,r=t.version,a=o("WALongInt").maybeNumberOrThrowIfTooLarge(r);if(a==null)return o("WAResultOrError").makeError("missing-mek-encryption-version");var i=o("EBMinosEncryptedMekVersion").MinosEncryptedMekVersion.cast(a);return i==null?(o("EBMinosLogger").minosLogger.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast encrypted mek version: ",""])),a),o("WAResultOrError").makeError("invalid-mek-encryption-version")):o("WAResultOrError").makeResult({encryptedMek:o("EBMinosTypes").unsafeCastToEncryptedMek(n),mekEncryptionVersion:i})}return async function(n){var e=n.fromKeypair,r=n.mek,a=n.senderEpochHead,i=n.toEpochHead,l=n.toMailboxPk;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").EncryptMekForDistributionResultSpec,validateResult:t},{encryptMekForDistribution:{conf:o("EBMinosClientConfig").MINOS_CLIENT_CONFIG,fromKeypair:e,mek:r,senderEpochHead:a,toEpochHead:i,toMailboxPk:l}})}}var u=s();l.encryptMekForDistribution=u}),98);
__d("EBMinosWasmEncryptMeksForDistributionFromTransportSender",["EBMinosClientConfig","EBMinosEncryptedMekVersion","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WALongInt","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){function t(t){var n=t.encryptedMeks,r=t.ephemeralEncryptionPk,a=t.signature,i=t.signingPk,l=t.version,s=o("WALongInt").maybeNumberOrThrowIfTooLarge(l);if(s==null)return o("WAResultOrError").makeError("missing-mek-encryption-version");var u=o("EBMinosEncryptedMekVersion").MinosEncryptedMekVersion.cast(s);return u==null?(o("EBMinosLogger").minosLogger.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast encrypted mek version: ",""])),s),o("WAResultOrError").makeError("invalid-mek-encryption-version")):o("WAResultOrError").makeResult({encryptedMeks:n.map(o("EBMinosTypes").unsafeCastToEncryptedMek),encryptedMekVersion:u,ephemeralEncryptionPk:o("EBMinosTypes").unsafeCastToTransportSenderEphemeralPK(r),signature:o("EBMinosTypes").unsafeCastToTransportSenderEphemeralKeySig(a),signingPk:o("EBMinosTypes").unsafeCastToTransportSigningPK(i)})}return async function(n){var e=n.mek,r=n.recipientEpochHeads,a=n.recipientMailboxEncryptionPks,i=n.transportSigningKp;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").EncryptMeksForDistributionFromTransportSenderResultSpec,validateResult:t},{encryptMeksForDistributionFromTransportSender:{conf:o("EBMinosClientConfig").MINOS_CLIENT_CONFIG,mek:e,recipientEpochHeads:r,recipientMailboxEncryptionPks:a,transportSigningKp:i}})}}var u=s();l.createMinosWasmEncryptMeksForDistributionFromTransportSender=s,l.encryptMeksForDistributionFromTransportSender=u}),98);
__d("EBMinosWasmGenerateMek",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t=e.mek;return o("WAResultOrError").makeResult({key:o("EBMinosTypes").unsafeCastMekKey(t.key),mekId:o("EBMinosTypes").unsafeCastToMekId(t.mekId),rosterHash:o("EBMinosTypes").unsafeCastMekRosterHash(t.rosterHash)})}return async function(n){var t=n.epochHeads;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").GenerateMekResultSpec,validateResult:e},{generateMek:{epochHeads:t}})}}var s=e();l.generateMek=s}),98);
__d("WAPromiseMap",["Promise"],(function(t,n,r,o,a,i){"use strict";var e;function l(t,r){return(e||(e=n("Promise"))).resolve(t).then(function(t){return(e||(e=n("Promise"))).all(t.map(function(e,t){return r(e,t)}))})}i.promiseMap=l}),66);
__d("EBGenerateAndUploadMek",["EBMinosEncryptedMekVersion","EBMinosWasmEncryptMekForDistribution","EBMinosWasmEncryptMeksForDistributionFromTransportSender","EBMinosWasmGenerateMek","WAErrorMessage","WAPromiseMap","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e=["mekEncryptionVersion","mekEnvelopes"],s,u,c,d,m,p,_,f,g,h,y,C,b;async function v(t){var n=t.actThreadId,r=t.io,a=t.logger,i=t.msgUploadQpl,l=t.participantMailboxes,f=t.sender;a.DEV(s||(s=babelHelpers.taggedTemplateLiteralLoose(["start generate and upload mek"]))),i.addPoint("generate_mek_start");var g=l.map(function(e){var t=e.epochHead;return t}),h=await o("EBMinosWasmGenerateMek").generateMek({epochHeads:g});if(!h.success)return a.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["mek generated error: ",""])),h.error),o("WAResultOrError").makeError("generate-mek-error");i.addPoint("generate_mek_end"),a.DEV(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Sender type: ",". Epoch FBID: ",""])),f.senderType,f.senderEpochFbId),i.addPoint("get_minos_mailbox_key_end",{string:{senderType:f.senderType}}),a.DEV(d||(d=babelHelpers.taggedTemplateLiteralLoose(["start encrypy mek. senderType: ",""])),f.senderType),i.addPoint("encrypt_mek_envelopes_start");var y=h.value,C=await(f.senderType==="Minos"?S({fromKeypair:f.fromKeypair,logger:a,mek:y,participantMailboxes:l,senderEpochFbId:f.senderEpochFbId,senderEpochHead:f.senderEpochHead}):R({logger:a,mek:y,participantMailboxes:l,transportSigningKp:f.transportSigningKp}));if(!C.success)return i.addPoint("encrypt_mek_envelopes_fail"),o("WAResultOrError").makeError("encrypt-mek-error");i.addPoint("encrypt_mek_envelopes_end");var b=C.value,v=b.mekEncryptionVersion,L=b.mekEnvelopes,E=babelHelpers.objectWithoutPropertiesLoose(b,e);i.addAnnotations({int:{mek_encryption_version:v}}),i.addPoint("register_mek_gql_start");var k=await r.registerMinosMessageEncryptionKey({actThreadId:n,instanceKey:i.getInstanceKey(),mekEncryptionVersion:v,mekEnvelopes:L,mekId:y.mekId,mekRosterHash:y.rosterHash,sender:E}).catch(function(e){var t=o("WAErrorMessage").maybeGetMessageFromError(e);return a.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["upload mek runtime-error: ",". ",""])),t,e),o("WAResultOrError").makeError({errorName:"runtime-error",failReason:t})});if(k.success!==!0){var I=k.error,T=I.errorName,D=I.failReason;return a.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["upload mek error: ",". Reason: ",""])),T,D),i.addPoint("register_mek_gql_fail"),o("WAResultOrError").makeError("distribute-mek-error")}return i.addPoint("register_mek_gql_end"),a.DEV(_||(_=babelHelpers.taggedTemplateLiteralLoose(["register minos message encryption key success"]))),o("WAResultOrError").makeResult({mek:y,mekFbid:k.value.mekFbid})}async function S(e){var t=e.fromKeypair,n=e.logger,r=e.mek,a=e.participantMailboxes,i=e.senderEpochFbId,l=e.senderEpochHead,s=o("EBMinosEncryptedMekVersion").INITIAL_VERSION,u=await o("WAPromiseMap").promiseMap(a,async function(e){var a=e.epochHead,i=e.mailboxKey,u=e.mailboxKeyFbid,c=e.participantId,d=await o("EBMinosWasmEncryptMekForDistribution").encryptMekForDistribution({fromKeypair:t,mek:r,senderEpochHead:l,toEpochHead:a,toMailboxPk:i});if(!d.success)return n.ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["mek encryption error: ",""])),d.error),null;var m=d.value.mekEncryptionVersion;if(m!=null)s=m;else return n.ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["invalid encryptedMekVersion: ",""])),d.value.mekEncryptionVersion),null;return{encryptedMek:d.value.encryptedMek,mailboxKey:i,mailboxKeyFbid:u,participantId:c}}),c=u.filter(Boolean);return c.length===0?(n.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["no successful mek encryption results"]))),o("WAResultOrError").makeError("encrypt-mek-error")):o("WAResultOrError").makeResult({epochFbId:i,mekEncryptionVersion:s,mekEnvelopes:c,senderType:"Minos"})}async function R(e){var t=e.logger,n=e.mek,r=e.participantMailboxes,a=e.transportSigningKp,i=await o("EBMinosWasmEncryptMeksForDistributionFromTransportSender").encryptMeksForDistributionFromTransportSender({mek:n,recipientEpochHeads:r.map(function(e){var t=e.epochHead;return t}),recipientMailboxEncryptionPks:r.map(function(e){var t=e.mailboxKey;return t}),transportSigningKp:a});if(!i.success)return t.ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["mek encryption error: ",""])),i.error),o("WAResultOrError").makeError("encrypt-mek-error");if(i.value.encryptedMeks.length!==r.length)return t.ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["number of encrypted meks does not match number of participants"]))),o("WAResultOrError").makeError("encrypt-mek-error");var l=o("EBMinosEncryptedMekVersion").INITIAL_VERSION,s=r.map(function(e,n){var r=i.value.encryptedMekVersion;if(r!=null)l=r;else return t.ERROR(b||(b=babelHelpers.taggedTemplateLiteralLoose(["invalid encryptedMekVersion: ",""])),i.value.encryptedMekVersion),null;return{encryptedMek:i.value.encryptedMeks[n],mailboxKey:e.mailboxKey,mailboxKeyFbid:e.mailboxKeyFbid,participantId:e.participantId}}),u=s.filter(Boolean);return o("WAResultOrError").makeResult({ephemeralEncryptionPk:i.value.ephemeralEncryptionPk,mekEncryptionVersion:l,mekEnvelopes:u,senderType:"Transport",signature:i.value.signature,signingPk:i.value.signingPk})}l.generateAndUploadMek=v}),98);
__d("EBGenerateMessageTags",["EncryptedBackupsUploadEntity","MSGDataclassTypes.flow"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e){case o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.IMAGE:return o("MSGDataclassTypes.flow").MpsMessageTag.Photo;case o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.VIDEO:return o("MSGDataclassTypes.flow").MpsMessageTag.Video;case o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.GIF:return o("MSGDataclassTypes.flow").MpsMessageTag.Gif;case o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.PTT:return o("MSGDataclassTypes.flow").MpsMessageTag.Audio;case o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.DOCUMENT:return o("MSGDataclassTypes.flow").MpsMessageTag.File;default:return null}}l.generateEBMessageTags=e}),98);
__d("EBGetClientState",["EBLogger","EBMinosInterfaceTypes","I64","LSAuthorityLevel","LSIntEnum","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;async function c(t,n){var a=n!=null?await o("ReQL").firstAsync(o("ReQL").fromTableAscending(n.secure_encrypted_backups_client_state)):await o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.secure_encrypted_backups_client_state)),i=n!=null?await o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(n.secure_encrypted_backups_epochs)):await o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.tables.secure_encrypted_backups_epochs)),l=i.filter(function(e){return(s||(s=o("I64"))).equal(e.authorityLevel,(u||(u=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))}).map(function(e){return(s||(s=o("I64"))).to_string(e.epochId)});if(a==null){o("EBLogger").EBLogger("wmi").MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web Client state is null - unable to proceed with GQL restore"])));return}var c=(a==null?void 0:a.deviceId)!=null?o("EBMinosInterfaceTypes").unsafeCastToDeviceId((s||(s=o("I64"))).to_string(a==null?void 0:a.deviceId)):null,d=a.mailboxRootKeyBlob,m=a.ocmfClientStateBlob,p=o("EBMinosInterfaceTypes").unsafeCastToBackupFbid((s||(s=o("I64"))).to_string(a.backupId)),_=a.encryptionVersion;return{backupId:p,deviceId:c,encryptionVersion:_,locally_available_epochs:l,mailboxRootKey:d,ocmfClientStateBlob:m}}l.getClientState=c}),98);
__d("EBMinosWasmDeriveAttachmentAccessTokenSecret",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t=e.attachmentAccessTokenSecret;return o("WAResultOrError").makeResult(o("EBMinosTypes").unsafeCastToAttachmentAccessTokenSecret(t))}return async function(n){var t=n.mediaKey;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").DeriveAttachmentAccessTokenSecretResultSpec,validateResult:e},{deriveAttachmentAccessTokenSecret:{mediaKey:t}})}}var s=e();l.deriveAttachmentAccessTokenSecret=s}),98);
__d("EBMinosWasmDeriveAttachmentPrimaryKeySecret",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t=e.attachmentPrimaryKeySecret;return o("WAResultOrError").makeResult(o("EBMinosTypes").unsafeCastToAttachmentPrimaryKeySecret(t))}return async function(n){var t=n.mediaKey;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").DeriveAttachmentPrimaryKeySecretResultSpec,validateResult:e},{deriveAttachmentPrimaryKeySecret:{mediaKey:t}})}}var s=e();l.deriveAttachmentPrimaryKeySecret=s}),98);
__d("EBGetMinosAttachmentPayloadFromMpsMessage",["EBMinosTypes","EBMinosWasmDeriveAttachmentAccessTokenSecret","EBMinosWasmDeriveAttachmentPrimaryKeySecret","MpsMessageToBridgeWrapper","WAMediaUtils","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m;function p(e){var t,n,r=e.logger,a=e.message,i=e.qplFlow,l=o("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(a),s=l.deserialize(),u=(t=s.encryptedTransportMessage())==null?void 0:t.consumerMessage();if(u!=null)return _({consumerApplication:u,logger:r,qplFlow:i});var c=(n=s.encryptedTransportMessage())==null||(n=n.armadillo())==null?void 0:n.extendedContentMessage();return c!=null?f({extendedContentMessage:c,logger:r,qplFlow:i}):Promise.resolve([])}async function _(e){var t,n,r,a,i,l,s=e.consumerApplication,u=e.logger,c=e.qplFlow,d=s.attachmentMessage();if(d==null||((t=d.payload.integral)==null?void 0:t.receiverFetchId)!=null)return[];var m=d.kind,p=d.payload.integral,_=(n=p==null||(r=p.transport)==null?void 0:r.integral)!=null?n:{},f=_.mediaKey,y=(a=p==null||(i=p.transport)==null?void 0:i.ancillary)!=null?a:{},C=y.objectId,b=await g({logger:u,maybeMediaKey:f,maybeObjectId:C}),v=p==null||(l=p.transport)==null||(l=l.ancillary)==null||(l=l.thumbnail)==null?void 0:l.downloadableThumbnail,S=v==null?null:await g({logger:u,maybeMediaKey:v.mediaKey,maybeObjectId:v.objectId}),R=c.getInstanceKey().toString();return[b.success===!0?babelHelpers.extends({},b.value,{attachmentTraceId:R,mediaType:h(m)}):null,(S==null?void 0:S.success)===!0?babelHelpers.extends({},S.value,{attachmentTraceId:R,mediaType:o("EBMinosTypes").MinosAttachmentMediaType.MESSENGER_PREVIEW}):null].filter(Boolean)}async function f(t){var n=t.extendedContentMessage,r=t.logger,a=t.qplFlow,i=[n.favicon(),n.headerImage()].concat(n.previews()).filter(Boolean);if(i.length===0)return[];var l=await Promise.all(i.map(function(e){var t,n;return g({logger:r,maybeMediaKey:(t=e.integral)==null||(t=t.transport)==null||(t=t.integral)==null?void 0:t.mediaKey,maybeObjectId:(n=e.integral)==null||(n=n.transport)==null||(n=n.ancillary)==null?void 0:n.objectId})})),u=l.filter(function(e){return e.success===!0}),c=l.filter(function(e){return e.success===!1});return c.forEach(function(t){r.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to parse an attachment in XMA message: ",""])),t.error)}),u.length===0&&r.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to parse all attachments in XMA message"]))),u.map(function(e){return babelHelpers.extends({},e.value,{attachmentTraceId:a.getInstanceKey().toString(),mediaType:o("EBMinosTypes").MinosAttachmentMediaType.XMA})})}async function g(e){var t=e.logger,n=e.maybeMediaKey,r=e.maybeObjectId;if(n==null)return t.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Missing mediaKey in media message protobuf"]))),o("WAResultOrError").makeError("missing-media-key");if(r==null)return t.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Missing objectId in media message protobuf"]))),o("WAResultOrError").makeError("missing-object-id");var a=o("WAMediaUtils").castToMediaKey(n),i=await o("EBMinosWasmDeriveAttachmentPrimaryKeySecret").deriveAttachmentPrimaryKeySecret({mediaKey:a});if(!i.success)return t.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Failed to derive attachment primary key secret"]))),o("WAResultOrError").makeError("derive-primary-key-secret-error");var l=await o("EBMinosWasmDeriveAttachmentAccessTokenSecret").deriveAttachmentAccessTokenSecret({mediaKey:a});return l.success?o("WAResultOrError").makeResult({accessTokenSecret:l.value,primaryKeySecret:i.value,zippyObjectId:o("WAMediaUtils").stringToDeliveryObjectId(r)}):(t.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Failed to derive attachment access token secret"]))),o("WAResultOrError").makeError("derive-access-token-secret-error"))}function h(e){return e==="audioTransport"?o("EBMinosTypes").MinosAttachmentMediaType.PTT:e==="imageTransport"?o("EBMinosTypes").MinosAttachmentMediaType.IMAGE:e==="videoTransport"?o("EBMinosTypes").MinosAttachmentMediaType.VIDEO:e==="stickerTransport"?o("EBMinosTypes").MinosAttachmentMediaType.STICKER:e==="documentTransport"?o("EBMinosTypes").MinosAttachmentMediaType.DOCUMENT:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}l.getMinosAttachmentPayloadFromMpsMessage=p}),98);
__d("EBGraphQLRestoreDefinition",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}i.toMpsMessageQueryForGraphQLQuery=e}),66);
__d("EBSMAPI",["EBDeps"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return e!=null||(e=o("EBDeps").getDeps().getEBSMAPI()),e}var u={addDeviceWithEBKeys:async function(){var e;return(e=await s()).addDeviceWithEBKeys.apply(e,arguments)},addDeviceWithRecoveryCode:async function(){var e;return(e=await s()).addDeviceWithRecoveryCode.apply(e,arguments)},addVirtualDevice:async function(){var e;return(e=await s()).addVirtualDevice.apply(e,arguments)},deleteBackupsOnClient:async function(){var e;return(e=await s()).deleteBackupsOnClient.apply(e,arguments)},deleteEncryptedBackup:async function(){var e;return(e=await s()).deleteEncryptedBackup.apply(e,arguments)},ebOptOut:async function(){var e;return(e=await s()).ebOptOut.apply(e,arguments)},fetchBackupIds:async function(){var e;return(e=await s()).fetchBackupIds.apply(e,arguments)},generateRecoveryCode:async function(){var e;return(e=await s()).generateRecoveryCode.apply(e,arguments)},getEBState:async function(){return(await s()).getEBState()},getLSVirtualDevices:async function(t){return(await s()).getLSVirtualDevices(t)},initializeBackup:async function(){var e;return(e=await s()).initializeBackup.apply(e,arguments)},isEbEnabled:async function(){var e;return(e=await s()).isEbEnabled.apply(e,arguments)},optOutOfBackup:function(){return Promise.resolve()},otcAddDevice:async function(){var e;return(e=await s()).otcAddDevice.apply(e,arguments)},repairEpochs:async function(){return(await s()).repairEpochs()},revokeVirtualDevice:async function(){var e;return(e=await s()).revokeVirtualDevice.apply(e,arguments)},syncEpochs:async function(){return(await s()).syncEpochs()}},c=u;l.default=c}),98);
__d("RecoveryCodeDB",["MAWCurrentUser","MAWIndexedDbMetadata","MAWODSProxy","MessengerWebInitData","QPLFlow","WAHex","WALogger","WAOdsEnums","WAResolvable","Worm","WormEAR","WormIDbDriver","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u={persisted_recovery_code:{indexes:{},primaryKey:"pk"}},c=1e4,d=new(o("WAResolvable")).Resolvable;async function m(){var t=o("MAWIndexedDbMetadata").ebRecoveryCodeDBName(o("MAWCurrentUser").getID()),n=o("WAHex").parseHex(r("MessengerWebInitData").accountKeyV2),a={log:function(t){return o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_RECOVERY_CODE_DB,key:t})}},i=r("qpl")._(1056840657,"2716"),l=o("QPLFlow").startQPLFlow(i,{annotations:{string:{dbType:"recovery_code_db",operationType:"initRecoveryCodeDB"}},timeoutInMs:c});try{var m="recovery_code_db",p=new(o("WormEAR")).WormEAR(u,m,n),_=new(o("Worm")).WormDatabase(new(o("WormIDbDriver")).WormIDbDriver(t,m,u,p,a,{onTransactionError:function(n){n instanceof o("WormEAR").DecryptionError&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Error decrypting RecoveryCodeDB"])))},safeToDeleteStores:new Set(["migration"])}),i);await _.init({eventFlow:l}),l.endSuccess(),d.resolve(_)}catch(e){throw l.endFail("error"),o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Error initializing RecoveryCodeDB: ",""])),e),d.reject(e),e}}async function p(){return d.resolveWasCalled()||await m(),d.promise}l.schema=u,l.getOrCreateRecoveryCodeDB=p}),98);
__d("EBOnboardDeviceWithAutomaticEB",["EBIsEbEnabled","EBLogger","EBSMAPI","LSAuthorityLevel","MAWCurrentUser","MAWODSProxy","RecoveryCodeDB","WAOdsEnums","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("EBLogger").EBLogger().tags(["EBOnboardDeviceWithAutomaticEB"]);async function m(){try{var t=await o("EBIsEbEnabled").isEBEnabled();if(t){d.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["EB is already enabled, skipping onboard with recovery code"])));return}d.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["EB is not enabled, checking for recovery code in database"])));var n=await o("RecoveryCodeDB").getOrCreateRecoveryCodeDB(),a=await n.runInTransaction(["persisted_recovery_code"],"readonly",async function(e){var t=await e.stores.persisted_recovery_code.readAll(),n=t.find(function(e){return e.authorityLevel===r("LSAuthorityLevel").AUTHORITATIVE});return n==null?void 0:n.recoveryCode},"RecoveryCodeDB - read recovery code for adding device");if(a==null){d.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["No recovery code found in database"])));return}d.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Found recovery code in database, attempting to add device"]))),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.AUTOMATIC_EB,key:"onboard_device_with_recovery_code.attempt"});var i=await r("EBSMAPI").addDeviceWithRecoveryCode({recoveryCode:a,userId:o("MAWCurrentUser").getID()});i.success?(d.info("Successfully added device with recovery code from database"),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.AUTOMATIC_EB,key:"onboard_device_with_recovery_code.success"})):(d.warn("Failed to add device with recovery code: "+i.error),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.AUTOMATIC_EB,key:"onboard_device_with_recovery_code.failure."+i.error}),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.AUTOMATIC_EB,key:"onboard_device_with_recovery_code.failure"}))}catch(e){d.catching(r("getErrorSafe")(e)).warn("Failed to onboard device with automatic EB after EBLS init")}}l.onboardDeviceWithAutomaticEB=m}),98);
__d("EBResumeAutomaticEBInitialisation",["EBLogger","EBSMAPI","LSAuthorityLevel","LSIntEnum","RecoveryCodeDB","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(){try{var t=await o("RecoveryCodeDB").getOrCreateRecoveryCodeDB(),n=await t.runInTransaction(["persisted_recovery_code"],"readonly",async function(e){var t=await e.stores.persisted_recovery_code.readAll(),n=t.find(function(e){return e.virtualDeviceType===16&&e.authorityLevel===r("LSAuthorityLevel").OPTIMISTIC});return n!=null},"FetchOptimisticRecoveryCode");n&&(o("EBLogger").EBLogger().info("Found existing optimistic recovery code, resuming backup initialization"),await r("EBSMAPI").initializeBackup({virtualDeviceId:null,virtualDeviceType:(e||(e=o("LSIntEnum"))).ofNumber(16)}))}catch(e){o("EBLogger").EBLogger().catching(r("getErrorSafe")(e)).warn("Failed to resume initialization from optimistic recovery code")}}l.resumeAutomaticEBInitialisation=s}),98);
__d("EBSMProperties",[],(function(t,n,r,o,a,i){"use strict";var e=["encrypted_backups_virtual_devices","secure_encrypted_backups_recovery_code_status","device_metadata","secure_encrypted_backups_epochs","secure_encrypted_backups_client_state","encrypted_backups","experiences_shared_state","auto_restore_opt_out"],l=new Set(["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"]),s={dbVersion:5,mandatoryTables:l,persistedTables:new Set(e),persistedTablesArray:e},u=s;i.default=u}),66);
__d("MWEBODSEntityKey.enum",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({START:"start",SUCCESS:"success",FAIL:"fail",INCORRECT_PIN_CODE:"incorrect_pin_code",INCORRECT_RECOVERY_CODE:"incorrect_recovery_code",TIMEOUT:"timeout",CANCEL:"cancel"}),l=e;i.default=l}),66);
__d("MWEncryptedBackupsFirstRestoreUpsellTime",["EBAPIWorkerCheck","FBLogger","WebStorage","getErrorSafe","getMWEncryptedBackupsIsLocalStorageSupported"],(function(t,n,r,o,a,i,l){"use strict";var e,s="mw_encrypted_backups_restore_upsell_first_impression_time_key";function u(){var t=Date.now().toString();if(o("EBAPIWorkerCheck").runningInWorker())return d(t);if(!o("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported())return t;try{var n,a=(n=(e||(e=r("WebStorage"))).getLocalStorage())==null?void 0:n.getItem(s);if(a==null){var i;return(i=(e||(e=r("WebStorage"))).getLocalStorage())==null||i.setItem(s,t),t}return a}catch(e){return r("FBLogger")("wmi_eb").warn("[labyrinth][web] Failed to set EB session identifier due to %s",r("getErrorSafe")(e).message),t}}var c=null;function d(e){return c==null&&(c=e),c}l.MW_ENCRYPTED_BACKUPS_RESTORE_UPSELL_FIRST_IMPRESSION_TIME_KEY=s,l.getFirstRestoreUpsellTime=u,l.getFirstRestoreUpsellTimeForEBLS=d}),98);
__d("QPLMemoryUtils",["MemoryUtils","QPLUserFlow"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=o("MemoryUtils").getCurrentMemory(),n=t.usedJSHeapSize;r("QPLUserFlow").addAnnotations(e,{int:{usedJSHeapSizeStart:n}})}function s(e){var t=o("MemoryUtils").getCurrentMemory(),n=t.usedJSHeapSize;r("QPLUserFlow").addAnnotations(e,{int:{usedJSHeapSizeEnd:n}})}l.logMemoryForQPLStart=e,l.logMemoryForQPLEnd=s}),98);
__d("createReStoreEBSMTablesPersistence",["CurrentMessengerUser","EBLogger","MAWUnrecoverableDbErrors","MWEBODSCategory","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsLocalStorageEntryEnum","ODS","QPLMemoryUtils","QPLUserFlow","Random","ReStorePersistence","ReStoreTabNotifier","WebSession","getErrorSafe","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("CurrentMessengerUser").getIDorEIMU(),d=r("ReStoreTabNotifier")==null?void 0:r("ReStoreTabNotifier")("mwChat-"+c),m=null,p=!1,_=!1,f=o("EBLogger").EBLogger().tags(["EBSM","Pesistence","MainThread"]);function g(e,t,n){var r=e.get(t);if(r!==void 0)return r;var o=n();return e.set(t,o),o}function h(t){var n=Promise.resolve(),a="flushChangesV2",i=new Map;function l(e){return g(i,e,function(){return new Map})}var c=o("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();r("QPLUserFlow").start(r("qpl")._(521481876,"1407"),{annotations:{string:{ebSessionIdentifier:c,sessionTabId:o("WebSession").getId()}}}),(u||(u=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),r("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,r("MWEBODSEntityKey.enum").START),o("QPLMemoryUtils").logMemoryForQPLStart(r("qpl")._(521481876,"1407"));async function h(){try{await t.rehydrateEBSMFromEBDB(l),o("QPLMemoryUtils").logMemoryForQPLEnd(r("qpl")._(521481876,"1407")),r("QPLUserFlow").endSuccess(r("qpl")._(521481876,"1407")),(u||(u=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),r("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,r("MWEBODSEntityKey.enum").SUCCESS)}catch(t){r("QPLUserFlow").addPoint(r("qpl")._(521481876,"1407"),"EBSM_HYDRATION_FAILED");var n=r("getErrorSafe")(t);f.MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["An error occured in EBSM hydration when loading EB data: ",""])),n.message),r("QPLUserFlow").endFailure(r("qpl")._(521481876,"1407"),"Hydration failed."),(u||(u=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),r("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,r("MWEBODSEntityKey.enum").FAIL)}}return m=h(),d==null||d.onEventReceive("flushChangesV2",function(e){var n=e.changeSet,i=new Map;if(n.forEach(function(e,t){i.set(t,{toAdd:[],toDelete:[]});var n=l(t);e.forEach(function(e,r){if(o("ReStorePersistence").isDeletedValue(e,o("ReStorePersistence").sentinelDeleted)){var a;(a=i.get(t))==null||a.toDelete.push(n.get(r))}else{var l;(l=i.get(t))==null||l.toAdd.push(e)}})}),t.updateEBSM==null){f.MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["ebdbEbsmApi.updateEBSM is not defined"])));return}r("promiseDone")(t.updateEBSM(i,a))}),{flush:async function(n,i){var e,s;if(n.size!==0&&(n.size>0&&n.forEach(function(e,t){e.size===0&&n.delete(t)}),n.size!==0)){var u=((e=i.actionSource)==null?void 0:e.type)==="user_initiated"&&((s=i.actionSource)==null?void 0:s.source)===a;if(u){n.forEach(function(e,t){var n=l(t);e.forEach(function(e,t){o("ReStorePersistence").isDeletedValue(e,o("ReStorePersistence").sentinelDeleted)?n.delete(t):n.set(t,e)})});return}var c=new Map;n.forEach(function(e,t){c.set(t,{toAdd:[],toDelete:[]});var n=l(t);e.forEach(function(e,r){if(o("ReStorePersistence").isDeletedValue(e,o("ReStorePersistence").sentinelDeleted)){var a;(a=c.get(t))==null||a.toDelete.push(n.get(r)),n.delete(r)}else{var i;(i=c.get(t))==null||i.toAdd.push(e),n.set(r,e)}})}),d==null||d.postMessage("flushChangesV2",{changeSet:n,fromVersion:"",sentinelDeleted:o("ReStorePersistence").sentinelDeleted,version:""});var p=o("Random").uint32(),_=Array.from(n.keys());r("QPLUserFlow").start(r("qpl")._(521485383,"2200"),{annotations:{bool:{ebsmv2:!0},string_array:{tables:_}},instanceKey:p}),await m,await t.flushEBSMtoEBDB(c).catch(function(){})}},get:function(t,n,r){var e=l(n);return p?e.get(r):m==null?Promise.reject("rehydration is not complete"):m.then(function(){return p=!0,e.get(r)})},logError:function(n,a,i,l){if((u||(u=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),r("MWEBODSEntityName.enum").MW_EBSM_RESTORE_PERSISTENCE_ERROR,n),i==="dbCorruption"){var e,s;(u||(u=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),r("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION,n);var c="Got unexpected undefined in ebsm, mode: "+a+", table: "+n+", id: "+((e=l==null?void 0:l.id)!=null?e:"")+", deletedInThisTxn: "+((s=l==null?void 0:l.deletedInThisTxn)!=null?s:"")+". Deleting EBSM db";f.mustfix(c);var d=o("Random").uint32();o("MAWUnrecoverableDbErrors").setError(new(o("MAWUnrecoverableDbErrors")).EbsmHydrationError(c,!0,d,n),function(){r("promiseDone")(t.clearEbStores(),function(){(u||(u=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),r("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION,"db_deleted.main_thread")})}),_||(_=!0,o("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(r("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE,"full"))}},queueCommitWork:void 0,runExclusively:function(t){return new Promise(function(e,r){n=n.then(async function(){var n=await t(),o=n[0],a=n[1];try{e(await o())}catch(e){r(e)}})})},shouldApplySync:function(){return!1},shouldInline:function(t,n){return!1},shouldSync:function(t,n){return t!=="notifyInMemoryTable"},tabTablesNotifier:function(){return d},types:["ephemeral"],uniqueId:""}}l.default=h}),98);
__d("createReStoreTableNameAllowListPersistence",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n){var r;return{clearCache:function(){e.clearCache==null||e.clearCache(),t.clearCache==null||t.clearCache()},close:function(){e.close==null||e.close(),t.close==null||t.close()},flush:async function(o,a){var r=new Map,i=new Map;o.forEach(function(e,t){n.has(t)?i.set(t,e):r.set(t,e)}),await Promise.all([e.flush(r,a),t.flush(i,a)])},get:function(o,a,i,l){return n.has(a)?t.get(o,a,i,l):e.get(o,a,i,l)},isClosed:function(){return(e.isClosed==null?void 0:e.isClosed())||!1},isPersistenceSupported:e.isPersistenceSupported,logError:function(o,a,i,l){n.has(o)?t.logError==null||t.logError(o,a,i,l):e.logError==null||e.logError(o,a,i,l)},permitsSynchronousIO:function(o){if(n.has(o)){var r;return(r=t.permitsSynchronousIO==null?void 0:t.permitsSynchronousIO(o))!=null?r:!1}else{var a;return(a=e.permitsSynchronousIO==null?void 0:e.permitsSynchronousIO(o))!=null?a:!1}},runExclusively:function(r,o){return e.runExclusively(function(){return new Promise(function(e,n){var a=t.runExclusively(async function(){var t=await r(),n=t[0],o=t[1],i=new Promise(function(t){e([function(){return t(),a},o])});return[async function(){return await i,n()},o]},o);a.catch(n)})},o)},shouldApplySync:function(o,a){return n.has(a)?t.shouldApplySync(o,a):e.shouldApplySync(o,a)},shouldInline:function(o,a){return n.has(o)?t.shouldInline(o,a):e.shouldInline(o,a)},shouldSync:function(o,a){return n.has(a)?t.shouldSync(o,a):e.shouldSync(o,a)},tabTablesNotifier:(r=e.tabTablesNotifier)!=null?r:t.tabTablesNotifier,types:[].concat(e.types,t.types),uniqueId:t.uniqueId+e.uniqueId}}i.default=e}),66);
__d("LSJSEBInMemoryStorage",["EBSMProperties","createLSReStoreEphemeralPersistence","createReStoreEBSMTablesPersistence","createReStoreTableNameAllowListPersistence"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=r("createReStoreTableNameAllowListPersistence")(o("createLSReStoreEphemeralPersistence").createLSReStoreEphemeralPersistence(),r("createReStoreEBSMTablesPersistence")(e),r("EBSMProperties").persistedTables);return t}l.makeReStorePersistence=e}),98);
__d("EBWorkerAddDeviceUtils",["EBDB","EBDBEbsmApi","EBSMProperties","I64","LSAuthorityLevel","LSIntEnum","LSJSEBInMemoryStorage","LSMetadata","LSReStoreWrapper","MAWLSVaultingHooks","ReQL","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(t,n){var a=await o("ReQL").firstAsync(o("ReQL").fromTableAscending(n.tables.secure_encrypted_backups_client_state));if(a!=null)return"dest_table_not_empty";var l={clearEbStores:o("EBDB").clearEbStores,flushEBSMtoEBDB:o("EBDBEbsmApi").flushEBSMtoEBDB,rehydrateEBSMFromEBDB:o("EBDBEbsmApi").rehydrateEBSMFromEBDB,updateEBSM:function(){return Promise.resolve()}},u=await o("LSJSEBInMemoryStorage").makeReStorePersistence(l);if(u==null)throw r("err")("persistence is null");var c=o("LSReStoreWrapper").createLSReStore(u,o("LSMetadata").schema,[r("MAWLSVaultingHooks")],void 0),d=await o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(c.tables.secure_encrypted_backups_epochs));return d.filter(function(t){return(e||(e=o("I64"))).equal(t.authorityLevel,(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))}).length===0?"source_epoch_not_authoritative":c.runInTransaction(function(e){return n.runInTransaction(async function(n){var r=await Promise.all(t.map(async function(t){var r=e[t],o=r.entries(new WeakMap),a=await o.next();if(a.done)return"source_table_empty";for(var i=n[t];!a.done;){var l=a.value,s=l[0],u=l[1];await i.upsert(s,u),a=await o.next()}return"success"})),o=new Set(r);return o.has("source_table_empty")?"source_table_empty":o.has("success")&&o.size===1?"success":"fail"},"readwrite",void 0,void 0,i.id+":91")},"readonly",void 0,void 0,i.id+":89")}async function c(e){await e.runInTransaction(function(e){return Promise.all(r("EBSMProperties").persistedTablesArray.map(async function(t){for(var n=e[t],r=n.entries(new WeakMap),o=await r.next();!o.done;)await n.delete.apply(n,o.value[0]),o=await r.next()}))},"readwrite",void 0,void 0,i.id+":131")}l.copyEBStateTablesFromMainthreadToWorker=u,l.clearLSEBSMTables=c}),98);
__d("LSDedicatedMqttChannel",["FBMqttChannel","cr:1232"],(function(t,n,r,o,a,i,l){"use strict";function e(){n("cr:1232")!=null&&n("cr:1232").shutdownAndClear()}function s(e,t,o,a,i,l){return function(s){return n("cr:1232")!=null?n("cr:1232").getInstance(s,e,t,o,a,i,l):r("FBMqttChannel")}}l.shutdownAndClear=e,l.getInstance=s}),98);
__d("MAWEBLSInWorkerSwitch",["MAWEBEnabledStateManager"],(function(t,n,r,o,a,i,l){"use strict";var e=new(o("MAWEBEnabledStateManager")).MAWEBEnabledStateManager,s=e;l.default=s}),98);
__d("LSFetchBackupIds",["LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure] Beginning execution."),r[11]=t.i64.cast([0,0]),r[7]=r[11],r[8]=new t.Map,r[8].set("backup_tenancy",e[0]),r[8].set("trace_id",void 0),r[9]=t.toJSON(r[8]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50008]),r[9],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,r[7]).then(function(e){var t;return t=e,r[10]=t[0],t})},function(e){return r[1]=t.i64.of_float(Date.now()),r[2]=t.i64.random(),r[4]="Finishing execution. Execution time: ",r[5]=t.i64.to_string(t.i64.sub(r[1],r[0])),r[6]=" ms",r[3]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure] ",r[3],r[4],r[3],r[5],r[3],r[6]].join("")),t.i64.eq(t.i64.mod_(r[2],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[7]=",",r[8]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchBackupIdsStoredProcedure",[r[4],r[7],r[5],r[7],r[6]].join(""),r[8],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsFetchBackupIdsStoredProcedure",e.__tables__=["encrypted_backups"],a.exports=e}),null);
__d("LSFetchBackupIdsStoredProcedure",["LSFetchBackupIds","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSFetchBackupIds"),a.backupTenancy,a.traceId,a.isUiBlocking);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("isInstamadilloEB",["qex"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("qex")._("670")===!0}l.default=e}),98);
__d("MWEncryptedBackupsListenForChangesToBackupStateInitPath",["EBSMAPI","I64","LSAuthorityLevel","LSEncryptedBackupsBackupTenancy","LSFactory","LSFetchBackupIdsStoredProcedure","LSIntEnum","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","QPLEvent","QPLUserFlow","ReQL","WebSession","isInstamadilloEB","promiseDone","qex"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=r("qex")._("121")===!0;function d(t){function n(){r("promiseDone")(r("EBSMAPI").fetchBackupIds("MWEncryptedBackupsListenForChangesToBackupStateInitPath"),function(){return void 0})}function a(){var n=o("ReQL").fromTableAscending(t.tables.encrypted_backups),a=n.subscribe(function(t,n){n.operation==="delete"||!(e||(e=o("I64"))).equal(n.value.authorityLevel,(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))||(a(),r("QPLUserFlow").getActiveFlowIDs().includes((u||(u=o("QPLEvent"))).getMarkerId(o("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))&&o("MWChatEncryptedBackupsLogging").endSuccess({event:o("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent}))}),l=o("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();r("QPLUserFlow").getActiveFlowIDs().includes((u||(u=o("QPLEvent"))).getMarkerId(o("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))||r("QPLUserFlow").start(o("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:l,fetchBackupIdsVersion:"msys",sessionTabId:o("WebSession").getId()}}}),r("promiseDone")(t.runInTransaction(function(e){return r("LSFetchBackupIdsStoredProcedure")(r("LSFactory")(e),{backupTenancy:(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsBackupTenancy").PRODUCTION),isUiBlocking:!1})},"readwrite",void 0,void 0,i.id+":86"),function(){return void 0})}var l=n;(c||r("isInstamadilloEB")())&&(l=a,l());var d=o("ReQL").fromTableAscending(t.tables.encrypted_backups_status_trigger);return d.subscribe(l)}function m(e){}var p={listenForChangesToBackupState:d,preloadEBData:m};l.default=p}),98);
__d("EBLS",["EBDB","EBDBEbsmApi","EBEpochChangeListener","EBIsEbEnabled","EBIsEbEnabledSubscriber","EBLogger","EBOnboardDeviceWithAutomaticEB","EBReadyNotifier","EBReenrollmentTriggerListener","EBResumeAutomaticEBInitialisation","EBWorkerAddDeviceUtils","I64","LSAuthorityLevel","LSDataTraceFlushDeferred","LSDatascriptEvaluatorMaybeDeferred","LSDedicatedMqttChannel","LSDefaultSyncGroups","LSDeleteAllAndInsertConnectivityStatusStoredProcedure","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSInternetConnectionState","LSJSEBInMemoryStorage","LSMetadata","LSPlatformDeviceId","LSPlatformMessengerSyncParams","LSPlatformMqttRealtimeTransport","LSPlatformRealtimeTransport","LSPlatformTaskSystemTransport","LSReStoreWrapper","LSVersion","MAWBridge","MAWEBLSInWorkerSwitch","MAWLSVaultingHooks","MAWODSProxy","MAWVaultMaterialsStorage","MWEncryptedBackupsListenForChangesToBackupStateInitPath","MWPlatformTaskSystem","MqttEnv","QPLUserFlow","ReQL","ServerAppID","WAAssertUnreachable","WAOdsEnums","WAPromiseDelays","WAResolvable","emptyFunction","err","getMWLSRegion","justknobx","nullthrows","promiseDone","qpl","vulture"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x,$=o("EBLogger").EBLogger().tags(["EBLS"]),P=r("qpl")._(521478817,"2806");function N(){return F()}var M,w,A;function F(){return M?M.promise:O({copyKeys:!0,getNewDB:!1}).promise}function O(e){M!=null&&!M.isSettled&&M.reject(r("err")("LSClient is not settled")),w!=null&&!w.isSettled&&w.reject(r("err")("LSDBStorage is not settled"));var t=new(o("WAResolvable")).Resolvable;return M=t,w=null,B(e).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t}async function B(t){var n,a=t.getNewDB;o("EBReadyNotifier").resetEBReady(),(n=r("QPLUserFlow")).start(P,{timeoutInMs:6e4}),n.addPoint(P,"ls_storage_creation_start");var i=await q(a);n.addPoint(P,"ls_storage_creation_end"),n.addPoint(P,"eb_worker_add_device_skipped"),n.endSuccess(P),o("EBReadyNotifier").markEBReady(),$.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Initialised db"])));var l={appId:r("nullthrows")(r("ServerAppID").app_id),executeGraphQLLightSpeedRequest:async function(){r("vulture")("ZrOlCWyJ0L0hG2xX4QdNxz1doLM=");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=await o("MAWBridge").getBridge().sendAndReceive("event","executeGraphQLLightSpeedRequest",{args:t});return a},getDb:q,getEval:function(){return r("LSDatascriptEvaluatorMaybeDeferred")()},platformName:"Messenger",realtimeUnderylingTransport:function(){return Promise.resolve(function(e,t){var n;return r("LSPlatformMqttRealtimeTransport")(r("LSVersion"),t,{getInstance:o("LSDedicatedMqttChannel").getInstance(function(){return!0},(n={},n[o("MqttEnv").MqttGkNames.mqttweb_global_connection_counter]=!1,n),function(e,t){return t},r("emptyFunction")),shutdownAndClear:o("LSDedicatedMqttChannel").shutdownAndClear})})},region:r("getMWLSRegion")(),schemaVersion:r("LSVersion"),sendHardcodedInitSync:!1,syncParams:r("LSPlatformMessengerSyncParams")};$.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["created config"]))),r("QPLUserFlow").addAnnotations(P,{string:{appId:l.appId}});var c=o("LSPlatformDeviceId").getDeviceIdForProviderType("ephemeral");r("QPLUserFlow").addPoint(P,"platform_client_init_start");var d=await G(i,l,c);return r("QPLUserFlow").addPoint(P,"platform_client_init_end"),A=await W(i),$.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["finished init successfully"]))),d}async function W(e){var t=z(e);return await o("EBIsEbEnabledSubscriber").initIsEbEnabledPubSub(e),await o("EBEpochChangeListener").initEBEpochChangeListener(e),await o("EBReenrollmentTriggerListener").initEBReenrollmentTriggerListener(e),o("EBResumeAutomaticEBInitialisation").resumeAutomaticEBInitialisation(),r("justknobx")._("862")&&o("EBOnboardDeviceWithAutomaticEB").onboardDeviceWithAutomaticEB(),t}async function q(e){if(e===void 0&&(e=!1),!e&&w!=null)return w.promise;var t=new(o("WAResolvable")).Resolvable;w=t,await o("MAWVaultMaterialsStorage").setupVaultMaterials();var n={clearEbStores:o("EBDB").clearEbStores,flushEBSMtoEBDB:o("EBDBEbsmApi").flushEBSMtoEBDB,rehydrateEBSMFromEBDB:o("EBDBEbsmApi").rehydrateEBSMFromEBDB},a=await o("LSJSEBInMemoryStorage").makeReStorePersistence(n),l=o("LSReStoreWrapper").createLSReStore(a,o("LSMetadata").schema,[r("MAWLSVaultingHooks")],void 0);return n.updateEBSM=o("EBDBEbsmApi").updateEBSM(l),await l.runInTransaction(async function(e){await o("LSDefaultSyncGroups").seedDb(e,void 0)},"readwrite","ui",void 0,i.id+":245"),t.resolve(l),l}async function U(){M!=null&&await o("EBWorkerAddDeviceUtils").clearLSEBSMTables(await q())}function V(e){var t=r("MWEncryptedBackupsListenForChangesToBackupStateInitPath").listenForChangesToBackupState(e);return function(){t()}}function H(e,t){var n=t==="Connected"?(D||(D=o("LSIntEnum"))).ofNumber(r("LSInternetConnectionState").CONNECTED):(D||(D=o("LSIntEnum"))).ofNumber(r("LSInternetConnectionState").NOT_CONNECTED);$.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status: ",""])),t),r("promiseDone")(e.runInTransaction(function(e){return r("LSDeleteAllAndInsertConnectivityStatusStoredProcedure")(r("LSFactory")(e),{internetConnectionState:n})},"readwrite",void 0,void 0,i.id+":283"),function(){$.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status set successfully"])))},function(e){throw $.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status set failed: ",""])),e==null?void 0:e.message),e})}async function G(e,t,n){$.DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync starting..."])));var a=await t.getEval();$.DEBUG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Getting datascript evaluator success"])));var i=a()(e);$.DEBUG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Clearing epoch before resume sync..."]))),$.DEBUG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Starting realtime transport"])));var l=await t.realtimeUnderylingTransport(),s=o("LSPlatformRealtimeTransport").LSPlatformRealtimeTransport(l,t.appId,n);$.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Starting task system"])));var u=new(r("MWPlatformTaskSystem"))(e,new(r("LSPlatformTaskSystemTransport"))(e,s,i,t.schemaVersion));$.DEBUG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Starting backup state listeners"])));var c=null;r("QPLUserFlow").addPoint(P,"sync_system_creation_skipped");var d=V(e);$.DEBUG(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Watching for expired traces"])));var m;return r("promiseDone")(o("LSDataTraceFlushDeferred").watchForExpiredTraces(e).then(function(e){m=e})),$.DEBUG(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Subscribing to mqtt sync status change events"]))),s.onConnectionStatusChange(function(t){H(e,t)}),$.DEBUG(v||(v=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync starting sucess"]))),{cleanup:function(){$.DEBUG(S||(S=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync cleaning up"]))),u==null||u.cleanup(),s.cleanup(),c==null||c.cleanup(),d(),m==null||m(),A.forEach(function(e){return e()})},db:e}}function z(e){var t=[],n=j(e);return t.push(n),t}function j(e){var t=null;function n(e){var n=t===null?"null":String(t),a=String(e);o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"ebls_switch.state_transition."+n+"_to_"+a}),$.DEBUG(R||(R=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch state transition: "," -> ",""])),n,a),t===!0&&e===!1&&($.DEBUG(L||(L=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch detected true->false transition, setting timeout to check self-correction"]))),o("WAPromiseDelays").delayMs(1e3).then(async function(){var e=await o("EBIsEbEnabled").isEBEnabled(),t=e===!0;$.DEBUG(E||(E=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch true->false correction check: corrected=",", current_state=",""])),String(t),String(e)),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"ebls_switch.true_to_false_correction."+(t?"corrected":"not_corrected")});var n=r("MAWEBLSInWorkerSwitch").isEnabled(),a=e===n?"match":"mismatch";o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"ebls_switch.true_to_false_check."+a})}).catch(function(e){$.catching(e).MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch failed to check true->false correction"])))})),r("MAWEBLSInWorkerSwitch").set(e),t=e}return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.secure_encrypted_backups_client_state)).then(function(e){e!=null?n(K(e)):n(!1)}).catch(function(e){$.catching(e).MUSTFIX(I||(I=babelHelpers.taggedTemplateLiteralLoose(["Failed to get initial state for EBLS Switch"])))}),e.tables.secure_encrypted_backups_client_state.subscribe(function(e,t){switch($.DEBUG(T||(T=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch state changed. operation: ",""])),t.operation),t.operation){case"delete":n(!1);break;case"add":case"put":n(K(t.value));break;default:throw t.operation,r("WAAssertUnreachable")(t.operation)}})}function K(e){var t=e.authorityLevel,n=e.backupTenancy;if(t==null)return!1;var a=n!=null?n:(D||(D=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsBackupTenancy").PRODUCTION);return(x||(x=o("I64"))).equal(a,(D||(D=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsBackupTenancy").PRODUCTION))&&(x||(x=o("I64"))).equal(t,(D||(D=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))}l.init=N,l.genLSClient=F,l.getLSStorage=q,l.clearEBSMStorage=U,l.platformClientInit=G}),98);
__d("EBMessageEncryptionKeyStorage",["WABase64"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return o("WABase64").encodeB64(e)+"|"+o("WABase64").encodeB64(t)}function u(t){var n=t.io,r=t.logger,o=new Map,a=async function(a){var t=a.mekCreatorEpochHead,i=a.minosThreadId,l=a.rosterHash,u=s(l,i),c=o.get(u);if(c!=null)return{cacheStatus:"cached-by-memory",registeredMek:c};var d=await n.loadMessageEncryptionKey(i,l,t).catch(function(t){return r.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["loadMessageEncryptionKey runtime-error: ",""])),t),null});return d!=null?(o.set(u,d),{cacheStatus:"cached-by-db",registeredMek:d}):null},i=async function(t){var e=t.createdBySelf,r=t.lastUsedTsMs,a=t.mekCreatorEpochHead,i=t.minosThreadId,l=t.registeredMek,u=t.rosterHash,c=s(u,i);o.set(c,l),await n.saveNewMessageEncryptionKey(i,l.mek,l.mekFbid,e,r,a)};return{getMessageEncryptionKey:a,setNewMessageEncryptionKey:i}}l.createMessageEncryptionKeyStorage=u}),98);
__d("EBMessageEncryptionKeyStorageDecrypt",[],(function(t,n,r,o,a,i){"use strict";var e;function l(t){var n=t.io,r=t.logger,o=new Map,a=async function(a){var t=a.mekId,i=o.get(t);if(i!=null)return{cacheStatus:"cached-by-memory",registeredMek:i};var l=await n.loadMessageEncryptionKeyForDecryption(t).catch(function(t){return r.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["loadMessageEncryptionKeyForDecryption runtime-error: ",""])),t),null});return l!=null?(o.set(t,l),{cacheStatus:"cached-by-db",registeredMek:l}):null},i=async function(t){var e=t.createdBySelf,r=t.lastUsedTsMs,a=t.minosThreadId,i=t.registeredMek,l=i.mek.mekId;o.set(l,i),await n.saveNewMessageEncryptionKey(a,i.mek,i.mekFbid,e,r,null)};return{getMessageEncryptionKeyDecrypt:a,setNewMessageEncryptionKeyDecrypt:i}}i.createMessageEncryptionKeyStorageDecrypt=l}),66);
__d("EBMessagePointQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="32643898351892811"}),null);
__d("EBMessagePointQuery.graphql",["EBMessagePointQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e={defaultValue:null,kind:"LocalArgument",name:"app_id"},t={defaultValue:!1,kind:"LocalArgument",name:"minos_gk_enabled"},r={defaultValue:null,kind:"LocalArgument",name:"restore_payload_string"},o={defaultValue:null,kind:"LocalArgument",name:"restore_type"},a=[{kind:"Variable",name:"app_id",variableName:"app_id"},{kind:"Variable",name:"restore_payload_string",variableName:"restore_payload_string"},{kind:"Variable",name:"restore_type",variableName:"restore_type"}],i={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"supplemental_otid",storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"actor_token",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"mek_fbid",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"mek_id",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp",storageKey:null},C={alias:null,args:null,kind:"ScalarField",name:"transport_sender_signing_pk",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"transport_sender_message_signature",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"franking_tag",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"reporting_tag",storageKey:null},R={alias:null,args:null,kind:"ScalarField",name:"message_encryption_version",storageKey:null},L={alias:null,args:null,kind:"ScalarField",name:"message_metadata_version",storageKey:null},E=[l,s],k={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[e,t,r,o],kind:"Fragment",metadata:null,name:"EBMessagePointQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:a,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_point_restore",plural:!1,selections:[{args:[{kind:"Variable",name:"minos_gk_enabled",variableName:"minos_gk_enabled"}],kind:"FragmentSpread",name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages"}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[r,o,e,t],kind:"Operation",name:"EBMessagePointQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:a,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_point_restore",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},i,l,s,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"message_tags",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[u,i,l,s,c,d],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[u,i,l,s,c,d,m,p],storageKey:null},{alias:null,args:null,concreteType:"XFBUnencryptedProtobufStanza",kind:"LinkedField",name:"top_level_protobuf_unencrypted",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"unencrypted_protobuf",storageKey:null},c],storageKey:null},{condition:"minos_gk_enabled",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"XFBMinosProtobufStanza",kind:"LinkedField",name:"top_level_protobuf_v2",plural:!1,selections:[_,f,g,h,y,C,b,v,S,R,L],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs_v2",plural:!0,selections:[_,f,y,g,h,m,p,C,b,v,S,R,L],storageKey:null}]}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"thread_not_found",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:E,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:E,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null},{condition:"minos_gk_enabled",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"XFBMinosDecryptionKeyMap",kind:"LinkedField",name:"minos_decryption_keys",plural:!0,selections:[k,{alias:null,args:null,concreteType:"XFBMinosDecryptionKeys",kind:"LinkedField",name:"keys",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBMinosMekInfo",kind:"LinkedField",name:"mek_info",plural:!1,selections:[h,{alias:null,args:null,kind:"ScalarField",name:"roster_hash",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_mek",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mek_creation_timestamp",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mek_encryption_version",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosRecipientInfo",kind:"LinkedField",name:"recipient_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"epoch_fbid",storageKey:null},l,{alias:null,args:null,kind:"ScalarField",name:"epoch_head",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBMekCreatorInfo",kind:"LinkedField",name:"mek_creator_info",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBMinosEncryptionKeys",kind:"LinkedField",name:"minos_keys",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"sender_auth_pk",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sender_epoch_head",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosTransportKeys",kind:"LinkedField",name:"transport_keys",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ephm_hpke_pk",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ephm_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mek_creator_transport_signing_pk",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]}],storageKey:null}],storageKey:null},k],storageKey:null}],storageKey:null}]},params:{id:n("EBMessagePointQuery_facebookRelayOperation"),metadata:{},name:"EBMessagePointQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("EBMinosWasmDecryptAndVerifyMessage",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){return e.success!=null?o("WAResultOrError").makeResult(o("EBMinosTypes").unsafeCastToDecryptedMessage(e.success.plaintext)):o("WAResultOrError").makeError({errorName:"wasm-internal-invalid-result-type",failReason:e.errorMessage})}return async function(n){var t=n.cipherText,r=n.mekKey,a=n.messageEncryptionVersion,i=n.metadata,l=n.signature,s=n.transportSigningPK;return await o("EBMinosWasmReactorSingleton").minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").MinosDecryptAndVerifyMessageResultSpec,validateResult:e},{decryptAndVerifyMessage:{encryptedMessageCiphertext:t,encryptedMessageSignature:l,mek:r,messageEncryptionVersion:a,metadata:i,transportSigningPk:s}})}}var s=e();l.decryptAndVerifyMessage=s}),98);
__d("EBMinosWasmDecryptMekForDistribution",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){return e.success!=null?o("WAResultOrError").makeResult(o("EBMinosTypes").unsafeCastMekKey(e.success.mek)):o("WAResultOrError").makeError({errorName:"wasm-internal-invalid-result-type",failReason:e.errorMessage})}return async function(n){var t=n.encryptedMek,r=n.mailboxAuthPk,a=n.mailboxEncSk,i=n.mekEncryptionVersion,l=n.mekId,s=n.recipientEpochHead,u=n.rosterHash,c=n.senderEpochHead;return await o("EBMinosWasmReactorSingleton").minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").DecryptMekForDistributionResultSpec,validateResult:e},{decryptMekForDistribution:{ciphertext:t,fromPk:r,mekEncryptionVersion:i,mekId:l,rosterHash:u,senderEpochHead:c,toEpochHead:s,toMailboxSk:a}})}}var s=e();l.decryptMekForDistribution=s}),98);
__d("EBMinosWasmDecryptMekForDistributionFromTransportSender",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){return e.success!=null?o("WAResultOrError").makeResult(o("EBMinosTypes").unsafeCastMekKey(e.success.mek)):o("WAResultOrError").makeError({errorName:"wasm-internal-invalid-result-type",failReason:e.errorMessage})}return async function(n){var t=n.mekDistribution,r=n.mekEncryptionVersion,a=n.mekId,i=n.recipientEncSk,l=n.rosterHash;return await o("EBMinosWasmReactorSingleton").minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").DecryptMekForDistributionFromTransportSenderResultSpec,validateResult:e},{decryptMekForDistributionFromTransportSender:{mekDistribution:t,mekId:a,recipientEncSk:i,rosterHash:l,version:r}})}}var s=e();l.createMinosWasmDecryptMekForDistributionFromTransportSender=e,l.decryptMekForDistributionFromTransportSender=s}),98);
__d("EBMinosWasmDeriveMailboxAuthKeypair",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t=e.mailboxAuthPrivateKey,n=e.mailboxAuthPublicKey;return o("WAResultOrError").makeResult({pk:o("EBMinosTypes").unsafeCastToMailboxAuthPK(n),sk:o("EBMinosTypes").unsafeCastToMailboxAuthSK(t)})}return async function(n){var t=n.epochNumber,r=n.exportRootKey;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").DeriveMailboxAuthKeypairResultSpec,validateResult:e},{deriveMailboxAuthKeypair:{epochNumber:t,exportRootKey:r}})}}var s=e();l.deriveMailboxAuthKeypair=s}),98);
__d("EBMinosWasmDeriveMailboxEncryptionKeypair",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t=e.mailboxEncryptionPrivateKey,n=e.mailboxEncryptionPublicKey;return o("WAResultOrError").makeResult({pk:o("EBMinosTypes").unsafeCastToMailboxEncryptionPK(n),sk:o("EBMinosTypes").unsafeCastToMailboxEncryptionSK(t)})}return async function(n){var t=n.epochNumber,r=n.exportRootKey;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").DeriveMailboxEncryptionKeypairResultSpec,validateResult:e},{deriveMailboxEncryptionKeypair:{epochNumber:t,exportRootKey:r}})}}var s=e();l.deriveMailboxEncryptionKeypair=s}),98);
__d("EBMinosWasmEncryptAndSignMessage",["EBMinosClientConfig","EBMinosLogger","EBMinosMessageEncryptionVersion","EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){function t(t){var n=t.ciphertext,r=t.signature,a=t.version,i=o("EBMinosMessageEncryptionVersion").MinosMessageEncryptionVersion.cast(a);return i==null?(o("EBMinosLogger").minosLogger.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast message encryption version: ",""])),a),o("WAResultOrError").makeError("invalid-message-encryption-version")):o("WAResultOrError").makeResult({encryptedMsg:o("EBMinosTypes").unsafeCastToEncryptedMessage(n),signature:o("EBMinosTypes").unsafeCastToEncryptedMessageSignature(r),version:i})}return async function(n){var e=n.mekKey,r=n.metadata,a=n.plaintext,i=n.transportSigningPK,l=n.transportSigningSK;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").MinosEncryptAndSignMessageResultSpec,validateResult:t},{encryptAndSignMessage:{conf:o("EBMinosClientConfig").MINOS_CLIENT_CONFIG,mek:e,metadata:r,plaintext:a,transportSigningPk:i,transportSigningSk:l}})}}var u=s();l.encryptAndSignMessage=u}),98);
__d("EBMinosWasmGenerateMekRosterHash",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t=e.rosterHash;return o("WAResultOrError").makeResult(o("EBMinosTypes").unsafeCastMekRosterHash(t))}return async function(n){var t=n.epochHeads;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").GenerateMekRosterHashResultSpec,validateResult:e},{generateMekRosterHash:{epochHeads:t}})}}var s=e();l.generateMekRosterHash=s}),98);
__d("EBMinosWasmWrapTransportSigningPublicKey",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t=e.prefixedKey;return o("WAResultOrError").makeResult(o("EBMinosTypes").unsafeCastToTransportSigningPK(t))}return async function(n){var t=n.signalIdentityPublicKey;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").WrapTransportSigningPublicKeyResultSpec,validateResult:e},{wrapTransportSigningPublicKey:{keyBytes:t}})}}var s=e();l.wrapTransportSigningPublicKey=s}),98);
__d("EBMinosWasmWrapTransportSigningSecretKey",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t=e.prefixedKey;return o("WAResultOrError").makeResult(o("EBMinosTypes").unsafeCastToTransportSigningSK(t))}return async function(n){var t=n.signalIdentityPrivateKey;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").WrapTransportSigningSecretKeyResultSpec,validateResult:e},{wrapTransportSigningSecretKey:{keyBytes:t}})}}var s=e();l.wrapTransportSigningSecretKey=s}),98);
__d("EBMinosWrapTransportSigningKeypair",["EBMinosLogger","EBMinosWasmWrapTransportSigningPublicKey","EBMinosWasmWrapTransportSigningSecretKey","WAByteArray","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(t){var n=t.privateKey,r=t.publicKey,a=o("EBMinosWasmWrapTransportSigningPublicKey").wrapTransportSigningPublicKey({signalIdentityPublicKey:o("WAByteArray").uint8ArrayToBuffer(r)}),i=await a,l=o("EBMinosWasmWrapTransportSigningSecretKey").wrapTransportSigningSecretKey({signalIdentityPrivateKey:o("WAByteArray").uint8ArrayToBuffer(n)}),u=await l;if(!i.success)return o("EBMinosLogger").minosLogger.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to wrap transport signing public key"]))),o("WAResultOrError").makeError("minos-wrap-transport-signing-keypair-error");if(!u.success)return o("EBMinosLogger").minosLogger.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to wrap transport signing secret key"]))),o("WAResultOrError").makeError("minos-wrap-transport-signing-keypair-error");var c={pk:i.value,sk:u.value};return o("WAResultOrError").makeResult(c)}l.wrapTransportSigningKeypair=u}),98);
__d("EBMinosWasmMinosThreadIdFromActThreadId",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t=e.threadId;return o("WAResultOrError").makeResult(o("EBMinosTypes").unsafeCastToMinosThreadId(t))}return async function(n){var t=n.actThreadId;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").MinosThreadIdFromActThreadIdResultSpec,validateResult:e},{minosThreadIdFromActThreadId:{actThreadId:t}})}}var s=e();l.minosThreadIdFromActThreadId=s}),98);
__d("EBMinosWasmMinosThreadIdFromOneToOneThread",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t=e.threadId;return o("WAResultOrError").makeResult(o("EBMinosTypes").unsafeCastToMinosThreadId(t))}return async function(n){var t=n.actThreadId,r=n.selfFbid;return await o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").MinosThreadIdFromOneToOneThreadResultSpec,validateResult:e},{minosThreadIdFromOneToOneThread:{actThreadId:t,selfFbid:r}})}}var s=e();l.minosThreadIdFromOneToOneThread=s}),98);
__d("MpsThreadIdToMinosThreadId",["EBMinosLogger","EBMinosWasmMinosThreadIdFromActThreadId","EBMinosWasmMinosThreadIdFromOneToOneThread","Promise","WAJids","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(t,r){var a=o("WAJids").validateUserJid(t);if(a!=null){var i=o("WAJids").userIdFromJid(a);return o("EBMinosWasmMinosThreadIdFromOneToOneThread").minosThreadIdFromOneToOneThread({actThreadId:i,selfFbid:r}).then(function(t){return t.success?o("WAResultOrError").makeResult(t.value):(o("EBMinosLogger").minosLogger.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["mpsThreadIdToMinosThreadId UserJid error: ",""])),t.error),o("WAResultOrError").makeError("create-minos-thread-id-error"))})}var l=o("WAJids").validateGroupJid(t);if(l!=null){var c=o("WAJids").groupIdFromJid(l);return o("EBMinosWasmMinosThreadIdFromActThreadId").minosThreadIdFromActThreadId({actThreadId:c}).then(function(e){return e.success?o("WAResultOrError").makeResult(e.value):(o("EBMinosLogger").minosLogger.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["mpsThreadIdToMinosThreadId GroupJid error: ",""])),e.error),o("WAResultOrError").makeError("create-minos-thread-id-error"))})}return(u||(u=n("Promise"))).resolve(o("WAResultOrError").makeError("invalid-mps-thread-id"))}l.mpsThreadIdToMinosThreadId=c}),98);
__d("MpsThreadIdToWaThreadId",["WAJids"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=o("WAJids").validateUserJid(e);if(t!=null)return o("WAJids").userIdFromJid(t);var n=o("WAJids").validateGroupJid(e);return n!=null?o("WAJids").groupIdFromJid(n):null}l.mpsThreadIdToWaThreadId=e}),98);
__d("EBMinosCryptoLibrary",["Base64Utils","EBDecryptQplFlow","EBDeps","EBGenerateAndUploadMek","EBGetMinosAttachmentPayloadFromMpsMessage","EBMessageEncryptionKeyStorage","EBMessageEncryptionKeyStorageDecrypt","EBMinosCheckWasmFeatureSupport","EBMinosLogger","EBMinosMessageMetadataVersion","EBMinosProcessMessages","EBMinosTypes","EBMinosWasmDecryptAndVerifyMessage","EBMinosWasmDecryptMekForDistribution","EBMinosWasmDecryptMekForDistributionFromTransportSender","EBMinosWasmDeriveMailboxAuthKeypair","EBMinosWasmDeriveMailboxEncryptionKeypair","EBMinosWasmEncryptAndSignMessage","EBMinosWasmGenerateMekRosterHash","EBMinosWrapTransportSigningKeypair","MAWProtobufDeserializers","MpsThreadIdToMinosThreadId","MpsThreadIdToWaThreadId","MpsTypes","WAFrankingTypes","WAGetPlatformFromStanzaId","WAGlobals","WAResultOrError","WAStanzaUtils","err","gkx","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E;async function k(t){var n=t.io,a=n.loadMessageEncryptionKey,i=n.loadMessageEncryptionKeyForDecryption,l=n.loadMostRecentSelfMinosEpoch,y=n.loadSelfMinosEpochForDecryption,C=n.registerMinosMessageEncryptionKey,b=n.saveNewMessageEncryptionKey,v=t.logger,S=t.transportSigningKeypair,R=await o("EBMinosCheckWasmFeatureSupport").checkWasmFeatureSupportAndGK();v.DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["gk minos_rollout_enabled: ",""])),R);var L=o("EBMessageEncryptionKeyStorage").createMessageEncryptionKeyStorage({io:{loadMessageEncryptionKey:a,saveNewMessageEncryptionKey:b},logger:v}),E=o("EBMessageEncryptionKeyStorageDecrypt").createMessageEncryptionKeyStorageDecrypt({io:{loadMessageEncryptionKeyForDecryption:i,saveNewMessageEncryptionKey:b},logger:v}),k=await o("EBMinosWrapTransportSigningKeypair").wrapTransportSigningKeypair(S);if(k.success===!1)return o("WAResultOrError").makeError("transport-signing-keypair-error");var I=k.value,T=async function(t){var e=t.qplFlow,n=t.uploadEntity,a=n.deletionOfflineThreadingId,i=n.directive,p=n.isEphemeral,_=n.mailboxKeys,f=n.messageId,g=n.payload,h=n.senderId,y=n.supplementalOpToken,b=n.tags,S=n.threadId,R=n.timestampMs;e.addAnnotations({bool:{mek_reuse_enabled:r("gkx")("7918")}}),e.addPoint("generate_mek_roster_hash_start");var E=_.map(function(e){var t=e.epochHead;return t}),k=await o("EBMinosWasmGenerateMekRosterHash").generateMekRosterHash({epochHeads:E});if(!k.success)return e.addPoint("generate_mek_roster_hash_fail"),o("WAResultOrError").makeError("generate-mek-roster-hash-error");var T=k.value;e.addPoint("generate_mek_roster_hash_end"),e.addPoint("get_or_generate_mek_start");var D=o("EBMinosTypes").userJidToUserFbId(o("WAGlobals").getMyUserJid());if(D==null)return v.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["selfFbid is invalid"]))),o("WAResultOrError").makeError("invalid-self-fbid");var $=await o("MpsThreadIdToMinosThreadId").mpsThreadIdToMinosThreadId(S,D);if(!$.success)return v.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["mpsThreadIdToMinosThreadId error: ",""])),$.error),o("WAResultOrError").makeError("create-minos-thread-id-error");var N=$.value,M=await P({actThreadId:r("nullthrows")(o("MpsThreadIdToWaThreadId").mpsThreadIdToWaThreadId(S),"invalid MPS threadId"),io:{loadMostRecentSelfMinosEpoch:l,registerMinosMessageEncryptionKey:C},logger:v,mailboxKeys:_,mekStorage:L,minosThreadId:N,msgUploadQpl:e,rosterHash:T,transportSigningKeypair:I});if(!M.success)return v.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["get or generate mek error: ",""])),M.error),e.addPoint("get_or_generate_mek_fail"),o("WAResultOrError").makeError("get-mek-error");e.addPoint("get_or_generate_mek_end",{string:{mekCacheStatus:M.value.cacheStatus}});var w=M.value.registeredMek,A=w.mek,F=w.mekFbid,O=o("EBMinosMessageMetadataVersion").MESSAGE_METADATA_CURRENT_VERSION;e.addAnnotations({int:{message_metadata_version:O}});var B=o("EBMinosProcessMessages").createMessageTimestamp(R,O,f);e.addPoint("encrypt_message_start");var W=await o("EBMinosWasmEncryptAndSignMessage").encryptAndSignMessage({mekKey:A.key,metadata:{mekId:A.mekId,messageId:f,threadId:N,timestamp:B},plaintext:new Uint8Array(g),transportSigningPK:I.pk,transportSigningSK:I.sk});if(!W.success)return v.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["message encryption error: ",""])),W.error),e.addPoint("encrypt_message_fail"),o("WAResultOrError").makeError("encrypt-message-error");e.addAnnotations({int:{message_encryption_version:W.value.version}}),e.addPoint("encrypt_message_end");var q=await o("EBGetMinosAttachmentPayloadFromMpsMessage").getMinosAttachmentPayloadFromMpsMessage({logger:v,message:{messageId:f,payload:g,senderId:h,threadId:S,timestampMs:R},qplFlow:e});v.DEV(m||(m=babelHelpers.taggedTemplateLiteralLoose([""," attchmentSecrets generated"])),q.length);var U=x(a,g),V=U.frankingTag,H=U.reportingTag;return o("WAResultOrError").makeResult({attachmentPayload:q,backupActionType:i.actionType,backupFbid:n.backupFbid,deletionOfflineThreadingId:a,encryptedMsg:W.value.encryptedMsg,encryptedMsgSignature:W.value.signature,frankingTag:V,isEphemeral:p,mekFbid:F,mekId:A.mekId,messageEncryptionVersion:W.value.version,messageMetadataVersion:O,messageTimestampMs:R,otid:f,reportingTag:H,supplementalOpToken:y,tags:b,toplevelOfflineThreadingId:o("MpsTypes").toMessageId(i.originalMsgProtocolId.externalId),transportSigningPK:I.pk,waThreadId:S})},D=async function(t){var e,n=t.encryptedMessage,a=t.encryptedMsgSignature,i=t.entryPoint,l=t.mekCreatorInfo,s=t.mekFbid,u=t.mekInfo,c=t.messageEncryptionVersion,d=t.messageInfo,m=t.messageMetadataVersion,C=t.recipientInfo,b=t.source,S=t.threadId,R=t.transportSigningPK,L=o("EBDecryptQplFlow").startDecryptQplFlow({decryptionType:"protobuf_message_decryptor",entryPoint:i,isMinos:!0,source:b,threadId:S});L.addAnnotations({bool:{mek_reuse_enabled:r("gkx")("7918")},int:{mek_creation_time_sec:u.mekCreationTimestamp,mek_encryption_version:u.mekEncryptionVersion,message_encryption_version:c,metadata_version:m,timestamp_ms:d.timestamp},string:{mek_fbid:s,message_id:d.messageId,platform_type:o("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(o("WAStanzaUtils").toStanzaId(d.messageId)),sender_type:l.senderType}}),L.addPoint("load_self_minos_epoch_for_decryption_start");var k=await y(C.epochFbId,u.mekEncryptionVersion);if(!k.success&&r("gkx")("269")&&k.error==="no-self-epoch-found"){v.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["no self epoch found - will try to sync epochs"]))),L.addPoint("sync_epochs_start");var I=await o("EBDeps").getDeps().getEBSMAPI(),T=await I.repairEpochs();T.success?(L.addPoint("sync_epochs_end"),k=await y(C.epochFbId,u.mekEncryptionVersion)):(v.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["sync epochs error: ",""])),T.error),L.addAnnotations({string:{sync_epochs_error:T.error.message,sync_epochs_error_code:T.error.errorCode}}),L.addPoint("sync_epochs_fail"))}if(!k.success)return v.ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["epoch decryption error for message ID ",": ",""])),d.messageId,k.error),L.endFailWithError("load_self_minos_epoch_for_decryption_fail",k.error),o("WAResultOrError").makeError(k.error);L.addPoint("load_self_minos_epoch_for_decryption_end"),L.addPoint("derive_mailbox_encryption_key_pair_start");var D=await o("EBMinosWasmDeriveMailboxEncryptionKeypair").deriveMailboxEncryptionKeypair({epochNumber:C.epochAnonId,exportRootKey:k.value.exportRootKey});if(!D.success)return v.ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["mailbox encryption key pair derivation error for message ID ",": ",""])),d.messageId,D.error),L.endFailWithError("derive_mailbox_encryption_key_pair_fail",D.error),o("WAResultOrError").makeError("derive-mailbox-keys-error");var x=D.value.sk;L.addPoint("derive_mailbox_encryption_key_pair_end"),L.addPoint("get_or_decrypt_message_encryption_key_start");var P=await $({logger:v,mailboxEncryptionSK:x,mekCreatorInfo:l,mekFbid:s,mekInfo:u,mekStorageDecrypt:E,minosThreadId:d.threadId,qplFlow:L,recipientEpochHead:(e=C.epochHead)!=null?e:k.value.exportEpochHead,transportSigningPK:R});if(!P.success){var N;return L.endFailWithError(P.error.errorName,(N=P.error.failReason)!=null?N:"decrypt-mek-error"),o("WAResultOrError").makeError("decrypt-mek-error")}L.addPoint("get_or_decrypt_mailbox_encryption_key_end",{string:{mekCacheStatus:P.value.cacheStatus}}),L.addPoint("decrypt_and_verify_message_start");var M=await o("EBMinosWasmDecryptAndVerifyMessage").decryptAndVerifyMessage({cipherText:n,mekKey:P.value.mekKey,messageEncryptionVersion:c,metadata:{mekId:u.mekId,messageId:d.messageId,threadId:d.threadId,timestamp:d.timestamp},signature:a,transportSigningPK:R});if(!M.success){var w=M.error,A=w.errorName,F=w.failReason;return v.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["message decryption error for message ID ",": ",""])),d.messageId,F!=null?F:A),L.endFailWithError("decrypt_and_verify_message_fail",F!=null?F:A),o("WAResultOrError").makeError("decrypt-message-error")}return L.addPoint("decrypt_and_verify_message_end"),L.endSuccess(),o("WAResultOrError").makeResult(M.value)};return o("WAResultOrError").makeResult({decryptMessage:D,encryptMessage:T})}var I=null;function T(e){if(I!=null){o("EBMinosLogger").minosLogger.DEV(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Minos crypto library is already set"])));return}o("EBMinosLogger").minosLogger.DEV(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Minos crypto library is initialized"]))),I=e}function D(){if(I==null)throw o("EBMinosLogger").minosLogger.ERROR(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Minos crypto library is not set"]))),r("err")("Minos crypto library is not set");return I}function x(e,t){var n=null,r=null;if(e==null){var a,i,l=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(t),s=(a=l.proto.metadata)==null||(a=a.frankingMetadata)==null?void 0:a.frankingTag;s==null?o("EBMinosLogger").minosLogger.ERROR(v||(v=babelHelpers.taggedTemplateLiteralLoose(["missing frankingTag in upload"]))):n=o("WAFrankingTypes").castToFrankingTag(new Uint8Array(s));var u=(i=l.proto.metadata)==null||(i=i.frankingMetadata)==null?void 0:i.reportingTag;u==null?o("EBMinosLogger").minosLogger.ERROR(S||(S=babelHelpers.taggedTemplateLiteralLoose(["missing reportingTag in upload"]))):r=o("WAFrankingTypes").castToReportingTag(new Uint8Array(u))}return{frankingTag:n,reportingTag:r}}async function $(e){var t=e.logger,n=e.mailboxEncryptionSK,a=e.mekCreatorInfo,i=e.mekFbid,l=e.mekInfo,s=e.mekStorageDecrypt,u=e.minosThreadId,c=e.qplFlow,d=e.recipientEpochHead,m=e.transportSigningPK;if(r("gkx")("7918")){var p=await s.getMessageEncryptionKeyDecrypt({mekId:l.mekId});if(c.addAnnotations({bool:{mek_reuse:p!=null}}),p!=null)return o("WAResultOrError").makeResult({cacheStatus:p.cacheStatus,mekKey:p.registeredMek.mek.key})}c.addPoint("decrypt_mek_start");var _=a.senderType==="Transport"?await o("EBMinosWasmDecryptMekForDistributionFromTransportSender").decryptMekForDistributionFromTransportSender({mekDistribution:{encryptedMek:l.encryptedMek,ephemeralEncryptionPk:a.transportSenderEphemeralPK,recipientEpochHead:d,signature:a.transportSenderEphemeralKeySig,signingPk:m},mekEncryptionVersion:l.mekEncryptionVersion,mekId:l.mekId,recipientEncSk:n,rosterHash:l.mekRosterHash}):await o("EBMinosWasmDecryptMekForDistribution").decryptMekForDistribution({encryptedMek:l.encryptedMek,mailboxAuthPk:a.senderMailboxAuthPK,mailboxEncSk:n,mekEncryptionVersion:l.mekEncryptionVersion,mekId:l.mekId,recipientEpochHead:d,rosterHash:l.mekRosterHash,senderEpochHead:a.senderEpochHead});if(c.addPoint("decrypt_mek_end"),!_.success)return t.ERROR(R||(R=babelHelpers.taggedTemplateLiteralLoose(["mek decryption error: ",""])),_.error),_;if(r("gkx")("7918")&&a.senderType!=="Transport"){var f={key:_.value,mekId:l.mekId,rosterHash:l.mekRosterHash},g={mek:f,mekFbid:i};await s.setNewMessageEncryptionKeyDecrypt({createdBySelf:!1,lastUsedTsMs:o("MpsTypes").toTimestamp(Date.now()),minosThreadId:u,registeredMek:g})}return o("WAResultOrError").makeResult({cacheStatus:"new",mekKey:_.value})}async function P(e){var t=e.actThreadId,n=e.io,r=e.logger,a=e.mailboxKeys,i=e.mekStorage,l=e.minosThreadId,s=e.msgUploadQpl,u=e.rosterHash,c=e.transportSigningKeypair,d=await n.loadMostRecentSelfMinosEpoch().then(async function(e){if(e==null)return o("WAResultOrError").makeError("unable-to-get-latest-epoch");var t=await o("EBMinosWasmDeriveMailboxAuthKeypair").deriveMailboxAuthKeypair({epochNumber:e.epochNumber,exportRootKey:e.exportRootKey});return t.success?(s.addAnnotations({string:{epoch_fbid:e.epochFbId,epoch_head:o("Base64Utils").fromArrayBuffer(e.epochHead)}}),o("WAResultOrError").makeResult({epochFbId:e.epochFbId,epochHead:e.epochHead,mailboxAuthKeyPair:t.value})):(r.ERROR(L||(L=babelHelpers.taggedTemplateLiteralLoose(["Unable to get mailbox auth key pair for sender - failed with exception ",""])),t.error),o("WAResultOrError").makeError("unable-to-get-sender-mailbox-auth-key-pair"))}),m=d.success?{fromKeypair:d.value.mailboxAuthKeyPair,senderEpochFbId:d.value.epochFbId,senderEpochHead:d.value.epochHead,senderType:"Minos"}:{senderType:"Transport",transportSigningKp:c};if(m.senderType!=="Transport"){var p=await i.getMessageEncryptionKey({mekCreatorEpochHead:m.senderEpochHead,minosThreadId:l,rosterHash:u});if(p!=null)return o("WAResultOrError").makeResult(p)}var _=await o("EBGenerateAndUploadMek").generateAndUploadMek({actThreadId:t,io:{registerMinosMessageEncryptionKey:n.registerMinosMessageEncryptionKey},logger:r,msgUploadQpl:s,participantMailboxes:a,sender:m});if(!_.success)return r.ERROR(E||(E=babelHelpers.taggedTemplateLiteralLoose(["mek register error: ",""])),_.error),o("WAResultOrError").makeError("register-mek-error");var f={mek:_.value.mek,mekFbid:_.value.mekFbid};return m.senderType!=="Transport"&&await i.setNewMessageEncryptionKey({createdBySelf:!0,lastUsedTsMs:o("MpsTypes").toTimestamp(Date.now()),mekCreatorEpochHead:m.senderEpochHead,minosThreadId:l,registeredMek:f,rosterHash:u}),o("WAResultOrError").makeResult({cacheStatus:"new",registeredMek:f})}l.createMinosCryptoLibrary=k,l.setMinosCryptoLibrary=T,l.getMinosCryptoLibrary=D}),98);
__d("EBMinosSaveNewMinosMessageEpochHead",["EBMinosDb"],(function(t,n,r,o,a,i,l){"use strict";var e=async function(t,n,r){var e=await o("EBMinosDb").getEBMinosDb();await e.runInTransaction(["secure_minos_message_epoch_heads"],"readwrite",function(e){return e.stores.secure_minos_message_epoch_heads.bulkPut([{epoch_head:t,message_id:n,thread_id:r}])},"SaveNewMinosMessageEpochHead")};l.saveNewMinosMessageEpochHead=e}),98);
__d("EBMinosDecryptMessages",["EBMinosCryptoLibrary","EBMinosLogger","EBMinosProcessMessages","EBMinosSaveNewMinosMessageEpochHead","EBMinosTypes","MpsThreadIdToMinosThreadId","MpsTypes","WAGlobals","WAResultOrError","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){var t=e.keys.mekCreatorInfo.minosKeys,n=e.keys.mekCreatorInfo.transportKeys;return t!=null?{senderEpochHead:t.senderEpochHead,senderMailboxAuthPK:t.senderAuthPk,senderType:"Minos"}:n?{senderType:"Transport",transportSenderEphemeralKeySig:n.ephmSignature,transportSenderEphemeralPK:n.ephmHpkePk}:null}async function c(t,n,r,a,i,l,s){var c=r.get(a.mekFbid);if(c==null)return o("WAResultOrError").makeError("missing-encrypted-mek");var d=u(c);if(d==null)return o("WAResultOrError").makeError("missing-mek-creator-info");var m=o("EBMinosProcessMessages").createMessageTimestamp(a.protobufTimestamp,a.messageMetadataVersion,n),p=await o("EBMinosCryptoLibrary").getMinosCryptoLibrary().decryptMessage({encryptedMessage:a.encryptedProtobuf,encryptedMsgSignature:a.transportSenderMessageSignature,entryPoint:s,mekCreatorInfo:d,mekFbid:a.mekFbid,mekInfo:c.keys.mekInfo,messageEncryptionVersion:a.messageEncryptionVersion,messageInfo:{messageId:n,threadId:t,timestamp:m},messageMetadataVersion:a.messageMetadataVersion,recipientInfo:c.keys.recipientInfo,source:l,threadId:i,transportSigningPK:a.transportSenderSigningPk});if(!p.success)return o("WAResultOrError").makeError(p.error);var _={decryptedProtobuf:p.value,decryptedSupplementalKey:null,protobufTimestampMs:o("WATimeUtils").castLongIntToMillisTime(a.protobufTimestamp)};return d.senderType==="Minos"&&await o("EBMinosSaveNewMinosMessageEpochHead").saveNewMinosMessageEpochHead(d.senderEpochHead,n,i).catch(function(t){return o("EBMinosLogger").minosLogger.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["saveNewMinosMessageEpochHead failed with error: ",""])),t),o("WAResultOrError").makeError("failed-to-save-epoch-head")}),o("WAResultOrError").makeResult(_)}async function d(e,t,n,r,a,i,l){var c=n.supplementalOtid,d=t.get(n.mekFbid);if(d==null)return o("WAResultOrError").makeError("missing-encrypted-mek");var m=u(d);if(m==null)return o("WAResultOrError").makeError("missing-mek-creator-info");if(c==null)return o("WAResultOrError").makeError("missing-supplemental-otid");var p=o("MpsTypes").toMessageId(c),_=o("EBMinosProcessMessages").createMessageTimestamp(n.protobufTimestamp,n.messageMetadataVersion,p),f=await o("EBMinosCryptoLibrary").getMinosCryptoLibrary().decryptMessage({encryptedMessage:n.encryptedProtobuf,encryptedMsgSignature:n.transportSenderMessageSignature,entryPoint:l,mekCreatorInfo:m,mekFbid:n.mekFbid,mekInfo:d.keys.mekInfo,messageEncryptionVersion:n.messageEncryptionVersion,messageInfo:{messageId:p,threadId:e,timestamp:_},messageMetadataVersion:n.messageMetadataVersion,recipientInfo:d.keys.recipientInfo,source:i,threadId:a,transportSigningPK:n.transportSenderSigningPk});if(!f.success)return o("WAResultOrError").makeError(f.error);var g={decryptedProtobuf:f.value,decryptedSupplementalKey:r,protobufTimestampMs:o("WATimeUtils").castLongIntToMillisTime(n.protobufTimestamp)};return m.senderType==="Minos"&&await o("EBMinosSaveNewMinosMessageEpochHead").saveNewMinosMessageEpochHead(m.senderEpochHead,p,a).catch(function(e){return o("EBMinosLogger").minosLogger.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["saveNewMinosMessageEpochHead failed with error: ",""])),e),o("WAResultOrError").makeError("save-epoch-head-error")}),o("WAResultOrError").makeResult(g)}async function m(e,t,n,r,a){var i=new Map,l=o("EBMinosTypes").userJidToUserFbId(o("WAGlobals").getMyUserJid());if(l==null)return o("WAResultOrError").makeError("invalid-self-fbid");var s=await o("MpsThreadIdToMinosThreadId").mpsThreadIdToMinosThreadId(e,l);if(!s.success)return o("WAResultOrError").makeError("create-minos-thread-id-error");var u=[];return await Promise.all(n.map(async function(n){var l=n.messageTags,m=n.otid,p=n.supplementalProtobufsV2,_=n.topLevelProtobufV2,f=await c(s.value,m,t,_,e,r,a);if(!f.success)return u.push("failed_to_decrypt_top_level_protobuf_"+f.error);var g=new Map;p!=null&&await Promise.all(p.map(async function(n){var i=n.supplementalKey;if(i!=null){var l=await d(s.value,t,n,i,e,r,a);if(l.success)g.set(o("MpsTypes").toSupplementalKey(i),l.value);else return u.push("failed_to_decrypt_supplemental_level_protobuf_"+l.error)}})),i.set(m,{messageTags:l,otid:m,supplementalProtobufs:g,topLevelProtobuf:f.value})})),o("WAResultOrError").makeResult({decryptionResult:i,errorMessages:u})}l.minosDecryptMessages=m}),98);
__d("EBValidateMinosMessages",["EBMinosLogger","EBMinosProcessMessages","EBMinosTypes","MAWProtobufDeserializers","MpsTypes","WAArmadilloXMA.pb","WACryptoUtils","WAFranking","WAFrankingTypes","WAGlobals","WALongInt","WAResultOrError","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;async function c(t,n,a,i){var l=await Promise.all(t.map(async function(t){var i=t.otid,l=t.topLevelProtobufV2.protobufTimestamp,u=t.topLevelProtobufV2.actorToken,c=n.get(i);if(c==null)return n.delete(i),"message-id-not-found";var _=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(c.topLevelProtobuf.decryptedProtobuf);if(_==null)return n.delete(i),"failed-to-deserialize-decrypted-protobuf";var f=_.proto.metadata;if(f==null)return n.delete(i),"protobuf-message-metadata-null";var g=f.timestampMs;if(g==null)return n.delete(i),"minos-protobuf-timestamps-mismatch";try{var h=o("WALongInt").numberOrThrowIfTooLarge(g);if(o("MpsTypes").toTimestamp(h)!==l)return n.delete(i),"minos-protobuf-timestamps-mismatch"}catch(t){return o("EBMinosLogger").minosLogger.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["timestamp-convert-error-",""])),r("getErrorSafe")(t).message),n.delete(i),"timestamp-covert-error"}if(f.senderId==null||o("EBMinosTypes").unsafeCastToUserFbId(f.senderId)!==u)return n.delete(i),"sender-id-actor-token-mismatch";var y=_.payload();if(y==null)return n.delete(i),"protobuf-message-payload-null";if(d(_,u))return n.delete(i),"peer-only-protobuf-message-validation-failure";if(m(_))return n.delete(i),"calling-xma-protobuf-message-validation-failure";var C=await p(_,a);if(!C.success)return n.delete(i),o("EBMinosLogger").minosLogger.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["act sanitizer validation failed: ",""])),C.error),"act_sanitizer_validation_failed";if(y.kind==="messageApplication"){var b,v,S,R,L=y.consumerMessage(),E=L==null||(b=L.payload)==null||(b=b.applicationData)==null?void 0:b.revoke;if(E!=null)return;var k=(v=y.proto.metadata)==null?void 0:v.frankingKey,I=y.bytes,T=t.topLevelProtobufV2.frankingTag,D=(S=y.proto.metadata)==null?void 0:S.frankingVersion;if(k==null)return n.delete(i),"franking-key-null";if(T==null)return r("gkx")("704")&&n.delete(i),"franking-tag-null";var x=await o("WAFranking").validateFrankingTag(new Uint8Array(I),o("WAFrankingTypes").castToFrankingKey(new Uint8Array(k)),o("WAFrankingTypes").castToFrankingTag(new Uint8Array(T)),D);if(x===!1)return r("gkx")("704")&&n.delete(i),"franking-tag-validation-failed";var $=t.topLevelProtobufV2.reportingTag,P=(R=f.frankingMetadata)==null?void 0:R.reportingTag;if($==null||P==null)return r("gkx")("704")&&n.delete(i),"reporting-tag-null";if(!o("WACryptoUtils").arrayBuffersEqual($.buffer,P))return r("gkx")("704")&&n.delete(i),"reporting-tag-mismatch";var N=f.clientTimestampMs;if(N!=null?N=o("WALongInt").numberOrThrowIfTooLarge(N):N=o("EBMinosProcessMessages").extractTimestampFromOtid(i),Math.abs(N-l)>36e5)return n.delete(i),"client_server_timestamp_delta_over_1_hour"}})),u=l.filter(Boolean);return i.addAnnotations({bool:{minos_validation_success:u.length===0},string_array:{minos_validation_errors:u}}),n}function d(e,t){var n,r=(n=e.encryptedTransportMessage())==null||(n=n.armadillo())==null||(n=n.payload)==null||(n=n.applicationData)==null||(n=n.metadataSync)==null?void 0:n.actions;if(r==null)return!1;var a=o("EBMinosTypes").userJidToUserFbId(o("WAGlobals").getMyUserJid());if(a==null)return o("EBMinosLogger").minosLogger.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed-to-get-userFbid"]))),!0;for(var i of r!=null?r:[])if((i.attachmentInterventionAction!=null||i.chatAction!=null||i.messageAction!=null||i.spectraAction!=null)&&a!==t)return!0;return!1}function m(e){var t,n=(t=e.encryptedTransportMessage())==null||(t=t.armadillo())==null||(t=t.extendedContentMessage())==null||(t=t.payload)==null?void 0:t.targetType;return!r("gkx")("5782")||n==null?!1:n===o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL||n===o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL||n===o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL||n===o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL||n===o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL||n===o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL||n===o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_GROUP_AUDIO_CALL||n===o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_GROUP_VIDEO_CALL||n===o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_ONGOING_AUDIO_CALL||n===o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_ONGOING_VIDEO_CALL}async function p(e,t){var n,r=(n=e.encryptedTransportMessage())==null||(n=n.armadillo())==null||(n=n.payload)==null||(n=n.content)==null?void 0:n.extendedContentMessage;if(r==null)return o("WAResultOrError").makeResult();var a=await t(r);return a}l.validateMinosMessages=c}),98);
__d("EBMinosDecryptAndValidateMessages",["Base64Utils","EBMinosDecryptMessages","EBMinosEncryptedMekVersion","EBMinosLogger","EBMinosTypes","EBValidateMinosMessages","MpsTypes","WALongInt","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d;function m(t){if(t==null)return null;var n=t.id,r=t.keys;if(n==null||r==null)return null;var a=o("EBMinosTypes").unsafeCastToMekFbId(n),i=r.mek_creator_info,l=r.mek_info,s=r.recipient_info;if(l==null||i==null||s==null)return null;var u=l.encrypted_mek,c=l.mek_creation_timestamp,d=l.mek_encryption_version,m=l.mek_id,p=l.roster_hash;if(u==null||d==null||m==null||p==null||c==null)return null;var _=o("EBMinosEncryptedMekVersion").MinosEncryptedMekVersion.cast(d);if(_==null)return o("EBMinosLogger").minosLogger.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast mek encryption version: ",""])),d),null;var f={encryptedMek:o("EBMinosTypes").unsafeCastToEncryptedMek(o("Base64Utils").toArrayBuffer(u)),mekCreationTimestamp:o("MpsTypes").toTimestamp(parseInt(c,10)),mekEncryptionVersion:_,mekId:o("EBMinosTypes").unsafeCastToMekId(o("Base64Utils").toArrayBuffer(m)),mekRosterHash:o("EBMinosTypes").unsafeCastMekRosterHash(o("Base64Utils").toArrayBuffer(p))},g=s.epoch_anon_id,h=s.epoch_fbid,y=s.epoch_head;if(g==null||h==null||y==null)return null;var C={epochAnonId:o("EBMinosTypes").unsafeCastToEpochNumber(o("WALongInt").decimalStringToLongInt(new TextDecoder().decode(o("Base64Utils").toArrayBuffer(g)))),epochFbId:o("EBMinosTypes").unsafeCastToEpochFbId(h),epochHead:o("EBMinosTypes").unsafeCastToEpochHead(o("Base64Utils").toArrayBuffer(y))},b=i.minos_keys,v=i.transport_keys;if(b==null&&v==null)return null;var S=b!=null?b:{},R=S.sender_auth_pk,L=S.sender_epoch_head,E=R!=null&&L!=null?{senderAuthPk:o("EBMinosTypes").unsafeCastToMailboxAuthPK(o("Base64Utils").toArrayBuffer(R)),senderEpochHead:o("EBMinosTypes").unsafeCastToEpochHead(o("Base64Utils").toArrayBuffer(L))}:null,k=v!=null?v:{},I=k.ephm_hpke_pk,T=k.ephm_signature,D=k.mek_creator_transport_signing_pk,x=I!=null&&T!=null&&D!=null?{ephmHpkePk:o("EBMinosTypes").unsafeCastToTransportSenderEphemeralPK(o("Base64Utils").toArrayBuffer(I)),ephmSignature:o("EBMinosTypes").unsafeCastToTransportSenderEphemeralKeySig(o("Base64Utils").toArrayBuffer(T)),mekCreatorTransportSigningPk:o("EBMinosTypes").unsafeCastToTransportSigningPK(o("Base64Utils").toArrayBuffer(D))}:null;return E==null&&x==null?null:{id:a,keys:{mekCreatorInfo:{minosKeys:E,transportKeys:x},mekInfo:f,recipientInfo:C}}}function p(e){var t=new Map((e!=null?e:[]).map(function(e){return e.id==null?null:[o("EBMinosTypes").unsafeCastToMekFbId(e.id),m(e)]}).filter(Boolean));return t}async function _(e){var t=e.encryptedMinosMessages,n=e.entryPoint,r=e.minosDecryptionKeys,a=e.qplFlow,i=e.source,l=e.threadId,m=e.validator;if(t.length===0)return o("WAResultOrError").makeResult({decryptionResult:new Map,errorMessages:[]});try{var _=p(r),f=await o("EBMinosDecryptMessages").minosDecryptMessages(l,_,t,i,n);if(!f.success)return o("EBMinosLogger").minosLogger.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["decrypt msgs failed: "," }"])),f.error),f;if(o("EBMinosLogger").minosLogger.DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["decrypt msgs completed. total: ",", success: ",", failed: ",""])),t.length,f.value.decryptionResult.size,f.value.errorMessages.length),f.value.decryptionResult.size===0)return f;var g=await o("EBValidateMinosMessages").validateMinosMessages(t,f.value.decryptionResult,m,a);return o("EBMinosLogger").minosLogger.DEV(c||(c=babelHelpers.taggedTemplateLiteralLoose(["validate msgs completed. total: ",", success: ",""])),t.length,g.size),o("WAResultOrError").makeResult({decryptionResult:g,errorMessages:f.value.errorMessages})}catch(e){return o("EBMinosLogger").minosLogger.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Failed to decrypt messages: ",""])),e),o("WAResultOrError").makeError("runtime-error")}}l.minosDecryptAndValidateMessages=_}),98);
__d("EBgenerateMPSMessageQuery",["EBGraphQLRestoreDefinition","MSGDataclassTypes.flow"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return{__typename:"MPSMessageQuery",ctx:{__typename:"MPSQueryContext",caller:o("MSGDataclassTypes.flow").MpsQueryCaller.HistoryRestore},query:{__typename:"MPSMessagePointQuery",include_deleted:!1,otids:t,thread_id:e}}}function s(t,n){return o("EBGraphQLRestoreDefinition").toMpsMessageQueryForGraphQLQuery(JSON.stringify(e(t,n)))}l.generateMPSMessageQuery=e,l.generateMPSMessageQueryForGraphQLQuery=s}),98);
__d("MAWDexie",["cr:10766"],(function(t,n,r,o,a,i,l){"use strict";i.exports=n("cr:10766")}),34);
__d("MAWDexieTable",["MAWDexie","justknobx"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return Promise.resolve(e)}function s(e){return e.reduce(function(e,t,n){return e.then(function(e){return t(n).then(function(t){return e.push(t),e})})},f([]))}function u(e){return r("MAWDexie").Promise.all(e)}function c(e){return r("MAWDexie").Promise.allSettled(e)}function d(e){return r("MAWDexie").Promise.PSD[e]}function m(e,t){r("MAWDexie").Promise.PSD[e]=t}function p(e){r("MAWDexie").Promise.PSD[e]=void 0}var _=(function(){function t(e,t,n,o){n===void 0&&(n=!0);var a=new(r("MAWDexie"))(e,babelHelpers.extends({},o,{chromeTransactionDurability:"relaxed",modifyChunkSize:r("justknobx")._("3166")}));t(a),this.name=e,this.stores=a,n&&this.open()}var n=t.prototype;return n.open=function(){this.stores.open()},n.close=function(){this.stores.close()},n.transact=function(n,r,o){var t=this;return e(this.stores.transaction(n,r.map(function(e){return t.stores[e]}),async function(){var e=await o();return e}))},babelHelpers.createClass(t,[{key:"tables",get:function(){return this.stores.tables}}])})();function f(e){return r("MAWDexie").Promise.resolve(e)}l.DEXIE_MIN_KEY=o("MAWDexie").Dexie.minKey,l.DEXIE_MAX_KEY=o("MAWDexie").Dexie.maxKey,l.undexify=e,l.dexieSequentialAll=s,l.dexieAll=u,l.dexieAllSettled=c,l.getDexiePSDItem=d,l.setDexiePSDItem=m,l.clearDexiePSDItem=p,l.DexieTable=_,l.dexieResolve=f}),98);
__d("MAWDbParticipant",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return e+"_"+t}i.craftParticipantId=e}),66);
__d("MAWDbThread",["MAWHexUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return o("MAWHexUtils").orderPreservingHex(e)+"_"+t}l.craftThreadOrder=e}),98);
__d("MAWDbSchema.dexie",["FBLogger","MAWDbMsg","MAWDbParticipant","MAWDbThread","MAWDbVersionList","MAWDexie","MAWDexieTable","MAWFolderTypes","MAWLocalizationType","MAWODSProxy","MAWTimeUtils","WAJids","WALogger","WAMsg","WAMsgType","WAOdsEnums","WAStanzaUtils","WATimeUtils","emptyFunction","vulture"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(t){var e=function(t){var e,n=(e=t.quote)==null?void 0:e.content;return t.quoteExternalId!=null&&(n==null?void 0:n.media)!=null};return t.messages.where("quoteExternalId").between(o("WAStanzaUtils").toStanzaId("0"),o("WAStanzaUtils").toStanzaId("["),!0,!0).filter(e).toArray().catch(function(){return t.messages.filter(e).toArray()}).then(function(e){var n=new Set(e.map(function(e){var t,n,r=(t=e.quote)==null?void 0:t.content;return r==null||(n=r.media)==null?void 0:n.plaintextHash}).filter(Boolean)),r=e.map(function(e){var t=e.msgId;return t});return t.media.filter(function(e){var t=e.plaintextHash;return n.has(t)}).toArray().then(function(e){var n=new Map(e.map(function(e){var t=e.mediaId,n=e.plaintextHash;return[n,t]}));return t.messages.where("msgId").anyOf(r).modify(function(e){var t=e.quote;if(t!=null&&t.content!=null){var r=t.content;r.mediaId=n.get(r.media.plaintextHash),delete r.media}})})})},c=function(t){return t.groupInfo.toCollection().modify(function(e){typeof e.inviter=="number"&&delete e.inviter})},d=function(){return o("MAWDexieTable").dexieResolve()},m=function(t){return t.threads.filter(function(e){return o("WAJids").switchOnMsgrChatJidType(e.jid,{group:function(){return!1},user:function(){return e.oldestMsg!=null}})}).toArray().then(function(e){var n=[];return e.forEach(function(e){n.push(e.oldestMsg),n.push(o("MAWDbMsg").toMsgId__UNSAFE_DO_NOT_USE(e.newestMsg))}),t.messages.where("msgId").anyOf(n.filter(Boolean)).toArray().then(function(n){var r=new Map,a=[],i=[];n.forEach(function(e){r.set(e.msgId,e)}),e.forEach(function(e){var n=r.get(e.oldestMsg),l=r.get(e.newestMsg);return(n==null?void 0:n.type)==="Admin"&&(l==null?void 0:l.type)==="Admin"&&(n.msgId===l.msgId?i.push(e.chatId):a.push(e)),o("MAWDexieTable").dexieAll(a.map(function(e){return t.messages.where("thread").equals(e.chatId).toArray()})).then(function(e){return e.forEach(function(e){if(e.length!==0){var t=e[0].thread,n=e.filter(function(e){return e.type!=="Admin"});n.length>0||i.push(t)}}),o("MAWDexieTable").dexieAll([t.threads.bulkDelete(i),t.messages.where("thread").anyOf(i).delete()])})})})})},p=function(t){return t.unrenderedMessages.toCollection().modify(function(e){if(e.type===o("WAMsgType").MSG_TYPE.DELETE_FOR_ME){var t=e.messageDeleteForMeTs;e.messageDeleteForMeTs=t}})},_=function(t){var e=0,n=0,a=r("MAWDexie").currentTransaction;if(a==null)throw r("FBLogger")("maw_db").mustfixThrow("transaction does not exist");return a.on("complete",function(){e>0&&o("MAWODSProxy").odsBumpEntityKey({amount:e,entity:o("WAOdsEnums").Entity.MESSAGE_MISSING_THREAD_JID,key:"fail"}),n>0&&o("MAWODSProxy").odsBumpEntityKey({amount:n,entity:o("WAOdsEnums").Entity.MESSAGE_MISSING,key:"fail"})}),t.threads.toArray().then(function(r){var a=r.reduce(function(e,t){return t!=null&&e.set(t.chatId,t),e},new Map);return o("MAWDexieTable").dexieAll([t.messages.toCollection().modify(function(t){if(t!=null){var r=a.get(t.thread);r!=null?t.threadJid=r.jid:e+=1}else n+=1}),t.unrenderedMessages.toCollection().modify(function(t){if(t!=null){var r=a.get(t.thread);r!=null?t.threadJid=r.jid:e+=1}else n+=1})])})},f=function(t){return t.isDualSend.toCollection().modify(function(e){e.version==null&&(e.version=1)})},g=function(t){return t.messages.toCollection().modify(function(e){e.type===o("WAMsgType").MSG_TYPE.ADMIN&&e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION&&(e.altIndex=o("MAWDbMsg").craftE2eeAdminMsgAltIndex(e.thread))})},h=function(t){return t.messages.toCollection().modify(function(e){e.sortOrderMs=o("MAWDbMsg").getSortOrderWithFallback(e)})},y=function(t){return t.threads.toCollection().modify(function(e){e.folder==null&&(e.folder=o("MAWFolderTypes").FOLDER_ID.INBOX)})},C=function(t){return t.messages.toCollection().modify(function(e){e.sortOrderMs=o("MAWDbMsg").getSortOrderWithFallback(e)})},b=function(t){return t.personalSenderKeyStatuses.toCollection().modify(function(e){e.rotateSenderKey=!0,e.hasSenderKey=new Set})},v=function(t){return t.messages.toCollection().modify(function(e){e.type===o("WAMsgType").MSG_TYPE.ADMIN&&e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&e.sortOrderMs!=null&&e.sortOrderMs>0&&(e.sortOrderMs=0)})},S=function(t){return t.messages.toCollection().modify(function(e){!(e.type===o("WAMsgType").MSG_TYPE.ADMIN&&(e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE||e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION))&&e.sortOrderMs!=null&&e.sortOrderMs<1661204086&&(e.sortOrderMs=o("MAWDbMsg").getCanonicalTsFromMsg(e)*1e3)})},R=function(t){return t.threads.filter(function(e){return e.isMigratedLocally===!0&&e.newestMsg!=null}).toArray().then(function(e){var n=e.map(function(e){return e.chatId}),r=new Map;return o("MAWDexieTable").dexieAll(e.map(function(e){return t.messages.where(["thread","sortOrderMs"]).between([e.chatId,0],[e.chatId,Number.MAX_VALUE]).last().then(function(e){e!=null&&r.set(e.thread,e.msgId)})})).then(function(){return t.threads.where("chatId").anyOf(n)})})},L=function(){return o("MAWDexieTable").dexieResolve()},E=function(t){return t.threads.toCollection().modify(function(e){if(e.lastReadMsgTs!=null&&e.lastReadMsgTs<o("WATimeUtils").MAX_INT&&(e.lastReadMsgTs=o("MAWTimeUtils").ensureValidMillisTime(e.lastReadMsgTs)),e.newestMsgTs!=null&&e.newestMsgTs<o("WATimeUtils").MAX_INT){var t=o("MAWTimeUtils").ensureValidMillisTime(e.newestMsgTs);e.newestMsgTs=t,t!=null&&(e.threadOrder=o("MAWDbThread").craftThreadOrder(t,e.jid))}})},k=function(t){return t.messages.toCollection().modify(function(e){e.type===o("WAMsgType").MSG_TYPE.ADMIN&&e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&(e.altIndex=o("MAWDbMsg").craftCutoverAdminMsgAltIndex(e.thread))})},I=function(){return o("MAWDexieTable").dexieResolve()},T=function(){return o("MAWDexieTable").dexieResolve()},D=function(){return o("MAWDexieTable").dexieResolve()},x=function(t){return t.participants.toCollection().modify(function(e){var t;e==null||!((t=e.userJid)!=null&&t.includes("@msgr@msgr"))||(e.id=e.id.replace("@msgr@msgr","@msgr"),e.userJid=e.userJid.replace("@msgr@msgr","@msgr"))}).then(r("emptyFunction"))},$=function(t){var e=t.threads.filter(function(e){return e.snippetMsg!=null&&e.snippetMsgTs==null});return e.toArray().then(function(n){var r=n.reduce(function(e,t){return t!=null&&t.snippetMsg!=null&&e.set(t.jid,t.snippetMsg),e},new Map),a=Array.from(r.values());return t.messages.where("msgId").anyOf(a).toArray().then(function(t){var n=t.reduce(function(e,t){return t!=null&&t.serverTs!=null&&e.set(t.msgId,t.serverTs),e},new Map);e.modify(function(e){var t=r.get(e.jid);if(t!=null){var a=n.get(t);a!=null&&(e.snippetMsgTs=o("WATimeUtils").castUnixTimeToMillisTime(a))}})})})},P=function(t){return t.threads.toArray().then(function(e){return o("MAWDexieTable").dexieAll(e.map(function(e){return t.participants.where("threadId").equals(e.chatId).modify(function(t){var n;t.threadJid=(n=t.threadJid)!=null?n:e.jid})}))})},N=P,M=function(t){var e=[];return t.groupInvites.toArray().then(function(n){var o=n.map(function(e){return e.invitedParticipantId});return t.participants.bulkGet(o).then(function(o){o.forEach(function(t,r){if(t==null){var o=n[r];e.push(o)}});var a=o.filter(Boolean);return t.groupInvites.bulkPut(n.map(function(t){r("vulture")("ENZBv3M2AdQWc64Uu-LwyNOTxR0=");var n=a.find(function(e){return e.id===t.invitedParticipantId});return n!=null?(t.inviteeJid=n.userJid,t.threadJid=n.threadJid,babelHelpers.extends({},t,{inviteeJid:n.userJid,threadJid:n.threadJid})):(e.push(t),t)}))})}).then(function(){return t.groupInvites.bulkDelete(e.map(function(e){return[e.invitedParticipantId,e.inviterJid]}))})},w=function(n){var t=new Map;return n.receipts.toArray().then(function(a){return o("MAWDexieTable").dexieAll(a.map(function(a){return n.messages.get({msgId:a.msgId}).then(function(i){if(i==null)return n.receipts.delete(a.msgId).then(r("emptyFunction"));var l=o("WAMsg").craftWAMsgIdString({author:i.author,chat:i.threadJid,externalId:i.externalId});if(t.has(l)){var s,u=(s=t.get(l))!=null?s:1;return t.set(l,u),o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Duplicate waMsgId found for receipt, number of duplicates: ",""])),u),n.receipts.delete(a.msgId).then(r("emptyFunction"))}else return t.set(l,1),n.receipts.where("msgId").equals(i.msgId).modify(function(e){e.waMsgId=l}).then(r("emptyFunction"))})}))})},A=function(){return o("MAWDexieTable").dexieResolve()},F=function(t){return t.participants.toArray().then(function(e){var n=e.map(function(e){return babelHelpers.extends({},e,{id:o("MAWDbParticipant").craftParticipantId(e.threadJid,e.userJid)})}),r=e.map(function(e){return e.id});return t.participants.bulkDelete(r).then(function(){t.participants.bulkPut(n)})})},O=function(t){return t.reactions.toCollection().modify(function(e){e.ts=e.ts})},B=new Map([[(s=o("MAWDbVersionList")).VERSION.V26,u],[s.VERSION.V27,c],[s.VERSION.V28,d],[s.VERSION.V29,m],[s.VERSION.V30,p],[s.VERSION.V31,_],[s.VERSION.V43,f],[s.VERSION.V44,g],[s.VERSION.V45,h],[s.VERSION.V46,y],[s.VERSION.V47,C],[s.VERSION.V53,b],[s.VERSION.V54,v],[s.VERSION.V55,S],[s.VERSION.V56,R],[s.VERSION.V57,L],[s.VERSION.V58,E],[s.VERSION.V60,k],[s.VERSION.V66,I],[s.VERSION.V68,T],[s.VERSION.V71,D],[s.VERSION.V72,x],[s.VERSION.V82,$],[s.VERSION.V85,P],[s.VERSION.V87,N],[s.VERSION.V90,M],[s.VERSION.V91,w],[s.VERSION.V101,A],[s.VERSION.V104,F],[s.VERSION.V116,O]]);l.dbUpgrades=B}),98);
__d("MAWDbSchemaReStoreDexieUtils",["FBLogger","MAWDbSchema","MAWDbSchema.dexie","sortBy"],(function(t,n,r,o,a,i,l){"use strict";var e=r("sortBy")(Array.from(new Set([].concat(Array.from(o("MAWDbSchema").dbSchema.keys()),Array.from(o("MAWDbSchema.dexie").dbUpgrades.keys())))).map(function(e){return{schema:o("MAWDbSchema").dbSchema.get(e),upgrade:o("MAWDbSchema.dexie").dbUpgrades.get(e),version:e}}),function(e){var t=e.version;return t}),s=function(t,n){return Array.from(t.filter(function(e){return e.version<=n&&e.schema!=null}).reduce(function(e,t){var n;return(n=t.schema)==null||n.forEach(function(t){e.set(t.name,t)}),e},new Map).values())},u=function(t,n){return s(t,n).reduce(function(e,t){var n=t.autoIncrement,o=t.dexieOnly_primaryKeyUnique,a=t.name,i=t.primaryKey,l=t.removed,s=a.replace(/^e2ee_/,"");if(l===!0)return e[s]=null,e;if(n&&o===!0)throw r("FBLogger")("messenger_web").mustfixThrow("Invalid schema, cannot have both autoincremnet and unique constraints "+JSON.stringify(t));var u=n?"++":"",c=o===!0?"&":"",d=(i.length>1?"[":"")+i.join("+")+(i.length>1?"]":""),m=Object.values(t.indexes).map(function(e){var t=e.columns,n=e.unique!==!1,r=t.length>1,o=e.multiEntry_DO_NOT_USE===!0,a=n&&!o?"&":"",i=o?"*":"",l=""+a+i;return""+l+(r?"[":"")+t.join("+")+(r?"]":"")}).join(",");return e[s]=[""+u+c+d,m].filter(Boolean).join(","),e},{})},c=function(n){return u(e,n)};l.MAW_DB_VERSION_CHANGES=e,l.getDexieSchemaForVersion=u,l.getCompleteDexieSchemaForVersion=c}),98);
__d("MAWDbVersion",["MAWCurrentUser","MAWDbSchemaReStoreDexieUtils","MAWDbVersionList","MAWGetDbVersion","MAWIndexedDbMetadata","MAWODSProxy","MWFBLogger","Promise","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h=o("MWFBLogger").MWLogger().tags(["db","getDexieDbVersion"]),y=o("MAWGetDbVersion").getArmadilloDbVersion(),C=o("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(Math.min(o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version,y>0?y:1/0));function b(e,t){var n=t.schema,r=t.upgrade,o=t.version;return n!=null&&r!=null?e.version(o).stores(n).upgrade(r):n!=null?e.version(o).stores(n):r!=null?e.version(o).upgrade(r):e.version(o),o}function v(t){return new(g||(g=n("Promise")))(function(n){if(!indexedDB){n();return}var r=indexedDB.open(t);r.onupgradeneeded=function(r){r.target.transaction.abort();var o=r.target.result;h.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose([""," onupgradeneeded - closing db"])),t),o==null||o.close(),n()},r.onsuccess=function(e){var r=e.target.result,a=r==null?void 0:r.version;h.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose([""," version: ",""])),t,a!=null?a:"null"),r==null||r.close(),a!=null?(a%10>=1&&o("MAWODSProxy").odsBumpEntityKey({amount:1,entity:o("WAOdsEnums").Entity.MAW_DB_UNEXPECTED_VERSION,key:"fail_"+a%10}),n(o("MAWDbVersionList").toVersion(a/10))):n()},r.onerror=function(e){var r;h.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose([""," error ",""])),t,e==null||(r=e.target)==null||(r=r.error)==null?void 0:r.message),n()},r.onblocked=function(e){var n=e.target.result,r=n==null?void 0:n.version;h.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose([""," blocked, version: ",""])),t,r!=null?r:"null"),n==null||n.close()}})}function S(){var e=o("MAWCurrentUser").getID();return v(o("MAWIndexedDbMetadata").dbName(e))}function R(e,t){if(e.upgrade!=null||t.upgrade!=null)return!0;var n=Object.keys((e==null?void 0:e.schema)||{}),r=Object.keys((t==null?void 0:t.schema)||{}),o=[].concat(n,r),a=new Set(o);return a.size!==o.length}function L(e){return e.reduce(function(e,t,n){if(n===0)return[babelHelpers.extends({},t,{schema:o("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(t.version)})];var r=e[e.length-1],a=babelHelpers.extends({},t,{schema:t.schema!=null?o("MAWDbSchemaReStoreDexieUtils").getDexieSchemaForVersion([t],t.version):null});return R(r,a)?(e.push(a),e):(e.splice(e.length-1,1,babelHelpers.extends({},r,a,{schema:babelHelpers.extends({},r==null?void 0:r.schema,a==null?void 0:a.schema)})),e)},[])}function E(e,t,n,r){var a=r!=null?r:o("MAWGetDbVersion").getArmadilloDbVersion==null?void 0:o("MAWGetDbVersion").getArmadilloDbVersion();h.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["current db version: ",", target db version: ",""])),n,a),a==null&&h.WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["version is not set in QE"]))),n!=null&&n>a&&(h.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["current db version is greater than target db version"]))),a=n);var i=o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(e){var t=e.version;return n==null||t>n}).filter(function(e){var t=e.version;return a==null||a>=t}),l=o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(e){var t=e.version;return a==null||a>=t});if(i.length===0||i.length===l.length){h.DEBUG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Skipping db upgrade and just applying latest schema"]))),t.addAnnotations({bool:{isUpgradeNeeded:!1}});var s=o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version,u=Math.min(a!=null&&a>0?a:s,s);return e.version(u).stores(o("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(u)),u}var c=L(i);h.DEBUG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Applying "," updates between "," and ",""])),c.length,i[0].version,i[i.length-1].version);var g=c.filter(function(e){return!!e.upgrade}).map(function(e){return e.version.toString()}),y=c.filter(function(e){return!!e.schema}).map(function(e){return e.version.toString()});g.length&&t.addAnnotations({string_array:{dataMigrationVersions:g}}),y.length&&t.addAnnotations({string_array:{schemaUpgradeVersions:y}}),t.addAnnotations({bool:{isUpgradeNeeded:!0}});var C=0;return c.forEach(function(t){var n;C=Math.max((n=b(e,t))!=null?n:0,C!=null?C:0)}),C}l.CURRENT_MAW_STORES=C,l.getDexieDbVersion=v,l.getDBVersion=S,l.updateDB=E}),98);
__d("MAWDexieError",[],(function(t,n,r,o,a,i){"use strict";var e="ModifyError",l="BulkError",s="OpenFailedError",u="VersionChangeError",c="SchemaError",d="UpgradeError",m="InvalidTableError",p="MissingAPIError",_="NoSuchDatabaseError",f="InvalidArgumentError",g="SubTransactionError",h="UnsupportedError",y="InternalError",C="DatabaseClosedError",b="PrematureCommitError",v="ForeignAwaitError",S="UnknownError",R="ConstraintError",L="DataError",E="TransactionInactiveError",k="ReadOnlyError",I="VersionError",T="NotFoundError",D="InvalidStateError",x="InvalidAccessError",$="AbortError",P="TimeoutError",N="QuotaExceededError",M="SyntaxError",w="DataCloneError",A={AbortError:$,BulkError:l,ConstraintError:R,DatabaseClosedError:C,DataCloneError:w,DataError:L,ForeignAwaitError:v,InternalError:y,InvalidAccessError:x,InvalidArgumentError:f,InvalidStateError:D,InvalidTableError:m,MissingAPIError:p,ModifyError:e,NoSuchDatabaseError:_,NotFoundError:T,OpenFailedError:s,PrematureCommitError:b,QuotaExceededError:N,ReadOnlyError:k,SchemaError:c,SubTransactionError:g,SyntaxError:M,TimeoutError:P,TransactionInactiveError:E,UnknownError:S,UnsupportedError:h,UpgradeError:d,VersionChangeError:u,VersionError:I};i.DEXIE_ERROR=A}),66);
__d("MAWIDbSetupQplEventListener",["MAWDexieError","MAWQplProxy","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s=null;function u(t){var n=new Set(Object.keys(o("MAWDexieError").DEXIE_ERROR));n.has(t.reason)&&e!=null&&(e.endFail(t.reason),o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(25310776,"6155"),"database_setup_failed"),s!=null&&(s(),s=null))}var c=function(r,o){return e=r,s=o,t.addEventListener("unhandledrejection",u),function(){return t.removeEventListener("unhandledrejection",u)}};l.trackDbSetupFailure=c}),98);
__d("MAWLowLevelApiTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e={EXISTING_GROUP_INVITE:"existing_group_invite",MISSING_GROUP:"missing_group"},l={EXPIRED_GROUP_INVITE:"expired_group_invite",MISSING_GROUP:"missing_group",MISSING_GROUP_INVITE:"missing_group_invite"},s=n("$InternalEnum")({Initializing:"initializing",Open:"open",Closed:"closed",Error:"error",Upgrading:"upgrading"});i.WRITE_GROUP_INVITE_ERROR=e,i.GET_GROUP_INVITE_ERROR=l,i.DatabaseState=s}),66);
__d("MAWDbFactory",["ClientConsistencyEventEmitter","Deferred","MAWCurrentUser","MAWDbVersion","MAWDexieTable","MAWGetDbVersion","MAWIDbSetupQplEventListener","MAWIndexedDBDeletion","MAWIndexedDbMetadata","MAWLowLevelApiTypes","MAWQplProxy","MAWReliabilityMonitor","MWFBLogger","getErrorSafe","gkx","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g=["backendInitPromise","middleware","onDbPopulate"];function h(t,n){var a=null,i=o("MWFBLogger").MWLogger().tags(["db",t,n]),l=new(r("Deferred")),h=!1,y=!1,C,b=!1,v=null,S=n!=="worker"?null:o("MAWReliabilityMonitor").MAWReliabilityMonitorSingleton.startMonitoring("DB_"+t+"_"+n,function(){return{extra:{isMakingDB:String(h),willBeSetup:String(y)},reason:String(v),state:(function(){if(v==null)return o("MAWReliabilityMonitor").HealthReportState.UNKNOWN;switch(v){case o("MAWLowLevelApiTypes").DatabaseState.Initializing:case o("MAWLowLevelApiTypes").DatabaseState.Upgrading:return o("MAWReliabilityMonitor").HealthReportState.PENDING;case o("MAWLowLevelApiTypes").DatabaseState.Open:return o("MAWReliabilityMonitor").HealthReportState.OK;case o("MAWLowLevelApiTypes").DatabaseState.Closed:case o("MAWLowLevelApiTypes").DatabaseState.Error:return o("MAWReliabilityMonitor").HealthReportState.ERROR}})()}});function R(){l=new(r("Deferred")),C==null||C(),h=!1,y=!1}function L(){return y}function E(){return l.getPromise().then(function(){return b})}async function k(L,E,k){var I=E.backendInitPromise,T=E.middleware,D=E.onDbPopulate,x=babelHelpers.objectWithoutPropertiesLoose(E,g),$=o("MAWCurrentUser").getID(),P=o("MAWIndexedDbMetadata").dbName($),N=r("qpl")._(25310776,"6155");function M(e){v=e,S==null||S.updateState()}if(a!=null){i.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["DB exists"]))),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_exsists");return}var w=o("MAWQplProxy").startQplUserFlow(r("qpl")._(1056836116,"905"),{string:{db:t,name:P}});if(y=!0,h)return o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_make_in_progress"),l.getPromise();i.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Starting DB Setup"]))),h=!0,o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_make_started"),C=o("MAWIDbSetupQplEventListener").trackDbSetupFailure(w,function(){M(o("MAWLowLevelApiTypes").DatabaseState.Error),l.reject("DB setup failed"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_setup_failed"),R()}),M(o("MAWLowLevelApiTypes").DatabaseState.Initializing);var A=await o("MAWDbVersion").getDexieDbVersion(P);A==null&&(b=!0),w.addAnnotations({int:{currentVersion:A}});var F=k!=null?k:o("MAWGetDbVersion").getArmadilloDbVersion();if(w.addAnnotations({int:{targetVersion:F}}),I&&(A||0)<F){w.addPoint("separate_read_waiting_on_worker_upgrade"),i.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Waiting for worker to upgrade schema..."])));try{await I}catch(e){throw i.catching(r("getErrorSafe")(e)).mustfixThrow("Worker startup promise rejected, schema upgrade failed.")}var O=await o("MAWDbVersion").getDexieDbVersion(P);if(O!==F)throw i.mustfixThrow("Main thread waiting on worker schema upgrade from %s to %s, upgrade failed with version %s",A,F,O);A=O}else n==="worker"&&(o("MAWQplProxy").sendQPLIntAnnotationThroughBridge(r("qpl")._(1056839232,"112"),"dbVersion",A!=null?A:0),o("MAWQplProxy").sendQPLIntAnnotationThroughBridge(r("qpl")._(1056839232,"112"),"useSentBytesCache",r("gkx")("33008")?1:0));var B=function(a){var e=o("MAWDbVersion").updateDB(a,w,A,k);return!I&&n==="worker"&&o("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(r("qpl")._(1056839232,"112"),"dbUpgradeNeeded",A!==e),i.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["latest pushed version: ",", current: ",", requested: ",""])),e,A,k!=null?k:"<latest>"),n==="worker"&&(A!==e?o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_version_upgraded"):o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_version_upgrade_not_required")),e};return a=new(o("MAWDexieTable")).DexieTable(P,function(e){T.forEach(function(t){e.use(t(L))});var a=B(e);e.on("populate",function(e){if(!e){M(o("MAWLowLevelApiTypes").DatabaseState.Error),l.reject("Missing DB for populate event"),w.endFail("on_populata-missing_txn"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_on_populate_missing_txn");return}i.info("MAWDB populated. HasPopulateEvent: %s",!!D),D==null||D(e)}),e.on("blocked",function(){i.MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["DB Open blocked"]))),M(o("MAWLowLevelApiTypes").DatabaseState.Error),l.reject("DB Open blocked"),w.endFail("db_blocked"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_blocked"),R()}),e.on("ready",function(e){if(i.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["MAW DB setup complete"]))),h=!1,e==null){M(o("MAWLowLevelApiTypes").DatabaseState.Error),i.MUSTFIX(p||(p=babelHelpers.taggedTemplateLiteralLoose(["DB is null"]))),l.reject("DB is null"),w.endFail("db_null"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_null"),R();return}M(o("MAWLowLevelApiTypes").DatabaseState.Open),C==null||C(),l.resolve(),w.endSuccess({int:{dbVersion:a}}),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_ready")}),e.on("close",function(){M(o("MAWLowLevelApiTypes").DatabaseState.Closed),i.WARN(_||(_=babelHelpers.taggedTemplateLiteralLoose(["DB forcibly closed"]))),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_forcibly_closed")}),e.on("versionchange",function(e){i.WARN(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Versionchange detected: ("," -> "," (event version: ",", highestUsed: (","), name: ",""])),e==null?void 0:e.oldVersion,e==null?void 0:e.newVersion,String(e==null?void 0:e.version),a,e==null?void 0:e.name),M(o("MAWLowLevelApiTypes").DatabaseState.Upgrading),n!=="worker"&&r("ClientConsistencyEventEmitter").emit("softRefresh","mawdb_versionchange"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_versionchange")})},void 0,x),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_make_requested"),l.getPromise()}function I(e){if(a==null)throw i.mustfixThrow('IndexDB has not been initialized before executing "'+(e!=null?e:"unnamed")+'"');return a}function T(e){return a!=null&&!h?Promise.resolve(a):(l=l||new(r("Deferred")),l.getPromise().then(function(){return I(e)}))}async function D(){var e=await T();e!=null&&(e.close(),a=null),R()}function x(){a=null,R()}function $(e){r("promiseDone")(D());var t=o("MAWIndexedDbMetadata").dbName(e!=null?e:o("MAWCurrentUser").getID());r("promiseDone")(o("MAWIndexedDBDeletion").deleteDB(t,"maw")),S==null||S.stopMonitoring()}return{closeDB:D,deleteDb:$,getDB:T,getDBExn:I,isNewDb:E,makeDB:k,reset_singleton_INTERNAL_ONLY:x,setupPromise:function(){return l.getPromise()},willSetupDB:L}}l.makeIDBFactory=h}),98);
__d("MAWIndexedDbUI",["ExecutionEnvironment","MAWDbFactory","MAWDbMutationMiddleware","MAWDbProtocolMsgIdMiddleware","MAWDexieTable","MAWIndexedDb","MAWTransactor","Promise","cr:3527","gkx","performance"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(){var e=o("MAWDbFactory").makeIDBFactory("ui_idb","main");return{closeDB:e.closeDB,deleteDb:e.deleteDb,getDB:e.getDB,makeDB:function(a,i,l){var t=[o("MAWDbMutationMiddleware").getMAWDbMutationMiddleware];r("gkx")("1760")&&t.push(o("MAWDbProtocolMsgIdMiddleware").MAWDbProtocolMsgIdMiddleware),n("cr:3527")!=null&&t.push(n("cr:3527"));var s=e.makeDB(a,{autoOpen:r("gkx")("6817"),backendInitPromise:i.backendInitPromise,cache:"disabled",middleware:t,onDbPopulate:i.onDbPopulate},l);return s},reset_singleton_INTERNAL_ONLY:e.reset_singleton_INTERNAL_ONLY}}var d=c(),m=d.makeDB,p=d.closeDB,_=d.getDB,f=d.deleteDb,g=d.reset_singleton_INTERNAL_ONLY,h=(s||(s=r("ExecutionEnvironment"))).isInBrowser?_("MawDbInUISingleton_INTERNAL_ONLY").then(function(e){return{openReadonlyTransaction:function(n,a,i){return e.stores.transaction("r",a,function(){return o("MAWDexieTable").setDexiePSDItem("transactorName",n),o("MAWDexieTable").setDexiePSDItem("transactionRequested",(u||(u=r("performance"))).now()+u.timeOrigin),i(e.stores)})},openReadWriteTransaction:function(n,a,i){return e.stores.transaction("rw",a,function(){return o("MAWDexieTable").setDexiePSDItem("transactorName",n),o("MAWDexieTable").setDexiePSDItem("transactionRequested",(u||(u=r("performance"))).now()+u.timeOrigin),i(e.stores)})}}}):new(e||(e=n("Promise")))(function(){});l.makeMsgrTransactor=o("MAWTransactor").makeMsgrUITransactor_IMPORT_FROM_MAWIndexedDbUI_INSTEAD,l.afterTransaction=o("MAWIndexedDb").afterTransaction,l.makeMAWIndexedDBFactory=c,l.makeDB=m,l.closeDB=p,l.getDB=_,l.deleteDb=f,l.reset_singleton_INTERNAL_ONLY=g,l.MawDbInUISingleton=h}),98);
__d("MAWCacheServiceMiddleware",["FBLogger","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=e.table(t);return n}function s(){return{create:function(n){try{return babelHelpers.extends({},n,{table:function(r){return e(n,r)}})}catch(e){var t=r("getErrorSafe")(e);return r("FBLogger")("MAWCacheService").catching(t).mustfix("Error applying MAW Cache Service Middleware"),n}},name:"MAWCacheServiceMiddleware",stack:"dbcore"}}l.default=s}),98);
__d("MAWDataSyncQueue",["WALogger","getErrorSafe","qex","throttle"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("qex")._("853")||1e3,c=r("qex")._("855")||1e3,d=function(){return _=!1,C({isUnloading:!0})},m=[],p=[],_=!1,f=[],g=function(){var e,t=m.splice(0,m.length);(e=p).push.apply(e,t)},h=function(){return p.splice(0,u)},y=function(n){var t=h();if(t.length!==0)return Promise.all(f.map(function(r,a){return r(t,n).catch(function(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Unhandled exception caught in middleware "," sync: ",""])),a,t)})})).then(function(){return y(n)})},C=async function(t){if(!_){_=!0,g();try{await y(t)}catch(t){var e,n=r("getErrorSafe")(t);throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[MAWIndexedDbMiddleware] error handling queue batch: ",""])),(e=n==null?void 0:n.message)!=null?e:n.toString()),t}finally{_=!1,m.length>0&&b()}}},b=r("throttle")(C,c),v=function(t,n){m.push({type:t,value:n}),b()},S=function(t){f.some(function(e){return e===t})||f.push(t)},R=function(){f=[]},L=function(){m=[],p=[]},E=function(){return m};l.forceFlushDataSyncQueue=d,l.addSyncItem=v,l.registerDataSyncCallback=S,l.clearDataSyncCallbacks=R,l.clearDataSyncQueue_FOR_TESTING_ONLY=L,l.getDataSyncQueue_FOR_TESTING_ONLY=E}),98);
__d("MAWDataSyncMiddleware",["FBLogger","MAWDataSyncQueue","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=new Set(["contacts","groupInfo","messages","participants","threads","reactions","xma","pendingStanzas"]);function s(t,n){var r=t.table(n);return e.has(n)?babelHelpers.extends({},r,{mutate:function(t){return r.mutate(t).then(function(e){return t.type==="delete"?(t.keys.forEach(function(e){o("MAWDataSyncQueue").addSyncItem(t.type,{key:e,tableName:n})}),e):(e.results!=null?e.results.forEach(function(e){o("MAWDataSyncQueue").addSyncItem(t.type,{key:e,tableName:n,values:t.values})}):e.lastResult!=null&&o("MAWDataSyncQueue").addSyncItem(t.type,{key:e.lastResult,tableName:n,values:t.values}),e)})}}):r}function u(){return{create:function(t){try{return babelHelpers.extends({},t,{table:function(n){return s(t,n)}})}catch(n){var e=r("getErrorSafe")(n);return r("FBLogger")("messenger_web").catching(e).mustfix("Error applying DataSync Middleware, messages made during this session will not be properly synced to registered consumers"),t}},name:"MAWDataSyncMiddleware",stack:"dbcore"}}l.getDataSyncMiddleware=u}),98);
__d("MAWIndexedDb",["ExecutionEnvironment","FBLogger","MAWBridge","MAWCacheServiceMiddleware","MAWDataSyncMiddleware","MAWDbFactory","MAWDbMutationMiddleware","MAWDbProtocolMsgIdMiddleware","MAWDbSchema","MAWDexie","MAWLoadDbMigrationVersion","MAWTransactor","MWFBLogger","cr:10181","cr:10182","cr:3527","gkx","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){e===void 0&&(e="idb");var t=o("MAWDbFactory").makeIDBFactory(e,"worker");function a(e){return t.setupPromise().then(function(){return t.getDBExn(e)})}return babelHelpers.extends({},t,{getSignalDB:a,makeDB:async function(a,i,l){var e=[o("MAWDbMutationMiddleware").getMAWDbMutationMiddleware];return r("gkx")("1760")&&e.push(o("MAWDbProtocolMsgIdMiddleware").MAWDbProtocolMsgIdMiddleware),e.push(r("MAWCacheServiceMiddleware")),i.enableDataSyncMiddleware&&e.push(o("MAWDataSyncMiddleware").getDataSyncMiddleware),n("cr:3527")!=null&&e.push(n("cr:3527")),r("justknobx")._("4087")&&await r("MAWLoadDbMigrationVersion")(a),t.makeDB(a,{autoOpen:!0,middleware:e,onDbPopulate:i.onDbPopulate},l)}})}var c=u(),d="idle",m=c.isNewDb,p=c.willSetupDB,_=function(t,n,r){return c.makeDB(t,n,r).then(function(){d="ready"})},f=c.closeDB,g=c.getDBExn,h=c.getSignalDB,y=c.getDB,C=function(t){return c.reset_singleton_INTERNAL_ONLY()},b=c.deleteDb;function v(){return d}function S(e){var t=d;return d="migrating",e.finally(function(){d=t})}var R=new WeakMap,L=new WeakMap,E=o("MWFBLogger").MWLogger().tags(["db","afterTransaction"]);function k(e){var t=r("MAWDexie").currentTransaction;if(t==null)throw E.mustfixThrow("afterTransactionEffect called outside of dexie transaction");if(typeof e=="function"){var n=R.get(t)||[];n.push(e),R.set(t,n),n.length===1&&t.on("complete",function(){var e=R.get(t)||[];e.forEach(function(e){e()}),R.delete(t)})}}function I(e){var t=r("MAWDexie").currentTransaction;if(t==null)throw E.mustfixThrow("afterTransaction called outside of dexie transaction","maw_db");var a=L.get(t);if(a!=null)a.push(e);else{var i=[e];L.set(t,i),t.on("complete",function(){L.delete(t),r("gkx")("5675")&&(s||(s=r("ExecutionEnvironment"))).isInMainThread&&n("cr:10182")!==null&&n("cr:10181")!==null?n("cr:10182").handleEvents(n("cr:10181").LSDatabaseSingleton,i):o("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:i})})}}var T=new Set(["NewMsg","NewMsgs","MsgUpdated","NewMedia","NewMediaRange","MediaExpired","XMAShareExpired","DeleteMessagesOfThread","UpsertReaction","DeleteReaction","DeleteMessages","NewXMA","EditMsgHistoryAdded","MsgsStartCountdown","MsgClearCountdown","XMAShareTombstoned","NewReceiverFetchInfo","NewXMAs","NewPoll","RavenActionUpdate"]);function D(t,n){if(n!==!0&&T.has(t.tag)){r("FBLogger")("wmi").INFO(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[MpsMessageRendering] Ignoring afterTxn event: ",""])),t.tag);return}if(t.tag==="UpdateThreadActivity"&&r("FBLogger")("wmi").mustfix("Thread consistency uses MAW DB mechanism instead of new one"),t.tag==="ThreadUpdated")try{var o=t.value.snippetContactIDs;o!=null&&o.some(function(e){return e==="Facebook User"})&&(E.mustfix('Something is still setting a contact id as "Facebook User"'),t.value=babelHelpers.extends({},t.value,{snippetContactIDs:o.map(function(e){return e==="Facebook User"?"0":e})}))}catch(e){}I(t)}function x(e,t){var n=r("MAWDexie").currentTransaction;if(n==null)throw E.mustfixThrow("afterTransactionForThreadEvent called outside of dexie transaction","maw_db");n.on("complete",function(){o("MAWBridge").getBridge().fireAndForget("threadEvent",t,e)})}l.TABLES_TO_ENCRYPT=o("MAWDbSchema").TABLES_TO_ENCRYPT,l.makeMsgrTransactor=o("MAWTransactor").makeMsgrTransactor,l.makeMAWIndexedDBFactory=u,l.isNewDb=m,l.willSetupDB=p,l.makeDB=_,l.closeDB=f,l.getDBExn=g,l.getSignalDB=h,l.getDB=y,l.setDB_INTERNAL_USE_ONLY=C,l.deleteDb=b,l.getDbStatus=v,l.updateStatusDuringMigration=S,l.afterTransactionEffect=k,l.afterTransaction=D,l.afterTransactionThreadEvent=x}),98);
__d("MAWDbAppMeta",[],(function(t,n,r,o,a,i){"use strict";var e={allowSecurityAlert:"allowSecurityAlert",allowSecurityAlertForSelf:"allowSecurityAlertForSelf",dbMigrationVersion:"dbMigrationVersion",deviceJid:"deviceJid",hasMigratedFromDexie:"hasMigratedFromDexie",hmacKey:"hmacKey",hotlikeSticker:"hotlikeSticker",isBackfilledForOccamadillo:"isBackfilledForOccamadillo",msgTypeVersion:"msgTypeVersion",restoreMigrationAttempts:"restoreMigrationAttempts",restoreToDexieMigrationComplete:"restoreToDexieMigrationComplete"};i.AppMetaKeysEnum=e}),66);
__d("MAWLoadDbMigrationVersion",["ExecutionEnvironment","MAWBridge","MAWCurrentUser","MAWDBMigrationUtils","MAWDbAppMeta","MAWDbObjEncryption","MAWIndexedDbMetadata","MAWUnrecoverableDbErrors","MWFBLogger","Promise","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g=o("MWFBLogger").MWLogger().tags(["db","MAWLoadDbMigrationVersion"]);function h(t){var a=o("MAWCurrentUser").getID(),i=o("MAWIndexedDbMetadata").dbName(a);return new(f||(f=n("Promise")))(function(n){if(!indexedDB){n();return}var a=indexedDB.open(i);a.onupgradeneeded=function(t){t.target.transaction.abort();var r=t.target.result;g.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] "," onupgradeneeded - closing db"])),i),r==null||r.close(),n()},a.onsuccess=function(e){var a=e.target.result;if(a==null){n();return}try{var i=a.transaction("appMeta","readonly");i.onerror=function(e){var t;g.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] Transaction error: ",""])),(t=e.target.error)==null?void 0:t.message),a.close(),n()};var l=i.objectStore("appMeta"),m=l.get(o("MAWDbAppMeta").AppMetaKeysEnum.dbMigrationVersion);m.onerror=function(e){var t;g.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] Request error: ",""])),(t=e.target.error)==null?void 0:t.message),a.close(),n()},m.onsuccess=function(e){a.close();var i=e.target.result;if(i!=null)try{var l=o("MAWDbObjEncryption").decryptDbObj(babelHelpers.extends({},i),"appMeta",t),s=l.value.dbMigrationVersion;s!=null&&(o("MAWDBMigrationUtils").mawDbMigrationVersion.version=s)}catch(e){var u=r("getErrorSafe")(e);g.catching(u).MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] Failed to decrypt appMeta row"]))),(_||(_=r("ExecutionEnvironment"))).isInWorker&&o("MAWBridge").getBridge().fireAndForget("event","unrecoverableDbError",{error:new(o("MAWUnrecoverableDbErrors")).EarRuntimeError})}n()}}catch(e){var p=r("getErrorSafe")(e);g.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] Error accessing appMeta: ",""])),p.message),a.close(),n()}},a.onerror=function(e){var t;g.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] "," error ",""])),i,e==null||(t=e.target)==null||(t=t.error)==null?void 0:t.message),n()},a.onblocked=function(e){var t=e.target.result;g.DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] "," blocked"])),i),t==null||t.close()}})}l.default=h}),98);
__d("MAWLLAMigrationUtils",["Random","gkx","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=r("justknobx")._("652"),s=Math.max(e,10),u=s*10,c=new Map([["FTS",u]]);function d(e){if(r("gkx")("9340"))return 1;var t=c.get(e);return t!=null?t:s}function m(e,t){t===void 0&&(t={});var n=d(e);return e==="debug"||e==="test"?[]:r("gkx")("23956")&&o("Random").coinflip(n)?[r("qpl")._(1056839327,"560"),babelHelpers.extends({double:{sampleRate:1/n},string:{transactor:e}},t)]:[]}l.getTransactorQPLParam=m}),98);
__d("MAWTransactor",["MAWDexie","MAWDexieTable","MAWErrorObject","MAWIndexedDb","MAWIndexedDbUI","MAWLLAMigrationUtils","MAWQplProxy","MAWTransactionMode","MWFBLogger","WAExceededStorageQuota","WALogger","gkx","performance"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=["MWPTransactor"],d=o("MWFBLogger").MWLogger();function m(t,n,a,i,l,s){return i!=null&&r("MAWDexie").currentTransaction!=null&&i.endFail("invoked_in_nested_transaction",{string:{current_transaction_mode:r("MAWDexie").currentTransaction.mode},string_array:{current_transaction_store_names:r("MAWDexie").currentTransaction.storeNames}}),r("MAWDexie").currentTransaction!=null&&o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["makeMsgrTransactor "," should not be called inside another transaction. The transaction will be forced to execute on top-level"])),l),t.transact(n,a,s)}function p(e){var t=o("MAWLLAMigrationUtils").getTransactorQPLParam(e),n=t.length===2?t:[null,void 0],r=n[0],a=n[1];return r!=null?o("MAWQplProxy").startQplUserFlow(r,a,{sendThroughBridge:!1}):null}function _(e,t,n,r){return C(e,t,function(e){return o("MAWIndexedDb").getDB(e)},n,r)}function f(e,t,n){return C(e,t,o("MAWIndexedDbUI").getDB,n)}function g(e,t,n){return C(e,t,o("MAWIndexedDbUI").getDB,n)}var h=0,y=new Map;function C(e,t,n,a,i){var l=Object.keys(e),_=l.some(function(t){return e[t]===o("MAWTransactionMode").READWRITE})?o("MAWTransactionMode").READWRITE:o("MAWTransactionMode").READONLY;return function(){for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];var C=p(t),S=null,R=function(){return self.clearInterval(S)};if(C!=null&&(C.addAnnotations({string:{mode:_===o("MAWTransactionMode").READWRITE?"readwrite":"readonly"},string_array:{stores:l}}),r("gkx")("1006")&&t==="bulkCreateThreadByJid")){var L=1e3,E=Date.now();S=self.setInterval(function(){C.addAnnotations({int:{heartbeatLatestAliveSinceStartMs:Date.now()-E}})},L),self.setTimeout(R,o("MAWQplProxy").DEFAULT_WORKER_QPL_TIMEOUT_MS)}var k=(u||(u=r("performance"))).now()+u.timeOrigin;return n(t).then(function(e){var n=Array.from(y.values());C==null||C.addPoint("lock_wait_start",{string_array:{maybeLockedOn:n}});var p=(u||(u=r("performance"))).now();return i==null||i.onTxnRequestedCb==null||i.onTxnRequestedCb.apply(i,f),m(e,_,l,C,t,function(){o("MAWDexieTable").setDexiePSDItem("transactionRequested",k),o("MAWDexieTable").setDexiePSDItem("transactorName",t),C==null||C.addPoint("dexie_transaction_start"),h+=1;var m=h;y.set(m,t);var _=C!=null?e.stores[l[0]].get("").then(function(){C==null||C.addPoint("lock_wait_end"),C==null||C.addPoint("transaction_opened"),C==null||C.addPoint("transactor_execution_start")}):o("MAWDexieTable").dexieResolve();return _.then(function(){return a(e.stores).apply(void 0,f)}).then(function(e){if(r("gkx")("6795")&&(i==null?void 0:i.explicitlyCloseTxn)===!0){var a;(a=r("MAWDexie").currentTransaction)==null||(a=a.idbtrans)==null||a.commit==null||a.commit()}y.delete(m),C==null||C.addPoint("transactor_execution_end"),C==null||C.endSuccess(),R();var l=(u||(u=r("performance"))).now()-p;return l>5e3&&(o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[Slow maw transaction] "," took ","ms to complete. Potentially waiting for locks on ",""])),t,l,n.join(", ")),d.mustfix("[Slow maw transaction] %s took long to complete. Potentially waiting for locks on $s",t,n.join(", "))),e}).catch(function(e){y.delete(m),o("WAExceededStorageQuota").checkQuotaExceededError(e);var n=e.name==="AbortError"?e==null?void 0:e.inner:null,r=b(n);if(C==null||C.markError("transaction_error",null,e),e instanceof Error){var a=e,i=typeof(a==null?void 0:a.stack)=="string"?a.stack:typeof(a==null?void 0:a.stack),l=typeof(a==null?void 0:a.message)=="string"?a.message:typeof(a==null?void 0:a.message);C==null||C.addAnnotations({string:{errMessage:l,errStack:i,innerError:r}})}C==null||C.endFail("transaction_fail"),R();var s=o("MAWErrorObject").getErrorObject(e);throw v(s).mustfixThrow("[%s] Error performing %s transaction. Inner error: %s",c.join("|"),t!=null?t:"",r!=null?r:"unknown")})})}).catch(function(e){o("WAExceededStorageQuota").checkQuotaExceededError(e),C==null||C.endFail("transaction_fail"),R();var n=o("MAWErrorObject").getErrorObject(e);throw v(n).mustfixThrow("[%s] Error performing %s transaction",c.join("|"),t!=null?t:"")})}}function b(e){if(typeof e=="string")return e;if(e instanceof Error)return e.name+": "+e.message;if(typeof e=="object")try{return JSON.stringify(e)}catch(e){}return null}function v(e){return e?d.catching(e):d}l.makeMsgrTransactor=_,l.makeMsgrUITransactor_IMPORT_FROM_MAWIndexedDbUI_INSTEAD=f,l.makeMsgrUIWritableTransactor=g}),98);
__d("MAWVaultDb",["FBLogger","MAWQplProxy","MAWVault","getErrorSafe","gkx","isObject","isPlainObject","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=.001,s=new WeakMap;function u(e,t){return t[e]!=null}var c=r("gkx")("23909");function d(t,n,a){if(!r("isPlainObject")(t)||!c||!u(n,a)||t==null)return t;var i=s.get(t);if(i!=null)return i;var l=Math.random()<e?o("MAWQplProxy").startQplUserFlow(r("qpl")._(25301509,"119")):null;try{var d=a[n],m=p(t,d,o("MAWVault").vault);return l==null||l.endSuccess(),s.set(t,m),m}catch(e){l==null||l.endFail("vault_fail");var _=r("getErrorSafe")(e);throw r("FBLogger")("messenger_web").mustfixThrow("%s - Failed to vault an entity in the table: %s",_.message,n)}}function m(t,n,a){if(!r("isPlainObject")(t)||!c||!u(n,a)||t==null)return t;var i=Math.random()<e?o("MAWQplProxy").startQplUserFlow(r("qpl")._(741087294,"2028")):null;try{var l=p(t,a[n],o("MAWVault").unvault);return i==null||i.endSuccess(),l}catch(e){i==null||i.endFail("unvault_fail");var s=r("getErrorSafe")(e);throw r("FBLogger")("messenger_web").mustfixThrow("%s - Unvaulting failed for an entity in the table: %s",s.message,n)}}function p(e,t,n){if(e==null)return e;var o=Object.entries(t).filter(function(t){var n=t[0];return e[n]!=null});return o.length===0?e:o.reduce(function(e,t){var o=t[0],a=t[1];return typeof a!="boolean"&&r("isObject")(a)?e[o]=p(e[o],a,n):a===!0&&(e[o]=n(e[o])),e},babelHelpers.extends({},e))}l.vaultDbRow=d,l.unvaultDbRow=m,l.setInPath=p}),98);
__d("MAWVaultDefinitions",[],(function(t,n,r,o,a,i){"use strict";var e={editMsgHistory:{msgContent:{content:!0}},messages:{msgContent:{content:!0},quote:{content:{msgContent:{content:!0}}}},unrenderedMessages:{msgContent:!0}},l={edit_message_history:{messageContent:!0},messages:{replyMessageText:!0,text:!0},threads:{snippet:!0}};i.ARMADILLO_IDB_VAULT_DEFINITIONS=e,i.PERSISTED_DB_VAULT_DEFINITIONS=l}),66);
__d("isEncryptionAtRestEnabled",["isInstamadillo","qex"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("qex")._("507")===!0?!0:r("isInstamadillo")()}l.default=e}),98);
__d("MAWDbMiddlewareMutations",["MAWDbObjEncryption","MAWVaultDb","MAWVaultDefinitions","gkx","isEncryptionAtRestEnabled"],(function(t,n,r,o,a,i,l){"use strict";var e=r("gkx")("23909");function s(t,n,a){if(!e&&!(r("isEncryptionAtRestEnabled")()||r("gkx")("5469")))return t;var i=babelHelpers.extends({},t);return i=o("MAWVaultDb").unvaultDbRow(i,n,o("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS),i=o("MAWDbObjEncryption").encryptDbObj(i,n,a),i}function u(t,n){return e?o("MAWVaultDb").unvaultDbRow(babelHelpers.extends({},t),n,o("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS):t}function c(t,n,r){var a=o("MAWDbObjEncryption").decryptDbObj(babelHelpers.extends({},t),n,r);return e?o("MAWVaultDb").vaultDbRow(a,n,o("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS):a}function d(t,n){if(t!=null)return e?o("MAWVaultDb").vaultDbRow(t,n,o("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS):t}l.mutateValue=s,l.mutateVaultedValue=u,l.getValue=c,l.getVaultedValue=d}),98);
__d("MAWDbProtocolMsgIdMiddleware",["FBLogger","MAWDBMigrationUtils","MAWJidUtils","MAWODSProxy","Random","WAOdsEnums","getErrorSafe","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("justknobx")._("3300");function s(t){return babelHelpers.extends({},t,{get:function(n){return t.get(n).then(function(e){return d(e,"get"),e})},getMany:function(n){return t.getMany(n).then(function(e){return e==null?void 0:e.map(function(e){return d(e,"getMany"),e})})},mutate:function(r){return r.type==="add"?r.values.map(function(e){return u(e)}):r.type==="put"&&r.values.map(function(t){t.protocolMsgId==null&&(o("MAWDBMigrationUtils").mawDbMigrationVersion.version>=o("MAWDBMigrationUtils").MAWDB_DEDUPE_MSGS_MIGRATION_VERSION?(o("Random").coinflip(e)&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_after_migration_complete.migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version}),u(t)):t.rowId<o("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.cursorValue?(o("Random").coinflip(e)&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_below_migration_cursor.migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version}),u(t)):o("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.isRunning&&t.rowId<o("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.cursorValue+o("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.batchSize&&(o("Random").coinflip(e)&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_in_current_migration_batch.migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version}),u(t)))}),t.mutate(r)},query:function(n){return t.query(n).then(function(e){var t;return e==null||(t=e.result)==null||t.map(function(e){d(e,"query")}),e})}})}function u(e){e.protocolMsgId=o("MAWJidUtils").toProtocolMsgIdStringForMAWStorage(e)}function c(e){return(e==null?void 0:e.rowId)==null&&(e==null?void 0:e.externalId)==null}function d(t,n){try{if(c(t)){n!=="get"&&o("Random").coinflip(e)&&r("FBLogger")("messenger_web").warn("Corrupted message row returned from DB, msg is null:%s, queryType: %s",t==null,n);return}(t==null?void 0:t.protocolMsgId)==null&&o("Random").coinflip(e)&&(o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version+".append_protocol_msg_id_for_put_operation_jk_"+String(!0)}),o("MAWDBMigrationUtils").mawDbMigrationVersion.version>=o("MAWDBMigrationUtils").MAWDB_DEDUPE_MSGS_MIGRATION_VERSION&&r("FBLogger")("maw_db_migration").warn("Message with null protocolMsgId after the msg dedupe migration. type: %s, rowId: %s, externalId: %s",t==null?void 0:t.type,t==null?void 0:t.rowId,t==null?void 0:t.externalId)),t!=null&&t.protocolMsgId!=null&&t.protocolMsgId!==o("MAWJidUtils").toProtocolMsgIdStringForMAWStorage(t)&&o("Random").coinflip(e)&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"inconsistent_protocol_msg_id."+(t==null?void 0:t.type)+".migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version+".append_protocol_msg_id_for_put_operation_jk_"+String(!0)})}catch(e){var a=r("getErrorSafe")(e);r("FBLogger")("messenger_web").catching(a).mustfix("Error while checking protocol msg id")}}function m(){return{create:function(t){try{return babelHelpers.extends({},t,{table:function(n){return n!=="messages"?t.table(n):s(t.table(n))}})}catch(n){var e=r("getErrorSafe")(n);return r("FBLogger")("messenger_web").catching(e).mustfix("Error applying Protocol MsgId Middleware"),t}},name:"MAWDbProtocolMsgIdMiddleware",stack:"dbcore"}}l.appendProtocolMsgId=u,l.isCorruptedMsgRow=c,l.MAWDbProtocolMsgIdMiddleware=m}),98);
__d("MAWDBMigrationUtils",["MAWDbAppMeta","MAWIndexedDb","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";var e={batchSize:0,cursorValue:0,isRunning:!1},s={version:0},u=o("MAWIndexedDb").makeMsgrTransactor({appMeta:o("MAWTransactionMode").READONLY},"getMigrationVersion",function(e){return function(){return e.appMeta.get(o("MAWDbAppMeta").AppMetaKeysEnum.dbMigrationVersion).then(function(e){var t,n=(t=e==null?void 0:e.value.dbMigrationVersion)!=null?t:0;return s.version=n,n})}}),c=6;l.mawDbDedupeMsgsMigrationStatus=e,l.mawDbMigrationVersion=s,l.getMigrationVersion=u,l.MAWDB_DEDUPE_MSGS_MIGRATION_VERSION=c}),98);
__d("MAWDbMutationMiddleware",["FBLogger","MAWDbMiddlewareMutations","getErrorSafe","vulture"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return{create:function(n){return babelHelpers.extends({},n,{table:function(a){var t=n.table(a);try{return babelHelpers.extends({},t,{get:function(r){return t.get(r).then(function(t){if(t!=null)return o("MAWDbMiddlewareMutations").getValue(t,a,e)})},getMany:function(r){return t.getMany(r).then(function(t){return t.map(function(t){if(t!=null)return o("MAWDbMiddlewareMutations").getValue(t,a,e)})})},mutate:function(r){var n=null;switch(r.type){case"add":case"put":n=r.values.map(function(t){return o("MAWDbMiddlewareMutations").mutateValue(t,a,e)});break;case"delete":break;case"deleteRange":break}return r.type==="delete"||r.type==="deleteRange"||n==null?t.mutate(r):(r.values=n,t.mutate(r).then(function(e){return e}))},openCursor:function(r){return t.openCursor(r).then(function(t){return t==null||t.value==null?t:u(t,a,e)})},query:function(r){return t.query(r).then(function(t){if(t.result.length===0||typeof t.result[0]!="object")return t;var n=t.result.map(function(t){return o("MAWDbMiddlewareMutations").getValue(t,a,e)});return t.result=n,t})}})}catch(e){var i=r("getErrorSafe")(e);return r("FBLogger")("messenger_web").catching(i).mustfix("Error applying MAWDbMiddleware"),t}}})},name:"MAWDbMutationMiddleware",stack:"dbcore"}}function s(){return{create:function(t){return babelHelpers.extends({},t,{table:function(n){var e=t.table(n);try{return babelHelpers.extends({},e,{get:function(r){return e.get(r).then(function(e){return o("MAWDbMiddlewareMutations").getVaultedValue(e,n)})},getMany:function(a){return e.getMany(a).then(function(e){return r("vulture")("SMxI1wxhqOhNsUbqaKEGeOiO21w="),e.map(function(e){return o("MAWDbMiddlewareMutations").getVaultedValue(e,n)})})},mutate:function(r){return r.type==="delete"||r.type==="deleteRange"||(r.values=r.values.map(function(e){return o("MAWDbMiddlewareMutations").mutateVaultedValue(e,n)})),e.mutate(r)},openCursor:function(r){return e.openCursor(r).then(function(e){return e==null||e.value==null?e:c(e,n)})},query:function(r){return e.query(r).then(function(e){return e.result.length===0||typeof e.result[0]!="object"?e:babelHelpers.extends({},e,{result:e.result.map(function(e){return o("MAWDbMiddlewareMutations").getVaultedValue(e,n)})})})}})}catch(t){var a=r("getErrorSafe")(t);return r("FBLogger")("messenger_web").catching(a).mustfix("Error applying MAWDbMiddleware"),e}}})},name:"getMAWVaultMiddleware",stack:"dbcore"}}function u(e,t,n){var r;return Object.create(e,{continue:{get:function(){return e.continue}},continuePrimaryKey:{get:function(){return e.continuePrimaryKey}},key:{get:function(){return e.key}},primaryKey:{get:function(){return e.primaryKey}},start:{value:function(i){return e.start(function(){r=o("MAWDbMiddlewareMutations").getValue(e.value,t,n);try{e.value=r}catch(e){}i()})}},value:{get:function(){return r}}})}function c(e,t){var n;return Object.create(e,{continue:{get:function(){return e.continue}},continuePrimaryKey:{get:function(){return e.continuePrimaryKey}},key:{get:function(){return e.key}},primaryKey:{get:function(){return e.primaryKey}},start:{value:function(a){return e.start(function(){n=o("MAWDbMiddlewareMutations").getVaultedValue(e.value,t);try{e.value=n}catch(e){}a()})}},value:{get:function(){return n}}})}l.getMAWDbMutationMiddleware=e,l.getMAWVaultMiddleware=s}),98);
__d("MAWDbEncryptObjContent",["MAWKeychainNaClCrypto"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return o("MAWKeychainNaClCrypto").encryptTweetNaClArrayBuffer(e,t,n)}l.encryptContent=e}),98);
__d("MAWArmadilloAppDataTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={},f={},g={},h={},y={},C={},b={},v={},S={},R={},L={};s.name="ProtocolMsgId",s.internalSpec={externalId:[1,(e=o("WAProtoConst")).TYPES.STRING],author:[2,e.TYPES.STRING],chat:[3,e.TYPES.STRING]},u.name="MetaSyncMessageKeyProto",u.internalSpec={fromMe:[1,e.TYPES.BOOL],id:[2,e.TYPES.STRING]},c.name="MetaSyncMessageProto",c.internalSpec={key:[1,e.TYPES.MESSAGE,u],ts:[2,e.TYPES.INT64]},d.name="MetaSyncMessageRangeProto",d.internalSpec={lastMessageTimestamp:[1,e.TYPES.INT64],lastSystemMessageTimestamp:[2,e.TYPES.INT64],messages:[3,e.FLAGS.REPEATED|e.TYPES.MESSAGE,c]},m.name="MetaSyncChatActionProto",m.internalSpec={type:[1,e.TYPES.STRING],chatJid:[2,e.TYPES.STRING],archived:[3,e.TYPES.BOOL],ts:[4,e.TYPES.INT64],messageRange:[5,e.TYPES.MESSAGE,d],read:[6,e.TYPES.BOOL]},p.name="MetaSyncMessageActionProto",p.internalSpec={type:[1,e.TYPES.STRING],protocolMsgId:[2,e.TYPES.MESSAGE,s]},_.name="MetaSyncActionProto",_.internalSpec={chatAction:[1,e.TYPES.MESSAGE,m],messageAction:[2,e.TYPES.MESSAGE,p],__oneofs__:{action:["chatAction","messageAction"]}},f.name="MetaSyncAppDataProto",f.internalSpec={actions:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,_]},g.name="EncryptedBackupsSecretsEpochProto",g.internalSpec={id:[1,e.TYPES.UINT64],anonId:[2,e.TYPES.BYTES],rootKey:[3,e.TYPES.BYTES],status:[4,e.TYPES.INT32]},h.name="EncryptedBackupsSecretsProto",h.internalSpec={backupId:[1,e.TYPES.UINT64],serverDataId:[2,e.TYPES.UINT64],epoch:[3,e.FLAGS.REPEATED|e.TYPES.MESSAGE,g],tempOcmfClientState:[4,e.TYPES.BYTES],mailboxRootKey:[5,e.TYPES.BYTES],obliviousValidationToken:[6,e.TYPES.BYTES]},y.name="FingerprintProto",y.internalSpec={currentIndex:[1,e.TYPES.UINT32],deviceIndexes:[2,e.FLAGS.REPEATED|e.TYPES.UINT32],rawId:[3,e.TYPES.UINT32]},C.name="SyncKeyDataProto",C.internalSpec={keyId:[1,e.TYPES.BYTES],keyData:[2,e.TYPES.BYTES],keyEpoch:[3,e.TYPES.UINT32],timestamp:[4,e.TYPES.INT64],fingerprint:[5,e.TYPES.MESSAGE,y]},b.name="SyncKeyShareProto",b.internalSpec={keys:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,C],orphanKeys:[2,e.FLAGS.REPEATED|e.TYPES.BYTES]},v.name="SyncKeyRequestProto",v.internalSpec={keyIds:[1,e.FLAGS.REPEATED|e.TYPES.BYTES]},S.name="AppDataProto",S.internalSpec={type:[1,e.TYPES.STRING],actions:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,_],encryptedBackupsSecrets:[3,e.TYPES.MESSAGE,h],syncKeyShare:[4,e.TYPES.MESSAGE,b],syncKeyRequest:[5,e.TYPES.MESSAGE,v]},R.name="IdentitiesPerDeviceProto",R.internalSpec={deviceJid:[1,e.TYPES.STRING],serializedPubKey:[2,e.TYPES.BYTES],baseKey:[3,e.TYPES.BYTES]},L.name="AppDataTableSchemaProto",L.internalSpec={externalId:[1,e.TYPES.STRING],ts:[2,e.TYPES.INT64],contents:[3,e.TYPES.MESSAGE,S],permittedIdentitiesPerDevice:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,R],ack:[5,e.TYPES.INT32],appDataId:[6,e.TYPES.INT32],recipientDevices:[7,e.FLAGS.REPEATED|e.TYPES.STRING],sendPartial:[8,e.TYPES.BOOL]},l.ProtocolMsgIdSpec=s,l.MetaSyncMessageKeyProtoSpec=u,l.MetaSyncMessageProtoSpec=c,l.MetaSyncMessageRangeProtoSpec=d,l.MetaSyncChatActionProtoSpec=m,l.MetaSyncMessageActionProtoSpec=p,l.MetaSyncActionProtoSpec=_,l.MetaSyncAppDataProtoSpec=f,l.EncryptedBackupsSecretsEpochProtoSpec=g,l.EncryptedBackupsSecretsProtoSpec=h,l.FingerprintProtoSpec=y,l.SyncKeyDataProtoSpec=C,l.SyncKeyShareProtoSpec=b,l.SyncKeyRequestProtoSpec=v,l.AppDataProtoSpec=S,l.IdentitiesPerDeviceProtoSpec=R,l.AppDataTableSchemaProtoSpec=L}),98);
__d("MAWArmadilloAppMetaTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="DbAppMetaValuesProto",s.internalSpec={msgTypeVersion:[1,(e=o("WAProtoConst")).TYPES.INT32],hmacKey:[2,e.TYPES.BYTES],allowSecurityAlert:[3,e.TYPES.BOOL],hotlikeSticker:[4,e.TYPES.BYTES],isBackfilledForOccamadillo:[5,e.TYPES.BOOL],allowSecurityAlertForSelf:[11,e.TYPES.BOOL],hasMigratedFromDexie:[12,e.TYPES.BOOL],restoreMigrationAttempts:[13,e.TYPES.INT32],deviceJid:[14,e.TYPES.STRING],restoreToDexieMigrationComplete:[15,e.TYPES.BOOL],dbMigrationVersion:[16,e.TYPES.INT32]},u.name="AppMetaTableSchemaProto",u.internalSpec={key:[1,e.TYPES.STRING],value:[2,e.TYPES.MESSAGE,s]},l.DbAppMetaValuesProtoSpec=s,l.AppMetaTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloCollectionVersionsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="CollectionVersionsTableSchemaProto",s.internalSpec={collection:[1,(e=o("WAProtoConst")).TYPES.STRING],version:[2,e.TYPES.INT32],state:[3,e.TYPES.STRING],finiteFailureStartTime:[4,e.TYPES.INT64],ltHash:[5,e.TYPES.BYTES],isCollectionInMacMismatchFatal:[6,e.TYPES.BOOL],isCollectionLthashInconsistent:[7,e.TYPES.BOOL]},l.CollectionVersionsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloDeletedMessagesTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="DeletedMessagesTableSchemaProto",s.internalSpec={author:[1,(e=o("WAProtoConst")).TYPES.STRING],chat:[2,e.TYPES.STRING],externalId:[3,e.TYPES.STRING],reason:[4,e.TYPES.STRING]},l.DeletedMessagesTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloDeviceChangeAlertsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="DeviceChangeAlertsTableSchemaProto",s.internalSpec={action:[1,(e=o("WAProtoConst")).TYPES.STRING],isArchived:[2,e.TYPES.BOOL],deviceChangeAlertsId:[3,e.TYPES.INT64],location:[4,e.TYPES.STRING],model:[5,e.TYPES.STRING],ts:[6,e.TYPES.INT64],loggedOut:[7,e.TYPES.BOOL],deviceJid:[8,e.TYPES.STRING],identity:[9,e.TYPES.BYTES],platform:[10,e.TYPES.STRING],latitude:[11,e.TYPES.STRING],longitude:[12,e.TYPES.STRING],isConfirmed:[13,e.TYPES.BOOL],isNotified:[14,e.TYPES.BOOL]},l.DeviceChangeAlertsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloDyiBatchTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={BACKUP_RESTORE:0,E2E_DYI:1},u={};u.name="DyiBatchTableSchemaProto",u.internalSpec={batchId:[1,(e=o("WAProtoConst")).TYPES.INT32],numMessages:[2,e.TYPES.INT32],oldestTs:[3,e.TYPES.INT64],threadId:[4,e.TYPES.STRING],isThread:[5,e.TYPES.BOOL],numMessagesRestored:[6,e.TYPES.INT32],qplInstanceKeyForThread:[7,e.TYPES.INT64],qplFlowDescriptor:[8,e.TYPES.ENUM,s],qplInstanceKeyE2E:[9,e.TYPES.INT64],numThreadsRestored:[10,e.TYPES.INT64]},l.DYI_BATCH_TABLE_SCHEMA_PROTO_QPL_FLOW_DESCRIPTOR=s,l.DyiBatchTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloEBMsgRangesTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="EBMsgRangesTableSchemaProto",s.internalSpec={rangeId:[1,(e=o("WAProtoConst")).TYPES.UINT32],threadJid:[2,e.TYPES.STRING],minMsgExternalId:[3,e.TYPES.STRING],maxMsgExternalId:[4,e.TYPES.STRING],minMsgSortOrderMs:[5,e.TYPES.UINT64],maxMsgSortOrderMs:[6,e.TYPES.UINT64],creationTime:[7,e.TYPES.INT64]},l.EBMsgRangesTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloContactsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="EphemeralSettingProto",s.internalSpec={ephemeralExpirationInSec:[1,(e=o("WAProtoConst")).TYPES.UINT32],ephemeralLastUpdatedOrSetTimestamp:[2,e.TYPES.INT64]},u.name="EphemeralSyncResponseBackoffInfo",u.internalSpec={syncResponseRetries:[1,e.TYPES.INT32],syncResponseSentTs:[2,e.TYPES.INT64]},l.EphemeralSettingProtoSpec=s,l.EphemeralSyncResponseBackoffInfoSpec=u}),98);
__d("MAWArmadilloMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={},f={},g={},h={},y={};s.name="MsgContentProto",s.internalSpec={content:[1,(e=o("WAProtoConst")).TYPES.STRING],adminMsgContent:[2,e.FLAGS.REPEATED|e.TYPES.STRING],adminType:[3,e.TYPES.STRING],obsoleteExpiration:[4,e.TYPES.INT32],obsoleteTs:[5,e.TYPES.INT64],subtype:[6,e.TYPES.STRING],protobuf:[7,e.TYPES.BYTES],screenshotActionType:[8,e.TYPES.INT32],authorName:[9,e.TYPES.STRING],version:[10,e.TYPES.INT32],mentionedJids:[11,e.FLAGS.REPEATED|e.TYPES.STRING],commands:[12,e.FLAGS.REPEATED|e.TYPES.MESSAGE,u]},u.name="MsgContentCommandProto",u.internalSpec={commandType:[1,e.TYPES.INT32],offset:[2,e.TYPES.INT32],length:[3,e.TYPES.INT32],validationToken:[4,e.TYPES.STRING]},c.name="ReportingMetaProto",c.internalSpec={frankingTag:[1,e.TYPES.BYTES],frankingVersion:[2,e.TYPES.INT32],reportingContent:[3,e.TYPES.BYTES],reportingTag:[4,e.TYPES.BYTES],frankingKey:[5,e.TYPES.BYTES]},d.name="DbQuotedMsgProto",d.internalSpec={remoteJid:[1,e.TYPES.STRING],content:[2,e.TYPES.MESSAGE,h]},m.name="VideoMsgContentProto",m.internalSpec={duration:[1,e.TYPES.INT32],width:[2,e.TYPES.INT32],height:[3,e.TYPES.INT32],mimetype:[4,e.TYPES.STRING],jpegThumbnail:[5,e.TYPES.BYTES],jpegThumbnailHeight:[6,e.TYPES.INT32],jpegThumbnailWidth:[7,e.TYPES.INT32]},p.name="ImageMsgContentProto",p.internalSpec={width:[1,e.TYPES.UINT32],height:[2,e.TYPES.UINT32],jpegThumbnail:[3,e.TYPES.BYTES],jpegThumbnailHeight:[4,e.TYPES.INT32],jpegThumbnailWidth:[5,e.TYPES.INT32]},_.name="AudioMsgContentProto",_.internalSpec={duration:[1,e.TYPES.INT32],mimetype:[2,e.TYPES.STRING],played:[3,e.TYPES.BOOL],waveform:[4,e.TYPES.BYTES]},f.name="DocumentFileMsgContentProto",f.internalSpec={filename:[1,e.TYPES.STRING],mimetype:[2,e.TYPES.STRING]},g.name="QuotedDbMediaProto",g.internalSpec={mediaType:[1,e.TYPES.STRING],plaintextHash:[2,e.TYPES.STRING],size:[3,e.TYPES.INT32],ts:[4,e.TYPES.INT64],mediaEntry:[5,e.TYPES.BYTES],validatedVideoInfo:[6,e.TYPES.MESSAGE,m],validatedImageInfo:[7,e.TYPES.MESSAGE,p],validatedAudioInfo:[8,e.TYPES.MESSAGE,_],validatedDocumentFileInfo:[9,e.TYPES.MESSAGE,f]},h.name="DbQuotedMsgContentProto",h.internalSpec={type:[1,e.TYPES.STRING],ts:[2,e.TYPES.INT64],externalId:[3,e.TYPES.STRING],author:[4,e.TYPES.STRING],msgContent:[5,e.TYPES.MESSAGE,s],obsoleteMedia:[6,e.TYPES.MESSAGE,g],msgId:[7,e.TYPES.STRING],mediaId:[8,e.TYPES.INT32],sourceId:[9,e.TYPES.STRING],xmaMessageType:[10,e.TYPES.INT32],specialTextSize:[11,e.TYPES.INT32],plaintextHash:[12,e.TYPES.STRING],expirationTs:[13,e.TYPES.INT64]},y.name="MessagesTableSchemaProto",y.internalSpec={type:[1,e.TYPES.STRING],ts:[2,e.TYPES.INT64],externalId:[3,e.TYPES.STRING],msgId:[4,e.TYPES.STRING],author:[5,e.TYPES.STRING],ack:[6,e.TYPES.INT32],resendCount:[7,e.TYPES.INT32],msgContent:[8,e.TYPES.MESSAGE,s],altIndex:[9,e.TYPES.STRING],forwardingScore:[10,e.TYPES.INT32],quote:[11,e.TYPES.MESSAGE,d],messageExpirationTs:[12,e.TYPES.INT64],ephemeralSetting:[13,e.TYPES.MESSAGE,o("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],revokedExternalId:[14,e.TYPES.STRING],isForwarded:[15,e.TYPES.BOOL],originalTs:[17,e.TYPES.INT64],sortOrderMs:[18,e.TYPES.INT64],reportingMeta:[19,e.TYPES.MESSAGE,c],messageDeleteTs:[20,e.TYPES.INT64],ephemeralCounterStarted:[21,e.TYPES.BOOL],quoteExternalId:[22,e.TYPES.STRING],unsendMsgContentDeleteTs:[23,e.TYPES.INT64],rowId:[24,e.TYPES.INT32],thread:[25,e.TYPES.INT32],mediaId:[26,e.TYPES.INT32],ephemeralMsgDisappeared:[27,e.TYPES.BOOL],threadJid:[28,e.TYPES.STRING],xmaId:[29,e.TYPES.INT32],specialTextSize:[30,e.TYPES.INT32],xmaMessageType:[31,e.TYPES.INT32],isExpiredXmaMsg:[32,e.TYPES.BOOL],ravenEphemeralType:[33,e.TYPES.INT32],ravenEphemeralMediaState:[34,e.TYPES.INT32],editCount:[35,e.TYPES.INT32],groupId:[36,e.TYPES.STRING],groupIndex:[37,e.TYPES.INT64],groupSize:[38,e.TYPES.INT64],receiverFetchId:[39,e.TYPES.STRING],source:[40,e.TYPES.STRING],quoteExpirationTs:[41,e.TYPES.INT64],applicationErrorCode:[42,e.TYPES.INT32],hdType:[43,e.TYPES.INT32],pollStanzaId:[44,e.TYPES.STRING],collapsibleId:[45,e.TYPES.STRING],isCollapsed:[46,e.TYPES.BOOL]},l.MsgContentProtoSpec=s,l.MsgContentCommandProtoSpec=u,l.ReportingMetaProtoSpec=c,l.DbQuotedMsgProtoSpec=d,l.VideoMsgContentProtoSpec=m,l.ImageMsgContentProtoSpec=p,l.AudioMsgContentProtoSpec=_,l.DocumentFileMsgContentProtoSpec=f,l.QuotedDbMediaProtoSpec=g,l.DbQuotedMsgContentProtoSpec=h,l.MessagesTableSchemaProtoSpec=y}),98);
__d("MAWArmadilloEditMsgHistoryTableSchema.pb",["MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="EditMsgHistoryTableSchemaProto",s.internalSpec={author:[1,(e=o("WAProtoConst")).TYPES.STRING],editMsgHistoryId:[2,e.TYPES.INT32],editTs:[3,e.TYPES.INT64],msgContent:[4,e.TYPES.MESSAGE,o("MAWArmadilloMessagesTableSchema.pb").MsgContentProtoSpec],originalMsgExternalId:[5,e.TYPES.STRING],specialTextSize:[6,e.TYPES.INT32],threadJid:[7,e.TYPES.STRING],editExternalId:[8,e.TYPES.STRING],sendStatus:[9,e.TYPES.INT32]},l.EditMsgHistoryTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloGroupInfoTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="GroupInfoSchemaProto",s.internalSpec={groupJid:[1,(e=o("WAProtoConst")).TYPES.STRING],threadId:[2,e.TYPES.INT32],creator:[3,e.TYPES.STRING],creationTs:[4,e.TYPES.INT64],name:[5,e.TYPES.STRING],nameOwner:[6,e.TYPES.STRING],nameTs:[7,e.TYPES.INT64],msgExpiration:[8,e.TYPES.INT32],participantVersion:[9,e.TYPES.STRING],inviter:[10,e.TYPES.STRING],memberAddMode:[11,e.TYPES.STRING]},l.GroupInfoSchemaProtoSpec=s}),98);
__d("MAWArmadilloGroupInvitesTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="GroupInvitesTableSchemaProto",s.internalSpec={inviterJid:[1,(e=o("WAProtoConst")).TYPES.STRING],invitedParticipantId:[2,e.TYPES.STRING],inviteCode:[3,e.TYPES.STRING],inviteExpirationTs:[4,e.TYPES.INT64],caption:[5,e.TYPES.STRING]},l.GroupInvitesTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloMediaTablesSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={NONE:0,LQ_4K:1,HQ_4K:2},u={},c={},d={},m={},p={},_={},f={},g={},h={};u.name="ChunkTableSchemaProto",u.internalSpec={plaintextHash:[1,(e=o("WAProtoConst")).TYPES.STRING],blobData:[2,e.TYPES.BYTES],mimetype:[3,e.TYPES.STRING],hashedPlaintextHash:[4,e.TYPES.STRING],chunkId:[5,e.TYPES.INT32]},c.name="MediaBackupSchemaProto",c.internalSpec={mediaBackupId:[1,e.TYPES.INT32],mediaId:[2,e.TYPES.INT32],objectId:[3,e.TYPES.STRING],msgId:[4,e.TYPES.STRING],fbid:[5,e.TYPES.STRING]},d.name="MediaEntriesProto",d.internalSpec={msgId:[1,e.TYPES.STRING],mediaEntryData:[2,e.TYPES.BYTES]},m.name="VideoMsgContentProto",m.internalSpec={duration:[1,e.TYPES.UINT32],width:[2,e.TYPES.UINT32],height:[3,e.TYPES.UINT32],mimetype:[4,e.TYPES.STRING],jpegThumbnail:[5,e.TYPES.BYTES],jpegThumbnailHeight:[6,e.TYPES.UINT32],jpegThumbnailWidth:[7,e.TYPES.UINT32],thumbnailPlaintextHash:[8,e.TYPES.STRING],gifPlayback:[9,e.TYPES.BOOL]},p.name="ImageMsgContentProto",p.internalSpec={width:[1,e.TYPES.UINT32],height:[2,e.TYPES.UINT32],jpegThumbnail:[3,e.TYPES.BYTES],jpegThumbnailHeight:[4,e.TYPES.UINT32],jpegThumbnailWidth:[5,e.TYPES.UINT32],thumbnailPlaintextHash:[6,e.TYPES.STRING],hdType:[7,e.TYPES.ENUM,s]},_.name="AudioMsgContentProto",_.internalSpec={duration:[1,e.TYPES.UINT32],mimetype:[2,e.TYPES.STRING],played:[3,e.TYPES.BOOL],waveform:[4,e.TYPES.BYTES]},f.name="DocumentFileMsgContentProto",f.internalSpec={filename:[1,e.TYPES.STRING],mimetype:[2,e.TYPES.STRING]},g.name="ValidatedResult",g.internalSpec={validatedMimeType:[1,e.TYPES.STRING],videoStreamType:[2,e.TYPES.STRING],videoCalculatedFps:[3,e.TYPES.UINT32],videoNominalFps:[4,e.TYPES.UINT32],videoWidth:[5,e.TYPES.UINT32],videoHeight:[6,e.TYPES.UINT32],videoDuration:[7,e.TYPES.UINT32],videoAvgBitsPerSecond:[8,e.TYPES.UINT32],audioStreamType:[9,e.TYPES.STRING],audioSamplingRate:[10,e.TYPES.UINT32],audioNumberOfChannels:[11,e.TYPES.UINT32],audioAvgBitsPerSecond:[12,e.TYPES.UINT32]},h.name="MediaTableSchemaProto",h.internalSpec={mediaType:[1,e.TYPES.STRING],plaintextHash:[2,e.TYPES.STRING],size:[3,e.TYPES.UINT64],mediaEntries:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,d],ts:[5,e.TYPES.INT64],validatedVideoInfo:[6,e.TYPES.MESSAGE,m],validatedImageInfo:[7,e.TYPES.MESSAGE,p],validatedAudioInfo:[8,e.TYPES.MESSAGE,_],hashedPlaintextHash:[9,e.TYPES.STRING],mediaId:[10,e.TYPES.INT32],msgIds:[11,e.FLAGS.REPEATED|e.TYPES.STRING],objectId:[12,e.TYPES.STRING],fbid:[13,e.TYPES.STRING],validatedDocumentFileInfo:[14,e.TYPES.MESSAGE,f],validatedResult:[15,e.TYPES.MESSAGE,g],accessibilitySummaryText:[16,e.TYPES.STRING],isVideoGif:[17,e.TYPES.BOOL]},l.HD_TYPE=s,l.ChunkTableSchemaProtoSpec=u,l.MediaBackupSchemaProtoSpec=c,l.MediaEntriesProtoSpec=d,l.VideoMsgContentProtoSpec=m,l.ImageMsgContentProtoSpec=p,l.AudioMsgContentProtoSpec=_,l.DocumentFileMsgContentProtoSpec=f,l.ValidatedResultSpec=g,l.MediaTableSchemaProtoSpec=h}),98);
__d("MAWArmadilloMissingKeysTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="DeviceResponse",s.internalSpec={deviceId:[1,(e=o("WAProtoConst")).TYPES.INT32],deviceResponse:[2,e.TYPES.BOOL]},u.name="MissingKeysTableSchemaProto",u.internalSpec={keyHex:[1,e.TYPES.STRING],keyId:[2,e.TYPES.BYTES],timestamp:[3,e.TYPES.INT64],deviceResponses:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,s]},l.DeviceResponseSpec=s,l.MissingKeysTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloParticipantsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="ParticipantsTableSchemaProto",s.internalSpec={id:[1,(e=o("WAProtoConst")).TYPES.STRING],userJid:[2,e.TYPES.STRING],deliveredWatermarkTs:[3,e.TYPES.INT64],lastReadWatermarkTs:[4,e.TYPES.INT64],type:[5,e.TYPES.STRING],addressable:[6,e.TYPES.BOOL],lastReadActionTs:[7,e.TYPES.INT64],threadId:[9,e.TYPES.INT32],threadJid:[10,e.TYPES.STRING]},l.ParticipantsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloPendingMutationsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={SET:0,REMOVE:1},u={};u.name="PendingMutationsTableSchemaProto",u.internalSpec={id:[1,(e=o("WAProtoConst")).TYPES.INT32],collection:[2,e.TYPES.STRING],index:[3,e.TYPES.STRING],binarySyncAction:[4,e.TYPES.BYTES],version:[5,e.TYPES.INT32],operation:[6,e.TYPES.ENUM,s],timestamp:[7,e.TYPES.INT64],action:[8,e.TYPES.STRING]},l.SYNCD_MUTATION_SYNCD_OPERATION=s,l.PendingMutationsTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="PersonalSenderKeyStatusTableSchemaProto",s.internalSpec={groupJid:[1,(e=o("WAProtoConst")).TYPES.STRING],senderKeyId:[2,e.TYPES.INT32],rotateSenderKey:[4,e.TYPES.BOOL],senderKeyTs:[5,e.TYPES.INT64],hasSenderKey:[6,e.FLAGS.REPEATED|e.TYPES.STRING]},l.PersonalSenderKeyStatusTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloPollTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={OPEN:0,FROZEN:1},u={},c={},d={},m={};u.name="PollOptionProto",u.internalSpec={optionText:[1,(e=o("WAProtoConst")).TYPES.STRING],voteAuthors:[2,e.FLAGS.REPEATED|e.TYPES.STRING]},c.name="PollOptionsProto",c.internalSpec={pollOptionHash:[1,e.TYPES.STRING],pollOption:[2,e.TYPES.MESSAGE,u]},d.name="LatestSenderTimestampsMsProto",d.internalSpec={author:[1,e.TYPES.STRING],latestSenderTimestampMs:[2,e.TYPES.INT64]},m.name="PollTableSchemaProto",m.internalSpec={chatJid:[1,e.TYPES.STRING],encKey:[2,e.TYPES.BYTES],pollAuthor:[3,e.TYPES.STRING],pollStanzaId:[4,e.TYPES.STRING],pollOptions:[5,e.FLAGS.REPEATED|e.TYPES.MESSAGE,c],pollParticipantCount:[6,e.TYPES.UINT32],pollState:[7,e.TYPES.ENUM,s],selectableOptionsCount:[8,e.TYPES.UINT32],title:[9,e.TYPES.STRING],latestSenderTimestampsMs:[10,e.FLAGS.REPEATED|e.TYPES.MESSAGE,d]},l.POLL_STATE=s,l.PollOptionProtoSpec=u,l.PollOptionsProtoSpec=c,l.LatestSenderTimestampsMsProtoSpec=d,l.PollTableSchemaProtoSpec=m}),98);
__d("MAWArmadilloReactionsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="ReactionsTableSchemaProto",s.internalSpec={ack:[1,(e=o("WAProtoConst")).TYPES.INT32],author:[2,e.TYPES.STRING],externalId:[3,e.TYPES.STRING],reactionId:[4,e.TYPES.STRING],reactToExternalId:[5,e.TYPES.STRING],reactToAuthor:[6,e.TYPES.STRING],reactToMsgId:[7,e.TYPES.STRING],threadJid:[8,e.TYPES.STRING],reaction:[9,e.TYPES.STRING],groupingKey:[10,e.TYPES.STRING],ts:[11,e.TYPES.INT64],rowId:[12,e.TYPES.INT32],senderTimestampMs:[13,e.TYPES.INT64]},l.ReactionsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloReceiptTablesSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={};s.name="DbUserStatusTsProto",s.internalSpec={deliveredTs:[1,(e=o("WAProtoConst")).TYPES.INT64],readTs:[2,e.TYPES.INT64]},u.name="StatusTsPerUserProto",u.internalSpec={userJid:[1,e.TYPES.STRING],dbUserStatusTs:[2,e.TYPES.MESSAGE,s]},c.name="IdentitiesPerDeviceProto",c.internalSpec={deviceJid:[1,e.TYPES.STRING],serializedPubKey:[2,e.TYPES.BYTES],baseKey:[3,e.TYPES.BYTES]},d.name="RetryCountPerDeviceProto",d.internalSpec={deviceJid:[1,e.TYPES.STRING],count:[2,e.TYPES.INT32]},m.name="ReceiptsTableSchemaProto",m.internalSpec={msgId:[1,e.TYPES.STRING],statusTsPerUser:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,u],permittedIdentitiesPerDevice:[3,e.FLAGS.REPEATED|e.TYPES.MESSAGE,c],recipientDevices:[4,e.FLAGS.REPEATED|e.TYPES.STRING],retryCountsPerDevice:[5,e.FLAGS.REPEATED|e.TYPES.MESSAGE,d],waMsgId:[6,e.TYPES.STRING]},p.name="Receipts",p.internalSpec={device:[1,e.TYPES.STRING],ts:[2,e.TYPES.INT64]},_.name="PendingReceiptsTableSchemaProto",_.internalSpec={pendingReceiptId:[1,e.TYPES.STRING],thread:[2,e.TYPES.STRING],externalId:[3,e.TYPES.STRING],author:[4,e.TYPES.STRING],deliveryReceipts:[5,e.FLAGS.REPEATED|e.TYPES.MESSAGE,p],readReceipts:[6,e.FLAGS.REPEATED|e.TYPES.MESSAGE,p]},l.DbUserStatusTsProtoSpec=s,l.StatusTsPerUserProtoSpec=u,l.IdentitiesPerDeviceProtoSpec=c,l.RetryCountPerDeviceProtoSpec=d,l.ReceiptsTableSchemaProtoSpec=m,l.ReceiptsSpec=p,l.PendingReceiptsTableSchemaProtoSpec=_}),98);
__d("MAWArmadilloReceiverFetchInfoTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="ReceiverFetchInfoTableSchemaProto",s.internalSpec={mimetype:[1,(e=o("WAProtoConst")).TYPES.STRING],previewHeight:[2,e.TYPES.UINT32],previewWidth:[3,e.TYPES.UINT32],receiverFetchId:[4,e.TYPES.STRING],type:[5,e.TYPES.STRING],previewUrl:[6,e.TYPES.STRING],previewUrlExpirationTimestampMs:[7,e.TYPES.UINT64],accessibilitySummaryText:[8,e.TYPES.STRING]},l.ReceiverFetchInfoTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloSyncActionsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="SyncActionsTableSchemaProto",s.internalSpec={index:[1,(e=o("WAProtoConst")).TYPES.STRING],binarySyncData:[2,e.TYPES.BYTES],actionState:[3,e.TYPES.STRING],version:[4,e.TYPES.INT32],keyId:[5,e.TYPES.BYTES],modelId:[6,e.TYPES.STRING],modelType:[7,e.TYPES.STRING],indexMac:[8,e.TYPES.BYTES],valueMac:[9,e.TYPES.BYTES],collection:[10,e.TYPES.STRING],timestamp:[11,e.TYPES.INT64],action:[12,e.TYPES.STRING]},l.SyncActionsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloSyncKeysTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="SyncKeyFingerprint",s.internalSpec={currentIndex:[1,(e=o("WAProtoConst")).TYPES.INT32],deviceIndexes:[2,e.FLAGS.REPEATED|e.TYPES.INT32],rawId:[3,e.TYPES.INT64]},u.name="SyncKeysTableSchemaProto",u.internalSpec={id:[1,e.TYPES.BYTES],keyId:[2,e.TYPES.BYTES],keyData:[3,e.TYPES.BYTES],keyEpoch:[4,e.TYPES.INT64],timestamp:[5,e.TYPES.INT64],fingerprint:[6,e.TYPES.MESSAGE,s]},l.SyncKeyFingerprintSpec=s,l.SyncKeysTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloTasksTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e={};e.name="TasksTableSchemaProto",e.internalSpec={taskName:[1,o("WAProtoConst").TYPES.STRING],scheduledTime:[2,o("WAProtoConst").TYPES.INT64]},l.TasksTableSchemaProtoSpec=e}),98);
__d("MAWArmadilloThreadsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="ThreadsTableSchemaProto",s.internalSpec={jid:[1,(e=o("WAProtoConst")).TYPES.STRING],threadOrder:[2,e.TYPES.STRING],folder:[4,e.TYPES.INT32],newestMsg:[5,e.TYPES.STRING],oldestMsg:[6,e.TYPES.STRING],lastReadMsg:[7,e.TYPES.STRING],lastReadMsgReceiptSent:[8,e.TYPES.STRING],lastReadMsgTs:[9,e.TYPES.INT64],newestMsgTs:[10,e.TYPES.INT64],muteExpireTimeMs:[11,e.TYPES.INT64],muteCallsExpireTimeMs:[12,e.TYPES.INT64],archived:[13,e.TYPES.BOOL],cannotReplyReason:[14,e.TYPES.STRING],chatId:[15,e.TYPES.INT32],optimisticThreadKey:[16,e.TYPES.STRING],isMigratedLocally:[17,e.TYPES.BOOL],snippetMsg:[18,e.TYPES.STRING],deduplicationKey:[19,e.TYPES.STRING],authoritativeThreadKey:[20,e.TYPES.STRING],snippetMsgTs:[21,e.TYPES.INT64],didInsertDualThreadCutoverAdminMsg:[22,e.TYPES.BOOL],unbumpFromTs:[23,e.TYPES.INT64],unbumpToTs:[24,e.TYPES.INT64]},l.ThreadsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloUnrenderedMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="UnrenderedMessagesTableSchemaProto",s.internalSpec={type:[1,(e=o("WAProtoConst")).TYPES.STRING],ts:[2,e.TYPES.INT64],externalId:[3,e.TYPES.STRING],msgId:[4,e.TYPES.STRING],author:[5,e.TYPES.STRING],ack:[6,e.TYPES.INT32],resendCount:[7,e.TYPES.INT32],ephemeralSetting:[8,e.TYPES.MESSAGE,o("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],messageDeleteForMeTs:[9,e.TYPES.INT64],rowId:[10,e.TYPES.INT32],thread:[11,e.TYPES.INT32],mediaId:[12,e.TYPES.INT32],msgContent:[13,e.TYPES.STRING],threadJid:[14,e.TYPES.STRING],reportingMeta:[15,e.TYPES.MESSAGE,o("MAWArmadilloMessagesTableSchema.pb").ReportingMetaProtoSpec],invitedParticipantUserJid:[16,e.TYPES.STRING],groupName:[17,e.TYPES.STRING],quote:[18,e.TYPES.MESSAGE,o("MAWArmadilloMessagesTableSchema.pb").DbQuotedMsgProtoSpec],xmaMessageType:[19,e.TYPES.INT32],sortOrderMs:[20,e.TYPES.INT64]},l.UnrenderedMessagesTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloXMATableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="XMATableSchemaProto",s.internalSpec={associatedMessageId:[1,(e=o("WAProtoConst")).TYPES.STRING],author:[2,e.TYPES.STRING],ctas:[3,e.FLAGS.REPEATED|e.TYPES.MESSAGE,u],defaultCTA:[4,e.TYPES.MESSAGE,u],defaultPreviewMediaId:[5,e.TYPES.INT32],externalId:[6,e.TYPES.STRING],faviconMediaId:[7,e.TYPES.INT32],headerMediaId:[8,e.TYPES.INT32],headerTitle:[9,e.TYPES.STRING],isTombstoned:[10,e.TYPES.BOOL],maxSubtitleNumOfLines:[11,e.TYPES.INT32],maxTitleNumOfLines:[12,e.TYPES.INT32],msgId:[13,e.TYPES.STRING],overlayDescription:[14,e.TYPES.STRING],overlayIconGlyph:[15,e.TYPES.INT32],overlayTitle:[16,e.TYPES.STRING],previewMediaIds:[17,e.FLAGS.REPEATED|e.TYPES.INT32],subtitleText:[18,e.TYPES.STRING],targetExpiringAtSec:[19,e.TYPES.INT64],targetId:[20,e.TYPES.STRING],targetType:[21,e.TYPES.INT32],targetUsername:[22,e.TYPES.STRING],threadJid:[23,e.TYPES.STRING],titleText:[24,e.TYPES.STRING],xmaId:[25,e.TYPES.INT32],xmaLayoutType:[26,e.TYPES.INT32],defaultPreviewMediaPlaintextHash:[27,e.TYPES.STRING],faviconPlaintextHash:[28,e.TYPES.STRING],headerMediaPlaintextHash:[29,e.TYPES.STRING]},u.name="CTAProto",u.internalSpec={buttonType:[1,e.TYPES.INT32],title:[2,e.TYPES.STRING],actionUrl:[3,e.TYPES.STRING],nativeUrl:[4,e.TYPES.STRING],ctaType:[5,e.TYPES.STRING]},l.XMATableSchemaProtoSpec=s,l.CTAProtoSpec=u}),98);
__d("MAWXMACTAUtil",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=e.actionUrl,n=e.buttonType,r=e.ctaType,o=e.nativeUrl,a=e.title;return{actionUrl:t,buttonType:n,ctaType:r,nativeUrl:o,title:a}}function l(e){var t=e.actionUrl,n=e.buttonType,r=e.ctaType,o=e.nativeUrl,a=e.title;return{actionUrl:t,buttonType:n,ctaType:r,nativeUrl:o,title:a}}i.toMAWCTAEncode=e,i.fromMAWCTAEncode=l}),66);
__d("WAServerSync.pb",["$InternalEnum","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s=n("$InternalEnum")({SET:0,REMOVE:1}),u={},c={},d={},m={},p={},_={},f={},g={},h={},y={},C={};u.name="SyncdVersion",u.internalSpec={version:[1,(e=o("WAProtoConst")).TYPES.UINT64]},c.name="ExitCode",c.internalSpec={code:[1,e.TYPES.UINT64],text:[2,e.TYPES.STRING]},d.name="SyncdIndex",d.internalSpec={blob:[1,e.TYPES.BYTES]},m.name="SyncdValue",m.internalSpec={blob:[1,e.TYPES.BYTES]},p.name="KeyId",p.internalSpec={id:[1,e.TYPES.BYTES]},_.name="SyncdRecord",_.internalSpec={index:[1,e.TYPES.MESSAGE,d],value:[2,e.TYPES.MESSAGE,m],keyId:[3,e.TYPES.MESSAGE,p]},f.name="ExternalBlobReference",f.internalSpec={mediaKey:[1,e.TYPES.BYTES],directPath:[2,e.TYPES.STRING],handle:[3,e.TYPES.STRING],fileSizeBytes:[4,e.TYPES.UINT64],fileSha256:[5,e.TYPES.BYTES],fileEncSha256:[6,e.TYPES.BYTES]},g.name="SyncdSnapshot",g.internalSpec={version:[1,e.TYPES.MESSAGE,u],records:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,_],mac:[3,e.TYPES.BYTES],keyId:[4,e.TYPES.MESSAGE,p]},h.name="SyncdMutations",h.internalSpec={mutations:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,y]},y.name="SyncdMutation",y.internalSpec={operation:[1,e.TYPES.ENUM,s],record:[2,e.TYPES.MESSAGE,_]},C.name="SyncdPatch",C.internalSpec={version:[1,e.TYPES.MESSAGE,u],mutations:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,y],externalMutations:[3,e.TYPES.MESSAGE,f],snapshotMac:[4,e.TYPES.BYTES],patchMac:[5,e.TYPES.BYTES],keyId:[6,e.TYPES.MESSAGE,p],exitCode:[7,e.TYPES.MESSAGE,c],deviceIndex:[8,e.TYPES.UINT32],clientDebugData:[9,e.TYPES.BYTES]},l.SyncdMutation$SyncdOperation=s,l.SyncdVersionSpec=u,l.ExitCodeSpec=c,l.SyncdIndexSpec=d,l.SyncdValueSpec=m,l.KeyIdSpec=p,l.SyncdRecordSpec=_,l.ExternalBlobReferenceSpec=f,l.SyncdSnapshotSpec=g,l.SyncdMutationsSpec=h,l.SyncdMutationSpec=y,l.SyncdPatchSpec=C}),98);
__d("MAWDbObjDecode",["FBLogger","MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloCollectionVersionsTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloMissingKeysTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPendingMutationsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloPollTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloReceiverFetchInfoTableSchema.pb","MAWArmadilloSyncActionsTableSchema.pb","MAWArmadilloSyncKeysTableSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWODSProxy","MAWXMACTAUtil","WAOdsEnums","WAServerSync.pb","decodeProtobuf"],(function(t,n,r,o,a,i,l){var e={appData:function(t){return I(t)},appMeta:function(t){return T(t)},chunk:function(t){return D(t)},collectionVersions:function(t){return O(t)},deletedMessages:function(t){return _(t)},deviceChangeAlerts:function(t){return u(t)},dualSendMedia:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},dyiBatch:function(t){return N(t)},ebMessageRestoreTasks:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ebMsgRanges:function(t){return M(t)},ebRestoreQueue:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ebUploadQueue:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},editMsgHistory:function(t){return q(t)},encryptionMetaV3:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ephemeralSettings:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},existingUsers:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsBackloggedMessages:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsEncryptionMeta:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsIndexV3:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsPurgeBacklog:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsPurgeThreadBacklog:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},groupInfo:function(t){return h(t)},groupInvites:function(t){return L(t)},historySyncQRCodeData:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},historySyncQRCodeSecretKey:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},igMessageAuxiliaryInfo:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},isDualSend:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},media:function(t){return $(t)},mediaBackup:function(t){return x(t)},mediaKeys:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},messages:function(t){return p(t)},missingKeys:function(t){return A(t)},participants:function(t){return R(t)},pendingMessageStanzaQueue:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},pendingMutations:function(t){return F(t)},pendingReceipts:function(t){return v(t)},pendingStanzas:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},personalSenderKeyStatuses:function(t){return k(t)},poll:function(t){return V(t)},reactions:function(t){return P(t)},receipts:function(t){return b(t)},receiverFetchInfo:function(t){return U(t)},sentBytesCache:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},staleQueue:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},syncActions:function(t){return w(t)},syncKeys:function(t){return B(t)},tasks:function(t){return E(t)},threads:function(t){return S(t)},unrenderedMessages:function(t){return f(t)},xma:function(t){return W(t)}};function s(t,n){var o=null;if(Object.prototype.hasOwnProperty.call(e,n))o=e[n](t);else throw r("FBLogger")("messenger_web").mustfixThrow("not a valid table name");return o}function u(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,e);return{action:t.action,deviceJid:t.deviceJid,identity:t.identity,isArchived:t.isArchived,latitude:t.latitude,location:t.location,loggedOut:t.loggedOut,longitude:t.longitude,model:t.model,platform:t.platform,ts:t.ts}}function c(e){var t=e.quote,n;if(t!=null){if(t.content==null)throw r("FBLogger")("messenger_web").mustfixThrow("QuotedMsgContent missing upon decoding");var o=t.content,a=o.author,i=o.expirationTs,l=o.externalId,s=o.mediaId,u=o.msgContent,c=o.msgId,d=o.plaintextHash,m=o.sourceId,p=o.specialTextSize,_=o.ts,f=o.type,g=o.xmaMessageType;n={content:babelHelpers.extends({},t.content,{author:a,expirationTs:i,externalId:l,mediaId:s,msgContent:u,msgId:c,plaintextHash:d,sourceId:m,specialTextSize:p,ts:_,type:f,xmaMessageType:g}),remoteJid:t.remoteJid}}return n}function d(e){return e==null?e:new Uint8Array(e)}function m(e){return e==null||e.length===0?new Set:new Set(e)}function p(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,e),n=t.msgContent;if(t.type===o("MAWMsgType").MSG_TYPE.FUTUREPROOF){if(n==null)throw r("FBLogger")("messenger_web").mustfixThrow("MsgContent missing upon decoding futureproof message");n.subtype=n.subtype}var a=c(t),i=g(t.reportingMeta);return babelHelpers.extends({},t,{msgContent:n,quote:a,reportingMeta:i})}function _(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,e);return babelHelpers.extends({},t)}function f(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,e),n=c(t),r=g(t.reportingMeta);return babelHelpers.extends({},t,{quote:n,reportingMeta:r})}function g(e){if(e!=null)return{frankingKey:e.frankingKey!=null?new Uint8Array(e.frankingKey):e.frankingKey,frankingTag:e.frankingTag!=null?new Uint8Array(e.frankingTag):e.frankingTag,frankingVersion:e.frankingVersion,reportingContent:e.reportingContent,reportingTag:e.reportingTag!=null?new Uint8Array(e.reportingTag):e.reportingTag}}function h(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,e);return{creationTs:t.creationTs,creator:t.creator,inviter:t.inviter,memberAddMode:t.memberAddMode,msgExpiration:t.msgExpiration,name:t.name,nameOwner:t.nameOwner,nameTs:t.nameTs,participantVersion:t.participantVersion}}function y(e){return e.length===0?null:new Map(e.map(function(e){var t=e.deviceJid;if(t==null||e.serializedPubKey==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected deviceJid or serializedPubKey are missing ");var n=new Uint8Array(e.serializedPubKey),o=d(e.baseKey),a={baseKey:o,pubKey:n};return[t,a]}))}function C(e){return e==null?null:new Map(e.map(function(e){var t;if(e.deviceJid==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected deviceJID is missing ");return[e.deviceJid,(t=e.count)!=null?t:0]}))}function b(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,e),n=t.recipientDevices,r=m(n);return{permittedIdentitiesPerDevice:y(t.permittedIdentitiesPerDevice),recipientDevices:r,retryCountsPerDevice:C(t.retryCountsPerDevice)}}function v(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,e)}function S(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,e);return{archived:t.archived,cannotReplyReason:t.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:t.didInsertDualThreadCutoverAdminMsg,folder:t.folder,isMigratedLocally:t.isMigratedLocally,lastReadMsg:t.lastReadMsg,lastReadMsgReceiptSent:t.lastReadMsgReceiptSent,muteCallsExpireTimeMs:t.muteCallsExpireTimeMs,muteExpireTimeMs:t.muteExpireTimeMs,newestMsg:t.newestMsg,newestMsgTs:t.newestMsgTs,oldestMsg:t.oldestMsg,optimisticThreadKey:t.optimisticThreadKey,snippetMsg:t.snippetMsg,snippetMsgTs:t.snippetMsgTs}}function R(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,e)}function L(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,e)}function E(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,e)}function k(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,e),n=t.hasSenderKey,r=m(n);return{hasSenderKey:r,rotateSenderKey:t.rotateSenderKey,senderKeyId:t.senderKeyId,senderKeyTs:t.senderKeyTs}}function I(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,e);return{ack:t.ack,contents:t.contents,permittedIdentitiesPerDevice:y(t.permittedIdentitiesPerDevice),recipientDevices:new Set(t.recipientDevices),sendPartial:t.sendPartial,ts:t.ts}}function T(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,e)}function D(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,e)}function x(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,e)}function $(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,e),n,a=t.mediaEntries;return a==null?n=new Map:n=new Map(a.map(function(e){if(e.msgId==null||e.mediaEntryData==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected msgId or mediaEntryData are missing ");return[e.msgId,new Uint8Array(e.mediaEntryData)]})),{accessibilitySummaryText:t.accessibilitySummaryText,isVideoGif:t.isVideoGif,mediaEntries:n,mediaType:t.mediaType,plaintextHash:t.plaintextHash,size:t.size,ts:t.ts,validatedAudioInfo:t.validatedAudioInfo,validatedDocumentFileInfo:t.validatedDocumentFileInfo,validatedImageInfo:t.validatedImageInfo,validatedResult:t.validatedResult,validatedVideoInfo:t.validatedVideoInfo}}function P(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,e);return t.ts!=null&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_MIGRATE_REACTION_TS_AS_INDEX,key:"reaction_ts_encrypted"}),babelHelpers.extends({ack:t.ack,author:t.author,groupingKey:t.groupingKey,reaction:t.reaction,reactToAuthor:t.reactToAuthor,senderTimestampMs:t.senderTimestampMs},t.ts!=null?{ts:t.ts}:{})}function N(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,e);return{isThread:t.isThread,numMessages:t.numMessages,numMessagesRestored:t.numMessagesRestored,numThreadsRestored:t.numThreadsRestored,oldestTs:t.oldestTs,qplFlowDescriptor:t.qplFlowDescriptor,qplInstanceKeyE2E:t.qplInstanceKeyE2E,qplInstanceKeyForThread:t.qplInstanceKeyForThread,threadId:t.threadId}}function M(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,e);return{creationTime:t.creationTime,maxMsgExternalId:t.maxMsgExternalId,maxMsgSortOrderMs:t.maxMsgSortOrderMs,minMsgExternalId:t.minMsgExternalId,minMsgSortOrderMs:t.minMsgSortOrderMs}}function w(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloSyncActionsTableSchema.pb").SyncActionsTableSchemaProtoSpec,e);return{binarySyncData:t.binarySyncData,keyId:t.keyId,timestamp:t.timestamp,valueMac:t.valueMac,version:t.version}}function A(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMissingKeysTableSchema.pb").MissingKeysTableSchemaProtoSpec,e),n;return t.deviceResponses==null?n=new Map:n=new Map(t.deviceResponses.map(function(e){if(e.deviceId==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected deviceId is missing");return[e.deviceId,e.deviceResponse]})),{deviceResponses:n,keyId:t.keyId,timestamp:t.timestamp}}function F(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloPendingMutationsTableSchema.pb").PendingMutationsTableSchemaProtoSpec,e),n;switch(t.operation){case o("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.SET:n=o("WAServerSync.pb").SyncdMutation$SyncdOperation.SET;break;case o("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.REMOVE:n=o("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE;break;default:throw r("FBLogger")("messenger_web").mustfixThrow("operation missing when decoding PendingMutation")}return{binarySyncAction:t.binarySyncAction,operation:n,timestamp:t.timestamp,version:t.version}}function O(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloCollectionVersionsTableSchema.pb").CollectionVersionsTableSchemaProtoSpec,e);return{finiteFailureStartTime:t.finiteFailureStartTime,isCollectionInMacMismatchFatal:t.isCollectionInMacMismatchFatal,isCollectionLthashInconsistent:t.isCollectionLthashInconsistent,ltHash:t.ltHash,state:t.state,version:t.version}}function B(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloSyncKeysTableSchema.pb").SyncKeysTableSchemaProtoSpec,e);return{fingerprint:t.fingerprint,keyData:t.keyData,timestamp:t.timestamp}}function W(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,e);return{author:t.author,ctas:t.ctas.map(function(e){return o("MAWXMACTAUtil").fromMAWCTAEncode(e)}),defaultCTA:t.defaultCTA==null?t.defaultCTA:o("MAWXMACTAUtil").fromMAWCTAEncode(t.defaultCTA),defaultPreviewMediaPlaintextHash:t.defaultPreviewMediaPlaintextHash,faviconPlaintextHash:t.faviconPlaintextHash,headerMediaPlaintextHash:t.headerMediaPlaintextHash,headerTitle:t.headerTitle,isTombstoned:t.isTombstoned,maxSubtitleNumOfLines:t.maxSubtitleNumOfLines,maxTitleNumOfLines:t.maxTitleNumOfLines,msgId:t.msgId,overlayDescription:t.overlayDescription,overlayIconGlyph:t.overlayIconGlyph,overlayTitle:t.overlayTitle,previewMediaIds:t.previewMediaIds,subtitleText:t.subtitleText,targetId:t.targetId,targetType:t.targetType,targetUsername:t.targetUsername,threadJid:t.threadJid,titleText:t.titleText,xmaLayoutType:t.xmaLayoutType}}function q(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,e);return{author:t.author,editExternalId:t.editExternalId,editTs:t.editTs,msgContent:t.msgContent,sendStatus:t.sendStatus,specialTextSize:t.specialTextSize}}function U(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloReceiverFetchInfoTableSchema.pb").ReceiverFetchInfoTableSchemaProtoSpec,e);return{accessibilitySummaryText:t.accessibilitySummaryText,mimetype:t.mimetype,previewHeight:t.previewHeight,previewUrl:t.previewUrl,previewUrlExpirationTimestampMs:t.previewUrlExpirationTimestampMs,previewWidth:t.previewWidth,type:t.type}}function V(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloPollTableSchema.pb").PollTableSchemaProtoSpec,e),n=new Map(t.pollOptions.map(function(e){var t=e.pollOptionHash;if(t==null||e.pollOption==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected pollOptionHash or pollOption is missing");return[t,{optionText:e.pollOption.optionText,voteAuthors:new Set(e.pollOption.voteAuthors)}]}).filter(Boolean)),a=new Map(t.latestSenderTimestampsMs.map(function(e){if(e.author==null||e.latestSenderTimestampMs==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected author or latestSenderTimestampMs are missing");return[e.author,e.latestSenderTimestampMs]}));return{encKey:t.encKey,latestSenderTimestampsMs:a,pollAuthor:t.pollAuthor,pollOptions:n,pollParticipantCount:t.pollParticipantCount,pollState:t.pollState,selectableOptionsCount:t.selectableOptionsCount,title:t.title}}l.decodeDbObj=s}),98);
__d("WASyncdKeyTypes",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}function l(e){return e}function s(e){return e}function u(e){return e}i.toSyncKeyId=e,i.fromSyncKeyId=l,i.toSyncKeyData=s,i.fromSyncKeyData=u}),66);
__d("MAWDbObjEncode",["FBLogger","MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloPollTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloReceiverFetchInfoTableSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWXMACTAUtil","WASyncdKeyTypes","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e=["ack","altIndex","collapsibleId","externalId","messageDeleteTs","messageExpirationTs","msgId","pollStanzaId","protocolMsgId","quoteExpirationTs","quoteExternalId","revokedExternalId","rowId","serverTs","sortOrderMs","threadJid","unsendMsgContentDeleteTs"],s=["author","chat","externalId","rowId"],u={appData:k,appMeta:I,chunk:T,deletedMessages:_,deviceChangeAlerts:c,dualSendMedia:d,dyiBatch:P,ebMessageRestoreTasks:d,ebMsgRanges:N,ebRestoreQueue:d,ebUploadQueue:d,editMsgHistory:w,encryptionMetaV3:d,ephemeralSettings:d,existingUsers:d,ftsBackloggedMessages:d,ftsEncryptionMeta:d,ftsIndexV3:d,ftsPurgeBacklog:d,ftsPurgeThreadBacklog:d,groupInfo:g,groupInvites:R,historySyncQRCodeData:d,historySyncQRCodeSecretKey:d,igMessageAuxiliaryInfo:d,isDualSend:d,media:x,mediaBackup:D,mediaKeys:d,messages:p,participants:S,pendingMessageStanzaQueue:d,pendingReceipts:b,pendingStanzas:d,personalSenderKeyStatuses:E,poll:F,reactions:$,receipts:C,receiverFetchInfo:A,sentBytesCache:d,staleQueue:d,tasks:L,threads:v,unrenderedMessages:f,xma:M};function c(e){var t={action:e.action,deviceJid:e.deviceJid,identity:e.identity,isArchived:e.isArchived,latitude:e.latitude,location:e.location,loggedOut:e.loggedOut,longitude:e.longitude,model:e.model,platform:e.platform,ts:e.ts};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,t).readByteArrayView()}}function d(e){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for encryption")}function m(e,t){var n=null;if(Object.prototype.hasOwnProperty.call(u,t))n=u[t](e);else throw r("FBLogger")("messenger_web").mustfixThrow("not a valid table name");return n}function p(t){var n=t.ack,r=t.altIndex,a=t.collapsibleId,i=t.externalId,l=t.messageDeleteTs,s=t.messageExpirationTs,u=t.msgId,c=t.pollStanzaId,d=t.protocolMsgId,m=t.quoteExpirationTs,p=t.quoteExternalId,_=t.revokedExternalId,f=t.rowId,g=t.serverTs,h=t.sortOrderMs,y=t.threadJid,C=t.unsendMsgContentDeleteTs,b=babelHelpers.objectWithoutPropertiesLoose(t,e),v=b,S;if(v.quote==null)S=v.quote;else{var R,L={author:v.quote.content.author,expirationTs:v.quote.content.expirationTs,externalId:(R=v.quote)==null?void 0:R.content.externalId,mediaId:v.quote.content.mediaId,msgContent:v.quote.content.msgContent,msgId:v.quote.content.msgId,plaintextHash:v.quote.content.plaintextHash,sourceId:v.quote.content.sourceId,specialTextSize:v.quote.content.specialTextSize,ts:v.quote.content.ts,type:v.quote.content.type,xmaMessageType:v.quote.content.xmaMessageType},E={content:L,remoteJid:v.quote.remoteJid};S=E}var k=v.msgContent;v.type===o("MAWMsgType").MSG_TYPE.FUTUREPROOF&&(k={protobuf:v.msgContent.protobuf,subtype:v.msgContent.subtype});var I=v.ravenEphemeralType,T=v.ravenEphemeralMediaState,D=I!=null?I:null,x=T!=null?T:null,$={applicationErrorCode:v.applicationErrorCode,author:v.author,editCount:v.editCount,ephemeralCounterStarted:v.ephemeralCounterStarted,ephemeralMsgDisappeared:v.ephemeralMsgDisappeared,ephemeralSetting:v.ephemeralSetting,forwardingScore:v.forwardingScore,groupId:v.groupId,groupIndex:v.groupIndex,groupSize:v.groupSize,hdType:v.hdType,isCollapsed:v.isCollapsed,isExpiredXmaMsg:v.isExpiredXmaMsg,isForwarded:v.isForwarded,mediaId:v.mediaId,msgContent:k,originalTs:v.originalTs,quote:S,ravenEphemeralMediaState:x,ravenEphemeralType:D,receiverFetchId:v.receiverFetchId,reportingMeta:v.reportingMeta,resendCount:v.resendCount,source:v.source,specialTextSize:v.specialTextSize,ts:v.ts,type:v.type,xmaMessageType:v.xmaMessageType};return{encodedFields:$,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,$).readByteArrayView()}}function _(e){var t=e.author,n=e.chat,r=e.externalId,a=e.rowId,i=babelHelpers.objectWithoutPropertiesLoose(e,s),l={reason:String(i.reason)};return{encodedFields:l,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,l).readByteArrayView()}}function f(e){var t;if(e.quote==null)t=e.quote;else{var n,r={author:e.quote.content.author,expirationTs:e.quote.content.expirationTs,externalId:(n=e.quote)==null?void 0:n.content.externalId,mediaId:e.quote.content.mediaId,msgContent:e.quote.content.msgContent,msgId:e.quote.content.msgId,plaintextHash:e.quote.content.plaintextHash,sourceId:e.quote.content.sourceId,ts:e.quote.content.ts,type:e.quote.content.type,xmaMessageType:e.quote.content.xmaMessageType},a={content:r,remoteJid:e.quote.remoteJid};t=a}var i={ack:e.ack,author:e.author,ephemeralSetting:e.ephemeralSetting,groupName:e.groupName,invitedParticipantUserJid:e.invitedParticipantUserJid,mediaId:e.mediaId,msgContent:e.msgContent,quote:t,reportingMeta:e.reportingMeta,resendCount:e.resendCount,ts:e.ts,type:e.type,xmaMessageType:e.xmaMessageType};return{encodedFields:i,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,i).readByteArrayView()}}function g(e){var t={creationTs:e.creationTs,creator:e.creator,inviter:e.inviter,memberAddMode:e.memberAddMode,msgExpiration:e.msgExpiration,name:e.name,nameOwner:e.nameOwner,nameTs:e.nameTs,participantVersion:e.participantVersion};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,t).readByteArrayView()}}function h(e){return e==null?e:Array.from(e,function(e){var t=e[0],n=e[1];return{baseKey:n.baseKey,deviceJid:t,serializedPubKey:n.pubKey}})}function y(e){return e==null?null:Array.from(e,function(e){var t=e[0],n=e[1];return{count:n,deviceJid:t}})}function C(e){var t=Array.from(e.recipientDevices),n={permittedIdentitiesPerDevice:h(e.permittedIdentitiesPerDevice),recipientDevices:t,retryCountsPerDevice:y(e.retryCountsPerDevice)};return{encodedFields:n,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,n).readByteArrayView()}}function b(e){var t={author:e.author,deliveryReceipts:e.deliveryReceipts,externalId:e.externalId,readReceipts:e.readReceipts,thread:e.thread};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,t).readByteArrayView()}}function v(e){var t={archived:e.archived,cannotReplyReason:e.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:e.didInsertDualThreadCutoverAdminMsg,folder:e.folder,isMigratedLocally:e.isMigratedLocally,lastReadMsg:e.lastReadMsg,lastReadMsgReceiptSent:e.lastReadMsgReceiptSent,newestMsgTs:e.newestMsgTs,oldestMsg:e.oldestMsg,optimisticThreadKey:e.optimisticThreadKey,snippetMsg:e.snippetMsg,snippetMsgTs:e.snippetMsgTs};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,t).readByteArrayView()}}function S(e){var t={addressable:e.addressable,deliveredWatermarkTs:e.deliveredWatermarkTs,lastReadActionTs:e.lastReadActionTs,lastReadWatermarkTs:e.lastReadWatermarkTs,type:e.type};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,t).readByteArrayView()}}function R(e){var t={caption:e.caption,inviteCode:e.inviteCode,inviteExpirationTs:e.inviteExpirationTs};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,t).readByteArrayView()}}function L(e){var t={scheduledTime:e.scheduledTime};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,t).readByteArrayView()}}function E(e){var t=Array.from(e.hasSenderKey),n={hasSenderKey:t,rotateSenderKey:e.rotateSenderKey,senderKeyId:e.senderKeyId,senderKeyTs:e.senderKeyTs};return{encodedFields:n,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,n).readByteArrayView()}}function k(e){var t;switch(e.contents.type){case"meta_sync":{var n=[];for(var a of e.contents.actions)a.chatAction?n.push({chatAction:a.chatAction}):a.messageAction&&n.push({messageAction:a.messageAction});t={actions:n,type:"meta_sync"};break}case"backups_secrets":{t={encryptedBackupsSecrets:e.contents.encryptedBackupsSecrets,type:"backups_secrets"};break}case"sync_key_share":{var i;t={syncKeyShare:{keys:e.contents.syncKeyShare.keys,orphanKeys:(i=e.contents.syncKeyShare)==null||(i=i.orphanKeys)==null?void 0:i.map(o("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_share"};break}case"sync_key_request":{t={syncKeyRequest:{keyIds:e.contents.syncKeyRequest.keyIds.map(o("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_request"};break}default:throw e.contents.type,r("FBLogger")("messenger_web").mustfixThrow("Unknown appdata type: "+e.contents.type)}var l={ack:e.ack,contents:t,permittedIdentitiesPerDevice:h(e.permittedIdentitiesPerDevice),recipientDevices:Array.from(e.recipientDevices),sendPartial:e.sendPartial,ts:e.ts};return{encodedFields:l,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,l).readByteArrayView()}}function I(e){var t={value:e.value};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,t).readByteArrayView()}}function T(e){var t={blobData:e.blobData,mimetype:e.mimetype,plaintextHash:e.plaintextHash};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,t).readByteArrayView()}}function D(e){var t={fbid:e.fbid};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,t).readByteArrayView()}}function x(e){var t=Array.from(e.mediaEntries,function(e){var t=e[0],n=e[1];return{mediaEntryData:n,msgId:t}}),n={accessibilitySummaryText:e.accessibilitySummaryText,isVideoGif:e.isVideoGif,mediaEntries:t,mediaType:e.mediaType,plaintextHash:e.plaintextHash,size:e.size,ts:e.ts,validatedAudioInfo:e.validatedAudioInfo,validatedDocumentFileInfo:e.validatedDocumentFileInfo,validatedImageInfo:e.validatedImageInfo,validatedResult:e.validatedResult,validatedVideoInfo:e.validatedVideoInfo};return{encodedFields:n,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,n).readByteArrayView()}}function $(e){var t={ack:e.ack,author:e.author,groupingKey:e.groupingKey,reaction:e.reaction,reactToAuthor:e.reactToAuthor,senderTimestampMs:e.senderTimestampMs};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,t).readByteArrayView()}}function P(e){var t={isThread:e.isThread,numMessages:e.numMessages,numMessagesRestored:e.numMessagesRestored,numThreadsRestored:e.numThreadsRestored,oldestTs:e.oldestTs,qplFlowDescriptor:e.qplFlowDescriptor,qplInstanceKeyE2E:e.qplInstanceKeyE2E,qplInstanceKeyForThread:e.qplInstanceKeyForThread,threadId:e.threadId};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,t).readByteArrayView()}}function N(e){var t={creationTime:e.creationTime,maxMsgExternalId:e.maxMsgExternalId,maxMsgSortOrderMs:e.maxMsgSortOrderMs,minMsgExternalId:e.minMsgExternalId,minMsgSortOrderMs:e.minMsgSortOrderMs};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,t).readByteArrayView()}}function M(e){var t=e.ctas==null?[]:e.ctas.map(function(e){return o("MAWXMACTAUtil").toMAWCTAEncode(e)}),n={author:e.author,ctas:t,defaultCTA:e.defaultCTA==null?e.defaultCTA:o("MAWXMACTAUtil").toMAWCTAEncode(e.defaultCTA),defaultPreviewMediaPlaintextHash:e.defaultPreviewMediaPlaintextHash,faviconPlaintextHash:e.faviconPlaintextHash,headerMediaPlaintextHash:e.headerMediaPlaintextHash,headerTitle:e.headerTitle,isTombstoned:e.isTombstoned,maxSubtitleNumOfLines:e.maxSubtitleNumOfLines,maxTitleNumOfLines:e.maxTitleNumOfLines,msgId:e.msgId,overlayDescription:e.overlayDescription,overlayIconGlyph:e.overlayIconGlyph,overlayTitle:e.overlayTitle,previewMediaIds:e.previewMediaIds,subtitleText:e.subtitleText,targetId:e.targetId,targetType:e.targetType,targetUsername:e.targetUsername,threadJid:e.threadJid,titleText:e.titleText,xmaLayoutType:e.xmaLayoutType};return{encodedFields:n,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,n).readByteArrayView()}}function w(e){var t={author:e.author,editExternalId:e.editExternalId,editTs:e.editTs,msgContent:e.msgContent,sendStatus:e.sendStatus,specialTextSize:e.specialTextSize};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,t).readByteArrayView()}}function A(e){var t={accessibilitySummaryText:e.accessibilitySummaryText,mimetype:e.mimetype,previewHeight:e.previewHeight,previewUrl:e.previewUrl,previewUrlExpirationTimestampMs:e.previewUrlExpirationTimestampMs,previewWidth:e.previewWidth,type:e.type};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloReceiverFetchInfoTableSchema.pb").ReceiverFetchInfoTableSchemaProtoSpec,t).readByteArrayView()}}function F(e){var t=Array.from(e.pollOptions,function(e){var t=e[0],n=e[1];return{pollOption:{optionText:n.optionText,voteAuthors:Array.from(n.voteAuthors)},pollOptionHash:t}}),n=Array.from(e.latestSenderTimestampsMs,function(e){var t=e[0],n=e[1];return{author:t,latestSenderTimestampMs:n}}),r={encKey:e.encKey,latestSenderTimestampsMs:n,pollAuthor:e.pollAuthor,pollOptions:t,pollParticipantCount:e.pollParticipantCount,pollState:e.pollState,selectableOptionsCount:e.selectableOptionsCount,title:e.title};return{encodedFields:r,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloPollTableSchema.pb").PollTableSchemaProtoSpec,r).readByteArrayView()}}l.encodeDbObj=m,l.encodeDbPollForEncryption=F}),98);
__d("MAWMpsMigrationRunningState",[],(function(t,n,r,o,a,i){"use strict";var e=!1;function l(){return e}function s(t){e=t}i.isMawMpsMigrationRunning=l,i.setIsMawMpsMigrationRunning=s}),66);
__d("MAWDbObjEncryption",["ExecutionEnvironment","FBLogger","MAWBridge","MAWCryptoConsts","MAWDbEncryptObjContent","MAWDbObjDecode","MAWDbObjEncode","MAWDexieTable","MAWIndexedDb","MAWKeychainCrypto","MAWKeychainNaClCrypto","MAWKeychainUtil","MAWMpsMigrationRunningState","MAWQplProxy","MAWUnrecoverableDbErrors","MWEARKeychainV3","MWEARKeychainV3Errors","ODS","WABase64","WATimeUtils","getErrorSafe","gkx","isEncryptionAtRestEnabled","pageID","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u="_encryptedContent",c=new Set(["threads","messages","participants"]);function d(e,t,n){if(!(r("isEncryptionAtRestEnabled")()||r("gkx")("5469")===!0)||!o("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(t))return e;var a=o("MAWQplProxy").startQplUserFlow(r("qpl")._(25300256,"115"),{bool:{isWorker:(s||(s=r("ExecutionEnvironment"))).isInWorker,useMawEar:o("MWEARKeychainV3").isKeychainSettled("maw_ear")},string:{pageID:r("pageID"),tableName:t}});try{var i=babelHelpers.extends({},e),l=n(o("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear"),d=l.keys,m=d[0],p=l.version,_=l.randomisedVersion;o("MWEARKeychainV3").isKeychainSettled("maw_ear")===!1&&r("FBLogger")("messenger_web").mustfix("[EAR] Encrypting %s data with global ear. Transactor: %s",t,o("MAWDexieTable").getDexiePSDItem("transactorName")),a.addAnnotations({int:{keyVersion:p,randomisedVersion:_}});var f=o("MAWKeychainUtil").makeAAD(p,o("MAWCryptoConsts").CIPHER_ID),g=o("MAWDbObjEncode").encodeDbObj(e,t),h=g.encodedFields,y=g.proto;Object.keys(h).forEach(function(t){Object.prototype.hasOwnProperty.call(e,t)&&delete i[t]});var C=o("MAWDbEncryptObjContent").encryptContent(m,y,f);return i[u]=C,c.has(t)&&(i.updatedAt_S456130=Date.now(),i.randomisedVersion_S456130=_,i.encryptedWith_S456130=o("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear",i.keyVersion_S456130=p),a==null||a.endSuccess(),i}catch(e){var b=r("getErrorSafe")(e);throw a==null||a.endFail("ear_encrypt_fail"),r("FBLogger")("messenger_web").catching(b).mustfixThrow("[%s] %s - Encrypted dexie was unable to encrypt an entity for table %s",b.name,b.message,t)}}function m(t,n,a){if(!o("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(n)||!Object.prototype.hasOwnProperty.call(t,u))return t;var i=(s||(s=r("ExecutionEnvironment"))).isInMainThread?null:o("MAWQplProxy").startQplUserFlow(r("qpl")._(25313004,"118"));i==null||i.addAnnotations({bool:{isWorker:(s||(s=r("ExecutionEnvironment"))).isInWorker,useMawEar:o("MWEARKeychainV3").isKeychainSettled("maw_ear")},string:{pageID:r("pageID"),tableName:n}});var l;try{var d=t[u],m=babelHelpers.extends({},t);(e||(e=o("ODS"))).bumpEntityKey(3185,"maw_db_ear_decryption","encrypted_content_type."+n+"."+(d instanceof ArrayBuffer?"ArrayBuffer":"string"));var f=d instanceof ArrayBuffer?d:o("WABase64").decodeB64(d),g=o("MAWKeychainCrypto").getKeyVersionFromCipherDataString(f),h=g.aadLengthInBytes,y=g.keyVersion,C=a(o("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear",y);l=C;var b=C.dbEntry,v=C.keys,S=C.randomisedVersion;i==null||i.addAnnotations({int:{contentVersion:t==null?void 0:t.keyVersion_S456130,keyVersion:y,randomisedVersion:S},string:{encryptedWith:t==null?void 0:t.encryptedWith_S456130,randomisedVersionEncryption:t==null?void 0:t.randomisedVersion_S456130}});var R={},L,E;for(var k of v)try{L=o("MAWKeychainNaClCrypto").decryptArrayBuffer(k,f,y,b.formatVersion,h);break}catch(e){E=e}if(L==null)throw r("getErrorSafe")(E);var I=o("MAWDbObjDecode").decodeDbObj(L,n);Object.keys(I).forEach(function(e){R[e]=I[e]}),delete m[u];var T=babelHelpers.extends({},m,R);return i==null||i.endSuccess(),T}catch(e){var D,x,$;if(c.has(n)){var P;i==null||i.addAnnotations({int:{updatedAt:(P=t==null?void 0:t.updatedAt_S456130)!=null?P:-1}})}if((e instanceof o("MAWKeychainNaClCrypto").EARDecryptionError||e instanceof o("MWEARKeychainV3Errors").EARKeychainNotFoundError)&&o("MAWMpsMigrationRunningState").isMawMpsMigrationRunning()){i==null||i.addAnnotations({bool:{earDecryptionErrorSuppressed:!0}}),r("FBLogger")("messenger_web").mustfix("[EAR] Ignoring EAR decryption error during MAW->MPS migration. Table: %s.",n);return}(s||(s=r("ExecutionEnvironment"))).isInWorker&&(e instanceof o("MAWKeychainNaClCrypto").EARDecryptionError||e instanceof o("MWEARKeychainV3Errors").EARKeychainNotFoundError)&&(r("FBLogger")("messenger_web").mustfix("[EAR] Encountered EAR Error - submitting unrecoverableDbError. Table: %s.",n),i==null||i.addAnnotations({bool:{unrecoverableDbError:!0}}),o("MAWBridge").getBridge().fireAndForget("event","unrecoverableDbError",{error:new(o("MAWUnrecoverableDbErrors")).EarRuntimeError}));var N=r("getErrorSafe")(e);throw i==null||i.markError("ear_decrypt_exception",null,N),i==null||i.endFail("ear_decrypt_fail"),r("FBLogger")("messenger_web").catching(N).mustfixThrow("[%s] %s - (v2) Encrypted dexie was unable to decrypt an entity for table %s. UpdatedAt: %s. KeyStatus: %s. Signature matches: %s. Key source: %s. Using MAW EAR: %s. Worker: %s. Encrypted With: %s. PageID: %s. Source: %s",N.name,N.message,n,p(t==null?void 0:t.updatedAt_S456130),_(t,l),(t==null?void 0:t.randomisedVersion_S456130)!=null&&((D=l)==null?void 0:D.randomisedVersion)!=null?t.randomisedVersion_S456130===l.randomisedVersion:null,(x=($=l)==null?void 0:$.dbEntry.source)!=null?x:"-1",o("MWEARKeychainV3").isKeychainSettled("maw_ear"),(s||(s=r("ExecutionEnvironment"))).isInWorker,t==null?void 0:t.encryptedWith_S456130,r("pageID"),o("MAWDexieTable").getDexiePSDItem("transactorName"))}}function p(e){if(e==null)return"unknown";var t=Date.now()-e,n=Math.floor(t/(1e3*60*60*24));return n<1?"0-1 days":n<7?"1-7 days":n<14?"7-14 days":n<30?"14-30 days":"30+ days"}function _(e,t){if((e==null?void 0:e.updatedAt_S456130)==null||t==null)return null;var n=o("WATimeUtils").castToUnixTime(e.updatedAt_S456130/1e3),r=t.dbEntry.expiration-o("MAWCryptoConsts").ENC_KEY_TTL;return n===r?"same":n>r?"key_older":"key_newer"}l.ENCRYPTED_COLUMN_NAME=u,l.encryptDbObj=d,l.decryptDbObj=m}),98);
__d("MAWEBCombinedSwitch",["MAWEBEnabledStateManager","MAWEBLSInWorkerSwitch","MAWEBSwitch","MAWODSProxy","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n){var r;return r=e.call(this)||this,r.$MAWCombinedStateManager$p_1=t,r.$MAWCombinedStateManager$p_2=n,r.$MAWCombinedStateManager$p_3=null,r.$MAWCombinedStateManager$p_4=!1,r.$MAWCombinedStateManager$p_1.onSet(function(){r.$MAWCombinedStateManager$p_5()}),r.$MAWCombinedStateManager$p_2.onSet(function(){r.$MAWCombinedStateManager$p_5()}),r.$MAWCombinedStateManager$p_5(),r}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.isEnabled=function(){var t=e.prototype.isEnabled.call(this);return this.$MAWCombinedStateManager$p_6(),t},n.$MAWCombinedStateManager$p_6=function(){var e=this.$MAWCombinedStateManager$p_1.isEnabled(),t=this.$MAWCombinedStateManager$p_2.isEnabled(),n=e!==t,r=e?"enabled":"disabled",a=t?"enabled":"disabled",i=n?"mismatch":"match";if(n&&!this.$MAWCombinedStateManager$p_4)this.$MAWCombinedStateManager$p_3=Date.now(),this.$MAWCombinedStateManager$p_4=!0;else if(this.$MAWCombinedStateManager$p_4&&this.$MAWCombinedStateManager$p_3!=null){var l=this.$MAWCombinedStateManager$p_3,s=Date.now()-l;this.$MAWCombinedStateManager$p_4=n,this.$MAWCombinedStateManager$p_3=n?Date.now():null;var u=this.$MAWCombinedStateManager$p_7(s);o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_switch.sync.duration_bucket."+u});var c=n?"failed":"success";o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_switch.sync.result."+c})}o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_switch."+i+"."+r+"."+a})},n.$MAWCombinedStateManager$p_7=function(t){return t<100?"under_100ms":t<500?"100_to_500ms":t<1e3?"500ms_to_1s":t<5e3?"1s_to_5s":t<1e4?"5s_to_10s":"over_10s"},n.$MAWCombinedStateManager$p_5=function(){this.set(this.$MAWCombinedStateManager$p_1.isEnabled()&&this.$MAWCombinedStateManager$p_2.isEnabled()),this.$MAWCombinedStateManager$p_6()},t})(o("MAWEBEnabledStateManager").MAWEBEnabledStateManager),s=new e(r("MAWEBSwitch"),r("MAWEBLSInWorkerSwitch"));l.MAWCombinedStateManager=e,l.MAWEBCombinedSwitch=s}),98);
__d("LFUCache",["Cache","ExecutionEnvironment"],(function(t,n,r,o,a,i,l){"use strict";var e,s=15,u=1,c=6e4,d=(function(t){function n(n,o){var a;return a=t.call(this)||this,a.$LFUCache2=n&&n>0?n:s,a.$LFUCache3=o&&o>0?o:u,((e||(e=r("ExecutionEnvironment"))).canUseDOM||(e||(e=r("ExecutionEnvironment"))).isInWorker)&&a.$LFUCache4(),a}babelHelpers.inheritsLoose(n,t);var o=n.prototype;return o.$LFUCache4=function(){clearTimeout(this.$LFUCache1),this.$LFUCache1=setTimeout(this.purge.bind(this),this.$LFUCache2*c)},o.destroy=function(){clearTimeout(this.$LFUCache1)},o.get=function(n,r){return this.has(n)&&this.$LFUCache5(n),t.prototype.get.call(this,n,r)},o.set=function(n,r,o,a){var e=this.has(n),i=t.prototype.set.call(this,n,r,o,a);return i&&(e?this.$LFUCache5(n):this.$LFUCache6(n,this.$LFUCache3)),i},o.purge=function(){var e=this,t=Array.from(this.__keys());t.forEach(function(t){e.$LFUCache7(t)<e.$LFUCache3?e.delete(t):e.$LFUCache6(t,0)}),this.$LFUCache4()},o.$LFUCache5=function(t){var e=this.$LFUCache7(t)+1;return this.$LFUCache6(t,e),e},o.$LFUCache7=function(t){var e=this.__getRaw(t);return e&&e.$LFUCache8?e.$LFUCache8:0},o.$LFUCache6=function(t,n){var e=this.__getRaw(t);return e||(e=this.__getNewRawObject()),e.$LFUCache8=n,this.__setRaw(t,e),!0},n})(r("Cache"));l.default=d}),98);
__d("memoizeWithArgsLFUCache",["LFUCache"],(function(t,n,r,o,a,i,l){function e(e,t,n,o){var a;function i(){return a||(a=new(r("LFUCache"))(n)),a}function l(e){if(e===void 0)a=null;else{var t;(t=a)==null||t.delete(e)}}o&&o(l);var s=function(){var n=i(),r=t.apply(void 0,arguments);n.has(r)||n.set(r,e.apply(void 0,arguments));var o=n.get(r);return o};return s}l.default=e}),98);
__d("MAWMpsXMAValidationPreprocessor",["ACTSanitizerApiLazyLoader","ACTSanitizerApiTypes","FBLogger","MAWParseXMAFBConfig","MAWParseXMAProtocol","MAWProtobufDeserializers","MpsPreprocessor","WAResultOrError","err","getErrorSafe","getMediaTypeFromConsumerMessage"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(e.payload!=null){var t=new(o("MAWProtobufDeserializers")).DeserializedMessageApplication(e.payload),n=t.subProtocol();if((n==null?void 0:n.kind)==="consumerApplication")return n.proto}}function s(){var t=null;return async function(n){try{if(t==null){var a=await o("ACTSanitizerApiLazyLoader").loadACTSanitizerApi();t=a.isXMAValid}var i=t,l=i(n);if(l!==o("ACTSanitizerApiTypes").ACTSanitizerValidationResult.Valid)throw r("FBLogger")("mps").mustfixThrow("XMA validation failed - extendedContentMessage does not have valid XMA content");var s=n.associatedMessage,u=n.sentWithMessageId,c=n.targetType,d=n.xmaDataclass;if(c==null||!o("MAWParseXMAFBConfig").isFBSupportedTargetType({fbTargetType:c,xmaDataclass:d}))return r("FBLogger")("mps").warn("XMA Validation - found futureproof message"),o("WAResultOrError").makeResult();if(s!=null&&u==null)throw r("FBLogger")("mps").mustfixThrow("XMA validation failed - XMA associatedMessage cannot be received without sentWithMessageId field");if(s!=null){var m=e(s);if(o("getMediaTypeFromConsumerMessage").getMediaTypeFromConsumerMessage(m)!=null&&!o("MAWParseXMAProtocol").SUPPORTED_XMA_ASSOC_MEDIA_TARGET_TYPES.has(c))throw r("FBLogger")("mps").mustfixThrow("XMA validation failed - XMA associated msg has unsupported media type")}return o("WAResultOrError").makeResult()}catch(e){var p=r("getErrorSafe")(e);return r("FBLogger")("mps").catching(r("getErrorSafe")(p)).mustfix("XMA Validation failed for message"),o("WAResultOrError").DEPRECATED_makeError("runtime-error",p)}}}var u=o("MpsPreprocessor").preprocessor(async function(e){var t=e.ctx,n=e.payloadList,a=new Map,i=new Array(n.length),l=s(),u=n.map(function(e,t){var n,s=(n=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(e.message.payload).encryptedTransportMessage())==null||(n=n.armadillo())==null||(n=n.payload)==null||(n=n.content)==null?void 0:n.extendedContentMessage;if(s==null){i[t]=e;return}return l(s).then(function(n){if(n.success)i[t]=e;else{var o;a.set(e.message.messageId,(o=n.payload)!=null?o:r("err")("XMA validation failed for message - runtime error"))}})}).filter(Boolean);return u.length>0&&await Promise.all(u),{ctx:t,errors:a,payloadList:i.filter(Boolean)}},"xma_validator");l.xmaValidator=s,l.MAWMpsXMAValidationPreprocessor=u}),98);
__d("XFBLSRestoreOperationType.facebook",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum").Mirrored(["DELTA_GENERIC_MESSAGE_SYNC","INITIAL_RESTORE","MESSAGE_QUERY_RESTORE","POINT_QUERY_RESTORE","RANGE_QUERY_RESTORE","SNAPSHOT_RESTORE","SURROUNDING_RESTORE","THREAD_POINT_QUERY_RESTORE","UNKNOWN"]),l=e;i.default=l}),66);
__d("handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages.graphql",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"supplemental_otid",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"actor_token",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"mek_fbid",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"mek_id",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"transport_sender_signing_pk",storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"transport_sender_message_signature",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"franking_tag",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"reporting_tag",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"message_encryption_version",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"message_metadata_version",storageKey:null},C=[t,n];return{argumentDefinitions:[{defaultValue:!1,kind:"LocalArgument",name:"minos_gk_enabled"}],kind:"Fragment",metadata:null,name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},e,t,n,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"message_tags",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[r,e,t,n,o,a],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[r,e,t,n,o,a,i,l],storageKey:null},{alias:null,args:null,concreteType:"XFBUnencryptedProtobufStanza",kind:"LinkedField",name:"top_level_protobuf_unencrypted",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"unencrypted_protobuf",storageKey:null},o],storageKey:null},{condition:"minos_gk_enabled",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"XFBMinosProtobufStanza",kind:"LinkedField",name:"top_level_protobuf_v2",plural:!1,selections:[s,u,c,d,m,p,_,f,g,h,y],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs_v2",plural:!0,selections:[s,u,m,c,d,i,l,p,_,f,g,h,y],storageKey:null}]}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"thread_not_found",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:C,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:C,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null},{condition:"minos_gk_enabled",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"XFBMinosDecryptionKeyMap",kind:"LinkedField",name:"minos_decryption_keys",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,concreteType:"XFBMinosDecryptionKeys",kind:"LinkedField",name:"keys",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBMinosMekInfo",kind:"LinkedField",name:"mek_info",plural:!1,selections:[d,{alias:null,args:null,kind:"ScalarField",name:"roster_hash",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_mek",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mek_creation_timestamp",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mek_encryption_version",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosRecipientInfo",kind:"LinkedField",name:"recipient_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"epoch_fbid",storageKey:null},t,{alias:null,args:null,kind:"ScalarField",name:"epoch_head",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBMekCreatorInfo",kind:"LinkedField",name:"mek_creator_info",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBMinosEncryptionKeys",kind:"LinkedField",name:"minos_keys",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"sender_auth_pk",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sender_epoch_head",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBMinosTransportKeys",kind:"LinkedField",name:"transport_keys",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ephm_hpke_pk",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ephm_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mek_creator_transport_signing_pk",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]}],type:"XFBEncryptedBackupMessages",abstractKey:null}})();a.exports=e}),null);
__d("handleRestoreMessagesGraphQLResponse",["EBMinosInterfaceTypes","I64","MEBEncryptionVersion","QPLUserFlow","WALogger","handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages.graphql"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d;function m(e){if(e==null)return r("MEBEncryptionVersion").UNKNOWN;switch(e){case"ENCRYPTION_KDF_WITH_NULL_SALT":return r("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT;case"ENCRYPTION_KDF_WITH_VERSION":return r("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_VERSION;case"ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY":return r("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY;case"TEST_VERSION":return r("MEBEncryptionVersion").TEST_VERSION;default:return r("MEBEncryptionVersion").UNKNOWN}}function p(e,t,n,a){var i,l=((i=e==null?void 0:e.map(function(e){var n,r,a,i,l,c,p,f,g;if(e==null)return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message is null in the GraphQL range restore response"]))),null;var h=e.otid;if(h==null)return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] otid is null for a message in the GraphQL range restore response"]))),null;var y=(n=e.echo_document)==null?void 0:n.echo_document_string,C=(r=e.echo_document)==null?void 0:r.epoch_anon_id,b=(a=e.echo_document)==null?void 0:a.epoch_fingerprint,v=e.protobuf_stanzas,S=v==null||(i=v.top_level_protobuf)==null?void 0:i.encrypted_protobuf_stanza,R=v==null||(l=v.top_level_protobuf)==null?void 0:l.epoch_anon_id,L=v==null||(c=v.top_level_protobuf)==null?void 0:c.epoch_id,E=v==null||(p=v.top_level_protobuf)==null?void 0:p.protobuf_timestamp_ms,k=v==null?void 0:v.supplemental_protobufs,I=v==null?void 0:v.message_tags,T=(f=e.protobuf_stanzas)==null?void 0:f.top_level_protobuf_v2,D=(g=e.protobuf_stanzas)==null?void 0:g.top_level_protobuf_unencrypted;if(D!=null&&D.unencrypted_protobuf!=null&&D.protobuf_timestamp_ms!=null){var x=D.unencrypted_protobuf,$=D.protobuf_timestamp_ms;return{message:{isUnencrypted:!0,messageTags:o("EBMinosInterfaceTypes").convertArrayToMpsMessageTags(I),otid:h,supplementalProtobufs:[],topLevelProtobuf:{backup_id:t,encryptedProtobufContent:x,encryption_version:void 0,epoch_anon_id:new ArrayBuffer(0),epoch_id:void 0,otid:h,protobufTimestampMs:$,value:void 0}},type:"protobuf"}}if(S==null||R==null||L==null||E==null){var P,N;if(y==null||C==null||y.length===0)return T==null&&_(S,R,L,E),null;var M=m((P=e.echo_document)==null?void 0:P.encryption_version);return{message:{backup_id:t,encryption_version:M,epoch_anon_id:new TextEncoder().encode(C).buffer,epoch_fingerprint:b!=null?new TextEncoder().encode(b).buffer:void 0,epoch_id:((N=e.echo_document)==null?void 0:N.epoch_id)!=null?(d||(d=o("I64"))).of_string(e.echo_document.epoch_id):void 0,otid:h,value:y},type:"echo"}}if(v!=null){var w,A=m(v==null||(w=v.top_level_protobuf)==null?void 0:w.encryption_version),F={messageTags:o("EBMinosInterfaceTypes").convertArrayToMpsMessageTags(I),otid:h,supplementalProtobufs:[],topLevelProtobuf:{backup_id:t,encryptedProtobufContent:S,encryption_version:A,epoch_anon_id:new TextEncoder().encode(R).buffer,epoch_id:(d||(d=o("I64"))).of_string(L),otid:h,protobufTimestampMs:E,value:void 0}};return k==null||k.forEach(function(e){var n=e==null?void 0:e.supplemental_key,r=e==null?void 0:e.encrypted_protobuf_stanza,a=e.epoch_anon_id,i=e==null?void 0:e.epoch_id,l=e==null?void 0:e.protobuf_timestamp_ms;if(!(r==null||a==null||i==null||l==null||n==null)){var s=m(e==null?void 0:e.encryption_version);F.supplementalProtobufs.push({backup_id:t,encryptedProtobufContent:r,encryption_version:s,epoch_anon_id:new TextEncoder().encode(a).buffer,epoch_id:(d||(d=o("I64"))).of_string(i),protobufTimestampMs:l,skCipherText:e==null?void 0:e.sk_ciphertext,supplementalKey:n,value:void 0})}}),{message:F,type:"protobuf"}}return null}))!=null?i:[]).filter(Boolean),c=l.filter(function(e){return e.type==="echo"}).map(function(e){return e.message}),p=l.filter(function(e){return e.type==="protobuf"}).map(function(e){return e.message});return a!=null&&n!=null&&r("QPLUserFlow").addPoint(n,"processing_encrypted_messages_complete",{instanceKey:a}),{encryptedNonLSEchoMessages:c,encryptedNonLSProtobufs:p}}function _(e,t,n,r){o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message with no echo document and no protobuf data, more details: encrypted_protobuf_content: ",", protobuf_epoch_anon_id: ",", protobuf_epoch_id: ",", protobuf_timestamp_ms: ",""])),e==null?"null/empty":"not empty",t==null?"null/empty":"not empty",n==null?"null/empty":"not empty",r==null?"null/empty":"not empty")}e!==void 0||(e=n("handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages.graphql")),l.processMessageArray=p}),98);
__d("EBMessagePointQuery",["Base64Utils","EBAPIConvertNativeToLS","EBAPIDecryptionModule","EBAPIQPLPoints","EBAPISharedTypes","EBAPIWorkerCheck","EBDedupeEncryptedLabyrinthMessages","EBDedupeLabyrinthMessages","EBDeriveAndStoreEpochs","EBGetClientState","EBLS","EBMessagePointQuery.graphql","EBMinosCheckWasmFeatureSupport","EBMinosDecryptAndValidateMessages","EBMinosInterfaceTypes","EBgenerateMPSMessageQuery","FBLogger","I64","LSVec","MAWCurrentUser","MAWEncryptedBackupUtils","MAWHandleEBRestoreWithHIM","MAWJobDefinitions","MAWMpsXMAValidationPreprocessor","MpsTypes","QPLFlow","WAJids","WAResultOrError","WorkerRelay","WorkerRelayNetwork","getErrorSafe","gkx","handleRestoreMessagesGraphQLResponse","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=e!==void 0?e:e=n("EBMessagePointQuery.graphql");async function c(e){var t=e.chatJid,n=e.messageIds,a=e.source,i=await o("EBMinosCheckWasmFeatureSupport").checkWasmFeatureSupportAndGK(),l=o("QPLFlow").startQPLFlow(r("qpl")._(521474469,"2612"),{annotations:{bool:{is_wasm_serializer_on:r("gkx")("18428"),minos_rollout_enabled:i,occam_only_mailbox_users:r("gkx")("16674")},string:{source:a!=null?a:"unknown"}}});try{var c,m,p,_,f;if(!o("EBAPIWorkerCheck").runningInWorker())return l.endFail(o("EBAPIQPLPoints").EBAPIQPLCommonErrorPoints.UNSUPPORTED_CONTEXT),o("WAResultOrError").makeError("unsupported-context");var g=(await o("EBLS").init()).db;l.addPoint(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.LSDB_SINGLETON_RETRIEVED);var h=await o("EBGetClientState").getClientState(g);if(l.addPoint(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CLIENT_STATE_RETRIEVED,{string:{device_id:(c=h==null?void 0:h.deviceId)!=null?c:(s||(s=o("I64"))).to_string((s||(s=o("I64"))).zero)}}),h==null)return l.endFail(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{string:{error_description:o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE}}),o("WAResultOrError").makeError("no-client-state");var y=o("WAJids").threadIdForChatJid(t),C=h.backupId,b=h.deviceId,v=h.locally_available_epochs,S=h.mailboxRootKey,R=h.ocmfClientStateBlob;if(C==null||b==null||S==null||R==null)return l.endFail(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{string:{error_description:o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE}}),o("WAResultOrError").makeError("invalid-client-state");var L=""+((m=o("MAWCurrentUser").getAppID())!=null?m:0),E={restore_context:{act_thread_id:y,site:"www",tam_thread_subtype:0},success:{device_context:{device_id:b,locally_available_epochs:v,raw_tokens:{mailbox_root_key:o("Base64Utils").fromArrayBuffer(S),ocmf_client_state_blob:o("Base64Utils").fromArrayBuffer(R)}},mps_message_query:o("EBgenerateMPSMessageQuery").generateMPSMessageQueryForGraphQLQuery(y,[].concat(n))}},k={app_id:L,minos_gk_enabled:i,restore_payload_string:JSON.stringify(E),restore_type:"MESSAGE_QUERY_RESTORE"};l.addPoint(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CREATE_WORKER_NETWORK_EXECUTE_START),await o("WorkerRelayNetwork").createWorkerNetworkExecute(),l.addPoint(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CREATE_WORKER_NETWORK_EXECUTE_END),l.addPoint(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START);var I=await o("WorkerRelay").createWorkerQuery(u,k);l.addPoint(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END);var T=I==null||(p=I.viewer)==null||(p=p.encrypted_backup)==null||(p=p.mailbox)==null?void 0:p.messages_point_restore;if(T==null)return l.endFail(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{string:{error_description:o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}}),o("WAResultOrError").makeError("invalid-graphql-response");var D=T;if((D==null?void 0:D.encrypted_messages)==null)return l.endFail(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{string:{error_description:o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}}),o("WAResultOrError").makeError("invalid-graphql-response");var x=D.backup_id,$=D.encrypted_messages,P=D.epoch_derivation_set,N=D.exception_string,M=D.minos_decryption_keys,w=d($,l);if(l.addAnnotations({int:{encrypted_messages_with_content_count:w}}),N!=null)return l.endFail(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{string:{error_description:o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:N}}),o("WAResultOrError").makeError("server-side-exception");x==null&&l.addPoint(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL),l.addPoint(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START);var A=P;l.addAnnotations({bool:{hasEpochs:A!=null&&A.epoch_edges.length>0}}),await o("EBDeriveAndStoreEpochs").deriveAndStoreEpochsNonLS(g,A),l.addPoint(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END),l.addPoint("decryption_start");var F=$,O=i?o("EBMinosInterfaceTypes").processMinosMessages(F):[],B=i?await o("EBMinosDecryptAndValidateMessages").minosDecryptAndValidateMessages({encryptedMinosMessages:O,entryPoint:"point_query",minosDecryptionKeys:M,qplFlow:l,source:a!=null?a:"unknown",threadId:o("MpsTypes").toThreadId(t),validator:r("gkx")("5782")?o("MAWMpsXMAValidationPreprocessor").xmaValidator():function(){return Promise.resolve(o("WAResultOrError").makeResult())}}):o("WAResultOrError").makeResult({decryptionResult:new Map,errorMessages:[]}),W=B.success===!0&&B.value.decryptionResult.size>0?B.value.decryptionResult:null,q=B.success===!0?B.value.errorMessages:[(_=B.error)!=null?_:"unknown-error"];l.addAnnotations({bool:{minos_decrypt_success:q.length===0},int:{minos_decrypted_messages_count:(f=W==null?void 0:W.size)!=null?f:0},string_array:{minos_decrypt_errors:q}});var U=W!=null&&i?o("EBDedupeEncryptedLabyrinthMessages").dedupeEncryptedLabyrinthMessages(F,W,l):F;l.addAnnotations({int:{deduped_encrypted_messages:d(U)}});var V=o("handleRestoreMessagesGraphQLResponse").processMessageArray(U,x!=null?o("EBMinosInterfaceTypes").unsafeCastToBackupFbid(x):C),H=V.encryptedNonLSEchoMessages,G=V.encryptedNonLSProtobufs;l.addPoint("native_decryption_start");var z=await o("EBAPIDecryptionModule").decryptUsingNativeJS(g,y,G,H,a,"point_query");if(!z.success){var j,K=z.error,Q=K.message,X=o("EBAPISharedTypes").EBAPIRestoreErrorValues.find(function(e){return e===Q});return l.endFail("decrypt_labyrinth10_messages_failure",{string:{error_description:K.message,errorStackTrace:(j=K.stack)!=null?j:""}}),X!=null?o("WAResultOrError").makeError(X):o("WAResultOrError").makeError("native-decryption-error")}l.addAnnotations({bool:{labyrinth_10_toplevel_decrypt_success:z.value.decryptedEchoMessages.length===H.length&&z.value.decryptedProtobufs.length===G.length}}),l.addPoint("native_decryption_end");var Y=z.value.decryptedEchoMessages,J=z.value.decryptedProtobufs,Z=i?o("EBDedupeLabyrinthMessages").dedupeLabyrinthMessages(J,W):J,ee=Y.length+Z.length;l.addAnnotations({bool:{decrypted_count_equals_encrypted_count:w===ee},int:{decrypted_echo_count:Y.length,decrypted_messages_count:Z.length+Y.length,decrypted_protobuf_count:Z.length}}),l.addPoint("convert_native_to_decrypted_type_start");var te=o("EBAPIConvertNativeToLS").convertNativeDecryptionResponseToDecryptedMessageType(Y,Z);l.addPoint("convert_native_to_decrypted_type_end");var ne=r("LSVec").toArray(te.echo),re=te.protobuf,oe=ne.map(function(e){return o("MAWJobDefinitions").toEncodedEchoMessage(e)}),ae=o("MAWHandleEBRestoreWithHIM").convertEchoMessagesToEBProtobufs(oe,t).concat(o("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(re)),ie=new Map(ae.map(function(e){return[e.otid,e]})),le=Array.from(ie.values()),se=n.reduce(function(e,t){return e+(ie.get(t)==null?1:0)},0);return l.addAnnotations({int:{decrypted_message_result_count:le.length,missing_message_count:se}}),l.addPoint("decryption_end"),l.endSuccess(),o("WAResultOrError").makeResult(le)}catch(e){var ue,ce=r("getErrorSafe")(e);return l.endFail(o("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{string:{error_description:ce.message,errorStackTrace:(ue=ce.stack)!=null?ue:""}}),r("FBLogger")("wmi_eb").catching(ce).mustfix("Runtime error performing messagePointQuery: %s",ce.message),o("WAResultOrError").makeError("runtime-error")}}function d(e,t){var n=0,r=!1,o=!1,a=!1,i=!1;for(var l of e){var s,u=l.protobuf_stanzas,c=(u==null?void 0:u.top_level_protobuf)!=null,d=(u==null?void 0:u.top_level_protobuf_unencrypted)!=null,m=(u==null?void 0:u.top_level_protobuf_v2)!=null,p=((s=l.echo_document)==null?void 0:s.echo_document_string)!=null;r=r||c,o=o||m,a=a||p,i=i||d,(c||d||m||p)&&(n+=1)}return t!=null&&t.addAnnotations({bool:{has_echo_document:a,has_lab1_messages:r,has_lab11_messages:o,has_unencrypted_protobuf:i}}),n}l.messagePointQuery=c}),98);
__d("EBProbe",["FBLogger","MAWODSProxy","WAOdsEnums","WAShiftTimer","WATimeUtils","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(e,t,n){this.$5=!1,this.$1=e,this.$2=t,this.$3=n}var n=t.prototype;return n.sample=function(t){var e=this.$1.sample(t);return e&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_MESSAGE_PROBE,key:"sampled"}),e},n.start=function(){var e=this;this.$4==null&&(this.$4=new(o("WAShiftTimer")).ShiftTimer(function(){e.$6()}),this.$4.onOrBefore(this.$3.validationIntervalMs,void 0))},n.stop=function(){this.$4!=null&&(this.$4.cancel(),this.$4=null)},n.hasStarted=function(){return this.$4!=null},n.$6=async function(){await this.$7(),this.$4!=null&&this.$4.onOrBefore(this.$3.validationIntervalMs,void 0)},n.$7=async function(){if(!this.$5){this.$5=!0;try{var t=o("WATimeUtils").castToMillisTime(Date.now()-this.$3.sampleAgeThresholdMs),n=this.$2.fetchOlderThan({consume:!0,cutOffTimestamp:t});if(n.length>0)try{o("MAWODSProxy").odsBumpEntityKey({amount:n.length,entity:o("WAOdsEnums").Entity.EB_MESSAGE_PROBE,key:"validated"}),await this.validateSamples(n)}catch(t){var a=t instanceof Error?t:r("err")(String(t));r("FBLogger")("wmi_eb").catching(a).MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Exception in validateSamples()"])))}}finally{this.$5=!1}}},n.addMarkerToItem=function(t,n,r){return!1},n.updateSample=function(t,n){var e=this.getSamplingDB();if(e==null)return!1;var r=e.getItemByPrimaryKey(t);return r==null?!1:(n(r),!0)},n.getConfig=function(){return this.$3},n.getSamplingDB=function(){return this.$2},n.validateSamples=function(t){return Promise.reject(r("err")("validateSamples() must be implemented by concrete probe classes"))},t})();l.EBProbe=s}),98);
__d("EBSampler",["Random"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n,r){this.$1=e,this.$2=t,this.$3=n,this.$4=r}var t=e.prototype;return t.sample=function(t){var e,n=this.$3(t),r=((e=this.$2.get(n))!=null?e:0)*this.$1,a=o("Random").random(),i=a<r;return i&&this.$4.append(t),i},t.setSamplingMultipler=function(t,n){this.$2.set(t,n)},t.setSamplingRate=function(t){this.$1=t},e})();l.EBSampler=e}),98);
__d("EBMinosDisableLabyrinth10Uploads",["gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("gkx")("16675")}l.disableLabyrinth10Uploads=e}),98);
__d("MWEBODSUtils",["CurrentMessengerUser","MWEBODSCategory","ODS"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,a){var i=o("CurrentMessengerUser").getAppID(),l=i!=null?i.toString():"unknown",s=t+"."+l;(e||(e=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),s,n,a!=null?a:1),e.bumpEntityKey(r("MWEBODSCategory"),t,n,a!=null?a:1)}l.markODSForEB=s}),98);
__d("EncryptedBackupsUploadQueue",["EBMinosDisableLabyrinth10Uploads","EncryptedBackupsUploadEntity","MWEBODSEntityName.enum","MWEBODSUtils","PersistedQueueApi","Promise","QPLUserFlow","WAPersistedQueue","WATagsLogger","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("WATagsLogger").TAGS(["EbUploadQueue"]),d=null;function m(){return d==null?p():d}function p(){d!=null&&c.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["EB Upload Queue is already initialized"])));var t=o("WAPersistedQueue").initPersistedQueue("ebUploadQueue",o("PersistedQueueApi").persistedQueueApi());return d=t,t}function _(e){if(e.length===0||o("EBMinosDisableLabyrinth10Uploads").disableLabyrinth10Uploads())return(u||(u=n("Promise"))).resolve();o("MWEBODSUtils").markODSForEB(r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.put",e.length);var t=m();return t.addAndCommit(e.map(o("EncryptedBackupsUploadEntity").asEBUploadEntity)).then(function(){e.forEach(function(e){(e==null?void 0:e.instanceKey)!=null&&r("QPLUserFlow").endSuccess(r("qpl")._(521477113,"2698"),{instanceKey:e.instanceKey})})}).catch(function(e){return c.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to write to ebUploadQueue ",""])),e),(u||(u=n("Promise"))).reject(e)})}l.logger=c,l.ebUploadQueue=m,l.initEbUploadQueue=p,l.putMsgsToEbUpload=_}),98);
__d("InMemorySamplingDB",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e,t){this.$1=[],this.$4=new Map,this.$2=e,this.$3=t}var t=e.prototype;return t.append=function(t){var e=this.$3(t);this.$1.push([this.$2(t),t]),this.$4.set(e,t)},t.fetchOlderThan=function(t){var e=t.consume,n=e===void 0?!1:e,r=t.cutOffTimestamp,o=t.limit,a=o===void 0?50:o,i=[];if(a<=0)return i;var l=0,s=[];for(var u of this.$1){var c=u[0],d=u[1];if(c<=r&&(i.push(d),n===!0&&(l++,s.push(d))),i.length>=a)break}if(n===!0&&l>0){this.$1.splice(0,l);for(var m of s){var p=this.$3(m);this.$4.delete(p)}}return i},t.getItemByPrimaryKey=function(t){var e;return(e=this.$4.get(t))!=null?e:null},t.size=function(){return this.$1.length},t.pruneOlderThan=function(t){var e=[];this.$1=this.$1.filter(function(n){var r=n[0],o=n[1];return r<=t?(e.push(o),!1):!0});for(var n of e){var r=this.$3(n);this.$4.delete(r)}},t.purgeAll=function(){this.$1=[],this.$4.clear()},e})();i.InMemorySamplingDB=e}),66);
__d("EBMessageProbe",["EBDeps","EBGetClientState","EBMessagePointQuery","EBMessageProbeSamplingPreprocessor","EBProbe","EBSampler","EncryptedBackupsUploadQueue","EncryptedBackupsUploadQueueV3Scheduler","FBLogger","I64","InMemorySamplingDB","MAWEBLSInWorkerSwitch","MAWODSProxy","MpsTypes","QPLFlow","WAOdsEnums","WAResultOrError","WATimeUtils","WebMps","getErrorSafe","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){var n={};for(var r of e){var o=t(r);n[o]==null&&(n[o]=[]),n[o].push(r)}return n}var d={qplEvent:r("qpl")._(521475573,"3232"),sampleAgeThresholdMs:(u=r("justknobx"))._("3485"),validationIntervalMs:u._("3949")},m=u._("3573")/1e4,p=new Map([["text",u._("3952")],["image",u._("3957")],["video",u._("3969")],["audio",u._("3970")],["document",u._("3973")],["sticker",u._("3977")],["gif",u._("3981")],["xma",u._("1505")],["revoked",u._("66")],["deleteForMe",u._("399")]]);function _(e,t,n,r,a,i){var l=n.has(t.messageId),s=o("EBMessageProbeSamplingPreprocessor").isDeleteMessageType(t.messageType),u=a?r.has(t.messageId):void 0,c=s?!l:l;c?e.endSuccess({bool:{messageFound:l,mpsLocalMessageFound:u}}):e.endFail("message_probe_not_successful",{bool:{messageFound:l,mpsLocalMessageFound:u},string:{encryption_version:i,error:"message_probe_not_successful"}})}var f=function(t){return t.timestampMs},g=function(t){return t.messageType},h=function(){return new(o("InMemorySamplingDB")).InMemorySamplingDB(f,function(e){return e.messageId})},y=function(t){return new(o("EBSampler")).EBSampler(m,p,g,t)},C=(function(t){function n(e,n,r){return r===void 0&&(r=d),t.call(this,e,n,r)||this}babelHelpers.inheritsLoose(n,t),n.getInstance=function(){if(!n.$EBMessageProbe$p_1){var e=h(),t=y(e);n.$EBMessageProbe$p_1=new n(t,e,d)}return n.$EBMessageProbe$p_1},n.reset=function(){n.$EBMessageProbe$p_1=null};var a=n.prototype;return a.addMarkerToItem=function(t,n,r){return this.addMarker(t,n,r)},a.addMarker=function(t,n,r){var e=this.getSamplingDB();if(e==null)return!1;var a=e.getItemByPrimaryKey(t);if(a==null)return!1;var i={event:n,metadata:r,timestampMs:o("WATimeUtils").castToMillisTime(Date.now())};return a.markers.push(i),!0},a.getMarkersForMessage=function(t){var e=this.getSamplingDB();if(e==null)return null;var n=e.getItemByPrimaryKey(t);return n==null?null:[].concat(n.markers)},a.getMessageSample=function(t){var e=this.getSamplingDB();return e==null?null:e.getItemByPrimaryKey(t)},a.$EBMessageProbe$p_2=function(t){return t.length===0?"":t.map(function(e){return e.event}).join(",")},a.$EBMessageProbe$p_3=function(t){var e={bool:{},int:{},string:{}};for(var n of t){var r=n.metadata;if(r!=null)for(var o of Object.entries(r)){var a=o[0],i=o[1];typeof i=="string"?e.string!=null&&(e.string[a]=i):typeof i=="number"?e.int!=null&&(e.int[a]=i):typeof i=="boolean"&&e.bool!=null&&(e.bool[a]=i)}}return e},a.$EBMessageProbe$p_4=function(t){if(t===0)return"0";if(t>=1e3)return"1000+";var e=Math.floor(t/50)*50,n=e+50;return e+"-"+n},a.$EBMessageProbe$p_5=function(t){if(t<0)return"never";var e=t/(1e3*60);return e<1?"<1min":e>=1&&e<5?"1-5min":e>=5&&e<10?"5-10min":e>=10&&e<20?"10-20min":e>=20&&e<60?"20-60min":">60min"},a.validateSamples=async function(n){if(n.length!==0){var t=o("EncryptedBackupsUploadQueue").ebUploadQueue(),a=-1,i="unknown";try{a=await t.count(),i=this.$EBMessageProbe$p_4(a),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_UPLOAD,key:"upload_queue_count_bucket_"+i})}catch(e){r("FBLogger")("wmi").catching(r("getErrorSafe")(e)).warn("Failed to get upload queue count for probe annotation")}var l=o("EncryptedBackupsUploadQueueV3Scheduler").getLastSuccessfulAckTimestampMs(),u=l!=null?Date.now()-l:-1,d=this.$EBMessageProbe$p_5(u),m=new Set,p=[];for(var f of n){var g,h,y=f.chatJid+"_"+f.messageId;if(!m.has(y)){m.add(y);var C=Date.now()-f.timestampMs,b=C/(1e3*60),v=function(t){return t<5?"<5min":t>=5&&t<10?"5-10min":">10min"},S=void 0,R=void 0;if(f.queueId!=null){var L,E=await t.get(f.queueId);if(S=E!=null,(E==null||(L=E.msgId)==null?void 0:L.externalId)!=null){var k;R=o("MpsTypes").toMessageId(E==null||(k=E.msgId)==null?void 0:k.externalId)===f.messageId}}var I=o("QPLFlow").startQPLFlow(this.getConfig().qplEvent,{annotations:babelHelpers.extends({},this.$EBMessageProbe$p_3(f.markers),{bool:{eb_state:r("MAWEBLSInWorkerSwitch").isEnabled(),ebUploadTaskScheduled:o("EncryptedBackupsUploadQueueV3Scheduler").isUploadTaskScheduled(),isProtobufOnlyUpload:!0,queueItemExists:S,queueItemMessageIdMatches:R},int:{markerCount:f.markers.length,queueCount:a,queueId:(g=f.queueId)!=null?g:-1,sampleSize:n.length,sampleTimestampMs:f.timestampMs,validationIntervalMs:C,validationTimestampMs:Date.now()},string:{bucketizedQueueCount:i,bucketizedTimeSinceLastAck:d,chatJid:f.chatJid,insertionSource:(h=f.insertionSource)!=null?h:"unknown",markerEvents:this.$EBMessageProbe$p_2(f.markers),messageId:f.messageId,messageType:f.messageType,validationIntervalBucket:v(b),version:"v1"}})});p.push({qplFlow:I,sample:f})}}try{var T=r("justknobx")._("4947"),D=c(p,function(e){return e.sample.chatJid}),x=Object.entries(D).map(async function(e){var t=e[0],n=e[1],r=n.map(function(e){return e.sample.messageId}),a=n[0].sample.chatJid,i={chatJid:a,messageIds:r,source:"message_probe"};n.forEach(function(e){var t=e.qplFlow;t!=null&&t.addPoint("point_query_start")});var l=await o("EBMessagePointQuery").messagePointQuery(i),s=T?await o("WebMps").mps().batchLoadMessage({config:{shouldFetchSupplementals:!1,shouldFetchTags:!1,strategy:"local-only"},debug:{purpose:"eb-message-probe"},messageIds:r,threadId:o("MpsTypes").toThreadId(a)}):o("WAResultOrError").makeResult([]);return n.forEach(function(e){var t=e.qplFlow;t!=null&&t.addPoint("point_query_end")}),{chatJid:a,mpsLocalResult:s,result:l,samplesWithQplFlow:n}}),$=await o("EBDeps").getDeps().getLSDB(),P=await o("EBGetClientState").getClientState($),N=P==null?void 0:P.encryptionVersion,M=N!=null?(s||(s=o("I64"))).to_string(N):"unknown",w=await Promise.all(x);for(var A of w){var F,O=A.mpsLocalResult,B=A.result,W=A.samplesWithQplFlow,q=new Set((F=O.value)==null?void 0:F.map(function(e){var t,n;return(t=e==null||(n=e.toplevelProtobuf)==null?void 0:n.messageId)!=null?t:null}));if(B.success){var U=new Set(B.value.map(function(e){return o("MpsTypes").toMessageId(e.otid)}));for(var V of W)_(V.qplFlow,V.sample,U,q,T,M)}else for(var H of W){var G=H.qplFlow;if(G!=null){var z;G.endFail("query_failed",{bool:{messageFound:!1,mpsLocalMessageFound:T?q.has(H.sample.messageId):void 0},string:{encryption_version:M,error:(z=B.error)!=null?z:"unknown-query-failure"}})}}}}catch(t){var j=r("getErrorSafe")(t);r("FBLogger")("wmi").catching(j).MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to validate samples"])));for(var K of p){var Q;K.qplFlow.endFail("validation_exception",{bool:{messageFound:!1},string:{error:(Q=j.message)!=null?Q:"unknown-validation-exception"}})}}}},n})(o("EBProbe").EBProbe),b=C.getInstance,v=C.reset;l.EBMessageProbe=C,l.getEBMessageProbeInstance=b,l.resetEBMessageProbeInstance=v}),98);
__d("EBUploadMessagesFromWorkerMutationDeferred",["requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("EBUploadMessagesFromWorkerMutation").__setRef("EBUploadMessagesFromWorkerMutationDeferred");function s(t,n){return e.load().then(function(e){return e.uploadMessagesFromWorker(t,n)})}l.uploadMessagesFromWorker=s}),98);
__d("EncryptedBackupsCreateAttachmentContext",["EBLogger","EncryptedBackupsUploadEntity","MAWProtobufDeserializers","WAMediaTransport.pb","WAMediaUtils","decodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e=o("EBLogger").EBLogger().tags(["labyrinth_web","CreateAttachmentContext"]);function s(t){var n=new Map;try{var r=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(t),a=r.encryptedTransportMessage();if(a==null)return e.warn("transport message subprotocol is undefined"),[];var i=d(a);if(i!=null)if(i.type!==o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)c(i,n);else{var l=i.payload;u(l.favicon,n),u(l.headerImage,n),l.previews!=null&&l.previews.forEach(function(e){u(e,n)});var s=l.associatedMessage;if(s!=null&&s.payload!=null){var m=new(o("MAWProtobufDeserializers")).DeserializedMessageApplication(s.payload),p=d(m);p!=null&&c(p,n)}}}catch(t){e.warn("Unable to create attachment context for message")}return Array.from(n.entries()).map(function(e){var t=e[0],n=e[1];return{mediaObjectId:t,mediaType:n}})}function u(e,t){var n;if(e!=null){var r=o("decodeProtobuf").decodeProtobuf(o("WAMediaTransport.pb").ImageTransportSpec,e.payload),a=(n=r.integral)==null||(n=n.transport)==null||(n=n.ancillary)==null?void 0:n.objectId;a!=null&&t.set(o("WAMediaUtils").stringToDeliveryObjectId(a),o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)}}function c(t,n){var r,a,i,l=t.type,s=t.payload,u=s.integral;if((u==null||(r=u.transport)==null||(r=r.ancillary)==null?void 0:r.objectId)==null){e.warn("object id for attachment is null");return}var c=o("WAMediaUtils").stringToDeliveryObjectId(u==null||(a=u.transport)==null||(a=a.ancillary)==null?void 0:a.objectId);n.set(c,l);var d=u==null||(i=u.transport)==null||(i=i.ancillary)==null||(i=i.thumbnail)==null||(i=i.downloadableThumbnail)==null?void 0:i.objectId;if(d!=null&&d!==c){var m=o("WAMediaUtils").stringToDeliveryObjectId(d);n.set(m,o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.MESSENGER_PREVIEW)}}function d(e){var t=e.consumerMessage(),n=e.armadillo();if(t!=null){var r,a,i,l,s,u=t.payload;if((u==null||(r=u.content)==null?void 0:r.imageMessage)!=null){var c;return{payload:o("decodeProtobuf").decodeProtobuf(o("WAMediaTransport.pb").ImageTransportSpec,u==null||(c=u.content)==null||(c=c.imageMessage.image)==null?void 0:c.payload),type:o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.IMAGE}}if((u==null||(a=u.content)==null?void 0:a.videoMessage)!=null){var d,m,p,_=o("decodeProtobuf").decodeProtobuf(o("WAMediaTransport.pb").VideoTransportSpec,u==null||(d=u.content)==null||(d=d.videoMessage.video)==null?void 0:d.payload);return{payload:_,type:(_==null||(m=_.ancillary)==null?void 0:m.gifPlayback)!==!0||(_==null||(p=_.ancillary)==null?void 0:p.gifAttribution)!=null?o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.GIF:o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.VIDEO}}if((u==null||(i=u.content)==null?void 0:i.stickerMessage)!=null){var f;return{payload:o("decodeProtobuf").decodeProtobuf(o("WAMediaTransport.pb").StickerTransportSpec,u==null||(f=u.content)==null||(f=f.stickerMessage.sticker)==null?void 0:f.payload),type:o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.STICKER}}if((u==null||(l=u.content)==null?void 0:l.audioMessage)!=null){var g;return{payload:o("decodeProtobuf").decodeProtobuf(o("WAMediaTransport.pb").AudioTransportSpec,u==null||(g=u.content)==null||(g=g.audioMessage.audio)==null?void 0:g.payload),type:o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.PTT}}if((u==null||(s=u.content)==null?void 0:s.documentMessage)!=null){var h;return{payload:o("decodeProtobuf").decodeProtobuf(o("WAMediaTransport.pb").DocumentTransportSpec,u==null||(h=u.content)==null||(h=h.documentMessage.document)==null?void 0:h.payload),type:o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.DOCUMENT}}}if(n!=null){var y,C=n.payload;if((C==null||(y=C.content)==null?void 0:y.extendedContentMessage)!=null){var b;return{payload:C==null||(b=C.content)==null?void 0:b.extendedContentMessage,type:o("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA}}}}l.createAttachmentContext=s}),98);
__d("EncryptedBackupsMediaRestoreProbeQpl",["MAWQplProxy","WAGetAgeBucketForMediaKeyTimestamp","WAGetPlatformFromStanzaId","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.isRetroactiveUpload,n=e.mediaType,a=e.msgType,i=e.objectId,l=e.probeDelayMs,s=e.restoreMethod,u=e.sampleRate,c=e.stanzaId,d=e.timestamp,m=e.triggerSource,p=e.version,_=e.xmaType;return o("MAWQplProxy").startQplUserFlow(r("qpl")._(521473213,"27"),{bool:{isRetroactiveUpload:t,isUnifiedAttachmentUpload:!0},int:{probeDelayMs:l,sampleRate:u},string:{e2eePlatform:o("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(c),mediaKeyAge:o("WAGetAgeBucketForMediaKeyTimestamp").getAgeBucketForMediaKeyTimestamp(d),mediaType:n,msgType:a,objectId:i,restoreMethod:s,triggerSource:m,version:p,xmaType:_==null?"<null>":_}},{providedTimeoutInMs:r("justknobx")._("3047")})}l.startMediaRestoreProbeQPLFlow=e}),98);
__d("MAWCastToMsgType",["MAWMsgType"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e){case"image":return o("MAWMsgType").MSG_TYPE.IMAGE;case"video":return o("MAWMsgType").MSG_TYPE.VIDEO;case"gif":return o("MAWMsgType").MSG_TYPE.GIF;case"sticker":return o("MAWMsgType").MSG_TYPE.STICKER;case"file":return o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE;case"audio":return o("MAWMsgType").MSG_TYPE.PTT;case"xma":return o("MAWMsgType").MSG_TYPE.XMA}}l.castMsgrServerMediaTypeToMsgType=e}),98);
__d("MAWCastToServerMediaType",[],(function(t,n,r,o,a,i){"use strict";function e(e){switch(e){case"document":case"image":case"xma-image":case"video":case"ptt":case"gif":case"sticker":return e;default:return null}}function l(e){switch(e){case"image":case"video":case"gif":case"sticker":case"preview":return e;case"audio":return"ptt";case"xma":return"xma-image";case"file":return"document"}}i.castToServerMediaType=e,i.castMsgrServerMediaTypeToServerMediaType=l}),66);
__d("EncryptedBackupsMediaRestoreProbeV2",["$InternalEnum","EBLSResignCdnUrlDeferred","EncryptedBackupsMediaRestoreProbeQpl","MAWCastToMsgType","MAWCastToServerMediaType","Random","WAMediaUtils","WAPromiseDelays","WAResultOrError","WATagsLogger","WATimeUtils","gkx","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=n("$InternalEnum")({DEFAULT_PREVIEW:"defaultPreview",FAVICON:"favicon",HEADER:"header",PREVIEWS:"previews"}),f=r("justknobx")._("2045"),g=o("WATagsLogger").TAGS(["MediaRestoreProbeV2"]);function h(e){switch(e){case"video":return 13;case"sticker":return 10;case"audio":return 8;case"gif":return 40;case"file":return 40;case"xma":return 2;case"image":case"preview":return 1}}function y(){return r("gkx")("2067")?100:r("justknobx")._("2722")}async function C(t){var n=t.backupMessage,a=t.chatJid,i=t.sortOrderMs,l=t.stanzaId,_=t.triggerSource,C=b(n);if(C.success===!1)return C;var v=g.TAGS([l]),S=C.value;if(S==="no-attachment-with-msg")return v.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["skip restore probe because no attachment found"]))),o("WAResultOrError").makeResult(S);var R=S.map(function(e){return e.serverMediaType}).filter(function(e){return e!=="preview"}).find(Boolean);if(R==null)return v.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["skip restore probe because no attachment found"]))),o("WAResultOrError").makeResult("no-attachment-with-msg");var L=y(),E=h(R),k=o("Random").coinflip(100/(L*E));if(!k)return Promise.resolve(o("WAResultOrError").makeResult("not-sampled"));v.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Sampling before delay from source: "," "])),_),await o("WAPromiseDelays").delayMs(r("gkx")("2067")?5e3:f);var I=await Promise.all(S.map(function(e){var t=o("EncryptedBackupsMediaRestoreProbeQpl").startMediaRestoreProbeQPLFlow({isRetroactiveUpload:!1,mediaType:o("MAWCastToServerMediaType").castMsgrServerMediaTypeToServerMediaType(e.serverMediaType),msgType:o("MAWCastToMsgType").castMsgrServerMediaTypeToMsgType(R),objectId:e.objectId,probeDelayMs:f,restoreMethod:"gql",sampleRate:L,stanzaId:l,timestamp:e.timestamp,triggerSource:_,version:"protobuf",xmaType:e.xmaType});return v.LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["start probing. triggerSource: ",", serverMediaType: ",", xmaType: ",", objectId: "," "])),_,e.serverMediaType,e.xmaType,e.objectId),o("EBLSResignCdnUrlDeferred").eblsResignCdnUrlWithGraphQL({chatJid:a,deliveryObjectId:e.objectId,externalId:l,mediaDownloadFlow:{addAnnotations:function(n){t.addAnnotations(babelHelpers.extends({},n))},addPoint:function(n,r){t.addPoint(n,babelHelpers.extends({},r))}},mediaKey:e.mediaKey,mediaType:e.serverMediaType,sortOrderMs:i}).then(function(n){return n.success?(v.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Probe success"]))),{error:null,qpl:t,v2Payload:e}):(v.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Probe failed: "," "])),n.error),{error:n.error,qpl:t,v2Payload:e})}).catch(function(n){return v.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Probe failed: "," "])),n.toString()),{error:"runtime-error",qpl:t,v2Payload:e}})}));for(var T of I)T.error!=null?T.qpl.endFail(T.error,{string:{failReason:T.error}}):T.qpl.endSuccess();return o("WAResultOrError").makeResult("restore-media-success")}function b(e){var t,n=e.encryptedTransportMessage();if(n==null)return o("WAResultOrError").makeError("missing-transport");var r=n.consumerMessage();if(r!=null){var a=r.imageMessage();if(a!=null)return R(a,"image");var i=r.videoMessage();if(i!=null){var l,s,u=((l=i.payload.ancillary)==null?void 0:l.gifPlayback)===!0||((s=i.payload.ancillary)==null?void 0:s.gifAttribution)!=null;return R(i,u?"gif":"video")}var c=r.audioMessage();if(c!=null){var d=S(c,"audio");return d.success===!1?d:o("WAResultOrError").makeResult([d.value])}var m=r.stickerMessage();if(m!=null){var p=S(m,"sticker");return p.success===!1?p:o("WAResultOrError").makeResult([p.value])}var f=r.documentMessage();if(f!=null){var g=S(f,"file");return g.success===!1?g:o("WAResultOrError").makeResult([g.value])}}var h=(t=n.armadillo())==null?void 0:t.extendedContentMessage();if(h!=null){var y=h.previews();return o("WAResultOrError").makeResult([v({transport:h.favicon(),xmaType:_.FAVICON}),v({transport:h.headerImage(),xmaType:_.FAVICON}),y.length>0?v({transport:y[0],xmaType:_.DEFAULT_PREVIEW}):null].concat(y.map(function(e){return v({transport:e,xmaType:_.PREVIEWS})})).filter(Boolean))}return o("WAResultOrError").makeResult("no-attachment-with-msg")}function v(e){var t,n,r,a=e.transport,i=e.xmaType,l=a==null||(t=a.integral)==null||(t=t.transport)==null||(t=t.ancillary)==null?void 0:t.objectId;if(l==null)return null;var s=a==null||(n=a.integral)==null||(n=n.transport)==null||(n=n.integral)==null?void 0:n.mediaKeyTimestamp,u=a==null||(r=a.integral)==null||(r=r.transport)==null||(r=r.integral)==null?void 0:r.mediaKey;return u==null?null:{mediaKey:o("WAMediaUtils").castToMediaKey(u),objectId:o("WAMediaUtils").stringToDeliveryObjectId(l),serverMediaType:"xma",timestamp:s!=null?o("WATimeUtils").castLongIntToUnixTime(s):null,xmaType:i}}function S(e,t){var n,r,a,i=e==null||(n=e.payload.integral)==null||(n=n.transport)==null||(n=n.ancillary)==null?void 0:n.objectId,l=e==null||(r=e.payload.integral)==null||(r=r.transport)==null||(r=r.integral)==null?void 0:r.mediaKeyTimestamp,s=e==null||(a=e.payload.integral)==null||(a=a.transport)==null||(a=a.integral)==null?void 0:a.mediaKey;return s==null?o("WAResultOrError").makeError("missing-media-key"):i!=null?o("WAResultOrError").makeResult({mediaKey:o("WAMediaUtils").castToMediaKey(s),objectId:o("WAMediaUtils").stringToDeliveryObjectId(i),serverMediaType:t,timestamp:l!=null?o("WATimeUtils").castLongIntToUnixTime(l):null}):o("WAResultOrError").makeError("missing-object-id")}function R(e,t){var n,r,a,i=S(e,t);if(i.success===!1)return i;var l=e==null||(n=e.payload.integral)==null||(n=n.transport)==null||(n=n.ancillary)==null||(n=n.thumbnail)==null||(n=n.downloadableThumbnail)==null?void 0:n.objectId,s=e==null||(r=e.payload.integral)==null||(r=r.transport)==null||(r=r.integral)==null?void 0:r.mediaKeyTimestamp,u=e==null||(a=e.payload.integral)==null||(a=a.transport)==null||(a=a.integral)==null?void 0:a.mediaKey;return u==null?o("WAResultOrError").makeError("missing-media-key"):l!=null?o("WAResultOrError").makeResult([i.value,{mediaKey:o("WAMediaUtils").castToMediaKey(u),objectId:o("WAMediaUtils").stringToDeliveryObjectId(l),serverMediaType:"preview",timestamp:s!=null?o("WATimeUtils").castLongIntToUnixTime(s):null}]):o("WAResultOrError").makeResult([i.value])}l.ProbeXmaType=_,l.sampleProbeMediaRestoreV2=C}),98);
__d("MAWMPSCreateBackupDirective",["EBLogger","MpsMessageToBridgeWrapper","MpsTypes","WAStanzaUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=o("EBLogger").EBLogger().tags(["mps"]);function s(t){switch(t){case o("MpsTypes").ActionType.UpsertTopLevel:return 1;case o("MpsTypes").ActionType.UpsertSupplemental:return 2;case o("MpsTypes").ActionType.DeleteTopLevel:return 3;case o("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder:return 4;case o("MpsTypes").ActionType.DeleteSupplemental:case o("MpsTypes").ActionType.Preprocess:case o("MpsTypes").ActionType.Noop:case o("MpsTypes").ActionType.DeleteThread:case o("MpsTypes").ActionType.Unknown:return e.warn("Action type %d not supported on EB upload",t),0}}function u(t,n){var r=s(t.actionType);if(r===0){e.warn("Unknown EB upload action type - cannot upload message");return}var o={actionType:r,originalMsgProtocolId:n};return t.supplementalKey!=null&&(o=babelHelpers.extends({},o,{supplementalKey:t.supplementalKey})),o}function c(e,t){var n=o("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(t);return{author:n.getAuthor(),chat:n.getChatJid(),externalId:o("WAStanzaUtils").toStanzaId(e.targetMessageId)}}l.createBackupDirectiveFromMPSMessage=u,l.getTargetProtocolMsgIdForMessage=c}),98);
__d("EncryptedBackupsUploadQueueV3",["EncryptedBackupsMediaRestoreProbeV2","FBLogger","MAWEBSwitch","MAWMPSCreateBackupDirective","MAWProtobufDeserializers","MpsTypes","WAJids","WAStanzaUtils","WATimeUtils","WormPersistedQueue","WormPersistedQueueSchema"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n){return o("WormPersistedQueueSchema").toWormPersistedQueueId(e+"."+t+"."+n.toString())}function u(e){var t=e.directive,n=e.insertionSource,a=e.message,i=o("WATimeUtils").millisTime(),l=o("MAWMPSCreateBackupDirective").getTargetProtocolMsgIdForMessage(t,a),u=o("MAWMPSCreateBackupDirective").createBackupDirectiveFromMPSMessage(t,l);if(u==null)throw r("FBLogger")("wmi").mustfixThrow("invalid-protobuf-no-backup-directive");var c=n===o("MpsTypes").InsertionSource.Send?"upload-sent-message":n===o("MpsTypes").InsertionSource.Receive?"upload-received-message":(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+n)})();return babelHelpers.extends({},a,{addedAtMs:i,attemptCount:0,backupDirective:u,debugInfo:{isRetroactive:!r("MAWEBSwitch").isEnabled(),triggerSource:c},queueId:s(a.messageId,a.threadId,i)})}var c=function(){return r("FBLogger")("wmi").tags(["eb_upload","upload_queue_v3"])},d=null;function m(){return d==null&&(d=new(o("WormPersistedQueue")).WormPersistedQueue("ebUploadQueueV3")),d}function p(t){var n;if(t.backupDirective.actionType===1){var r=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(t.payload);o("EncryptedBackupsMediaRestoreProbeV2").sampleProbeMediaRestoreV2({backupMessage:r,chatJid:o("WAJids").unsafeCoerceToChatJid(t.threadId),sortOrderMs:t.timestampMs,stanzaId:o("WAStanzaUtils").toStanzaId(t.messageId),triggerSource:(n=t.debugInfo.triggerSource)!=null?n:"unknown"}).catch(function(t){c().MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Unexpected runtime error in probeMediaRestoreV2: ",""])),t)})}}l.uploadEntityFromIncomingPayload=u,l.getUploadQueue=m,l.queryMediaRestoreProbe=p}),98);
__d("WAGetHashFromProtocolMsgId",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e.externalId+"_"+e.author+"_"+e.chat}i.getHashFromProtocolMsgId=e}),66);
__d("MAWEBUploadTrackingUtils",["MAWAckLevel","MAWEBSwitch","MAWExternalId","MAWMsgType","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBODSUtils","ODS","QPLUserFlow","QuickPerformanceLogger","WACommsConnectionState","WAExceededStorageQuota","WAGetHashFromProtocolMsgId","WAGlobals","WAHashStringToNumber","gkx","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u={ERROR_FETCHING_DB_MESSAGE:"error_fetching_db_message",FAILED_TO_ACK_MESSAGE:"failed_to_ack_message",FAILED_TO_CONSTRUCT_ECHO_MESSAGE:"failed_to_construct_echo_message",MESSAGE_UPLOAD_TIMEOUT:"message_upload_timeout",RUNTIME_ERROR:"runtime_error"};function c(e,t,n,a,i,l,u,c,d,m){var _;if(l===void 0&&(l=!1),u===void 0&&(u=!1),d===void 0&&(d="unknown"),m===void 0&&(m=0),!!r("MAWEBSwitch").isEnabled()){r("QPLUserFlow").start(r("qpl")._(521481602,"829"),{annotations:{bool:{eb_switch:r("MAWEBSwitch").isEnabled(),eb_upload_queue:!0,fromUploadQueue:l,is_retroactive_upload:u,is_unified_attachment_upload:!0,is_wasm_serializer_on:r("gkx")("18428"),middleware_init:!1},int:{attachmentsSize:(_=c==null?void 0:c.attachmentInfos.length)!=null?_:0,instanceKey:i,retryCount:m},string:{comms_status:o("WACommsConnectionState").WACommsConnectionState.isConnected()===!0?"connected":"disconnected",externalId:e,msgType:n,payloadType:d,threadId:t,triggerType:a,userJid:o("WAGlobals").getMyUserJid()},string_array:{attachment_trace_ids:c==null?void 0:c.attachmentInfos.map(function(e){var t;return(t=e.attachmentTraceId)!=null?t:"null"}),media_types:c==null?void 0:c.attachmentInfos.map(function(e){return e.mediaType})}},instanceKey:i,timeoutInMs:r("justknobx")._("1405")}),p(i,"upload_tracking_started"),(s||(s=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,r("MWEBODSEntityKey.enum").START),o("MWEBODSUtils").markODSForEB(r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload."+(n!=null?n:"unknown"));var f=o("MAWMsgType").isMAWSupportedMediaType(n!=null?n:"Text")?"media":"non-media";o("MWEBODSUtils").markODSForEB(r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload."+f)}}function d(e){return e==null?{string:{comms_status_on_failure:o("WACommsConnectionState").WACommsConnectionState.isConnected()===!0?"connected":"disconnected"}}:babelHelpers.extends({},e,{string:babelHelpers.extends({},e.string,{comms_status_on_failure:o("WACommsConnectionState").WACommsConnectionState.isConnected()===!0?"connected":"disconnected"})})}function m(e,t,n,r){switch(e){case"success":h(t,n,r);break;case"fail":g(t,n,r);break;case"point":p(t,n,r);break}}function p(e,t,n){n&&r("QPLUserFlow").addAnnotations(r("qpl")._(521481602,"829"),n,{instanceKey:e}),r("QPLUserFlow").addPoint(r("qpl")._(521481602,"829"),t,{instanceKey:e})}function _(e,t){r("QPLUserFlow").addAnnotations(r("qpl")._(521481602,"829"),t,{instanceKey:e})}function f(e,t){var n;r("QPLUserFlow").addAnnotations(r("qpl")._(521481602,"829"),d(t),{instanceKey:e}),r("QPLUserFlow").endCancel(r("qpl")._(521481602,"829"),{annotations:{bool:{exceededStorageQuota:o("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{threadID:t==null||(n=t.string)==null?void 0:n.jid}},instanceKey:e}),(s||(s=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,r("MWEBODSEntityKey.enum").CANCEL)}function g(e,t,n){var a;r("QPLUserFlow").addAnnotations(r("qpl")._(521481602,"829"),d(n),{instanceKey:e}),r("QPLUserFlow").endFailure(r("qpl")._(521481602,"829"),t,{annotations:{bool:{exceededStorageQuota:o("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{threadID:n==null||(a=n.string)==null?void 0:a.jid}},instanceKey:e}),(s||(s=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,r("MWEBODSEntityKey.enum").FAIL)}function h(e,t,n){p(e,t),y(e,n)}function y(e,t){t&&r("QPLUserFlow").addAnnotations(r("qpl")._(521481602,"829"),t,{instanceKey:e}),r("QPLUserFlow").endSuccess(r("qpl")._(521481602,"829"),{annotations:{bool:{exceededStorageQuota:o("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},instanceKey:e}),(s||(s=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,r("MWEBODSEntityKey.enum").SUCCESS)}function C(e,t,n){var a;p(e,t),n&&r("QPLUserFlow").addAnnotations(r("qpl")._(521481602,"829"),n,{instanceKey:e}),r("QPLUserFlow").endTimeout(r("qpl")._(521481602,"829"),{annotations:{bool:{exceededStorageQuota:o("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{threadID:n==null||(a=n.string)==null?void 0:a.jid}},instanceKey:e}),(s||(s=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,r("MWEBODSEntityKey.enum").TIMEOUT)}function b(t,n,o){var a=r("qpl")._(521481602,"829");p(t,n),o&&(e||(e=r("QuickPerformanceLogger"))).markerAnnotate(a,o,{instanceKey:t}),(e||(e=r("QuickPerformanceLogger"))).markerEnd(a,52,t,e.currentTimestamp())}function v(){return o("WAHashStringToNumber").hashStringToNumber(o("MAWExternalId").generateExternalId())}function S(e,t){return t===void 0&&(t=0),o("WAHashStringToNumber").hashStringToNumber(o("WAGetHashFromProtocolMsgId").getHashFromProtocolMsgId(e)+"_"+o("WAGlobals").getMyDeviceJid()+"_"+t)}function R(e){return r("MAWEBSwitch").isEnabled()&&o("MAWMsgType").isEBSupportedMsgType(e.type)&&e.ack>=o("MAWAckLevel").ACK.sent&&e.serverTs!=null&&!(e.ephemeralSetting!=null&&e.ephemeralSetting.ephemeralExpirationInSec>0)}function L(e){return{addAnnotations:function(n){_(e,n)},addPoint:function(n,r){p(e,n,r)},endCancel:function(n,r){f(e,r)},endFail:function(n,r){g(e,n,r)},endSuccess:function(n){y(e,n)},getQPLAttrs:function(){return{instanceKey:e}},isActive:function(){return!0},start:function(){}}}function E(e,t){return e.get(t)}function k(e,t,n,r,o){var a=E(t,n);if(a!=null)switch(e){case"success":h(a,r,o);break;case"fail":g(a,r,o);break;case"point":p(a,r,o);break}}l.EBUploadTrackingWorkerFailurePoints=u,l.startUploadTracking=c,l.handleBridgeEbUploadTrackingQPL=m,l.addPointWorkerOnly=p,l.addAnnotationsWorkerOnly=_,l.endCancelWorkerOnly=f,l.endFailWorkerOnly=g,l.endSuccessWorkerOnly=h,l.endTimeoutWorkerOnly=C,l.endRetryWorkerOnly=b,l.genInstanceKeyOnly=v,l.genInstanceKeyForUploadQueue=S,l.isUploadSupported=R,l.makeEBWorkerQplFlowFromInstanceKey=L,l.getUploadTrackingInstanceKey=E,l.addUploadTrackingByType=k}),98);
__d("EncryptedBackupsUploadQueueV3Scheduler",["EBGenerateMessageTags","EBMessageProbe","EBUploadMessagesFromWorkerMutationDeferred","EncryptedBackupsCreateAttachmentContext","EncryptedBackupsUploadEntity","EncryptedBackupsUploadQueueV3","FBLogger","I64","MAWBridgeUpload","MAWEBLSInWorkerSwitch","MAWEBUploadTrackingUtils","MAWProtobufValidator","MWEBODSUtils","QPLFlow","WACommsConnectionState","WAGlobals","WAHashStringToNumber","WAJids","WAStanzaUtils","WATimeUtils","WAWaitForUserUnblocked","WorkerScheduler","getErrorSafe","justknobx","performanceAbsoluteNow","qpl","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g=function(){return r("FBLogger")("wmi").tags(["eb_upload","upload_queue_v3_scheduler"])},h=null;function y(){return h!==null}var C;function b(){return C}var v={concurrency:1,maxTaskLimit:1,maxThrottleMs:r("justknobx")._("1453"),timeoutMs:r("justknobx")._("1460")};function S(){r("MAWEBLSInWorkerSwitch").onSet(function(e){e===!0&&R()}),o("WACommsConnectionState").WACommsConnectionState.onSet(function(e){e===!0&&R()}),o("EncryptedBackupsUploadQueueV3").getUploadQueue().subscribe(function(e){e.type==="new_entities"&&R()}),R()}async function R(){if(h!=null){g().DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["EB Upload is already running"])));return}await o("WAWaitForUserUnblocked").waitForUserUnblocked();var t=o("QPLFlow").startQPLFlow(r("qpl")._(521475028,"909"));if(!r("MAWEBLSInWorkerSwitch").isEnabled()){g().DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["EB is not enabled"]))),t.addPoint("eb_disabled"),t.endSuccess();return}if(!o("WACommsConnectionState").WACommsConnectionState.isConnected()){g().DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["WAComms connection is not established"]))),t.addPoint("wa_comms_not_connected"),t.endSuccess();return}h=o("WorkerScheduler").makeScheduler("EncryptedBackupsUploadQueueV3",v).task({fn:function(){return L(t)},name:"eb_upload_queue_v3",priority:o("WorkerScheduler").BACKGROUND_PRIORITY});try{var n=await h.run();h=null,n&&R()}catch(e){h=null;var a=r("getErrorSafe")(e);g().FATAL(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Runtime error during EB upload run: ",""])),a.message),t.endFail("runtime_error"),R()}}async function L(e){var t=[],n=0,a=0,i=await o("EncryptedBackupsUploadQueueV3").getUploadQueue().readFromIndex("[attemptCount+addedAtMs]",{filter:function(i){return Date.now()-i.timestampMs>o("WATimeUtils").DAY_MILLISECONDS*30?(t.push(i.queueId),n++,!1):o("MAWProtobufValidator").isProtobufValid(i.payload)?i.attemptCount<r("justknobx")._("1596"):(t.push(i.queueId),a++,!1)},limit:r("justknobx")._("1676"),order:"asc"});if(e.addPoint("retrieved_entries",{int:{entriesCount:i.length}}),t.length>0&&(await o("EncryptedBackupsUploadQueueV3").getUploadQueue().delete(t),e.addPoint("deleted_invalid_entries",{int:{expiredEntryCount:n,invalidProtobufEntryCount:a}})),i.length===0)return e.endSuccess(),t.length>0;g().DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["upload queue uploading "," messages"])),i.length);var l=[],s=[];for(var u of i){var c;o("EBMessageProbe").EBMessageProbe.getInstance().addMarkerToItem(u.messageId,"message_picked_from_queue",{is_retroactive:u.debugInfo.isRetroactive||!1,trigger_source:"upload-message-from-mps"});var _=o("WAHashStringToNumber").hashStringToNumber(r("uuidv4")()),h=T(u,_);l.push(h),s.push(_),o("MAWEBUploadTrackingUtils").startUploadTracking(o("WAStanzaUtils").toStanzaId(u.messageId),o("WAJids").threadIdForChatJid(o("WAJids").unsafeCoerceToChatJid(u.threadId)),void 0,(c=u.debugInfo.triggerSource)!=null?c:"unknown",_,!0,u.debugInfo.isRetroactive||!1,h.attachmentBackupContext,"protobuf_only",u.attemptCount);var y=/^\d*$/.test(h.messageId);if(o("MAWEBUploadTrackingUtils").addAnnotationsWorkerOnly(_,{bool:{message_id_valid:y}}),!y){var b;g().MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Invalid message OTID: ",""])),h.messageId),o("MWEBODSUtils").markODSForEB("upload",((b=u.debugInfo.triggerSource)!=null?b:"unknown")+".invalid_otid")}}e.addPoint("generated_bridge_upload_messages"),s.forEach(function(e){return o("MAWEBUploadTrackingUtils").addPointWorkerOnly(e,"fire_protobuf_only_upload_bridge_event")});try{var v=await o("EBUploadMessagesFromWorkerMutationDeferred").uploadMessagesFromWorker(l,"EncryptedBackupsUploadQueueV3");if(e.addPoint("received_upload_response"),v.success){for(var S of i)o("EBMessageProbe").EBMessageProbe.getInstance().addMarkerToItem(S.messageId,"message_uploaded_via_graphql",{action_type:S.backupDirective.actionType,upload_type:"protobuf_only"}),o("EncryptedBackupsUploadQueueV3").queryMediaRestoreProbe(S);await E(i,s),C=(f||(f=r("performanceAbsoluteNow")))(),e.endSuccess()}else if(await k(i,s,v.error,!0),e.endFail(v.error),v.error==="user_device_not_enrolled")return!1}catch(t){var R=r("getErrorSafe")(t);g().MUSTFIX(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Runtime error when doing GraphQL upload, ",""])),R.message),await k(i,s,R.message,!0),e.endFail("graphql_runtime_error")}return!0}function E(e,t){return t.forEach(function(e){return o("MAWEBUploadTrackingUtils").endSuccessWorkerOnly(e,"upload_queue_ack_worker_success")}),o("EncryptedBackupsUploadQueueV3").getUploadQueue().ack(e.map(function(e){return e.queueId}))}async function k(e,t,n,r){if(t.forEach(function(e){return o("MAWEBUploadTrackingUtils").endFailWorkerOnly(e,"upload_queue_ack_worker_"+(r?"retriable":"non_retriable")+"_error",{string:{error_description:o("MAWEBUploadTrackingUtils").EBUploadTrackingWorkerFailurePoints.FAILED_TO_ACK_MESSAGE,reason:n}})}),r){await o("EncryptedBackupsUploadQueueV3").getUploadQueue().put(e.map(function(e){return babelHelpers.extends({},e,{attemptCount:e.attemptCount+1})}));return}await o("EncryptedBackupsUploadQueueV3").getUploadQueue().ack(e.map(function(e){return e.queueId}))}var I=o("WAJids").createJidUtils({platform:"msgr"});function T(e,t){var n=e.backupDirective.actionType===3?e.backupDirective.originalMsgProtocolId.externalId:o("WAStanzaUtils").toStanzaId(e.messageId),r=I.toUserJid(e.senderId),a=o("WAJids").unsafeCoerceToChatJid(e.threadId),i=r===o("WAGlobals").getMyUserJid()?o("WAJids").AUTHOR_ME:r,l={author:i,chat:a,externalId:n},s=o("EncryptedBackupsCreateAttachmentContext").createAttachmentContext(o("EncryptedBackupsUploadEntity").toEbBackupMessageBytes(e.payload)),u=o("MAWBridgeUpload").createBridgeUploadAttachmentBackupContext(void 0,"msgr",s),c=s.map(function(e){return o("EBGenerateMessageTags").generateEBMessageTags(e.mediaType)}).filter(Boolean);return{actionType:e.backupDirective.actionType===3?2:1,attachmentBackupContext:u,authTs:void 0,echoDocument:void 0,echoEncodingLatencyNs:void 0,errorCode:void 0,errorMessage:void 0,messageId:e.backupDirective.originalMsgProtocolId.externalId,messageType:void 0,protoMsg:{backupActionType:e.backupDirective.actionType,msgId:l,originalMsgProtocolId:e.backupDirective.originalMsgProtocolId,protobuf:o("EncryptedBackupsUploadEntity").toEbBackupMessageBytes(e.payload),senderId:(_||(_=o("I64"))).of_string(o("WAJids").userIdFromJid(r)),serverTs:o("WATimeUtils").castMilliSecondsToUnixTime(e.timestampMs),sortOrderMs:o("WATimeUtils").castToMillisTime(e.timestampMs),supplementalKey:e.backupDirective.supplementalKey,tags:c},sortOrderMs:e.timestampMs,threadId:o("WAJids").threadIdForChatJid(a),traceId:t.toString(),uploadTrackingInstanceKey:t}}l.isUploadTaskScheduled=y,l.getLastSuccessfulAckTimestampMs=b,l.subscribeToUploadQueueUpdates=S}),98);
__d("EBMessageProbeSamplingPreprocessor",["EBMessageProbe","FBLogger","MAWEBLSInWorkerSwitch","MAWProtobufDeserializers","MpsPreprocessor","MpsTypes","WAJids","WATimeUtils","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e==="deleteForMe"||e==="revoked"}function s(e){var t,n=e.insertionSource,a=e.message,i=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(a.payload),l=(t=i.proto.metadata)==null?void 0:t.timestampMs,s=l!=null?Number(l):a.timestampMs,d=c(i),m=o("WAJids").unsafeCoerceToChatJid(a.threadId),p=a.messageId;if(d==="revoked"){var _=u(i);if(_==null)return r("FBLogger")("wmi_eb").mustfix("Revoked message missing original message ID, skipping sampling"),null;p=_}return{chatJid:m,insertionSource:String(n),markers:[],messageId:p,messageType:d!=null?d:"unknown",timestampMs:o("WATimeUtils").castToMillisTime(s)}}function u(e){var t,n=e.payload();if((n==null?void 0:n.kind)!=="messageApplication")return null;var r=n.subProtocol();if((r==null?void 0:r.kind)!=="consumerApplication")return null;var a=(t=r.payload)==null||(t=t.applicationData)==null||(t=t.revoke)==null||(t=t.key)==null?void 0:t.id;return a!=null?o("MpsTypes").toMessageId(a):null}function c(e){var t=e.payload();return(function(e){if((typeof e=="object"&&e!==null||typeof e=="function")&&e.kind==="transportEvent"||(typeof e=="object"&&e!==null||typeof e=="function")&&e.kind==="adminMessage"||(typeof e=="object"&&e!==null||typeof e=="function")&&e.kind==="locallyTransformedMessage")return"unsupported";if((typeof e=="object"&&e!==null||typeof e=="function")&&e.kind==="messageApplication"){var t=e;return(function(e){if((typeof e=="object"&&e!==null||typeof e=="function")&&e.kind==="consumerApplication"){var t=e;return m(t)}if((typeof e=="object"&&e!==null||typeof e=="function")&&e.kind==="armadillo"){var n=e;return d(n)}if(e===void 0)return"unsupported";throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})(t.subProtocol())}throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})(t)}function d(e){var t,n=(t=e.payload)==null?void 0:t.content;return(n==null?void 0:n.extendedContentMessage)!=null?"xma":"unsupported"}function m(e){var t,n,r,o=(t=e.payload)==null?void 0:t.content,a=(n=e.payload)==null?void 0:n.applicationData;if((a==null?void 0:a.revoke)!=null)return"revoked";if((o==null?void 0:o.messageText)!=null)return"text";if((o==null?void 0:o.reactionMessage)!=null)return"reaction";if((o==null?void 0:o.editMessage)!=null)return"edit";if(((r=e.attachmentMessage())==null||(r=r.payload)==null||(r=r.ancillary)==null?void 0:r.gifPlayback)===!0)return"gif";var i=e.attachmentMessage();return i!=null?i.kind==="imageTransport"?"image":i.kind==="audioTransport"?"audio":i.kind==="videoTransport"?"video":i.kind==="documentTransport"?"document":i.kind==="stickerTransport"?"sticker":(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+i.kind)})():"unsupported"}function p(t){return e(t)?r("gkx")("7963"):!0}function _(e){try{var t=s(e);if(t==null||!p(t.messageType))return null;var n=o("EBMessageProbe").getEBMessageProbeInstance();return n.sample(t),n.hasStarted()||n.start(),null}catch(e){return r("getErrorSafe")(e)}}function f(e){return e===o("MpsTypes").ActionType.UpsertTopLevel||e===o("MpsTypes").ActionType.DeleteTopLevel||e===o("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder||e===o("MpsTypes").ActionType.DeleteSupplemental}var g=o("MpsPreprocessor").preprocessor(function(e){var t=e.ctx,n=e.payloadList;return r("MAWEBLSInWorkerSwitch").isEnabled()?n.forEach(function(e){if(f(e.directive.actionType)&&!e.directive.isLocalOnly){var t=_(e);t!=null&&r("FBLogger")("wmi_eb").warn("Failed to sample message for probe: %s",t.message)}}):t.messageToQpl.all().addPoint("eb_message_probe_sampling_skipped"),{ctx:t,errors:new Map,payloadList:n}},"eb_message_probe_sampling");l.isDeleteMessageType=e,l.EBMessageProbeSamplingPreprocessor=g}),98);
__d("EBSenderUploadQueue",["EBMinosLogger","PersistedQueueApi","WAPersistedQueue"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(t){return t},c=null;function d(){return c==null?m():c}function m(){c!=null&&o("EBMinosLogger").minosLogger.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["EB Upload Queue is already initialized"])));var t=o("WAPersistedQueue").initPersistedQueue("ebSenderUploadQueueV3",o("PersistedQueueApi").persistedQueueApi());return c=t,t}async function p(e){if(e.length===0)return Promise.resolve();try{var t=d();await t.addAndCommit(e)}catch(e){return o("EBMinosLogger").minosLogger.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to write to ebSenderUploadQueue ",""])),e),Promise.reject(e)}}l.toSendersQueueId=u,l.ebSenderUploadQueue=d,l.enqueueMessages=p}),98);
__d("EBWorkerEBDBApi",["EBDB","EBDBConsistencyApi","EBLS","LSAuthorityLevel","LSEncryptedBackupsBackupTenancy","WALogger","WAResolvable"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new(o("WAResolvable")).Resolvable;async function u(){var t=await o("EBLS").genLSClient();try{await o("EBDBConsistencyApi").startListeningDeviceRegistrations(t.db,o("EBDB").EBDBEnvironment.Worker)}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Error on EBDB init in Worker: ",""])),t)}finally{s.resolve(t.db)}}async function c(e){await o("EBDBConsistencyApi").trackOverprompting(o("EBDB").EBDBEnvironment.Worker,e)}async function d(e){var t=await s.promise;await o("EBDBConsistencyApi").addNewDevice(t,o("EBDB").EBDBEnvironment.Worker,e)}async function m(e){var t=await s.promise;return o("EBDBConsistencyApi").trackConsistency(t,o("EBDB").EBDBEnvironment.Worker,e),o("EBDBConsistencyApi").getDeviceId()}async function p(){var e=await o("EBDB").getEBDB(),t=await e.store("secure_encrypted_backups_client_state").readAll();return t[0]}async function _(){var e=await o("EBDB").getEBDB(),t=await e.store("secure_encrypted_backups_client_state").readAll();if((t==null?void 0:t.length)===0)return!1;var n=t[0],a=n.authorityLevel,i=n.backupTenancy;if(a==null)return!1;var l=i!=null?i:r("LSEncryptedBackupsBackupTenancy").PRODUCTION;return Number(l)===r("LSEncryptedBackupsBackupTenancy").PRODUCTION&&Number(a)===r("LSAuthorityLevel").AUTHORITATIVE}l.startListeningEBDeviceRegistrations=u,l.trackOverprompting=c,l.addNewDevice=d,l.trackConsistency=m,l.getSecureEBClientState=p,l.isEBEnabledEBDB=_}),98);
__d("EncryptedBackupTaskFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5725"),s=o("FalcoLoggerInternal").create("encrypted_backup_task_failure",e),u=s;l.default=u}),98);
__d("EncryptedBackupTaskIssuedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5726"),s=o("FalcoLoggerInternal").create("encrypted_backup_task_issued",e),u=s;l.default=u}),98);
__d("LSWriteSupplementalMessage",["LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][writeSupplementalMessage] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.filter(t.db.table(302).fetch(),function(t){return t.threadId===e[1]&&t.toplevelOfflineThreadingId===e[2]&&t.supplementalKey===e[3]}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[2]=void 0:(t=o.item,r[2]=t.messageTimestampMs)})},function(n){return t.i64.neq(r[2],void 0)?t.sequence([function(n){var o;return t.i64.gt(r[2],e[5])?t.resolve((o=[!1,t.i64.cast([0,851])],r[12]=o[0],r[13]=o[1],o)):t.sequence([function(n){return t.forEach(t.filter(t.db.table(302).fetch(),function(t){return t.threadId===e[1]&&t.toplevelOfflineThreadingId===e[2]&&t.supplementalKey===e[3]}),function(e){return e.delete()})},function(n){return t.db.table(302).add({pk:void 0,messagePayload:e[0],threadId:e[1],toplevelOfflineThreadingId:e[2],supplementalKey:e[3],offlineThreadingId:e[4],messageTimestampMs:e[5]})},function(e){var t;return t=[!0,void 0],r[12]=t[0],r[13]=t[1],t}])},function(e){var t;return t=[r[12],r[13]],r[4]=t[0],r[5]=t[1],t}]):t.sequence([function(n){return t.forEach(t.filter(t.db.table(302).fetch(),function(t){return t.threadId===e[1]&&t.toplevelOfflineThreadingId===e[2]&&t.supplementalKey===e[3]}),function(e){return e.delete()})},function(n){return t.db.table(302).add({pk:void 0,messagePayload:e[0],threadId:e[1],toplevelOfflineThreadingId:e[2],supplementalKey:e[3],offlineThreadingId:e[4],messageTimestampMs:e[5]})},function(e){var t;return t=[!0,void 0],r[4]=t[0],r[5]=t[1],t}])},function(e){return r[6]=t.i64.of_float(Date.now()),r[7]=t.i64.random(),r[9]="Finishing execution. Execution time: ",r[10]=t.i64.to_string(t.i64.sub(r[6],r[0])),r[11]=" ms",r[8]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][writeSupplementalMessage] ",r[8],r[9],r[8],r[10],r[8],r[11]].join("")),t.i64.eq(t.i64.mod_(r[7],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[12]=",",r[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"writeSupplementalMessage",[r[9],r[12],r[10],r[12],r[11]].join(""),r[13],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[4],r[5]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMPSWriteSupplementalMessageStoredProcedure",e.__tables__=["local_message_persistence_store_supplemental"],a.exports=e}),null);
__d("LSWriteSupplementalMessageStoredProcedure",["LSSynchronousPromise","LSWriteSupplementalMessage","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSWriteSupplementalMessage"),a.messagePayload,a.threadId,a.toplevelOfflineThreadingId,a.supplementalKey,a.offlineThreadingId,a.messageTimestampMs);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSWriteTopLevelMessage",["LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(n){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][writeTopLevelMessage] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.filter(t.db.table(301).fetch(),function(t){return t.threadId===e[1]&&t.offlineThreadingId===e[2]}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[2]=void 0:(t=o.item,r[2]=t.messageTimestampMs)})},function(n){return t.i64.neq(r[2],void 0)?t.sequence([function(n){var o;return t.i64.gt(r[2],e[3])?t.resolve((o=[!1,t.i64.cast([0,851])],r[12]=o[0],r[13]=o[1],o)):t.sequence([function(n){return t.filter(t.db.table(303).fetch(),function(t){return t.threadId===e[1]&&t.offlineThreadingId===e[2]}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[14]=!1:(t=o.item,r[14]=!0)})},function(n){return r[14]?t.sequence([function(n){return t.forEach(t.filter(t.db.table(303).fetch(),function(t){return t.threadId===e[1]&&t.offlineThreadingId===e[2]}),function(t){var n=t.update,r=t.item;return n({deletedMessagePayload:e[0],isLocalOnlyMessage:e[4],messageTimestampMs:e[3]})})},function(n){return t.forEach(t.filter(t.db.table(301).fetch(),function(n){return n.threadId===e[1]&&n.offlineThreadingId===e[2]&&t.i64.eq(n.messageTimestampMs,t.i64.cast([-1,4294967295]))}),function(t){var n=t.update,r=t.item;return n({messageTimestampMs:e[3]})})},function(e){var n;return n=[!1,t.i64.cast([0,852])],r[16]=n[0],r[17]=n[1],n}]):t.sequence([function(n){return t.forEach(t.filter(t.db.table(301).fetch(),function(t){return t.threadId===e[1]&&t.offlineThreadingId===e[2]}),function(e){return e.delete()})},function(n){return t.db.table(301).add({pk:void 0,messagePayload:e[0],threadId:e[1],offlineThreadingId:e[2],messageTimestampMs:e[3],isLocalOnlyMessage:e[4],extraData:e[5]})},function(e){var t;return t=[!0,void 0],r[16]=t[0],r[17]=t[1],t}])},function(e){var t;return t=[r[16],r[17]],r[12]=t[0],r[13]=t[1],t}])},function(e){var t;return t=[r[12],r[13]],r[4]=t[0],r[5]=t[1],t}]):t.sequence([function(n){return t.filter(t.db.table(303).fetch(),function(t){return t.threadId===e[1]&&t.offlineThreadingId===e[2]}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[12]=!1:(t=o.item,r[12]=!0)})},function(n){return r[12]?t.sequence([function(n){return t.forEach(t.filter(t.db.table(303).fetch(),function(t){return t.threadId===e[1]&&t.offlineThreadingId===e[2]}),function(t){var n=t.update,r=t.item;return n({deletedMessagePayload:e[0],isLocalOnlyMessage:e[4],messageTimestampMs:e[3]})})},function(n){return t.forEach(t.filter(t.db.table(301).fetch(),function(n){return n.threadId===e[1]&&n.offlineThreadingId===e[2]&&t.i64.eq(n.messageTimestampMs,t.i64.cast([-1,4294967295]))}),function(t){var n=t.update,r=t.item;return n({messageTimestampMs:e[3]})})},function(e){var n;return n=[!1,t.i64.cast([0,852])],r[14]=n[0],r[15]=n[1],n}]):t.sequence([function(n){return t.forEach(t.filter(t.db.table(301).fetch(),function(t){return t.threadId===e[1]&&t.offlineThreadingId===e[2]}),function(e){return e.delete()})},function(n){return t.db.table(301).add({pk:void 0,messagePayload:e[0],threadId:e[1],offlineThreadingId:e[2],messageTimestampMs:e[3],isLocalOnlyMessage:e[4],extraData:e[5]})},function(e){var t;return t=[!0,void 0],r[14]=t[0],r[15]=t[1],t}])},function(e){var t;return t=[r[14],r[15]],r[4]=t[0],r[5]=t[1],t}])},function(e){return r[6]=t.i64.of_float(Date.now()),r[7]=t.i64.random(),r[9]="Finishing execution. Execution time: ",r[10]=t.i64.to_string(t.i64.sub(r[6],r[0])),r[11]=" ms",r[8]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][writeTopLevelMessage] ",r[8],r[9],r[8],r[10],r[8],r[11]].join("")),t.i64.eq(t.i64.mod_(r[7],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[12]=",",r[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"writeTopLevelMessage",[r[9],r[12],r[10],r[12],r[11]].join(""),r[13],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[4],r[5]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMPSWriteTopLevelMessageStoredProcedure",e.__tables__=["local_message_persistence_store","local_message_persistence_store_deleted_messages"],a.exports=e}),null);
__d("LSWriteTopLevelMessageStoredProcedure",["LSSynchronousPromise","LSWriteTopLevelMessage","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSWriteTopLevelMessage"),a.messagePayload,a.threadId,a.offlineThreadingId,a.messageTimestampMs,a.isLocalOnlyMessage,a.extraData);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MessageBackupTagsDelimiter",[],(function(t,n,r,o,a,i){"use strict";var e=":";i.INSTAMADILLO_TAG_DELIMITER=e}),66);
__d("EncryptedBackupsWriteToMPSTables",["EncryptedBackupsUploadEntity","FBLogger","I64","IGDWEBUploadMessageUtils","LSFactory","LSWriteSupplementalMessageStoredProcedure","LSWriteTopLevelMessageStoredProcedure","MessageBackupTagsDelimiter","WAErrorMessage","WAResultOrError","getSafeQplErrorMessage","promiseDone","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("ReverbWriteFailureFalcoEvent").__setRef("EncryptedBackupsWriteToMPSTables"),u=r("requireDeferred")("ReverbWriteSuccessFalcoEvent").__setRef("EncryptedBackupsWriteToMPSTables");function c(e,t,n,o,a,i){o?r("promiseDone")(u.load(),function(r){return r.log(function(){return{backup_action:n,backup_protocol:a,labyrinth_version:0,message_id:e,thread_id:t}})}):r("promiseDone")(s.load(),function(r){return r.log(function(){return{backup_action:n,backup_protocol:a,failure_reason:i,labyrinth_version:0,message_id:e,thread_id:t}})})}async function d(t,n,a,i,l){var s=n.backupActionType,u=n.instamadilloItemId,d=n.msgId,m=n.originalMsgProtocolId,p=n.protobuf,_=n.serverTs,f=n.sortOrderMs,g=n.supplementalKey;l==null||l.addPoint("mps_tables_write_start");var h=d.externalId,y=m==null?void 0:m.externalId,C=u!=null?u:f;if(C==null)return l==null||l.addPoint("mps_tables_write_missing_protobuf_ts"),o("WAResultOrError").makeError({errorCode:null,errorMsg:"protobufTimestampMs is null when writing to MPS tables"});var b=(e||(e=o("I64"))).of_float(C),v=!1,S=i?"dual_upload":"open_eb_ttlc",R=null;switch(s){case 1:{l==null||l.addPoint("mps_top_level_write_start");try{var L=await r("LSWriteTopLevelMessageStoredProcedure")(r("LSFactory")(t),{isLocalOnlyMessage:!1,messagePayload:o("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(p),messageTimestampMs:b,offlineThreadingId:h,threadId:a}),E=L[0],k=L[1];R=k,E&&(v=!0),c(h,a,"upsert_top_level",E,S),l==null||l.addPoint("mps_top_level_write",{bool:{mps_top_level_write_succesful:E}})}catch(e){c(h,a,"upsert_top_level",!1,S,o("WAErrorMessage").maybeGetMessageFromError(e)),l==null||l.addPoint("mps_top_level_write_error",{string:{mps_top_level_write_error:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)}})}break}case 2:{if(l==null||l.addPoint("mps_supplemental_write_start"),y==null||g==null)c(h,a,"upsert_supplemental",!1,S),r("FBLogger")("wmi_eb").warn("Missing toplevelOfflineThreadingId or supplementalKey when writing to MPS tables");else try{var I=await r("LSWriteSupplementalMessageStoredProcedure")(r("LSFactory")(t),{messagePayload:o("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(p),messageTimestampMs:b,offlineThreadingId:h,supplementalKey:g,threadId:a,toplevelOfflineThreadingId:y}),T=I[0],D=I[1];R=D,T&&(v=!0),c(h,a,"upsert_supplemental",T,S),l==null||l.addPoint("mps_supplemental_write",{bool:{mps_supplemental_write_successful:T}})}catch(e){c(h,a,"upsert_supplemental",!1,S,o("WAErrorMessage").maybeGetMessageFromError(e)),l==null||l.addPoint("mps_supplemental_write_error",{string:{mps_supplemental_write_error:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)}})}break}case 4:{if(l==null||l.addPoint("mps_delete_top_level_with_placeholder_write_start"),y==null)break;try{var x=await r("LSWriteTopLevelMessageStoredProcedure")(r("LSFactory")(t),{isLocalOnlyMessage:!1,messagePayload:o("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(p),messageTimestampMs:(e||(e=o("I64"))).of_float(o("IGDWEBUploadMessageUtils").generateProtobufServerTs(y,_)),offlineThreadingId:h,threadId:a}),$=x[0],P=x[1];R=P,$&&(v=!0),c(y,a,"delete_top_level",$,S),l==null||l.addPoint("mps_delete_top_level_with_placeholder_write",{bool:{mps_delete_top_level_with_placeholder_write_successful:$}})}catch(e){c(y,a,"delete_top_level_with_placeholder",!1,S,o("WAErrorMessage").maybeGetMessageFromError(e)),l==null||l.addPoint("mps_delete_top_level_with_placeholder_write_error",{string:{mps_delete_top_level_with_placeholder_write_error:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)}})}break}case 3:v=!0,y!=null&&c(y,a,"delete_top_level",!1,S);break;default:l==null||l.addPoint("mps_write_unsupported_backup_action_type"),r("FBLogger")("wmi_eb").warn("Unsupported backupActionType when writing to MPS tables")}return v?(l==null||l.addPoint("mps_write_successful"),o("WAResultOrError").makeResult(v)):(l==null||l.addPoint("mps_write_unsuccessful"),o("WAResultOrError").makeError({errorCode:R,errorMsg:"Unsuccessful writing to MPS tables"}))}async function m(t,n,r){var a=n.msgId,i=n.sortOrderMs,l=n.tags;l!=null&&l.length!==0&&i!=null&&await t.local_message_persistence_store_tag_index.put({localMessagePersistenceStoreKey:(e||(e=o("I64"))).of_string(a.externalId),messageTimestampMs:e.of_float(i),offlineThreadingId:a.externalId,tag:l.join(o("MessageBackupTagsDelimiter").INSTAMADILLO_TAG_DELIMITER),threadId:r})}l.writeToMPSTables=d,l.writeTagsToMPSTables=m}),98);
__d("LSEBPayloadSerializerError",[],(function(t,n,r,o,a,i){var e=Object.freeze({INVALID_BACKUP_OPERATION:-7,INVALID_CONTENT_TYPE:-6,INVALID_PAYLOAD_FORMAT:-5,CQL_DB_ERROR:-4,REQUIRED_COLUMN_NOT_PRESENT_ON_CLIENT:-3,DEPRECATED_SPROC:-2,UNKNOWN_ERROR:-1,NOT_AN_ERROR:0,BACKUP_NOT_FOUND:1,REQUIRED_TABLE_NOT_FOUND:2,NATIVE_OP_NOT_FOUND:3,BACKUP_UPLOAD_KILLSWITCHED:4,TASK_ID_NOT_FOUND:5,NOT_IMPLEMENTED:6,NOT_SUPPORTED_ON_WEB:7,DUPLICATE_TASK:8,CLIENT_STATE_NOT_LOADED:9,RECOVERY_CODE_NOT_FOUND:10,EPOCH_KEYS_NOT_FOUND:11,DEVICE_PAYLOAD_NOT_CREATED:12,NULL_DEVICE_PAYLOAD:13,EPOCH_PAYLOAD_NOT_CREATED:14,NULL_EPOCH_PAYLOAD:15,VIRTUAL_DEVICE_PAYLOAD_NOT_CREATED:16,NULL_VIRTUAL_DEVICE_PAYLOAD:17,DEVICE_METADATA_NOT_FOUND:18,NO_MATCHING_DEVICE_PUBLIC_KEY:19,NULL_MAILBOX_ROOT_KEY:20,NULL_ENCRYPTION_VERSION:21,NULL_OCMF_KEY:22,NULL_EPOCH_KEYS:23,NULL_DEVICE_ID:24,OPE_KEY_DERIVATION_FAILED:25,MESSAGE_KEY_DERIVATION_FAILED:26,NULL_MAILBOX_ROOT_KEY_V2:27,ECHO_DOCUMENT_ENCODING_FAILED:30,ECHO_PAYLOAD_CREATION_DISABLED:31,ECHO_DOCUMENT_ENCODING_SKIPPED:32,MESSAGE_PAYLOAD_ENCRYPTION_FAILED:40,SERVER_THREAD_ID_NOT_FOUND_FOR_JID:52,UNKNOWN_PROTOBUF_TYPE:60,SUPPLEMENTARY_DATA_KEY_UNEXPECTED:61,PROTOBUF_ENCRYPTION_FAILED:62,PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE:63,PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE:64,SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE:65,SUPPLEMENTAL_ENCRYPTION_FAILED:66,PROTOBUF_CONTEXT_ROW_NOT_FOUND:67,PROTOBUF_FORMATTING_FAILED:68,SUPPLEMENTAL_FORMATTING_FAILED:69,PROTOBUF_ALREADY_DELETED:70,PROTOBUF_NOT_FOUND_IN_DELETED_MESSAGES_TABLE:71,DELETION_PROTOBUF_IS_NULL:72,PROTOBUF_PAYLOAD_IN_CONTEXT_ROW_IS_NOT_FOUND:73,PROTOBUF_ENCRYPTION_FAILED_RETRYABLE:74,VALUE_SECRET_REF_INVALID:75,MINOS_ENCRYPTION_RESULT_NULL:76,SUPPLEMENTAL_OTID_NOT_SET_IN_CONTEXT_TABLE:77,SNAPSHOT_NOT_FOUND_FAILURE:78,THREAD_PK_NOT_FOUND_FOR_JID:100,MESSAGE_DECRYPTION_FAILED:101,EPOCH_KEY_FETCH_FAILED:102,TOO_MANY_OPEN_EPOCHS:103,MESSAGE_RANGE_PREPARE_FAILURE:104,ECHO_DOCUMENT_RESTORE_FAILED:105,MISMATCH_POINT_QUERY_MESSAGE_AND_RANGE_LENGTH:106,INITIAL_THREADS_FETCH_FOR_RESTORE_FAILED:107,MISSING_SUPPLEMENTAL_KEY_CIPHERTEXT:108,SUPPLEMENTAL_KEY_DECRYPTION_FAILURE:109,DEVICE_ID_MISMATCH:110,RESTORE_TO_TAM_INFO:111,MISSING_SERVER_THREAD_KEY:112,EB_ADD_DEVICE_FOUND_NO_LOCAL_THREADS:113,EB_MORE_THREADS_IN_MAPPING_TABLE:114,RESTORE_INTEGRITY_CHECK_FAILED:115,RESTORE_TOP_LEVEL_PROTOBUF_NULL:116,DECRYPT_MINOS_PROTOBUF_FAILURE:117,UNENCRYPTED_PROTOBUF_BASE64_DECODE_FAILURE:118,MESSAGE_PK_NOT_FOUND_IN_CLIENT_MESSAGES:200,OTID_NOT_FOUND_IN_ACT_MESSAGES:201,THREAD_ID_NOT_FOUND_IN_ACT_THREADS:202,THREAD_PK_NOT_FOUND_IN_CLIENT_THREADS:203,FAILED_TO_GET_THREAD_SORT_KEY:204,MEDIA_INFO_INVALID:205,REVERB_DB_NOT_ENABLED_FOR_INSTAMADILLO:206,SKIPPED_EB_DISABLED:300,SKIPPED_THREAD_NOT_ELIGIBLE:301,SKIPPED_MESSAGE_NOT_ELIGIBLE:302,NO_EPOCHS_FOUND:400,LATEST_EPOCH_QUERY_BY_ID_FAILED:401,FOUND_EPOCH_WITH_NULL_ROOT_KEY:402,FOUND_EPOCH_WITH_NULL_ANON_ID:403,NO_RECOVERY_CODE:501,NO_ERROR:601,ERROR_GENERAL:602,UNKNOWN:603,ONBOARDING_MATERIAL_DERIVATION_FAILURE:604,NULL_DEVICE_HMAC:605,MISSING_LATEST_EPOCH_AT_ONBOARDING:606,EPOCH_REPAIR_UNREACHABLE_EPOCH:607,NO_THREADS_TO_COMPARE:701,START_SORT_KEY_FAILURE:702,END_SORT_KEY_FAILURE:703,LOOPING_UPLOAD_PAYLOAD_NOT_FOUND:704,NULL_ECHO_IDENTIFIERS:705,ECHO_TIMESTAMP_CONVERSION_FAILED:706,ECHO_PROTOBUF_THREAD_ID_MISMATCH:707,ECHO_PROTOBUF_TIMESTAMP_MISMATCH:708,ECHO_PROTOBUF_OTID_MISMATCH:709,NULL_ECHO_DOCUMENT:710,INVALID_PROTOBUF_BACKUP_ACTION:711,EMPTY_ENCODED_ECHO_DOCUMENT:712,LOOPING_UPLOAD_TASK_QUEUE_FULL:713,ECHO_DOCUMENT_ENCODING_UNKNOWN_ENCODING_ERROR:750,ECHO_DOCUMENT_ENCODING_MESSAGE_PK_NOT_FOUND_ERROR:751,ECHO_DOCUMENT_ENCODING_DISK_WRITE_CHECK_FAILED:752,ECHO_DOCUMENT_ENCODING_THREAD_TRANSPORT_ID_FETCH_FAILED:753,ECHO_DOCUMENT_ENCODING_FILE_WRITE_FAILED:754,ECHO_DOCUMENT_ENCODING_DISK_WRITE_DISABLED:755,ECHO_DOCUMENT_ENCODING_SHOULD_NOT_PERSIST:756,MISSING_SUPPLEMENTAL_DATA:757,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_REPLY_PROXY_ERROR:758,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_EDIT_MESSAGE_QUERY_ERROR:759,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_EDIT_MESSAGE_ERROR:760,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_RECEIPTS_ERROR:761,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_REACTIONS_ERROR:762,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_VISUAL_MESSAGE_ACTIONS_ERROR:763,ECHO_DOCUMENT_ENCODING_MESSAGE_FIELDS_POLLS_ERROR:764,READ_CLIENT_STATE_FROM_MAIN_DB_ERROR:801,NOT_SUPPORTED_ON_MAIN_DB:802,SKIP_MPS_WRITE_DUE_TO_HIGHER_TIMESTAMP_AVAILABILITY:851,MESSAGE_ALREADY_DELETED:852});i.default=e}),66);
__d("MAWTraceUtils",["LSDataTraceTag","LSRequestId","MAWMsgType"],(function(t,n,r,o,a,i,l){"use strict";var e="backup_upload",s="media_backup",u="vesta_registration",c="vesta_login";function d(){return r("LSRequestId").generate()}function m(e){return e}function p(e){switch(e){case o("MAWMsgType").MSG_TYPE.TEXT:return o("LSDataTraceTag").messageTypeText;case o("MAWMsgType").MSG_TYPE.FUTUREPROOF:return o("LSDataTraceTag").messageTypeFutureproof;case o("MAWMsgType").MSG_TYPE.CIPHERTEXT:return o("LSDataTraceTag").messageTypeCiphertext;case o("MAWMsgType").MSG_TYPE.UNAVAILABLE:return o("LSDataTraceTag").messageTypeUnavailable;case o("MAWMsgType").MSG_TYPE.IMAGE:return o("LSDataTraceTag").messageTypeImage;case o("MAWMsgType").MSG_TYPE.VIDEO:return o("LSDataTraceTag").messageTypeVideo;case o("MAWMsgType").MSG_TYPE.PTT:return o("LSDataTraceTag").messageTypePtt;case o("MAWMsgType").MSG_TYPE.ADMIN:return o("LSDataTraceTag").messageTypeAdmin;case o("MAWMsgType").MSG_TYPE.REVOKED:return o("LSDataTraceTag").messageTypeRevoked;case o("MAWMsgType").MSG_TYPE.GIF:return o("LSDataTraceTag").messageTypeGif;case o("MAWMsgType").MSG_TYPE.STICKER:return o("LSDataTraceTag").messageTypeSticker;case o("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return o("LSDataTraceTag").messageTypeExpiredEphemeral;case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return o("LSDataTraceTag").messageTypeEphemeralSettingAdmin;case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:return o("LSDataTraceTag").messageTypeEphemeralSyncResponse;case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return o("LSDataTraceTag").messageTypeEphemeralScreenshotAction;case o("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:return o("LSDataTraceTag").messageTypeDeleteForMe;case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:return o("LSDataTraceTag").messageTypeEphemeralSettingChangeFromCurrentDevice;case o("MAWMsgType").MSG_TYPE.ICDC_ALERT:return o("LSDataTraceTag").messageTypeAlertICDC;case o("MAWMsgType").MSG_TYPE.GROUP_INVITE:return o("LSDataTraceTag").messageTypeGroupInvite;case o("MAWMsgType").MSG_TYPE.XMA:return o("LSDataTraceTag").messageTypeXMA;case o("MAWMsgType").MSG_TYPE.REACTION:return o("LSDataTraceTag").messageTypeReaction;case o("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:return o("LSDataTraceTag").messageTypeSenderKeyDistribution;default:return o("LSDataTraceTag").messageTypeNone}}l.CONTEXT_BACKUP_UPLOAD=e,l.CONTEXT_MEDIA_BACKUP=s,l.CONTEXT_VESTA_REGISTRATION=u,l.CONTEXT_VESTA_LOGIN=c,l.createTraceId=d,l.stringToTraceId=m,l.getTagForMsgType=p}),98);
__d("WACryptoCurve25519Dependencies",["Promise","WACryptoPrimitives","WASignalKeys","WASignalOther"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return(e||(e=n("Promise"))).resolve().then(function(){return o("WASignalKeys").makeKeyPair()})}function u(t,r){return(e||(e=n("Promise"))).resolve().then(function(){return o("WACryptoPrimitives").scalarMult(o("WASignalOther").ensureSize(r,32),o("WASignalOther").ensureSize(t,32)).buffer})}var c={generateIdentityKeyPair:s,calculateAgreement:u};l.calculateAgreement=u,l.CURVE25519_SIGNAL_DEPENDENCIES=c}),98);
__d("WASmaxInPreKeysIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","item-not-found");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",404);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorItemNotFoundMixin=e}),98);
__d("WASmaxInPreKeysRequestErrorsFetchDigest",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorItemNotFoundMixin","WASmaxInPreKeysIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInPreKeysIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:t.value});var n=o("WASmaxInPreKeysIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(e);if(n.success)return o("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:n.value});var r=o("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(e);return r.success?o("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:r.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorNotAcceptable","IQErrorItemNotFound","IQErrorFallbackClient"],[t,n,r])}l.parseRequestErrorsFetchDigest=e}),98);
__d("WASmaxInPreKeysFetchDigestResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrorsFetchDigest","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInPreKeysRequestErrorsFetchDigest").parseRequestErrorsFetchDigest(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRequestErrorsFetchDigest:i.value})):i}l.parseFetchDigestResponseRequestError=e}),98);
__d("WASmaxInPreKeysFetchDigestResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInPreKeysServerErrors").parseServerErrors(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorServerErrors:i.value})):i}l.parseFetchDigestResponseServerError=e}),98);
__d("WASmaxInPreKeysKeysHashMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"hash");if(!t.success)return t;var n=o("WASmaxParseUtils").contentBytesRange(t.value,20,20);return n.success?o("WAResultOrError").makeResult({hashElementValue:n.value}):n}l.parseKeysHashMixin=e}),98);
__d("WASmaxInPreKeysPreKeyIDListMixin",["WAResultOrError","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"id");if(!t.success)return t;var n=o("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(e);return n.success,n}function s(t){var n=o("WASmaxParseUtils").flattenedChildWithTag(t,"list");if(!n.success)return n;var r=o("WASmaxParseUtils").mapChildrenWithTag(n.value,"id",0,2e4,e);return r.success?o("WAResultOrError").makeResult({listId:r.value}):r}l.parsePreKeyIDListListId=e,l.parsePreKeyIDListMixin=s}),98);
__d("WASmaxInPreKeysIdentityDigestBundleMixin",["WAResultOrError","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysKeysHashMixin","WASmaxInPreKeysPreKeyIDListMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(e);if(!t.success)return t;var n=o("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(e);if(!n.success)return n;var r=o("WASmaxInPreKeysPreKeyIDListMixin").parsePreKeyIDListMixin(e);if(!r.success)return r;var a=o("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(e);if(!a.success)return a;var i=o("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(e),l=o("WASmaxInPreKeysKeysHashMixin").parseKeysHashMixin(e);return l.success?o("WAResultOrError").makeResult(babelHelpers.extends({},t.value,n.value,r.value,a.value,{keyTypeMixin:i.success?i.value:null},l.value)):l}l.parseIdentityDigestBundleMixin=e}),98);
__d("WASmaxInPreKeysFetchDigestResponseSuccess",["WAResultOrError","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysIdentityDigestBundleMixin","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"digest");if(!r.success)return r;var a=o("WASmaxParseReference").optionalAttrStringFromReference(t,["digest","identity_type"]);if(!a.success)return a;var i=o("WASmaxParseUtils").optionalLiteral(o("WASmaxParseUtils").attrString,r.value,"identity_type",a.value);if(!i.success)return i;var l=o("WASmaxInPreKeysIdentityDigestBundleMixin").parseIdentityDigestBundleMixin(r.value);if(!l.success)return l;var s=o("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(e,t);return s.success?o("WAResultOrError").makeResult(babelHelpers.extends({hasDigestIdentityType:i.value!=null,digestIdentityDigestBundleMixin:l.value},s.value)):s}l.parseFetchDigestResponseSuccess=e}),98);
__d("WASmaxOutPreKeysFetchDigestRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(o("WASmaxJsx").smax("iq",{type:"get"},o("WASmaxJsx").smax("digest",null)));return e}l.makeFetchDigestRequest=e}),98);
__d("WASmaxPreKeysFetchDigestRPC",["WAComms","WASmaxInPreKeysFetchDigestResponseRequestError","WASmaxInPreKeysFetchDigestResponseServerError","WASmaxInPreKeysFetchDigestResponseSuccess","WASmaxOutPreKeysFetchDigestRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(t,n,r,o,a,i,l){async function e(e){var t=o("WASmaxOutPreKeysFetchDigestRequest").makeFetchDigestRequest(),n=await o("WAComms").sendSmaxStanza(t,e),r=o("WASmaxInPreKeysFetchDigestResponseSuccess").parseFetchDigestResponseSuccess(n,t);if(r.success)return{name:"FetchDigestResponseSuccess",value:r.value};var a=o("WASmaxInPreKeysFetchDigestResponseRequestError").parseFetchDigestResponseRequestError(n,t);if(a.success)return{name:"FetchDigestResponseRequestError",value:a.value};var i=o("WASmaxInPreKeysFetchDigestResponseServerError").parseFetchDigestResponseServerError(n,t);if(i.success)return{name:"FetchDigestResponseServerError",value:i.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("FetchDigest",{Success:r,RequestError:a,ServerError:i}))}l.sendFetchDigestRPC=e}),98);
__d("WARequestPreKeyDigestProtocol",["WABinary","WAConvertRegistrationIdMixin","WAConvertSignedPreKeyMixin","WACryptoDependencies","WACryptoUtils","WAParsableXmlNode","WAResultOrError","WASignalKeys","WASmaxPreKeysFetchDigestRPC","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS(["requestPreKeyDigestProtocol"]);function c(t){return o("WASmaxPreKeysFetchDigestRPC").sendFetchDigestRPC({withoutRetry:!1}).then(function(n){switch(n.name){case"FetchDigestResponseServerError":{var r=n.value.errorServerErrors.name;return u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),n.name,r),o("WAResultOrError").makeError({type:"server-error",payload:r})}case"FetchDigestResponseRequestError":{var a=n.value.errorRequestErrorsFetchDigest.name;return u.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),n.name,a),o("WAResultOrError").makeError({type:"request-error",payload:a})}default:{n.name;var i=d(n.value.digestIdentityDigestBundleMixin);return m(i,t).then(function(e){return e==="ok"?o("WAResultOrError").makeResult():o("WAResultOrError").makeError({type:"compare-error",payload:e})})}}})}function d(e){var t=o("WAConvertRegistrationIdMixin").registrationIdMixin(e),n=o("WAConvertSignedPreKeyMixin").convertSignedPreKeyMixin(e),r=e.listId.map(function(e){return o("WASignalKeys").castToPreKeyId(o("WAParsableXmlNode").convertBytesToUint(e.elementValue,3))}),a=e.hashElementValue;return{regId:t,skeyId:n.id,preKeyIds:r,hash:a}}async function m(e,t){if(e.regId!==t.regInfo.regId)return"RegIdMismatch";if(e.skeyId!==t.signedPreKey.id)return"SignedPreKeyIdMismatch";var n=new Map;t.preKeys.forEach(function(e){return n.set(e.id,e)});var r=e.preKeyIds.some(function(e){return!n.has(e)});if(r)return"UnknownPreKey";var a=e.preKeyIds.map(function(e){return n.get(e)}).filter(Boolean),i=await p(t,a);return o("WACryptoUtils").uint8ArraysEqual(i,e.hash)?"ok":"HashMismatch"}function p(e,t){var n=new(o("WABinary")).Binary;return n.writeByteArray(e.regInfo.staticKeyPair.publicKey),n.writeByteArray(e.signedPreKey.keyPair.publicKey),n.writeByteArray(e.signedPreKey.signature),t.forEach(function(e){n.writeByteArray(e.keyPair.publicKey)}),o("WACryptoDependencies").getCrypto().subtle.digest("SHA-1",n.readByteArrayView()).then(function(e){return new Uint8Array(e)})}l.requestPreKeyDigestProtocol=c}),98);
__d("WARequestPreKeyDigest",["WABridge","WAGenerateAndUploadPreKeys","WAGetKeysForUpload","WAGlobals","WALogger","WAOdsEnums","WARequestPreKeyDigestProtocol","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(t){var n=await t(function(e){var t=e.cryptoManager;return o("WAGetKeysForUpload").getKeysForUpload(t)}),a=await o("WARequestPreKeyDigestProtocol").requestPreKeyDigestProtocol(n.value);if(a.success===!1){if(o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PREKEY_DIGEST,key:"fail"}),a.error.type==="compare-error"){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["PreKey digest comparison failed: ",""])),a.error.payload),o("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys({reason:"prekey digest comparison failed"}).catch(function(e){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Error while generating and uploading prekeys: ",""])),e)});return}throw r("err")("Error while requesting key digest: "+a.error.type+" "+a.error.payload)}a.success,o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PREKEY_DIGEST,key:"success"})}function c(){return u(function(e){return o("WAGlobals").getWaOneQueue().enqueue(e,{operationType:"request_prekey_digest",flush:!1})})}l.requestPreKeyDigestFn=u,l.requestPreKeyDigest=c}),98);
__d("WASmaxInPreKeysRotateSignedResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrors","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInPreKeysRequestErrors").parseRequestErrors(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRequestErrors:i.value})):i}l.parseRotateSignedResponseRequestError=e}),98);
__d("WASmaxInPreKeysRotateSignedResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInPreKeysServerErrors").parseServerErrors(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorServerErrors:i.value})):i}l.parseRotateSignedResponseServerError=e}),98);
__d("WASmaxInPreKeysRotateSignedResponseSuccess",["WASmaxInPreKeysIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(e,t);return r.success,r}l.parseRotateSignedResponseSuccess=e}),98);
__d("WASmaxInPreKeysRotateSignedResponseValidationError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxParseUtils").attrString(r.value,"text");if(!a.success)return a;var i=o("WASmaxParseUtils").attrIntRange(r.value,"code",400,499);if(!i.success)return i;var l=o("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(r.value);if(!l.success)return l;var s=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);return s.success?o("WAResultOrError").makeResult(babelHelpers.extends({errorText:a.value,errorCode:i.value,errorIdentityKeyMixin:l.value},s.value)):s}l.parseRotateSignedResponseValidationError=e}),98);
__d("WASmaxOutPreKeysRotateSignedRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysSignedPreKeyMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.signedPreKeyMixinArgs,n=o("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(o("WASmaxJsx").smax("iq",{type:"set"},o("WASmaxOutPreKeysSignedPreKeyMixin").mergeSignedPreKeyMixin(o("WASmaxJsx").smax("rotate",null),t)));return n}l.makeRotateSignedRequest=e}),98);
__d("WASmaxPreKeysRotateSignedRPC",["WAComms","WASmaxInPreKeysRotateSignedResponseRequestError","WASmaxInPreKeysRotateSignedResponseServerError","WASmaxInPreKeysRotateSignedResponseSuccess","WASmaxInPreKeysRotateSignedResponseValidationError","WASmaxOutPreKeysRotateSignedRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(t,n,r,o,a,i,l){async function e(e,t){var n=o("WASmaxOutPreKeysRotateSignedRequest").makeRotateSignedRequest(e),r=await o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInPreKeysRotateSignedResponseSuccess").parseRotateSignedResponseSuccess(r,n);if(a.success)return{name:"RotateSignedResponseSuccess",value:a.value};var i=o("WASmaxInPreKeysRotateSignedResponseValidationError").parseRotateSignedResponseValidationError(r,n);if(i.success)return{name:"RotateSignedResponseValidationError",value:i.value};var l=o("WASmaxInPreKeysRotateSignedResponseRequestError").parseRotateSignedResponseRequestError(r,n);if(l.success)return{name:"RotateSignedResponseRequestError",value:l.value};var s=o("WASmaxInPreKeysRotateSignedResponseServerError").parseRotateSignedResponseServerError(r,n);if(s.success)return{name:"RotateSignedResponseServerError",value:s.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("RotateSigned",{Success:a,ValidationError:i,RequestError:l,ServerError:s}))}l.sendRotateSignedRPC=e}),98);
__d("WARotateSignedPreKeyProtocol",["WACryptoManager","WAErrorMessage","WAGlobals","WAHandleFailureUtils","WAMakeSignedPreKeyMixin","WAResultOrError","WASmaxPreKeysRotateSignedRPC","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p=o("WATagsLogger").TAGS(["rotateSignedPreKeyProtocol"]);async function _(){p.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["start generating skey..."])));try{var t=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return o("WACryptoManager").generateSignedPreKey(t)},{operationType:"generate_signed_prekey",flush:!0,afterInit:!0});p.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["generated skey. Start rotating skey..."])));var n=await o("WASmaxPreKeysRotateSignedRPC").sendRotateSignedRPC({signedPreKeyMixinArgs:o("WAMakeSignedPreKeyMixin").makeSignedPreKeyMixin(t)});switch(n.name){case"RotateSignedResponseValidationError":{var r=n.value,a=r.errorCode,i=r.errorIdentityKeyMixin,l=r.errorText;return p.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["ValidationError: "," ",""])),a,l),o("WAResultOrError").makeError({type:"validation-error",identity:i.elementValue})}case"RotateSignedResponseRequestError":{var _=n.value.errorRequestErrors.value.code,f=n.value.errorRequestErrors.name;return p.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["RequestError: "," ",""])),_,f),o("WAResultOrError").makeError({type:"request-error"})}case"RotateSignedResponseServerError":{var g=n.value.errorServerErrors.value.code,h=n.value.errorServerErrors.name;return p.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["ServerError: "," ",""])),g,h),o("WAResultOrError").makeError({type:"server-error"})}default:return n.name,p.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["successfully rotated new skey"]))),o("WAResultOrError").makeResult()}}catch(e){var y=o("WAErrorMessage").maybeGetMessageFromError(e);if(y.includes("No lastSignedPrekeyId and registration"))return await o("WAHandleFailureUtils").reregisterPhone(),o("WAResultOrError").makeError({type:"no-prekey-reregistered"});throw e}}l.rotateSignedPreKeyProtocol=_}),98);
__d("WARotateSignedPreKey",["WAGenerateAndUploadPreKeys","WALoggerTag","WARotateSignedPreKeyProtocol","WATagsLogger","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("WATagsLogger").TAGS([r("WALoggerTag").SignedPrekeyRotation,r("WALoggerTag").SignedPrekey]);async function d(){var t=await o("WARotateSignedPreKeyProtocol").rotateSignedPreKeyProtocol();if(!(t.success||t.error.type==="no-prekey-reregistered")){if(t.error.type==="validation-error")return c.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Signed prekey failed server validation. need to upload all keys."]))),o("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys({reason:"signed prekey failed server validation"}).catch(function(e){c.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Error while generating and uploading prekeys: ",""])),e)}),Promise.resolve();throw c.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["rotateSignedPreKey failed."]))),r("err")("rotateSignedPreKey RPC failed: "+t.error.type)}}l.rotateSignedPreKey=d}),98);/*FB_PKG_DELIM*/
__d("PolarisFBSDK",[],(function(t,n,r,o,a,i){function e(){try{window.FB&&!window.FB.__buffer||(function(){var e=Function.prototype.apply;function t(t,n){return function(){return e.call(t,n,arguments)}}for(var n={__type:"JS_SDK_SANDBOX",window:window,document:window.document},r=["setTimeout","setInterval","clearTimeout","clearInterval"],o=0;o<r.length;o++)n[r[o]]=t(window[r[o]],window);(function(){var e=window,t=this,r=0;function o(){}var a={},i,l,s,u;(function(e){var n={},r=function(t,n){if(!t&&!n)return null;var e={};return typeof t!="undefined"&&(e.type=t),typeof n!="undefined"&&(e.signature=n),e},o=function(t,n){return r(t&&/^[A-Z]/.test(t)?t:void 0,n&&(n.params&&n.params.length||n.returns)?"function("+(n.params?n.params.map(function(e){return/\?/.test(e)?"?"+e.replace("?",""):e}).join(","):"")+")"+(n.returns?":"+n.returns:""):void 0)},i=function(t,n,r){return t},l=function(n,r,i){return"sourcemeta"in a&&(n.__SMmeta=r),"typechecks"in a&&(r=o(r?r.name:void 0,i),r&&t.__w(n,r)),n},s=function(t,n,r){return r.apply(t,n)},u=function(n,r,o,a){return a&&a.params&&t.__t.apply(n,a.params),o=o.apply(n,r),a&&a.returns&&t.__t([o,a.returns]),o};u=function(t,r,o,a,i){return i&&(i.callId||(i.callId=i.module+":"+(i.line||0)+":"+(i.column||0)),a=i.callId,n[a]=(n[a]||0)+1),o.apply(t,r)},typeof a=="undefined"?(t.__annotator=i,t.__bodyWrapper=s):(t.__annotator=l,"codeusage"in a?(t.__annotator=i,t.__bodyWrapper=u,t.__bodyWrapper.getCodeUsage=function(){return n},t.__bodyWrapper.clearCodeUsage=function(){n={}}):("typechecks"in a,t.__bodyWrapper=s))})(typeof t!="undefined"?t:typeof n!="undefined"?n:typeof window!="undefined"?window:typeof this!="undefined"?this:typeof e!="undefined"?e:{}),(function(e){e.__t=function(e){return e[0]},e.__w=function(e){return e}})(typeof t!="undefined"?t:typeof n!="undefined"?n:typeof window!="undefined"?window:typeof this!="undefined"?this:typeof e!="undefined"?e:{}),(function(e){var n={},r=["global","require","requireDynamic","requireLazy","module","exports"],o=["global","require","importDefault","importNamespace","requireLazy","module","exports"],a=1,i=32,l=64,s={},u=Object.prototype.hasOwnProperty;function c(t,a){if(!u.call(n,t)){if(a)return null;throw new Error("Module "+t+" has not been defined")}if(a=n[t],a.resolved)return a;t=a.special;for(var s=a.factory.length,c=t&i?o.concat(a.deps):r.concat(a.deps),_=[],f,g=0;g<s;g++){switch(c[g]){case"module":f=a;break;case"exports":f=a.exports;break;case"global":f=e;break;case"require":f=d;break;case"requireDynamic":f=null;break;case"requireLazy":f=null;break;case"importDefault":f=m;break;case"importNamespace":f=p;break;default:typeof c[g]=="string"&&(f=d.call(null,c[g]))}_.push(f)}return c=a.factory.apply(e,_),c&&(a.exports=c),t&l?a.exports!=null&&u.call(a.exports,"default")&&(a.defaultExport=a.exports.default):a.defaultExport=a.exports,a.resolved=!0,a}function d(e,t){if(e=c(e,t),e)return e.defaultExport!==s?e.defaultExport:e.exports}function m(e){if(e=c(e),e)return e.defaultExport!==s?e.defaultExport:null}function p(e){if(e=c(e),e)return e.exports}function _(e,t,r,o){typeof r=="function"?(n[e]={factory:r,deps:t,defaultExport:s,exports:{},special:o||0,resolved:!1},o!=null&&o&a&&d.call(null,e)):n[e]={defaultExport:r,exports:r,resolved:!0}}t.__d=_,t.require=d,t.importDefault=m,t.importNamespace=p,t.$RefreshReg$=function(){},t.$RefreshSig$=function(){return function(e){return e}}})(this),t.__d("ES5FunctionPrototype",[],function(e,t,n,r,o,a){e={bind:function(t){if(typeof this!="function")throw new TypeError("Bind must be called on a function");var e=this,n=Array.prototype.slice.call(arguments,1);function r(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments)))}return r.displayName="bound:"+(e.displayName||e.name||"(?)"),r.toString=function(){return"bound: "+e},r}},t=e,a.default=t},66),t.__d("ES5StringPrototype",[],function(e,t,n,r,o,a){e={startsWith:function(t){var e=String(this);if(this==null)throw new TypeError("String.prototype.startsWith called on null or undefined");var n=arguments.length>1?Number(arguments[1]):0;isNaN(n)&&(n=0);var r=Math.min(Math.max(n,0),e.length);return e.indexOf(String(t),n)==r},endsWith:function(t){var e=String(this);if(this==null)throw new TypeError("String.prototype.endsWith called on null or undefined");var n=e.length,r=String(t),o=arguments.length>1?Number(arguments[1]):n;isNaN(o)&&(o=0);var a=Math.min(Math.max(o,0),n),i=a-r.length;return i<0?!1:e.lastIndexOf(r,i)==i},includes:function(t){if(this==null)throw new TypeError("String.prototype.contains called on null or undefined");var e=String(this),n=arguments.length>1?Number(arguments[1]):0;return isNaN(n)&&(n=0),e.indexOf(String(t),n)!=-1},repeat:function(t){if(this==null)throw new TypeError("String.prototype.repeat called on null or undefined");var e=String(this);if(t=t?Number(t):0,isNaN(t)&&(t=0),t<0||t===1/0)throw RangeError();if(t===1)return e;if(t===0)return"";for(var n="";t;)t&1&&(n+=e),(t>>=1)&&(e+=e);return n}},t=e,a.default=t},66),t.__d("ES6Array",[],function(e,t,n,r,o,a){"use strict";e={from:function(t){if(t==null)throw new TypeError("Object is null or undefined");var e=arguments[1],n=arguments[2],r=this,o=Object(t),a=typeof Symbol=="function"&&navigator.userAgent.indexOf("Trident/7.0")===-1&&typeof Symbol=="function"&&typeof Symbol=="function"?Symbol.iterator:"@@iterator",i=typeof e=="function",l=typeof o[a]=="function",s=0,u,c;if(l){u=typeof r=="function"?new r:[];for(var d=o[a](),m;!(m=d.next()).done;)c=m.value,i&&(c=e.call(n,c,s)),u[s]=c,s+=1;return u.length=s,u}var p=o.length;for((isNaN(p)||p<0)&&(p=0),u=typeof r=="function"?new r(p):new Array(p);s<p;)c=o[s],i&&(c=e.call(n,c,s)),u[s]=c,s+=1;return u.length=s,u}},t=e,a.default=t},66),t.__d("ES6ArrayPrototype",[],function(e,t,n,r,o,a){var i={find:function(t,n){if(this==null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof t!="function")throw new TypeError("predicate must be a function");return t=i.findIndex.call(this,t,n),t===-1?void 0:this[t]},findIndex:function(t,n){if(this==null)throw new TypeError("Array.prototype.findIndex called on null or undefined");if(typeof t!="function")throw new TypeError("predicate must be a function");for(var e=Object(this),r=e.length>>>0,o=0;o<r;o++)if(t.call(n,e[o],o,e))return o;return-1},fill:function(t,n,r){if(this==null)throw new TypeError("Array.prototype.fill called on null or undefined");for(var e=Object(this),o=e.length>>>0,a=arguments[1],i=a>>0,l=i<0?Math.max(o+i,0):Math.min(i,o),s=arguments[2],u=s===void 0?o:s>>0,c=u<0?Math.max(o+u,0):Math.min(u,o);l<c;)e[l]=t,l++;return e}};e=i,a.default=e},66),t.__d("ES6Number",[],function(e,t,n,r,o,a){e=Math.pow(2,-52),t=Math.pow(2,53)-1,n=-1*t,r={isFinite:(function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t})(function(e){return typeof e=="number"&&isFinite(e)}),isNaN:(function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t})(function(e){return typeof e=="number"&&isNaN(e)}),isInteger:function(t){return this.isFinite(t)&&Math.floor(t)===t},isSafeInteger:function(t){return this.isFinite(t)&&t>=this.MIN_SAFE_INTEGER&&t<=this.MAX_SAFE_INTEGER&&Math.floor(t)===t},EPSILON:e,MAX_SAFE_INTEGER:t,MIN_SAFE_INTEGER:n},o=r,a.default=o},66),t.__d("ES6Object",[],function(e,t,n,r,o,a){var i={}.hasOwnProperty;e={assign:function(t){if(t==null)throw new TypeError("Object.assign target cannot be null or undefined");t=Object(t);for(var e=0;e<(arguments.length<=1?0:arguments.length-1);e++){var n=e+1<1||arguments.length<=e+1?void 0:arguments[e+1];if(n!=null){n=Object(n);for(var r in n)i.call(n,r)&&(t[r]=n[r])}}return t},is:function(t,n){return t===n?t!==0||1/t===1/n:t!==t&&n!==n}},t=e,a.default=t},66),t.__d("ES5Array",[],function(e,t,n,r,o,a){e={isArray:function(t){return Object.prototype.toString.call(t)=="[object Array]"}},t=e,a.default=t},66),t.__d("ES5ArrayPrototype",[],function(e,t,n,r,o,a){e={indexOf:function(t,n){n=n;var e=this.length;for(n|=0,n<0&&(n+=e);n<e;n++)if(n in this&&this[n]===t)return n;return-1}},t=e,a.default=t},66),t.__d("ES7ArrayPrototype",["ES5Array","ES5ArrayPrototype"],function(e,t,n,r,o,a){var i=t("ES5Array").isArray,l=t("ES5ArrayPrototype").indexOf;function s(e){return Math.min(Math.max(u(e),0),Number.MAX_SAFE_INTEGER)}function u(e){return e=Number(e),isFinite(e)&&e!==0?c(e)*Math.floor(Math.abs(e)):e}function c(e){return e>=0?1:-1}e={includes:function(t){"use strict";if(t!==void 0&&i(this)&&!(typeof t=="number"&&isNaN(t)))return l.apply(this,arguments)!==-1;var e=Object(this),n=e.length?s(e.length):0;if(n===0)return!1;for(var r=arguments.length>1?u(arguments[1]):0,o=r<0?Math.max(n+r,0):r,a=isNaN(t)&&typeof t=="number";o<n;){var c=e[o];if(c===t||typeof c=="number"&&a&&isNaN(c))return!0;o++}return!1}},o.exports=e},null),t.__d("ES7Object",[],function(e,t,n,r,o,a){var i={}.hasOwnProperty;e={entries:function(t){if(t==null)throw new TypeError("Object.entries called on non-object");var e=[];for(var n in t)i.call(t,n)&&e.push([n,t[n]]);return e},values:function(t){if(t==null)throw new TypeError("Object.values called on non-object");var e=[];for(var n in t)i.call(t,n)&&e.push(t[n]);return e}},t=e,a.default=t},66),t.__d("ES7StringPrototype",[],function(e,t,n,r,o,a){e={trimLeft:function(){return this.replace(/^\s+/,"")},trimRight:function(){return this.replace(/\s+$/,"")}},t=e,a.default=t},66),t.__d("json3-3.3.2",[],function(e,d,n,r,o,a){"use strict";var t={},i={exports:t},l;function s(){(function(){var n=typeof l=="function"&&l.amd,r={function:!0,object:!0},o=r[typeof t]&&t&&!t.nodeType&&t,a=r[typeof window]&&window||this,s=o&&r[typeof i]&&i&&!i.nodeType&&typeof e=="object"&&e;s&&(s.global===s||s.window===s||s.self===s)&&(a=s);function u(e,t){e||(e=a.Object()),t||(t=a.Object());var n=e.Number||a.Number,o=e.String||a.String,i=e.Object||a.Object,l=e.Date||a.Date,s=e.SyntaxError||a.SyntaxError,c=e.TypeError||a.TypeError,d=e.Math||a.Math;e=e.JSON||a.JSON,typeof e=="object"&&e&&(t.stringify=e.stringify,t.parse=e.parse),e=i.prototype;var m=e.toString,p,_,f,g=new l(-0xc782b5b800cec);try{g=g.getUTCFullYear()==-109252&&g.getUTCMonth()===0&&g.getUTCDate()===1&&g.getUTCHours()==10&&g.getUTCMinutes()==37&&g.getUTCSeconds()==6&&g.getUTCMilliseconds()==708}catch(e){}function h(e){if(h[e]!==f)return h[e];var r;if(e=="bug-string-char-index")r=!1;else if(e=="json")r=h("json-stringify")&&h("json-parse");else{var a,i='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if(e=="json-stringify"){var s=t.stringify,u=typeof s=="function"&&g;if(u){(a=function(){return 1}).toJSON=a;try{u=s(0)==="0"&&s(new n)==="0"&&s(new o)=='""'&&s(m)===f&&s(f)===f&&s()===f&&s(a)==="1"&&s([a])=="[1]"&&s([f])=="[null]"&&s(null)=="null"&&s([f,m,null])=="[null,null,null]"&&s({a:[a,!0,!1,null,"\0\b\n\f\r	"]})==i&&s(null,a)==="1"&&s([1,2],null,1)=="[\n 1,\n 2\n]"&&s(new l(-864e13))=='"-271821-04-20T00:00:00.000Z"'&&s(new l(864e13))=='"+275760-09-13T00:00:00.000Z"'&&s(new l(-621987552e5))=='"-000001-01-01T00:00:00.000Z"'&&s(new l(-1))=='"1969-12-31T23:59:59.999Z"'}catch(e){u=!1}}r=u}if(e=="json-parse"){if(s=t.parse,typeof s=="function")try{if(s("0")===0&&!s(!1)){a=s(i);var c=a.a.length==5&&a.a[0]===1;if(c){try{c=!s('"	"')}catch(e){}if(c)try{c=s("01")!==1}catch(e){}if(c)try{c=s("1.")!==1}catch(e){}}}}catch(e){c=!1}r=c}}return h[e]=!!r}if(!h("json")){var y="[object Function]",C="[object Date]",b="[object Number]",v="[object String]",S="[object Array]",R="[object Boolean]",L=h("bug-string-char-index");if(!g)var E=d.floor,k=[0,31,59,90,120,151,181,212,243,273,304,334],I=function(t,n){return k[n]+365*(t-1970)+E((t-1969+(n=+(n>1)))/4)-E((t-1901+n)/100)+E((t-1601+n)/400)};if((p=e.hasOwnProperty)||(p=function(t){var e={},n;return(e.__proto__=null,e.__proto__={toString:1},e).toString!=m?p=function(t){var e=this.__proto__;return t=t in(this.__proto__=null,this),this.__proto__=e,t}:(n=e.constructor,p=function(t){var e=(this.constructor||n).prototype;return t in this&&!(t in e&&this[t]===e[t])}),p.call(this,t)}),_=function(t,n){var e=0,o,a;(o=function(){this.valueOf=0}).prototype.valueOf=0,a=new o;for(o in a)p.call(a,o)&&e++;return a=null,e?e==2?_=function(t,n){var e={},r=m.call(t)==y,o;for(o in t)!(r&&o=="prototype")&&!p.call(e,o)&&(e[o]=1)&&p.call(t,o)&&n(o)}:_=function(t,n){var e=m.call(t)==y,r,o;for(r in t)!(e&&r=="prototype")&&p.call(t,r)&&!(o=r==="constructor")&&n(r);(o||p.call(t,r="constructor"))&&n(r)}:(a=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],_=function(t,n){var e=m.call(t)==y,o,i=!e&&typeof t.constructor!="function"&&r[typeof t.hasOwnProperty]&&t.hasOwnProperty||p;for(o in t)!(e&&o=="prototype")&&i.call(t,o)&&n(o);for(e=a.length;o=a[--e];i.call(t,o)&&n(o));}),_(t,n)},!h("json-stringify")){var T={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},D="000000",x=function(t,n){return(D+(n||0)).slice(-t)},$="\\u00",P=function(t){for(var e='"',n=0,r=t.length,o=!L||r>10,a=o&&(L?t.split(""):t);n<r;n++){var i=t.charCodeAt(n);switch(i){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=T[i];break;default:if(i<32){e+=$+x(2,i.toString(16));break}e+=o?a[n]:t.charAt(n)}}return e+'"'},N=function(t,n,r,o,a,i,l){var e,s,u,d,g,h,y,L,k,T;try{e=n[t]}catch(e){}if(typeof e=="object"&&e)if(s=m.call(e),s==C&&!p.call(e,"toJSON"))if(e>-1/0&&e<1/0){if(I){for(g=E(e/864e5),u=E(g/365.2425)+1970-1;I(u+1,0)<=g;u++);for(d=E((g-I(u,0))/30.42);I(u,d+1)<=g;d++);g=1+g-I(u,d),h=(e%864e5+864e5)%864e5,y=E(h/36e5)%24,L=E(h/6e4)%60,k=E(h/1e3)%60,h=h%1e3}else u=e.getUTCFullYear(),d=e.getUTCMonth(),g=e.getUTCDate(),y=e.getUTCHours(),L=e.getUTCMinutes(),k=e.getUTCSeconds(),h=e.getUTCMilliseconds();e=(u<=0||u>=1e4?(u<0?"-":"+")+x(6,u<0?-u:u):x(4,u))+"-"+x(2,d+1)+"-"+x(2,g)+"T"+x(2,y)+":"+x(2,L)+":"+x(2,k)+"."+x(3,h)+"Z"}else e=null;else typeof e.toJSON=="function"&&(s!=b&&s!=v&&s!=S||p.call(e,"toJSON"))&&(e=e.toJSON(t));if(r&&(e=r.call(n,t,e)),e===null)return"null";if(s=m.call(e),s==R)return""+e;if(s==b)return e>-1/0&&e<1/0?""+e:"null";if(s==v)return P(""+e);if(typeof e=="object"){for(u=l.length;u--;)if(l[u]===e)throw c();if(l.push(e),T=[],d=i,i+=a,s==S){for(g=0,u=e.length;g<u;g++)y=N(g,e,r,o,a,i,l),T.push(y===f?"null":y);L=T.length?a?"[\n"+i+T.join(",\n"+i)+"\n"+d+"]":"["+T.join(",")+"]":"[]"}else _(o||e,function(t){var n=N(t,e,r,o,a,i,l);n!==f&&T.push(P(t)+":"+(a?" ":"")+n)}),L=T.length?a?"{\n"+i+T.join(",\n"+i)+"\n"+d+"}":"{"+T.join(",")+"}":"{}";return l.pop(),L}};t.stringify=function(e,t,n){var o,a,i,l;if(r[typeof t]&&t){if((l=m.call(t))==y)a=t;else if(l==S){i={};for(var s=0,u=t.length,c;s<u;c=t[s++],l=m.call(c),(l==v||l==b)&&(i[c]=1));}}if(n)if((l=m.call(n))==b){if((n-=n%1)>0)for(o="",n>10&&(n=10);o.length<n;o+=" ");}else l==v&&(o=n.length<=10?n:n.slice(0,10));return N("",(c={},c[""]=e,c),a,i,o,"",[])}}if(!h("json-parse")){var M=o.fromCharCode,w={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},A,F,O=function(){throw A=F=null,s()},B=function(){for(var e=F,t=e.length,n,r,o,a,i;A<t;)switch(i=e.charCodeAt(A),i){case 9:case 10:case 13:case 32:A++;break;case 123:case 125:case 91:case 93:case 58:case 44:return n=L?e.charAt(A):e[A],A++,n;case 34:for(n="@",A++;A<t;)if(i=e.charCodeAt(A),i<32)O();else if(i==92)switch(i=e.charCodeAt(++A),i){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:n+=w[i],A++;break;case 117:for(r=++A,o=A+4;A<o;A++)i=e.charCodeAt(A),i>=48&&i<=57||i>=97&&i<=102||i>=65&&i<=70||O();n+=M("0x"+e.slice(r,A));break;default:O()}else{if(i==34)break;for(i=e.charCodeAt(A),r=A;i>=32&&i!=92&&i!=34;)i=e.charCodeAt(++A);n+=e.slice(r,A)}if(e.charCodeAt(A)==34)return A++,n;O();default:if(r=A,i==45&&(a=!0,i=e.charCodeAt(++A)),i>=48&&i<=57){for(i==48&&(i=e.charCodeAt(A+1),i>=48&&i<=57)&&O(),a=!1;A<t&&(i=e.charCodeAt(A),i>=48&&i<=57);A++);if(e.charCodeAt(A)==46){for(o=++A;o<t&&(i=e.charCodeAt(o),i>=48&&i<=57);o++);o==A&&O(),A=o}if(i=e.charCodeAt(A),i==101||i==69){for(i=e.charCodeAt(++A),(i==43||i==45)&&A++,o=A;o<t&&(i=e.charCodeAt(o),i>=48&&i<=57);o++);o==A&&O(),A=o}return+e.slice(r,A)}if(a&&O(),e.slice(A,A+4)=="true")return A+=4,!0;if(e.slice(A,A+5)=="false")return A+=5,!1;if(e.slice(A,A+4)=="null")return A+=4,null;O()}return"$"},W=function(t){var e,n;if(t=="$"&&O(),typeof t=="string"){if((L?t.charAt(0):t[0])=="@")return t.slice(1);if(t=="["){for(e=[];t=B(),t!="]";n||(n=!0))n&&(t==","?(t=B(),t=="]"&&O()):O()),t==","&&O(),e.push(W(t));return e}else if(t=="{"){for(e={};t=B(),t!="}";n||(n=!0))n&&(t==","?(t=B(),t=="}"&&O()):O()),(t==","||typeof t!="string"||(L?t.charAt(0):t[0])!="@"||B()!=":")&&O(),e[t.slice(1)]=W(B());return e}O()}return t},q=function(t,n,r){r=U(t,n,r),r===f?delete t[n]:t[n]=r},U=function(t,n,r){var e=t[n],o;if(typeof e=="object"&&e)if(m.call(e)==S)for(o=e.length;o--;)q(e,o,r);else _(e,function(t){q(e,t,r)});return r.call(t,n,e)};t.parse=function(e,t){var n;return A=0,F=""+e,e=W(B()),B()!="$"&&O(),A=F=null,t&&m.call(t)==y?U((n={},n[""]=e,n),"",t):e}}}return t.runInContext=u,t}if(o&&!n)u(a,o);else{var c=a.JSON,d=a.JSON3,m=!1,p=u(a,a.JSON3={noConflict:function(){return m||(m=!0,a.JSON=c,a.JSON3=d,c=d=null),p}});a.JSON={parse:p.parse,stringify:p.stringify}}n&&l(function(){return p})}).call(this)}var u=!1;function c(){return u||(u=!0,s()),i.exports}function d(e){switch(e){case void 0:return c()}}o.exports=d},null),t.__d("json3",["json3-3.3.2"],function(e,t,n,r,o,a){o.exports=t("json3-3.3.2")()},null),t.__d("ES",["ES5FunctionPrototype","ES5StringPrototype","ES6Array","ES6ArrayPrototype","ES6Number","ES6Object","ES7ArrayPrototype","ES7Object","ES7StringPrototype","json3"],function(l,s,n,r,o,a,i){var e={}.toString,t={"JSON.stringify":n("json3").stringify,"JSON.parse":n("json3").parse};r={"Function.prototype":n("ES5FunctionPrototype"),"String.prototype":n("ES5StringPrototype")},o={Object:n("ES6Object"),"Array.prototype":n("ES6ArrayPrototype"),Number:n("ES6Number"),Array:n("ES6Array")},a={Object:n("ES7Object"),"String.prototype":n("ES7StringPrototype"),"Array.prototype":n("ES7ArrayPrototype")};function l(e){for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=e[n],o=n.split(".");if(o.length===2){var a=o[0],i=o[1];if(!a||!i||!window[a]||!window[a][i]){var l=a?window[a]:"-",s=a&&window[a]&&i?window[a][i]:"-";throw new Error("Unexpected state (t11975770): "+(a+", "+i+", "+l+", "+s+", "+n))}}a=o.length===2?window[o[0]][o[1]]:window[n];for(i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(typeof r[i]!="function"){t[n+"."+i]=r[i];continue}l=a[i],t[n+"."+i]=l&&/\{\s+\[native code\]\s\}/.test(l)?l:r[i]}}}l(r),l(o),l(a);function s(n,r,o){var a=o?e.call(n).slice(8,-1)+".prototype":n,i;if(Array.isArray(n))if(typeof a=="string")i=t[a+"."+r];else throw new Error("Can't polyfill "+r+" directly on an Array.");else if(typeof a=="string")i=t[a+"."+r];else{if(typeof n=="string")throw new Error("Can't polyfill "+r+" directly on a string.");i=n[r]}if(typeof i=="function"){for(var l=arguments.length,s=new Array(l>3?l-3:0),u=3;u<l;u++)s[u-3]=arguments[u];return i.apply(n,s)}else if(i)return i;throw new Error("Polyfill "+a+" does not have implementation of "+r)}i.default=s},98),t.__d("ES5Object",[],function(e,t,n,r,o,a){var i={}.hasOwnProperty;e={create:function(t){var e=typeof t;if(e!="object"&&e!="function")throw new TypeError("Object prototype may only be a Object or null");return l.prototype=t,new l},keys:function(t){var e=typeof t;if(e!="object"&&e!="function"||t===null)throw new TypeError("Object.keys called on non-object");e=[];for(var n in t)i.call(t,n)&&e.push(n);return e},freeze:function(t){return t},isFrozen:function(){return!1},seal:function(t){return t}};function l(){}t=e,a.default=t},66),t.__d("sdk.babelHelpers",["ES5FunctionPrototype","ES5Object","ES6Object"],function(e,t,n,r,o,a){var i={},l=Object.prototype.hasOwnProperty;i.inheritsLoose=function(e,n){return t("ES6Object").assign(e,n),e.prototype=t("ES5Object").create(n&&n.prototype),e.prototype.constructor=e,e.__superConstructor__=n,n},i.inherits=i.inheritsLoose,i.wrapNativeSuper=function(e){var t=typeof Map=="function"?new Map:void 0;return i.wrapNativeSuper=function(e){if(e===null)return null;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(e))return t.get(e);t.set(e,n)}i.inheritsLoose(n,e);function n(){e.apply(this,arguments)}return n},i.wrapNativeSuper(e)},i.assertThisInitialized=function(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},i._extends=t("ES6Object").assign,i.extends=i._extends,i.construct=function(e,t){var n=[null];return n.push.apply(n,t),new(Function.prototype.bind.apply(e,n))},i.objectWithoutPropertiesLoose=function(e,t){var n={};for(var r in e)!l.call(e,r)||t.indexOf(r)>=0||(n[r]=e[r]);return n},i.objectWithoutProperties=i.objectWithoutPropertiesLoose,i.taggedTemplateLiteralLoose=function(e,t){return t||(t=e.slice(0)),e.raw=t,e},i.bind=t("ES5FunctionPrototype").bind,o.exports=i},null);var c=t.require("ES"),d=t.require("sdk.babelHelpers");(function(e,t){var n="keys",r="values",o="entries",a=(function(){var e=l(Array),t;return e||(t=(function(){"use strict";function e(e,t){this.$1=e,this.$2=t,this.$3=0}var t=e.prototype;return t.next=function(){if(this.$1==null)return{value:void 0,done:!0};var e=this.$1,t=this.$1.length,a=this.$3,i=this.$2;if(a>=t)return this.$1=void 0,{value:void 0,done:!0};if(this.$3=a+1,i===n)return{value:a,done:!1};if(i===r)return{value:e[a],done:!1};if(i===o)return{value:[a,e[a]],done:!1}},t[typeof Symbol=="function"&&typeof Symbol=="function"?Symbol.iterator:"@@iterator"]=function(){return this},e})()),{keys:e?function(e){return e.keys()}:function(e){return new t(e,n)},values:e?function(e){return e.values()}:function(e){return new t(e,r)},entries:e?function(e){return e.entries()}:function(e){return new t(e,o)}}})(),i=(function(){var e=l(String),t;return e||(t=(function(){"use strict";function e(e){this.$1=e,this.$2=0}var t=e.prototype;return t.next=function(){if(this.$1==null)return{value:void 0,done:!0};var e=this.$2,t=this.$1,n=t.length;if(e>=n)return this.$1=void 0,{value:void 0,done:!0};var r=t.charCodeAt(e);return r<55296||r>56319||e+1===n?r=t[e]:(n=t.charCodeAt(e+1),n<56320||n>57343?r=t[e]:r=t[e]+t[e+1]),this.$2=e+r.length,{value:r,done:!1}},t[typeof Symbol=="function"&&typeof Symbol=="function"?Symbol.iterator:"@@iterator"]=function(){return this},e})()),{keys:function(){throw TypeError("Strings default iterator doesn't implement keys.")},values:e?function(e){return e[typeof Symbol=="function"&&typeof Symbol=="function"?Symbol.iterator:"@@iterator"]()}:function(e){return new t(e)},entries:function(){throw TypeError("Strings default iterator doesn't implement entries.")}}})();function l(e){return typeof e.prototype[typeof Symbol=="function"&&typeof Symbol=="function"?Symbol.iterator:"@@iterator"]=="function"&&typeof e.prototype.values=="function"&&typeof e.prototype.keys=="function"&&typeof e.prototype.entries=="function"}var s=(function(){"use strict";function e(e,t){this.$1=e,this.$2=t,this.$3=Object.keys(e),this.$4=0}var t=e.prototype;return t.next=function(){var e=this.$3.length,t=this.$4,a=this.$2,i=this.$3[t];if(t>=e)return this.$1=void 0,{value:void 0,done:!0};if(this.$4=t+1,a===n)return{value:i,done:!1};if(a===r)return{value:this.$1[i],done:!1};if(a===o)return{value:[i,this.$1[i]],done:!1}},t[typeof Symbol=="function"&&typeof Symbol=="function"?Symbol.iterator:"@@iterator"]=function(){return this},e})(),u={keys:function(t){return new s(t,n)},values:function(t){return new s(t,r)},entries:function(t){return new s(t,o)}};function d(e,t){return typeof e=="string"?i[t||r](e):Array.isArray(e)?a[t||r](e):e[typeof Symbol=="function"&&typeof Symbol=="function"?Symbol.iterator:"@@iterator"]?e[typeof Symbol=="function"&&typeof Symbol=="function"?Symbol.iterator:"@@iterator"]():u[t||o](e)}c("Object","assign",!1,d,{KIND_KEYS:n,KIND_VALUES:r,KIND_ENTRIES:o,keys:function(t){return d(t,n)},values:function(t){return d(t,r)},entries:function(t){return d(t,o)},generic:u.entries}),e.FB_enumerate=d})(typeof n=="object"?n:typeof this=="object"?this:typeof window=="object"?window:typeof e=="object"?e:{}),t.__d("JSSDKCanvasPrefetcherConfig",[],{enabled:!0,excludedAppIds:[0x83d70a64a992,768691303149786,320528941393723],sampleRate:500}),t.__d("JSSDKConfig",[],{features:{allow_non_canvas_app_events:!1,xd_timeout:{rate:1,value:6e4},use_bundle:!1,should_log_response_error:!0,https_only_enforce_starting:25388092e5,https_only_learn_more:"https://developers.facebook.com/blog/post/2018/06/08/enforce-https-facebook-login/",https_only_scribe_logging:{rate:.001},log_perf:{rate:.001},legacy_xd_init:{rate:0},use_x_xd:{rate:100},cache_auth_response:{rate:100},oauth_funnel_logger_version:1,iab_login_status:!0,iab_login_android_support_version:"277.0",force_popup_to_canvas_apps_with_id:[],force_popup_to_all_canvas_app:!1,max_oauth_dialog_retries:{rate:100,value:99999},idle_callback_wait_time_ms:3e3,chat_plugin_facade_timeout_ms:8e3,chat_plugin_facade_enabled_pageids:["102493178867330","107331571710078","1032787970130843","107771111665395","261907812360345","101305975654752","275483104252055","101664622285042","112682113428700","271628573687012","385757598521443","100545935690488"],should_enable_ig_login_status_fetch:!0,log_cookies_usage:{rate:.1},allow_shadow_dom_for_apps_with_id:[520916077950649,0x8a901293cafc,0x782088d8b564,468663283258845,409976882430412,0xaca9ca662386,360467581347,274266067164],allow_shadow_dom:!0,xfoa_login_enabled:!1}}),t.__d("JSSDKCssConfig",[],{rules:".fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:'lucida grande', tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}\n.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:'lucida grande', tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}\n.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_dialog_advanced{border-radius:8px;padding:10px}.fb_dialog_content{background:#fff;color:#373737}.fb_dialog_close_icon{background:url(https://connect.facebook.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{left:5px;right:auto;top:5px}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://connect.facebook.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent}.fb_dialog_close_icon:active{background:url(https://connect.facebook.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #365899;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://connect.facebook.net/rsrc.php/v3/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{height:100%;left:0;margin:0;overflow:visible;position:absolute;top:-10000px;transform:none;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://connect.facebook.net/rsrc.php/v3/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{background:none;height:auto;min-height:initial;min-width:initial;width:auto}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{clear:both;color:#fff;display:block;font-size:18px;padding-top:20px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .4);bottom:0;left:0;min-height:100%;position:absolute;right:0;top:0;width:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_mobile .fb_dialog_iframe{position:sticky;top:0}.fb_dialog_content .dialog_header{background:linear-gradient(from(#738aba), to(#2c4987));border-bottom:1px solid;border-color:#043b87;box-shadow:white 0 1px 1px -1px inset;color:#fff;font:bold 14px Helvetica, sans-serif;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:linear-gradient(from(#4267B2), to(#2a4887));background-clip:padding-box;border:1px solid #29487d;border-radius:3px;display:inline-block;line-height:18px;margin-top:3px;max-width:85px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{background:none;border:none;color:#fff;font:bold 12px Helvetica, sans-serif;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://connect.facebook.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #4a4a4a;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f5f6f7;border:1px solid #4a4a4a;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://connect.facebook.net/rsrc.php/v3/yD/r/t-wz8gw1xG1.png);background-position:50% 50%;background-repeat:no-repeat;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}\n.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}\n.fb_mpn_mobile_landing_page_slide_out{animation-duration:200ms;animation-name:fb_mpn_landing_page_slide_out;transition-timing-function:ease-in}.fb_mpn_mobile_landing_page_slide_out_from_left{animation-duration:200ms;animation-name:fb_mpn_landing_page_slide_out_from_left;transition-timing-function:ease-in}.fb_mpn_mobile_landing_page_slide_up{animation-duration:500ms;animation-name:fb_mpn_landing_page_slide_up;transition-timing-function:ease-in}.fb_mpn_mobile_bounce_in{animation-duration:300ms;animation-name:fb_mpn_bounce_in;transition-timing-function:ease-in}.fb_mpn_mobile_bounce_out{animation-duration:300ms;animation-name:fb_mpn_bounce_out;transition-timing-function:ease-in}.fb_mpn_mobile_bounce_out_v2{animation-duration:300ms;animation-name:fb_mpn_fade_out;transition-timing-function:ease-in}.fb_customer_chat_bounce_in_v2{animation-duration:300ms;animation-name:fb_bounce_in_v2;transition-timing-function:ease-in}.fb_customer_chat_bounce_in_from_left{animation-duration:300ms;animation-name:fb_bounce_in_from_left;transition-timing-function:ease-in}.fb_customer_chat_bounce_out_v2{animation-duration:300ms;animation-name:fb_bounce_out_v2;transition-timing-function:ease-in}.fb_customer_chat_bounce_out_from_left{animation-duration:300ms;animation-name:fb_bounce_out_from_left;transition-timing-function:ease-in}.fb_invisible_flow{display:inherit;height:0;overflow-x:hidden;width:0}@keyframes fb_mpn_landing_page_slide_out{0%{margin:0 12px;width:100% - 24px}60%{border-radius:18px}100%{border-radius:50%;margin:0 24px;width:60px}}@keyframes fb_mpn_landing_page_slide_out_from_left{0%{left:12px;width:100% - 24px}60%{border-radius:18px}100%{border-radius:50%;left:12px;width:60px}}@keyframes fb_mpn_landing_page_slide_up{0%{bottom:0;opacity:0}100%{bottom:24px;opacity:1}}@keyframes fb_mpn_bounce_in{0%{opacity:.5;top:100%}100%{opacity:1;top:0}}@keyframes fb_mpn_fade_out{0%{bottom:30px;opacity:1}100%{bottom:0;opacity:0}}@keyframes fb_mpn_bounce_out{0%{opacity:1;top:0}100%{opacity:.5;top:100%}}@keyframes fb_bounce_in_v2{0%{opacity:0;transform:scale(0, 0);transform-origin:bottom right}50%{transform:scale(1.03, 1.03);transform-origin:bottom right}100%{opacity:1;transform:scale(1, 1);transform-origin:bottom right}}@keyframes fb_bounce_in_from_left{0%{opacity:0;transform:scale(0, 0);transform-origin:bottom left}50%{transform:scale(1.03, 1.03);transform-origin:bottom left}100%{opacity:1;transform:scale(1, 1);transform-origin:bottom left}}@keyframes fb_bounce_out_v2{0%{opacity:1;transform:scale(1, 1);transform-origin:bottom right}100%{opacity:0;transform:scale(0, 0);transform-origin:bottom right}}@keyframes fb_bounce_out_from_left{0%{opacity:1;transform:scale(1, 1);transform-origin:bottom left}100%{opacity:0;transform:scale(0, 0);transform-origin:bottom left}}@keyframes slideInFromBottom{0%{opacity:.1;transform:translateY(100%)}100%{opacity:1;transform:translateY(0)}}@keyframes slideInFromBottomDelay{0%{opacity:0;transform:translateY(100%)}97%{opacity:0;transform:translateY(100%)}100%{opacity:1;transform:translateY(0)}}",components:["css:fb.css.base","css:fb.css.dialog","css:fb.css.iframewidget","css:fb.css.customer_chat_plugin_iframe"]}),t.__d("JSSDKRuntimeConfig",[],{locale:"en_US",revision:"1007242444",rtl:!1,sdkab:null,sdkns:"",sdkurl:"https://connect.facebook.net/en_US/sdk.js",scribeurl:"https://www.facebook.com/platform/scribe_endpoint.php/"}),t.__d("JSSDKXDConfig",[],{XXdUrl:"/x/connect/xd_arbiter/?version=C-8998888-1007242444-20230404094308",useCdn:!0}),t.__d("UrlMapConfig",[],{www:"www.facebook.com",m:"m.facebook.com",business:"business.facebook.com",api:"api.facebook.com",api_read:"api-read.facebook.com",graph:"graph.facebook.com",an:"an.facebook.com",fbcdn:"static.xx.fbcdn.net",cdn:"staticxx.facebook.com",graph_facebook:"graph.facebook.com",graph_gaming:"graph.fb.gg",graph_instagram:"graph.instagram.com",www_instagram:"www.instagram.com",social_plugin:"socialplugin.facebook.net"}),t.__d("JSSDKShadowCssConfig",[],{"css:fb.shadow.css.fb_login_button":".fb_login_button_container{align-content:center;align-items:center;border:0;color:#fff;display:flex;font-family:'Roboto', 'Freight Sans LF Pro', Helvetica, Arial, 'Lucida Grande', sans-serif;font-weight:bold;margin:auto}.fb-button-main-element{display:flex;flex-wrap:nowrap;overflow:hidden}.fb-iframe-overlay{display:flex}.fb-button-main-element:hover{cursor:pointer}.fb-button-main-element:focus{filter:brightness(80%)}.fb_button_label_element{align-items:center;display:flex;font-weight:bold;justify-content:center}.fb_button_label{margin:auto;pointer-events:none}.fb_button_svg_logo{height:1.33em;margin-left:.4em;margin-right:.4em;padding:.065em}.login_fb_logo .f_logo_f{fill:transparent}.single_button_svg_logo{margin-bottom:.08em}"}),t.__d("DOMWrapper",[],function(r,o,l,s,a,i){"use strict";var t,n;function r(e){t=e}function o(){return t||document.body}function l(e){n=e}function s(){return n||e}i.setRoot=r,i.getRoot=o,i.setWindow=l,i.getWindow=s},66),t.__d("dotAccess",[],function(e,t,n,r,o,a){function e(e,t,n){t=t.split(".");do{var r=t.shift();e=e[r]||n&&(e[r]={})}while(t.length&&e);return e}a.default=e},66),t.__d("guid",[],function(e,t,n,r,o,a){function e(){return"f"+(Math.random()*(1<<30)).toString(16).replace(".","")}a.default=e},66),t.__d("wrapFunction",[],function(i,t,n,r,o,a){var e={};function i(t,n,r){var o=n in e?e[n](t,r):t;return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return o.apply(this,t)}}i.setWrapper=function(t,n){e[n]=t},a.default=i},66),t.__d("GlobalCallback",["DOMWrapper","dotAccess","guid","wrapFunction"],function(s,u,n,r,o,a,i){var e,t;function l(o){e=n("dotAccess")(r("DOMWrapper").getWindow(),o,!0),t=o}function s(r,o){e||l("__globalCallbacks");var a=n("guid")();return e[a]=n("wrapFunction")(r,"entry",(r=o)!=null?r:"GlobalCallback"),t+"."+a}function u(n){n=n.substring(t.length+1),delete e[n]}i.setPrefix=l,i.create=s,i.remove=u},98),t.__d("Log",[],function(i,t,n,r,o,a){"use strict";var e=-1;t={DEBUG:3,INFO:2,WARNING:1,ERROR:0},n=function(n,r,o){for(var t=arguments.length,a=new Array(t>3?t-3:0),i=3;i<t;i++)a[i-3]=arguments[i];var l=0,s=o.replace(/%s/g,function(){return String(a[l++])}),u=window.console;u&&e>=r&&u[n in u?n:"log"](s)};function i(t){e=t}r=c(n,"bind",!0,null,"debug",t.DEBUG),o=c(n,"bind",!0,null,"info",t.INFO);var l=c(n,"bind",!0,null,"warn",t.WARNING),s=c(n,"bind",!0,null,"error",t.ERROR);a.Level=t,a.log=n,a.setLevel=i,a.debug=r,a.info=o,a.warn=l,a.error=s},66),t.__d("sdk.UA",[],function(e,t,n,r,o,a){e=navigator.userAgent;var i={iphone:/\b(iPhone|iP[ao]d)/.test(e),ipad:/\b(iP[ao]d)/.test(e),android:/Android/i.test(e),nativeApp:/FBAN\/\w+;/i.test(e)&&!/FBAN\/mLite;/.test(e)||/MetaIAB/i.test(e)&&/\b(iPhone|iP[ao]d)/.test(e),nativeAndroidApp:/FB_IAB\/\w+;/i.test(e)||/MetaIAB/i.test(e)&&/Android/i.test(e),nativeInstagramApp:/Instagram/i.test(e),nativeMessengeriOSApp:/MessengerForiOS/i.test(e),nativeMessengerAndroidApp:/Orca\-Android/i.test(e),nativeMetaIAB:/MetaIAB/i.test(e),ucBrowser:/UCBrowser/i.test(e)},l=/Mobile/i.test(e),s={ie:NaN,firefox:NaN,chrome:NaN,webkit:NaN,osx:NaN,edge:NaN,operaMini:NaN,ucWeb:NaN};t=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(e),t&&(s.ie=t[1]?parseFloat(t[1]):t[4]?parseFloat(t[4]):NaN,s.firefox=t[2]||"",s.webkit=t[3]||"",t[3]&&(n=/(?:Chrome\/(\d+\.\d+))/.exec(e),s.chrome=n?n[1]:"",r=/(?:Edge\/(\d+\.\d+))/.exec(e),s.edge=r?r[1]:"")),o=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(e),o&&(s.osx=o[1]),t=/(?:Opera Mini\/(\d+(?:\.\d+)?))/.exec(e),t&&(s.operaMini=t[1]),n=/(?:UCWEB\/(\d+(?:\.\d+))?)/.exec(e),n&&(s.ucWeb=n[1]||"2.0");function u(e){return String(e).split(".").map(function(e){return parseFloat(e)})}var c={};Object.keys(s).map(function(e){var t=function(){return parseFloat(s[e])};t.getVersionParts=function(){return u(s[e])},c[e]=t}),Object.keys(i).map(function(e){c[e]=function(){return i[e]}}),c.mobile=function(){return i.iphone||i.ipad||i.android||l},c.mTouch=function(){return i.android||i.iphone||i.ipad},c.facebookInAppBrowser=function(){return i.nativeApp||i.nativeAndroidApp},c.inAppBrowser=function(){return i.nativeApp||i.nativeAndroidApp||i.nativeInstagramApp||i.nativeMetaIAB},c.mBasic=function(){return!!(s.ucWeb||s.operaMini)},c.instagram=function(){return i.nativeInstagramApp},c.messenger=function(){return i.nativeMessengeriOSApp||i.nativeMessengerAndroidApp},c.isSupportedIABVersion=function(e){if(!c.facebookInAppBrowser())return!1;var t=/(?:FBAV\/(\d+(\.\d+)+))/.exec(navigator.userAgent);return!!(t&&(t=parseFloat(t[1]),t>=e))},r=c,a.default=r},66),t.__d("sdk.domReady",[],function(t,i,n,r,o,a){var e;n="readyState"in document?/loaded|complete/.test(document.readyState):!!document.body;function t(){if(e){for(var t;t=e.shift();)t();e=null}}function i(t){if(e){e.push(t);return}else t()}n||(e=[],document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",t),window.attachEvent("onload",t))),a.default=i},67),t.__d("sdk.Content",["Log","sdk.UA","sdk.domReady"],function(c,t,n,r,o,a,i){"use strict";var e,l;function s(t,o){return o||(e?o=e:(e=o=document.getElementById("fb-root"),o||(r("Log").warn('The "fb-root" div has not been created, auto-creating'),e=o=document.createElement("div"),o.id="fb-root",n("sdk.UA").ie()||!document.body?n("sdk.domReady")(function(){o&&document.body&&document.body.appendChild(o)}):document.body.appendChild(o)),o.className+=" fb_reset")),o.appendChild(t),t}function u(e){if(!l){l=document.createElement("div");var t=l.style;t.position="absolute",t.top="-10000px",t.width="0",t.height="0",l=s(l)}return s(e,l)}function c(e,t){var n=document.createElement("form");n.action=e.url,n.target=e.target,n.method=t?"GET":"POST",u(n);for(t in e.params)if(Object.prototype.hasOwnProperty.call(e.params,t)){var r=e.params[t];if(r!=null){var o=document.createElement("input");o.name=t,o.value=r,n.appendChild(o)}}n.submit(),n.parentNode&&n.parentNode.removeChild(n)}i.append=s,i.appendHidden=u,i.submitToTarget=c},98),t.__d("sdk.DOM",["guid","sdk.domReady"],function(o,a,n,s,u,d,i){var e={},t={};function r(e,t){return e=e.getAttribute(t)||e.getAttribute(t.replace(/_/g,"-"))||e.getAttribute(t.replace(/-/g,"_"))||e.getAttribute(t.replace(/-/g,""))||e.getAttribute(t.replace(/_/g,""))||e.getAttribute("data-"+t)||e.getAttribute("data-"+t.replace(/_/g,"-"))||e.getAttribute("data-"+t.replace(/-/g,"_"))||e.getAttribute("data-"+t.replace(/-/g,""))||e.getAttribute("data-"+t.replace(/_/g,"")),e!=null?String(e):null}function o(e,t){return e=r(e,t),e!=null?/^(true|1|yes|on)$/.test(e):null}function a(e,t){try{e.innerHTML=t}catch(e){throw new Error("Could not set innerHTML : "+e.message)}}function l(e,t){return e=" "+e.className+" ",e.indexOf(" "+t+" ")>=0}function s(e,t){e!=null&&(l(e,t)||(e.className=e.className+" "+t))}function u(e,t){e!=null&&(t=new RegExp("\\s*"+t,"g"),e.className=e.className.replace(t,"").trim())}function d(e,t,n){return n===void 0&&(n="*"),t=t||document.body,t==null?[]:(n=n||"*",c("Array","from",!1,t.querySelectorAll(n+"."+e)))}function m(e,t){t=v(t);var n=document.defaultView.getComputedStyle(e).getPropertyValue(t);return n=e.style.getPropertyValue(t),/background-position?/.test(t)&&/top|left/.test(n)&&(n="0%"),n}function p(e,t,n){e.style.setProperty(v(t),n)}function _(e,t,n,r,o){e=e.styleSheets;for(var a=0;a<e.length;a++){var i;if(e[a].ownerNode instanceof HTMLElement&&e[a].ownerNode.dataset!=null&&((i=e[a].ownerNode.dataset.fbcssmodules)==null?void 0:i.indexOf(t))!==-1&&(i=e[a],i instanceof CSSStyleSheet)){for(var l=0;l<i.cssRules.length;l++){var s=i.cssRules[l];if(s instanceof CSSStyleRule&&s.selectorText===n){s.style.setProperty(v(r),o);return}}i.insertRule(n+"{"+v(r)+":"+((s=o)!=null?s:"")+"}",0)}}}function f(r,o,a){var i;if(a!=null&&a.nodeType===11){var l=a;l.host.id!=null&&t[l.host.id]!=null?i=t[l.host.id]:(l.host.id||(l.host.id=n("guid")()),i={},t[l.host.id]=i)}else i=e;l=!0;for(var s=0,u;u=o[s++];)u in i||(l=!1,i[u]=!0);if(!l){u=document.createElement("style"),u.type="text/css",u.textContent=r;var c="";o.forEach(function(e){return c+=e+" "}),u.setAttribute("data-fbcssmodules",c.trim()),a==null||a===document?document.getElementsByTagName("head")[0].appendChild(u):a.appendChild(u)}}function g(e){return!e||!e.parentNode?null:e.parentNode.removeChild(e)}function h(){var e,t=document.documentElement&&document.compatMode=="CSS1Compat"?document.documentElement:document.body;return{scrollTop:(t==null?void 0:t.scrollTop)||((e=document.body)==null?void 0:e.scrollTop),scrollLeft:(t==null?void 0:t.scrollLeft)||((e=document.body)==null?void 0:e.scrollLeft),width:window.innerWidth?window.innerWidth:t==null?void 0:t.clientWidth,height:window.innerHeight?window.innerHeight:t==null?void 0:t.clientHeight}}var y=/[A-Z]/g,C=/^\([^-]\)-/,b=["o","moz","ms","webkit"];function v(e){e=e.replace(y,"-$&").toLowerCase();var t=e.match(C);return t&&b.indexOf(t[1])!==-1&&(e="-"+e),e}i.getAttr=r,i.getBoolAttr=o,i.html=a,i.containsCss=l,i.addCss=s,i.removeCss=u,i.getByClass=d,i.getStyle=m,i.setStyle=p,i.updateOrAddCssRule=_,i.addCssRules=f,i.remove=g,i.getViewportInfo=h,i.ready=n("sdk.domReady")},98),t.__d("ManagedError",[],function(e,t,n,r,o,a){e=(function(e){d.inheritsLoose(t,e);function t(t,n){var r;return r=e.call(this,t!=null?t:"")||this,t!=null?r.message=t:r.message="",r.innerError=n,r}return t})(d.wrapNativeSuper(Error)),a.default=e},66),t.__d("normalizeError",["sdk.UA"],function(e,t,n,r,o,a,i){"use strict";function e(e){var t={line:e.lineNumber||e.line,message:e.message,name:e.name,script:e.fileName||e.sourceURL||e.script,stack:e.stackTrace||e.stack};t._originalError=e,e=/([\w:\.\/]+\.js):(\d+)/.exec(e.stack),n("sdk.UA").chrome()&&e&&(t.script=e[1],t.line=parseInt(e[2],10));for(e in t)t[e]==null&&delete t[e];return t}i.default=e},98),t.__d("ObservableMixin",[],function(e,t,n,r,o,a){function e(){this.__observableEvents={}}e.prototype={inform:function(t){for(var e=this,n=Array.prototype.slice.call(arguments,1),r=Array.prototype.slice.call(this.getSubscribers(t)),o=function(){if(r[a]===null)return 1;try{r[a].apply(e,n)}catch(e){window.setTimeout(function(){throw e},0)}},a=0;a<r.length;a++)o();return this},getSubscribers:function(t){return this.__observableEvents[t]||(this.__observableEvents[t]=[])},clearSubscribers:function(t){return t&&(this.__observableEvents[t]=[]),this},subscribe:function(t,n){return t=this.getSubscribers(t),t.push(n),this},unsubscribe:function(t,n){t=this.getSubscribers(t);for(var e=0;e<t.length;e++)if(t[e]===n){t.splice(e,1);break}return this}},o.exports=e},null),t.__d("AssertionError",["ManagedError"],function(e,t,n,r,o,a,i){e=(function(e){d.inheritsLoose(t,e);function t(t){return e.call(this,t)||this}return t})(n("ManagedError")),i.default=e},98),t.__d("sprintf",[],function(e,t,n,r,o,a){function e(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=0;return e.replace(/%s/g,function(){return String(n[o++])})}a.default=e},66),t.__d("Assert",["AssertionError","sprintf"],function(s,t,n,r,o,a,i){function e(e,t){if(typeof e!="boolean"||e===!1)throw new(n("AssertionError"))(t);return e}function l(t,r,o){var a;if(r===void 0)a="undefined";else if(r===null)a="null";else{var i=Object.prototype.toString.call(r);i=/\s(\w*)/.exec(i),a=i==null?typeof i:i[1].toLowerCase()}return e(t.indexOf(a)!==-1,(i=o)!=null?i:n("sprintf")("Expression is of type %s, not %s",a,t)),r}function s(t,n,r){return e(n instanceof t,(t=r)!=null?t:"Expression not instance of type"),n}function u(e,t){d["is"+e]=t,d["maybe"+e]=function(e,n){return e==null?e:t(e,n)}}t=function(t,n){return t};var d={isInstanceOf:s,isTrue:e,isTruthy:function(n,r){return e(!!n,r)},isBoolean:t,isFunction:t,isNumber:t,isObject:t,isString:t,isUndefined:t,maybeObject:t,maybeNumber:t,maybeFunction:t};["Boolean","Function","Number","Object","String","Undefined"].forEach(function(e){u(e,c(l,"bind",!0,null,e.toLowerCase()))}),r=d,i.default=r},98),t.__d("Type",["Assert"],function(e,t,n,r,o,a){function i(){var e=this.__mixins;if(e)for(var t=0;t<e.length;t++)e[t].apply(this,arguments)}function l(e,t){if(t instanceof e)return!0;if(t instanceof i){for(var n=0;n<t.__mixins.length;n++)if(t.__mixins[n]==e)return!0}return!1}function s(e,t){var n=e.prototype;for(Array.isArray(t)||(t=[t]),e=0;e<t.length;e++){var r=t[e];typeof r=="function"&&(n.__mixins.push(r),r=r.prototype),Object.keys(r).forEach(function(e){n[e]=r[e]})}}function u(e,n,r){var o=n&&Object.prototype.hasOwnProperty.call(n,"constructor")?n.constructor:function(){this.parent.apply(this,arguments)};if(t("Assert").isFunction(o),e&&!(e.prototype instanceof i))throw new Error("parent type does not inherit from Type");e=e||i;function a(){}return a.prototype=e.prototype,o.prototype=new a,n&&c("Object","assign",!1,o.prototype,n),o.prototype.constructor=o,o.parent=e,o.prototype.__mixins=e.prototype.__mixins?Array.prototype.slice.call(e.prototype.__mixins):[],r&&s(o,r),o.prototype.parent=function(){this.parent=e.prototype.parent,e.apply(this,arguments)},o.prototype.parentCall=function(t){return e.prototype[t].apply(this,Array.prototype.slice.call(arguments,1))},o.extend=function(e,t){return u(this,e,t)},o}c("Object","assign",!1,i.prototype,{instanceOf:function(t){return l(t,this)}}),c("Object","assign",!1,i,{extend:function(t,n){return typeof t=="function"?u.apply(null,arguments):u(null,t,n)},instanceOf:l}),o.exports=i},null),t.__d("sdk.Model",["ObservableMixin","Type"],function(e,t,n,r,o,a,i){"use strict";e=n("Type").extend({constructor:function(t){this.parent();var e={},n=this;Object.keys(t).forEach(function(r){e[r]=t[r],n["set"+r]=function(t){return t===e[r]||(e[r]=t,n.inform(r+".change",t)),n},n["get"+r]=function(){return e[r]}})}},n("ObservableMixin")),t=e,i.default=t},98),t.__d("sdk.Runtime",["JSSDKRuntimeConfig","sdk.Model"],function(e,t,n,r,o,a,i){var l={UNKNOWN:0,PAGETAB:1,CANVAS:2,PLATFORM:4},s=new(n("sdk.Model"))({AccessToken:"",AutoLogAppEvents:!1,ClientID:"",CookieUserID:"",EnforceHttps:!1,Environment:l.UNKNOWN,FamilyLoginLoaded:!1,GraphDomain:"",Initialized:!1,IsSPIN:!!r("JSSDKRuntimeConfig").isSPIN,IsVersioned:!1,KidDirectedSite:void 0,Locale:r("JSSDKRuntimeConfig").locale,LoggedIntoFacebook:void 0,LoginStatus:void 0,Revision:r("JSSDKRuntimeConfig").revision,Rtl:r("JSSDKRuntimeConfig").rtl,Scope:void 0,SDKAB:r("JSSDKRuntimeConfig").sdkab,SDKUrl:r("JSSDKRuntimeConfig").sdkurl,SDKNS:r("JSSDKRuntimeConfig").sdkns,ShouldLoadFamilyLogin:!1,UseCookie:!1,UseLocalStorage:!0,UserID:"",Version:void 0});c("Object","assign",!1,s,{ENVIRONMENTS:l,isEnvironment:function(t){var e=this.getEnvironment();return(t|e)===e},isCanvasEnvironment:function(){return this.isEnvironment(l.CANVAS)||this.isEnvironment(l.PAGETAB)}}),(function(){var e=/app_runner/.test(window.name)?l.PAGETAB:/iframe_canvas/.test(window.name)?l.CANVAS:l.UNKNOWN;(e|l.PAGETAB)===e&&(e|=l.CANVAS),s.setEnvironment(e)})(),e=s,i.default=e},98),t.__d("sdk.ErrorHandler",["ManagedError","normalizeError","sdk.Runtime","wrapFunction"],function(e,t,n,r,o,a,i){function e(e,t){var r="";function o(e){var n=e._originalError;throw delete e._originalError,t(e),n}function a(t,a){return function(){if(!e)return t.apply(this,arguments);try{return r=a,t.apply(this,arguments)}catch(e){if(e instanceof n("ManagedError"))throw e;var i=n("normalizeError")(e);if(!i.script){var l=/.*\/([^?#]+)/.exec(n("sdk.Runtime").getSDKUrl());i.script=l!==null?l[1]:""}i.entry=a;var s=Array.prototype.slice.call(arguments).map(function(e){var t=Object.prototype.toString.call(e);return/^\[object (String|Number|Boolean|Object|Date)\]$/.test(t)?e:e.toString()});i.args=c("JSON","stringify",!1,s).substring(0,200),o(i)}finally{r=""}}}function i(e){return e.__wrapper||(e.__wrapper=function(){try{return e.apply(this,arguments)}catch(e){return window.setTimeout(function(){throw e},0),!1}}),e.__wrapper}function l(e){try{return e&&e.callee&&e.callee.caller?e.callee.caller.name:""}catch(e){return""}}function s(e,t){return function(o,a){var i=t+":"+(r||"[global]")+":"+(o.name||"[anonymous]"+l(arguments));return e(n("wrapFunction")(o,"entry",i),a)}}return e&&(setTimeout=s(setTimeout,"setTimeout"),setInterval=s(setInterval,"setInterval"),n("wrapFunction").setWrapper(a,"entry")),{guard:a,unguard:i}}i.create=e},98),t.__d("QueryString",[],function(t,i,n,r,o,a){function e(e){var t=[];return Object.keys(e).sort().forEach(function(n){var r=e[n];if(r!==void 0){if(r===null){t.push(n);return}t.push(encodeURIComponent(n)+"="+encodeURIComponent(String(r)))}}),t.join("&")}function t(e,t){t===void 0&&(t=!1);var n={};if(e==="")return n;e=e.split("&");for(var r=0;r<e.length;r++){var o=e[r].split("=",2),a=decodeURIComponent(o[0]);if(t&&Object.prototype.hasOwnProperty.call(n,a))throw new URIError("Duplicate key: "+a);n[a]=o.length===2?decodeURIComponent(o[1]):null}return n}function i(t,n){return t+(t.indexOf("?")!==-1?"&":"?")+(typeof n=="string"?n:e(n))}n={encode:e,decode:t,appendToUrl:i},a.default=n},66),t.__d("Env",[],function(e,t,n,r,o,a){t={ajaxpipe_token:null,compat_iframe_token:null,iframeKey:"",iframeTarget:"",iframeToken:"",isCQuick:!1,jssp_header_sent:!1,jssp_targeting_enabled:!1,start:Date.now(),nocatch:!1,useTrustedTypes:!1,isTrustedTypesReportOnly:!1,enableDefaultTrustedTypesPolicy:!1,ig_server_override:"",ig_mqtt_wss_endpoint:"",ig_mqtt_polling_endpoint:"",scheduledCSSJSScheduler:!1},e.Env&&c("Object","assign",!1,t,e.Env),e.Env=t,n=t,a.default=n},66),t.__d("fb-error-lite",[],function(i,t,n,r,o,a){"use strict";var e={PREVIOUS_FILE:1,PREVIOUS_FRAME:2,PREVIOUS_DIR:3,FORCED_KEY:4};function i(t){var n=new Error(t);if(n.stack===void 0)try{throw n}catch(e){}n.messageFormat=t;for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return n.messageParams=o.map(function(e){return String(e)}),n.taalOpcodes=[e.PREVIOUS_FRAME],n}t={err:i,TAALOpcode:e},a.default=t},66),t.__d("invariant",["Env","fb-error-lite","sprintf"],function(e,t,n,r,o,a,i){"use strict";function e(e,t){if(!e){for(var r=t,o=arguments.length,a=new Array(o>2?o-2:0),i=2;i<o;i++)a[i-2]=arguments[i];if(typeof r=="number"){var s=l(r,a),u=s.message,c=s.decoderLink;r=u,a.unshift(c)}else if(r===void 0){r="Invariant: ";for(var d=0;d<a.length;d++)r+="%s,"}var m=r,p=new Error(m);throw p.name="Invariant Violation",p.messageFormat=r,p.messageParams=a.map(function(e){return String(e)}),p.taalOpcodes=[n("fb-error-lite").TAALOpcode.PREVIOUS_FRAME],p.stack,p}}function l(e,t){var r="Minified invariant #"+e+"; %s";return t.length>0&&(r+=" Params: "+t.map(function(e){return"%s"}).join(", ")),e=n("Env").show_invariant_decoder===!0?"visit "+s(e,t)+" to see the full message.":"",{message:r,decoderLink:e}}function s(e,t){return e="https://www.internalfb.com/intern/invariant/"+e+"/",t.length>0&&(e+="?"+t.map(function(e,t){return"args["+t+"]="+encodeURIComponent(String(e))}).join("&")),e}i.default=e},98),t.__d("UrlMap",["invariant","UrlMapConfig","sdk.Runtime"],function(e,t,n,r,o,a,i,l){function e(e){var t="https";if(e==="graph_domain"){var o=n("sdk.Runtime").getGraphDomain();o?e="graph_".concat(o):e="graph"}return e in r("UrlMapConfig")?t+"://"+r("UrlMapConfig")[e]:(e in r("UrlMapConfig")||l(0,2511,e),"")}i.resolve=e},98),t.__d("sdk.Scribe",["QueryString","UrlMap","sdk.Runtime"],function(l,t,n,r,o,a,i){var e={};function l(t,o,a){if(a===void 0&&(a=!1),t==="jssdk_error"){var i=c("JSON","stringify",!1,o);if(Object.prototype.hasOwnProperty.call(e,i))return;e[i]=!0}o.extra!=null&&typeof o.extra=="object"&&(i=o.extra,i.revision=n("sdk.Runtime").getRevision()),i=new Image;var l=r("UrlMap").resolve("www")+"/platform/scribe_endpoint.php/";a||(i.crossOrigin="anonymous"),i.src=n("QueryString").appendToUrl(l,{c:t,m:c("JSON","stringify",!1,d.extends({},o,{isSPIN:n("sdk.Runtime").getIsSPIN()}))})}i.log=l},98),t.__d("sdk.FeatureFunctor",[],function(i,t,n,r,o,a){function e(e,t,n){return e.features&&t in e.features?(e=e.features[t],typeof e=="object"&&typeof e.rate=="number"?e.rate&&Math.random()*100<=e.rate?e.value||!0:e.value?null:!1:e):n}function i(t){return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];if(r.length<2)throw new Error("Default value is required");var a=r[0],i=r[1];return e(t,a,i)}}a.create=i},66),t.__d("sdk.feature",["JSSDKConfig","sdk.FeatureFunctor"],function(e,t,n,r,o,a,i){e=r("sdk.FeatureFunctor").create(r("JSSDKConfig")),i.default=e},98),t.__d("sdk.ErrorHandling",["sdk.ErrorHandler","sdk.Runtime","sdk.Scribe","sdk.feature"],function(e,t,n,r,o,a,i){e=n("sdk.feature")("error_handling",!1),t=r("sdk.ErrorHandler").create(e,function(e){r("sdk.Scribe").log("jssdk_error",{appId:n("sdk.Runtime").getClientID(),error:e.name||e.message,extra:e})}),i.default=t},98),t.__d("FB",["DOMWrapper","GlobalCallback","JSSDKCssConfig","Log","dotAccess","sdk.Content","sdk.DOM","sdk.ErrorHandling","sdk.domReady"],function(u,t,n,r,o,a,i){window.FB&&window.FB.__buffer&&(window.__buffer=d.extends({},window.FB.__buffer));var e=window.FB={};t={},r("Log").setLevel(0),r("GlobalCallback").setPrefix("FB.__globalCallbacks");var l=document.createElement("div");r("DOMWrapper").setRoot(l),n("sdk.domReady")(function(){r("Log").info("domReady"),r("sdk.Content").appendHidden(l),n("JSSDKCssConfig").rules&&r("sdk.DOM").addCssRules(n("JSSDKCssConfig").rules,n("JSSDKCssConfig").components)});function s(e,t,r,o){return n("sdk.ErrorHandling").guard(function(){function r(e){return Array.isArray(e)?e.map(r):e&&typeof e=="object"&&e.__wrapped?e.__wrapped:typeof e=="function"&&/^function/.test(e.toString())?n("sdk.ErrorHandling").unguard(e):e}var a=Array.prototype.slice.call(arguments).map(r),i=e.apply(o,a),l,u=!0;if(i&&typeof i=="object"){l=Object.create(i),l.__wrapped=i;for(var c in i){var d=i[c];typeof d!="function"||c==="constructor"||(u=!1,l[c]=s(d,t+":"+c,c,i))}}return u&&u?i:l},t)}function u(t,r){var o=t?n("dotAccess")(e,t,!0):e;Object.keys(r).forEach(function(e){var n=r[e];if(typeof n=="function"){var a=(t?t+".":"")+e;a=s(n,a,e,r),a&&(o[e]=a)}else(typeof n=="object"||typeof n=="number")&&(o[e]=n)})}c("Object","assign",!1,t,{provide:u}),o=t,i.default=o},98),t.__d("AppUserPropertyAPIBuiltinField",[],function(e,t,n,r,o,a){o.exports={GENDER:"$gender",CITY:"$city",STATE:"$state",ZIPCODE:"$zipcode",COUNTRY:"$country",LANGUAGE:"$language",CURRENCY:"$currency",INSTALL_SOURCE:"$install_source",USER_TYPE:"$user_type",ACCOUNT_CREATED_TIME:"$account_created_time",APP_ID:"$app_id"}},null),t.__d("ArgumentError",["ManagedError"],function(e,t,n,r,o,a,i){e=(function(e){d.inheritsLoose(t,e);function t(t,n){return e.call(this,t,n)||this}return t})(n("ManagedError")),i.default=e},98),t.__d("flattenObject",[],function(e,t,n,r,o,a){"use strict";function e(e){var t={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=e[n];if(r==null)continue;typeof r=="string"?t[n]=r:t[n]=c("JSON","stringify",!1,r)}return t}a.default=e},66),t.__d("performance",[],function(e,t,n,r,o,a){"use strict";t=e.performance||e.msPerformance||e.webkitPerformance||{},n=t,a.default=n},66),t.__d("performanceNow",["performance"],function(e,t,n,r,o,a,i){if(n("performance").now)t=function(){return n("performance").now()};else{r=e._cstart,o=Date.now();var l=typeof r=="number"&&r<o?r:o,s=0;t=function(){var e=Date.now(),t=e-l;return t<s&&(l-=s-t,t=e-l),s=t,t}}a=t,i.default=a},98),t.__d("performanceNowSinceAppStart",["performanceNow"],function(e,t,n,r,o,a,i){i.default=n("performanceNow")},98),t.__d("removeFromArray",[],function(e,t,n,r,o,a){function e(e,t){t=e.indexOf(t),t!==-1&&e.splice(t,1)}a.default=e},66),t.__d("fb-error",["performanceNowSinceAppStart","removeFromArray"],function(e,t,x,$,o,N){"use strict";var n={PREVIOUS_FILE:1,PREVIOUS_FRAME:2,PREVIOUS_DIR:3,FORCED_KEY:4};function r(e){var t=new Error(e);if(t.stack===void 0)try{throw t}catch(e){}t.messageFormat=e;for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return t.messageParams=o.map(function(e){return String(e)}),t.taalOpcodes=[n.PREVIOUS_FRAME],t}var a=!1,i={errorListener:function(n){var t=e.console,r=t[n.type]?n.type:"error";(n.type==="fatal"||r==="error"&&!a)&&(r=n.message,t.error("ErrorUtils caught an error:\n\n"+r+"\n\nSubsequent non-fatal errors won't be logged; see https://fburl.com/debugjs."),a=!0)}},l={access_token:null},s=6,u=6e4,m=10*u,p=new Map,_=0;function f(){var e=t("performanceNowSinceAppStart")();if(e>_+u){for(var n=e-m,a=p,r=Array.isArray(a),o=0,a=r?a:a[typeof Symbol=="function"&&typeof Symbol=="function"?Symbol.iterator:"@@iterator"]();;){var i;if(r){if(o>=a.length)break;i=a[o++]}else{if(o=a.next(),o.done)break;i=o.value}i=i;var l=i[0];i=i[1],i.lastAccessed<n&&p.delete(l)}_=e}}function g(e){f();var n=t("performanceNowSinceAppStart")(),r=p.get(e);if(r==null)return p.set(e,{dropped:0,logged:[n],lastAccessed:n}),1;e=r.dropped;var o=r.logged;for(r.lastAccessed=n;o[0]<n-u;)o.shift();return o.length<s?(r.dropped=0,o.push(n),e+1):(r.dropped++,null)}var h={shouldLog:function(t){return g(t.hash)}},y="RE_EXN_ID";function C(e){var t=null;return e==null||typeof e!="object"?t=r("Non-object thrown: %s",String(e)):Object.prototype.hasOwnProperty.call(e,y)?t=r("Rescript exception thrown: %s",c("JSON","stringify",!1,e)):typeof e.message!="string"?t=r("Non-error thrown: %s, keys: %s",String(e),c("JSON","stringify",!1,Object.keys(e).sort())):Object.isExtensible&&!Object.isExtensible(e)&&(t=r("Non-extensible thrown: %s",String(e.message))),t!=null?(t.taalOpcodes=t.taalOpcodes||[],t.taalOpcodes.push(n.PREVIOUS_FRAME),t):e}var b=typeof window=="undefined"?"<self.onerror>":"<window.onerror>",v;function S(e){var t=e.error!=null?C(e.error):r(e.message||"");t.fileName==null&&e.filename!=null&&(t.fileName=e.filename),t.line==null&&e.lineno!=null&&(t.line=e.lineno),t.column==null&&e.colno!=null&&(t.column=e.colno),t.guardList=[b],t.loggingSource="ONERROR",(e=v)===null||e===void 0||e.reportError(t)}var R={setup:function(n){typeof e.addEventListener=="function"&&v==null&&(v=n,e.addEventListener("error",S))}},L=[],E={pushGuard:function(t){L.unshift(t)},popGuard:function(){L.shift()},inGuard:function(){return L.length!==0},cloneGuardList:function(){return L.map(function(e){return e.name})},findDeferredSource:function(){for(var e=0;e<L.length;e++){var t=L[e];if(t.deferredSource!=null)return t.deferredSource}}};function k(e){return e.type!=null?e.type:e.loggingSource=="GUARDED"||e.loggingSource=="ERROR_BOUNDARY"||e.name=="SyntaxError"?"fatal":e.loggingSource=="ONERROR"&&e.message.indexOf("ResizeObserver loop")>=0||e.stack!=null&&e.stack.indexOf("chrome-extension://")>=0?"warn":"error"}var I=[],T=(function(){function e(){this.metadata=[].concat(I)}var t=e.prototype;return t.addEntries=function(){var e;return(e=this.metadata).push.apply(e,arguments),this},t.addEntry=function(e,t,n){return this.metadata.push([e,t,n]),this},t.isEmpty=function(){return this.metadata.length===0},t.clearEntries=function(){this.metadata=[]},t.format=function(){var e=[];return this.metadata.forEach(function(t){t&&t.length&&(t=t.map(function(e){return e!=null?String(e).replace(/:/g,"_"):""}).join(":"),e.push(t))}),e},t.getAll=function(){return this.metadata},e.addGlobalMetadata=function(e,t,n){I.push([e,t,n])},e.getGlobalMetadata=function(){return I},e.unsetGlobalMetadata=function(e,t){I=I.filter(function(n){return!(Array.isArray(n)&&n[0]===e&&n[1]===t)})},e})(),D={debug:1,info:2,warn:3,error:4,fatal:5};function x(e,t){if(!Object.isFrozen(e)){t.type&&(!e.type||D[e.type]>D[t.type])&&(e.type=t.type);var n=t.metadata;if(n!=null){var r;r=(r=e.metadata)!==null&&r!==void 0?r:new T,n!=null&&r.addEntries.apply(r,n.getAll()),e.metadata=r}if(t.project!=null&&(e.project=t.project),t.errorName!=null&&(e.errorName=t.errorName),t.componentStack!=null&&(e.componentStack=t.componentStack),t.deferredSource!=null&&(e.deferredSource=t.deferredSource),t.blameModule!=null&&(e.blameModule=t.blameModule),t.loggingSource!=null&&(e.loggingSource=t.loggingSource),r=(n=e.messageFormat)!==null&&n!==void 0?n:e.message,n=(n=e.messageParams)!==null&&n!==void 0?n:[],r!==t.messageFormat&&t.messageFormat!=null){var o;r+=" [Caught in: "+t.messageFormat+"]",n.push.apply(n,(o=t.messageParams)!==null&&o!==void 0?o:[])}e.messageFormat=r,e.messageParams=n,o=t.forcedKey,r=e.forcedKey,n=o!=null&&r!=null?o+"_"+r:o!=null?o:r,e.forcedKey=n}}function $(e){var t;return P((t=e.messageFormat)!==null&&t!==void 0?t:e.message,e.messageParams||[])}function P(e,t){var n=0;return e=e.replace(/%s/g,function(){return n<t.length?t[n++]:"NOPARAM"}),n<t.length&&(e+=" PARAMS"+c("JSON","stringify",!1,t.slice(n))),e}function N(e){return(e!=null?e:[]).map(function(e){return String(e)})}var M={aggregateError:x,toReadableMessage:$,toStringParams:N},w=5,A=[];function F(e){A.push(e),A.length>w&&A.shift()}function O(e){var t=e.getAllResponseHeaders();t!=null&&t.indexOf("X-FB-Debug")>=0&&(t=e.getResponseHeader("X-FB-Debug"),t&&F(t))}function B(){return A}var W={add:F,addFromXHR:O,getAll:B},q="abcdefghijklmnopqrstuvwxyz012345";function U(){for(var e=0,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var o=0;o<n.length;o++){var a=n[o];if(a!=null)for(var i=a.length,l=0;l<i;l++)e=(e<<5)-e+a.charCodeAt(l)}for(var s="",u=0;u<6;u++)s=q.charAt(e&31)+s,e>>=5;return s}var V=[/\(([^\s\)\()]+):(\d+):(\d+)\)$/,/@([^\s\)\()]+):(\d+):(\d+)$/,/^([^\s\)\()]+):(\d+):(\d+)$/,/^at ([^\s\)\()]+):(\d+):(\d+)$/],H=/^\w+:\s.*?\n/g;Error.stackTraceLimit!=null&&Error.stackTraceLimit<80&&(Error.stackTraceLimit=80);function G(e){var t=e.name,n=e.message;if(e=e.stack,e==null)return null;if(t!=null&&n!=null&&n!==""){var r=t+": "+n+"\n";if(c(e,"startsWith",!0,r))return e.substr(r.length);if(e===t+": "+n)return null}return t!=null&&(r=t+"\n",c(e,"startsWith",!0,r))?e.substr(r.length):n!=null&&n!==""&&(t=": "+n+"\n",r=e.indexOf(t),n=e.substring(0,r),/^\w+$/.test(n))?e.substring(r+t.length):e.replace(H,"")}function z(e){e=e.trim();var t,n,r,o;if(c(e,"includes",!0,"charset=utf-8;base64,"))t="<inlined-file>";else{for(var a,i=0;i<V.length;i++){var l=V[i];if(a=e.match(l),a!=null)break}a!=null&&a.length===4?(n=a[1],r=parseInt(a[2],10),o=parseInt(a[3],10),t=e.substring(0,e.length-a[0].length)):t=e,t=t.replace(/^at /,"").trim()}return l={identifier:t,script:n,line:r,column:o},l.text=X(l),l}function j(e){return e==null||e===""?[]:e.split(/\n\n/)[0].split("\n").map(z)}function K(e){return e=G(e),j(e)}function Q(e){return e==null||e===""?null:(e=e.split("\n"),e.splice(0,1),e.map(function(e){return e.trim()}))}function X(e){var t=e.identifier,n=e.script,r=e.line;return e=e.column,t="    at "+(t!=null?t:"<unknown>"),n!=null&&r!=null&&e!=null&&(t+=" ("+n+":"+r+":"+e+")"),t}function Y(r){var o,a,i,l,s,u,c=K(r);o=(o=r.taalOpcodes)!==null&&o!==void 0?o:[];var d=r.framesToPop;if(d!=null)for(d=Math.min(d,c.length);d-- >0;)o.unshift(n.PREVIOUS_FRAME);d=(d=r.messageFormat)!==null&&d!==void 0?d:r.message,a=((a=r.messageParams)!==null&&a!==void 0?a:[]).map(function(e){return String(e)});var m=Q(r.componentStack),p=m==null?null:m.map(z),_=r.metadata?r.metadata.format():new T().format();_.length===0&&(_=void 0);var f=c.map(function(e){return e.text}).join("\n");i=(i=r.errorName)!==null&&i!==void 0?i:r.name;var g=k(r),h=r.loggingSource,y=r.project;l=(l=r.lineNumber)!==null&&l!==void 0?l:r.line,s=(s=r.columnNumber)!==null&&s!==void 0?s:r.column,u=(u=r.fileName)!==null&&u!==void 0?u:r.sourceURL;var C=c.length>0;C&&l==null&&(l=c[0].line),C&&s==null&&(s=c[0].column),C&&u==null&&(u=c[0].script),p={blameModule:r.blameModule,column:s==null?null:String(s),clientTime:Math.floor(Date.now()/1e3),componentStackFrames:p,deferredSource:r.deferredSource!=null?Y(r.deferredSource):null,extra:(C=r.extra)!==null&&C!==void 0?C:{},fbtrace_id:r.fbtrace_id,guardList:(s=r.guardList)!==null&&s!==void 0?s:[],hash:U(i,f,g,y,h),isNormalizedError:!0,line:l==null?null:String(l),loggingSource:h,message:M.toReadableMessage(r),messageFormat:d,messageParams:a,metadata:_,name:i,page_time:Math.floor(t("performanceNowSinceAppStart")()),project:y,reactComponentStack:m,script:u,serverHash:r.serverHash,stack:f,stackFrames:c,type:g,xFBDebug:W.getAll()},r.forcedKey!=null&&(p.forcedKey=r.forcedKey),o.length>0&&(p.taalOpcodes=o),C=e.location,C&&(p.windowLocationURL=C.href);for(s in p)p[s]==null&&delete p[s];return p}function J(e){return e!=null&&typeof e=="object"&&e.isNormalizedError===!0?e:null}var Z={formatStackFrame:X,normalizeError:Y,ifNormalizedError:J},ee="<global.react>",te=[],ne=[],re=50,oe=!1,ae={history:ne,addListener:function(t,n){n===void 0&&(n=!1),te.push(t),n||ne.forEach(function(e){return t(e,(e=e.loggingSource)!==null&&e!==void 0?e:"DEPRECATED")})},unshiftListener:function(t){te.unshift(t)},removeListener:function(n){t("removeFromArray")(te,n)},reportError:function(t){t=Z.normalizeError(t),ae.reportNormalizedError(t)},reportNormalizedError:function(t){if(oe)return!1;var e=E.cloneGuardList();for(t.componentStackFrames&&e.unshift(ee),e.length>0&&(t.guardList=e),t.deferredSource==null&&(e=E.findDeferredSource(),e!=null&&(t.deferredSource=Z.normalizeError(e))),ne.length>re&&ne.splice(re/2,1),ne.push(t),oe=!0,e=0;e<te.length;e++)try{var n;te[e](t,(n=t.loggingSource)!==null&&n!==void 0?n:"DEPRECATED")}catch(e){}return oe=!1,!0}};ae.addListener(i.errorListener);var ie="<anonymous guard>",le=!1,se={applyWithGuard:function(t,n,r,o){if(E.pushGuard({name:((o==null?void 0:o.name)!=null?o.name:null)||(t.name?"func_name:"+t.name:null)||ie,deferredSource:o==null?void 0:o.deferredSource}),le)try{return t.apply(n,r)}finally{E.popGuard()}try{return Function.prototype.apply.call(t,n,r)}catch(l){try{n=o!=null?o:d.extends({},null);var e=n.deferredSource,a=n.onError;n=n.onNormalizedError;var i=C(l);e={deferredSource:e,loggingSource:"GUARDED",project:(e=o==null?void 0:o.project)!==null&&e!==void 0?e:"ErrorGuard",type:o==null?void 0:o.errorType},M.aggregateError(i,e),o=Z.normalizeError(i),i==null&&t&&(o.extra[t.toString().substring(0,100)]="function",r!=null&&r.length&&(o.extra[c("Array","from",!1,r).toString().substring(0,100)]="args")),o.guardList=E.cloneGuardList(),a&&a(i),n&&n(o),ae.reportNormalizedError(o)}catch(e){}}finally{E.popGuard()}},guard:function(t,n){function e(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return se.applyWithGuard(t,this,r,n)}return t.__SMmeta&&(e.__SMmeta=t.__SMmeta),e},inGuard:function(){return E.inGuard()},skipGuardGlobal:function(t){le=t}},ue=1024,ce=[],de=0;function me(e){return String(e)}function pe(e){return e==null?null:String(e)}function _e(e,t){var n={};return t&&t.forEach(function(e){n[e]=!0}),Object.keys(e).forEach(function(t){e[t]?n[t]=!0:n[t]&&delete n[t]}),Object.keys(n)}function fe(e){return(e!=null?e:[]).map(function(e){return{column:pe(e.column),identifier:e.identifier,line:pe(e.line),script:e.script}})}function ge(e){return e=String(e),e.length>ue?e.substring(0,ue-3)+"...":e}function he(e,t){var n;n={appId:pe(t.appId),cavalry_lid:t.cavalry_lid,access_token:l.access_token,ancestor_hash:e.hash,bundle_variant:(n=t.bundle_variant)!==null&&n!==void 0?n:null,clientTime:me(e.clientTime),column:e.column,componentStackFrames:fe(e.componentStackFrames),events:e.events,extra:_e(e.extra,t.extra),forcedKey:e.forcedKey,frontend_env:(n=t.frontend_env)!==null&&n!==void 0?n:null,guardList:e.guardList,line:e.line,loggingFramework:t.loggingFramework,messageFormat:ge(e.messageFormat),messageParams:e.messageParams.map(ge),name:e.name,sample_weight:pe(t.sample_weight),script:e.script,site_category:t.site_category,stackFrames:fe(e.stackFrames),type:e.type,page_time:pe(e.page_time),project:e.project,push_phase:t.push_phase,report_source:t.report_source,report_source_ref:t.report_source_ref,rollout_hash:(n=t.rollout_hash)!==null&&n!==void 0?n:null,script_path:t.script_path,server_revision:pe(t.server_revision),spin:pe(t.spin),svn_rev:String(t.client_revision),additional_client_revisions:c("Array","from",!1,(n=t.additional_client_revisions)!==null&&n!==void 0?n:[]).map(me),taalOpcodes:e.taalOpcodes==null?null:e.taalOpcodes.map(function(e){return e}),web_session_id:t.web_session_id,version:"3",xFBDebug:e.xFBDebug},t=e.blameModule;var r=e.deferredSource;return t!=null&&(n.blameModule=String(t)),r&&r.stackFrames&&(n.deferredSource={stackFrames:fe(r.stackFrames)}),e.metadata&&(n.metadata=e.metadata),e.loadingUrls&&(n.loadingUrls=e.loadingUrls),e.serverHash!=null&&(n.serverHash=e.serverHash),e.windowLocationURL!=null&&(n.windowLocationURL=e.windowLocationURL),e.loggingSource!=null&&(n.loggingSource=e.loggingSource),n}function ye(e,t,n){var r;if(de++,t.sample_weight===0)return!1;var o=h.shouldLog(e);return o==null||(r=t.projectBlocklist)!==null&&r!==void 0&&c(r,"includes",!0,e.project)?!1:(r=he(e,t),c("Object","assign",!1,r,{ancestors:ce.slice(),clientWeight:me(o),page_position:me(de)}),ce.length<15&&ce.push(e.hash),n(r),!0)}var Ce={createErrorPayload:he,postError:ye},be=null,ve=!1;function Se(e){if(be!=null){var t=be,n=e.reason,o;if(n!=null&&typeof n=="object"&&(n.name==null||n.name===""||n.message==null||n.message===""))try{o=r("UnhandledRejection: %s",c("JSON","stringify",!1,n)),o.loggingSource="ONUNHANDLEDREJECTION"}catch(e){o=r("UnhandledRejection: (circular) %s",Object.keys(n).join(",")),o.loggingSource="ONUNHANDLEDREJECTION"}else o=C(n),o.loggingSource||(o.loggingSource="ONUNHANDLEDREJECTION");try{n=e.promise,o.stack=String(o.stack||"")+(n!=null&&typeof n.settledStack=="string"?"\n(<promise_settled_stack_below>)\n"+n.settledStack:"")+(n!=null&&typeof n.createdStack=="string"?"\n(<promise_created_stack_below>)\n"+n.createdStack:"")}catch(e){}t.reportError(o),e.preventDefault()}}function Re(t){be=t,typeof e.addEventListener=="function"&&!ve&&(ve=!0,e.addEventListener("unhandledrejection",Se))}var Le={onunhandledrejection:Se,setup:Re};x={preSetup:function(t){(t==null||t.ignoreOnError!==!0)&&R.setup(ae),(t==null||t.ignoreOnUnahndledRejection!==!0)&&Le.setup(ae)},setup:function(t,n){ae.addListener(function(e){Ce.postError(e,t,n)})}};var Ee=(function(){function e(e){this.project=e,this.events=[],this.metadata=new T,this.taalOpcodes=[]}var t=e.prototype;return t.$1=function(t,r){for(var o=String(r),a=this.events,i=this.project,l=this.metadata,s=this.blameModule,u=this.forcedKey,m=this.error,p,_=arguments.length,f=new Array(_>2?_-2:0),g=2;g<_;g++)f[g-2]=arguments[g];if(this.normalizedError){var h={message:this.normalizedError.messageFormat+" [Caught in: "+o+"]",params:[].concat(this.normalizedError.messageParams,f),forcedKey:u};p=d.extends({},this.normalizedError,{message:h.message,messageFormat:h.message,messageParams:M.toStringParams(h.params),project:i,type:t,loggingSource:"FBLOGGER"})}else if(m)this.taalOpcodes.length>0&&new e("fblogger").blameToPreviousFrame().blameToPreviousFrame().warn("Blame helpers do not work with catching"),M.aggregateError(m,{messageFormat:o,messageParams:M.toStringParams(f),errorName:m.name,forcedKey:u,project:i,type:t,loggingSource:"FBLOGGER"}),p=Z.normalizeError(m);else{if(m=new Error(o),m.stack===void 0)try{throw m}catch(e){}m.messageFormat=o,m.messageParams=M.toStringParams(f),m.blameModule=s,m.forcedKey=u,m.project=i,m.type=t,m.loggingSource="FBLOGGER",m.taalOpcodes=[n.PREVIOUS_FRAME,n.PREVIOUS_FRAME].concat(this.taalOpcodes),p=Z.normalizeError(m),p.name="FBLogger"}if(!l.isEmpty())if(p.metadata==null)p.metadata=l.format();else{var y=p.metadata.concat(l.format()),C=new Set(y);p.metadata=c("Array","from",!1,C.values())}if(a.length>0)if(p.events!=null){var b;(b=p.events).push.apply(b,a)}else p.events=a;return ae.reportNormalizedError(p),m},t.fatal=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.$1.apply(this,["fatal",e].concat(n))},t.mustfix=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.$1.apply(this,["error",e].concat(n))},t.warn=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.$1.apply(this,["warn",e].concat(n))},t.info=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.$1.apply(this,["info",e].concat(n))},t.debug=function(e){},t.mustfixThrow=function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),a=1;a<t;a++)o[a-1]=arguments[a];var i=this.$1.apply(this,["error",e].concat(o));throw i||(i=r("mustfixThrow does not support catchingNormalizedError"),i.taalOpcodes=i.taalOpcodes||[],i.taalOpcodes.push(n.PREVIOUS_FRAME)),i},t.catching=function(t){return t instanceof Error?this.error=t:new e("fblogger").blameToPreviousFrame().warn("Catching non-Error object is not supported"),this},t.catchingNormalizedError=function(e){return this.normalizedError=e,this},t.event=function(e){return this.events.push(e),this},t.blameToModule=function(e){return this.blameModule=e,this},t.blameToPreviousFile=function(){return this.taalOpcodes.push(n.PREVIOUS_FILE),this},t.blameToPreviousFrame=function(){return this.taalOpcodes.push(n.PREVIOUS_FRAME),this},t.blameToPreviousDirectory=function(){return this.taalOpcodes.push(n.PREVIOUS_DIR),this},t.addToCategoryKey=function(e){return this.forcedKey=e,this},t.addMetadata=function(e,t,n){return this.metadata.addEntry(e,t,n),this},e})();$=function(t,n){var e=new Ee(t);return n!=null?e.event(t+"."+n):e},$.addGlobalMetadata=function(e,t,n){T.addGlobalMetadata(e,t,n)},N={blameToPreviousFile:function(t){var e;return t.taalOpcodes=(e=t.taalOpcodes)!==null&&e!==void 0?e:[],t.taalOpcodes.push(n.PREVIOUS_FILE),t},blameToPreviousFrame:function(t){var e;return t.taalOpcodes=(e=t.taalOpcodes)!==null&&e!==void 0?e:[],t.taalOpcodes.push(n.PREVIOUS_FRAME),t},blameToPreviousDirectory:function(t){var e;return t.taalOpcodes=(e=t.taalOpcodes)!==null&&e!==void 0?e:[],t.taalOpcodes.push(n.PREVIOUS_DIR),t}},O={err:r,ErrorBrowserConsole:i,ErrorDynamicData:l,ErrorFilter:h,ErrorGlobalEventHandler:R,ErrorGuard:se,ErrorGuardState:E,ErrorMetadata:T,ErrorNormalizeUtils:Z,ErrorPoster:Ce,ErrorPubSub:ae,ErrorSerializer:M,ErrorSetup:x,ErrorXFBDebug:W,FBLogger:$,getErrorSafe:C,getSimpleHash:U,TAAL:N,TAALOpcode:n},o.exports=O},null),t.__d("FBLogger",["fb-error"],function(e,t,n,r,o,a,i){"use strict";i.default=n("fb-error").FBLogger},98),t.__d("BaseDeserializePHPQueryData",[],function(l,t,n,r,o,a){"use strict";var e=/^([-_\w]+)((?:\[[-_\w]*\])+)=?(.*)/;function i(e){return e==="hasOwnProperty"||e==="__proto__"?"\uD83D\uDF56":e}function l(t,n){if(t==null||t==="")return{};var r={};t=t.replace(/%5B/gi,"[").replace(/%5D/gi,"]"),t=t.split("&");for(var o=Object.prototype.hasOwnProperty,a=0,l=t.length;a<l;a++){var s=t[a].match(e);if(s){c=s[2].split(/\]\[|\[|\]/).slice(0,-1),u=s[1],s=n(s[3]||""),c[0]=u,u=r;for(var d=0;d<c.length-1;d++){var m=i(c[d]);if(m){if(!o.call(u,m)){var p=c[d+1]&&!c[d+1].match(/^\d{1,3}$/)?{}:[];if(u[m]=p,u[m]!==p)return r}u=u[m]}else c[d+1]&&!c[d+1].match(/^\d{1,3}$/)?u.push({}):u.push([]),u=u[u.length-1]}u instanceof Array&&c[c.length-1]===""?u.push(s):u[i(c[c.length-1])]=s}else{var u=t[a].indexOf("=");if(u===-1)r[n(t[a])]=null;else{var c=t[a].substring(0,u);u=t[a].substring(u+1),r[n(c)]=n(u)}}}return r}a.deserialize=l},66),t.__d("flattenPHPQueryData",["invariant"],function(e,t,n,r,o,a,i,l){function e(e){return s(e,"",{})}function s(e,t,n){if(e==null)n[t]=void 0;else if(typeof e=="object"){typeof e.appendChild!="function"||l(0,2616);for(var r in e)r!=="$$typeof"&&Object.prototype.hasOwnProperty.call(e,r)&&e[r]!==void 0&&s(e[r],t?t+"["+r+"]":r,n)}else n[t]=e;return n}i.default=e},98),t.__d("PHPQuerySerializer",["BaseDeserializePHPQueryData","flattenPHPQueryData"],function(e,l,n,r,o,a,i){function e(e){var r=[];e=n("flattenPHPQueryData")(e);for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=t(o);e[o]===void 0?r.push(a):r.push(a+"="+t(String(e[o])))}return r.join("&")}function t(e){return encodeURIComponent(e).replace(/%5D/g,"]").replace(/%5B/g,"[")}function l(e){return r("BaseDeserializePHPQueryData").deserialize(e,s)}function s(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}}o={decodeComponent:s,deserialize:l,encodeComponent:t,serialize:e},a.exports=o},34),t.__d("PHPStrictQuerySerializer",["PHPQuerySerializer","flattenPHPQueryData"],function(e,t,n,r,o,a,i){function e(e){var t=[];e=n("flattenPHPQueryData")(e);for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=l(r);e[r]===void 0?t.push(o):t.push(o+"="+l(String(e[r])))}return t.join("&")}function l(e){return encodeURIComponent(e)}i.serialize=e,i.encodeComponent=l,i.deserialize=r("PHPQuerySerializer").deserialize,i.decodeComponent=r("PHPQuerySerializer").decodeComponent},98),t.__d("URIRFC3986",[],function(i,t,n,r,o,a){var e=new RegExp("^([^:/?#]+:)?(//([^\\\\/?#@]*@)?(\\[[A-Fa-f0-9:.]+\\]|[^\\/?#:]*)(:[0-9]*)?)?([^?#]*)(\\?[^#]*)?(#.*)?");function i(t){if(t.trim()===""||(t=t.match(e),t==null))return null;var n=t[2]?t[2].substr(2):null,r=t[1]?t[1].substr(0,t[1].length-1):null;return t={uri:t[0]?t[0]:null,scheme:r,authority:n,userinfo:t[3]?t[3].substr(0,t[3].length-1):null,host:t[2]?t[4]:null,port:t[5]&&t[5].substr(1)?parseInt(t[5].substr(1),10):null,path:t[6]?t[6]:null,query:t[7]?t[7].substr(1):null,fragment:t[8]?t[8].substr(1):null,isGenericURI:n===null&&!!r},t}a.parse=i},66),t.__d("createObjectFrom",[],function(e,t,n,r,o,a){function i(e,t){if(t===void 0)return i(e,!0);var n={};if(Array.isArray(t))for(var r=e.length-1;r>=0;r--)n[e[r]]=t[r];else for(r=e.length-1;r>=0;r--)n[e[r]]=t;return n}a.default=i},66),t.__d("URISchemes",["createObjectFrom"],function(l,t,n,r,o,a,i){"use strict";var e=n("createObjectFrom")(["apk","accountscenter","aidemos","aistudio","blob","cmms","fb","fba","fbatwork","fb-ama","fb-internal","fb-workchat","fb-workchat-secure","fb-messenger","fb-messenger-public","fb-messenger-group-thread","fb-page-messages","fb-pma","fbcf","fbconnect","fbinternal","fbmobilehome","fbrpc","file","flipper","ftp","gtalk","http","https","mailto","wss","ms-app","intent","itms","itms-apps","itms-services","lasso","market","svn+ssh","fbstaging","tel","sms","pebblejs","sftp","whatsapp","moments","flash","fblite","chrome-extension","webcal","instagram","iglite","fb124024574287414","fb124024574287414rc","fb124024574287414master","fb1576585912599779","fb929757330408142","designpack","fbpixelcloud","fbapi20130214","fb1196383223757595","tbauth","oculus","oculus.store","oculus.feed","oculusstore","odh","com.oculus.rd","aria","skype","ms-windows-store","callto","messenger","workchat","fb236786383180508","fb1775440806014337","data","fb-mk","munki","origami-file","fb-nimble-vrsrecorder","fb-nimble-monohandtrackingvis","together","togetherbl","horizonlauncher","venues","whatsapp-consumer","whatsapp-smb","fb-ide-opener","fb-vscode","fb-vscode-insiders","editor","spark-studio","arstudio","manifold","origami-internal","origami-public","stella","mwa","mattermost","logaggregator","workrooms","pcoip","cinema","home","oculus360photos","systemux"]);function l(t){return t==null||t===""?!0:Object.prototype.hasOwnProperty.call(e,t.toLowerCase())}i.isAllowed=l},98),t.__d("isSameOrigin",[],function(e,t,n,r,o,a){"use strict";function e(e,t){return!e.getProtocol()||!e.getDomain()||!t.getProtocol()||!t.getDomain()?!1:e.getOrigin()===t.getOrigin()}a.default=e},66),t.__d("setHostSubdomain",[],function(e,t,n,r,o,a){"use strict";function e(e,t){return e=e.split("."),e.length<3?e.unshift(t):e[0]=t,e.join(".")}a.default=e},66),t.__d("URIAbstractBase",["invariant","FBLogger","PHPStrictQuerySerializer","URIRFC3986","URISchemes","isSameOrigin","setHostSubdomain"],function(e,t,n,r,o,a,i){var l,s,u=new RegExp("[\\x00-\\x2c\\x2f\\x3b-\\x40\\x5c\\x5e\\x60\\x7b-\\x7f\\uFDD0-\\uFDEF\\uFFF0-\\uFFFF\\u2047\\u2048\\uFE56\\uFE5F\\uFF03\\uFF0F\\uFF1F]"),d=new RegExp("^(?:[^/]*:|[\\x00-\\x1f]*/[\\x00-\\x1f]*/)"),m=[];e=(function(){"use strict";e.parse=function(n,r,o,a){if(!r)return!0;if(r instanceof e)return n.setProtocol(r.getProtocol()),n.setDomain(r.getDomain()),n.setPort(r.getPort()),n.setPath(r.getPath()),n.setQueryData(a.deserialize(a.serialize(r.getQueryData()))),n.setFragment(r.getFragment()),n.setIsGeneric(r.getIsGeneric()),n.setForceFragmentSeparator(r.getForceFragmentSeparator()),n.setOriginalRawQuery(r.getOriginalRawQuery()),n.setQueryParamModified(!1),!0;r=r.toString().trim();var i=(l||(l=t("URIRFC3986"))).parse(r)||{fragment:null,scheme:null,query:null};if(!o&&!(s||(s=t("URISchemes"))).isAllowed(i.scheme)||(n.setProtocol(i.scheme||""),!o&&u.test(i.host||"")))return!1;if(n.setDomain(i.host||""),n.setPort(i.port||""),n.setPath(i.path||""),o)n.setQueryData(a.deserialize(i.query||"")||{});else try{n.setQueryData(a.deserialize(i.query||"")||{})}catch(e){return!1}if(n.setFragment(i.fragment||""),i.fragment===""&&n.setForceFragmentSeparator(!0),n.setIsGeneric(i.isGenericURI||!1),n.setOriginalRawQuery(i.query),n.setQueryParamModified(!1),i.userinfo!==null){if(o)throw new Error("URI.parse: invalid URI (userinfo is not allowed in a URI): "+r);return!1}if(!n.getDomain()&&n.getPath().indexOf("\\")!==-1){if(o)throw new Error("URI.parse: invalid URI (no domain but multiple back-slashes): "+r);return!1}if(!n.getProtocol()&&d.test(r)){if(o)throw new Error("URI.parse: invalid URI (unsafe protocol-relative URLs): "+r+"'");return!1}if(n.getDomain()&&n.getPath()&&!c(n.getPath(),"startsWith",!0,"/")){if(o)throw new Error("URI.parse: invalid URI (domain and path where path lacks leading slash): "+r);return!1}return n.getProtocol()&&!n.getIsGeneric()&&!n.getDomain()&&n.getPath()!==""&&t("FBLogger")("uri").warn('URI.parse: invalid URI (protocol "'+n.getProtocol()+'" with no domain)'),!0},e.tryParse=function(t,n){var r=new e(null,n);return e.parse(r,t,!1,n)?r:null},e.isValid=function(t,n){return!!e.tryParse(t,n)};function e(t,n){n||i(0,2966),this.$9=n,this.$7="",this.$1="",this.$6="",this.$5="",this.$3="",this.$4=!1,this.$8={},this.$2=!1,e.parse(this,t,!0,n),this.$11=!1}var n=e.prototype;return n.setProtocol=function(e){return(s||(s=t("URISchemes"))).isAllowed(e)||i(0,11793,e),this.$7=e,this},n.getProtocol=function(){return(this.$7||"").toLowerCase()},n.setSecure=function(e){return this.setProtocol(e?"https":"http")},n.isSecure=function(){return this.getProtocol()==="https"},n.setDomain=function(e){if(u.test(e))throw new Error("URI.setDomain: unsafe domain specified: "+e+" for url "+this.toString());return this.$1=e,this},n.getDomain=function(){return this.$1},n.setPort=function(e){return this.$6=e,this},n.getPort=function(){return this.$6},n.setPath=function(e){return this.$5=e,this},n.getPath=function(){return this.$5},n.addQueryData=function(e,t){return Object.prototype.toString.call(e)==="[object Object]"?c("Object","assign",!1,this.$8,e):this.$8[e]=t,this.$11=!0,this},n.setQueryData=function(e){return this.$8=e,this.$11=!0,this},n.getQueryData=function(){return this.$8},n.setQueryString=function(e){return this.setQueryData(this.$9.deserialize(e))},n.getQueryString=function(e,t,n){return e===void 0&&(e=!1),t===void 0&&(t=function(){return!1}),n===void 0&&(n=null),this.$12(!1,e,t,n)},n.$12=function(e,t,n,r){return e===void 0&&(e=!1),t===void 0&&(t=!1),n===void 0&&(n=function(){return!1}),r===void 0&&(r=null),!this.$11&&(t||n(this.getDomain()))?(t=this.$10)!=null?t:"":(e&&r?r:this.$9).serialize(this.getQueryData())},n.removeQueryData=function(e){Array.isArray(e)||(e=[e]);for(var t=0,n=e.length;t<n;++t)delete this.$8[e[t]];return this.$11=!0,this},n.setFragment=function(e){return this.$3=e,this.setForceFragmentSeparator(!1),this},n.getFragment=function(){return this.$3},n.setForceFragmentSeparator=function(e){return this.$2=e,this},n.getForceFragmentSeparator=function(){return this.$2},n.setIsGeneric=function(e){return this.$4=e,this},n.getIsGeneric=function(){return this.$4},n.getOriginalRawQuery=function(){return this.$10},n.setOriginalRawQuery=function(e){return this.$10=e,this},n.setQueryParamModified=function(e){return this.$11=e,this},n.isEmpty=function(){return!(this.getPath()||this.getProtocol()||this.getDomain()||this.getPort()||Object.keys(this.getQueryData()).length>0||this.getFragment())},n.toString=function(e,t){return e===void 0&&(e=function(){return!1}),t===void 0&&(t=null),this.$13(!1,!1,e,t)},n.toStringRawQuery=function(e,t){return e===void 0&&(e=function(){return!1}),t===void 0&&(t=null),this.$13(!0,!1,e,t)},n.toStringPreserveQuery=function(e,t){return e===void 0&&(e=function(){return!1}),t===void 0&&(t=null),this.$13(!1,!0,e,t)},n.toStringStrictQueryEncoding=function(e){return e===void 0&&(e=function(){return!1}),this.$13(!0,!1,e,t("PHPStrictQuerySerializer"))},n.$13=function(e,t,n,r){e===void 0&&(e=!1),t===void 0&&(t=!1),n===void 0&&(n=function(){return!1}),r===void 0&&(r=null);for(var o=this,a=0;a<m.length;a++)o=m[a](o);return o.$14(e,t,n,r)},n.$14=function(e,t,n,r){e===void 0&&(e=!1),t===void 0&&(t=!1),n===void 0&&(n=function(){return!1}),r===void 0&&(r=null);var o="",a=this.getProtocol();return a&&(o+=a+":"+(this.getIsGeneric()?"":"//")),a=this.getDomain(),a&&(o+=a),a=this.getPort(),a&&(o+=":"+a),a=this.getPath(),a?o+=a:o&&(o+="/"),a=this.$12(e,t,n,r),a&&(o+="?"+a),e=this.getFragment(),e?o+="#"+e:this.getForceFragmentSeparator()&&(o+="#"),o},e.registerFilter=function(e){m.push(e)},n.getOrigin=function(){var e=this.getPort();return this.getProtocol()+"://"+this.getDomain()+(e?":"+e:"")},n.isSameOrigin=function(e){return t("isSameOrigin")(this,e)},n.getQualifiedURIBase=function(){return new e(this,this.$9).qualify()},n.qualify=function(){if(!this.getDomain()){var t=new e(window.location.href,this.$9);this.setProtocol(t.getProtocol()).setDomain(t.getDomain()).setPort(t.getPort())}return this},n.setSubdomain=function(e){var n=this.qualify();return n=n.getDomain(),this.setDomain(t("setHostSubdomain")(n,e))},n.getSubdomain=function(){if(!this.getDomain())return"";var e=this.getDomain().split(".");return e.length<=2?"":e[0]},n.isSubdomainOfDomain=function(t){var n=this.getDomain();return e.isDomainSubdomainOfDomain(n,t,this.$9)},e.isDomainSubdomainOfDomain=function(t,n,r){if(n===""||t==="")return!1;if(c(t,"endsWith",!0,n)){var o=t.length,a=n.length,i=o-a-1;if(o===a||t[i]===".")return o=new e(null,r),o.setDomain(n),e.isValid(o,r)}return!1},e})(),o.exports=e},null),t.__d("sdk.URI",["QueryString","URIAbstractBase"],function(e,t,n,r,o,a,i){var l=/\.facebook\.com$/,s={serialize:function(t){return t?n("QueryString").encode(t):""},deserialize:function(t){return t?n("QueryString").decode(t):{}}};e=(function(e){d.inheritsLoose(t,e);function t(t){return e.call(this,t,s)||this}var r=t.prototype;return r.isFacebookURI=function(){return l.test(this.getDomain())},r.valueOf=function(){return this.toString()},t.isValidURI=function(e){return n("URIAbstractBase").isValid(e,s)},t})(n("URIAbstractBase")),i.default=e},98),t.__d("ApiClientUtils",["ArgumentError","Assert","Log","flattenObject","sdk.URI","sprintf"],function(l,t,n,r,o,a,i){var e={get:!0,post:!0,delete:!0,put:!0};function l(t){var o=t.shift();n("Assert").isString(o,"Invalid path"),!/^https?/.test(o)&&o.charAt(0)!=="/"&&(o="/"+o);var a,i={};try{a=new(n("sdk.URI"))(o)}catch(e){throw new(n("ArgumentError"))(e.message,e)}t.forEach(function(e){return i[typeof e]=e}),o=(i.string||"get").toLowerCase(),n("Assert").isTrue(Object.prototype.hasOwnProperty.call(e,o),n("sprintf")("Invalid method passed to ApiClient: %s",o)),t=i.function,t||r("Log").warn("No callback passed to the ApiClient"),i.object&&a.addQueryData(n("flattenObject")(i.object));var l=a.getQueryData();return l.method=o,{uri:a,callback:t,params:l}}i.parseCallDataFromArgs=l},98),t.__d("errorCode",[],function(e,t,n,r,o,a){"use strict";function e(e){throw new Error('errorCode("'+e+'"): This should not happen. Oh noes!')}a.default=e},66),t.__d("nullthrows",[],function(e,t,n,r,o,a){function e(e,t){if(t===void 0&&(t="Got unexpected null or undefined"),e!=null)return e;throw e=new Error(t),e.framesToPop=1,e}a.default=e},66),t.__d("sdk.safelyParseResponse",["errorCode","nullthrows"],function(s,t,n,r,o,a,i,l){"use strict";var e=function(t,n,r,o){return u};function s(t,r,o){r===void 0&&(r=null),o===void 0&&(o=null);try{return t===null?u:c("JSON","parse",!1,n("nullthrows")(t))}catch(n){return e(n,t,r,o)}}var u={error:{code:1,error_subcode:1357046,message:"Received Invalid JSON reply.",type:"http"}};s.ERROR=u,s.setErrorHandler=function(t){e=t},t=s,i.default=t},98),t.__d("whitelistObjectKeys",[],function(e,t,n,r,o,a){function e(e,t){var n={};t=Array.isArray(t)?t:Object.keys(t);for(var r=0;r<t.length;r++)typeof e[t[r]]!="undefined"&&(n[t[r]]=e[t[r]]);return n}a.default=e},66),t.__d("ApiBatcher",["invariant","ApiClientUtils","QueryString","sdk.safelyParseResponse","whitelistObjectKeys"],function(e,t,n,r,o,a,i,l){"use strict";var s=50,u=105440539523;e=(function(){function e(e,t){this.$1=[],this.$2=[],this.$4=null,this.executeRequest=e,this.$3=t}var t=e.prototype;return t.scheduleBatchCall=function(){for(var t=this,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];var a=e.prepareBatchParams(r),i=a.body,l=a.callback,u=a.method,c=a.relative_url,d={method:u,relative_url:c};i&&(d.body=i),this.$1.push(d),this.$2.push(l),this.$1.length==s?(this.$4&&window.clearTimeout(this.$4),this.$5()):this.$4||(this.$4=window.setTimeout(function(){t.$5()},0))},e.prepareBatchParams=function(e,t){t===void 0&&(t=[]),e=r("ApiClientUtils").parseCallDataFromArgs(e);var o=e.uri,a=e.callback;e=e.params.method;var i,l=o.removeQueryData("method").toString();if(e.toLowerCase()=="post"){var s=o.getQueryData();i=n("QueryString").encode(s),s=n("whitelistObjectKeys")(s,t),l=o.setQueryData(s).toString()}return{body:i,callback:a,method:e,relative_url:l}},t.$5=function(){this.$1.length>0||l(0,4698),this.$1.length===this.$2.length||l(0,4699);var e=this.$1,t=this.$2;if(this.$1=[],this.$2=[],this.$4=null,e.length===1){var r=e[0],o=t[0],a=r.body?n("QueryString").decode(r.body):null;this.executeRequest(r.relative_url,r.method,a,o);return}this.executeRequest("/","POST",{batch:e,include_headers:!1,batch_app_id:this.$3||u},function(e){Array.isArray(e)?e.forEach(function(e,r){t[r](n("sdk.safelyParseResponse")(e&&e.body))}):t.forEach(function(e){return e({error:{message:"Fatal: batch call failed."}})})})},e})(),i.default=e},98),t.__d("RequestConstants",["errorCode"],function(e,t,n,r,o,a,i,l){e={code:1,error_subcode:1357045,message:"unknown error (empty response)",type:"http",status:0},i.PARSE_ERROR_TEMPLATE=e},98),t.__d("sdk.Cookie",["QueryString","sdk.Runtime","sdk.Scribe","sdk.feature"],function(l,s,n,r,d,m,i){var e=null,t=["fblo_","fbsr_","fbm_"];function o(o,a,i,l){if(!(!c(t,"includes",!0,o)&&(r("sdk.Scribe").log("jssdk_error",{appId:n("sdk.Runtime").getClientID(),error:"unknown_cookie_prefix."+o}),n("sdk.feature")("limit_unknown_cookie_setting",!1)))){o=o+n("sdk.Runtime").getClientID(),l=l?"; SameSite=None;Secure":"";var s=e!==null&&e!==".";s&&(document.cookie=o+"=; expires=Wed, 04 Feb 2004 08:00:00 GMT"+l,document.cookie=o+"=; expires=Wed, 04 Feb 2004 08:00:00 GMT;domain="+location.hostname+l);var u=new Date(i).toUTCString();document.cookie=o+"="+a+(a&&i===0?"":"; expires="+u)+"; path=/"+(s?"; domain="+((o=e)!=null?o:""):"")+l}}function a(e){return e=e+n("sdk.Runtime").getClientID(),e=new RegExp("\\b"+e+"=([^;]*)\\b"),e=document.cookie.match(e),e==null?null:e[1]}function l(t){e=t,t=n("QueryString").encode({base_domain:e!==null&&e!=="."?e:""});var r=new Date;r.setFullYear(r.getFullYear()+1),o("fbm_",t,r.getTime(),!0)}function s(){return e}function u(){var t=a("fbm_");return t!=null&&e===null?(t=n("QueryString").decode(t),e=t.base_domain,{base_domain:e}):null}function d(){return a("fbsr_")}function m(e,t){if(e==="")throw new Error("Value passed to Cookie.setSignedRequestCookie was empty.");o("fbsr_",e,t,!0)}function p(){u(),o("fbsr_","",0,!0)}i.setRaw=o,i.getRaw=a,i.setDomain=l,i.getDomain=s,i.loadMeta=u,i.loadSignedRequest=d,i.setSignedRequestCookie=m,i.clearSignedRequestCookie=p},98),t.__d("CORSRequest",["Log","QueryString","RequestConstants","sdk.Cookie","sdk.safelyParseResponse","wrapFunction"],function(p,n,r,o,a,i,l){function t(t,n,o){if(o===void 0&&(o={withCredentials:!1}),!e.XMLHttpRequest)return null;var a=new XMLHttpRequest,i=function(){};if((o=o)!=null&&o.withCredentials&&(a.withCredentials=!0),"withCredentials"in a)a.open(t,n,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded");else if(e.XDomainRequest){a=new XDomainRequest;try{a.open(t,n),a.onprogress=a.ontimeout=i}catch(e){return null}}else return null;var l={send:function(t){a.send(t)}},s=r("wrapFunction")(function(){s=i,"onload"in l&&l.onload(a)},"entry","XMLHttpRequest:load"),u=r("wrapFunction")(function(){u=i,"onerror"in l&&l.onerror(a)},"entry","XMLHttpRequest:error");return a.onload=function(){s()},a.onerror=function(){u()},a.onreadystatechange=function(){a.readyState==4&&(a.status==200?s():u())},l}var s="for (;;);",u=s.length;function m(e){return e.substring(0,u)==s&&(e=e.substring(u)),e}function p(n,a,i,l,s){if(s===void 0&&(s={withCredentials:!1}),c(n,"includes",!0,"/../")||c(n,"includes",!0,"/..\\")||c(n,"includes",!0,"\\../")||c(n,"includes",!0,"\\..\\"))return o("Log").error("CORSRequest.execute(): path traversal is not allowed."),!1;try{if(e.document){var u=o("sdk.Cookie").getRaw("cppo");u&&(n=r("QueryString").appendToUrl(n,r("QueryString").encode({__cppo:u})))}}catch(e){}return i.suppress_http_code=1,u=r("QueryString").encode(i),a!="post"&&(n=r("QueryString").appendToUrl(n,u),u=""),i=t(a,n,s),i?(i.onload=function(e){l(r("sdk.safelyParseResponse")(m(e.responseText),n,e.status))},i.onerror=function(e){e.responseText?l(r("sdk.safelyParseResponse")(m(e.responseText),n,e.status)):l({error:d.extends({},o("RequestConstants").PARSE_ERROR_TEMPLATE,{status:e.status})})},i.send(u),!0):!1}n={execute:p},a=n,l.default=a},98),t.__d("ApiClient",["ApiBatcher","ApiClientUtils","Assert","CORSRequest","Log","ObservableMixin","QueryString","UrlMap","flattenObject"],function(R,L,n,r,E,a,i){var e,t,o,l=[],s=!1,u=2e3,m={fql_query:!0,fql_multiquery:!0,friends_get:!0,notifications_get:!0,stream_get:!0,users_getinfo:!0},p=["cors"],_=0,f=[],g=0,h=0,y,C=r("Log");function b(t,r,a,i){var u=g!==0&&_>=g;if(u){f.push(function(){return b(t,r,a,i)}),k.inform("request.queued",t,r,a);return}_++;var c=d.extends({},o,a);c.pretty=c.pretty||0,c=n("flattenObject")(c),u={cors:n("CORSRequest")};var m={},h=c.access_token||e;h&&(m.access_token=h),r!=="get"&&l.forEach(function(e){m[e]=c[e]}),h=Object.keys(m),h.length>0&&(t=n("QueryString").appendToUrl(t,m),delete c.access_token),h=p;for(var y=0;y<h.length;y++){var C=u[h[y]],v=d.extends({},c);if(C.execute(t,r,v,i,{withCredentials:s}))return}i({error:{type:"no-transport",message:"Could not find a usable transport for request"}})}function v(e,t,n,r,o,a,i,l){if(r.transport&&r.transport==="chunked"&&l===!1){e(i,!1);return}i&&i.error&&k.inform("request.error",t,n,r,i,Date.now()-o,a),k.inform("request.complete",t,n,r,i,Date.now()-o,a),_--,e&&e(i),l=f.length>0&&_<g,l&&(t=f.shift(),t())}function S(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=r("ApiClientUtils").parseCallDataFromArgs(t),a=o.uri,i=o.callback,l=o.params,s=l.method;I(a,s)&&(s="post");var u=a.getProtocol()&&a.getDomain()?a.setQueryData({}).toString():r("UrlMap").resolve("graph_domain")+a.getPath(),d=h++;"_fb_domain"in l&&k.setKeptQueryParams(["_fb_domain"]),k.inform("request.prepare",u,l,d),b(u,s=="get"?"get":"post",l,c(v,"bind",!0,null,i,a.getPath(),s,l,Date.now(),d))}function R(){var e;y||(y=new(n("ApiBatcher"))(S,t)),(e=y).scheduleBatchCall.apply(e,arguments)}function L(e,o){n("Assert").isObject(e),n("Assert").isString(e.method,"method missing"),o||C.warn("No callback passed to the ApiClient");var a=e.method.toLowerCase().replace(".","_");e.format="json-strings",e.api_key=t,a=a in m?"api_read":"api",a=r("UrlMap").resolve(a)+"/restserver.php";var i=h++;o=c(v,"bind",!0,null,o,"/restserver.php","get",e,Date.now(),i),b(a,"get",e,o)}function E(e){return n("ApiBatcher").prepareBatchParams(e,l)}var k=c("Object","assign",!1,new(n("ObservableMixin")),{setAccessToken:function(n){e&&n&&e!==n&&C.error("You are overriding current access token, that means some other app is expecting different access token and you will probably break things. Please consider passing access_token directly to API parameters instead of overriding the global settings."),e=n},setAccessTokenForClientID:function(r,o){e&&t&&t!==o?C.error("Not overriding access token since it was not initialized by your application."):e=r},setWithCredentials:function(t){s=t},getWithCredentials:function(){return s},getClientID:function(){return t},getAccessToken:function(){return e},setClientID:function(n){t&&t!==n&&C.warn("Warning: Two different applications have attempted to set the client ID. Overriding the previously set client ID."),t=n},setDefaultParams:function(t){o=t},getDefaultParams:function(){return o},setDefaultTransports:function(t){p=t},setLogger:function(t){C=t},setMaxConcurrentRequests:function(t){g=t},setKeptQueryParams:function(t){l=t},getCurrentlyExecutingRequestCount:function(){return _},getQueuedRequestCount:function(){return f.length},rest:L,graph:S,scheduleBatchCall:R,prepareBatchParams:E});function I(e,t){return e.toString().length>u&&t==="get"}a=k,i.default=a},98),t.__d("FBEventsParamList",[],function(e,t,n,r,o,a){"use strict";var i="deep",l="shallow";e=(function(){function e(){this.list=[]}var t=e.prototype;return t.append=function(e,t){this.$1(encodeURIComponent(e),t,i)},t.each=function(e){for(var t=this.list,n=0,r=t.length;n<r;n++)e(t[n][0],t[n][1])},t.toQueryString=function(){var e=[];return this.each(function(t,n){e.push(t+"="+encodeURIComponent(n))}),e.join("&")},t.$1=function(e,t,n){Object(t)!==t?this.$2(e,t):n===i?this.$3(e,t):this.$2(e,s(t))},t.$2=function(e,t){t!=null&&this.list.push([e,t])},t.$3=function(e,t){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=e+"["+encodeURIComponent(n)+"]";this.$1(r,t[n],l)}},e})();function s(e){return typeof JSON=="undefined"||JSON===null||!c("JSON","stringify",!1)?Object.prototype.toString.call(e):c("JSON","stringify",!1,e)}a.default=e},66),t.__d("FBEventsUtils",[],function(i,t,n,r,o,a){"use strict";var e=!("addEventListener"in document);function i(t,n,r){var o=e?"on"+n:n;n=function n(){e?t.detachEvent&&t.detachEvent(o,n):t.removeEventListener(o,n,!1),r()},e?t.attachEvent&&t.attachEvent(o,n):t.addEventListener(o,n,!1)}a.listenOnce=i},66),t.__d("FBPixelEndpoint",["invariant","FBEventsParamList","FBEventsUtils"],function(m,t,n,r,o,a,i,l){"use strict";var e="https://www.facebook.com/tr/",s=location.href,u=window.top!==window,c=document.referrer;function d(e,t,r,o){o===void 0&&(o={});var a=new(n("FBEventsParamList"));a.append("id",e),a.append("ev",t),a.append("dl",s),a.append("rl",c),a.append("if",u),a.append("ts",new Date().valueOf()),a.append("cd",r),a.append("sw",window.screen.width),a.append("sh",window.screen.height);for(e in o)a.append(e,o[e]);return a}function m(t,n,r,o){t=d(t,n,r,o),n=t.toQueryString(),2048>(e+"?"+n).length?p(e,n):_(e,t)}function p(e,t){var n=new Image;n.src=e+"?"+t}function _(e,t){var n="fb"+Math.random().toString().replace(".",""),o=document.createElement("form");o.method="post",o.action=e,o.target=n,o.acceptCharset="utf-8",o.style.display="none",e=!!(window.attachEvent&&!window.addEventListener),e=e?'<iframe name="'+n+'">':"iframe";var a=document.createElement(e);a instanceof HTMLIFrameElement||l(0,20659),a.src="javascript:false",a.id=n,a.name=n,o.appendChild(a),r("FBEventsUtils").listenOnce(a,"load",function(){t.each(function(e,t){var n=document.createElement("input");n.name=e,n.value=t,o.appendChild(n)}),r("FBEventsUtils").listenOnce(a,"load",function(){var e;(e=o.parentNode)==null||e.removeChild(o)}),o.submit()}),(e=document.body)==null||e.appendChild(o)}i.sendEvent=m},98),t.__d("FBAppEvents",["ApiClient","FBPixelEndpoint"],function(e,t,n,r,o,a,i){"use strict";function e(e,t,n,o,a){var i={};o!=null&&(i.vts=o.toString()),a!=null&&(i.at=a),r("FBPixelEndpoint").sendEvent(e.toString(),t,n,i)}function t(e,t,r,o){t="/"+t+"/user_properties",e={data:[{user_unique_id:e,custom_data:r}]},n("ApiClient").graph(t,"post",e,o)}i.logEvent=e,i.updateUserProperties=t},98),t.__d("Miny",[],function(e,t,n,r,o,a){var i="Miny1",l="wxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_".split("");e={encode:function(t){if(/^$|[~\\]|__proto__/.test(t))return t;t=(t=t.match(/\w+|\W+/g))!=null?t:[];var e,n=Object.create(null);for(e=0;e<t.length;e++)n[t[e]]=(n[t[e]]||0)+1;var r=Object.keys(n);for(r.sort(function(e,t){return parseInt(n[t],10)-parseInt(n[e],10)}),e=0;e<r.length;e++){var o=(e-e%32)/32;n[r[e]]=o?o.toString(32)+l[e%32]:l[e%32]}for(o="",e=0;e<t.length;e++)o+=n[t[e]];return r.unshift(i,r.length),r.push(o),r.join("~")}},t=e,a.default=t},66),t.__d("getBlankIframeSrc",["sdk.UA"],function(e,t,n,r,o,a,i){function e(){return n("sdk.UA").ie()<10?"javascript:false":"about:blank"}i.default=e},98),t.__d("insertIframe",["GlobalCallback","getBlankIframeSrc","guid"],function(e,t,n,r,o,a,i){function e(e){var t=e.id!=null?e.id:n("guid")(),o=e.name!=null?e.name:n("guid")(),a=!1,i=!1,l=function(){a&&!i&&(i=!0,typeof e.onload=="function"&&e.onload(e.root.firstChild))},s=r("GlobalCallback").create(l);if(document.attachEvent){var u='<iframe id="'+t+'" name="'+o+'"'+(e.title!=null?' title="'+e.title+'"':"")+(e.className!=null?' class="'+e.className+'"':"")+' style="border:none;'+(e.width!=null?"width:"+e.width+"px;":"")+(e.height!=null?"height:"+e.height+"px;":"")+'" src="'+n("getBlankIframeSrc")()+'" frameborder="0" scrolling="no" allowtransparency="true" onload="'+s+'()"></iframe>';e.root.innerHTML='<iframe src="'+n("getBlankIframeSrc")()+'" frameborder="0" scrolling="no" style="height:1px"></iframe>',a=!0,window.setTimeout(function(){e.root.innerHTML=u,e.root.firstChild.src=e.url,typeof e.onInsert=="function"&&e.onInsert(e.root.firstChild)},0)}else s=document.createElement("iframe"),s.id=t,s.name=o,s.onload=l,s.scrolling="no",s.style.border="none",s.style.overflow="hidden",e.title!=null&&(s.title=e.title),e.className!=null&&(s.className=e.className),e.height!==void 0&&(s.style.height=e.height+"px"),e.width!==void 0&&(e.width==="100%"?s.style.width=e.width:s.style.width=e.width+"px"),e.root.appendChild(s),a=!0,s.src=e.url,e.onInsert&&e.onInsert(s)}i.default=e},98),t.__d("sdk.Impressions",["Miny","QueryString","UrlMap","getBlankIframeSrc","guid","insertIframe","sdk.Content","sdk.Runtime"],function(u,t,n,r,o,a,i){function e(e,t){t===void 0&&(t=!1);var o=n("sdk.Runtime").getClientID(),a=n("sdk.Runtime").isEnvironment(n("sdk.Runtime").ENVIRONMENTS.CANVAS);o&&(typeof e.api_key!="string"||e.api_key==="")&&(e.api_key=o),e.kid_directed_site=n("sdk.Runtime").getKidDirectedSite(),o=r("UrlMap").resolve("www")+"/platform/impression.php/"+n("guid")()+"/",a&&(o=r("UrlMap").resolve("www")+"/platform/canvas_impression.php/"+n("guid")()+"/");var i=n("QueryString").appendToUrl(o,e);if(i.length>2e3&&e.payload&&typeof e.payload=="string"){var u=e.payload,c=n("Miny").encode(u);c&&c.length<u.length&&(e.payload=c,i=n("QueryString").appendToUrl(o,e))}window.fetch?l(o,i,e,t||a):s(o,i,e,t||a)}function l(e,t,n,r){r===void 0&&(r=!1);var o={mode:"no-cors",credentials:"include"};if(r||(o.credentials="omit"),t.length<=2e3)window.fetch(t,o);else{r=new URLSearchParams;for(t in n)if(Object.prototype.hasOwnProperty.call(n,t)){var a=n[t];a!=null&&r.set(t,a)}a=d.extends({method:"POST",body:r},o),window.fetch(e,a)}}function s(e,t,o,a){if(a===void 0&&(a=!1),t.length<=2e3){var i=new Image;a||(i.crossOrigin="anonymous"),i.src=t}else{if(!a)return;i=n("guid")();var l=r("sdk.Content").appendHidden(document.createElement("div"));n("insertIframe")({url:n("getBlankIframeSrc")(),root:l,name:i,className:"fb_hidden fb_invisible",onload:function(){l.parentNode!=null&&l.parentNode.removeChild(l)}}),r("sdk.Content").submitToTarget({url:e,target:i,params:o})}}function u(t,n){(typeof n.source!="string"||n.source==="")&&(n.source="jssdk"),e({lid:t,payload:c("JSON","stringify",!1,n)})}i.impression=e,i.log=u},98),t.__d("sdk.AppEvents",["AppUserPropertyAPIBuiltinField","Assert","FBAppEvents","sdk.Impressions","sdk.Model","sdk.Runtime"],function(C,b,n,r,v,S,i){var e=Object.freeze({COMPLETED_REGISTRATION:"fb_mobile_complete_registration",VIEWED_CONTENT:"fb_mobile_content_view",SEARCHED:"fb_mobile_search",RATED:"fb_mobile_rate",COMPLETED_TUTORIAL:"fb_mobile_tutorial_completion",ADDED_TO_CART:"fb_mobile_add_to_cart",ADDED_TO_WISHLIST:"fb_mobile_add_to_wishlist",INITIATED_CHECKOUT:"fb_mobile_initiated_checkout",ADDED_PAYMENT_INFO:"fb_mobile_add_payment_info",ACHIEVED_LEVEL:"fb_mobile_level_achieved",UNLOCKED_ACHIEVEMENT:"fb_mobile_achievement_unlocked",PAGE_VIEW:"fb_page_view",SPENT_CREDITS:"fb_mobile_spent_credits"}),t=Object.freeze({ACTIVATED_APP:"fb_mobile_activate_app",PURCHASED:"fb_mobile_purchase"}),o=Object.freeze({APP_USER_ID:"_app_user_id",APP_VERSION:"_appVersion",CURRENCY:"fb_currency",REGISTRATION_METHOD:"fb_registration_method",CONTENT_TYPE:"fb_content_type",CONTENT_ID:"fb_content_id",SEARCH_STRING:"fb_search_string",SUCCESS:"fb_success",MAX_RATING_VALUE:"fb_max_rating_value",PAYMENT_INFO_AVAILABLE:"fb_payment_info_available",NUM_ITEMS:"fb_num_items",LEVEL:"fb_level",DESCRIPTION:"fb_description"}),a=/^[0-9a-zA-Z_][0-9a-zA-Z _-]{0,39}$/,l=40,s=a,u=l,m=100,p=100,_=100,f=100,g=c("Object","values",!1,n("AppUserPropertyAPIBuiltinField")),h=new(n("sdk.Model"))({UserID:"",Version:""});function y(e,t,r){var a=$();N(e);var i=h.getUserID();i!==""&&(r=r||{},r[o.APP_USER_ID]=i),i=h.getVersion(),i!==""&&(r=r||{},r[o.APP_VERSION]=i),n("sdk.Runtime").isCanvasEnvironment()?D(a,e,t,r):x(a,e,t,r)}function C(e,n,r){var a={};a[o.CURRENCY]=n,y(t.PURCHASED,e,d.extends({},r,a))}function b(){y(t.ACTIVATED_APP)}function v(){y(e.PAGE_VIEW)}function S(e){w(e),h.setUserID(e)}function R(){return h.getUserID()}function L(){h.setUserID("")}function E(e){M(e),h.setVersion(e)}function k(){return h.getVersion()}function I(){h.setVersion("")}function T(e,t){var n=$(),o=R();w(o),Object.keys(e).forEach(function(t){return e[t]==null&&delete e[t]}),P(e),r("FBAppEvents").updateUserProperties(o,n,e,t)}function D(e,t,n,o){t={ae:1,ev:t,vts:n,canvas:1},o&&(t.cd=o),r("sdk.Impressions").impression({api_key:e,payload:c("JSON","stringify",!1,t)})}function x(e,t,o,a){var i=n("sdk.Runtime").getAccessToken();r("FBAppEvents").logEvent(e,t,a||{},o,i)}function $(){var e=n("sdk.Runtime").getClientID();return n("Assert").isTrue(e!==null&&e.length>0,"You need to call FB.init() with App ID first."),e}function P(e){n("Assert").isTrue(Object.keys(e).length<=_,"The total number of user properties cannot exceed "+_+".");for(var t in e)n("Assert").isTrue(s.test(t)||c(g,"includes",!0,t),"Invalid user properties key name: "+t+". It must be between 1 and "+u+" characters, and must contain only alphanumerics, _, - or spaces, starting with alphanumeric or _. Or, it must be a pre-defined user property"),n("Assert").isTrue(e[t].toString().length<=f,"Invalid user properties value: "+e[t]+". It must be no longer than "+f+" characters.")}function N(e){n("Assert").isTrue(a.test(e),"Invalid event name: "+e+". It must be between 1 and "+l+" characters, and must be contain only alphanumerics, _, - or spaces, starting with alphanumeric or _.")}function M(e){n("Assert").isTrue(e.length<=p,"Invalid app version: "+e+". It must be no longer than "+p+" characters.")}function w(e){n("Assert").isTrue(e.length!==0,"User ID must be set before updateUserProperties can be called."),n("Assert").isTrue(e.length<=m,"Invalid user ID: "+e+". It must be no longer than "+m+" characters.")}C=Object.freeze({logEvent:y,logPurchase:C,activateApp:b,logPageView:v,setUserID:S,getUserID:R,clearUserID:L,updateUserProperties:T,setAppVersion:E,getAppVersion:k,clearAppVersion:I,EventNames:e,ParameterNames:o}),i.assertGetValidAppID=$,i.assertValidUserProperties=P,i.assertValidEventName=N,i.assertValidAppVersion=M,i.assertValidUserID=w,i.AppEvents=C},98),t.__d("sdk.Event",[],function(c,d,n,r,o,a){"use strict";var e="event.subscribe",t="event.unsubscribe",i;function l(){return i||(i={}),i}function s(n,r){var o=l();o[n]?o[n].indexOf(r)==-1&&o[n].push(r):o[n]=[r],n!=e&&n!=t&&m(e,n,o[n])}function u(n,r){var o=l()[n];o&&o.forEach(function(e,t){e===r&&o.splice(t,1)}),n!=e&&n!=t&&m(t,n,o)}function c(e,t){var n=arguments;if(!t()){var r=function r(){t.apply(t,n)&&u(e,r)};s(e,r)}}function d(e){delete l()[e]}function m(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=l()[e];o&&o.forEach(function(e){e&&e.apply(this,n)})}a.SUBSCRIBE=e,a.UNSUBSCRIBE=t,a.subscribers=l,a.subscribe=s,a.unsubscribe=u,a.monitor=c,a.clear=d,a.fire=m},66),t.__d("sdk.AppEvents-public",["Assert","FB","sdk.AppEvents","sdk.Event","sdk.Runtime"],function(e,t,n,r,o,a,i){function e(){r("sdk.Event").subscribe("init:post",function(e){n("sdk.Runtime").getClientID()&&(e.autoLogAppEvents!==void 0&&(n("Assert").isBoolean(e.autoLogAppEvents,"Type of property autoLogAppEvents must be boolean"),n("sdk.Runtime").setAutoLogAppEvents(e.autoLogAppEvents)),n("sdk.Runtime").getAutoLogAppEvents()&&r("sdk.AppEvents").AppEvents.logPageView())}),n("FB").provide("AppEvents",r("sdk.AppEvents").AppEvents)}t={init:e},o=t,i.default=o},98),t.__d("sdk.AuthState",["sdk.AuthUtils"],function(l,s,n,r,o,a,i){"use strict";var e=t();function t(){var e={igAuthResponse:null,fbAuthResponse:null,fbLoginStatus:null,igLoginStatus:null};return{currentAuthResponse:null,shouldSecondLoginRequestTimeOut:!1,mixedAuthState:e,loadState:null,timer:null,currentTimeOut:r("sdk.AuthUtils").AuthConstants.CONNECTED_REVALIDATE_PERIOD}}function l(){return c("Object","assign",!1,t(),e)}function s(n){e=c("Object","assign",!1,t(),e,n)}n={getState:l,setState:s},o=n,i.default=o},98),t.__d("sdk.Observable",[],function(e,t,n,r,o,a){e=function(){var e=this;this.getSubscribers=function(t){return e.$1[t]||(e.$1[t]=[])},this.clearSubscribers=function(t){t&&(e.$1[t]=[])},this.subscribe=function(t,n){t=e.getSubscribers(t),t.push(n)},this.unsubscribe=function(t,n){t=e.getSubscribers(t);for(var r=0;r<t.length;r++)if(t[r]===n){t.splice(r,1);break}},this.inform=function(t,n){t=e.getSubscribers(t);for(var r=function(){if(t[o]===null)return 1;try{t[o].call(e,n)}catch(e){window.setTimeout(function(){throw e},0)}},o=0;o<t.length;o++)r()},this.$1={}},a.Observable=e},66),t.__d("sdk.AuthUtils",["sdk.AuthState","sdk.Cookie","sdk.Observable","sdk.Runtime"],function(t,o,n,r,a,l,i){"use strict";var e=31536e6;function t(e){return e!=null&&e.graphDomain!=null?e.graphDomain==="instagram":!1}function o(e){n("sdk.Runtime").getUseCookie()&&r("sdk.Cookie").getDomain()==null&&r("sdk.Cookie").setDomain("."+e)}function a(){var e={fbAuthResponse:null,fbLoginStatus:null,igAuthResponse:null,igLoginStatus:null},t=!1;n("sdk.AuthState").setState({mixedAuthState:e,shouldSecondLoginRequestTimeOut:t})}function l(e){e!=null?(n("sdk.Runtime").setGraphDomain(e),e=="instagram"&&n("sdk.Runtime").setIsVersioned(!1)):n("sdk.Runtime").setGraphDomain("")}function s(){r("sdk.Cookie").setRaw(y.LOGOUT_COOKIE_PREFIX,"y",Date.now()+e,!1)}function u(e){e===void 0&&(e=y.CONNECTED_REVALIDATE_PERIOD);var t=n("sdk.AuthState").getState().timer;t&&window.clearTimeout(t),t=window.setTimeout(function(){h.inform(y.REVALIDATE_TIMER_TIMEOUT)},e),n("sdk.AuthState").setState({timer:t}),n("sdk.AuthState").setState({currentTimeOut:e})}function c(){r("sdk.Cookie").setRaw(y.LOGOUT_COOKIE_PREFIX,"",0,!1),r("sdk.Cookie").setRaw(y.LOGOUT_COOKIE_PREFIX,"",0,!0)}var d=new(r("sdk.Observable")).Observable;function m(e,t){d.inform(e,t)}function p(e,t){d.subscribe(e,t)}function _(e){d.clearSubscribers(e)}function f(e,t){d.unsubscribe(e,t)}function g(e){return d.getSubscribers(e)}var h={inform:m,subscribe:p,clearSubscribers:_,unsubscribe:f,getSubscribers:g},y={LOCAL_STORAGE_TOKEN_PREFIX:"fblst_",IG_LOCAL_STORAGE_TOKEN_PREFIX:"iglst_",SESSION_STORAGE_LOGIN_STATUS_PREFIX:"fbssls_",CONNECTED_REVALIDATE_PERIOD:5400*1e3,DEFAULT_REVALIDATE_PERIOD:3600*24*1e3,LOGOUT_COOKIE_PREFIX:"fblo_",CORS_FETCH_COMPLETED_EVENT:"cors_fetch_completed",XFOA_FINAL_RESPONSE_EVENT:"xfoa_final_response",LOAD_XFOA_SUBSCRIBERS:"load_xfoa_subscribers",REVALIDATE_TIMER_TIMEOUT:"revalidate_timer_timeout"};i.isInstagramLogin=t,i.setBaseDomain=o,i.resetFBAndIGLoginStatus=a,i.setGraphDomain=l,i.setLogoutState=s,i.setRevalidateTimer=u,i.removeLogoutState=c,i.AuthInternalEvent=h,i.AuthConstants=y},98),t.__d("sdk.WebStorage",["Log"],function(e,t,n,r,o,a,i){"use strict";function e(){try{return window.localStorage}catch(e){r("Log").warn("Failed to get local storage")}return null}function t(){try{var e=window.localStorage;if(e){var t="__test__"+Date.now();e.setItem(t,""),e.removeItem(t)}return e}catch(e){r("Log").warn("Failed to get local storage")}return null}function n(){try{return window.sessionStorage}catch(e){r("Log").warn("Failed to get session storage")}return null}function o(){try{var e=window.sessionStorage;if(e){var t="__test__"+Date.now();e.setItem(t,""),e.removeItem(t)}return e}catch(e){r("Log").warn("Failed to get session storage")}return null}i.getLocalStorage=e,i.getLocalStorageForRead=t,i.getSessionStorage=n,i.getSessionStorageForRead=o},98),t.__d("sdk.AuthStorageUtils",["sdk.AuthUtils","sdk.Runtime","sdk.WebStorage","sdk.feature"],function(e,t,n,r,o,l,i){"use strict";function e(e,t){if(a()&&t!=null&&t!==""){var o=r("sdk.WebStorage").getLocalStorage();o&&(e=r("sdk.AuthUtils").isInstagramLogin(e)?r("sdk.AuthUtils").AuthConstants.IG_LOCAL_STORAGE_TOKEN_PREFIX:r("sdk.AuthUtils").AuthConstants.LOCAL_STORAGE_TOKEN_PREFIX,o.setItem(e+n("sdk.Runtime").getClientID(),t))}}function t(e){var t=r("sdk.WebStorage").getLocalStorage();t&&(e==="instagram"?t.removeItem(r("sdk.AuthUtils").AuthConstants.IG_LOCAL_STORAGE_TOKEN_PREFIX+n("sdk.Runtime").getClientID()):t.removeItem(r("sdk.AuthUtils").AuthConstants.LOCAL_STORAGE_TOKEN_PREFIX+n("sdk.Runtime").getClientID()))}function o(e,t){if(a()){var o=r("sdk.WebStorage").getSessionStorage();o&&o.setItem(r("sdk.AuthUtils").AuthConstants.SESSION_STORAGE_LOGIN_STATUS_PREFIX+n("sdk.Runtime").getClientID(),c("JSON","stringify",!1,{authResponse:e,status:t,expiresAt:e!=null&&e.expiresIn&&e.expiresIn!==0?Date.now()+Math.min(e.expiresIn*.75*1e3,r("sdk.AuthUtils").AuthConstants.CONNECTED_REVALIDATE_PERIOD):Date.now()+r("sdk.AuthUtils").AuthConstants.DEFAULT_REVALIDATE_PERIOD}))}}function a(){return n("sdk.feature")("cache_auth_response",!1)&&n("sdk.Runtime").getUseLocalStorage()&&location.protocol==="https:"}function l(){var e=null,t=null;if(n("sdk.Runtime").getUseLocalStorage()){var o=r("sdk.WebStorage").getLocalStorageForRead();o&&(e=o.getItem(r("sdk.AuthUtils").AuthConstants.LOCAL_STORAGE_TOKEN_PREFIX+n("sdk.Runtime").getClientID()),t=o.getItem(r("sdk.AuthUtils").AuthConstants.IG_LOCAL_STORAGE_TOKEN_PREFIX+n("sdk.Runtime").getClientID()))}return{fbToken:e,igToken:t}}function s(){if(!a())return null;var e=r("sdk.WebStorage").getSessionStorageForRead();if(e&&(e=e.getItem(r("sdk.AuthUtils").AuthConstants.SESSION_STORAGE_LOGIN_STATUS_PREFIX+n("sdk.Runtime").getClientID()),e!=null))try{if(e=c("JSON","parse",!1,e),e!=null&&e.expiresAt!=null&&e.expiresAt>Date.now())return e}catch(e){return null}return null}i.setLocalStorageToken=e,i.removeLocalStorageToken=t,i.setSessionStorage=o,i.getLocalStorageTokens=l,i.getCachedResponse=s},98),t.__d("Base64",[],function(e,t,n,r,o,a){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function l(e){return e=e.charCodeAt(0)<<16|e.charCodeAt(1)<<8|e.charCodeAt(2),String.fromCharCode(i.charCodeAt(e>>>18),i.charCodeAt(e>>>12&63),i.charCodeAt(e>>>6&63),i.charCodeAt(e&63))}var s=">___?456789:;<=_______\0\x07\b	\n\v\f\r______\x1B !\"#$%&'()*+,-./0123";function u(e){return e=s.charCodeAt(e.charCodeAt(0)-43)<<18|s.charCodeAt(e.charCodeAt(1)-43)<<12|s.charCodeAt(e.charCodeAt(2)-43)<<6|s.charCodeAt(e.charCodeAt(3)-43),String.fromCharCode(e>>>16,e>>>8&255,e&255)}var d={encode:function(t){t=unescape(encodeURI(t));var e=(t.length+2)%3;return t=(t+"\0\0".slice(e)).replace(/[\s\S]{3}/g,l),t.slice(0,t.length+e-2)+"==".slice(e)},decode:function(t){t=t.replace(/[^A-Za-z0-9+\/]/g,"");var e=t.length+3&3;t=(t+"AAA".slice(e)).replace(/..../g,u),t=t.slice(0,t.length+e-3);try{return decodeURIComponent(escape(t))}catch(e){throw new Error("Not valid UTF-8")}},encodeObject:function(t){return d.encode(c("JSON","stringify",!1,t))},decodeObject:function(t){return c("JSON","parse",!1,d.decode(t))},encodeNums:function(t){return String.fromCharCode.apply(String,t.map(function(e){return i.charCodeAt((e|-(e>63?1:0))&-(e>0?1:0)&63)}))}};e=d,a.default=e},66),t.__d("sdk.SignedRequest",["Base64"],function(e,t,n,r,o,a,i){function e(e){return e==null||e===""?null:(e=e.split(".",2)[1].replace(/\-/g,"+").replace(/\_/g,"/"),n("Base64").decodeObject(e))}i.parse=e},98),t.__d("sdk.getContextType",["sdk.Runtime","sdk.UA"],function(e,t,n,r,o,a,i){function e(){return n("sdk.UA").nativeApp()?3:n("sdk.UA").mobile()?2:n("sdk.Runtime").isEnvironment(n("sdk.Runtime").ENVIRONMENTS.CANVAS)?5:1}i.default=e},98),t.__d("sdk.statusCORS",["Log","UrlMap","sdk.AuthState","sdk.AuthStorageUtils","sdk.AuthUtils","sdk.Impressions","sdk.Runtime","sdk.Scribe","sdk.URI","sdk.feature","sdk.getContextType"],function(s,t,n,r,o,a,i){"use strict";var e=6e4,l=114;function s(t,o,a,i){i===void 0&&(i="facebook");var s=p(o),m=Date.now();function g(){var e=new XMLHttpRequest;e&&(e.open("GET",s.toString(),!0),e.withCredentials=!0,e.onreadystatechange=function(){if(e.readyState===4){if(n("sdk.feature")("e2e_ping_tracking",!0)){var o={init:m,close:Date.now(),method:"cors"};r("Log").debug("e2e: %s",c("JSON","stringify",!1,o)),r("sdk.Impressions").log(l,{payload:o})}e.status===200?u(t,(o=e.getResponseHeader("fb-s"))!=null?o:"unknown",(o=e.getResponseHeader("fb-ar"))!=null?o:"{}",i):d(t,e.status,a,i)}},e.send())}function h(){_(i)||window.setTimeout(function(){f(i==="facebook"?"instagram":"facebook"),n("sdk.AuthState").setState({shouldSecondLoginRequestTimeOut:!0})},e)}function y(){window.fetch(s.toString(),{referrer:"/",mode:"cors",credentials:"include"}).then(function(e){if(n("sdk.AuthState").getState().shouldSecondLoginRequestTimeOut){n("sdk.AuthState").setState({shouldSecondLoginRequestTimeOut:!1});return}if(h(),e.status===200){var r;u(t,(r=e.headers.get("fb-s"))!=null?r:"unknown",(r=e.headers.get("fb-ar"))!=null?r:"{}",i)}else d(t,e.status,a,i)}).catch(function(e){if(n("sdk.AuthState").getState().shouldSecondLoginRequestTimeOut){n("sdk.AuthState").setState({shouldSecondLoginRequestTimeOut:!1});return}h(),d(t,0,a,i)})}typeof window.fetch=="function"?y():g()}function u(e,t,o,a){switch(a===void 0&&(a="facebook"),t){case"connected":o=c("JSON","parse",!1,o);var i={accessToken:o.access_token,userID:o.user_id,expiresIn:Number(o.expires_in),signedRequest:o.signed_request,graphDomain:o.graph_domain};o.enforce_https!=null&&n("sdk.Runtime").setEnforceHttps(!0),o.data_access_expiration_time!=null&&(i.data_access_expiration_time=Number(o.data_access_expiration_time)),o.base_domain!=null&&r("sdk.AuthUtils").setBaseDomain(o.base_domain),r("sdk.AuthUtils").setGraphDomain(o.graph_domain),r("sdk.AuthStorageUtils").setLocalStorageToken(i,o.long_lived_token),r("sdk.AuthUtils").removeLogoutState(),o={authResponse:i,status:t,loginSource:a,cb:e},r("sdk.AuthUtils").AuthInternalEvent.inform(r("sdk.AuthUtils").AuthConstants.CORS_FETCH_COMPLETED_EVENT,o);break;case"not_authorized":case"unknown":default:i={authResponse:null,status:t,loginSource:a,cb:e},r("sdk.AuthUtils").AuthInternalEvent.inform(r("sdk.AuthUtils").AuthConstants.CORS_FETCH_COMPLETED_EVENT,i)}}function d(e,t,o,a){a===void 0&&(a="facebook"),t===0?(n("sdk.feature")("cors_status_fetch_cancel_tracking",!1)&&r("sdk.Scribe").log("jssdk_error",{appId:n("sdk.Runtime").getClientID(),error:"CORS_STATUS_FETCH_CANCELLED",extra:{message:"Status 0 returned."}}),r("Log").error("Error retrieving login status, fetch cancelled.")):(r("sdk.Scribe").log("jssdk_error",{appId:n("sdk.Runtime").getClientID(),error:"CORS_STATUS_FETCH",extra:{message:"HTTP Status Code "+t}}),r("Log").error("Error retrieving login status, HTTP status code: "+t)),t=m(),t&&t===a?(t={authResponse:o,status:n("sdk.Runtime").getLoginStatus(),loginSource:a,cb:e,shouldSetAuthResponse:!1},r("sdk.AuthUtils").AuthInternalEvent.inform(r("sdk.AuthUtils").AuthConstants.CORS_FETCH_COMPLETED_EVENT,t)):(o={authResponse:null,status:"unknown",loginSource:a,cb:e,shouldSetAuthResponse:!1},r("sdk.AuthUtils").AuthInternalEvent.inform(r("sdk.AuthUtils").AuthConstants.CORS_FETCH_COMPLETED_EVENT,o))}function m(){var e=n("sdk.AuthState").getState().currentAuthResponse;return e?r("sdk.AuthUtils").isInstagramLogin(e)?"instagram":"facebook":null}function p(e){if(e=new(n("sdk.URI"))(r("UrlMap").resolve("www").replace("web.","www.")+"/x/oauth/status").addQueryData("client_id",n("sdk.Runtime").getClientID()).addQueryData("input_token",e).addQueryData("redirect_uri",window.location.href).addQueryData("origin",n("sdk.getContextType")()).addQueryData("sdk","joey").addQueryData("wants_cookie_data",n("sdk.Runtime").getUseCookie()),window.location.ancestorOrigins){var t=window.location.ancestorOrigins;if(t.length>0){for(var o="",a=0;a<t.length;a++)o+=t[a],o+=",";e.addQueryData("ancestor_origins",o.slice(0,-1))}}return e}function _(e){var t=n("sdk.AuthState").getState().mixedAuthState;switch(e){case"facebook":return(t==null?void 0:t.fbLoginStatus)===null&&(t==null?void 0:t.igLoginStatus)!==null;case"instagram":return(t==null?void 0:t.igLoginStatus)===null&&(t==null?void 0:t.fbLoginStatus)!==null;default:return!1}}function f(e){var t=n("sdk.AuthState").getState().mixedAuthState;(t==null?void 0:t.fbLoginStatus)!=null&&(t==null?void 0:t.igLoginStatus)!=null||(t={authResponse:null,status:"unknown",loginSource:e},r("sdk.AuthUtils").AuthInternalEvent.inform("xFoAFetchCompleted",t))}t={getLoginStatusCORS:s},o=t,i.default=o},98),t.__d("sdk.Auth.LoginStatus",["Log","QueryString","sdk.Auth","sdk.AuthState","sdk.AuthStorageUtils","sdk.AuthUtils","sdk.Cookie","sdk.Runtime","sdk.Scribe","sdk.SignedRequest","sdk.feature","sdk.statusCORS"],function(l,t,n,r,o,a,i){"use strict";var e=/^https?:\/\/([\w\.]+)?\.facebook\.com\/?/;n("sdk.Runtime").subscribe("AccessToken.change",function(e){!e&&n("sdk.Runtime").getLoginStatus()==="connected"&&m(null,!0)});function l(e){if(e.legacyStatusInit?_.getLoginStatus(function(e){e!=null&&e.status==="connected"&&r("sdk.Scribe").log("jssdk_error",{appId:n("sdk.Runtime").getClientID(),error:"legacy_status_init_success"})}):e.status&&_.getLoginStatus(),n("sdk.Runtime").getClientID()&&n("sdk.Runtime").getUseCookie()){n("sdk.feature")("log_cookies_usage",!1)&&r("sdk.Scribe").log("jssdk_error",{appId:n("sdk.Runtime").getClientID(),error:"jssdk_cookie_toggled_on"}),e=r("sdk.Cookie").loadSignedRequest();var t;if(e){try{t=r("sdk.SignedRequest").parse(e)}catch(e){r("sdk.Cookie").clearSignedRequestCookie()}t!=null&&t.user_id!=null&&n("sdk.Runtime").setCookieUserID(t.user_id)}}}function s(e){window.location.protocol!=="https:"&&p(e);var t=n("sdk.AuthState").getState().timer;t&&(window.clearTimeout(t),n("sdk.AuthState").setState({timer:null})),r("sdk.AuthUtils").resetFBAndIGLoginStatus(),t=r("sdk.Cookie").getRaw(r("sdk.AuthUtils").AuthConstants.LOGOUT_COOKIE_PREFIX)==="y";var o=d(e),a=o.access_token;if(o=o.redirect_cancelled,t||o){p(e);return}t=r("sdk.AuthStorageUtils").getLocalStorageTokens(),o=t.fbToken,t=t.igToken,a!=null&&(c(a,"startsWith",!0,"IG")?t=a:o=a),n("sdk.Runtime").getShouldLoadFamilyLogin()&&n("sdk.feature")("should_enable_ig_login_status_fetch",!1)?n("sdk.Runtime").getFamilyLoginLoaded()?r("sdk.AuthUtils").AuthInternalEvent.inform(r("sdk.AuthUtils").AuthConstants.LOAD_XFOA_SUBSCRIBERS):n("sdk.Runtime").subscribe("FamilyLoginLoaded.change",function(e){e&&r("sdk.AuthUtils").AuthInternalEvent.inform(r("sdk.AuthUtils").AuthConstants.LOAD_XFOA_SUBSCRIBERS)}):r("sdk.AuthUtils").AuthInternalEvent.subscribe(r("sdk.AuthUtils").AuthConstants.CORS_FETCH_COMPLETED_EVENT,n("sdk.Auth").setFinalAuthResponse),u(o,t,e)}function u(e,t,o){n("sdk.statusCORS").getLoginStatusCORS(o,e,n("sdk.AuthState").getState().currentAuthResponse,"facebook"),n("sdk.Runtime").getShouldLoadFamilyLogin()&&n("sdk.feature")("should_enable_ig_login_status_fetch",!1)&&(t!=null?n("sdk.statusCORS").getLoginStatusCORS(o,t,n("sdk.AuthState").getState().currentAuthResponse,"instagram"):(e={authResponse:null,status:"unknown",loginSource:"instagram",cb:o},r("sdk.AuthUtils").AuthInternalEvent.inform(r("sdk.AuthUtils").AuthConstants.CORS_FETCH_COMPLETED_EVENT,e)))}function d(t){var o=null,a=!1;if(n("sdk.Runtime").getLoginStatus()!=="connected"&&(document.referrer===""||e.test(document.referrer))){var i=location.hash.substr(1);if(i!==""){var l=n("QueryString").decode(i,!0);o=l.access_token;var s=l.signed_request;if(o!=null&&r("sdk.AuthUtils").removeLogoutState(),window==top&&o!=null){var u=t;t=function(t){var e;t!=null&&t.status==="connected"&&((e=t.authResponse)==null?void 0:e.accessToken)===o&&(delete l.access_token,delete l.code,delete l.signed_request,location.hash=n("QueryString").encode(l),s!=null&&t.authResponse!=null&&(t.authResponse.signedRequest=s)),u!=null&&u(t)}}}i=n("QueryString").decode(location.search),i.error==="access_denied"&&(a=!0)}return{access_token:o,redirect_cancelled:a}}function m(t,o){o===void 0&&(o=!1);var a=n("sdk.Runtime").getClientID();if(a==null||a===""){r("Log").warn("FB.getLoginStatus() called before calling FB.init()."),p(t);return}if(!(typeof a=="number"||typeof a=="string")||a===0||typeof a=="string"&&(a==="0"||!/^\d+$/.test(a))){r("Log").warn("FB.getLoginStatus() not checked for an invalid client ID "+a),p(t);return}if(a=n("sdk.Runtime").getLoginStatus()!=="connected"&&e.test(document.referrer)&&location.hash.indexOf("cb=")>-1,!a&&!o&&(a=r("sdk.AuthStorageUtils").getCachedResponse(),a!=null)){var i;n("sdk.AuthState").setState({loadState:"loaded"}),n("sdk.Auth").setAuthResponse(a.authResponse,(i=a.status)!=null?i:"unknown","facebook",!0),r("sdk.AuthUtils").setRevalidateTimer(a.status==="connected"?r("sdk.AuthUtils").AuthConstants.CONNECTED_REVALIDATE_PERIOD:r("sdk.AuthUtils").AuthConstants.DEFAULT_REVALIDATE_PERIOD)}if(!o){if(n("sdk.AuthState").getState().loadState==="loaded"){t&&(i={authResponse:n("sdk.Auth").getAuthResponse(),status:n("sdk.Runtime").getLoginStatus()},t(i));return}else if(n("sdk.AuthState").getState().loadState==="loading"){t&&r("sdk.AuthUtils").AuthInternalEvent.subscribe("FB.loginStatus",t);return}}t&&r("sdk.AuthUtils").AuthInternalEvent.subscribe("FB.loginStatus",t),n("sdk.AuthState").setState({loadState:"loading"}),a=function(t){n("sdk.AuthState").setState({loadState:"loaded"}),r("sdk.AuthUtils").AuthInternalEvent.inform("FB.loginStatus",t),r("sdk.AuthUtils").AuthInternalEvent.clearSubscribers("FB.loginStatus")},s(a)}function p(e){var t="unknown";n("sdk.Auth").setAuthResponse(null,t,null),t={authResponse:null,status:t,loginSource:null},e&&e(t)}var _={getLoginStatus:m,fetchLoginStatus:s,onSDKInit:l};t=_,i.default=t},98),t.__d("sdk.LoggingUtils",["sdk.Impressions","sdk.feature"],function(o,l,n,r,s,a,i){"use strict";var e={buttonLoad:"client_login_button_load",buttonClick:"client_login_click",loginSuccess:"client_login_success",loginCancel:"client_login_cancel",popupHide:"client_login_popup_hide_xfoa",popupShow:"client_login_popup_show_xfoa",loginEnd:"client_login_end",loginStart:"client_login_start",loginCompleteHeartbeat:"client_login_complete_heartbeat",loginStatusPopupShowXfoa:"client_login_status_popup_show_xfoa",loginStatusPopupHideXfoa:"client_login_status_popup_hide_xfoa",loginStatusPopupClickXfoa:"client_login_status_popup_click_xfoa",loginStatusPopupErrorXfoa:"client_login_status_popup_error_xfoa"};function t(e,t,o){r("sdk.Impressions").log(117,{payload:d.extends({},o||{},{logger_id:e,action:t,client_funnel_version:n("sdk.feature")("oauth_funnel_logger_version",1)})})}function o(e,n){var r=e&&e.cbt!==void 0?Number(e.cbt):0;t(e==null?void 0:e.logger_id,n,{cbt_delta:Date.now()-r})}function l(e,n){n!==void 0&&t(e,n)}function s(n,r){n!==void 0&&t(r,e.loginStatusPopupErrorXfoa,{message:n})}i.logEventName=e,i.logEvent=t,i.logLoginEvent=o,i.logPopupEvent=l,i.logDisambiguationTrayEvent=s},98),t.__d("sdk.Auth",["Log","UrlMap","sdk.AuthState","sdk.AuthStorageUtils","sdk.AuthUtils","sdk.Cookie","sdk.Frictionless","sdk.LoggingUtils","sdk.Runtime","sdk.Scribe","sdk.SignedRequest","sdk.URI","sdk.ui"],function(o,t,n,r,l,m,i){t("sdk.Frictionless");var e=5*1e3;function o(e,t){t&&t.perms&&!t.scope&&(t.scope=t.perms,delete t.perms,r("Log").warn("OAuth2 specification states that 'perms' should now be called 'scope'.  Please update."));var o=n("sdk.Runtime").isEnvironment(n("sdk.Runtime").ENVIRONMENTS.CANVAS)||n("sdk.Runtime").isEnvironment(n("sdk.Runtime").ENVIRONMENTS.PAGETAB);n("sdk.ui")(d.extends({method:"permissions.oauth",display:o?"async":"popup",domain:location.hostname},t||{}),e)}function a(e){switch(e){case"connected":return"connected";case"not_authorized":return"not_authorized";default:return"unknown"}}function l(e){(e==null?void 0:e.shouldSetAuthResponse)!==!1&&((e==null?void 0:e.status)==="connected"&&r("sdk.AuthUtils").setRevalidateTimer(),s(e==null?void 0:e.authResponse,a(e==null?void 0:e.status),e==null?void 0:e.loginSource));var t=e==null?void 0:e.cb;t!=null&&(e={authResponse:e==null?void 0:e.authResponse,status:a(e==null?void 0:e.status),loginSource:e==null?void 0:e.loginSource},t(e)),r("sdk.AuthUtils").AuthInternalEvent.clearSubscribers(r("sdk.AuthUtils").AuthConstants.CORS_FETCH_COMPLETED_EVENT),r("sdk.AuthUtils").AuthInternalEvent.clearSubscribers(r("sdk.AuthUtils").AuthConstants.XFOA_FINAL_RESPONSE_EVENT)}function s(e,t,o,a){o===void 0&&(o="facebook"),a===void 0&&(a=!1);var i=n("sdk.Runtime").getUserID(),l=n("sdk.Runtime").getLoginStatus(),s="";if(e!=null){if(n("sdk.AuthState").setState({loadState:"loaded"}),e.userID!=null&&e.userID!=="")s=e.userID;else if(e.signedRequest!=null&&e.signedRequest!==""){var u=r("sdk.SignedRequest").parse(e.signedRequest);u!=null&&u!==""&&u.user_id!=null&&u.user_id!==""&&(s=u.user_id)}n("sdk.Runtime").getUseCookie()&&(u=e.expiresIn===0?0:Date.now()+e.expiresIn*1e3,r("sdk.Cookie").setSignedRequestCookie(e.signedRequest,u))}else n("sdk.Runtime").getUseCookie()&&r("sdk.Cookie").clearSignedRequestCookie(),n("sdk.Runtime").getUseLocalStorage()&&r("sdk.AuthStorageUtils").removeLocalStorageToken((u=o)!=null?u:"facebook");u=l==="unknown"&&e!=null||n("sdk.Runtime").getUseCookie()&&n("sdk.Runtime").getCookieUserID()!==s;var c=i!=null&&i!==""&&e==null;i=e!=null&&i!=null&&i!==""&&i!=s;var d=e!=n("sdk.AuthState").getState().currentAuthResponse;return l=t!=l,n("sdk.Runtime").setLoginStatus(t),n("sdk.Runtime").setAccessToken(e&&e.accessToken||null),n("sdk.Runtime").setUserID(s),n("sdk.Runtime").setGraphDomain(e&&e.graphDomain||""),n("sdk.AuthState").setState({currentAuthResponse:e}),s={authResponse:e,status:t,loginSource:o},(c||i)&&r("sdk.AuthUtils").AuthInternalEvent.inform("logout",s),(u||i)&&r("sdk.AuthUtils").AuthInternalEvent.inform("login",s),d&&r("sdk.AuthUtils").AuthInternalEvent.inform("authresponse.change",s),l&&r("sdk.AuthUtils").AuthInternalEvent.inform("status.change",s),a||r("sdk.AuthStorageUtils").setSessionStorage(e,t),s}function u(){return n("sdk.AuthState").getState().currentAuthResponse}function m(e){var t=u(),o=r("sdk.AuthUtils").isInstagramLogin(t)?"instagram":"facebook";if(s(null,"unknown",o),r("sdk.AuthUtils").setLogoutState(),t!=null&&t.accessToken!=null){o=new(n("sdk.URI"))(r("UrlMap").resolve("www").replace("web.","www.")+"/x/oauth/logout").addQueryData("access_token",t.accessToken);var a=new XMLHttpRequest,i=!1;a&&(a.open("GET",o.toString(),!0),a.withCredentials=!0,e&&(a.onreadystatechange=function(){if(a.readyState>=2){if(i)return;e({authResponse:u(),status:n("sdk.Runtime").getLoginStatus()}),i=!0}}),a.send())}r("sdk.Scribe").log("jssdk_error",{appId:n("sdk.Runtime").getClientID(),error:"PLATFORM_AUTH_LOGOUT",extra:{args:{fblo:!0}}})}function p(e,t,o,a){return function(o){if(o&&o.access_token){var i=r("sdk.SignedRequest").parse(o.signed_request);i=i!=null&&i.user_id!=null?i.user_id:null,t={accessToken:o.access_token,userID:i,expiresIn:Number(o.expires_in),signedRequest:o.signed_request,graphDomain:o.graph_domain},o.asset_scopes&&(t=d.extends({},t,{asset_scopes:c("JSON","parse",!1,o.asset_scopes)})),t=f(t,o),r("sdk.AuthUtils").removeLogoutState(),i="connected",s(t,i),_(a)}else if(o&&o.asset_scopes)t={asset_scopes:c("JSON","parse",!1,o.asset_scopes)},t=f(t,o),r("sdk.AuthUtils").removeLogoutState(),i="connected",s(t,i),_(a);else if(o&&(o.error||o.error_message||o.error_description||o.error_code||o.error_reason||o.result&&o.result.closeWindow)){r("sdk.AuthUtils").setLogoutState(),i="unknown",s(null,i);var l=o.error_message||o.error_description;i={authResponse:u(),status:i,message:l},o.error==="access_denied"||o.result&&o.result.closeWindow?r("sdk.AuthUtils").AuthInternalEvent.inform("loginDenied",i):r("sdk.AuthUtils").AuthInternalEvent.inform("loginError",i)}else o&&o.result&&(r("sdk.AuthUtils").removeLogoutState(),t=o.result.authResponse);return e&&(l={authResponse:t,status:n("sdk.Runtime").getLoginStatus()},e(l)),t}}function _(t){t&&t.tp&&t.tp!=="unspecified"||(r("sdk.LoggingUtils").logLoginEvent(t,r("sdk.LoggingUtils").logEventName.loginEnd),window.setTimeout(function(){r("sdk.LoggingUtils").logLoginEvent(t,r("sdk.LoggingUtils").logEventName.loginCompleteHeartbeat)},e))}function f(e,t){return t.granted_scopes&&(e=d.extends({},e,{grantedScopes:t.granted_scopes})),t.data_access_expiration_time&&(e=d.extends({},e,{data_access_expiration_time:Number(t.data_access_expiration_time)})),t.base_domain!=null&&r("sdk.AuthUtils").setBaseDomain(t.base_domain),r("sdk.AuthUtils").setGraphDomain(t.graph_domain),t.enforce_https&&n("sdk.Runtime").setEnforceHttps(!0),t.referred&&(e=d.extends({},e,{referred:t.referred})),r("sdk.AuthStorageUtils").setLocalStorageToken(e,t.long_lived_token),e}t={setFinalAuthResponse:l,login:o,logout:m,setAuthResponse:s,getAuthResponse:u,parseSignedRequest:r("sdk.SignedRequest").parse,xdResponseWrapper:p,subscribe:r("sdk.AuthUtils").AuthInternalEvent.subscribe,unsubscribe:r("sdk.AuthUtils").AuthInternalEvent.unsubscribe},l=t,i.default=l},98),t.__d("dedupString",[],function(e,t,n,r,o,a){"use strict";function e(e){var t;return Object.keys((t={},t[e]=0,t))[0]}a.default=e},66),t.__d("emptyFunction",[],function(e,t,n,r,o,a){function e(e){return function(){return e}}t=function(){},t.thatReturns=e,t.thatReturnsFalse=e(!1),t.thatReturnsTrue=e(!0),t.thatReturnsNull=e(null),t.thatReturnsThis=function(){return this},t.thatReturnsArgument=function(e){return e},n=t,a.default=n},66),t.__d("passiveEventListenerUtil",[],function(i,t,n,r,o,a){"use strict";t=!1;try{n=Object.defineProperty({},"passive",{get:function(){t=!0}}),window.addEventListener("test",null,n)}catch(e){}var e=t;function i(t){return e||typeof t=="boolean"?t:t.capture||!1}a.isPassiveEventListenerSupported=e,a.makeEventOptions=i},66),t.__d("DOMEventListener",["invariant","dedupString","emptyFunction","passiveEventListenerUtil","wrapFunction"],function(e,t,n,r,o,a,i){var l=t("passiveEventListenerUtil").isPassiveEventListenerSupported,s,u;window.addEventListener?(s=function(n,r,o,a){a===void 0&&(a=!1),o.wrapper=t("wrapFunction")(o,"entry",t("dedupString")("DOMEventListener.add "+r)),n.addEventListener(r,o.wrapper,l?a:!1)},u=function(t,n,r,o){o===void 0&&(o=!1),t.removeEventListener(n,r.wrapper,l?o:!1)}):window.attachEvent?(s=function(n,r,o,a){o.wrapper=t("wrapFunction")(o,"entry","DOMEventListener.add "+r),n.attachEvent||i(0,2798),n.attachEvent("on"+r,o.wrapper)},u=function(t,n,r,o){t.detachEvent||i(0,2799),t.detachEvent("on"+n,r.wrapper)}):u=s=t("emptyFunction"),e={add:function(t,n,r,o){return o===void 0&&(o=!1),s(t,n,r,o),{remove:function(){u(t,n,r,o)}}},remove:u},o.exports=e},null),t.__d("JSONRPC",["Log"],function(e,t,n,r,o,a){e=(function(){"use strict";function e(e){var t=this;this.$1=0,this.$2={},this.remote=function(e){return t.$3=e,t.remote},this.local={},this.$4=e}var n=e.prototype;return n.stub=function(e){var t=this;this.remote[e]=function(){for(var n={jsonrpc:"2.0",method:e},r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];typeof o[o.length-1]=="function"&&(n.id=++t.$1,t.$2[n.id]=o.pop()),n.params=o,t.$4(c("JSON","stringify",!1,n),t.$3||{method:e})}},n.read=function(e,n){e=c("JSON","parse",!1,e);var r=e.id;if(!e.method){if(!this.$2[r]){t("Log").warn("Could not find callback %s",r);return}var o=this.$2[r];delete this.$2[r],delete e.id,delete e.jsonrpc,o(e);return}var a=this;o=this.local[e.method];var i;if(r?i=function(t,o){var e={jsonrpc:"2.0",id:r};e[t]=o,window.setTimeout(function(){a.$4(c("JSON","stringify",!1,e),n)},0)}:i=function(){},!o){t("Log").error('Method "%s" has not been defined',e.method),i("error",{code:-32601,message:"Method not found",data:e.method});return}e.params.push(c(i,"bind",!0,null,"result")),e.params.push(c(i,"bind",!0,null,"error"));try{o=o.apply(n||null,e.params),typeof o!="undefined"&&i("result",o)}catch(n){t("Log").error("Invokation of RPC method %s resulted in the error: %s",e.method,n.message),i("error",{code:-32603,message:"Internal error",data:n.message})}},e})(),o.exports=e},null),t.__d("Queue",[],function(e,t,n,r,o,a){var i={};e=(function(){function e(e){this._timeout=null,this._interval=(e==null?void 0:e.interval)||0,this._processor=e==null?void 0:e.processor,this._queue=[],this._stopped=!0}var t=e.prototype;return t._dispatch=function(e){var t=this;if(!(this._stopped||this._queue.length===0)){if(e=this._processor,e==null)throw this._stopped=!0,new Error("No processor available");var n=this._interval;if(n!=null)e.call(this,this._queue.shift()),this._timeout=setTimeout(function(){return t._dispatch()},n);else for(;this._queue.length;)e.call(this,this._queue.shift())}},t.enqueue=function(e){return this._processor&&!this._stopped?this._processor(e):this._queue.push(e),this},t.start=function(e){return e&&(this._processor=e),this._stopped=!1,this._dispatch(),this},t.isStarted=function(){return!this._stopped},t.dispatch=function(){this._dispatch(!0)},t.stop=function(e){return this._stopped=!0,e&&this._timeout!=null&&clearTimeout(this._timeout),this},t.merge=function(e,t){return t?(t=this._queue).unshift.apply(t,e._queue):(t=this._queue).push.apply(t,e._queue),e._queue=[],this._dispatch(),this},t.getLength=function(){return this._queue.length},e.get=function(t,n){var r;return t in i?r=i[t]:r=i[t]=new e(n),r},e.exists=function(e){return e in i},e.remove=function(e){return delete i[e]},e})(),a.default=e},66),t.__d("sdk.RPC",["Assert","JSONRPC","Queue"],function(e,t,n,r,o,a,i){var l=new(n("Queue")),s=new(n("JSONRPC"))(function(e){l.enqueue(e)});e={local:s.local,remote:s.remote,stub:c(s.stub,"bind",!0,s),setInQueue:function(t){n("Assert").isInstanceOf(n("Queue"),t),t.start(function(e){s.read(e)})},getOutQueue:function(){return l}},t=e,i.default=t},98),t.__d("sdk.Canvas.Environment",["sdk.RPC"],function(e,t,n,r,o,a,i){function e(e){n("sdk.RPC").remote.getPageInfo(function(t){e(t.result)})}function t(e,t){n("sdk.RPC").remote.scrollTo({x:e||0,y:t||0})}n("sdk.RPC").stub("getPageInfo"),n("sdk.RPC").stub("scrollTo"),r={getPageInfo:e,scrollTo:t},o=r,i.default=o},98),t.__d("sdk.DialogUtils",["DOMEventListener","sdk.Content","sdk.DOM","sdk.UA"],function(a,l,n,r,s,u,i){"use strict";var e=590,t=240,o=575;function a(){return window.innerWidth<window.innerHeight}function l(e,t,n){var o=null;return r("DOMEventListener").add(e,"click",function(){o!==null&&(window.clearTimeout(o),o=null,t()),o=window.setTimeout(function(){o=null},n)})}function s(e,t,n){var o,a,i=function(){o=window.setTimeout(t,n)};return i(),r("DOMEventListener").add(e,"mouseenter",function(){window.clearTimeout(o),a||(a=r("DOMEventListener").add(e,"mouseleave",function(){i()}))})}function u(e){if(!n("sdk.UA").mobile())return null;var t="onorientationchange"in window?"orientationchange":"resize",o=function(n){return window.setTimeout(function(t){return e(t)},50)};return r("DOMEventListener").add(window,t,o)}function c(e){if(e!=null){var t=r("sdk.DOM").getViewportInfo();e.style.minHeight=t.height?t.height+"px":"",e.style.top=t.scrollTop?t.scrollTop+"px":""}}function d(a,i,l){var s,u,c,d=function(t){return typeof t=="number"?t:parseInt(t,10)},m=r("sdk.DOM").getViewportInfo(),p=d(a.offsetWidth);d=d(a.offsetHeight),s=(s=m.scrollLeft)!=null?s:0+((s=m.width)!=null?s:o-p)/2,p=((p=m.height)!=null?p:t-d)/2.5,s<p&&(p=s),u=(u=m.height)!=null?u:t-d-p,c=((c=m.height)!=null?c:t-d)/2,l&&(c=l.scrollTop-l.offsetTop+(l.clientHeight-d)/2),c<p?c=p:c>u&&(c=u),c+=(l=m.scrollTop)!=null?l:0,n("sdk.UA").mobile()&&(p=100,i?(p+=((u=m.height)!=null?u:e-d)/2,r("sdk.DOM").addCss(document.body,"fb_reposition")):(r("sdk.DOM").addCss(document.body,"fb_hidden"),document.body.style.width="auto",c=1e4),l=r("sdk.DOM").getByClass("fb_dialog_padding",a),l.length&&(l[0].style.height=p+"px")),a.style.left=(s>0?s:0)+"px",a.style.top=(c>0?c:0)+"px"}function m(t,n,o){d(t,n,o),n=r("sdk.DOM").getViewportInfo(),n=(o=n.scrollTop)!=null?o:0+((o=n.height)!=null?o:e-t.offsetHeight)*.05,r("sdk.DOM").setStyle(t,"top",n+"px")}function p(){var e=document.createElement("div");return e.setAttribute("id","fb_dialog_ipad_overlay"),c(e),e}function _(e){e=e||{};var t=document.createElement("div"),o=e;if(o=o.onClose,e.closeIcon&&o){var a=document.createElement("a");a.className="fb_dialog_close_icon",r("DOMEventListener").add(a,"click",o),t.appendChild(a)}return o="fb_dialog",o+=" "+(e.classes||""),o+=n("sdk.UA").mobile()?" fb_dialog_mobile":" fb_dialog_advanced",t.className=o,e.width&&(a=parseInt(e.width,10),isNaN(a)||(t.style.width=a+"px")),o=document.createElement("div"),e.content&&r("sdk.Content").append(e.content,o),o.className="fb_dialog_content",t.appendChild(o),n("sdk.UA").mobile()&&(a=document.createElement("div"),a.className="fb_dialog_padding",t.appendChild(a)),{dialogElement:t,contentRoot:o}}function f(e){var t=document.body;e?r("sdk.DOM").removeCss(t,"fb_reposition"):r("sdk.DOM").removeCss(t,"fb_hidden")}i.isOrientationPotrait=a,i.addDoubleClickAction=l,i.addIdleDesktopAction=s,i.addMobileOrientationChangeAction=u,i.applyScreenDimensions=c,i.setDialogPositionToCenter=d,i.setDialogPositionToTop=m,i.setupNewDarkOverlay=p,i.setupNewDialog=_,i.onDialogHideCleanup=f},98),t.__d("sdk.fbt",[],function(e,t,n,r,o,a){e=function(){},e._=function(e){var t=typeof e=="string"?e:e[0];return t==null&&typeof e=="object"&&e!==null&&!Array.isArray(e)&&"*"in e&&(t=e["*"]),t},t=e,a.default=t},66),t.__d("sdk.Dialog",["DOMEventListener","ObservableMixin","Type","sdk.Canvas.Environment","sdk.Content","sdk.DOM","sdk.DialogUtils","sdk.Runtime","sdk.UA","sdk.fbt"],function(e,t,n,r,o,a,i){var l=30,s=590,u=500,d=240,m=575;function p(){var e=r("sdk.DOM").getViewportInfo(),t=e.height;return e=e.width,t!=null&&e!=null?{width:Math.min(e,u),height:Math.min(t,s)}:null}var _=n("Type").extend({constructor:function(t,n){this.parent(),this.id=t,this.display=n,this._e2e={},f._dialogs||(f._dialogs={},f._addOrientationHandler()),f._dialogs[t]=this,this.trackEvent("init")},trackEvent:function(t,n){return this._e2e[t]?this:(this._e2e[t]=n||Date.now(),t=="close"&&this.inform("e2e:end",this._e2e),this)},trackEvents:function(t){typeof t=="string"&&(t=c("JSON","parse",!1,t));for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&this.trackEvent(e,t[e]);return this}},n("ObservableMixin")),f={newInstance:function(t,n){return new _(t,n)},_dialogs:null,_lastYOffset:0,_availScreenWidth:null,_overlayListeners:[],_loaderEl:null,_overlayEl:null,_stack:[],_active:null,get:function(t){return f._dialogs[t]},_findRoot:function(t){for(t=t;t;){if(r("sdk.DOM").containsCss(t,"fb_dialog"))return t;t.parentElement instanceof HTMLElement&&(t=t.parentElement)}},_createWWWLoader:function(t){t=t||"460";var e=document.createElement("div");return e.innerHTML='<div class="dialog_title">  <a id="fb_dialog_loader_close">    <div class="fb_dialog_close_icon"></div>  </a>  <span>Facebook</span>  <div style="clear:both;"></div></div><div class="dialog_content"></div><div class="dialog_footer"></div>',f.create({content:e,width:t})},_createMobileLoader:function(){var e=document.createElement("div");return n("sdk.UA").nativeApp()?e.innerHTML='<div class="dialog_header"></div>':f.isTabletStyle()?e.innerHTML='<div class="overlayLoader"><div id="fb_dialog_loader_spinner"></div><a id="fb_dialog_loader_close" href="#">'+n("sdk.fbt")._("Cancel")+"</a></div>":e.innerHTML='<div class="dialog_header"><table>  <tbody>    <tr>      <td class="header_left">        <label class="touchable_button">          <input type="submit" value="'+n("sdk.fbt")._("Cancel")+'"            id="fb_dialog_loader_close"/>        </label>      </td>      <td class="header_center">        <div>         '+n("sdk.fbt")._("Loading...")+'        </div>      </td>      <td class="header_right">      </td>    </tr>  </tbody></table></div>',f.create({classes:"loading"+(f.isTabletStyle()?" centered":""),content:e})},_setDialogOverlayStyle:function(){f._overlayEl!=null&&r("sdk.DialogUtils").applyScreenDimensions(f._overlayEl)},_showTabletOverlay:function(t){f.isTabletStyle()&&(f._overlayEl==null?(t=r("sdk.DialogUtils").setupNewDarkOverlay(),t.className="",f._overlayEl=t,r("sdk.Content").append(f._overlayEl,null)):f._overlayEl.className="")},_hideTabletOverlay:function(){f.isTabletStyle()&&(f._overlayEl!=null&&(f._overlayEl.className="hidden"),f._overlayListeners.forEach(function(e){return e.remove()}),f._overlayListeners=[])},showLoader:function(t,o){t||(t=function(){});var e=function(){f._hideLoader(),r("sdk.DialogUtils").onDialogHideCleanup(f.isTabletStyle()),f._hideTabletOverlay(),t!=null&&t()};f._showTabletOverlay(e),f._loaderEl||(f._loaderEl=f._findRoot(n("sdk.UA").mobile()?f._createMobileLoader():f._createWWWLoader(o))),o=document.getElementById("fb_dialog_loader_close"),o&&(r("sdk.DOM").removeCss(o,"fb_hidden"),o=r("DOMEventListener").add(o,"click",e),f._overlayListeners.push(o)),f._loaderEl!=null&&f._makeActive(f._loaderEl)},_hideLoader:function(){f._loaderEl&&f._loaderEl==f._active&&(f._loaderEl.style.top="-10000px")},_makeActive:function(t){f._setDialogSizes(),f._lowerActive(),f._active=t,n("sdk.Runtime").isEnvironment(n("sdk.Runtime").ENVIRONMENTS.CANVAS)&&n("sdk.Canvas.Environment").getPageInfo(function(e){f._centerActive(e)}),f._centerActive()},_lowerActive:function(){f._active&&(f._active.style.top="-10000px",f._active=null)},_removeStacked:function(t){f._stack=f._stack.filter(function(e){return e!=t})},_centerActive:function(t){var e=f._active;e&&r("sdk.DialogUtils").setDialogPositionToCenter(e,f.isTabletStyle(),t)},_setDialogSizes:function(t){if(t===void 0&&(t=!1),!!n("sdk.UA").mobile()){for(var e in f._dialogs)if(Object.prototype.hasOwnProperty.call(f._dialogs,e)){var r=document.getElementById(e);r&&(r.style.width=f.getDefaultSize().width+"px",t||(r.style.height=f.getDefaultSize().height+"px"))}}},getDefaultSize:function(){if(n("sdk.UA").mobile()){var e=p();if(e){var t;return((t=(t=r("sdk.DOM").getViewportInfo())==null?void 0:t.width)!=null?t:u<=e.width)&&(e.width=(t=(t=r("sdk.DOM").getViewportInfo())==null?void 0:t.width)!=null?t:u-l),((t=(t=r("sdk.DOM").getViewportInfo())==null?void 0:t.height)!=null?t:s<=e.height)&&(e.height=(t=(t=r("sdk.DOM").getViewportInfo())==null?void 0:t.height)!=null?t:s-l),e}if(n("sdk.UA").ipad())return{width:u,height:s};if(n("sdk.UA").android())return{width:screen.availWidth,height:screen.availHeight};t=window.innerWidth,e=window.innerHeight;var o=t/e>1.2;return{width:t,height:Math.max(e,o?screen.width:screen.height)}}return{width:m,height:d}},_handleOrientationChange:function(){var e;if(f._availScreenWidth=(e=(e=r("sdk.DOM").getViewportInfo())==null?void 0:e.width)!=null?e:u,f.isTabletStyle())f._setDialogSizes(!0),f._centerActive(),f._setDialogOverlayStyle();else{e=f.getDefaultSize().width;for(var t in f._dialogs)if(Object.prototype.hasOwnProperty.call(f._dialogs,t)){var n=document.getElementById(t);n&&(n.style.width=e+"px")}}},_addOrientationHandler:function(){var e;n("sdk.UA").mobile()&&(f._availScreenWidth=(e=(e=r("sdk.DOM").getViewportInfo())==null?void 0:e.width)!=null?e:u,r("sdk.DialogUtils").addMobileOrientationChangeAction(f._handleOrientationChange))},create:function(t){var e=r("sdk.DialogUtils").setupNewDialog(t);return r("sdk.Content").append(e.dialogElement),t.visible&&f.show(e.dialogElement),typeof t.styles=="object"&&c("Object","assign",!1,e.dialogElement.style,t.styles),e.contentRoot},show:function(t){var e=f._findRoot(t);e!=null&&(f._removeStacked(e),f._hideLoader(),f._makeActive(e),f._stack.push(e),"fbCallID"in t&&f.get(t.fbCallID).inform("iframe_show").trackEvent("show"))},hide:function(t){var e=f._findRoot(t);f._hideLoader(),e==f._active&&(f._lowerActive(),r("sdk.DialogUtils").onDialogHideCleanup(f.isTabletStyle()),f._hideTabletOverlay(),"fbCallID"in t&&f.get(t.fbCallID).inform("iframe_hide").trackEvent("hide"))},remove:function(t){var e=f._findRoot(t);e&&(t=f._active==e,f._removeStacked(e),t?(f._hideLoader(),f._stack.length>0?f.show(f._stack.pop()):(f._lowerActive(),r("sdk.DialogUtils").onDialogHideCleanup(f.isTabletStyle()),f._hideTabletOverlay())):f._active===null&&f._stack.length>0&&f.show(f._stack.pop()),window.setTimeout(function(){var t;(t=e.parentNode)==null||t.removeChild(e)},3e3))},isActive:function(t){return t=f._findRoot(t),t!=null&&t===f._active},isTabletStyle:function(){if(!n("sdk.UA").mobile())return!1;var e=p();return e!=null&&(e.height>=s||e.width>=u)}};e=f,i.default=e},98),t.__d("sdk.PlatformVersioning",["ManagedError","sdk.Runtime"],function(t,l,n,r,o,a,i){var e=/^v\d+\.\d\d?$/;function t(){if(!n("sdk.Runtime").getVersion())throw new(n("ManagedError"))("init not called with valid version")}function l(t){if(!e.test(t))throw new(n("ManagedError"))("invalid version specified")}i.REGEX=e,i.assertVersionIsSet=t,i.assertValidVersion=l},98),t.__d("sdk.warnInsecure",["Log","sdk.Runtime","sdk.Scribe","sdk.feature"],function(s,t,n,r,o,a,i){"use strict";var e=n("sdk.feature")("https_only_learn_more",""),l={};function s(t){return window.location.protocol!=="https:"&&(r("Log").log("error",-1,"The method FB.%s can no longer be called from http pages. %s",t,e),n("sdk.feature")("https_only_scribe_logging",!0)&&!Object.prototype.hasOwnProperty.call(l,t)&&(r("sdk.Scribe").log("jssdk_error",{appId:n("sdk.Runtime").getClientID(),error:"HttpsOnly",extra:{message:t}}),l[t]=!0)),!0}i.default=s},98),t.__d("sdk.api",["ApiClient","sdk.PlatformVersioning","sdk.Runtime","sdk.URI","sdk.warnInsecure"],function(e,t,n,r,o,a,i){function e(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),a=1;a<t;a++)o[a-1]=arguments[a];if(n("sdk.warnInsecure")("api"),typeof e=="string")if(n("sdk.Runtime").getIsVersioned()){r("sdk.PlatformVersioning").assertVersionIsSet();var i=e;!/https?/.test(i)&&i.charAt(0)!=="/"&&(i="/"+i),i=new(n("sdk.URI"))(i).setDomain("").setProtocol("").toString(),r("sdk.PlatformVersioning").REGEX.test(i.substring(1,i.indexOf("/",1)))||(i="/"+n("sdk.Runtime").getVersion()+i);var l=[i].concat(Array.prototype.slice.call(arguments,1));n("ApiClient").graph.apply(n("ApiClient"),l)}else n("ApiClient").graph.apply(n("ApiClient"),arguments);else n("ApiClient").rest.apply(n("ApiClient"),arguments)}i.default=e},98),t.__d("sdk.Frictionless",["sdk.Auth.LoginStatus","sdk.Dialog","sdk.Event","sdk.api"],function(e,t,n,r,o,a,i){var l={_allowedRecipients:{},_useFrictionless:!1,_updateRecipients:function(){l._allowedRecipients={},n("sdk.api")("/me/apprequestformerrecipients",function(e){!e||e!=null&&e.error||e.data.forEach(function(e){l._allowedRecipients[e.recipient_id]=!0})})},init:function(){l._useFrictionless=!0,n("sdk.Auth.LoginStatus").getLoginStatus(function(e){(e==null?void 0:e.status)=="connected"&&l._updateRecipients()}),r("sdk.Event").subscribe("auth.login",function(e){e.authResponse&&l._updateRecipients()})},_processRequestResponse:function(t,r){return function(e){var o=e&&e.updated_frictionless;l._useFrictionless&&o!==null&&l._updateRecipients(),e&&(!r&&e.frictionless!==null&&n("sdk.Dialog")._hideLoader(),delete e.frictionless,delete e.updated_frictionless),t&&t(e)}},isAllowed:function(t){if(t=t,!t)return!1;if(typeof t=="number")return t in l._allowedRecipients;typeof t=="string"&&(t=t.split(",")),t=t.map(function(e){return String(e).trim()});var e=!0,n=!1;return t.forEach(function(t){e=e&&t in l._allowedRecipients,n=!0}),e&&n}};e=l,i.default=e},98),t.__d("resolveURI",[],function(e,t,n,r,o,a){function e(e){if(e==null||e==="")return window.location.href;var t=document.createElement("a");return t.href=e,t.href}a.default=e},66),t.__d("sdk.NativeExtensions",["DOMEventListener","Log","sdk.UA"],function(s,t,n,r,o,a,i){var e="fbNativeExtensionsReady";function l(){return window._FBSdkExtensions&&window._FBSdkExtensions.jsonRPC&&window._FBSdkExtensions.initializeCallbackHandler&&window._FBSdkExtensions.supportsDialog?window._FBSdkExtensions:null}function s(t){if(!n("sdk.UA").facebookInAppBrowser()){r("Log").error("FB.NativeExtensions.onReady only works when the page is rendered in a WebView of the native Facebook app.");return}var o=l();if(o){t(o);return}var a=!1;o=function n(){var o=l();a||!o||(a=!0,t(o),r("DOMEventListener").remove(window,e,n))},r("DOMEventListener").add(window,e,o)}i.onReady=s},98),t.__d("sdk.Extensions",["JSONRPC","Queue","sdk.NativeExtensions","sdk.UA"],function(d,t,n,r,o,a,i){"use strict";var e=new(n("Queue")),l=new(n("JSONRPC"))(function(t){e.enqueue(t)}),s=new(n("Queue"));s.start(function(e){l.read(e)});var u=null;n("sdk.UA").facebookInAppBrowser()&&r("sdk.NativeExtensions").onReady(function(t){u=t,window._FBBrowserCallbackHandler=function(e){s.enqueue(c("JSON","stringify",!1,e))},t.initializeCallbackHandler(c("JSON","stringify",!1,{name:"_FBBrowserCallbackHandler"})),e.start(function(e){t.jsonRPC(e)})}),t=l.local,o=l.remote,a=c(l.stub,"bind",!0,l);function d(e){return!!u&&u.supportsDialog(e)}i.local=t,i.remote=o,i.stub=a,i.supportsDialog=d},98),t.__d("sdk.Native",["Log","sdk.UA"],function(e,t,n,r,o,a,i){var l="fbNativeReady";e={onready:function(t){if(!n("sdk.UA").nativeApp()){r("Log").error("FB.Native.onready only works when the page is rendered in a WebView of the native Facebook app. Test if this is the case calling FB.UA.nativeApp()");return}if(window.__fbNative&&!this.nativeReady&&c("Object","assign",!1,this,window.__fbNative),this.nativeReady)t();else{var e=function e(){window.removeEventListener(l,e),this.onready(t)};window.addEventListener(l,e,!1)}}},t=e,i.default=t},98),t.__d("sdk.Popup",["sdk.Content","sdk.Runtime","sdk.Scribe","sdk.UA","sdk.feature"],function(e,t,n,r,o,a,i){"use strict";function e(e,t){var o=l({name:e.name,height:e.size.height,width:e.size.width,isOAuth:t}),a;return e.post?(a=window.open("about:blank",e.id,o),a&&r("sdk.Content").submitToTarget({url:e.url,target:e.id,params:e.params})):a=window.open(e.url,e.id,o),!a&&n("sdk.feature")("popup_blocker_scribe_logging",!0)&&(o=t?"POPUP_MAYBE_BLOCKED_OAUTH":"POPUP_MAYBE_BLOCKED",r("sdk.Scribe").log("jssdk_error",{appId:n("sdk.Runtime").getClientID(),error:o,extra:{call:e.name}})),a}function l(e){var t=window.screenX,r=window.screenY,o=window.outerWidth,a=window.outerHeight,i=n("sdk.UA").mobile()?0:e.width,l=n("sdk.UA").mobile()?0:e.height;return t=t<0?window.screen.width+t:t,t=t+(o-i)/2,o=r+(a-l)/2.5,r=[],i!==null&&r.push("width="+i),l!==null&&r.push("height="+l),r.push("left="+t),r.push("top="+o),r.push("scrollbars=1"),e.isOAuth&&(r.push("toolbar=0"),(!n("sdk.UA").chrome()||n("sdk.UA").chrome()<59)&&r.push("location=1")),r.join(",")}i.popup=e},98),t.__d("isFacebookDotNetURI",[],function(e,t,n,r,o,a){"use strict";function e(e){if(e.getProtocol()!=="http"&&e.getProtocol()!=="https")return!1;var t=Number(e.getPort());return t&&t!==80&&t!==443?!1:!!e.isSubdomainOfDomain("facebook.net")}a.default=e},66),t.__d("isFacebookURI",[],function(l,t,n,r,o,a){var e=null,i=["http","https"];function l(t){return e||(e=new RegExp("(^|\\.)facebook\\.com$","i")),t.isEmpty()&&t.toString()!=="#"?!1:!t.getDomain()&&!t.getProtocol()?!0:i.indexOf(t.getProtocol())!==-1&&e.test(t.getDomain())}l.setRegex=function(t){e=t},a.default=l},66),t.__d("isInstagramURI",[],function(i,t,n,r,o,a){var e=null;function i(t){return t.isEmpty()&&t.toString()!=="#"||!t.getDomain()&&!t.getProtocol()||t.getProtocol()!=="https"?!1:(e||(e=new RegExp("(^|\\.)instagram\\.com$","i")),e.test(t.getDomain()))}a.default=i},66),t.__d("resolveWindow",[],function(e,t,n,r,o,a){function e(e){if(e==null)return null;var t=window;e=e.split(".");try{for(var n=0;n<e.length;n++){var r=e[n],o=/^frames\[[\'\"]?([a-zA-Z0-9\-_]+)[\'\"]?\]$/.exec(r);if(o)t=t.frames[o[1]];else if(r==="opener"||r==="parent"||r==="top")t=t[r];else return null}}catch(e){return null}return t}a.default=e},66),t.__d("sdk.XD",["JSSDKXDConfig","Log","QueryString","Queue","UrlMap","guid","isFacebookDotNetURI","isFacebookURI","isInstagramURI","resolveWindow","sdk.Event","sdk.RPC","sdk.Runtime","sdk.Scribe","sdk.URI","sdk.feature"],function(e,t,n,r,o,a,i){var l=new(n("Queue")),s="parent",u=null,d=/^https:\/\/.*\.(facebook|instagram)\.(com|net)$/;e=r("JSSDKXDConfig").useCdn?"cdn":"www";var m=r("UrlMap").resolve(e)+r("JSSDKXDConfig").XXdUrl;t=function(){if("origin"in location){if(location.origin&&location.origin!="null")return location.origin;if(window!==window.parent)try{var e=parent.location.origin;if(e&&e!="null")return e}catch(e){}}return location.protocol+"//"+location.host};var p=n("guid")(),_=t(),f=!1,g=new(n("Queue"));n("sdk.RPC").setInQueue(g);function h(e){r("Log").info("Remote XD can talk to facebook.com (%s)",e),n("sdk.Runtime").setEnvironment(e==="canvas"?n("sdk.Runtime").ENVIRONMENTS.CANVAS:n("sdk.Runtime").ENVIRONMENTS.PAGETAB)}function y(e,t){if(!t)throw r("Log").error("No senderOrigin"),new Error;switch(e.xd_action){case"plugin_ready":if(typeof e.name=="string"){var o=e.name;if(r("Log").info("Plugin %s ready from %s",o,t),d.test(t)){var a=n("Queue").get(o,{});a.start(function(e){if(e==null){r("Log").warn("Discarding null message from %s to %s on %s",t,o,_);return}window.frames[o]!=null?window.frames[o].postMessage({xdArbiterHandleMessage:!0,message:e,origin:_},t):r("Log").info("Message discarded for plugin at window.frames[%s] which may have been removed by a new XFBML.parse() call.",o)})}else{r("Log").error("Plugin attempted to register from non-Facebook domain %s",t);return}}else r("Log").error("plugin_ready message received without a name");break}e.data!=null&&(typeof e.data=="object"||typeof e.data=="string")&&C(e.data,t)}function C(e,t){var o=new(n("sdk.URI"))(t);if(!(t!=null&&t!=="native"&&!n("isFacebookURI")(o)&&!n("isFacebookDotNetURI")(o)&&!n("isInstagramURI")(o))){if(typeof e=="string"){if(/^FB_RPC:/.test(e)){g.enqueue(e.substring(7));return}if(e.substring(0,1)=="{")try{e=c("JSON","parse",!1,e)}catch(t){r("Log").warn("Failed to decode %s as JSON",e);return}else e=n("QueryString").decode(e)}if(o=e,o.xd_action){y(o,t);return}typeof o.cb=="string"&&(e=R._callbacks[o.cb],R._forever[o.cb]||delete R._callbacks[o.cb],e&&e(o))}}function b(e,t){e=="facebook"?(t.relation=s,l.enqueue(t),!n("sdk.Runtime").isCanvasEnvironment()&&!l.isStarted()&&S(u)):n("Queue").get(e,{}).enqueue(t)}n("sdk.RPC").getOutQueue().start(function(e){l.enqueue("FB_RPC:"+e)});function v(e){f||(f=!0,window.addEventListener("message",function(e){var t=e.data,o=e.origin||"native";if(!/^(https?:\/\/|native$)/.test(o)){r("Log").debug("Received message from invalid origin type: %s",o);return}if(d.test(o))if(typeof t=="string")C(t,o);else{if(e.source==parent&&e.data.xdArbiterRegisterAck&&d.test(o)){typeof e.data.xdArbiterRegisterAck=="string"&&e.data.xdArbiterRegisterAck!==""&&h(e.data.xdArbiterRegisterAck),l.isStarted()||l.start(function(e){if(e==null){r("Log").warn("Discarding null message from %s to %s",_,o);return}var t=parent;typeof e=="object"&&typeof e.relation=="string"&&(t=n("resolveWindow")(e.relation)),((t=t)!=null?t:parent).postMessage({xdArbiterHandleMessage:!0,message:e,origin:_},o)});return}return}}),n("sdk.Runtime").isCanvasEnvironment()&&S(e))}function S(e){var t;if(f||v(),window.parent!=top){r("Log").warn("cannot deliver messages to facebook unless window.parent is top and facebook.com.");return}var o=(t=n("sdk.feature")("xd_timeout",6e4))!=null?t:6e4;t=200;var a=0,i=o/t,s=function(){return parent.postMessage({xdArbiterRegister:!0,xdProxyName:e,origin:_},"*")};a=window.setInterval(function(){if(!l.isStarted()&&i>0)i--,r("Log").debug("resending xdArbiterRegister"),s();else if(window.clearInterval(a),i===0){r("sdk.Scribe").log("jssdk_error",{appId:n("sdk.Runtime").getClientID(),error:"XD_FB_QUEUE_INITIALIZATION",extra:{message:"Failed to initialize in "+o+"ms"}}),r("Log").error("xdAbiterRegisterAck not received");return}},t)}var R={rpc:n("sdk.RPC"),_callbacks:{},_forever:{},_channel:p,_origin:_,onMessage:C,init:v,sendToFacebook:b,inform:function(t,n,r,o){b("facebook",{method:t,params:c("JSON","stringify",!1,n||{}),behavior:o||"p",relation:r})},handler:function(t,r,o,a){return t="#"+n("QueryString").encode({cb:R.registerCallback(t,o,a),origin:_+"/"+p,domain:location.hostname,relation:r||"opener",is_canvas:n("sdk.Runtime").isCanvasEnvironment()}),m+t},registerCallback:function(t,r,o){return o=o||n("guid")(),r&&(R._forever[o]=!0),R._callbacks[o]=t,o}};r("sdk.Event").subscribe("init:post",function(e){u=e.xdProxyName,v(e.xdProxyName)}),a.exports=R},34),t.__d("sdk.modFeatureCheck",["JSSDKConfig"],function(e,t,n,r,o,a,i){function e(e,t,n){if(n===void 0&&(n=!1),r("JSSDKConfig").features&&e in r("JSSDKConfig").features){var o=r("JSSDKConfig").features[e];if(typeof o=="object"&&Array.isArray(o))return t.some(function(e){return o.some(function(t){return e%t===0})})}return n}i.forIDs=e},98),t.__d("sdk.openMessenger",["sdk.UA"],function(u,t,n,r,o,a,i){"use strict";var e="https://itunes.apple.com/us/app/messenger/id454638411",l="https://play.google.com/store/apps/details?id=com.facebook.orca",s=3e3;function u(t){var r,o,a=t.link;t=t.app_id,n("sdk.UA").android()?(r="intent://share/#Intent;package=com.facebook.orca;scheme=fb-messenger;S.android.intent.extra.TEXT="+encodeURIComponent(a)+";S.trigger=send_plugin;",t&&(r+="S.platform_app_id="+encodeURIComponent(t)+";"),r+="end",o=l):(r="fb-messenger://share?link="+encodeURIComponent(a),t&&(r+="&app_id="+encodeURIComponent(t)),o=e),setTimeout(function(){window.location.href=o},s),window.location.href=r}i.default=u},98),t.__d("sdk.UIServer",["Log","QueryString","UrlMap","createObjectFrom","flattenObject","guid","insertIframe","resolveURI","sdk.Auth","sdk.Auth.LoginStatus","sdk.Content","sdk.DOM","sdk.Dialog","sdk.Event","sdk.Extensions","sdk.Frictionless","sdk.LoggingUtils","sdk.Native","sdk.Popup","sdk.RPC","sdk.Runtime","sdk.UA","sdk.XD","sdk.api","sdk.fbt","sdk.feature","sdk.getContextType","sdk.modFeatureCheck","sdk.openMessenger"],function(e,t,n,r,o,a,i){var l={transform:function(t){return t.params.display==="touch"&&h.canIframe(t.params)&&window.postMessage?(t.params.channel=h._xdChannelHandler(t.id,"parent"),n("sdk.UA").nativeApp()||(t.params.in_iframe=1),t):h.genericTransform(t)},getXdRelation:function(t){var e=t.display;return e==="touch"&&window.postMessage&&t.in_iframe?"parent":h.getXdRelation(t)}};function s(e){return h.isOAuth(e)&&r("sdk.Extensions").supportsDialog("oauth")}function u(e){return h.isOAuth(e)&&(e.is_account_link===!0||e.is_account_link==="true")&&r("sdk.Extensions").supportsDialog("accountLink")}function m(e){if(!n("sdk.Runtime").getClientID()){r("Log").error("FB.login() called before FB.init().");return}if(n("sdk.Auth").getAuthResponse()&&!e.params.scope&&!e.params.asset_scope&&!e.params.auth_type){e.params.plugin_prepare||(r("Log").error("FB.login() called when user is already connected."),e.cb&&(e==null||e.cb({status:n("sdk.Runtime").getLoginStatus(),authResponse:n("sdk.Auth").getAuthResponse()})));return}var t=e.cb,o=e.id;delete e.cb,e&&e.params&&!e.params.logger_id&&(e.params.logger_id=n("guid")()),e&&e.params&&!e.params.cbt&&(e.params.cbt=Date.now()),(e.params.fx_app==="instagram"||e.params.fx_app==="ig_single")&&!e.params.scope&&(e.params.scope="public_profile");var a=e.params.auth_type;a=a&&c(a,"includes",!0,"reauthenticate");var i={token:!0,signed_request:!0,graph_domain:!0};return i=Object.keys(c("Object","assign",!1,e.params.response_type?n("createObjectFrom")(e.params.response_type.split(",")):{},i)).join(","),e.params.display==="async"?(c("Object","assign",!1,e.params,{client_id:n("sdk.Runtime").getClientID(),origin:n("sdk.getContextType")(),response_type:i,domain:location.hostname}),e.cb=n("sdk.Auth").xdResponseWrapper(t,n("sdk.Auth").getAuthResponse(),"permissions.oauth",e.params)):(a&&h._xdNextHandler(function(e){t({authResponse:null,status:"not_authorized"})},o,e.params.plugin_prepare?"opener.parent":"opener",!0),c("Object","assign",!1,e.params,{client_id:n("sdk.Runtime").getClientID(),redirect_uri:n("resolveURI")(h.xdHandler(t,o,e.params.plugin_prepare?"opener.parent":"opener",n("sdk.Auth").getAuthResponse(),"permissions.oauth",!a,e.params)),origin:n("sdk.getContextType")(),response_type:i,domain:location.hostname})),o=e.params&&e.params.tp&&e.params.tp!=="unspecified",!e.params.plugin_prepare&&!o&&r("sdk.LoggingUtils").logEvent(e.params.logger_id,r("sdk.LoggingUtils").logEventName.loginStart,{cbt_delta:0}),e}e={"stream.share":{size:{width:670,height:340},url:"sharer.php",transform:function(t){return t.params.u||(t.params.u=window.location.toString()),t.params.display="popup",t}},gaming_friendfinder:{url:"gaming/me/friendfinder/",transform:function(t){if(!n("sdk.Runtime").getClientID()){r("Log").error("FriendFinder called before FB.init().");return}return t.url+=n("sdk.Runtime").getClientID(),t.size={width:400,height:800},t}},gaming_media_library:{url:"gaming/me/media_asset/",transform:function(t){return t.url+=t.params.media_id,t.size={width:400,height:800},t}},apprequests:{transform:function(t){return t=l.transform(t),t.size={width:445,height:635},t.params.display="popup",t.params.in_iframe=!1,t.params.frictionless=n("sdk.Frictionless")&&n("sdk.Frictionless")._useFrictionless,t.params.frictionless&&(n("sdk.Frictionless").isAllowed(t.params.to)&&(t.hideLoader=!0),t.cb=n("sdk.Frictionless")._processRequestResponse(t.cb,t.hideLoader)),t.closeIcon=!1,t},getXdRelation:l.getXdRelation},"permissions.oauth":{url:"dialog/oauth",size:{width:n("sdk.UA").mobile()?null:600,height:n("sdk.UA").mobile()?null:679},transform:function(t){return m(t)}},"permissions.ig_oauth":{url:"oauth/authorize",size:{width:n("sdk.UA").mobile()?null:600,height:n("sdk.UA").mobile()?null:679},transform:function(t){return m(t)}},photo_picker:{url:"dialog/photo_picker",size:{width:n("sdk.UA").mobile()?null:600,height:n("sdk.UA").mobile()?null:679},transform:function(t){if(!n("sdk.Runtime").getClientID()){r("Log").error("Photo Picker was called before FB.init().");return}var e=t.cb,o=t.id;return delete t.cb,c("Object","assign",!1,t.params,{client_id:n("sdk.Runtime").getClientID(),redirect_uri:n("resolveURI")(h.xdHandlerPhotoPicker(e,o,t.params.plugin_prepare?"opener.parent":"opener","photo_picker",t.params)),origin:n("sdk.getContextType")(),domain:location.hostname}),t}},"auth.logout":{transform:function(t){n("sdk.Runtime").getClientID()?n("sdk.Auth").getAuthResponse()?n("sdk.Auth").logout(t.cb):r("Log").error("FB.logout() called without an access token."):r("Log").error("FB.logout() called before calling FB.init().")}},"login.status":{transform:function(t){n("sdk.Auth.LoginStatus").getLoginStatus(t.cb)}},pay:{size:{width:555,height:120},connectDisplay:"popup"},live_broadcast:{transform:function(t){return t.params.phase==="create"&&(t.size={width:480,height:280}),t.params.phase==="publish"&&(t.size={width:772,height:540}),t},require_access_token:!0},boost:{transform:function(t){return t.size={width:960,height:760},t.params.display="popup",t}},share_referral:{size:{width:482,height:725}}};var p={},_=0;function f(e,t){return p[t]=!0,function(n){delete p[t],e(n)}}function g(e){var t=e.method.toLowerCase();return t==="pay"&&e.display==="async"}var h={Methods:e,_oauthMethodNameSet:new Set(["permissions.oauth","permissions.request","permissions.ig_oauth"]),_loadedNodes:{},_defaultCb:{},_resultToken:'"xxRESULTTOKENxx"',_popupInterval:null,genericTransform:function(t){return(t.params.display=="dialog"||t.params.display=="iframe")&&c("Object","assign",!1,t.params,{display:"iframe",channel:h._xdChannelHandler(t.id,"parent.parent")},!0),t},isOAuth:function(t){return h._oauthMethodNameSet.has(t.method)||t.method=="oauth"},checkOauthDisplay:function(t){var e=t.scope||t.perms||n("sdk.Runtime").getScope();return e?"popup":t.display},prepareCall:function(t,o){var e=t.method.toLowerCase(),a=Object.prototype.hasOwnProperty.call(h.Methods,e)?d.extends({},h.Methods[e]):{},i=t.id||n("guid")(),l=!0;if(c("Object","assign",!1,t,{app_id:n("sdk.Runtime").getClientID(),locale:n("sdk.Runtime").getLocale(),sdk:"joey",access_token:l&&n("sdk.Runtime").getAccessToken()||void 0}),t.display=h.getDisplayMode(a,t),a.url||(a.url="dialog/"+e),(a.url=="dialog/oauth"||a.url=="dialog/permissions.request")&&(t.display=="iframe"||t.display=="touch"&&t.in_iframe)&&(t.display=h.checkOauthDisplay(t)),a.url=="dialog/oauth"){if(_>=((l=n("sdk.feature")("max_oauth_dialog_retries",100))!=null?l:100)){r("Log").error("Your request to oauth has exceeded the rate limit, please try again later");return}_++}if(t.display=="popup"&&!a.require_access_token&&delete t.access_token,n("sdk.Runtime").getIsVersioned()&&a.url.substring(0,7)==="dialog/"&&(l=t.version||n("sdk.Runtime").getVersion(),l!=null&&l!==""&&l!=="null"&&(a.url=l+"/"+a.url)),g(t)){if(p[e]){l='Dialog "'+e+'" is trying to run more than once.',r("Log").warn(l),o({error_code:-100,error_message:l});return}o=f(o,e)}if(l={cb:o,id:i,size:a.size||h.getDefaultSize(),url:r("UrlMap").resolve(t.fx_app==="instagram"||t.fx_app==="ig_single"?"www_instagram":t.display=="touch"?"m":"www")+"/"+a.url,params:t,name:e,dialog:n("sdk.Dialog").newInstance(i,t.display)},o=a.transform?a.transform:h.genericTransform,!(o&&(l=o(l),!l)))return t.display==="touch"&&t.in_iframe&&(l.params.parent_height=window.innerHeight),e=a.getXdRelation||h.getXdRelation,o=e(l.params),!(l.id in h._defaultCb)&&!("next"in l.params)&&!("redirect_uri"in l.params)&&(l.params.next=h._xdResult(l.cb,l.id,o,!0)),(o==="parent"||o==="opener")&&c("Object","assign",!1,l.params,{channel_url:h._xdChannelHandler(i,o==="parent"?"parent.parent":"opener")},!0),l=h.prepareParams(l),l},prepareParams:function(t){t.params.display!=="async"&&delete t.params.method,t.params.kid_directed_site=n("sdk.Runtime").getKidDirectedSite()||t.params.kid_directed_site,t.params=n("flattenObject")(t.params);var e=n("QueryString").encode(t.params);return!n("sdk.UA").nativeApp()&&h.urlTooLongForIE(t.url+"?"+e)?t.post=!0:e&&(t.url+="?"+e),t},urlTooLongForIE:function(t){return n("sdk.UA").ie()!=null&&n("sdk.UA").ie()<=8&&t.length>2048},getDisplayMode:function(t,o){if(o.display==="hidden"||o.display==="none"||o.display==="native")return o.display;var e=n("sdk.Runtime").isEnvironment(n("sdk.Runtime").ENVIRONMENTS.CANVAS)||n("sdk.Runtime").isEnvironment(n("sdk.Runtime").ENVIRONMENTS.PAGETAB);return e&&(r("sdk.modFeatureCheck").forIDs("force_popup_to_canvas_apps_with_id",[n("sdk.Runtime").getClientID()])||n("sdk.feature")("force_popup_to_all_canvas_app",!1))?"popup":e&&!o.display||s(o)||u(o)?"async":n("sdk.UA").mobile()||o.display==="touch"?"touch":(o.display=="iframe"||o.display=="dialog")&&!h.canIframe(o)?(r("Log").error('"dialog" mode can only be used when the user is connected.'),"popup"):t.connectDisplay&&!e?t.connectDisplay:o.display||(h.canIframe(o)?"dialog":"popup")},canIframe:function(t){return n("sdk.Runtime").getAccessToken()},getXdRelation:function(t){return t=t.display,t==="popup"||t==="touch"?"opener":t==="dialog"||t==="iframe"||t==="hidden"||t==="none"?"parent":t==="async"?"parent.frames["+window.name+"]":""},popup:function(t){var e=r("sdk.Popup").popup(t,h.isOAuth({method:t.name}));e&&(h.setLoadedNode(t,e,"popup"),t.id in h._defaultCb&&h._popupMonitor())},setLoadedNode:function(t,n,r){r==="iframe"&&(n.fbCallID=t.id),n={node:n,type:r,fbCallID:t.id,method:t.name,params:t.params},h._loadedNodes[t.id]=n},getLoadedNode:function(t){return t=typeof t=="object"?t.id:t,t=h._loadedNodes[t],t?t.node:null},hidden:function(t){t.className="FB_UI_Hidden",t.root=r("sdk.Content").appendHidden(document.createElement("div")),h._insertIframe(t)},iframe:function(t){t.className="FB_UI_Dialog";var e=function(){var e=c("JSON","stringify",!1,{error_code:4201,error_message:n("sdk.fbt")._("User canceled the Dialog flow")});h._triggerDefault(t.id,e)},o={onClose:e,closeIcon:t.closeIcon===void 0?!0:t.closeIcon,classes:n("sdk.Dialog").isTabletStyle()?"centered":""};t.root=n("sdk.Dialog").create(o),t.hideLoader||n("sdk.Dialog").showLoader(e,t.size.width),r("sdk.DOM").addCss(t.root,"fb_dialog_iframe"),h._insertIframe(t)},touch:function(t){t.params&&t.params.in_iframe?t.ui_created?n("sdk.Dialog").showLoader(function(){h._triggerDefault(t.id,null)},0):h.iframe(t):n("sdk.UA").nativeApp()&&!t.ui_created?(t.frame=t.id,n("sdk.Native").onready(function(){h.setLoadedNode(t,n("sdk.Native").open(t.url+"#cb="+t.frameName),"native")}),h._popupMonitor()):t.ui_created||h.popup(t)},async:function(t){t.params.redirect_uri=location.protocol+"//"+location.host+location.pathname,delete t.params.access_token,t.params.is_canvas=n("sdk.Runtime").isCanvasEnvironment();var e=function(r){if(r=r.result,r&&r.e2e){var e=n("sdk.Dialog").get(t.id);e.trackEvents(r.e2e),e.trackEvent("close"),delete r.e2e}t.cb(r)};s(t.params)||u(t.params)?(t.params.method="oauth",t.params.redirect_uri=t.params.next,r("sdk.Extensions").remote.showDialog(t.params,e)):n("sdk.RPC").remote.showDialog(t.params,e)},native:function(t){n("sdk.openMessenger")(t.params)},getDefaultSize:function(){return n("sdk.Dialog").getDefaultSize()},_insertIframe:function(t){h._loadedNodes[t.id]=!1;var e=function(n){t.id in h._loadedNodes&&h.setLoadedNode(t,n,"iframe")};t.post?n("insertIframe")({url:"about:blank",root:t.root,className:t.className,width:t.size.width,height:t.size.height,id:t.id,onInsert:e,onload:function(n){r("sdk.Content").submitToTarget({url:t.url,target:n.name,params:t.params})}}):n("insertIframe")({url:t.url,root:t.root,className:t.className,width:t.size.width,height:t.size.height,id:t.id,name:t.frameName,onInsert:e})},_handleResizeMessage:function(t,r){t=h.getLoadedNode(t),t&&(r.height&&(t.style.height=r.height+"px"),r.width&&r.width!=0&&(t.style.width=r.width+"px"),n("sdk.XD").inform("resize.ack",r||{},"parent.frames["+t.name+"]"),n("sdk.Dialog").isActive(t)?n("sdk.Dialog")._centerActive():n("sdk.Dialog").show(t))},_triggerDefault:function(t,n){var e={frame:t,result:""};n&&(e.result=n),h._xdRecv(e,h._defaultCb[t]||function(){})},_popupMonitor:function(){var e;for(var t in h._loadedNodes)if(Object.prototype.hasOwnProperty.call(h._loadedNodes,t)&&t in h._defaultCb){var r=(function(){var r=h._loadedNodes[t];if(r.type!="popup"&&r.type!="native")return"continue";var o=r.node;try{o.closed?h.isOAuth(r)?n("sdk.Auth.LoginStatus").getLoginStatus(function(e){(e==null?void 0:e.status)==="connected"&&r.params!=null&&r.params.return_scopes?n("sdk.api")("/me/permissions",function(n){(!n||n.error)&&h._triggerDefault(t,e);var r="";n=n&&n.data?n.data:[];for(var o=0;o<n.length;o++)n[o].status==="granted"&&(r!==""&&(r+=","),r+=n[o].permission);e.authResponse&&e.authResponse.grantedScopes&&(e.authResponse.grantedScopes=r),h._triggerDefault(t,e)}):((e==null?void 0:e.status)!=="connected"&&(e.closeWindow=!0),h._triggerDefault(t,e))},!0):h._triggerDefault(t,null):e=!0}catch(e){}})();if(r==="continue")continue}e&&!h._popupInterval?h._popupInterval=window.setInterval(h._popupMonitor,100):!e&&h._popupInterval&&(window.clearInterval(h._popupInterval),h._popupInterval=null)},_xdChannelHandler:function(t,o){return n("sdk.XD").handler(function(e){var o=h.getLoadedNode(t);o&&(e.type=="resize"?h._handleResizeMessage(t,e):e.type=="hide"?n("sdk.Dialog").hide(o):e.type=="rendered"?(o=n("sdk.Dialog")._findRoot(o),n("sdk.Dialog").show(o)):e.type=="fireevent"&&r("sdk.Event").fire(e.event,e))},o,!0,null)},_xdNextHandler:function(t,r,o,a){return a&&(h._defaultCb[r]=t),n("sdk.XD").handler(function(e){h._xdRecv(e,t)},o)+"&frame="+r},_xdRecv:function(t,o){var e=h.getLoadedNode(t.frame);if(e)if(e.close)try{e.close(),/iPhone.*Version\/(5|6)/.test(navigator.userAgent)&&RegExp.$1!=="5"&&window.focus(),h._popupCount--}catch(e){}else r("sdk.DOM").containsCss(e,"FB_UI_Hidden")?window.setTimeout(function(){e.parentNode.parentNode.removeChild(e.parentNode)},3e3):r("sdk.DOM").containsCss(e,"FB_UI_Dialog")&&n("sdk.Dialog").remove(e);if(delete h._loadedNodes[t.frame],delete h._defaultCb[t.frame],t.e2e){var a=n("sdk.Dialog").get(t.frame);a.trackEvents(t.e2e),a.trackEvent("close"),delete t.e2e}o(t)},_xdResult:function(t,n,r,o){return h._xdNextHandler(function(e){t&&t(e.result&&e.result!=h._resultToken&&c("JSON","parse",!1,e.result))},n,r,o)+"&result="+encodeURIComponent(h._resultToken)},xdHandler:function(t,r,o,a,i,l,s){return h._xdNextHandler(n("sdk.Auth").xdResponseWrapper(t,a,i,s),r,o,l)},xdHandlerPhotoPicker:function(t,n,r,o,a){return h._xdNextHandler(h.xdResponseWrapperPhotoPicker(t),n,r,!1)},xdResponseWrapperPhotoPicker:function(t){return function(e){var n;return e&&e.result&&e.result.closeWindow?n="Photo picker call was cancelled by the user":n=e.photos,t&&t(n),null}}};r("sdk.Extensions").stub("showDialog"),n("sdk.RPC").stub("showDialog"),t=h,i.default=t},98),t.__d("sdk.ui",["Assert","Log","sdk.Impressions","sdk.PlatformVersioning","sdk.Runtime","sdk.UIServer","sdk.feature"],function(e,t,n,r,o,a,i){function e(e,t){if(n("Assert").isObject(e),n("Assert").maybeFunction(t),n("sdk.Runtime").getIsVersioned()&&(r("sdk.PlatformVersioning").assertVersionIsSet(),e.version?r("sdk.PlatformVersioning").assertValidVersion(e.version):e.version=n("sdk.Runtime").getVersion()),e=d.extends({},e),!e.method)return r("Log").error('"method" is a required parameter for FB.ui().'),null;e.method=="pay.prompt"&&(e.method="pay");var o=e.method;if(e.redirect_uri&&(r("Log").warn("When using FB.ui, you should not specify a redirect_uri."),delete e.redirect_uri),e.fallback_redirect_uri||(e.fallback_redirect_uri=document.location.href),n("sdk.UIServer").isOAuth(o)&&(e.display=="iframe"||e.display=="dialog")&&(e.display=n("sdk.UIServer").checkOauthDisplay(e)),e.display==="native"&&o!=="send")return r("Log").error('display type "native" not supported'),null;var a=n("sdk.feature")("e2e_tracking",!0);if(a&&(e.e2e={}),e=n("sdk.UIServer").prepareCall(e,t||function(){}),!e)return null;var i=e.params.display;return i==="dialog"?i="iframe":i==="none"&&(i="hidden"),t=n("sdk.UIServer")[i],t?(a&&e.dialog.subscribe("e2e:end",function(e){e.method=o,e.display=i,r("Log").debug("e2e: %s",c("JSON","stringify",!1,e)),r("sdk.Impressions").log(114,{payload:e})}),t(e),e.dialog):(r("Log").error('"display" must be one of "popup", "dialog", "iframe", "touch", "async", "hidden", or "none"'),null)}i.default=e},98),t.__d("sdk.Auth-public",["FB","sdk.Auth","sdk.Auth.LoginStatus","sdk.AuthUtils","sdk.Event","sdk.Runtime","sdk.ui","sdk.warnInsecure"],function(e,t,n,r,o,a,i){"use strict";function e(){n("FB").provide("",{getLoginStatus:function(){return n("sdk.warnInsecure")("getLoginStatus"),n("sdk.Auth.LoginStatus").getLoginStatus.apply(n("sdk.Auth"),arguments)},getAuthResponse:function(){return n("sdk.warnInsecure")("getAuthResponse"),n("sdk.Auth").getAuthResponse()},getAccessToken:function(){return n("sdk.warnInsecure")("getAccessToken"),n("sdk.Runtime").getAccessToken()||null},getUserID:function(){return n("sdk.warnInsecure")("getUserID"),n("sdk.Runtime").getUserID()||n("sdk.Runtime").getCookieUserID()},login:function(t,r){n("sdk.warnInsecure")("login"),n("sdk.Auth").login(t,r)},logout:function(t){n("sdk.ui")({method:"auth.logout",display:"hidden"},t)}}),n("sdk.Auth").subscribe("logout",c(r("sdk.Event").fire,"bind",!0,r("sdk.Event"),"auth.logout")),n("sdk.Auth").subscribe("login",c(r("sdk.Event").fire,"bind",!0,r("sdk.Event"),"auth.login")),n("sdk.Auth").subscribe("authresponse.change",c(r("sdk.Event").fire,"bind",!0,r("sdk.Event"),"auth.authResponseChange")),n("sdk.Auth").subscribe("status.change",c(r("sdk.Event").fire,"bind",!0,r("sdk.Event"),"auth.statusChange")),n("sdk.Auth").subscribe("loginDenied",c(r("sdk.Event").fire,"bind",!0,r("sdk.Event"),"auth.denied")),n("sdk.Auth").subscribe("loginError",c(r("sdk.Event").fire,"bind",!0,r("sdk.Event"),"auth.error")),n("sdk.Runtime").subscribe("AccessToken.change",function(e){!e&&n("sdk.Runtime").getLoginStatus()==="connected"&&n("sdk.Auth.LoginStatus").getLoginStatus(null,!0)}),r("sdk.AuthUtils").AuthInternalEvent.subscribe(r("sdk.AuthUtils").AuthConstants.REVALIDATE_TIMER_TIMEOUT,function(e){n("sdk.Auth.LoginStatus").fetchLoginStatus(function(){})}),r("sdk.Event").subscribe("init:post",function(e){n("sdk.Auth.LoginStatus").onSDKInit(e)})}t={init:e},o=t,i.default=o},98),t.__d("sdk.Canvas.IframeHandling",["DOMWrapper","sdk.RPC"],function(c,t,n,r,o,a,i){var e=null,l;function s(){var e=r("DOMWrapper").getWindow().document,t=e.body;e=e.documentElement;var n=Math.max(t.offsetTop,0),o=Math.max(e.offsetTop,0),a=t.scrollHeight+n;return t=t.offsetHeight+n,n=e.scrollHeight+o,e=e.offsetHeight+o,Math.max(a,t,n,e)}function u(e){typeof e!="object"&&(e={});var t=0,r=0;if(e.height||(e.height=s(),t=16,r=4),e.frame||(e.frame=window.name||"iframe_canvas"),l){var o=l.height;if(o=e.height-o,o<=r&&o>=-t)return!1}return l=e,n("sdk.RPC").remote.setSize(e),!0}function c(t,n){n===void 0&&typeof t=="number"&&(n=t,t=!0),t||t===void 0?(e===null&&(e=window.setInterval(function(){u()},n||100)),u()):e!==null&&(window.clearInterval(e),e=null)}n("sdk.RPC").stub("setSize"),t={setSize:u,setAutoGrow:c},o=t,i.default=o},98),t.__d("sdk.Canvas.Navigation",["sdk.RPC"],function(e,t,n,r,o,a){function e(e){t("sdk.RPC").local.navigate=function(t){e({path:t})},t("sdk.RPC").remote.setNavigationEnabled(!0)}t("sdk.RPC").stub("setNavigationEnabled"),n={setUrlHandler:e},r=n,a.default=r},66),t.__d("sdk.Canvas.Plugin",["Log","sdk.Runtime","sdk.UA","sdk.api"],function(f,g,n,r,h,a,i){var e="CLSID:D27CDB6E-AE6D-11CF-96B8-444553540000",t="CLSID:444785F1-DE89-4295-863A-D46C3A781394",o=null;a=n("sdk.UA").osx()&&n("sdk.UA").osx.getVersionParts();var l=!(a&&a[0]>10&&a[1]>10&&(n("sdk.UA").chrome()>=31||n("sdk.UA").webkit()>=537.71||n("sdk.UA").firefox()>=25));function s(e){e._hideunity_savedstyle={},e._hideunity_savedstyle.left=e.style.left,e._hideunity_savedstyle.position=e.style.position,e._hideunity_savedstyle.width=e.style.width,e._hideunity_savedstyle.height=e.style.height,e.style.left="-10000px",e.style.position="absolute",e.style.width="1px",e.style.height="1px"}function u(e){e._hideunity_savedstyle&&(e.style.left=e._hideunity_savedstyle.left,e.style.position=e._hideunity_savedstyle.position,e.style.width=e._hideunity_savedstyle.width,e.style.height=e._hideunity_savedstyle.height)}function d(e){e._old_visibility=e.style.visibility,e.style.visibility="hidden"}function m(e){e.style.visibility=e._old_visibility||"",delete e._old_visibility}function p(t){var n=t.type?t.type.toLowerCase():null;if(n=n==="application/x-shockwave-flash"||t.classid&&t.classid.toUpperCase()==e,!n||(n=/opaque|transparent/i,n.test(t.getAttribute("wmode"))))return!1;for(var r=0;r<t.childNodes.length;r++){var o=t.childNodes[r];if(/param/i.test(o.nodeName)&&/wmode/i.test(o.name)&&n.test(o.value))return!1}return!0}function _(e){var n=e.type?e.type.toLowerCase():null;return n==="application/vnd.unity"||e.classid&&e.classid.toUpperCase()==t}function f(e){var t=c("Array","from",!1,window.document.getElementsByTagName("object"));t=t.concat(c("Array","from",!1,window.document.getElementsByTagName("embed")));var a=!1,i=!1;t.forEach(function(t){var n=p(t),c=l&&_(t);if(!(!n&&!c))if(a=a||n,i=i||c,c=function(){e.state==="opened"?n?d(t):s(t):n?m(t):u(t)},o){r("Log").info("Calling developer specified callback");var f={state:e.state,elem:t};o(f),window.setTimeout(c,200)}else c()}),Math.random()<=1/1e3&&(t={unity:i,flash:a},n("sdk.api")(n("sdk.Runtime").getClientID()+"/occludespopups","post",t))}function g(){d(),s()}function h(){m(),u()}a={_setHidePluginCallback:function(t){o=t},hidePluginCallback:f,hidePluginElement:g,showPluginElement:h},f=a,i.default=f},98),t.__d("sdk.Canvas.Prefetcher",["JSSDKCanvasPrefetcherConfig","sdk.Runtime","sdk.api"],function(u,d,n,r,m,a,i){var e={AUTOMATIC:0,MANUAL:1},t=(a=r("JSSDKCanvasPrefetcherConfig").excludedAppIds)!=null?a:[],o=e.AUTOMATIC,l=[];function s(){var t={object:"data",link:"href",script:"src"};o==e.AUTOMATIC&&Object.keys(t).forEach(function(e){var n=t[e];c("Array","from",!1,document.getElementsByTagName(e)).forEach(function(e){e[n]&&l.push(e[n])})}),l.length!==0&&(n("sdk.api")(n("sdk.Runtime").getClientID()+"/staticresources","post",{urls:c("JSON","stringify",!1,l),is_https:location.protocol==="https:"}),l=[])}function u(){!n("sdk.Runtime").isEnvironment(n("sdk.Runtime").ENVIRONMENTS.CANVAS)||!n("sdk.Runtime").getClientID()||!r("JSSDKCanvasPrefetcherConfig").sampleRate||Math.random()>=1/r("JSSDKCanvasPrefetcherConfig").sampleRate||!r("JSSDKCanvasPrefetcherConfig").enabled||c(t,"includes",!0,n("sdk.Runtime").getClientID())||setTimeout(s,3e4)}function d(e){o=e}function m(e){l.push(e)}a={COLLECT_AUTOMATIC:e.AUTOMATIC,COLLECT_MANUAL:e.MANUAL,addStaticResource:m,setCollectionMode:d,_maybeSample:u},m=a,i.default=m},98),t.__d("sdk.Canvas.Tti",["sdk.RPC","sdk.Runtime"],function(t,r,n,l,o,a,i){function e(e,t){t={appId:n("sdk.Runtime").getClientID(),time:Date.now(),name:t},t=[t],e&&t.push(function(t){e(t.result)}),n("sdk.RPC").remote.logTtiMessage.apply(null,t)}function t(){e(null,"StartIframeAppTtiTimer")}function r(t){e(t,"StopIframeAppTtiTimer")}function l(t){e(t,"RecordIframeAppTti")}n("sdk.RPC").stub("logTtiMessage"),o={setDoneLoading:l,startTimer:t,stopTimer:r},a=o,i.default=a},98),t.__d("sdk.Canvas-public",["Assert","FB","Log","sdk.Canvas.Environment","sdk.Canvas.IframeHandling","sdk.Canvas.Navigation","sdk.Canvas.Plugin","sdk.Canvas.Prefetcher","sdk.Canvas.Tti","sdk.Event","sdk.RPC","sdk.Runtime"],function(e,o,n,r,a,l,i){function e(){n("FB").provide("Canvas",{setSize:function(t){return n("Assert").maybeObject(t,"Invalid argument"),n("sdk.Canvas.IframeHandling").setSize.apply(null,arguments)},setAutoGrow:function(){return n("sdk.Canvas.IframeHandling").setAutoGrow.apply(null,arguments)},getPageInfo:function(t){return n("Assert").isFunction(t,"Invalid argument"),n("sdk.Canvas.Environment").getPageInfo.apply(null,arguments)},scrollTo:function(t,r){return n("Assert").maybeNumber(t,"Invalid argument"),n("Assert").maybeNumber(r,"Invalid argument"),n("sdk.Canvas.Environment").scrollTo.apply(null,arguments)},setDoneLoading:function(t){return n("Assert").maybeFunction(t,"Invalid argument"),n("sdk.Canvas.Tti").setDoneLoading.apply(null,arguments)},startTimer:function(){return n("sdk.Canvas.Tti").startTimer.apply(null,arguments)},stopTimer:function(t){return n("Assert").maybeFunction(t,"Invalid argument"),n("sdk.Canvas.Tti").stopTimer.apply(null,arguments)},setUrlHandler:function(t){return n("Assert").isFunction(t,"Invalid argument"),n("sdk.Canvas.Navigation").setUrlHandler.apply(null,arguments)}}),n("sdk.RPC").local.fireEvent=c(r("sdk.Event").fire,"bind",!0,r("sdk.Event")),r("sdk.Event").subscribe("init:post",function(e){n("sdk.Runtime").isEnvironment(n("sdk.Runtime").ENVIRONMENTS.CANVAS)&&(n("Assert").isTrue(!e.hideFlashCallback||!e.hidePluginCallback,"cannot specify deprecated hideFlashCallback and new hidePluginCallback"),n("sdk.Canvas.Plugin")._setHidePluginCallback(e.hidePluginCallback||e.hideFlashCallback))})}function t(){n("sdk.RPC").local.hidePluginObjects=function(){r("Log").info("hidePluginObjects called"),n("sdk.Canvas.Plugin").hidePluginCallback({state:"opened"})},n("sdk.RPC").local.showPluginObjects=function(){r("Log").info("showPluginObjects called"),n("sdk.Canvas.Plugin").hidePluginCallback({state:"closed"})},n("sdk.RPC").local.showFlashObjects=n("sdk.RPC").local.showPluginObjects,n("sdk.RPC").local.hideFlashObjects=n("sdk.RPC").local.hidePluginObjects}function o(){t(),n("FB").provide("Canvas.Plugin",n("sdk.Canvas.Plugin"))}function a(){n("FB").provide("Canvas.Prefetcher",n("sdk.Canvas.Prefetcher")),r("sdk.Event").subscribe("init:post",function(e){n("sdk.Runtime").isEnvironment(n("sdk.Runtime").ENVIRONMENTS.CANVAS)&&n("sdk.Canvas.Prefetcher")._maybeSample()})}function l(){r("sdk.Event").subscribe(r("sdk.Event").SUBSCRIBE,e),r("sdk.Event").subscribe(r("sdk.Event").UNSUBSCRIBE,t),n("sdk.RPC").stub("useFriendsOnline");function e(e,t){e=="canvas.friendsOnlineUpdated"&&t.length===1&&n("sdk.RPC").remote.useFriendsOnline(!0)}function t(e,t){e=="canvas.friendsOnlineUpdated"&&t.length===0&&n("sdk.RPC").remote.useFriendsOnline(!1)}}e={init:e,initCanvasPlugin:o,initCanvasPrefetcher:a,initCanvasPresence:l,initRPC:t},o=e,i.default=o},98),t.__d("sdk.Event-public",["FB","Log","sdk.Event"],function(e,t,n,r,o,a,i){function e(){var e=function(t){return r("Log").error("FB.Event."+t+"() has been deprecated")};n("FB").provide("Event",{subscribe:function(t,n){return r("sdk.Event").subscribe(t,n)},unsubscribe:c(r("sdk.Event").unsubscribe,"bind",!0,r("sdk.Event")),clear:c(e,"bind",!0,null,"clear"),fire:c(e,"bind",!0,null,"fire")})}t={init:e},o=t,i.default=o},98),t.__d("sdk.Frictionless-public",["FB","sdk.Event","sdk.Frictionless"],function(e,t,n,r,o,a,i){"use strict";function e(){r("sdk.Event").subscribe("init:post",function(e){e.frictionlessRequests&&n("sdk.Frictionless").init()}),n("FB").provide("Frictionless",n("sdk.Frictionless"))}t={init:e},o=t,i.default=o},98),t.__d("sdk.GamingServices",["sdk.api","sdk.ui"],function(e,t,n,r,o,a,i){function e(e){n("sdk.ui")({display:"touch",method:"gaming_friendfinder"},e)}function t(e,t,r,o){n("sdk.api")("me/photos","POST",{caption:t,url:e},function(e){if(r===!1||!e||e.error)o!==null&&o(e);else{var t=e.id;n("sdk.ui")({display:"touch",method:"gaming_media_library",media_id:t},function(t){o!==null&&o(e)})}})}r={friendFinder:e,uploadImageToMediaLibrary:t},o=r,i.default=o},98),t.__d("sdk.GamingServices-public",["FB","sdk.GamingServices"],function(e,t,n,r,o,a,i){"use strict";function e(){n("FB").provide("",{gamingservices:n("sdk.GamingServices")})}t={init:e},r=t,i.default=r},98),t.__d("sdk.PluginUtils",["resolveURI","sdk.Event"],function(o,l,n,r,s,u,i){var e={string:function(t){return t},bool:function(t){return t!=null?/^(?:true|1|yes|on)$/i.test(t):void 0},url:function(t){return n("resolveURI")(t)},url_maybe:function(t){return t!=null&&t!==""?n("resolveURI")(t):void 0},hostname:function(t){return t!=null&&t!==""?t:"window.location.hostname"},px:function(t){if(typeof t=="string"){var e=t.match(/^(\d+)(?:px)?$/);return e!=null?parseInt(e[0],10):void 0}else return typeof t=="number"?t:void 0},text:function(t){return t}};function t(e,t){var n;return(n=(n=(n=(n=(n=(n=e[t])!=null?n:e[t.replace(/_/g,"-")])!=null?n:e[t.replace(/_/g,"")])!=null?n:e["data-"+t])!=null?n:e["data-"+t.replace(/_/g,"-")])!=null?n:e["data-"+t.replace(/_/g,"")])!=null?n:void 0}function o(n,r,o,a){Object.keys(n).forEach(function(i){if(n[i]==="text"&&!o[i]){var l;o[i]=(l=(l=r.textContent)!=null?l:r.innerText)!=null?l:void 0,r.setAttribute(i,o[i])}a[i]=e[n[i]](t(o,i))})}function a(e,t,n){t==="100%"?e.style.width="100%":t!=null&&t!==""&&(e.style.width=t+"px"),(n!=null&&n!==""||n===0)&&(e.style.height=n+"px")}function l(e){return function(t){t={width:t.width,height:t.height,pluginID:e},r("sdk.Event").fire("xfbml.resize",t)}}function s(e){return e==="100%"?"100%":e!=null?parseInt(e,10):void 0}function u(e){e!=null&&a(e,0,0)}var c={skin:"string",font:"string",width:"string",height:"px",ref:"string",lazy:"bool",color_scheme:"string"};i.getVal=t,i.validate=o,i.resize=a,i.resizeBubbler=l,i.parse=s,i.collapseIframe=u,i.baseParams=c},98),t.__d("isNumberLike",[],function(e,t,n,r,o,a){function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}a.default=e},66),t.__d("sdk.createIframe",["DOMEventListener","getBlankIframeSrc","guid","isNumberLike"],function(e,t,n,r,o,a,i){function e(e){var t=c("Object","assign",!1,{},e),o,a=t.name||n("guid")(),i=t.root,l=t.style||{border:"none"},s=t.url,u=t.onload,d=t.onerror;o=document.createElement("iframe"),o.name=a,delete t.style,delete t.name,delete t.url,delete t.root,delete t.onload,delete t.onerror,delete t.height,delete t.width,t.frameBorder===void 0&&(t.frameBorder=0),t.allowTransparency===void 0&&(t.allowTransparency=!0),t.allowFullscreen===void 0&&(t.allowFullscreen=!0),t.scrolling===void 0&&(t.scrolling="no"),t.allow===void 0&&(t.allow="encrypted-media"),t.lazy&&(t.loading="lazy",l.visibility&&delete l.visibility),delete t.lazy,e.width!=null&&n("isNumberLike")(e.width)&&(o.width=e.width+"px"),e.height!=null&&n("isNumberLike")(e.height)&&(o.height=e.height+"px"),t.testid&&o.dataset!=null&&(o.dataset.testid=t.testid,delete t.testid);for(a in t)Object.prototype.hasOwnProperty.call(t,a)&&o.setAttribute(a,t[a]);if(c("Object","assign",!1,o.style,l),o.src=n("getBlankIframeSrc")(),i!=null&&i.appendChild(o),u)var m=r("DOMEventListener").add(o,"load",function(){m.remove(),u()});if(d)var p=r("DOMEventListener").add(o,"error",function(){p.remove(),d()});return o.src=s,o}i.default=e},98),t.__d("IframePlugin",["Log","ObservableMixin","QueryString","Type","UrlMap","guid","sdk.Auth.LoginStatus","sdk.AuthUtils","sdk.DOM","sdk.Event","sdk.PlatformVersioning","sdk.PluginUtils","sdk.Runtime","sdk.UA","sdk.URI","sdk.XD","sdk.createIframe"],function(e,t,n,r,o,a,i){var l=n("Type").extend({constructor:function(t,o,a,i){var e=this;this.parent(),a=a.replace(/-/g,"_");var l=r("sdk.PluginUtils").getVal(i,"plugin_id");this.subscribe("xd.resize",r("sdk.PluginUtils").resizeBubbler(l)),this.subscribe("xd.resize.flow",r("sdk.PluginUtils").resizeBubbler(l)),this.subscribe("xd.resize.flow",function(t){c("Object","assign",!1,e._iframeOptions.root.style,{verticalAlign:"bottom",overflow:""}),r("sdk.PluginUtils").resize(e._iframeOptions.root,r("sdk.PluginUtils").parse(t.width),r("sdk.PluginUtils").parse(t.height)),e.updateLift(),window.clearTimeout(e._timeoutID)}),this.subscribe("xd.resize",function(t){c("Object","assign",!1,e._iframeOptions.root.style,{verticalAlign:"bottom",overflow:""}),r("sdk.PluginUtils").resize(e._iframeOptions.root,r("sdk.PluginUtils").parse(t.width),r("sdk.PluginUtils").parse(t.height)),r("sdk.PluginUtils").resize(e._iframe,r("sdk.PluginUtils").parse(t.width),r("sdk.PluginUtils").parse(t.height)),e._isIframeResized=!0,e.updateLift(),window.clearTimeout(e._timeoutID)}),this.subscribe("xd.resize.iframe",function(t){r("sdk.PluginUtils").resize(e._iframe,r("sdk.PluginUtils").parse(t.width),r("sdk.PluginUtils").parse(t.height)),e._isIframeResized=!0,e.updateLift(),window.clearTimeout(e._timeoutID)}),this.subscribe("xd.sdk_event",function(e){var n=c("JSON","parse",!1,e.data);n.pluginID=l,r("sdk.Event").fire(e.event,n,t)});var s=r("UrlMap").resolve("www")+"/plugins/"+a+".php?",u={};r("sdk.PluginUtils").validate(this.getParams(),t,i,u),r("sdk.PluginUtils").validate(r("sdk.PluginUtils").baseParams,t,i,u),c("Object","assign",!1,u,{app_id:n("sdk.Runtime").getClientID(),locale:n("sdk.Runtime").getLocale(),sdk:"joey",kid_directed_site:n("sdk.Runtime").getKidDirectedSite(),channel:r("sdk.XD").handler(function(t){t!=null&&e.inform("xd."+t.type,t)},"parent.parent",!0)}),this.shouldIgnoreWidth()&&(u.width=void 0),u.container_width=t.offsetWidth,r("sdk.DOM").addCss(t,"fb_iframe_widget");var d=n("guid")();this.subscribe("xd.verify",function(e){r("sdk.XD").sendToFacebook(d,{method:"xd/verify",params:c("JSON","stringify",!1,e.token)})}),this.subscribe("xd.refreshLoginStatus",function(){r("sdk.AuthUtils").removeLogoutState(),n("sdk.Auth.LoginStatus").getLoginStatus(c(e.inform,"bind",!0,e,"login.status"),!0)}),i=document.createElement("span"),c("Object","assign",!1,i.style,{verticalAlign:"top",width:u.lazy?"1px":"0px",height:u.lazy?"1px":"0px",overflow:"hidden"}),this._element=t,this._ns=o,this._tag=a,this._params=u,this._config=this.getConfig(),this._iframeOptions={root:i,url:s+n("QueryString").encode(u),name:d,width:this._config.mobile_fullsize&&n("sdk.UA").mobile()?void 0:u.width||1e3,height:u.height||1e3,style:{border:"none",visibility:"hidden"},title:this._ns+":"+this._tag+" Facebook Social Plugin",testid:this._ns+":"+this._tag+" Facebook Social Plugin",onload:function(){return e.inform("render")},onerror:function(){return r("sdk.PluginUtils").collapseIframe(e._iframe)},lazy:u.lazy},this.isFluid()&&u.width!=="auto"&&(r("sdk.DOM").addCss(this._element,"fb_iframe_widget_fluid_desktop"),!u.width&&this._config.full_width&&(this._element.style.width="100%",this._iframeOptions.root.style.width="100%",this._iframeOptions.style.width="100%",this._params.container_width=this._element.offsetWidth,this._iframeOptions.url=s+n("QueryString").encode(this._params)))},shouldIgnoreWidth:function(){return n("sdk.UA").mobile()&&this.getConfig().mobile_fullsize},useInlineHeightForMobile:function(){return!0},process:function(){var e=this;if(n("sdk.Runtime").getIsVersioned()){r("sdk.PlatformVersioning").assertVersionIsSet();var t=new(n("sdk.URI"))(this._iframeOptions.url);this._iframeOptions.url=t.setPath("/"+n("sdk.Runtime").getVersion()+t.getPath()).toString()}t=d.extends({},this._params),delete t.channel;var o=n("QueryString").encode(t);if(this._element.getAttribute("fb-iframe-plugin-query")==o){r("Log").info("Skipping render: %s:%s %s",this._ns,this._tag,o),this.inform("render");return}for(this._element.setAttribute("fb-iframe-plugin-query",o),this.subscribe("render",function(){r("sdk.Event").fire("iframeplugin:onload"),e._iframe.style.visibility="visible",e._isIframeResized||r("sdk.PluginUtils").collapseIframe(e._iframe)});this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._element.appendChild(this._iframeOptions.root);var a=n("sdk.UA").mobile()?120:45;this._timeoutID=window.setTimeout(function(){r("sdk.PluginUtils").collapseIframe(e._iframe),r("Log").warn("%s:%s failed to resize in %ss",e._ns,e._tag,a)},a*1e3),this._iframe=n("sdk.createIframe")(this._iframeOptions),r("sdk.Event").fire("iframeplugin:create"),(n("sdk.UA").mobile()||t.width==="auto")&&(this.useInlineHeightForMobile()&&r("sdk.DOM").addCss(this._element,"fb_iframe_widget_fluid"),this._iframeOptions.width||(c("Object","assign",!1,this._element.style,{display:"block",width:"100%",height:"auto"}),c("Object","assign",!1,this._iframeOptions.root.style,{width:"100%",height:"auto"}),o={height:"auto",position:"static",width:"100%"},(n("sdk.UA").iphone()||n("sdk.UA").ipad())&&c("Object","assign",!1,o,{width:"220px","min-width":"100%"}),c("Object","assign",!1,this._iframe.style,o)))},getConfig:function(){return{}},isFluid:function(){var e=this.getConfig();return e.fluid},updateLift:function(){var e=this._iframe.style.width===this._iframeOptions.root.style.width&&this._iframe.style.height===this._iframeOptions.root.style.height;r("sdk.DOM")[e?"removeCss":"addCss"](this._iframe,"fb_iframe_widget_lift")}},n("ObservableMixin"));l.withParams=function(e,t){return l.extend({getParams:function(){return e},getConfig:function(){return t||{}}})},e=l,i.default=e},98),t.__d("PluginConfig",["sdk.feature"],function(e,t,n,r,o,a,i){e={mobile_fullsize:!0},t={mobile_fullsize:!0},r={mobile_fullsize:!0},o={mobile_fullsize:!0},a={mobile_fullsize:!0},n={fluid:n("sdk.feature")("fluid_embed",!1),mobile_fullsize:!0},e={comment_embed:e,messengerpreconfirmation:t,messengeraccountconfirmation:r,messengerbusinesslink:o,messengertoggle:a,post:n},t=e,i.default=t},98),t.__d("PluginAttrTypes",[],function(e,t,n,r,o,a){"use strict";e="string",t="bool",n="url",a.string=e,a.bool=t,a.url=n},66),t.__d("PluginTags",["PluginAttrTypes"],function(e,t,n,r,o,a,i){var l={ad_library_spend_tracker:{country:r("PluginAttrTypes").string,time_preset:r("PluginAttrTypes").string,custom_start_date:r("PluginAttrTypes").string,custom_end_date:r("PluginAttrTypes").string,race_type:r("PluginAttrTypes").string,state:r("PluginAttrTypes").string,district:r("PluginAttrTypes").string,page_ids:r("PluginAttrTypes").string,include_vps:r("PluginAttrTypes").bool},comment_embed:{href:r("PluginAttrTypes").url,include_parent:r("PluginAttrTypes").bool},composer:{action_type:r("PluginAttrTypes").string,action_properties:r("PluginAttrTypes").string},create_event_button:{},group:{href:r("PluginAttrTypes").url,show_social_context:r("PluginAttrTypes").bool,show_group_info:r("PluginAttrTypes").bool,show_metadata:r("PluginAttrTypes").bool},like:{href:r("PluginAttrTypes").url,layout:r("PluginAttrTypes").string,show_faces:r("PluginAttrTypes").bool,share:r("PluginAttrTypes").bool,action:r("PluginAttrTypes").string,send:r("PluginAttrTypes").bool,size:r("PluginAttrTypes").string},like_box:{href:r("PluginAttrTypes").string,show_faces:r("PluginAttrTypes").bool,header:r("PluginAttrTypes").bool,stream:r("PluginAttrTypes").bool,force_wall:r("PluginAttrTypes").bool,show_border:r("PluginAttrTypes").bool,id:r("PluginAttrTypes").string,connections:r("PluginAttrTypes").string,profile_id:r("PluginAttrTypes").string,name:r("PluginAttrTypes").string},page:{href:r("PluginAttrTypes").string,hide_cta:r("PluginAttrTypes").bool,hide_cover:r("PluginAttrTypes").bool,small_header:r("PluginAttrTypes").bool,adapt_container_width:r("PluginAttrTypes").bool,show_facepile:r("PluginAttrTypes").bool,show_posts:r("PluginAttrTypes").bool,tabs:r("PluginAttrTypes").string},page_events:{href:r("PluginAttrTypes").url},post:{href:r("PluginAttrTypes").url,show_text:r("PluginAttrTypes").bool},profile_pic:{uid:r("PluginAttrTypes").string,linked:r("PluginAttrTypes").bool,href:r("PluginAttrTypes").string,size:r("PluginAttrTypes").string,facebook_logo:r("PluginAttrTypes").bool},send_to_mobile:{max_rows:r("PluginAttrTypes").string,show_faces:r("PluginAttrTypes").bool,size:r("PluginAttrTypes").string}},s={fan:"like_box",likebox:"like_box"};Object.keys(s).forEach(function(e){l[e]=l[s[e]]}),e=l,i.default=e},98),t.__d("runOnce",[],function(e,t,n,r,o,a){function e(e){var t=!1,n;return function(){return t||(t=!0,n=e()),n}}a.default=e},66),t.__d("XFBML",["Assert","Log","runOnce","sdk.Observable"],function(e,t,n,r,o,a,i){var l={},s={},u=0,d=new(r("sdk.Observable")).Observable;function m(e,t){return(e[t]+"").trim()}function p(e){return l[m(e,"nodeName").toLowerCase()]}function _(e){var t=m(e,"className").split(/\s+/).filter(function(e){return Object.prototype.hasOwnProperty.call(s,e)});if(t.length!==0&&(e.getAttribute("fb-xfbml-state")||!e.childNodes||e.childNodes.length===0||e.childNodes.length===1&&e.childNodes[0].nodeType===3||e.children.length===1&&m(e.children[0],"className")==="fb-xfbml-parse-ignore"))return s[t[0]]}function f(e){var t={};return c("Array","from",!1,e.attributes).forEach(function(e){t[m(e,"name")]=m(e,"value")}),t}function g(e,t,o){if(n("Assert").isTrue(e&&e.nodeType&&e.nodeType===1&&!!e.getElementsByTagName,"Invalid DOM node passed to FB.XFBML.parse()"),n("Assert").isFunction(t,"Invalid callback passed to FB.XFBML.parse()"),e!=null){var a=++u;r("Log").info("XFBML Parsing Start %s",a);var i=1,l=0,s=function(){i--,i===0&&(r("Log").info("XFBML Parsing Finish %s, %s tags found",a,l),t!=null&&t(),d.inform("render",[a,l])),n("Assert").isTrue(i>=0,"onrender() has been called too many times")};c("Array","from",!1,e.getElementsByTagName("*")).forEach(function(e){if(!(o!==!0&&e.getAttribute("fb-xfbml-state"))&&e.nodeType===1){var t=p(e)||_(e);if(t!=null){i++,l++;var r=new t.ctor(e,t.xmlns,t.localName,f(e));r.subscribe("render",n("runOnce")(function(){e.setAttribute("fb-xfbml-state","rendered"),s()})),t=function t(){e.getAttribute("fb-xfbml-state")=="parsed"?d.subscribe("render.queue",t):(e.setAttribute("fb-xfbml-state","parsed"),r.process())},t()}}}),d.inform("parse",[a,l]);var m=3e4;window.setTimeout(function(){i>0&&r("Log").warn("%s tags failed to render in %s ms",i,m)},m),s()}}d.subscribe("render",function(){var e=d.getSubscribers("render.queue");d.clearSubscribers("render.queue"),e.forEach(function(e){e([])})}),e={registerTag:function(t){var e=t.xmlns+":"+t.localName;e==="fb:customerchat"&&l[e]!=null||(n("Assert").isUndefined(l[e],e+" already registered"),l[e]=t,s[t.xmlns+"-"+t.localName]=t)},parse:function(t,n){g((t=t)!=null?t:document.body,(t=n)!=null?t:function(){},!0)},parseNew:function(){g(document.body,function(){},!1)},subscribe:d.subscribe,unsubscribe:d.unsubscribe},t=e,i.default=t},98),t.__d("sdk.XFBML.Comments",["IframePlugin","QueryString","UrlMap","sdk.DOM","sdk.Event","sdk.PluginUtils","sdk.Runtime","sdk.UA","sdk.URI"],function(e,t,n,r,o,a,i){var l=320,s=d.extends({numposts:"string",href:"url",permalink:"bool",order_by:"string",mobile:"bool",version:"string",hide_post_profile:"bool",limit:"string",offset:"string",view:"string",fb_comment_id:"string",from_mod_tool:"bool",migrated:"string",xid:"string",title:"string",url:"string",quiet:"string",reverse:"string",simple:"string",css:"string",notify:"string",count:"bool",skin:"string",font:"string",width:"string",height:"px",ref:"string",lazy:"bool",color_scheme:"string"},r("sdk.PluginUtils").baseParams);function u(e,t){if(Object.keys(s).forEach(function(n){var o=r("sdk.DOM").getAttr(e,n);o!==null&&(t[n]=o)}),Object.keys(t).forEach(function(e){c(e,"startsWith",!0,"data-")&&delete t[e]}),n("sdk.UA").mobile()&&t.mobile!==!1&&(t.mobile=!0),t.skin||(t.skin=t.colorscheme),t.href)o=t.fb_comment_id,o||(o=n("QueryString").decode(document.URL.substring(document.URL.indexOf("?")+1)).fb_comment_id,o&&o.indexOf("#")>0&&(o=o.substring(0,o.indexOf("#")))),o&&(t.fb_comment_id=o);else{if(t.title=t.title||document.title,t.url=t.url||document.URL,!t.xid){var o=document.URL.indexOf("#");o>0?t.xid=encodeURIComponent(document.URL.substring(0,o)):t.xid=encodeURIComponent(document.URL)}t.migrated&&(t.href=r("UrlMap").resolve("www")+"/plugins/comments_v1.php?app_id="+n("sdk.Runtime").getClientID()+"&xid="+encodeURIComponent(t.xid)+"&url="+encodeURIComponent(t.url))}return t.version||(t.version=n("sdk.Runtime").getVersion()),t.permalink||(t.width=t.mobile||t.width==="auto"||t.width==="100%"?"":t.width?Math.max(t.width,l):550,t.height=100),t.href!=null&&(o=new(n("sdk.URI"))(t.href),o.getProtocol()||(t.href=o.setProtocol("http").toString())),t}e=n("IframePlugin").extend({constructor:function(t,n,o,a){a=u(t,a),this.parent(t,n,o,a),this.subscribe("xd.sdk_event",function(e){r("sdk.Event").fire(e.event,c("JSON","parse",!1,e.data))})},getConfig:function(){return{fluid:!0,full_width:!0}},getParams:function(){return s}}),t=e,i.default=t},98),t.__d("sdk.XFBML.CommentsCount",["sdk.DOM","sdk.XFBML.Comments","sprintf"],function(e,t,n,r,o,a,i){e=n("sdk.XFBML.Comments").extend({constructor:function(t,o,a,i){r("sdk.DOM").addCss(t,"fb_comments_count_zero"),i.count=1,this.parent(t,o,"comments",i),this.subscribe("xd.comment_count",function(e){e=c("JSON","parse",!1,e.data),r("sdk.DOM").html(t,n("sprintf")('<span class="fb_comments_count">%s</span>',e.count)),e.count>0&&r("sdk.DOM").removeCss(t,"fb_comments_count_zero"),r("sdk.DOM").removeCss(t,"fb_iframe_widget")})}}),t=e,i.default=t},98),t.__d("$InternalEnum",[],function(u,t,n,r,o,a){"use strict";var e=Object.prototype.hasOwnProperty,i=typeof WeakMap=="function"?new WeakMap:new Map;function l(e){var t=i.get(e);if(t!==void 0)return t;var n=new Map;Object.getOwnPropertyNames(e).forEach(function(t){n.set(e[t],t)});try{i.set(e,n)}catch(e){}return n}var s=Object.freeze(Object.defineProperties(Object.create(null),{isValid:{value:function(t){return l(this).has(t)}},cast:{value:function(t){return this.isValid(t)?t:void 0}},members:{value:function(){return l(this).keys()}},getName:{value:function(t){return l(this).get(t)}}}));function u(t){var n=Object.create(s);for(var r in t)e.call(t,r)&&Object.defineProperty(n,r,{value:t[r]});return Object.freeze(n)}var c=Object.freeze(Object.defineProperties(Object.create(null),{isValid:{value:function(n){return typeof n=="string"?e.call(this,n):!1}},cast:{value:s.cast},members:{value:function(){return Object.getOwnPropertyNames(this).values()}},getName:{value:function(t){return t}}}));u.Mirrored=function(e){for(var t=Object.create(c),n=0,r=e.length;n<r;++n)Object.defineProperty(t,e[n],{value:e[n]});return Object.freeze(t)},Object.freeze(u.Mirrored),o.exports=Object.freeze(u)},null),t.__d("ChatPluginEntryPointIconEnum",["$InternalEnum"],function(e,t,n,r,o,a){e=t("$InternalEnum")({MESSENGER_ICON:"messenger_icon",CHAT_ROUND_ICON:"chat_round_icon",CHAT_ANGULAR_ICON:"chat_angular_icon",NONE:"none"}),n=e,a.default=n},66),t.__d("ChatPluginEntryPointLabelEnum",["$InternalEnum"],function(e,t,n,r,o,a){e=t("$InternalEnum")({NONE:"none",CHAT:"chat",HELP:"help",ASK_US:"ask_us"}),n=e,a.default=n},66),t.__d("ChatPluginEntryPointSizeEnum",[],function(e,t,n,r,o,a){e=Object.freeze({STANDARD:"standard",COMPACT:"compact"}),a.default=e},66),t.__d("performanceAbsoluteNow",["performance"],function(l,t,n,r,o,a,i){var e=function(){return Date.now()};function l(t){e=t}if(n("performance").now&&n("performance").timing&&n("performance").timing.navigationStart){var s=n("performance").timing.navigationStart;t=function(){return n("performance").now()+s}}else t=function(){return e()};t.setFallback=l,r=t,i.default=r},98),t.__d("ChatPluginSDKPreLoggingUtils",["CORSRequest","UrlMap","performanceAbsoluteNow"],function(e,t,n,r,o,a,i){"use strict";function e(e,t,o,a){var i;a===void 0&&(a=!0);var l=n("performanceAbsoluteNow")();e=e?r("UrlMap").resolve("social_plugin")+"/customer_chat/SDK/":r("UrlMap").resolve("www")+"/plugins/customer_chat/SDK/",i=(i=o.request_time)!=null?i:void 0;var s=0;typeof i=="number"&&a&&(s=l-i),o.request_time=l,n("CORSRequest").execute(e,"get",d.extends({},o,{event_name:t,loading_time:s}),function(){return null})}i.preLogging=e},98),t.__d("LiveChatPluginConstants",["$InternalEnum"],function(e,t,n,r,o,a){"use strict";e="LiveChatEvent/",n="mqtt",r=t("$InternalEnum")({CONNECTED:"Connected",CONNECTING:"Connecting",DISCONNECTED:"Disconnected"}),o=250,t=e+"close_timestamps";var i=e+"reset_badging",l=e+"state",s=e+"switch_account",u=e+"typing",c=e+"unread_count",d=e+"update_message_list",m="platform/plugins/connect/guest",p=e+"guest_upgrade_success",_=e+"guest_upgrade_success_incognito",f=e+"navigate_to_welcome_page",g="platform/plugins/connect/access_token";e=e+"start_re_engagement";var h=124,y=187,C=24,b=424,v=288,S=313,R=219,L=40,E=36,k=24,I=18,T=708,D=540,x=244,$=202,P=509,N=430,M=6,w=0,A=1,F=-1,O="messaging_plugin",B=8634e4,W="#8A8D91",q="entrypoint:customer_chat_plugin",U=0,V=1,H=2,G=3,z="new_message_update",j="initial_fetch",K=5e3,Q="https://www.facebook.com/business/help/1661027437357021";a.MQTT=n,a.MQTTGatewayConnectionState=r,a.LOGIN_CHECK_INTERVAL=o,a.CLOSE_TIMESTAMPS=t,a.RESET_BADGING=i,a.STATE_UPDATE=l,a.SWITCH_ACCOUNT=s,a.TYPING_UPDATE=u,a.UNREAD_COUNT_UPDATE=c,a.UPDATE_MESSAGE_LIST=d,a.GUEST_MODE_CONNECT=m,a.GUEST_UPGRADE_SUCCESS=p,a.GUEST_UPGRADE_SUCCESS_INCOGNITO=_,a.NAVIGATE_TO_WELCOME_PAGE=f,a.ACCESS_TOKEN_LOGIN=g,a.START_RE_ENGAGEMENT=e,a.PROMPT_FALLBACK_HEIGHT=h,a.PROMPT_REDESIGN_FALLBACK_HEIGHT=y,a.PROMPT_CONTAINER_PADDING_HEIGHT=C,a.WELCOME_PAGE_GUEST_FALLBACK_HEIGHT=b,a.WELCOME_PAGE_NO_GUEST_FALLBACK_HEIGHT=v,a.WELCOME_PAGE_GUEST_FALLBACK_HEIGHT_WITH_COMPACT=S,a.WELCOME_PAGE_NO_GUEST_FALLBACK_HEIGHT_WITH_COMPACT=R,a.WELCOME_PAGE_ATTRIBUTION_OFFEST_HEIGHT=L,a.WELCOME_PAGE_ATTRIBUTION_OFFSET_HEIGHT_WITH_COMPACT=E,a.MAIN_IFRAME_PADDING_HEIGHT=k,a.MAIN_IFRAME_PADDING_HEIGHT_WITH_COMPACT=I,a.THREAD_PAGE_HEIGHT=T,a.THREAD_PAGE_HEIGHT_COMPACT=D,a.RE_ENGAGEMENT_COLLAPSED_DIALOG_HEIGHT=x,a.RE_ENGAGEMENT_COLLAPSED_DIALOG_HEIGHT_COMPACT=$,a.RE_ENGAGEMENT_EXPANDED_DIALOG_HEIGHT=P,a.RE_ENGAGEMENT_EXPANDED_DIALOG_HEIGHT_COMPACT=N,a.GREETING_TEXT_BOTTOM_SPACING_OFFEST=M,a.LOGGED_IN_CHAT_MODE=w,a.GUEST_CHAT_MODE=A,a.INVALID_CHAT_MODE=F,a.MESSENGING_PLUGIN=O,a.GUEST_SESSION_STORAGE_VALIDITY_MS=B,a.GUEST_SEND_BUTTON_COLOR_EMPTY_INPUT=W,a.LIVE_CHAT_ENTRYPOINT_ATTRIBUTION_TAG=q,a.ITP_CONSISTENCY_UNKNOWN_LOGGED_OUT=U,a.ITP_CONSISTENCY_CONSISTENT_LOGGED_IN=V,a.ITP_CONSISTENCY_INCONSISTENT=H,a.ITP_CONSISTENCY_CONSISTENT_NO_ITP=G,a.NEW_MESSAGE_UPDATE=z,a.INITIAL_FETCH=j,a.PLUGIN_FADE_DELAY=K,a.HELP_DEX_LINK=Q},66),t.__d("ChatPluginStyleUtils",["LiveChatPluginConstants"],function(E,k,T,r,D,x,i){var e=44,t=36,n=17,o=15,a=22,l=20,s=6,u=4,m=16,p=14,_=60,f=44,g=70,h=86,y=63,C=76,b=99,v=114,S=85,R=98,L=12;function E(){var e=screen.width;return e="width: "+e+"px;","padding: 0; position: fixed; z-index: 2147483646;box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.15);border-radius: 16px;bottom: 24px; top: auto; right:0;"+e}function k(e){e instanceof HTMLElement&&(e.style.marginTop=window.innerHeight-e.clientHeight+"px")}function I(e,t,n,r,o,a,i){return t=G(t,r,o),r=z(a,i),o=j(e,n),a=d.extends({},t,r,o),Object.fromEntries(c("Object","entries",!1,a).sort())}function T(e,t,n,r,o,a,i){return e=I(e,t,n,r,o,a,i),c("JSON","stringify",!1,e)}function D(n,r,o,a,i){switch(o=o+(n=="right"?-2:43),r+_-16,r=r-16,a==="none"?i==="compact"?r+=f:r+=_:i==="compact"?r+=t:r+=e,a={bottom:r.toString()+"px",position:"fixed",width:"20px",height:"24px",zIndex:2147483645,borderRadius:"4pt",background:"none"},i={},n){case"right":i=d.extends({},a,{right:o+"px"});break;case"left":i=d.extends({},a,{left:o+"px"});break}return r=Object.fromEntries(c("Object","entries",!1,i).sort()),c("JSON","stringify",!1,r)}function x(e,t,n,r,o,a,i,l){var s=n;switch(t=t-2.5,e==="left"&&(s=n-15,r==="none"?a==="compact"?s+=f:s+=_:o==="none"?r==="ask_us"?a==="compact"?s+=C:s+=h:a==="compact"?s+=y:s+=g:r==="ask_us"?a==="compact"?s+=R:s+=v:a==="compact"?s+=S:s+=b),n={bottom:t.toString()+"px",position:"fixed",zIndex:2147483646,height:"15px",width:"15px",borderRadius:"50%"},o={},e){case"right":o=d.extends({},n,{right:s+"px"});break;case"left":o=d.extends({},n,{left:s+"px"});break}return i===!1&&(o=d.extends({},o,{animation:l===!0?"slideInFromBottomDelay 3.5s ease-out":null,backgroundColor:"#31CC46",border:"2.5px solid white",height:"10px",width:"10px"})),Object.fromEntries(c("Object","entries",!1,o).sort())}function $(e){var t="padding: 0; position: fixed; z-index: 2147483646;box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.15);border-radius: 16px;bottom: 24px; top: auto; right:0; margin: 0 12px; width: calc(100% - 24px);";return e=e===!0?" height: 60px;":" height: 0px;",t+=e,t}function P(n,r,o,a,i,l,s){o=o-L,i==="none"?l==="compact"?i=f:i=_:l==="compact"?i=t:i=e,l=i+r,i=" bottom: "+l.toString()+"px;",r="padding: 0; position: fixed; z-index: 2147483646; border-radius: 16px; top: auto; background: none; minHeight: 300px;";var u=" width: 399px;",c=" width: 324px;";switch(r=r+(s==="compact"?c:u)+i,a?r+=" max-height: calc(100% - "+l.toString()+"px);":r+=" max-height: 0;",n){case"right":r+=" right: "+(o+4)+"px;";break;case"left":r+=" left: "+(o-4)+"px;";break}return r}function N(e){var t="position: fixed; z-index: 2147483646; box-shadow: none; border-radius: 0; top: 0px; right: 0px; width: 100%;";return e=e===!0?" height: 100%; max-height: 100%;":" max-height: 0px;",t+=e,t}function M(e,t,n,o,a){return t=w(t,n,o),e||(n=a?r("LiveChatPluginConstants").RE_ENGAGEMENT_COLLAPSED_DIALOG_HEIGHT_COMPACT:r("LiveChatPluginConstants").RE_ENGAGEMENT_COLLAPSED_DIALOG_HEIGHT,o=a?r("LiveChatPluginConstants").MAIN_IFRAME_PADDING_HEIGHT_WITH_COMPACT:r("LiveChatPluginConstants").MAIN_IFRAME_PADDING_HEIGHT,e=n+o,t+=e-r("LiveChatPluginConstants").GREETING_TEXT_BOTTOM_SPACING_OFFEST),t}function w(n,r,o){var a=L;return r==="none"?o==="compact"?a+=f:a+=_:o==="compact"?a+=t:a+=e,a+n}function A(e,t,n,r,o){switch(n=n-L,t=w(t,r,o),r={padding:0,position:"fixed",zIndex:2147483646,borderRadius:"16px",top:"auto",width:"247px",maxHeight:"calc(100% - 80px)",background:"none",height:"72px"},o=d.extends({},r,{bottom:t+"px"}),e){case"right":o=d.extends({},o,{right:"6px",marginRight:n+"px"});break;case"left":o=d.extends({},o,{left:"2px",marginLeft:n+"px"});break}return o=d.extends({},o,{animation:"slideInFromBottomDelay 3s ease-out"}),r=Object.fromEntries(c("Object","entries",!1,o).sort()),c("JSON","stringify",!1,r)}function F(e,t,n,r,o,a){switch(n=n-L,t=w(t,o,a),o=" bottom: "+t.toString()+"px;",a="padding: 0; position: fixed; z-index: 2147483646;border-radius: 16px; top: auto; width: 247px; max-height: calc(100% - 80px); background: none;"+o,t=a,e){case"right":t+=" right: 6px; margin-right: "+n+"px;";break;case"left":t+=" left: 2px; margin-left: "+n+"px;";break}return t+=r?" animation: slideInFromBottomDelay 6s ease-out;":" animation: slideInFromBottomDelay 3s ease-out;",t}function O(n,r,o,a,i,l){a=l==="compact"?f:_;var s="position: fixed; z-index: 2147483646; box-shadow: none; border-radius: 18px 0px 18px 18px; right: 0px; width: calc(80% - 40px); bottom: 24px;";if(n!=null&&typeof o=="number"){s+=" height: "+n+"px;";var u=o;n<a&&(u=o+12),s+=" bottom: "+u+"px;"}else s+=" height: 60px;";if(s+=r==="left"?" left: calc(84px + 5%);":" left: 5%;",i!=="none"&&typeof o=="number")switch(n=l==="compact"?t:e,a=o+n+12,s+=" bottom: "+a+"px;",r){case"right":s+=" right: 20px; left: auto;";break;case"left":s+=" left: 20px; right: auto;";break}return s}function B(n,r,o,a,i){if(o="position: fixed; z-index: 2147483646; box-shadow: none; border-radius: 18px 0px 18px 18px;width: 306px;bottom: 24px; right: 20px;",typeof r=="number"&&(i=i==="compact"?t:e,r=r+i+12,o+=" bottom: "+r+"px;"),typeof a=="number")switch(i=a-L,n){case"right":o+=" right: "+(i+4)+"px; left:auto";break;case"left":o+=" left: "+(i-4)+"px; right:auto";break}return o}function W(e,t){var n={alignItems:"flex-start",background:"#FFFFFF",borderRadius:"18px",bottom:0,boxShadow:"0 4px 12px 0 rgba(0, 0, 0, 0.15)",display:"flex",flexDirection:"row",position:"absolute"},r=d.extends({},n,{marginLeft:"12px",padding:"8px 0px 8px 8px",width:"90%"});return n=d.extends({},n,{padding:"8px 0px 8px 12px",width:"93%"}),e=e?r:n,t==="desktop"&&(e=d.extends({},e,{cursor:"pointer"})),Object.fromEntries(c("Object","entries",!1,e).sort())}function q(e,t){var n={display:"inline-block",fontSize:"17px",lineHeight:"22px",textAlign:"left",width:"90%",wordWrap:"break-word"},r=d.extends({},n,{paddingRight:"18px"});return t==="mobile"&&(r=d.extends({},r,{paddingLeft:"12px"})),t=d.extends({},n,{paddingRight:"12px",paddingLeft:"12px"}),n=e?t:r,Object.fromEntries(c("Object","entries",!1,n).sort())}function U(e,t){var n={position:"absolute",top:"-2px",width:"38px"};return t==="desktop"&&(n=d.extends({},n,{cursor:"pointer"})),t=d.extends({},n,{left:"-4px"}),n=d.extends({},n,{right:"-4px"}),e=e?t:n,Object.fromEntries(c("Object","entries",!1,e).sort())}function V(e){return e={visibility:e?"hidden":"visible"},Object.fromEntries(c("Object","entries",!1,e).sort())}function H(){var e={outline:"none"};return Object.fromEntries(c("Object","entries",!1,e).sort())}function G(e,t,n){return{animation:K(t,n),background:"none",bottom:e.toString()+"px",display:"block",margin:"0 12px 0 12px",overflow:"visible",padding:"0",position:"fixed",top:"auto",zIndex:2147483644}}function z(n,r){return n!=="none"?(n=r==="compact"?t:e,{borderRadius:"60px",boxShadow:null,height:n+"px",width:"auto"}):(n=r==="compact"?f:_,{borderRadius:"60px",boxShadow:"0 4px 12px 0 rgba(0, 0, 0, 0.15)",height:n+"px",width:n+"px"})}function j(e,t){switch(t=t-L,e){case"right":return{right:t+"px"};case"left":return{left:t+"px"}}}function K(e,t){return e?null:t?"slideInFromBottomDelay 3s ease-out":"slideInFromBottom 0.3s ease-out"}i.LABELED_ENTRY_POINT_STANDARD_HEIGHT=e,i.LABELED_ENTRY_POINT_COMPACT_HEIGHT=t,i.LABELED_ENTRY_POINT_STANDARD_FONT_SIZE=n,i.LABELED_ENTRY_POINT_COMPACT_FONT_SIZE=o,i.LABELED_ENTRY_POINT_STANDARD_LINE_HEIGHT=a,i.LABELED_ENTRY_POINT_COMPACT_LINE_HEIGHT=l,i.LABELED_ENTRY_POINT_STANDARD_ICON_MARGIN_RIGHT=s,i.LABELED_ENTRY_POINT_COMPACT_ICON_MARGIN_RIGHT=u,i.LABELED_ENTRY_POINT_STANDARD_PADDING_HORIZONTAL=m,i.LABELED_ENTRY_POINT_COMPACT_PADDING_HORIZONTAL=p,i.ICON_ENTRY_POINT_STANDARD_HEIGHT=_,i.ICON_ENTRY_POINT_COMPACT_HEIGHT=f,i.LABELED_ONLY_ENTRY_POINT_STANDARD_WIDTH_SHORT=g,i.LABELED_ONLY_ENTRY_POINT_STANDARD_WIDTH_LONG=h,i.LABELED_ONLY_ENTRY_POINT_COMPACT_WIDTH_SHORT=y,i.LABELED_ONLY_ENTRY_POINT_COMPACT_WIDTH_LONG=C,i.LABELED_WITH_ICON_ENTRY_POINT_STANDARD_WIDTH_SHORT=b,i.LABELED_WITH_ICON_ENTRY_POINT_STANDARD_WIDTH_LONG=v,i.LABELED_WITH_ICON_ENTRY_POINT_COMPACT_WIDTH_SHORT=S,i.LABELED_WITH_ICON_ENTRY_POINT_COMPACT_WIDTH_LONG=R,i.getMobileStyleText=E,i.positionElementAtWindowFooter=k,i.getEntryPointStyle=I,i.getIconStyleText=T,i.getUnreadCountStyleText=D,i.getAvailabilityStatusStyleText=x,i.getMobileLandingStyleText=$,i.getDesktopStyleText=P,i.getMobileFullScreenStyleText=N,i.getDesktopGreetingBottomSpacingWithReEngagementDialog=M,i.getDesktopGreetingBottomSpacing=w,i.getDesktopGreetingStyleText=A,i.getDesktopWelcomeMessageStyleText=F,i.getMobileWelcomeMessageStyleText=O,i.getMobileReengagementCollapsedDialogStyleText=B,i.getWelcomeMessageBubbleStyle=W,i.getWelcomeMessageTextStyle=q,i.getMinusButtonStyle=U,i.getMinusButtonVisibility=V,i.getNoOutlineFocus=H},98),t.__d("DOMPlugin",["JSSDKShadowCssConfig","Log","QueryString","sdk.DOM","sdk.Observable","sdk.PluginUtils","sdk.Runtime","sdk.XD","sdk.feature"],function(e,t,n,r,o,a,i){e=(function(e){d.inheritsLoose(o,e);var t=o.prototype;t.render=function(e){};function o(t,o,a,i,l,s){var u;return u=e.call(this)||this,u.shadowCss=[],u.element=t,u.tag=a.replace(/-/g,"_"),u.ns=o,u.config=(a=s)!=null?a:{},u.params={},r("sdk.PluginUtils").validate(l,t,i,u.params),r("sdk.PluginUtils").validate(r("sdk.PluginUtils").baseParams,t,i,u.params),c("Object","assign",!1,u.params,{app_id:n("sdk.Runtime").getClientID(),locale:n("sdk.Runtime").getLocale(),sdk:"joey",kid_directed_site:n("sdk.Runtime").getKidDirectedSite(),channel:r("sdk.XD").handler(function(e){e!=null&&u.inform("xd."+e.type,e)},"parent.parent",!0)}),u}return t.process=function(){var e=d.extends({},this.params);if(delete e.channel,e=n("QueryString").encode(e),this.element.getAttribute("fb-iframe-plugin-query")===e){r("Log").info("Skipping render: %s:%s %s",this.ns,this.tag,e),this.inform("render");return}this.element.setAttribute("fb-iframe-plugin-query",e),l(this.element,c(this.render,"bind",!0,this),this.shadowCss),this.inform("render")},o})(r("sdk.Observable").Observable);function l(e,t,o){for(o===void 0&&(o=[]);e.firstChild;)e.removeChild(e.firstChild);if(typeof e.attachShadow=="function"){var a=document.createElement("div");e.appendChild(a);var i=a.attachShadow({mode:n("sdk.feature")("shadow_dom_plugin_mode","closed")});o.forEach(function(e){return r("sdk.DOM").addCssRules(n("JSSDKShadowCssConfig")[e],[e],i)}),i.appendChild(t(i))}else o.forEach(function(e){return r("sdk.DOM").addCssRules(n("JSSDKShadowCssConfig")[e],[e])}),e.appendChild(t(document))}i.DOMPlugin=e,i.maybeCreateShadowRootAndRenderInDOM=l},98),t.__d("getJSEnumSafe",[],function(e,t,n,r,o,a){"use strict";function e(e,t){return t==null||!Object.prototype.hasOwnProperty.call(e,t)?null:(t=t,e[t])}a.default=e},66),t.__d("nativeRequestAnimationFrame",[],function(e,t,n,r,o,a){t=e.__fbNativeRequestAnimationFrame||e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame,n=t,a.default=n},66),t.__d("requestAnimationFramePolyfill",["nativeRequestAnimationFrame","performanceNow"],function(e,t,n,r,o,a,i){var l=0;t=n("nativeRequestAnimationFrame")||function(t){var r=n("performanceNow")(),o=Math.max(0,16-(r-l));return l=r+o,e.setTimeout(function(){t(n("performanceNow")())},o)},r=t,i.default=r},98),t.__d("IdleCallbackImplementation",["performanceNow","requestAnimationFramePolyfill"],function(e,f,n,r,o,a,i){var t=[],l=0,s=0,u=-1,c=!1,d=1e3/60,m=2;function p(e){return e}function _(e){return e}function f(n,r){var o=s++;if(t[o]=n,h(),r!=null&&r.timeout>0){var a=o;e.setTimeout(function(){return R(a)},r.timeout)}return o}function g(e){e=e,t[e]=null}function h(){c||(c=!0,n("requestAnimationFramePolyfill")(function(e){c=!1,C(n("performanceNow")()-e)}))}function y(e){var t=d-m;return e<t?t-e:(e=e%d,e>t||e<m?0:t-e)}function C(e){var t=n("performanceNow")();t>u&&(e=y(e),e>0&&(t=t+e,S(t),u=t)),b()&&h()}function b(){return l<t.length}function v(){for(;b();){var e=t[l];if(l++,e)return e}return null}function S(e){for(var t;n("performanceNow")()<e&&(t=v());)t(new L(e))}function R(e){var n=e;n=t[n],n&&(g(e),n(new L(null)))}var L=(function(){function e(e){this.didTimeout=e==null,this.$1=e}var t=e.prototype;return t.timeRemaining=function(){var e=this.$1;if(e!=null){var t=n("performanceNow")();if(t<e)return e-t}return 0},e})();i.requestIdleCallback=f,i.cancelIdleCallback=g},98),t.__d("sdk.IdleCallback",["IdleCallbackImplementation","sdk.feature"],function(e,t,n,r,o,a,i){"use strict";e=(function(){function e(e,t,r){r===void 0&&(r=n("sdk.feature")("idle_callback_wait_time_ms",2e3)),this.$1=r,this.$3=t,this.$2=e}var t=e.prototype;return t.start=function(){var e=this;if(this.$1===0||isNaN(this.$1)||this.$2===0||isNaN(this.$2))return this.$3(),null;var t=Date.now(),n=this.isBrowserCompatible()?window.requestIdleCallback:r("IdleCallbackImplementation").requestIdleCallback,o=0,a=0,i=function r(i){if(o>e.$1){e.$3();return}var l=Date.now();if(l-t>e.$2){e.$3();return}l=i.timeRemaining(),o+=l>=49&&a>=49?l:0,a=l,n(r)};return n(i)},t.isBrowserCompatible=function(){return typeof window=="undefined"?!1:typeof window.requestIdleCallback=="function"},e})(),i.default=e},98),t.__d("uuid",[],function(t,n,r,o,a,i){"use strict";function t(){var t;return t=(t=e)==null||(t=t.crypto)==null?void 0:t.randomUUID,typeof t=="function"?e.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0;return e=e==="x"?t:t&3|8,e.toString(16)})}i.default=t},66),t.__d("sdk.XFBML.ChatDOM",["$InternalEnum","CORSRequest","ChatPluginEntryPointIconEnum","ChatPluginEntryPointLabelEnum","ChatPluginEntryPointSizeEnum","ChatPluginSDKPreLoggingUtils","ChatPluginStyleUtils","DOMPlugin","Log","UrlMap","getJSEnumSafe","performanceAbsoluteNow","sdk.Content","sdk.DOM","sdk.IdleCallback","sdk.XFBML.CustomerChatNew","sdk.fbt","sdk.feature","uuid"],function(e,t,n,r,o,a,i){"use strict";var l=t("$InternalEnum").Mirrored(["WAITING","LOADING","LOADED"]);e=(function(e){d.inheritsLoose(t,e);function t(t,o,a,i){var s;s=e.call(this,t,o,a,i,{allow_guests:"bool",attribution:"string",greeting_dialog_display:"string",greeting_dialog_delay:"string",logged_in_greeting:"string",logged_out_greeting:"string",minimized:"bool",page_id:"string",theme_color:"string",override:"string",attribution_version:"string",is_loaded_by_facade:"bool"})||this,o=n("performanceAbsoluteNow")(),a=n("uuid")();var u=window.location.href;return c("Object","assign",!1,s.params,{current_url:u,log_id:a,request_time:o,is_loaded_by_facade:!0,should_use_new_domain:i.should_use_new_domain}),r("ChatPluginSDKPreLoggingUtils").preLogging(!!i.should_use_new_domain,"chat_plugin_sdk_facade_create",s.params,!1),r("sdk.DOM").remove(t),r("sdk.Content").append(t),s.$ChatDOMFacade3=document.createElement("div"),s.$ChatDOMFacade1=l.WAITING,s.$ChatDOMFacade2=!1,s.$ChatDOMFacade6=!1,s.$ChatDOMFacade8="standard",s.$ChatDOMFacade9="none",s.$ChatDOMFacade10="none",s.$ChatDOMFacade11="left",s.$ChatDOMFacade12=0,s.$ChatDOMFacade13=0,s.$ChatDOMFacade14=!1,s.$ChatDOMFacade15=!!i.should_use_new_domain,s.shadowCss=["css:fb.shadow.css.chatdom"],s.$ChatDOMFacade4=n("performanceAbsoluteNow")(),r("Log").info("facadeperf: Started browser idle loader."),s.$ChatDOMFacade5=new(n("sdk.IdleCallback"))(n("sdk.feature")("chat_plugin_facade_timeout_ms",8e3),function(){var e=n("performanceAbsoluteNow")();r("Log").info("facadeperf: Idle callback starts full load in %sms.",e-s.$ChatDOMFacade4),s.$ChatDOMFacade16(!1,!1)}).start(),s}var o=t.prototype;return o.render=function(e){var t=this;return this.$ChatDOMFacade3.classList.add("container"),e=this.$ChatDOMFacade15?r("UrlMap").resolve("social_plugin")+"/customer_chat/facade/":r("UrlMap").resolve("www")+"/plugins/customer_chat/facade/",n("CORSRequest").execute(e,"get",this.params,function(e){var o,a=n("performanceAbsoluteNow")();r("Log").info("facadeperf: CORS request completed in %sms.",a-t.$ChatDOMFacade4),!e.error&&(t.$ChatDOMFacade11=e.alignment,t.$ChatDOMFacade12=e.bottom_spacing,t.$ChatDOMFacade13=e.side_spacing,a=e.theme_color,t.$ChatDOMFacade8=(o=n("getJSEnumSafe")(n("ChatPluginEntryPointSizeEnum"),(o=e.entry_point_size)==null?void 0:o.toUpperCase()))!=null?o:"standard",t.$ChatDOMFacade9=(o=n("ChatPluginEntryPointLabelEnum").cast(e.entry_point_label))!=null?o:"none",t.$ChatDOMFacade10=(o=n("ChatPluginEntryPointIconEnum").cast(e.entry_point_icon_enum))!=null?o:"none",t.$ChatDOMFacade14=e.away_hours_enabled&&!e.is_page_away,t.$ChatDOMFacade9==="none"?(o=document.createElement("div"),r("sdk.DOM").html(o,e.entry_point_icon_svg),o=o==null?void 0:o.outerHTML,r("sdk.DOM").html(t.$ChatDOMFacade3,o)):(o=e.entry_point_icon_svg,r("sdk.DOM").html(t.$ChatDOMFacade3,t.$ChatDOMFacade17(o))),o=r("ChatPluginStyleUtils").getEntryPointStyle(e.alignment,e.bottom_spacing,e.side_spacing,!1,!0,e.entry_point_label,t.$ChatDOMFacade8),c("Object","assign",!1,t.$ChatDOMFacade3.style,o),t.$ChatDOMFacade3.style.backgroundColor=a,t.$ChatDOMFacade14&&(o=r("ChatPluginStyleUtils").getAvailabilityStatusStyleText(e.alignment,e.bottom_spacing,e.side_spacing,e.entry_point_label,e.entry_point_icon_enum,t.$ChatDOMFacade8,!1,!0),a=document.createElement("div"),c("Object","assign",!1,a.style,o),t.$ChatDOMFacade3.append(a)),r("ChatPluginSDKPreLoggingUtils").preLogging(t.$ChatDOMFacade15,"chat_plugin_sdk_facade_load",t.params))}),this.$ChatDOMFacade3.addEventListener("click",function(e){t.$ChatDOMFacade16(!0,!0)}),this.$ChatDOMFacade3},o.$ChatDOMFacade18=function(e){switch(e){case"chat":return n("sdk.fbt")._("Chat");case"help":return n("sdk.fbt")._("Help");case"ask_us":return n("sdk.fbt")._("Ask us");case"none":return""}},o.$ChatDOMFacade19=function(){var e;(e=this.element.parentNode)==null||e.removeChild(this.element)},o.$ChatDOMFacade20=function(){if(!(this.$ChatDOMFacade2||this.$ChatDOMFacade1===l.LOADED)){if(this.$ChatDOMFacade9==="none"){var e=this.$ChatDOMFacade8==="compact"?24:36;e=this.$ChatDOMFacade21(e),r("sdk.DOM").html(this.$ChatDOMFacade3,'\n          <div class="centered-container">\n            '+e+"\n          </div>\n        ")}else if(e=this.$ChatDOMFacade8==="compact"?20:24,e=this.$ChatDOMFacade21(e),this.$ChatDOMFacade10==="none"){var t=this.$ChatDOMFacade8==="compact"?r("ChatPluginStyleUtils").LABELED_ENTRY_POINT_COMPACT_ICON_MARGIN_RIGHT:r("ChatPluginStyleUtils").LABELED_ENTRY_POINT_STANDARD_ICON_MARGIN_RIGHT;if(r("sdk.DOM").html(this.$ChatDOMFacade3.children[0],this.$ChatDOMFacade22(t,e)+this.$ChatDOMFacade3.children[0].innerHTML),this.$ChatDOMFacade14){t=r("ChatPluginStyleUtils").getAvailabilityStatusStyleText(this.$ChatDOMFacade11,this.$ChatDOMFacade12,this.$ChatDOMFacade13,this.$ChatDOMFacade9,"chat_round_icon",this.$ChatDOMFacade8,!1,!1);var n=document.createElement("div");c("Object","assign",!1,n.style,t),r("sdk.DOM").remove(this.$ChatDOMFacade3.children[1]),this.$ChatDOMFacade3.append(n)}}else r("sdk.DOM").html(this.$ChatDOMFacade3.children[0].children[0],e);this.$ChatDOMFacade2=!0}},o.$ChatDOMFacade17=function(e){var t=this.$ChatDOMFacade8==="compact"?r("ChatPluginStyleUtils").LABELED_ENTRY_POINT_COMPACT_HEIGHT:r("ChatPluginStyleUtils").LABELED_ENTRY_POINT_STANDARD_HEIGHT,n=this.$ChatDOMFacade8==="compact"?r("ChatPluginStyleUtils").LABELED_ENTRY_POINT_COMPACT_FONT_SIZE:r("ChatPluginStyleUtils").LABELED_ENTRY_POINT_STANDARD_FONT_SIZE,o=this.$ChatDOMFacade8==="compact"?r("ChatPluginStyleUtils").LABELED_ENTRY_POINT_COMPACT_LINE_HEIGHT:r("ChatPluginStyleUtils").LABELED_ENTRY_POINT_STANDARD_LINE_HEIGHT,a=this.$ChatDOMFacade8==="compact"?r("ChatPluginStyleUtils").LABELED_ENTRY_POINT_COMPACT_ICON_MARGIN_RIGHT:r("ChatPluginStyleUtils").LABELED_ENTRY_POINT_STANDARD_ICON_MARGIN_RIGHT,i=this.$ChatDOMFacade8==="compact"?r("ChatPluginStyleUtils").LABELED_ENTRY_POINT_COMPACT_PADDING_HORIZONTAL:r("ChatPluginStyleUtils").LABELED_ENTRY_POINT_STANDARD_PADDING_HORIZONTAL;return'\n      <div class="label-container" style="\n        height: '+t+"px;\n        padding: 0 "+i+'px\n      ">\n        '+(e&&'\n            <div class="label-container-icon" style="\n              margin-right: '+a+'px;\n            ">\n              '+e+"\n            </div>\n          ")+'\n        <div\n          class="label-container-label"\n          style="\n            font-size: '+n+"px;\n            line-height: "+o+'px;\n        ">'+this.$ChatDOMFacade18(this.$ChatDOMFacade9).toString()+"</div>\n      </div>\n    "},o.$ChatDOMFacade22=function(e,t){return'\n      <div class="label-container-icon" style="\n        margin-right: '+e+'px;\n      ">\n        '+t+"\n      </div>\n    "},o.$ChatDOMFacade21=function(e){return'\n      <svg class="spinning" x="0" y="0" width="'+e+'" height="'+e+'" viewbox="0 0 60 60">\n        <circle class="path" cx="30" cy="30" r="24" fill="none" stroke-width="6"></circle>\n      </svg>\n    '},o.$ChatDOMFacade23=function(e){if(e&&this.$ChatDOMFacade7&&!this.$ChatDOMFacade6){this.$ChatDOMFacade6=!0;var t=this.$ChatDOMFacade7;t.subscribe("iframes_loaded",function(e){t.showDialog()})}},o.$ChatDOMFacade16=function(e,t){var o=this;t&&this.$ChatDOMFacade20(),this.$ChatDOMFacade23(e),this.$ChatDOMFacade1===l.WAITING&&(this.$ChatDOMFacade1=l.LOADING,t=document.createElement("div"),r("sdk.Content").append(t,this.element),t=new(n("sdk.XFBML.CustomerChatNew"))(t,"fb","customerchat",this.params),this.$ChatDOMFacade7=t,t.subscribe("xd.mpn.setupIconIframe",function(e){o.$ChatDOMFacade1=l.LOADED,o.$ChatDOMFacade19()}),this.$ChatDOMFacade23(e),t.process())},t})(r("DOMPlugin").DOMPlugin),i.default=e},98),t.__d("IframePluginClass",["Log","QueryString","UrlMap","guid","sdk.Auth.LoginStatus","sdk.AuthUtils","sdk.DOM","sdk.Event","sdk.Observable","sdk.PlatformVersioning","sdk.PluginUtils","sdk.Runtime","sdk.UA","sdk.URI","sdk.XD","sdk.createIframe"],function(e,t,n,r,o,a,i){e=(function(e){d.inheritsLoose(t,e);function t(t,o,a,i,l){var s;l===void 0&&(l=null),s=e.call(this)||this,a=a.replace(/-/g,"_"),s.$IframePluginClass2=!1,s.config=l!=null?l:{fluid:!1,mobile_fullsize:!1,full_width:!1};var u=r("sdk.PluginUtils").getVal(i,"plugin_id");s.subscribe("xd.resize",r("sdk.PluginUtils").resizeBubbler(u)),s.subscribe("xd.resize.flow",r("sdk.PluginUtils").resizeBubbler(u)),s.subscribe("xd.resize.flow",function(e){c("Object","assign",!1,s.iframeOptions.root.style,{verticalAlign:"bottom",overflow:""}),r("sdk.PluginUtils").resize(s.iframeOptions.root,r("sdk.PluginUtils").parse(e.width),r("sdk.PluginUtils").parse(e.height)),s.updateLift(),window.clearTimeout(s.$IframePluginClass1)}),s.subscribe("xd.resize",function(e){c("Object","assign",!1,s.iframeOptions.root.style,{verticalAlign:"bottom",overflow:""}),r("sdk.PluginUtils").resize(s.iframeOptions.root,r("sdk.PluginUtils").parse(e.width),r("sdk.PluginUtils").parse(e.height)),r("sdk.PluginUtils").resize(s.iframe,r("sdk.PluginUtils").parse(e.width),r("sdk.PluginUtils").parse(e.height)),s.$IframePluginClass2=!0,s.updateLift(),window.clearTimeout(s.$IframePluginClass1)}),s.subscribe("xd.resize.iframe",function(e){r("sdk.PluginUtils").resize(s.iframe,r("sdk.PluginUtils").parse(e.width),r("sdk.PluginUtils").parse(e.height)),s.$IframePluginClass2=!0,s.updateLift(),window.clearTimeout(s.$IframePluginClass1)}),s.subscribe("xd.sdk_event",function(e){var n=c("JSON","parse",!1,e.data);n.pluginID=u,r("sdk.Event").fire(e.event,n,t)}),l=i.should_use_new_domain?r("UrlMap").resolve("social_plugin")+"/"+a+".php?":r("UrlMap").resolve("www")+"/plugins/"+a+".php?";var m={};r("sdk.PluginUtils").validate(s.getParams(),t,i,m),r("sdk.PluginUtils").validate(r("sdk.PluginUtils").baseParams,t,i,m),c("Object","assign",!1,m,{app_id:n("sdk.Runtime").getClientID(),locale:n("sdk.Runtime").getLocale(),sdk:"joey",kid_directed_site:n("sdk.Runtime").getKidDirectedSite(),channel:r("sdk.XD").handler(function(e){e!=null&&s.inform("xd."+e.type,e)},"parent.parent",!0)}),s.shouldIgnoreWidth()&&(m.width=void 0),m.container_width=t.offsetWidth,r("sdk.DOM").addCss(t,"fb_iframe_widget");var p=n("guid")();return s.subscribe("xd.verify",function(e){r("sdk.XD").sendToFacebook(p,{method:"xd/verify",params:c("JSON","stringify",!1,e.token)})}),s.subscribe("xd.refreshLoginStatus",function(){r("sdk.AuthUtils").removeLogoutState(),n("sdk.Auth.LoginStatus").getLoginStatus(c(s.inform,"bind",!0,d.assertThisInitialized(s),"login.status"),!0)}),i=document.createElement("span"),c("Object","assign",!1,i.style,{verticalAlign:"top",width:m.lazy?"1px":"0px",height:m.lazy?"1px":"0px",overflow:"hidden"}),s.element=t,s.ns=o,s.tag=a,s.params=m,s.iframeOptions={root:i,url:l+n("QueryString").encode(m),name:p,width:s.config.mobile_fullsize&&n("sdk.UA").mobile()?void 0:m.width||1e3,height:m.height||1e3,style:{border:"none",visibility:"hidden"},title:s.ns+":"+s.tag+" Facebook Social Plugin",testid:s.ns+":"+s.tag+" Facebook Social Plugin",onload:function(){return s.inform("render")},onerror:function(){return r("sdk.PluginUtils").collapseIframe(s.iframe)},lazy:m.lazy},s.config.fluid&&m.width!=="auto"&&(r("sdk.DOM").addCss(s.element,"fbiframe_widget_fluid_desktop"),!m.width&&s.config.full_width&&(s.element.style.width="100%",s.iframeOptions.root.style.width="100%",s.iframeOptions.style.width="100%",s.params.container_width=s.element.offsetWidth,s.iframeOptions.url=l+n("QueryString").encode(s.params))),s}var o=t.prototype;return o.shouldIgnoreWidth=function(){return n("sdk.UA").mobile()&&this.config.mobile_fullsize},o.useInlineHeightForMobile=function(){return!0},o.process=function(){var e=this;if(n("sdk.Runtime").getIsVersioned()){r("sdk.PlatformVersioning").assertVersionIsSet();var t=new(n("sdk.URI"))(this.iframeOptions.url);this.iframeOptions.url=t.setPath("/"+n("sdk.Runtime").getVersion()+t.getPath()).toString()}t=d.extends({},this.params),delete t.channel;var o=n("QueryString").encode(t);if(this.element.getAttribute("fb-iframe-plugin-query")==o){r("Log").info("Skipping render: %s:%s %s",this.ns,this.tag,o),this.inform("render");return}for(this.element.setAttribute("fb-iframe-plugin-query",o),this.subscribe("render",function(){r("sdk.Event").fire("iframeplugin:onload"),e.iframe.style.visibility="visible",e.$IframePluginClass2||r("sdk.PluginUtils").collapseIframe(e.iframe)});this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(this.iframeOptions.root);var a=n("sdk.UA").mobile()?120:45;this.$IframePluginClass1=window.setTimeout(function(){r("sdk.PluginUtils").collapseIframe(e.iframe),r("Log").warn("%s:%s failed to resize in %ss",e.ns,e.tag,a)},a*1e3),this.iframe=n("sdk.createIframe")(this.iframeOptions),r("sdk.Event").fire("iframeplugin:create"),(n("sdk.UA").mobile()||t.width==="auto")&&(this.useInlineHeightForMobile()&&r("sdk.DOM").addCss(this.element,"fbiframe_widget_fluid"),this.iframeOptions.width||(c("Object","assign",!1,this.element.style,{display:"block",width:"100%",height:"auto"}),c("Object","assign",!1,this.iframeOptions.root.style,{width:"100%",height:"auto"}),o={height:"auto",position:"static",width:"100%"},(n("sdk.UA").iphone()||n("sdk.UA").ipad())&&c("Object","assign",!1,o,{width:"220px",minWidth:"100%"}),c("Object","assign",!1,this.iframe.style,o)))},o.getParams=function(){return this.params},o.updateLift=function(){var e=this.iframe.style.width===this.iframeOptions.root.style.width&&this.iframe.style.height===this.iframeOptions.root.style.height;(e?r("sdk.DOM").removeCss:r("sdk.DOM").addCss)(this.iframe,"fbiframe_widget_lift")},t})(r("sdk.Observable").Observable),i.default=e},98),t.__d("MPNExplicitUserInteractions",[],function(i,t,n,r,o,a){"use strict";var e=36e5;function i(t){return t==null?!1:Date.now()<=t+e}a.hasUserInteraction=i},66),t.__d("MPNLocalState",[],function(e,t,n,r,o,a){"use strict";e={LANDING_BANNER:1,WELCOME_PAGE:2,ITP_CONTINUE:3,THREAD_VIEW:4,BUBBLE:5,REENGAGEMENT_COLLAPSED_VIEW:6,REENGAGEMENT_EXPANDED_VIEW:7},t={CHAT_NOT_STARTED:1,LOGGED_IN_CHAT_STARTED:2,GUEST_CHAT_STARTED:3},n="__fb_chat_plugin",a.MPNLocalStatePath=e,a.MPNChatState=t,a.LOCAL_STATE_KEY=n},66),t.__d("getFacebookOriginForTarget",["Log"],function(e,t,n,r,o,a,i){function e(e,t){t===void 0&&(t=top);var n=0,o=!1,a=200;window.addEventListener("message",function(n){n.source===t&&n.data.xdArbiterAck&&(/\.facebook\.(com|net)$/.test(n.origin)&&/^https:/.test(n.origin)?o===!1&&(o=!0,r("Log").debug("initXdArbiter got xdArbiterAck from "+n.origin),e(n.origin)):r("Log").error("xdAbiterAck was not from Facebook: ",n.origin))},!1),t.postMessage({xdArbiterSyn:!0},"*"),n=window.setInterval(function(){!o&&a>0?(a--,r("Log").debug("resending xdArbiterSyn"),t.postMessage({xdArbiterSyn:!0},"*")):window.clearInterval(n)},200)}i.default=e},98),t.__d("MPNSingletonProvider",[],function(e,t,n,r,o,a){"use strict";e=(function(){function e(e){this.$1=null,this.$2=e}var t=e.prototype;return t.get=function(){return this.$1==null&&(this.$1=this.$2()),this.$1},t.clear=function(){this.$1=null},e})(),a.default=e},66),t.__d("sdk.DocumentTitle",[],function(m,_,n,r,o,a){var e=document.title,t=null,i=1500,l=null,s=!1;function u(){t!==null?s?d():c(t):(clearInterval(l),l=null,d())}function c(e){document.title=e,s=!0}function d(){p(e),s=!1}function m(){return e}function p(e){document.title=e}function _(e){return t=e,l===null&&(l=setInterval(u,i)),{stop:function(){t=null}}}a.get=m,a.set=p,a.blink=_},66),t.__d("sdk.cp.Constants",["MPNLocalState","UrlMap","sdk.Runtime"],function(e,t,n,r,o,a,i){"use strict";e=n("sdk.Runtime").getIsVersioned()?r("UrlMap").resolve("www")+"/"+n("sdk.Runtime").getVersion()+"/plugins/customer_chat/bubble":r("UrlMap").resolve("www")+"/plugins/customer_chat/bubble",t=n("sdk.Runtime").getIsVersioned()?r("UrlMap").resolve("social_plugin")+"/"+n("sdk.Runtime").getVersion()+"/customer_chat/bubble":r("UrlMap").resolve("social_plugin")+"/customer_chat/bubble",o={attribute:{alignment:"alignment",mobilePath:"mobile_path",desktopBottomSpacing:"desktop_bottom_spacing"},path:{landingPage:"/",welcomePage:"/welcome",bubble:"/bubble",itp:"/itpcontinue"},localStateKey:r("MPNLocalState").LOCAL_STATE_KEY,animationEvents:["animationend","mozAnimationEnd","MSAnimationEnd","oAnimationEnd","webkitAnimationEnd"],blankFrameURL:e,blankFrameNewDomainURL:t},i.default=o},98),t.__d("sdk.cp.Actions",["DOMEventListener","MPNExplicitUserInteractions","MPNLocalState","MPNSingletonProvider","sdk.DOM","sdk.DocumentTitle","sdk.URI","sdk.WebStorage","sdk.cp.Constants"],function(e,t,n,r,o,a,i){"use strict";var l=(function(){function e(){}var t=e.prototype;return t.reloadIframe=function(e,t){var o;if(e!=null){var a=new(n("sdk.URI"))(e.src),i=a.getQueryData();i.local_state=(o=r("sdk.WebStorage").getLocalStorage())==null?void 0:o.getItem(n("sdk.cp.Constants").localStateKey),i.request_time=Date.now(),(t==="true"||this.getExplicitUserInteractionFlag())&&(i.has_explicit_interaction="1"),i.is_implicit_reload="1",a.setQueryData(i),e.src=a.valueOf()}},t.getExplicitUserInteractionFlag=function(){var e=r("sdk.WebStorage").getLocalStorage(),t=null;if(e!=null)try{t=e.getItem(r("MPNLocalState").LOCAL_STATE_KEY)}catch(e){return!1}if(t!=null)try{return e=c("JSON","parse",!1,t),r("MPNExplicitUserInteractions").hasUserInteraction(e==null?void 0:e.euit)}catch(e){return!1}return!1},t.setDialogAppearance=function(e,t){if(e!=null){var n=t.height,o=t.boxShadow,a=t.margin,i=t.width;t=t.bottom,o!=null&&r("sdk.DOM").setStyle(e,"boxShadow",o),a!=null&&r("sdk.DOM").setStyle(e,"margin",a),n!=null&&r("sdk.DOM").setStyle(e,"height",n),i!=null&&r("sdk.DOM").setStyle(e,"width",i),t!=null&&r("sdk.DOM").setStyle(e,"bottom",t)}},t.blinkPageTitle=function(e){var t=this;e!=null?(this.$2(),this.$1=r("sdk.DocumentTitle").blink(e),n("DOMEventListener").add(window,"focus",function(e){t.$2()})):this.$1&&e==null&&this.$2()},t.$2=function(){this.$1!=null&&(this.$1.stop(),this.$1=null)},e})();e=new(n("MPNSingletonProvider"))(function(){return new l}),t=e.get(),i.default=t},98),t.__d("sdk.cp.Animation",["sdk.DOM","sdk.UA","sdk.cp.Constants"],function(e,t,n,r,o,a,i){"use strict";function e(e){if(e){var t=r("sdk.DOM").getAttr(e,n("sdk.cp.Constants").attribute.alignment);e=r("sdk.DOM").getAttr(e,n("sdk.cp.Constants").attribute.mobilePath);var o=n("sdk.UA").mobile(),a;if(o)switch(e){case n("sdk.cp.Constants").path.landingPage:return"fb_mpn_mobile_landing_page_slide_up";case n("sdk.cp.Constants").path.welcomePage:case n("sdk.cp.Constants").path.bubble:case n("sdk.cp.Constants").path.itp:return null;default:return"fb_mpn_mobile_bounce_in"}else switch(t){case"left":a="fb_customer_chat_bounce_in_from_left";break;case"right":default:a="fb_customer_chat_bounce_in_v2"}return a}}function t(e){if(e){var t=r("sdk.DOM").getAttr(e,n("sdk.cp.Constants").attribute.alignment);e=r("sdk.DOM").getAttr(e,n("sdk.cp.Constants").attribute.mobilePath);var o=n("sdk.UA").mobile(),a;if(o)switch(e){case n("sdk.cp.Constants").path.landingPage:return t==="left"?"fb_mpn_mobile_landing_page_slide_out_from_left":"fb_mpn_mobile_landing_page_slide_out";case n("sdk.cp.Constants").path.bubble:return"fb_mpn_mobile_bounce_out_v2";default:return"fb_mpn_mobile_bounce_out"}else switch(t){case"left":a="fb_customer_chat_bounce_out_from_left";break;case"right":default:a="fb_customer_chat_bounce_out_v2"}return a}}i.iframeBounceInAnimation=e,i.iframeBounceOutAnimation=t},98),t.__d("sdk.cp.Storage",["MPNSingletonProvider","sdk.WebStorage","sdk.cp.Constants"],function(e,t,n,r,o,a,i){"use strict";var l=(function(){function e(){}var t=e.prototype;return t.setState=function(e){var t=r("sdk.WebStorage").getLocalStorageForRead();if(t)try{if(e==null)t.removeItem(n("sdk.cp.Constants").localStateKey);else{var o=t.getItem(n("sdk.cp.Constants").localStateKey);o==null?t.setItem(n("sdk.cp.Constants").localStateKey,c("JSON","stringify",!1,c("JSON","parse",!1,e))):(o=c("JSON","parse",!1,o),e=c("JSON","parse",!1,e),t.setItem(n("sdk.cp.Constants").localStateKey,c("JSON","stringify",!1,d.extends({},o,e))))}}catch(e){return}},t.getStateJSON=function(){var e=r("sdk.WebStorage").getLocalStorageForRead();return e?(e=e.getItem(n("sdk.cp.Constants").localStateKey),e==null?"{}":c("JSON","stringify",!1,c("JSON","parse",!1,e))):"{}"},e})();e=new(n("MPNSingletonProvider"))(function(){return new l}),t=e.get(),i.default=t},98),t.__d("sdk.XFBML.CustomerChatNew",["ChatPluginSDKPreLoggingUtils","DOMEventListener","IframePluginClass","Log","MPNExplicitUserInteractions","MPNLocalState","QueryString","UrlMap","getFacebookOriginForTarget","performanceAbsoluteNow","sdk.Content","sdk.DOM","sdk.DialogUtils","sdk.Event","sdk.UA","sdk.WebStorage","sdk.XD","sdk.XFBML.CustomerChatWrapper","sdk.cp.Actions","sdk.cp.Animation","sdk.cp.Constants","sdk.cp.Storage","sdk.createIframe"],function(e,t,n,r,o,a,i){"use strict";e=(function(e){d.inheritsLoose(t,e);function t(t,n,o,a){var i;return i=e.call(this,t,n,o,a)||this,i.$CustomerChat1=null,i.$CustomerChat2=null,i.$CustomerChat3=null,i.$CustomerChat4=null,i.$CustomerChat5=null,i.$CustomerChat6=null,i.$CustomerChat7=null,i.$CustomerChat8=null,i.$CustomerChat9=null,i.$CustomerChat10=null,i.$CustomerChat11=null,i.$CustomerChat12=!1,i.$CustomerChat13=null,i.$CustomerChat14=!1,i.$CustomerChat15=!1,i.show=function(e){e===void 0&&(e=!0),i.$CustomerChat15=!1,i.$CustomerChat1!=null&&r("sdk.DOM").setStyle(i.$CustomerChat1,"display","inline"),e&&i.$CustomerChat30(i.$CustomerChat4),r("sdk.Event").fire("customerchat.show"),i.$CustomerChat34("show")},i.hide=function(){i.$CustomerChat15=!0,i.$CustomerChat1!=null&&r("sdk.DOM").setStyle(i.$CustomerChat1,"display","none"),i.$CustomerChat29(i.$CustomerChat4),r("sdk.Event").fire("customerchat.hide"),i.$CustomerChat34("hide")},i.showDialog=function(){i.$CustomerChat1!=null&&r("sdk.DOM").setStyle(i.$CustomerChat1,"display","inline"),i.$CustomerChat30(i.$CustomerChat4),i.$CustomerChat34("showDialog")},i.hideDialog=function(){i.$CustomerChat29(i.$CustomerChat4),i.$CustomerChat34("hideDialog")},i.update=function(e){var t;r("sdk.XD").sendToFacebook((t=i.$CustomerChat5)!=null?t:"",{method:"updateCustomerChat",params:c("JSON","stringify",!1,e||{})}),i.$CustomerChat34("update")},r("sdk.DOM").addCss(t,"fb_invisible_flow"),r("sdk.DOM").remove(t),r("sdk.Content").append(t),i.$CustomerChat16=!!a.should_use_new_domain,i.$CustomerChat17(),r("sdk.Event").fire("customerchat.load"),i.$CustomerChat18(),r("ChatPluginSDKPreLoggingUtils").preLogging(i.$CustomerChat16,"chat_plugin_sdk_dialog_iframe_create",i.params,!1),i}var o=t.prototype;return o.$CustomerChat17=function(){var e=r("sdk.WebStorage").getLocalStorage(),t=null;if(e!=null)try{t=e.getItem(r("MPNLocalState").LOCAL_STATE_KEY)}catch(e){r("Log").warn("Failed to access localStorage")}if(t!=null&&c("Object","assign",!1,this.params,{local_state:t}),t!=null)try{e=c("JSON","parse",!1,t),r("MPNExplicitUserInteractions").hasUserInteraction(e==null?void 0:e.euit)&&c("Object","assign",!1,this.params,{has_explicit_interaction:1})}catch(e){r("Log").warn("Invalid local state")}t=n("performanceAbsoluteNow")(),c("Object","assign",!1,this.params,{request_time:t}),e=this.$CustomerChat16?r("UrlMap").resolve("social_plugin")+"/"+this.tag+".php?":r("UrlMap").resolve("www")+"/plugins/"+this.tag+".php?",this.iframeOptions.url=e+n("QueryString").encode(this.params),this.iframeOptions.title=""},o.$CustomerChat18=function(){var e=this;this.subscribe("render",function(){r("ChatPluginSDKPreLoggingUtils").preLogging(e.$CustomerChat16,"chat_plugin_sdk_dialog_iframe_load",e.params)}),this.subscribe("xd.mpn.storeState",function(e){n("sdk.cp.Storage").setState(e.state)}),this.subscribe("xd.mpn.getState",function(t){t=n("sdk.cp.Storage").getStateJSON(),t={name:"mpnDidFetchState",params:t},e.$CustomerChat19(t),e.$CustomerChat20(t)}),this.subscribe("xd.mpn.setupIconIframe",function(t){e.$CustomerChat21(t)}),this.subscribe("xd.mpn.setupDialogIframe",function(t){e.$CustomerChat22(t)}),this.subscribe("xd.mpn.toggleDialogVisibility",function(t){e.$CustomerChat23(t)}),this.subscribe("xd.mpn.toggleGreetingDialogVisibility",function(t){e.$CustomerChat24(t)}),this.subscribe("xd.mpn.updateGreetingAppearance",function(t){n("sdk.cp.Actions").setDialogAppearance(e.$CustomerChat10,t)}),this.subscribe("xd.mpn.updateDialogAppearance",function(t){n("sdk.cp.Actions").setDialogAppearance(e.iframe,t)}),this.subscribe("xd.mpn.updateIconAppearance",function(t){n("sdk.cp.Actions").setDialogAppearance(e.$CustomerChat3,t)}),this.subscribe("xd.mpn.reload",function(t){n("sdk.cp.Actions").reloadIframe(e.iframe,t.hasExplicitInteraction)}),this.subscribe("xd.mpn.updatePageTitle",function(e){n("sdk.cp.Actions").blinkPageTitle(e.title)}),this.subscribe("xd.mpn.navigateToWelcomePage",function(t){e.$CustomerChat25(t.isHidden)}),r("sdk.XFBML.CustomerChatWrapper").CustomerChatInternalEvent.subscribe(r("sdk.XFBML.CustomerChatWrapper").CustomerChatInternalEventType.SHOW,this.show),r("sdk.XFBML.CustomerChatWrapper").CustomerChatInternalEvent.subscribe(r("sdk.XFBML.CustomerChatWrapper").CustomerChatInternalEventType.HIDE,this.hide),r("sdk.XFBML.CustomerChatWrapper").CustomerChatInternalEvent.subscribe(r("sdk.XFBML.CustomerChatWrapper").CustomerChatInternalEventType.SHOW_DIALOG,this.showDialog),r("sdk.XFBML.CustomerChatWrapper").CustomerChatInternalEvent.subscribe(r("sdk.XFBML.CustomerChatWrapper").CustomerChatInternalEventType.HIDE_DIALOG,this.hideDialog),r("sdk.XFBML.CustomerChatWrapper").CustomerChatInternalEvent.subscribe(r("sdk.XFBML.CustomerChatWrapper").CustomerChatInternalEventType.UPDATE,this.update)},o.$CustomerChat21=function(e){var t=this;this.$CustomerChat1&&r("sdk.DOM").remove(this.$CustomerChat1);var o=e.frameName,a=e.iconSVG,i=r("sdk.DialogUtils").setupNewDialog(),l=c("JSON","parse",!1,e.cssText),s=document.createElement("div");a!=null&&(r("sdk.DOM").html(s,a),c("Object","assign",!1,s.style,l),s.style.boxShadow="none",r("sdk.Content").append(s,i.contentRoot));var u="blank_"+o;this.$CustomerChat1=i.dialogElement,this.$CustomerChat3=n("sdk.createIframe")({url:this.$CustomerChat16?n("sdk.cp.Constants").blankFrameNewDomainURL:n("sdk.cp.Constants").blankFrameURL,name:u,root:i.contentRoot,tabindex:-1,width:60,style:l,"data-testid":"bubble_iframe",onload:function(){r("ChatPluginSDKPreLoggingUtils").preLogging(t.$CustomerChat16,"chat_plugin_sdk_icon_iframe_load",t.params),t.$CustomerChat2=u,t.$CustomerChat26(),t.$CustomerChat27(),window.setTimeout(function(){r("sdk.DOM").remove(s)},100)}}),this.$CustomerChat1&&this.$CustomerChat1.setAttribute(n("sdk.cp.Constants").attribute.alignment,e.alignment),this.$CustomerChat1&&r("sdk.Content").append(this.$CustomerChat1);var d="availabilityStatus_"+o;this.$CustomerChat8=n("sdk.createIframe")({url:this.$CustomerChat16?n("sdk.cp.Constants").blankFrameNewDomainURL:n("sdk.cp.Constants").blankFrameURL,name:d,root:i.contentRoot,tabindex:-1,style:c("JSON","parse",!1,e.availabilityStatusCssText),"data-testid":"availabilityStatus_iframe",onload:function(){t.$CustomerChat9=d,t.$CustomerChat26(),t.$CustomerChat27()}}),r("sdk.Content").append(this.$CustomerChat8,i.contentRoot);var m="unread_"+o;if(this.$CustomerChat6=n("sdk.createIframe")({url:this.$CustomerChat16?n("sdk.cp.Constants").blankFrameNewDomainURL:n("sdk.cp.Constants").blankFrameURL,name:m,root:i.contentRoot,tabindex:-1,style:c("JSON","parse",!1,e.unreadCountCssText),"data-testid":"unread_iframe",onload:function(){t.$CustomerChat7=m,t.$CustomerChat26(),t.$CustomerChat27()}}),r("sdk.Content").append(this.$CustomerChat6,i.contentRoot),a=n("sdk.UA").mobile(),!a){var p="greeting_"+o;this.$CustomerChat10=n("sdk.createIframe")({url:this.$CustomerChat16?n("sdk.cp.Constants").blankFrameNewDomainURL:n("sdk.cp.Constants").blankFrameURL,name:p,root:i.contentRoot,tabindex:-1,style:c("JSON","parse",!1,e.greetingCssText),"data-testid":"greeting_iframe",onload:function(){t.$CustomerChat11=p,t.$CustomerChat26(),t.$CustomerChat27()}}),r("sdk.Content").append(this.$CustomerChat10,i.contentRoot)}},o.$CustomerChat27=function(){this.$CustomerChat2!==null&&this.$CustomerChat7!==null&&this.$CustomerChat9!==null&&this.$CustomerChat5!==null&&this.$CustomerChat11!==null&&!this.$CustomerChat12&&(this.$CustomerChat12=!0,this.inform("iframes_loaded"))},o.$CustomerChat26=function(){var e;this.$CustomerChat19({name:"bubbleFrameLoaded",frameName:this.$CustomerChat2,unreadCountFrameName:this.$CustomerChat7,availabilityStatusIframeName:this.$CustomerChat9,greetingIframeName:this.$CustomerChat11,iconSrc:(e=this.$CustomerChat3)==null?void 0:e.src,unreadSrc:(e=this.$CustomerChat6)==null?void 0:e.src,request_time:this.params.request_time,log_id:this.params.log_id})},o.$CustomerChat25=function(e){this.$CustomerChat19({name:"navigateToWelcomePage",isHidden:e})},o.$CustomerChat22=function(e){var t=e.cssText,o=e.mobilePath,a=e.isDialogHidden;e=e.desktopBottomSpacing,this.$CustomerChat1&&(o&&this.$CustomerChat1.setAttribute(n("sdk.cp.Constants").attribute.mobilePath,o),e&&this.$CustomerChat1.setAttribute(n("sdk.cp.Constants").attribute.desktopBottomSpacing,e.toString())),this.$CustomerChat14=a==="true",this.iframe&&(this.iframe.setAttribute("data-testid","dialog_iframe"),this.iframe.style.cssText=t),this.$CustomerChat4=this.iframe,this.$CustomerChat5=this.iframe.name,this.$CustomerChat27(),e=n("sdk.UA").mobile(),e&&!this.$CustomerChat14&&(o==n("sdk.cp.Constants").path.landingPage&&(a=r("sdk.cp.Animation").iframeBounceInAnimation(this.$CustomerChat1),a!=null&&r("sdk.DOM").addCss(this.$CustomerChat4,a)),o!=n("sdk.cp.Constants").path.landingPage&&o!=n("sdk.cp.Constants").path.bubble&&this.$CustomerChat28()),this.$CustomerChat15&&this.hide()},o.$CustomerChat23=function(e){e=e.shouldHide,e==="true"?this.$CustomerChat29(this.iframe):this.$CustomerChat30(this.iframe)},o.$CustomerChat24=function(e){e=e.shouldHide,e==="true"?this.$CustomerChat31(this.$CustomerChat10):this.$CustomerChat32(this.$CustomerChat10)},o.getParams=function(){return{allow_guests:"bool",attribution:"string",greeting_dialog_display:"string",greeting_dialog_delay:"string",logged_in_greeting:"string",logged_out_greeting:"string",minimized:"bool",page_id:"string",theme_color:"string",override:"string",attribution_version:"string",is_loaded_by_facade:"bool",current_url:"string",log_id:"string",request_time:"px"}},o.$CustomerChat33=function(e,t){var r=this,o=window.frames[e],a=function(n){o==null||o.postMessage(d.extends({},t),n)};this.$CustomerChat13===null?n("getFacebookOriginForTarget")(function(e){r.$CustomerChat13=e,a(r.$CustomerChat13)},o):a(this.$CustomerChat13)},o.$CustomerChat20=function(e){var t;this.$CustomerChat33((t=this.$CustomerChat2)!=null?t:"",e)},o.$CustomerChat19=function(e){var t;this.$CustomerChat33((t=this.$CustomerChat5)!=null?t:"",e)},o.$CustomerChat34=function(e){this.$CustomerChat19({name:"CustomerChat.SDK.Called",event:e})},o.$CustomerChat28=function(){var e="fb_new_ui_mobile_overlay_active";r("sdk.DOM").addCss(document.body,e)},o.$CustomerChat30=function(e){if(e&&this.$CustomerChat14){this.$CustomerChat14=!1;var t=r("sdk.cp.Animation").iframeBounceInAnimation(this.$CustomerChat1),o=r("sdk.cp.Animation").iframeBounceOutAnimation(this.$CustomerChat1);o!=null&&r("sdk.DOM").removeCss(e,o),t!=null&&r("sdk.DOM").addCss(e,t),n("sdk.UA").mobile()?(r("sdk.DOM").setStyle(e,"maxHeight","100%"),r("sdk.DOM").setStyle(e,"height","100%"),r("sdk.DOM").setStyle(e,"width","100%")):(o=this.$CustomerChat1&&r("sdk.DOM").getAttr(this.$CustomerChat1,n("sdk.cp.Constants").attribute.desktopBottomSpacing),t=o==null?"80":Number(o)+60,r("sdk.DOM").setStyle(e,"maxHeight","calc(100% - "+t+"px)"),r("sdk.DOM").setStyle(e,"minHeight","300px")),this.$CustomerChat19({name:"CustomerChat.isDialogHidden",params:{is_dialog_hidden:!1}}),this.$CustomerChat20({name:"CustomerChat.isDialogHidden",params:{is_dialog_hidden:!1}}),r("sdk.Event").fire("customerchat.dialogShow")}},o.$CustomerChat29=function(e){var t=this;if(e){if(!this.$CustomerChat14){this.$CustomerChat14=!0;var o=r("sdk.cp.Animation").iframeBounceInAnimation(this.$CustomerChat1),a=r("sdk.cp.Animation").iframeBounceOutAnimation(this.$CustomerChat1);o!=null&&r("sdk.DOM").removeCss(e,o),a!=null&&r("sdk.DOM").addCss(e,a);var i={};n("sdk.cp.Constants").animationEvents.forEach(function(o){var a=function(a){t.$CustomerChat14&&(r("sdk.DOM").setStyle(e,"maxHeight","0"),r("sdk.DOM").setStyle(e,"minHeight","0"),n("sdk.cp.Constants").animationEvents.forEach(function(t){i[t]&&(r("DOMEventListener").remove(e,t,i[t]),delete i[t])}))};i[o]=a,r("DOMEventListener").add(e,o,a)}),this.$CustomerChat19({name:"CustomerChat.isDialogHidden",params:{is_dialog_hidden:!0}}),this.$CustomerChat20({name:"CustomerChat.isDialogHidden",params:{is_dialog_hidden:!0}})}r("sdk.Event").fire("customerchat.dialogHide")}},o.$CustomerChat31=function(e){e&&(r("sdk.DOM").setStyle(e,"maxHeight","0"),r("sdk.DOM").setStyle(e,"minHeight","0"))},o.$CustomerChat32=function(e){e&&r("sdk.DOM").setStyle(e,"maxHeight","calc(100% - 80px)")},t})(n("IframePluginClass")),i.default=e},98),t.__d("sdk.XFBML.CustomerChatWrapper",["$InternalEnum","CORSRequest","UrlMap","sdk.Observable","sdk.XFBML.ChatDOM"],function(e,t,n,r,o,a,i){e=t("$InternalEnum")({SHOW:"SHOW",HIDE:"HIDE",SHOW_DIALOG:"SHOW_DIALOG",HIDE_DIALOG:"HIDE_DIALOG",UPDATE:"UDPATE"}),o=new(r("sdk.Observable")).Observable,a=function(t,n,r,o){return new l(t,n,r,o)};var l=(function(e){d.inheritsLoose(t,e);function t(t,n,r,o){var a;return a=e.call(this)||this,a.$CustomerChatWrapper2=t,a.$CustomerChatWrapper3=n,a.$CustomerChatWrapper4=r,a.$CustomerChatWrapper5=o,a}var o=t.prototype;return o.process=function(){var e=this,t=r("UrlMap").resolve("social_plugin")+"/new_domain_gating/";n("CORSRequest").execute(t,"get",{page_id:this.$CustomerChatWrapper5.page_id,endpoint:this.$CustomerChatWrapper4},function(t){e.$CustomerChatWrapper5.should_use_new_domain=t.should_use_new_domain,e.$CustomerChatWrapper1=new(n("sdk.XFBML.ChatDOM"))(e.$CustomerChatWrapper2,e.$CustomerChatWrapper3,e.$CustomerChatWrapper4,e.$CustomerChatWrapper5),e.$CustomerChatWrapper1.subscribe("render",function(){e.inform("render")}),e.$CustomerChatWrapper1.process()})},t})(r("sdk.Observable").Observable);i.CustomerChatInternalEventType=e,i.CustomerChatInternalEvent=o,i.CustomerChatWrapperPlugin=a},98),t.__d("sdk.XFBML.LWIAdsCreation",["IframePlugin","sdk.createIframe"],function(e,t,n,r,o,a,i){"use strict";e=n("IframePlugin").extend({constructor:function(t,n,r,o){this.parent(t,n,r,o),this._setUpSubscriptions()},getParams:function(){return{fbe_extras:"string",fbe_redirect_uri:"string",fbe_scopes:"string",fbe_state:"string",hide_manage_button:"bool",hide_explore_more_options:"bool",preferred_ad_options:"string"}},_setUpSubscriptions:function(){var e=this;this.subscribe("xd.lwiadscreation.load",function(t){e._createIframe(t)})},_createIframe:function(t){n("sdk.createIframe")({url:t.iframeURL,name:"LWIAdsCreationRootIframe",root:document.body,height:300,width:950})}}),t=e,i.default=t},98),t.__d("sdk.XFBML.LWIAdsInsights",["IframePlugin","sdk.createIframe"],function(e,t,n,r,o,a,i){"use strict";e=n("IframePlugin").extend({constructor:function(t,n,r,o){this.parent(t,n,r,o),this._setUpSubscriptions()},getParams:function(){return{fbe_extras:"string",fbe_redirect_uri:"string",fbe_scopes:"string",fbe_state:"string"}},_setUpSubscriptions:function(){var e=this;this.subscribe("xd.lwiadsinsights.load",function(t){e._createIframe(t)})},_createIframe:function(t){n("sdk.createIframe")({url:t.iframeURL,name:"LWIAdsInsightsRootIframe",root:document.body,height:800,width:1050})}}),t=e,i.default=t},98),t.__d("sdk.SVGLogos",["guid"],function(e,t,n,r,o,a,i){"use strict";var l="M90,212v-75h-27v-31h27v-25q0,-40 40,-40q15,0 24,2v26h-14q-16,0 -16,16v21h30l-5,31h-27v75",s="a106 106,0,1,0,-32 0",u="a106 106,1,0,1,-32 0";function d(e,t){return Object.getOwnPropertyNames(t).forEach(function(n){return e.setAttribute(n,t[n])}),e}function m(e,t,n){return t=d(document.createElementNS("http://www.w3.org/2000/svg",t),n),e==null||e.appendChild(t),t}e=function(t){return t=m(null,"svg",c("Object","assign",!1,{viewBox:"0 0 100 100",preserveAspectRatio:"xMinYMin"},t)),m(t,"line",{x1:"0",y1:"100",x2:"100",y2:"0","stroke-width":"12"}),m(t,"line",{x1:"0",y1:"0",x2:"100",y2:"100","stroke-width":"12"}),t},t=function(t){return t=m(null,"svg",c("Object","assign",!1,{viewBox:"0 0 213 213",preserveAspectRatio:"xMinYMin"},t)),m(t,"path",{d:l+s,class:"f_logo_circle"}),m(t,"path",{d:l+u,class:"f_logo_f"}),t},r=function(t){return t=m(null,"svg",c("Object","assign",!1,{viewBox:"0 0 213 213",preserveAspectRatio:"xMinYMin"},t)),m(t,"path",{d:l+s,class:"f_logo_circle",fill:"white"}),m(t,"path",{d:l+u,class:"f_logo_f",fill:"white"}),t},o=function(t){return t=m(null,"svg",c("Object","assign",!1,{viewBox:"-2 -2 104 104",preserveAspectRatio:"xMinYMin"},t)),m(t,"rect",{x:"5",y:"5",width:"91",height:"91","stroke-width":"9",rx:"23",class:"ig_logo_body"}),m(t,"circle",{cx:"77",cy:"23",r:"6",class:"ig_logo_flash"}),m(t,"circle",{cx:"50",cy:"50",r:"21","stroke-width":"9",class:"ig_logo_lens"}),t},a=function(t){var e=n("guid")();t=m(null,"svg",c("Object","assign",!1,{viewBox:"-2 -2 104 104",preserveAspectRatio:"xMinYMin"},t));var r=m(t,"defs",{}),o=m(r,"mask",{id:e});return m(o,"circle",{cx:"77",cy:"23",r:"6",fill:"white"}),m(o,"circle",{cx:"50",cy:"50",r:"21","stroke-width":"9",stroke:"white"}),m(o,"rect",{x:"5",y:"5",width:"91",height:"91","stroke-width":"9",rx:"23",stroke:"white",fill:"none"}),o=m(r,"linearGradient",{id:"purplepink",x1:"0",x2:".15",y1:"0",y2:".6"}),m(o,"stop",{offset:"12%","stop-color":"rgb(88,85,214)"}),m(o,"stop",{offset:"85%","stop-color":"rgb(215,27,122)"}),o=m(r,"radialGradient",{id:"yelloworange",cx:".35",cy:"1",r:"2"}),m(o,"stop",{offset:"7%","stop-color":"rgb(252,215,114)"}),m(o,"stop",{offset:"20%","stop-color":"rgb(244,102,37)"}),m(o,"stop",{offset:"38%","stop-color":"rgb(225,37,122)","stop-opacity":"0"}),m(t,"rect",{x:"1",y:"1",width:"99",height:"99","stroke-width":"0",rx:"23",fill:"url(#purplepink)",style:"mask: url(#"+e+")"}),m(t,"rect",{x:"1",y:"1",width:"99",height:"99","stroke-width":"0",rx:"23",fill:"url(#yelloworange)",style:"mask: url(#"+e+")"}),t},i.close=e,i.facebook=t,i.facebookWhite=r,i.instagram=o,i.instagramColor=a},98),t.__d("sdk.SharedStringConstants",["sdk.fbt"],function(e,t,n,r,o,a,i){"use strict";e={continueWith:n("sdk.fbt")._("Continue with {facebook_app_name} or {instagram_app_name}"),continueWithShort:n("sdk.fbt")._("{facebook_app_name} or {instagram_app_name}"),loginButtonAriaLabel:n("sdk.fbt")._("Continue with Facebook or Instagram"),logout:n("sdk.fbt")._("Logout"),logoutButtonAriaLabel:n("sdk.fbt")._("Logout the current website"),titleText:n("sdk.fbt")._("Choose Account"),promptText:n("sdk.fbt")._("Which account would you like to use to log in?"),facebookText:n("sdk.fbt")._("Log in with Facebook"),facebookTextShort:n("sdk.fbt")._("Log in"),instagramText:n("sdk.fbt")._("Log in with Instagram"),disambiguationDialogAriaLabelText:n("sdk.fbt")._("Log in with Facebook or Instagram"),fbButtonText:n("sdk.fbt")._("Continue with Facebook"),igButtonText:n("sdk.fbt")._("Continue with Instagram")},i.buttonStringsFBT=e},98),t.__d("sdk.XFBML.ShadowDOMLoginButton",["DOMPlugin","UrlMap","sdk.Auth","sdk.Event","sdk.LoggingUtils","sdk.PluginUtils","sdk.Runtime","sdk.SVGLogos","sdk.SharedStringConstants","sdk.createIframe","sdk.ui"],function(e,t,n,r,o,a,i){var l={small:"11px",medium:"13px",large:"16px"},s={small:"20px",medium:"30px",large:"40px"},u="{facebook_app_name}";e=(function(e){d.inheritsLoose(t,e);function t(t,o,a,i,l){return t=e.call(this,t,o,a,i,l)||this,t.stateObservers=[],t.shadowCss=["css:fb.shadow.css.fb_login_button"],t.container=document.createElement("div"),t.container.classList.add("fb_login_button_container"),t.container.dir="auto",t.loginButtonText=t.updateLabel(),t.fbLoginButton=document.createElement("button"),t.borderRadius=t.updateRadius(t.params),t.fbLoginButton=t.createSingleButton(t.loginButtonText),t.createFBButton("fb-button-main-element",r("sdk.SharedStringConstants").buttonStringsFBT.logout,r("sdk.SharedStringConstants").buttonStringsFBT.logoutButtonAriaLabel,C,function(e){this.style.display=e.status==="connected"?"flex":"none"},c(function(e){n("sdk.Auth").logout(),e&&e.detail===0&&this.fbLoginButton&&this.fbLoginButton.style.display!=="none"&&this.fbLoginButton.focus()},"bind",!0,d.assertThisInitialized(t))),t}var o=t.prototype;return o.render=function(e){var t=this;return this.updateDisplay({shouldHideDisambiguation:!0,status:n("sdk.Runtime").getLoginStatus()}),r("sdk.Event").subscribe("auth.statusChange",function(e){e={shouldHideDisambiguation:!0,status:e.status,fxApp:e.loginSource},t.updateDisplay(e)}),this.container},o.createSingleButton=function(e){return this.createFBButton("fb-button-main-element",e,e,y,function(e){this.style.display=e.status==="connected"?"none":"flex"},c(function(e){e.stopPropagation(),r("sdk.LoggingUtils").logLoginEvent(this.params,r("sdk.LoggingUtils").logEventName.buttonClick+"_single_fb"),this.loginTrigger()},"bind",!0,this))},o.loginTrigger=function(){var e="";n("sdk.ui")({method:"permissions.oauth",display:"popup",scope:e},this.loginCb())},o.createFBButton=function(e,t,n,r,o,a){var i=document.createElement("button");return i.classList.add(e),i.setAttribute("aria-label",n),e=document.createElement("span"),e.classList.add("fb_button_label_element"),e.classList.add("fb_button_label"),this.applyStyles(i,this.params),this.use_continue_as===!0?e.append(this.createIframeOverlay(this.container,this.params)):r(this.params,t,e),i.appendChild(e),i.addEventListener("click",function(e){a(e),i.blur()}),i.updateDisplay=c(o,"bind",!0,i),this.stateObservers.push(i),this.container.appendChild(i),i},o.loginCb=function(){var e=this;return function(t){t.authResponse!=null&&t.status==="connected"?r("sdk.LoggingUtils").logLoginEvent(e.params,r("sdk.LoggingUtils").logEventName.loginSuccess+"_single_fb"):r("sdk.LoggingUtils").logLoginEvent(e.params,r("sdk.LoggingUtils").logEventName.loginCancel+"_single_fb")}},o.updateDisplay=function(e){this.stateObservers.forEach(function(t){return t.updateDisplay(e)})},o.updateLabel=function(){var e=this.params["button-type"]==="login_with"?r("sdk.SharedStringConstants").buttonStringsFBT.facebookText:r("sdk.SharedStringConstants").buttonStringsFBT.fbButtonText,t=g(this.params,e);return this.params["button-type"]==="login_with"&&(e=t?e:r("sdk.SharedStringConstants").buttonStringsFBT.facebookTextShort),e},o.updateRadius=function(e){var t;return t=(t=r("sdk.PluginUtils").getVal(e,"layout"))!=null?t:"default",e=String(r("sdk.PluginUtils").getVal(e,"size")),e=e!==""?e:"small",e=e==="large"?"4px":"3px",t==="rounded"?"20px":e},o.applyStyles=function(e,t){var n=String(r("sdk.PluginUtils").getVal(t,"size"));n=n!==""?n:"small",e.style.borderRadius=this.borderRadius,t=(t=r("sdk.PluginUtils").getVal(t,"width"))!=null?t:null,e.style.width=m(n,t).toString(),e.style.fontSize=l[n],e.style.height=s[n],e.style.backgroundColor="rgb(26,119,242)",e.style.color="#fff",e.style.border="0",e.style.fontWeight="bold"},o.createIframeOverlay=function(e,t){var o,a=String(r("sdk.PluginUtils").getVal(t,"size"));a=a!==""?a:"small";var i=n("sdk.Runtime").getClientID(),l=String(r("sdk.PluginUtils").getVal(t,"layout"));return l=l!==""?l:"default",o=(o=r("sdk.PluginUtils").getVal(t,"width"))!=null?o:null,o=m(a,o).toString(),i=r("UrlMap").resolve("www")+("/plugins/login_button_overlay/"+i+"/"+o+"/"+a+"/"+l+"/"),l={root:e,url:i,borderRadius:(a=r("sdk.PluginUtils").getVal(t,"layout"))!=null?a:"default",width:o},e=n("sdk.createIframe")(l),e.classList.add("fb-iframe-overlay"),e},t})(r("DOMPlugin").DOMPlugin);function m(e,t){return e=e!=null?e:"small",t===""||t==null?_(e):p(e,t)}function p(e,t){t=isNaN(t)?0:Number(t);var n=_(e),r=f(e);return t<_(e)?n:t>f(e)?r:t}function _(e){switch(e){case"large":return 240;case"medium":return 200;default:return 200}}function f(e){switch(e){case"large":return 400;case"medium":return 320;default:return 300}}function g(e,t){var n;return t=t.replace(/\s?{facebook_app_name}\s?/,""),n=(n=r("sdk.PluginUtils").getVal(e,"width"))!=null?n:null,e=(e=r("sdk.PluginUtils").getVal(e,"size"))!=null?e:"large",e=m(e,n),n=h(t)?h(t):0,n<e}function h(e){var t=h.canvas||(h.canvas=document.createElement("canvas"));return t=t.getContext("2d"),t=t==null?void 0:t.measureText(e),t==null?void 0:t.width}function y(e,t,n){var r=document.createElement("span"),o=b();o.classList.add("single_button_svg_logo"),n.append(o),r.textContent=g(e,t)?t:"",n.append(r)}function C(e,t,n){n.textContent="",e=t.search(u);var r=e+u.length,o=Math.min(e),a=Math.min(r);e=Math.max(e),r=Math.max(r);var i=b(),l=document.createElement("span");l.style.whiteSpace="nowrap",l.append(t.substring(0,o)),o=document.createElement("span"),o.style.whiteSpace="nowrap",o.append(t.substring(a,e)),a=document.createElement("span"),a.style.whiteSpace="nowrap",a.append(t.substring(r,t.length)),n.append(i),n.append(l),n.append(o),n.append(a)}function b(){return r("sdk.SVGLogos").facebookWhite({class:"fb_button_svg_logo login_fb_logo"})}i.default=e},98),t.__d("sdk.XFBML.MessengerCheckbox",["FB","IframePluginClass","Log","PluginAttrTypes","sdk.XD"],function(e,t,n,r,o,a,i){"use strict";function l(e){var t=e.app_id,n=e.page_id;return e=e.user_ref,n='[page_id="'+n+'"][messenger_app_id="'+t+'"][user_ref="'+e+'"] iframe',t=document.querySelector(n),(t==null?void 0:t.getAttribute("name"))||null}n("FB").provide("CheckboxPlugin",{confirm:function(t){var e=t.app_id,n=t.page_id,o=t.user_ref,a=l(t);if(e==null){r("Log").warn("app_id is a required parameter.");return}if(n==null){r("Log").warn("page_id is a required parameter.");return}if(o==null){r("Log").warn("user_ref is a required parameter.");return}if(a==null){r("Log").warn("No matching checkbox for the app_id, page_id, and user_ref given.");return}r("sdk.XD").sendToFacebook(a,{method:"confirmCheckboxSubmission",params:t})}}),e=(function(e){d.inheritsLoose(t,e);function t(t,n,r,o){return e.call(this,t,n,r,o,{fluid:!0,full_width:!0,mobile_fullsize:!1})||this}var n=t.prototype;return n.getParams=function(){return{messenger_app_id:r("PluginAttrTypes").string,page_id:r("PluginAttrTypes").string,pixel_id:r("PluginAttrTypes").string,prechecked:r("PluginAttrTypes").bool,allow_login:r("PluginAttrTypes").bool,size:r("PluginAttrTypes").string,origin:r("PluginAttrTypes").string,user_ref:r("PluginAttrTypes").string,identity_match:r("PluginAttrTypes").string,center_align:r("PluginAttrTypes").bool,opt_in_type:r("PluginAttrTypes").string,promotional_frequency:r("PluginAttrTypes").string,promotional_topic:r("PluginAttrTypes").string}},t})(n("IframePluginClass")),i.default=e},98),t.__d("sdk.XFBML.MessengerCheckboxWrapper",["CORSRequest","UrlMap","sdk.Observable","sdk.XFBML.MessengerCheckbox"],function(e,t,n,r,o,a,i){e=function(t,n,r,o){return new l(t,n,r,o)};var l=(function(e){d.inheritsLoose(t,e);function t(t,n,r,o){var a;return a=e.call(this)||this,a.$MessengerCheckboxWrapper2=t,a.$MessengerCheckboxWrapper3=n,a.$MessengerCheckboxWrapper4=r,a.$MessengerCheckboxWrapper5=o,a}var o=t.prototype;return o.process=function(){var e=this,t=r("UrlMap").resolve("social_plugin")+"/new_domain_gating/";n("CORSRequest").execute(t,"get",{page_id:this.$MessengerCheckboxWrapper5.page_id,endpoint:this.$MessengerCheckboxWrapper4},function(t){e.$MessengerCheckboxWrapper5.should_use_new_domain=t.should_use_new_domain,e.$MessengerCheckboxWrapper1=new(n("sdk.XFBML.MessengerCheckbox"))(e.$MessengerCheckboxWrapper2,e.$MessengerCheckboxWrapper3,e.$MessengerCheckboxWrapper4,e.$MessengerCheckboxWrapper5),e.$MessengerCheckboxWrapper1.subscribe("render",function(){e.inform("render")}),e.$MessengerCheckboxWrapper1.process()})},t})(r("sdk.Observable").Observable);t=e,i.default=t},98),t.__d("sdk.XFBML.MessengerMessageUs",["IframePluginClass","PluginAttrTypes"],function(e,t,n,r,o,a,i){"use strict";e=(function(e){d.inheritsLoose(t,e);function t(t,n,r,o){return e.call(this,t,n,r,o,{fluid:!1,full_width:!1,mobile_fullsize:!0})||this}var n=t.prototype;return n.getParams=function(){return{messenger_app_id:r("PluginAttrTypes").string,page_id:r("PluginAttrTypes").string,color:r("PluginAttrTypes").string,size:r("PluginAttrTypes").string}},t})(n("IframePluginClass")),i.default=e},98),t.__d("sdk.XFBML.MessengerMessageUsWrapper",["sdk.Observable","sdk.XFBML.MessengerMessageUs"],function(e,t,n,r,o,a,i){e=function(t,n,r,o){return new l(t,n,r,o)};var l=(function(e){d.inheritsLoose(t,e);function t(t,n,r,o){var a;return a=e.call(this)||this,a.$MessengerMessageUsWrapper2=t,a.$MessengerMessageUsWrapper3=n,a.$MessengerMessageUsWrapper4=r,a.$MessengerMessageUsWrapper5=o,a}var r=t.prototype;return r.process=function(){var e=this;this.$MessengerMessageUsWrapper5.should_use_new_domain=!0,this.$MessengerMessageUsWrapper1=new(n("sdk.XFBML.MessengerMessageUs"))(this.$MessengerMessageUsWrapper2,this.$MessengerMessageUsWrapper3,this.$MessengerMessageUsWrapper4,this.$MessengerMessageUsWrapper5),this.$MessengerMessageUsWrapper1.subscribe("render",function(){e.inform("render")}),this.$MessengerMessageUsWrapper1.process()},t})(r("sdk.Observable").Observable);t=e,i.default=t},98),t.__d("sdk.XFBML.Save",["IframePlugin","UrlMap","sdk.Content","sdk.DOM","sdk.DialogUtils","sdk.Event","sdk.Runtime","sdk.UA","sdk.XD","sdk.createIframe"],function(e,t,n,r,o,a,i){"use strict";var l;e=n("IframePlugin").extend({constructor:function(t,o,a,i){var e=this;this.parent(t,o,a,i);var s=n("sdk.UA").mobile();this.subscribe("xd.savePluginGetBlankIframe",function(t){var n,o=function(t){t&&r("sdk.DOM").removeCss(t,"fb_invisible")},a=function(t){t&&r("sdk.DOM").addCss(t,"fb_invisible")};s&&(n=r("sdk.DialogUtils").setupNewDarkOverlay(),a(n),r("sdk.Content").append(n),r("sdk.DialogUtils").addDoubleClickAction(n,function(){return u.forEach(a)},5e3));var i=e.setupNewIframeDialog(c("JSON","parse",!1,t.data),t.fromIframe);a(i),r("sdk.Content").append(i);var u=[i,n],d=function(){u.forEach(a),r("sdk.DialogUtils").onDialogHideCleanup(s),window.clearInterval(l)},m;e.subscribe("xd.savePluginShowIframe",function(){r("sdk.Event").fire("savePlugin:hideDialog"),u.forEach(o),e.positionOnScreen(i,n),!s&&!m&&(m=r("sdk.DialogUtils").addIdleDesktopAction(i,d,7e3))}),e.subscribe("xd.savePluginHideIframe",function(){return d()}),r("sdk.Event").subscribe("savePlugin:hideDialog",function(){return d()});var p=window.setInterval(function(){var e=document.getElementsByName(t.fromIframe);e.length===0&&(window.clearInterval(p),d(),u.forEach(function(e){e&&e.parentNode.removeChild(e)}))},500)})},positionOnScreen:function(t,o){var e=n("sdk.UA").mobile();if(e){var a=function(n,o){o!=null&&r("sdk.DialogUtils").setDialogPositionToCenter(o,e),r("sdk.DialogUtils").setDialogPositionToCenter(n,e)};a(t,o),r("sdk.DialogUtils").addMobileOrientationChangeAction(function(e){a(t,o)}),l=window.setInterval(function(){return a(t,o)},100)}else r("sdk.DOM").setStyle(t,"position","fixed"),r("sdk.DOM").setStyle(t,"top","20px"),r("sdk.DOM").setStyle(t,"right","20px")},getOverlayIFrameURL:function(){return r("UrlMap").resolve("www")+(n("sdk.Runtime").getIsVersioned()?"/"+n("sdk.Runtime").getVersion():"")+"/plugins/save/overlay?app_id="+n("sdk.Runtime").getClientID()},setupNewIframeDialog:function(t,o){var e=this,a=r("sdk.DialogUtils").setupNewDialog(),i=function(){r("sdk.XD").sendToFacebook(o,{method:"saveOverlayIFrameAck",params:c("JSON","stringify",!1,{name:"overlay_"+e._iframeOptions.name})})};return n("sdk.createIframe")({url:this.getOverlayIFrameURL(),name:"overlay_"+this._iframeOptions.name,root:a.contentRoot,tabindex:-1,onload:c(i,"bind",!0,this)}),r("sdk.DOM").addCss(a.contentRoot,"fb_dialog_iframe"),c("Object","assign",!1,a.dialogElement.style,t.style||{}),r("sdk.DOM").setStyle(a.dialogElement,"width",t.width+"px"),r("sdk.DOM").setStyle(a.dialogElement,"height",t.height+"px"),t.classList.forEach(function(e){return r("sdk.DOM").addCss(a.dialogElement,e)}),r("sdk.DOM").removeCss(a.dialogElement,"fb_dialog_advanced"),a.dialogElement},getParams:function(){return{uri:"url",url_category:"string",size:"string"}}}),t=e,i.default=t},98),t.__d("sdk.XFBML.SendToMessenger",["IframePluginClass","PluginAttrTypes"],function(e,t,n,r,o,a,i){"use strict";e=(function(e){d.inheritsLoose(t,e);function t(t,n,r,o){return e.call(this,t,n,r,o,{fluid:!1,full_width:!1,mobile_fullsize:!0})||this}var n=t.prototype;return n.getParams=function(){return{messenger_app_id:r("PluginAttrTypes").string,page_id:r("PluginAttrTypes").string,color:r("PluginAttrTypes").string,size:r("PluginAttrTypes").string,enforce_login:r("PluginAttrTypes").bool,identity_match:r("PluginAttrTypes").string,origin:r("PluginAttrTypes").string,cta_text:r("PluginAttrTypes").string,allow_login:r("PluginAttrTypes").bool}},t})(n("IframePluginClass")),i.default=e},98),t.__d("sdk.XFBML.SendToMessengerWrapper",["sdk.Observable","sdk.XFBML.SendToMessenger"],function(e,t,n,r,o,a,i){e=function(t,n,r,o){return new l(t,n,r,o)};var l=(function(e){d.inheritsLoose(t,e);function t(t,n,r,o){var a;return a=e.call(this)||this,a.$SendToMessengerWrapper2=t,a.$SendToMessengerWrapper3=n,a.$SendToMessengerWrapper4=r,a.$SendToMessengerWrapper5=o,a}var r=t.prototype;return r.process=function(){var e=this;this.$SendToMessengerWrapper5.should_use_new_domain=!0,this.$SendToMessengerWrapper1=new(n("sdk.XFBML.SendToMessenger"))(this.$SendToMessengerWrapper2,this.$SendToMessengerWrapper3,this.$SendToMessengerWrapper4,this.$SendToMessengerWrapper5),this.$SendToMessengerWrapper1.subscribe("render",function(){e.inform("render")}),this.$SendToMessengerWrapper1.process()},t})(r("sdk.Observable").Observable);t=e,i.default=t},98),t.__d("sdk.XFBML.ShareButton",["IframePlugin"],function(e,t,n,r,o,a,i){"use strict";e=n("IframePlugin").extend({constructor:function(t,n,r,o){this.parent(t,n,r,o)},getParams:function(){return{href:"url",layout:"string",mobile_iframe:"bool",type:"string",size:"string"}}}),t=e,i.default=t},98),t.__d("sdk.XFBML.Video",["Assert","IframePlugin","ObservableMixin","sdk.Event","sdk.XD"],function(e,t,n,r,o,a,i){var l=(function(){function e(e){this.$1=e.isMuted,this.$2=e.volume,this.$3=e.timePosition,this.$4=e.duration}var t=e.prototype;return t.update=function(e){e.isMuted!==void 0&&(this.$1=e.isMuted),e.volume!==void 0&&(this.$2=e.volume),e.timePosition!==void 0&&(this.$3=e.timePosition),e.duration!==void 0&&(this.$4=e.duration)},t.isMuted=function(){return this.$1},t.getVolume=function(){return this.$1?0:this.$2},t.getCurrentPosition=function(){return this.$3},t.getDuration=function(){return this.$4},e})(),s=(function(){function e(e,t,n){this.$1=e,this.$2=t,this.$3=n}var t=e.prototype;return t.play=function(){r("sdk.XD").sendToFacebook(this.$1,{method:"play",params:c("JSON","stringify",!1,{})})},t.pause=function(){r("sdk.XD").sendToFacebook(this.$1,{method:"pause",params:c("JSON","stringify",!1,{})})},t.seek=function(e){n("Assert").isNumber(e,"Invalid argument"),r("sdk.XD").sendToFacebook(this.$1,{method:"seek",params:c("JSON","stringify",!1,{target:e})})},t.mute=function(){r("sdk.XD").sendToFacebook(this.$1,{method:"mute",params:c("JSON","stringify",!1,{})})},t.unmute=function(){r("sdk.XD").sendToFacebook(this.$1,{method:"unmute",params:c("JSON","stringify",!1,{})})},t.setVolume=function(e){n("Assert").isNumber(e,"Invalid argument"),r("sdk.XD").sendToFacebook(this.$1,{method:"setVolume",params:c("JSON","stringify",!1,{volume:e})})},t.isMuted=function(){return this.$3.isMuted()},t.getVolume=function(){return this.$3.getVolume()},t.getCurrentPosition=function(){return this.$3.getCurrentPosition()},t.getDuration=function(){return this.$3.getDuration()},t.subscribe=function(e,t){var r=this;return n("Assert").isString(e,"Invalid argument"),n("Assert").isFunction(t,"Invalid argument"),this.$2.subscribe(e,t),{release:function(){r.$2.unsubscribe(e,t)}}},e})();e=n("IframePlugin").extend({constructor:function(t,o,a,i){this.parent(t,o,a,i),this._videoController=null,this._sharedObservable=null,this._sharedVideoCache=null,this.subscribe("xd.onVideoAPIReady",function(e){this._sharedObservable=new(n("ObservableMixin")),this._sharedVideoCache=new l(c("JSON","parse",!1,e.data)),this._videoController=new s(this._iframeOptions.name,this._sharedObservable,this._sharedVideoCache),r("sdk.Event").fire("xfbml.ready",{type:"video",id:i.id,instance:this._videoController})}),this.subscribe("xd.stateChange",function(e){this._sharedObservable.inform(e.state)}),this.subscribe("xd.cachedStateUpdateRequest",function(e){this._sharedVideoCache.update(c("JSON","parse",!1,e.data))})},getParams:function(){return{allowfullscreen:"bool",autoplay:"bool",controls:"bool",href:"url",show_captions:"bool",show_text:"bool"}},getConfig:function(){return{fluid:!0,full_width:!0}}}),t=e,i.default=t},98),t.__d("sdk.api-public",["ApiClient","FB","sdk.Runtime","sdk.Scribe","sdk.api","sdk.feature"],function(s,t,n,r,o,a,i){var e=n("sdk.feature")("should_log_response_error",!1),l;function s(){n("sdk.Runtime").subscribe("ClientID.change",function(e){return n("ApiClient").setClientID(e)}),n("sdk.Runtime").subscribe("AccessToken.change",function(e){l=e,n("ApiClient").setAccessToken(e)}),n("ApiClient").setDefaultParams({sdk:"joey"}),n("ApiClient").subscribe("request.complete",function(e,t,r,o){e=!1,o&&typeof o=="object"&&(o.error?(o.error=="invalid_token"||o.error.type=="OAuthException"&&o.error.code==190)&&(e=!0):o.error_code&&o.error_code=="190"&&(e=!0)),e&&l===n("sdk.Runtime").getAccessToken()&&n("sdk.Runtime").setAccessToken(null)}),n("ApiClient").subscribe("request.complete",function(e,t,r,o){(e=="/me/permissions"&&t==="delete"||e=="/restserver.php"&&r.method=="Auth.revokeAuthorization")&&o===!0&&n("sdk.Runtime").setAccessToken(null)}),n("ApiClient").subscribe("request.error",function(t,o,a,i){e&&i.error.type==="http"&&r("sdk.Scribe").log("jssdk_error",{appId:n("sdk.Runtime").getClientID(),error:"transport",extra:{name:"transport",message:c("JSON","stringify",!1,i.error)+" from "+t+" , "+o}})}),n("FB").provide("",{api:n("sdk.api")})}t={init:s},o=t,i.default=o},98),t.__d("sdk.MBasicInitializer",["UrlMap","sdk.DOM","sdk.Runtime","sdk.UA","sdk.URI","sdk.fbt"],function(l,t,n,r,o,a,i){var e=function(){function e(e){if(e){var t=e.parentNode;if(t){var o=r("sdk.DOM").getAttr(e,"href")||window.location.href,a=new(n("sdk.URI"))(r("UrlMap").resolve("m"));a.setPath("/dialog/share"),a.addQueryData("href",encodeURI(o)),a.addQueryData("app_id",n("sdk.Runtime").getClientID()),a.addQueryData("mbasic_link",1),o=document.createElement("a"),o.style="display:inline-block; zoom:1;",o.textContent=n("sdk.fbt")._("Share to Facebook"),o.setAttribute("href",a.toString()),o.setAttribute("target","_blank"),t.insertBefore(o,e),t.removeChild(e)}}}c("Array","from",!1,document.getElementsByTagName("fb:share-button")).forEach(function(t){return e(t)}),c("Array","from",!1,document.getElementsByClassName("fb-share-button")).forEach(function(t){return e(t)})};function l(){n("sdk.UA").mBasic()&&e()}i.init=l},98),t.__d("sdk.init",["Log","ManagedError","sdk.Cookie","sdk.Event","sdk.MBasicInitializer","sdk.PlatformVersioning","sdk.Runtime","sdk.UA","sdk.URI"],function(l,t,n,r,o,a,i){function e(e){var t=typeof e=="number"&&e>0||typeof e=="string"&&/^[0-9a-f]{21,}$|^[0-9]{1,21}$/.test(e);return t?e.toString():(r("Log").warn("Invalid App Id: Must be a number or numeric string representing the application id."),null)}function l(t){if(n("sdk.Runtime").getInitialized()&&r("Log").warn("FB.init has already been called - this could indicate a problem"),n("sdk.Runtime").getIsVersioned()){if(Object.prototype.toString.call(t)!=="[object Object]")throw new(n("ManagedError"))("Invalid argument");if(t.authResponse)throw new(n("ManagedError"))("Setting authResponse is not supported");t.version||(t.version=new(n("sdk.URI"))(location.href).getQueryData().sdk_version),r("sdk.PlatformVersioning").assertValidVersion(t.version),n("sdk.Runtime").setVersion(t.version)}else/number|string/.test(typeof t)&&(r("Log").warn("FB.init called with invalid parameters"),t={apiKey:t}),t.status==null&&(t.legacyStatusInit=!0),t=d.extends({status:!0},t||{});var o=e(t.appId||t.apiKey);o!==null&&n("sdk.Runtime").setClientID(o),"scope"in t&&n("sdk.Runtime").setScope(t.scope),t.cookie&&(n("sdk.Runtime").setUseCookie(!0),typeof t.cookie=="string"&&r("sdk.Cookie").setDomain(t.cookie)),(t.localStorage===!1||t.localStorage==="false")&&n("sdk.Runtime").setUseLocalStorage(!1),t.kidDirectedSite&&n("sdk.Runtime").setKidDirectedSite(!0),t.useFamilyLogin&&n("sdk.Runtime").setShouldLoadFamilyLogin(!0),(t.autoLogAppEvents==="1"||t.autoLogAppEvents==="true")&&(t.autoLogAppEvents=!0),t.ab&&n("sdk.Runtime").setSDKAB(t.ab),n("sdk.Runtime").setInitialized(!0),n("sdk.UA").mBasic()&&r("sdk.MBasicInitializer").init(),r("sdk.Event").fire("init:post",t)}i.default=l},98),t.__d("sdk.init-public",["FB","QueryString","sdk.AppEvents","sdk.ErrorHandling","sdk.Event","sdk.Frictionless","sdk.XD","sdk.init"],function(e,t,n,r,o,a,i){"use strict";function e(){t("sdk.XD"),t("sdk.AppEvents"),t("sdk.Frictionless"),window.setTimeout(function(){var e=/(connect\.facebook\.net|\.facebook\.com\/assets.php|\.facebook\.net\/assets.php).*?#(.*)/;c("Array","from",!1,window.document.getElementsByTagName("script")).forEach(function(t){if(t.src&&(t=e.exec(t.src),t)){var r={};t=n("QueryString").decode(t[2]);for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var a=t[o];a==="0"?r[o]=0:r[o]=a}n("sdk.init")(r)}}),window.fbAsyncInit&&!window.fbAsyncInit.hasRun&&(r("sdk.Event").fire("init:asyncstart"),window.fbAsyncInit.hasRun=!0,n("sdk.ErrorHandling").unguard(window.fbAsyncInit)())},0),n("FB").provide("",{init:n("sdk.init")}),r("sdk.Event").subscribe("init:post",function(){window.__buffer!==void 0&&window.__buffer.replay()}),window.setTimeout(function(){window.__buffer&&window.__buffer.opts&&n("sdk.init")(window.__buffer.opts)},0)}o={initialize:e},a=o,i.default=a},98),t.__d("sdk.Time",["Log","sdk.Impressions","sdk.Runtime","sdk.URI","sdk.feature"],function(u,d,n,r,o,a,i){"use strict";var e=window.performance,t=e&&"now"in e&&"getEntriesByName"in e,l,s={};function u(){function o(e,t){var o=!1;try{e=new(n("sdk.URI"))(e.name);var a=e.getDomain();e=e.getPath(),o=a===t.getDomain()&&c(e,"includes",!0,"/rsrc.php/")}catch(e){r("Log").error("Malformed URL was passed to the URL constructor: Error %s occured",e.message)}return o}function a(t){var r=e.getEntriesByType("resource").filter(function(e){return o(e,new(n("sdk.URI"))(t))}),a=r.length>=1;return a||(r=e.getEntriesByType("resource").filter(function(e){return c(e.name,"startsWith",!0,t)})),r}if(t){var i=n("sdk.Runtime").getSDKUrl(),u=null;if(a=a(i),a.length>1)if(a>2)a=null;else{var d=c(a,"findIndex",!0,function(e){return c(e.name,"startsWith",!0,i+"?hash=")});d?(u=a.splice(d)[0],a=a[0]):a=null}else a.length===1?(d=document.getElementById("facebook-jssdk-iframe"),d&&d instanceof HTMLIFrameElement&&(u=d.contentWindow.performance.getEntriesByType("resource").find(function(e){return c(e.name,"startsWith",!0,i)})),a=a[0]):a=null;a&&(s.fetchTime=Math.round(a.duration),u&&(s.fetchTime+=Math.round(u.duration)),"transferSize"in a&&(s.transferSize=a.transferSize,u&&(s.transferSize+=u.transferSize)),r("Log").debug("sdkperf: it took %s ms and %s bytes to load %s",s.fetchTime,s.transferSize,i),l=a.startTime,s.ns=n("sdk.Runtime").getSDKNS(),l&&window.setTimeout(function(){var e=n("sdk.feature")("log_perf",!1),t=n("sdk.Runtime").getSDKAB();t&&(s.ab=t,e=!0),e&&r("sdk.Impressions").log(116,s)},1e4))}}function d(n){!t||!l||(s[n]=Math.round(e.now()-l),r("Log").debug("sdkperf: %s logged after %s ms",n,s[n]))}i.recordBootload=u,i.log=d},98),t.__d("sdk.time-public",["runOnce","sdk.Event","sdk.Time"],function(e,t,n,r,o,a,i){"use strict";function e(){r("sdk.Time").recordBootload(),r("sdk.Event").subscribe("init:post",function(){r("sdk.Time").log("init")}),r("sdk.Event").subscribe("init:asyncstart",function(){r("sdk.Time").log("asyncstart")}),r("sdk.Event").subscribe("iframeplugin:create",n("runOnce")(function(){return r("sdk.Time").log("pluginframe")})),r("sdk.Event").subscribe("iframeplugin:onload",n("runOnce")(function(){return r("sdk.Time").log("ttfp")}))}t={init:e},o=t,i.default=o},98),t.__d("legacy:fb.sdk.index",["FB","sdk.AppEvents-public","sdk.Auth-public","sdk.Canvas-public","sdk.Event-public","sdk.Frictionless-public","sdk.GamingServices-public","sdk.Runtime","sdk.api-public","sdk.init-public","sdk.time-public","sdk.ui"],function(e,t,n,r,o,a,i){n("sdk.api-public").init(),n("sdk.AppEvents-public").init(),n("sdk.Auth-public").init(),n("sdk.Canvas-public").init(),n("sdk.Canvas-public").initCanvasPlugin(),n("sdk.Canvas-public").initCanvasPrefetcher(),n("sdk.Canvas-public").initCanvasPresence(),n("sdk.Event-public").init(),n("sdk.Frictionless-public").init(),n("sdk.GamingServices-public").init(),n("sdk.init-public").initialize(),n("sdk.time-public").init(),n("FB").provide("",{ui:n("sdk.ui")}),n("sdk.Runtime").setIsVersioned(!0)},35),window.FB&&window.FB.__buffer&&(window.__buffer=d.extends({},window.FB.__buffer))}).call(n)})()}catch(e){}}i.default=e}),66);
__d("XMDSToast.react",["fbt","BaseToast.react","CometThemeInfraUtils","MetaBrandXFilled24Icon.react","XMDSIcon.react","XMDSIconButton.react","XMDSText.react","XMDSThemeConfig","react"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c={header:{marginBottom:"x1e56ztr",$$css:!0},link:{paddingTop:"x1iorvi4",paddingBottom:"xjkvuk6",wordBreak:"xdnwjd9",$$css:!0}},d={margin20:{marginBottom:"xieb3on",$$css:!0},margin32:{marginBottom:"x1iymm2a",$$css:!0},margin48:{marginBottom:"x13ihpsm",$$css:!0},margin64:{marginBottom:"x16bybu0",$$css:!0}},m={20:d.margin20,32:d.margin32,48:d.margin48,64:d.margin64};function p(e){var t=e.action,n=e.addOnStart,a=e.density,i=e.header,l=e.message,d=e.offsetFooter,p=e.onDismiss,_=e.ref,f=e.size,g=f===void 0?"full-width":f,h=e.testid,y=e.withoutCloseButton,C=y===void 0?!1:y;return u.jsx(r("BaseToast.react"),{action:t!=null?{label:t.label,labelRenderer:function(t){return u.jsx(r("XMDSText.react"),{color:"toastTextLink",textStyle:"body",xstyle:c.link,children:t})},onPress:function(n){t.onPress(n,t.dismissToastOnPress===!0?p:function(){})},testid:t.testid}:void 0,addOnStart:n,closeButton:!C&&u.jsx(r("XMDSIconButton.react"),{"aria-label":s._(/*BTDS*/"Cerrar"),onPress:p,children:u.jsx(r("XMDSIcon.react"),{color:"toast-DO_NOT_USE_WILL_BE_DELETED_WITHOUT_NOTICE",icon:r("MetaBrandXFilled24Icon.react"),size:24})}),density:a,message:function(t){var e=t.toastMessageId;return u.jsxs("div",{className:"x78zum5 xdt5ytf",id:e,children:[i!=null&&u.jsx(r("XMDSText.react"),{color:"toastText_DO_NOT_USE_WILL_BE_DELETED_WITHOUT_NOTICE",textStyle:"bodyEmphasized",xstyle:c.header,children:i}),u.jsx(r("XMDSText.react"),{color:"toastText_DO_NOT_USE_WILL_BE_DELETED_WITHOUT_NOTICE",textStyle:"body",children:l})]})},offsetStyles:d&&m[d],onDismiss:p,size:g,testid:void 0,themeConfigOverride:o("CometThemeInfraUtils").enableCometThemeInfraThemeInXMDSComponents()?void 0:r("XMDSThemeConfig"),toastRef:_})}p.displayName=p.name+" [from "+i.id+"]",l.default=p}),226);